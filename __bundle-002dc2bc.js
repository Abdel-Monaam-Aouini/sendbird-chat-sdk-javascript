/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(s,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}function i(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return a}function o(e,t,n){if(n||2===arguments.length)for(var r,s=0,i=t.length;s<i;s++)!r&&s in t||(r||(r=Array.prototype.slice.call(t,0,s)),r[s]=t[s]);return e.concat(r||Array.prototype.slice.call(t))}var u,c="4.0.0-beta.12",l=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return"4.0.0-beta.12"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",e[e.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(u||(u={}));var h,d=function(e){return!(e instanceof p&&!e.shouldThrowOutside)},p=function(e){function n(t){var r=t.code,s=void 0===r?0:r,i=t.message,a=e.call(this,i)||this;return a.shouldThrowOutside=!1,a.name="SendbirdError",a.code=s,Object.setPrototypeOf(a,n.prototype),a}return t(n,e),Object.defineProperty(n.prototype,"isInvalidTokenError",{get:function(){return this.code===u.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===u.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===u.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:u.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:u.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRenew",{get:function(){return new n({code:u.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:u.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:u.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:u.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:u.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:u.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:u.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:u.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:u.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:u.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:u.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:u.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:u.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:u.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),f=[u.CONNECTION_REQUIRED,u.NETWORK_ERROR,u.ACK_TIMEOUT,u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.FILE_UPLOAD_CANCEL_FAILED,u.REQUEST_CANCELED,u.INTERNAL_SERVER_ERROR,u.RATE_LIMIT_EXCEEDED,u.UNKNOWN_SERVER_ERROR],_=[u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.CONNECTION_REQUIRED],m=function(e,t){if(e!==t){var r=n({},e),s=n({},t);return(!r.hasOwnProperty("messageId")||!s.hasOwnProperty("messageId")||r.messageId===s.messageId)&&((!r.hasOwnProperty("reqId")||!s.hasOwnProperty("reqId")||r.reqId===s.reqId)&&(r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,s.hasOwnProperty("messageId")&&delete s.messageId,s.hasOwnProperty("reqId")&&delete s.reqId,JSON.stringify(r)===JSON.stringify(s)))}return!0},v=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||("string"!=typeof e?"object"==typeof e?g(e,t):y(e,t):typeof t===e)},g=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Object.values(e).includes(t)},y=function(e,t){return t instanceof e},E=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return v(e,t)}))},b=function(e){return e>0&&_.indexOf(e)>=0},N=function(e,t){if(void 0===t&&(t=!1),t&&null===e)return!0;var n=v("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},T=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,r=void 0!==n&&n,s=t.typingIndicatorInvalidateTime,i=void 0===s?1e4:s,a=t.typingIndicatorThrottle,o=void 0===a?1e3:a,u=t.websocketResponseTimeout,c=void 0===u?1e4:u;this._useMemberInfoInMessage=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=r,this._typingIndicatorInvalidateTime=i,this._typingIndicatorThrottle=o,this._websocketResponseTimeout=c}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){v("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){v("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){v("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){v("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),e}(),I={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},C={encrypt:function(e){return e},decrypt:function(e){return e}},S=function(e){var t=e.encryption,n=void 0===t?null:t,r=e.store,s=void 0===r?null:r,i=e.localCacheEnabled,a=void 0===i||i;this.nestdb=null,this.store=s,this.encryption=null!=n?n:C,this.localCacheEnabled=a},A=function(){function e(){this.sessionKey=null,this.authToken=null}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=null,this.sessionKey=null},e}(),M=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},w=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=M()}return e.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},e}(),U=function(){function e(){this._container={}}return e.prototype.on=function(e,t){return new w({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new w({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,s=this._container[e];if(s){var a=[];try{for(var o=i(s.keys()),u=o.next();!u.done;u=o.next()){var c=u.value,l=s.get(c);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&a.push(c))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}a.forEach((function(e){return s.delete(e)}))}},e}(),R=function(){function e(){this._dispatcher=new U}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},e}(),D=function(){},O=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(h||(h={}));var L,P=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=M(),t}return t(n,e),n.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,t=O(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e.stringifyParams(t[n])))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=this,t=O(this.params);if(Object.keys(t).some((function(e){return N(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var s,i=t[r];if(N(i)){var a=i;n.append(r,a,null!==(s=a.name)&&void 0!==s?s:"filename")}else n.append(r,e.stringifyParams(i))})),n}return JSON.stringify(t)},enumerable:!1,configurable:!0}),n}(D),k=function(e){function r(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return t(r,e),Object.defineProperty(r.prototype,"payload",{get:function(){return n({},this._payload)},enumerable:!1,configurable:!0}),r.prototype.as=function(e){return new e(this._iid,this.payload)},r}(D),F=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t,n}return t(n,e),n}(D),x=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(D),q=function(e){function n(t){var n=e.call(this)||this;return n.statLog=t,n}return t(n,e),n}(D);!function(e){e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(L||(L={}));var H,G=function(){function e(e){var t=e.type,n=e.data,r=e.ts,s=void 0===r?Date.now():r;this.type=t,this.createdAt=s,this.data=n}return e.payloadify=function(e){return O({stat_type:e.type,ts:e.createdAt,data:O(e.data)})},e}(),V=function(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},Q=function(){function e(e,t){var n=t.auth,r=t.sdkState,s=t.dispatcher,i=t.logger,a=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=s,this._dispatcher.on((function(e){e instanceof F&&a.cancel(e.requestId)})),this._logger=i}return Object.defineProperty(e.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t=V()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",s=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(l.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(s)},enumerable:!1,configurable:!0}),e.prototype._createHeader=function(e,t){void 0===t&&(t=null);var r=this._sdkState,s=r.appId,i=r.appVersion,a=n(n({},e.headers),{SendBird:"JS,".concat(l.OS_VERSION,",").concat(l.SDK_VERSION,",").concat(s).concat(i?",".concat(i):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(a["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(a["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(a["App-Id"]=s,a["Access-Token"]=this._auth.authToken),a},e.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new q(new G({type:L.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c,l,d,f,_,m,v,g;return s(this,(function(s){switch(s.label){case 0:t=e.path,n=e.method,r=![h.GET,h.DELETE].includes(n),i=this._sdkState.api,a="".concat(i.host).concat(t).concat(r?"":e.query),o=r?e.payload:null,u=this._createHeader(e,o instanceof FormData?o:null),c=new AbortController,l=c.signal,this._abortControl.set(e.requestId,c),d=Date.now(),s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(a,{method:n,body:o,headers:u,signal:l})];case 2:return[4,(f=s.sent()).json()];case 3:if(_=s.sent(),f.ok||f.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,d,null),[2,new k(this._iid,_)];throw _?((m=new p(_)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new x),this._statLogApiResult(e,d,m),m):(m=p.requestFailed,this._statLogApiResult(e,d,m),m);case 4:throw v=s.sent(),this._statLogApiResult(e,d,v),v instanceof p?(this._logger.debug("fail api request",v),v):"AbortError"===v.name?p.requestCanceled:(g=p.networkError,this._logger.debug("fail api request",g),g);case 5:return[2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},e.prototype.cancelAll=function(){var e,t;try{for(var n=i(this._abortControl.values()),r=n.next();!r.done;r=n.next()){r.value.abort()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},e}(),B=function(e){function n(t,n,r,s){void 0===s&&(s="");var i,a=this;return(a=e.call(this)||this)._iid=t,a.code=n,a.payload=r,a.requestId=r?null!==(i=r.req_id)&&void 0!==i?i:s:"",a}return t(n,e),n.createFromRawMessage=function(e,t){var r=t.substring(0,4),s=null;try{s=JSON.parse(t.substring(4))}catch(e){r="NOOP"}finally{return new n(e,r,s)}},n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(D),j=function(e){function n(t){var n,r=t.code,s=t.ackRequired,i=t.payload,a=void 0===i?null:i,o=this;return(o=e.call(this)||this).code=r,o.payload=a,o.requestId=null!==(n=o.payload.req_id)&&void 0!==n?n:M(),o.ackRequired=s,o.payload.req_id=o.requestId,o}return t(n,e),n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n}(D),z=function(e){function n(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return t(n,e),n}(j),K=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=r}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this,n=new z;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e.prototype.refreshTimer=function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e}(),W=function(){};!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED"}(H||(H={}));var Y,J=function(e){function n(t,n){var r=n.sdkState,s=n.dispatcher,i=n.logger,a=e.call(this)||this;return a._pinger=null,a.lastActive=0,a._iid=t,a._sdkState=r,a._dispatcher=s,a._logger=i,a._sdkState.websocket.pingerDisabled||(a._pinger=new K({pingDelegate:{send:function(e){return a.send(e)},error:function(e){return a.error(e)}},sdkState:a._sdkState,logger:i})),a}return t(n,e),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return H.CONNECTING;case 1:return H.OPEN}return H.CLOSED},enumerable:!1,configurable:!0}),n.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach((function(e){if(e&&v("string",e)){var n=B.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?(n.payload&&!n.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",n)):"PONG"===n.code?t._pinger&&t._pinger.pong():"EXPR"===n.code?n.payload&&n.payload.expires_in>0&&t._dispatcher.dispatch(new x):"NOOP"===n.code||t.dispatch("message",n)}}))},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",p.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},n.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=W,this._ws.onmessage=W,this._ws.onerror=W,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},n.prototype.send=function(e){if(!this._ws)throw p.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},n.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)},n}(U),X=function(e){function n(t){var n=t.all,r=t.custom_types,s=t.ts,i=e.call(this)||this;return i.all=n,i.customTypes=r,i.ts=s,i}return t(n,e),n}(D),Z=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))},$=function(){function e(e,t){var n=t.auth,r=t.sdkState,s=t.dispatcher,i=t.logger,a=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=s,this._logger=i,this.apiClient=new Q(e,{auth:n,sdkState:r,dispatcher:s,logger:i}),this.websocketClient=new J(e,{sdkState:r,dispatcher:s,logger:i}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new X(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new p({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(p.connectionClosed)})),a._ackStateMap.clear()}))}return e.prototype._sendApiRequest=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.apiClient.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i=this;return s(this,(function(s){if(t=new Z,e.ackRequired){n=null,r=function(r,s){void 0===r&&(r=null),void 0===s&&(s=null),i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(i._logger.debug("fail websocket request",r),t.reject(r)):(i._logger.debug("receive websocket ack",e.requestId),t.resolve(s)))};try{n=setTimeout((function(){return r(p.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(null,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e)}catch(e){r(e)}}else try{this.websocketClient.send(e),t.resolve(null)}catch(e){t.reject(e)}return[2,t.promise]}))}))},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e instanceof P?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return e instanceof j?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw p.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e)},e.prototype.cancelAll=function(){this.apiClient.cancelAll()},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT"}(Y||(Y={}));var ee,te,ne,re,se,ie,ae,oe,ue,ce=function(e){function n(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return t(n,e),n}(D),le=function(){function e(e,t){var n=t.auth,i=t.sdkState,a=t.dispatcher,o=t.logger,u=this;this._currentConnectionStateType=Y.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new $(e,{auth:n,sdkState:i,dispatcher:a,logger:o}),this._auth=n,this._logger=o,this._dispatcher=a,this._dispatcher.on((function(e){if(e instanceof ce){var t=e.stateType;switch(u._currentConnectionStateType=t,t){case Y.CONNECTED:var n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return r(u,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:t=e.command,n=e.deferred,r=e.timeout,clearTimeout(r),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.send(t)];case 2:return i=s.sent(),n.resolve(i),[3,4];case 3:return a=s.sent(),n.reject(a),[3,4];case 4:return[2]}}))}))}));break;case Y.INITIALIZED:case Y.DISCONNECTED:case Y.LOGOUT:n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return r(u,void 0,void 0,(function(){var t,n;return s(this,(function(r){return t=e.deferred,n=e.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(p.connectionClosed):t.reject(p.connectionRequired),[2]}))}))}))}}}))}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===Y.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===Y.CONNECTING||this._currentConnectionStateType===Y.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(s){switch(s.label){case 0:return e instanceof j?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:return[2,s.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new Z,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),p.connectionRequired;case 3:return[3,7];case 4:return e instanceof P?this._auth.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new Z,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=p.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}}))}))},e.prototype.forceSend=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._logger.debug("send websocket request (forced)",e),[4,this.commandRouter.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(p.connectionRequired),this._lazyCallQueue.splice(t,1))},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},e}(),he=function(e){function n(t){var n=t.userId,r=t.authToken,s=t.expiringSession,i=void 0===s||s,a=e.call(this)||this;return a.path="/users/".concat(n,"/session_key"),a.method=h.POST,a.params={token:r,expiring_session:!!i},a.requireAuth=!1,a}return t(n,e),n}(P),de=function(e){function n(t){var n=t.authToken,r=t.expiringSession,s=void 0===r||r;return e.call(this,{code:"LOGI",payload:{token:n,expiring_session:s?1:0},ackRequired:!0})||this}return t(n,e),n}(j),pe=function(e){function n(t,n){var r=e.call(this,t,n)||this,s=n.key;return r.key=s,r}return t(n,e),n}(k),fe=function(e){function n(t,n,r){var s=e.call(this,t,"LOGI",r)||this;return s.error=null,s.newKey=r.new_key,s.error=r.error?new p(r.error):null,s}return t(n,e),n}(B),_e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(D),me=function(e){return r(void 0,void 0,void 0,(function(){return s(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},ve=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),ge=function(e,t,n){return void 0===n&&(n=new ve),r(void 0,void 0,void 0,(function(){var r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:r=0,i=null,a=function(e){return void 0===e&&(e=null),i=null!=e?e:new Error("Halted")},o=function(){r=0},s.label=1;case 1:if(!(-1===t||r<t))return[3,9];s.label=2;case 2:return s.trys.push([2,4,,8]),[4,e(a,o)];case 3:if(u=s.sent(),i)throw i;return[2,u];case 4:if(c=s.sent(),i)return[3,6];if(++r===t)throw c;return[4,me(n.calcTimeout(r))];case 5:return s.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},ye=function(e){return r(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof p))throw t;return t.throwOutside(),[3,3];case 3:return[2]}}))}))},Ee=function(e){return r(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},be=function(){function e(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,s=e.requestQueue,i=e.logger,a=this;this._currentConnectionStateType=Y.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=s,this._logger=i,this._dispatcher.on((function(e){if(e instanceof ce){var t=e.stateType;a._currentConnectionStateType=t}else e instanceof x&&a.refresh()}))}return e.prototype.createRefreshWebsocketCommand=function(e){return new de({authToken:e,expiringSession:!0})},e.prototype._refreshSessionKey=function(e,t){return r(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h=this;return s(this,(function(f){switch(f.label){case 0:if(this._currentConnectionStateType!==Y.CONNECTED)return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),n=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(n)];case 2:if(i=f.sent(),a=i.as(fe),o=a.newKey,u=a.error)throw u;return this.auth.sessionKey=null!=o?o:this.auth.sessionKey,this._logger.debug("session refreshed"),ye((function(){return r(h,void 0,void 0,(function(){return s(this,(function(e){return this.handler.onSessionRefreshed(),[2]}))}))})),t&&t.resolve(),[2];case 3:if(c=f.sent(),d(c))throw c;return c.isSessionTokenExpiredError?(this._handleError(t),[2]):[3,4];case 4:return f.trys.push([4,6,,7]),l=new he({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,ge((function(e){return r(h,void 0,void 0,(function(){var t,n,r;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(l)];case 1:return t=s.sent(),n=t.as(pe).key,this.auth.sessionKey=n,[3,3];case 2:throw(r=s.sent()).isSessionTokenExpiredError&&e(p.sessionTokenRefreshFailed),r;case 3:return[2]}}))}))}),3)];case 5:return f.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return f.sent(),this._handleError(t),[2];case 7:return ye((function(){return r(h,void 0,void 0,(function(){return s(this,(function(e){return this.handler.onSessionRefreshed(),[2]}))}))})),t&&t.resolve(),[2]}}))}))},e.prototype._handleError=function(e){var t=this,n=p.sessionTokenRefreshFailed;ye((function(){return r(t,void 0,void 0,(function(){return s(this,(function(e){return this.handler.onSessionError(n),[2]}))}))})),e&&e.reject(n)},e.prototype.refresh=function(){return r(this,void 0,void 0,(function(){var e,t,n,i=this;return s(this,(function(a){return this.handler?(e=new Z,t=function(t){t?(i._logger.debug("session refreshing.."),i.auth.authToken=t,i._refreshSessionKey(t,e)):(i._logger.debug("session closed"),ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(e){return this.handler.onSessionClosed(),[2]}))}))})),e.resolve())},n=function(){i._dispatcher.dispatch(new _e);var t=p.sessionTokenRequestFailed;i.handler&&(ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(e){return this.handler.onSessionError(t),[2]}))}))})),e.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,e):ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(e){return this.handler.onSessionTokenRequired(t,n),[2]}))}))})),[2,e.promise]):[2]}))}))},e}(),Ne=function(){function e(){this.type=Y.NONE,this.name="none"}return e.prototype.run=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e}(),Te=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Y.LOGOUT,t.name="logout",t}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(i){switch(i.label){case 0:return t=e.sdkState.userId,e.logout(),ye((function(){return r(n,void 0,void 0,(function(){return s(this,(function(n){return e.connectionHandlers.forEach((function(e){e.onDisconnected(t)})),[2]}))}))})),[4,e.changeState(new Me)];case 1:return i.sent(),[2]}}))}))},n}(Ne),Ie=function(e){function n(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=Y.DISCONNECTED,r.name="disconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.disconnect(),this._autoReconnect?[4,e.changeState(new Ce)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return e.disconnect(),[4,e.changeState(new Ae({authToken:t}))];case 1:return n.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new Ce)];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new Te)];case 1:return t.sent(),[2]}}))}))},n}(Ne),Ce=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Y.RECONNECTING,t.name="reconnecting",t._haltConnect=null,t._resetConnect=null,t._callbacks=[],t}return t(n,e),n.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,i,a,o,c=this;return s(this,(function(l){switch(l.label){case 0:t=new Z,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),ye((function(){return r(c,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted()})),[2]}))}))})),l.label=1;case 1:return l.trys.push([1,4,,9]),n=e.sdkState.websocket,i=n.reconnectMaxRetry,a=n.reconnectRetryStrategy,[4,ge((function(t,n){return r(c,void 0,void 0,(function(){var r;return s(this,(function(s){switch(s.label){case 0:this._haltConnect=t,this._resetConnect=n,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.connect()];case 2:return s.sent(),[3,4];case 3:if((r=s.sent())instanceof p&&r.code===u.CONNECTION_CANCELED)return t(r),[2];throw r;case 4:return[2]}}))}))}),i,a)];case 2:return l.sent(),[4,e.changeState(new Se)];case 3:return l.sent(),ye((function(){return r(c,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded()})),this.flushCallbacks(null),[2]}))}))})),[3,9];case 4:return o=l.sent(),d(o)?[3,7]:o instanceof p?o.code===u.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Ie({autoReconnect:!1}))]:[3,6];case 5:l.sent(),l.label=6;case 6:return ye((function(){return r(c,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectFailed()})),this.flushCallbacks(o),[2]}))}))})),[3,8];case 7:throw o;case 8:return[3,9];case 9:return[2,t.promise]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=new Z,this._resetConnect&&this._resetConnect(),e.cancelConnectForRetry(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),[2,t.promise]}))}))},n.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,i=void 0!==n&&n;return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){return t=new Z,this._resetConnect&&i&&this._resetConnect(),e.cancelConnectForRetry(),this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),[2,t.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,i=void 0===n?null:n,a=t.autoReconnect,o=void 0===a||a;return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=i?i:p.connectionCanceled),[4,e.changeState(new Ie({autoReconnect:o}))];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,e.changeState(new Te)];case 1:return t.sent(),[2]}}))}))},n}(Ne),Se=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Y.CONNECTED,t.name="connected",t}return t(n,e),n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e.disconnect(),[4,e.changeState(new Ce)];case 1:return t.sent(),[2]}}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new Ie({autoReconnect:n}))];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new Te)];case 1:return t.sent(),[2]}}))}))},n}(Ne),Ae=function(e){function n(t){var n=t.authToken,r=e.call(this)||this;return r.type=Y.CONNECTING,r.name="connecting",r._authToken="",r._haltConnect=null,r._callbacks=[],r._authToken=n,r}return t(n,e),n.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,i=this;return s(this,(function(a){switch(a.label){case 0:t=new Z,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),a.label=1;case 1:return a.trys.push([1,4,,9]),[4,ge((function(t){return r(i,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if((n=r.sent())instanceof p&&n.code===u.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return[2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return a.sent(),[4,e.changeState(new Se)];case 3:return a.sent(),ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId)})),this.flushCallbacks(null),[2]}))}))})),[3,9];case 4:return n=a.sent(),d(n)?[3,7]:(e.disconnect(),n instanceof p?n.code===u.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Me)]:[3,6]);case 5:a.sent(),a.label=6;case 6:return ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(e){return this.flushCallbacks(n),[2]}))}))})),[3,8];case 7:throw n;case 8:return[3,9];case 9:return[2,t.promise]}}))}))},n.prototype.onConnect=function(e){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new Z,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,i=void 0===n?null:n;return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=i?i:p.connectionCanceled),[4,e.changeState(new Te)];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,e.changeState(new Te)];case 1:return t.sent(),[2]}}))}))},n}(Ne),Me=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=Y.INITIALIZED,t.name="initialized",t}return t(n,e),n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,e.changeState(new Ae({authToken:t}))];case 1:return n.sent(),[2]}}))}))},n}(Ne),we=new Map,Ue=function(e,t){var n;return void 0===t&&(t=null),null!==t&&we.set(e,t),null!==(n=we.get(e))&&void 0!==n?n:""},Re=function(e){void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]},De=function(){function e(e){this._iid="",this._iid=e}return e.payloadify=function(e){return e?{}:null},e}(),Oe="/".concat("v3","/users"),Le="/".concat("v3","/storage/file"),Pe="/".concat("v3","/group_channels"),ke="/".concat("v3","/sdk/group_channels"),Fe="/".concat("v3","/open_channels"),xe="/".concat("v3","/sdk/open_channels"),qe="/".concat("v3","/search"),He="/".concat("v3","/report"),Ge="/".concat("v3","/emojis"),Ve="/".concat("v3","/emoji_categories"),Qe="/".concat("v3","/scheduled_messages"),Be="/".concat("v3","/sdk/statistics"),je=function(e){function n(t){var n=t.userId,r=t.metadata,s=e.call(this)||this;return s.method=h.POST,s.path="".concat(Oe,"/").concat(n,"/metadata"),s.params={metadata:r},s}return t(n,e),n}(P);!function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}t(n,e)}(k),function(e){e.BASE="base",e.GROUP="group",e.OPEN="open"}(ee||(ee={})),function(e){e.OPERATOR="operator",e.NONE="none"}(te||(te={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin"}(ne||(ne={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(re||(re={})),function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(se||(se={})),function(e){e.USERS="users",e.CHANNEL="channel"}(ie||(ie={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(ae||(ae={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress"}(oe||(oe={})),function(e){e.PENDING="pending",e.SCHEDULED="scheduled",e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled"}(ue||(ue={}));var ze=function(e){switch(e){case ee.GROUP:return Pe;case ee.OPEN:return Fe;default:return null}},Ke=function(e){switch(e){case ee.GROUP:return"".concat(He,"/group_channels");case ee.OPEN:return"".concat(He,"/open_channels");default:return null}},We=function(e,t,n){var r,s;switch(e){case ie.CHANNEL:return!0;case ie.USERS:if(t)try{for(var a=i(t),o=a.next();!o.done;o=a.next()){if(o.value===n)return!0}}catch(e){r={error:e}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}}return!1},Ye=function(e,t,n){var r=We(e.mentionType,e.mentionedUserIds,n),s=We(t.mentionType,t.mentionedUserIds,n);return!r&&s?1:r&&!s?-1:0},Je=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.metadata;return(n=e.call(this)||this).method=h.POST,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:i,include_ts:!0},n}return t(n,e),n}(P),Xe=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaData=null!=n?n:{},r}return t(n,e),n}(k),Ze=function(e){function n(t){var n=t.userId,r=t.metadata,s=t.upsert,i=e.call(this)||this;return i.method=h.PUT,i.path="".concat(Oe,"/").concat(n,"/metadata"),i.params={metadata:r,upsert:s},i}return t(n,e),n}(P),$e=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return t(n,e),n}(k),et=function(e){function n(t){var n=t.userId,r=t.metadataKey,s=e.call(this)||this;return s.method=h.DELETE,s.path="".concat(Oe,"/").concat(n,"/metadata/").concat(r),s}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var tt=function(e){function n(t){var n=t.userId,r=e.call(this)||this;return r.method=h.DELETE,r.path="".concat(Oe,"/").concat(n,"/metadata"),r}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var nt,rt=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},st=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},it=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable"}(nt||(nt={}));var at,ot=function(e){function i(t,n){var r,s,i,u,c,l,h,d,p,f,_,m,y=this;return(y=e.call(this,t)||this).userId=null!==(s=null!==(r=n.guest_id)&&void 0!==r?r:n.user_id)&&void 0!==s?s:"",y.nickname=null!==(u=null!==(i=n.nickname)&&void 0!==i?i:n.name)&&void 0!==u?u:"",y.plainProfileUrl=null!==(l=null!==(c=n.profile_url)&&void 0!==c?c:n.image)&&void 0!==l?l:"",y.requireAuth=null!==(h=n.require_auth_for_profile_image)&&void 0!==h&&h,y.metaData=null!==(d=n.metadata)&&void 0!==d?d:{},y.connectionStatus=nt.NON_AVAILABLE,g(nt,n.is_online)?y.connectionStatus=n.is_online:v("boolean",n.is_online)&&(y.connectionStatus=n.is_online?nt.ONLINE:nt.OFFLINE),y.isActive=null===(p=n.is_active)||void 0===p||p,y.lastSeenAt=null!==(f=n.last_seen_at)&&void 0!==f?f:null,y.preferredLanguages=n.preferred_languages?o([],a(n.preferred_languages),!1):null,y.friendDiscoveryKey=null!==(_=n.friend_discovery_key)&&void 0!==_?_:null,y.friendName=null!==(m=n.friend_name)&&void 0!==m?m:null,y}return t(i,e),i.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})):null},Object.defineProperty(i.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(Ue(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),i.prototype.serialize=function(){return rt(this)},i.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return v("string",e)}))},i.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r]}))},i.prototype.createMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return it(this._isValidMetaData(e)).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new je({userId:n.userId,metadata:e}),[4,r.send(i)];case 1:return a=s.sent(),o=a.as(Xe).metaData,this._applyMetaData(o),[2,this.metaData]}}))}))},i.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return it(this._isValidMetaData(e)).throw(p.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Ze({userId:r.userId,metadata:e,upsert:t}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as($e).metadata,this._applyMetaData(u),[2,this.metaData]}}))}))},i.prototype.deleteMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new et({userId:n.userId,metadataKey:e}),[4,r.send(i)];case 1:return s.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}}))}))},i.prototype.deleteAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new tt({userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),this.metaData={},[2]}}))}))},i}(De),ut=function(e){function n(t){var n=t.userProfile,r=e.call(this)||this;return r.userProfile=n,r}return t(n,e),n}(D),ct=function(){function e(e,t){var n,r,s,i,a,o,u,c,l,h,d,p,f,_;this._iid=e,this.appInfo=new Re(t),this.user=new ot(e,t),this.connectedAt=1e3*(null!==(n=t.login_ts)&&void 0!==n?n:0),this.firstConnectedAt=0,this.pingInterval=null!==(r=t.ping_interval)&&void 0!==r?r:15e3,this.pongTimeout=null!==(s=t.pong_timeout)&&void 0!==s?s:5e3,this.reconnectInterval=null!==(a=null===(i=t.reconnect)||void 0===i?void 0:i.interval)&&void 0!==a?a:3e3,this.reconnectMaxInterval=null!==(u=null===(o=t.reconnect)||void 0===o?void 0:o.max_interval)&&void 0!==u?u:6e4,this.reconnectRetryCount=null!==(l=null===(c=t.reconnect)||void 0===c?void 0:c.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(d=null===(h=t.reconnect)||void 0===h?void 0:h.mul)&&void 0!==d?d:2,this.maxUnreadCountOnSuperGroup=null!==(p=t.max_unread_cnt_on_super_group)&&void 0!==p?p:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(f=t.concurrent_call_limit)&&void 0!==f?f:5,this.backOffDelay=null!==(_=t.back_off_delay)&&void 0!==_?_:100}return e.payloadify=function(e){return n(n({},ot.payloadify(e.user)),{emoji_hash:e.appInfo.emojiHash,file_upload_size_limit:e.appInfo.uploadSizeLimit,application_attributes:e.appInfo.applicationAttributes,premium_feature_list:e.appInfo.premiumFeatureList,login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=Ya.of(this._iid);r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}},r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new ut({userProfile:this}))},e}(),lt=function(e){function r(t,n,r){var s,i=this;return(i=e.call(this,t,n,r)||this).error=null,i.userProfile=new ct(t,r),i.key=r.key,i.ekey=null!==(s=r.ekey)&&void 0!==s?s:"",i.error=r.error?new p(r):null,i}return t(r,e),r.asError=function(e){return new r(null,"LOGI",n({user_id:null,error:!0},e))},r.prototype.applyTo=function(e){if(this.error)throw this.error;var t=Ya.of(e);if(!t)throw p.lostInstance;t.sessionManager.auth.sessionKey=this.key,Ue(e,this.ekey),this.userProfile.apply()},r}(B),ht=function(e){function n(t){var n=e.call(this)||this;return n.enabled=t,n}return t(n,e),n}(D),dt=function(e){function n(t,n){var r=n.sdkState,s=n.connectionHandlers,i=n.sessionManager,a=n.websocketClient,o=n.dispatcher,u=n.logger,c=n.entryState,l=void 0===c?new Me:c,h=e.call(this)||this;return h._currentState=null,h._loginTimer=null,h._connectingAt=0,h._connectionRequestQueue=[],h._iid=t,h.sdkState=r,h.connectionHandlers=s,h._sessionManager=i,h._websocketClient=a,h._dispatcher=o,h._logger=u,h._currentState=l,h._websocketClient.on("message",(function(e){if("LOGI"===e.code){h._loginTimer&&(clearTimeout(h._loginTimer),h._loginTimer=null);var t=e.as(lt);if(t.error)t.error.isSessionKeyExpiredError&&h._dispatcher.dispatch(new x),h._connectionRequestQueue.forEach((function(e){return e.reject(t.error)})),h._statLogConnection(t.error);else{t.applyTo(h._iid),h._connectionRequestQueue.forEach((function(e){return e.resolve()}));var n=t.userProfile;h._enableStatLog(n.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),h._statLogConnection(null)}h._connectionRequestQueue=[]}})).on("close",(function(){h._connectionRequestQueue.length>0&&(h._statLogConnection(p.networkError),h._connectionRequestQueue.forEach((function(e){return e.reject(p.networkError)})),h._connectionRequestQueue=[])})),h}return t(n,e),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._currentState=e,this._dispatcher.dispatch(new ce({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)];case 1:return t.sent(),[2]}}))}))},n.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,s=t.userId,i=t.extensions,a=this._sessionManager.auth,o=i.sb_syncmanager?"s".concat(i.sb_syncmanager):"",u=i.sb_uikit?"u".concat(i.sb_uikit):"",c="JS/c".concat(l.SDK_VERSION,"/").concat(o,"/").concat(u);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(l.OS_VERSION),"&sv=").concat(encodeURIComponent(l.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(a.hasSession?"&key=".concat(encodeURIComponent(a.sessionKey)):"&user_id=".concat(encodeURIComponent(s),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(c,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},n.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new ht(e))},n.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new q(new G({type:L.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},n.prototype.connect=function(e){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(s){return t=this._url(e),n=new Z,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){r._loginTimer=null,r._dispatcher.dispatch(lt.asError(p.loginTimeout))}),this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]}))}))},n.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(lt.asError(p.connectionRenew))},n.prototype.disconnect=function(){this._websocketClient.disconnect()},n.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},n}(U),pt=function(){function e(e,t){var n=t.sdkState,r=t.connectionHandlers,s=t.sessionManager,i=t.websocketClient,a=t.dispatcher,o=t.logger,u=t.disableAutoReconnect,c=void 0!==u&&u,l=this;this._context=null,this._logger=o,this._context=new dt(e,{sdkState:n,connectionHandlers:r,sessionManager:s,websocketClient:i,dispatcher:a,logger:o}),c||i.on("close",(function(){"foreground"===n.appState&&setTimeout((function(){l._logger.debug("try reconnect by websocket connection closed"),l.reconnect()}),100)}))}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===Y.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===Y.CONNECTING||e.type===Y.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onConnect(this._context,e)];case 1:return t.sent(),[2]}}))}))},e.prototype.reconnect=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}}))}))},e.prototype.background=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}}))}))},e}(),ft=function(e){function n(t){var n=t.deviceId,r=t.statLogs,s=e.call(this)||this;return s.method=h.POST,s.path="".concat(Be),s.params={device_id:n,log_entries:r.map((function(e){return G.payloadify(e)}))},s}return t(n,e),n}(P);!function(e){e[e.PENDING=0]="PENDING",e[e.ENABLED=1]="ENABLED",e[e.DISABLED=2]="DISABLED"}(at||(at={}));var _t,mt=function(){function e(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,s=e.baseLimit,i=void 0===s?100:s,a=e.maxLimit,o=void 0===a?1e3:a,u=e.minLimit,c=void 0===u?10:u;this.queue=[],this.enabledstate=at.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=M(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=i,this.limit=i,this.maxLimit=o,this.minLimit=c}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.enabledstate===at.ENABLED},enumerable:!1,configurable:!0}),e.prototype._save=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.store.set({key:this.key,value:{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return G.payloadify(e)})),generation:this.generation,lastFlushedAt:this.lastFlushedAt},generation:this.generation++})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype._flush=function(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,n.label=1;case 1:return n.trys.push([1,5,6,7]),(e=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length>0?(t=new ft({deviceId:this.deviceId,statLogs:e}),[4,this.requestQueue.send(t)]):[3,4];case 2:return n.sent(),this.queue=this.queue.slice(e.length),[4,this._save()];case 3:n.sent(),n.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return n.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}}))}))},e.prototype.init=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(s){switch(s.label){case 0:return this.key=e,this.cacheContext.localCacheEnabled?[4,this.cacheContext.store.get(this.key)]:[3,4];case 1:return(t=s.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map((function(e){return new G({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit?(n=Math.min(Math.floor(18e4*Math.random()),100),[4,me(n)]):[3,4]):[3,4];case 2:return s.sent(),[4,this._flush()];case 3:s.sent(),s.label=4;case 4:return this.dispatcher.on((function(e){if(e instanceof q){var t=e.statLog;r.put(t)}else e instanceof ht&&(r.enabledstate=e.enabled?at.ENABLED:at.DISABLED,r.isEnabled?r.queue.length>=r.limit&&r._flush():r.clear())})),[2]}}))}))},e.prototype.put=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.enabledstate===at.DISABLED?[3,3]:(this.queue.push(e),[4,this._save()]);case 1:return t.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}}))}))},e}();!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.DEBUG=2]="DEBUG",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR"}(_t||(_t={}));var vt,gt=function(){function e(){this.level=_t.WARN}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=_t.VERBOSE&&console.log.apply(console,o(["[verbose]"],a(e),!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=_t.DEBUG&&console.log.apply(console,o(["[debug]"],a(e),!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=_t.INFO&&console.log.apply(console,o(["[info]"],a(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=_t.WARN&&console.warn.apply(console,o(["[warn]"],a(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=_t.ERROR&&console.error.apply(console,o(["[error]"],a(e),!1))},e}(),yt=function(e){function r(t,n){var r,s,i,a=this;return(a=e.call(this,t)||this).replyCount=0,a.mostRepliedUsers=null,a.lastRepliedAt=0,a.updatedAt=0,a.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,a.mostRepliedUsers=n.hasOwnProperty("most_replies")&&E("object",n.most_replies)?n.most_replies.map((function(e){return new ot(a._iid,e)})):[],a.lastRepliedAt=null!==(s=n.last_replied_at)&&void 0!==s?s:0,a.updatedAt=null!==(i=n.updated_at)&&void 0!==i?i:0,a}return t(r,e),r.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{reply_count:t.replyCount,most_replies:Array.isArray(t.mostRepliedUsers)?t.mostRepliedUsers.map((function(e){return ot.payloadify(e)})):[],last_replied_at:t.lastRepliedAt,updated_at:t.updatedAt})):null},r}(De);!function(e){e.ADD="add",e.DELETE="delete"}(vt||(vt={}));var Et,bt,Nt=function(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=v("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,s=e.reaction,i=e.updated_at;t&&v("string",n)&&v("string",r)&&g(vt,r)&&v("string",s)&&s&&v("number",i)&&(this.messageId=t,this.userId=n,this.key=s,this.operation=r,this.updatedAt=i)},Tt=function(){function e(e){var t,n,r,s=e.key,u=null!==(r=o([],a(e.user_ids),!1))&&void 0!==r?r:[],c=e.updated_at;v("string",s)&&s&&E("string",u)&&u.length>0&&v("number",c)&&(this.key=s,this.userIds=u,this.updatedAt=c);var l={};try{for(var h=i(this.userIds),d=h.next();!d.done;d=h.next()){l[d.value]=this.updatedAt}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}this._version=l}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return e?O({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case vt.ADD:t<0&&this.userIds.push(e.userId);break;case vt.DELETE:t>=0&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}},e}(),It=function(){function e(e){this.key=e.key,this.value=E("string",e.value)?o([],a(e.value),!1):[]}return e.payloadify=function(e){var t;return e?O({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null},e}(),Ct=function(){function e(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return e?O({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null},e}(),St=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new Ct(e["og:image"]))}return e.payloadify=function(e){return e?O({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Ct.payloadify(e.defaultImage):null}):null},e}(),At=function(){function e(e){var t,n;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.payloadify=function(e){return e?O({name:e.name,volume:e.volume}):null},e}();!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled"}(Et||(Et={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(bt||(bt={}));var Mt,wt=function(e){switch(e){case ne.BASE:return"";case ne.USER:return"MESG";case ne.FILE:return"FILE";case ne.ADMIN:return"ADMM"}},Ut=function(e){function r(t,n){var r,s,i,a,o,u,c,l,h,d,p,f,_,m=this;(m=e.call(this,t)||this).channelUrl=null,m.channelType=ee.BASE,m.messageId=0,m.parentMessageId=null,m.parentMessage=null,m.silent=!1,m.isOperatorMessage=!1,m.messageType=ne.BASE,m.data=null,m.customType=null,m.mentionType=null,m.mentionedUsers=[],m.mentionedUserIds=[],m.mentionedMessageTemplate=null,m.threadInfo=null,m.reactions=[],m.metaArrays=[],m.ogMetaData=null,m.appleCriticalAlertOptions=null,m.createdAt=0,m.updatedAt=0,m.scheduledInfo=null,m._scheduledStatus=null,m.messageId=null!==(s=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==s?s:0,m.channelUrl=n.channel_url,m.channelType=g(ee,n.channel_type)?n.channel_type:ee.GROUP,n.channel&&(n.channel.channel_url&&(m.channelUrl=n.channel.channel_url),n.channel.channel_type&&(m.channelType=n.channel.channel_type)),m.parentMessageId=null!==(i="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==i?i:0,m.data=null!==(a=n.data)&&void 0!==a?a:"",m.customType=null!==(o=n.custom_type)&&void 0!==o?o:"",m.mentionType=g(ie,n.mention_type)?n.mention_type:null;var v=n.mentioned_users;m.mentionedUsers=v?v.map((function(e){return new ot(m._iid,e)})):null;var y=n.mentioned_user_ids;m.mentionedUserIds=null!=y?y:null,m.mentionedMessageTemplate=null!==(u=n.mentioned_message_template)&&void 0!==u?u:"",m.threadInfo=n.thread_info?new yt(m._iid,n.thread_info):null,m.reactions=n.reactions?n.reactions.map((function(e){return new Tt(e)})):[];for(var E=null!==(c=n.metaarray)&&void 0!==c?c:{},b=null!==(l=n.metaarray_key_order)&&void 0!==l?l:Object.keys(E).sort((function(e,t){return e.localeCompare(t)})),N=0;N<b.length;N++){var T=b[N];m.metaArrays.push(new It({key:T,value:E[T]||[]}))}return n.sorted_metaarray&&(m.metaArrays=n.sorted_metaarray.map((function(e){return new It(e)}))),m.ogMetaData=n.og_tag?new St(n.og_tag):null,m.silent=null!==(h=n.silent)&&void 0!==h&&h,m.isOperatorMessage=null!==(d=n.is_op_msg)&&void 0!==d&&d,m.appleCriticalAlertOptions=n.apple_critical_alert_options?new At(n.apple_critical_alert_options):null,m.createdAt=null!==(f=null!==(p=n.created_at)&&void 0!==p?p:n.ts)&&void 0!==f?f:0,m.updatedAt=null!==(_=n.updated_at)&&void 0!==_?_:0,n.scheduled_message_id&&n.scheduled_at&&n.scheduled_status&&(m.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},m._scheduledStatus=n.scheduled_status),m}return t(r,e),r.payloadify=function(t){var r,s,i,a;return t?O(n(n({},e.payloadify.call(this,t)),{channel_url:t.channelUrl,channel_type:t.channelType,message_id:t.messageId,type:wt(t.messageType),parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,mentioned_user_ids:t.mentionedUserIds,mentioned_users:null===(r=t.mentionedUsers)||void 0===r?void 0:r.map((function(e){return ot.payloadify(e)})),mentioned_message_template:t.mentionedMessageTemplate,thread_info:t.threadInfo?yt.payloadify(t.threadInfo):null,reactions:t.reactions.map((function(e){return Tt.payloadify(e)})),sorted_metaarray:null===(s=t.metaArrays)||void 0===s?void 0:s.map((function(e){return It.payloadify(e)})),og_tag:St.payloadify(t.ogMetaData),silent:t.silent,is_op_msg:t.isOperatorMessage,apple_critical_alert_options:At.payloadify(t.appleCriticalAlertOptions),created_at:t.createdAt,updated_at:t.updatedAt,scheduled_message_id:null===(i=t.scheduledInfo)||void 0===i?void 0:i.scheduledMessageId,scheduled_at:null===(a=t.scheduledInfo)||void 0===a?void 0:a.scheduledAt,scheduled_status:t._scheduledStatus})):null},r.prototype.isIdentical=function(e){return this.messageId===e.messageId},r.prototype.isEqual=function(e){return m(this,e)},r.prototype.isUserMessage=function(){return this.messageType===ne.USER},r.prototype.isFileMessage=function(){return this.messageType===ne.FILE},r.prototype.isAdminMessage=function(){return this.messageType===ne.ADMIN},r.prototype.serialize=function(){return rt(this)},r.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},r.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},r.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Tt(Tt.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},r.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},r}(De),Rt=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.role=null,r.isBlockedByMe=!1,r.role=g(te,n.role)?n.role:te.NONE,n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),r}return t(r,e),r.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{role:t.role,is_blocked_by_me:t.isBlockedByMe})):null},r}(ot),Dt=function(e){function r(t,n){var r,s,i,a=this;if((a=e.call(this,t,n)||this).sender=null,a.reqId="",a.replyToChannel=!1,a.sendingStatus=ue.PENDING,a.errorCode=0,a.sender=n.user?new Rt(a._iid,n.user):n.sender_id,a.reqId=null!==(r=n.req_id)&&void 0!==r?r:"",a.replyToChannel=null!==(s=n.is_reply_to_channel)&&void 0!==s&&s,a.sendingStatus=a.messageId>0?ue.SUCCEEDED:ue.FAILED,n.request_state&&g(ue,n.request_state)&&(a.sendingStatus=n.request_state),n.scheduled_status)switch(n.scheduled_status){case bt.SENT:case bt.IN_QUEUE:a.sendingStatus=ue.SUCCEEDED;break;case bt.PENDING:a.sendingStatus=ue.SCHEDULED;break;case bt.FAILED:case bt.REMOVED:a.sendingStatus=ue.FAILED;break;case bt.CANCELED:a.sendingStatus=ue.CANCELED}return a.errorCode=null!==(i=n.error_code)&&void 0!==i?i:0,a}return t(r,e),r.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{user:Rt.payloadify(t.sender),req_id:t.reqId,is_reply_to_channel:t.replyToChannel,request_state:t.sendingStatus,error_code:t.errorCode})):null},Object.defineProperty(r.prototype,"isResendable",{get:function(){return this.sendingStatus===ue.FAILED&&((e=this.errorCode)>0&&f.indexOf(e)>=0);var e},enumerable:!1,configurable:!0}),r.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},r}(Ut),Ot=function(){function e(){this.messageTypeFilter=re.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=ae.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case re.USER:if(e.messageType!==ne.USER)return!1;break;case re.FILE:if(e.messageType!==ne.FILE)return!1;break;case re.ADMIN:if(e.messageType!==ne.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof Dt))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case ae.NONE:if(e.parentMessageId>0)return!1;break;case ae.ONLY_REPLY_TO_CHANNEL:if(e instanceof Dt&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}(),Lt=function(e){function n(t){var n=e.call(this)||this;if(n.method=h.POST,n.path="".concat(Le),n.params=O({file:t.file,channel_url:t.channelUrl}),t.thumbnailSizes)for(var r=0;r<t.thumbnailSizes.length;r++){var s=t.thumbnailSizes[r],i=s.maxWidth,a=s.maxHeight;n.params["thumbnail".concat(r+1)]="".concat(i,",").concat(a)}return n.requestId=t.requestId,n}return t(n,e),n}(P),Pt=function(e){function n(t,n){var r,s,i,a=this;return(a=e.call(this,t,n)||this).url=n.url,a.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,a.thumbnailSizes=null!==(s=n.thumbnails)&&void 0!==s?s:[],a.requireAuth=null!==(i=n.require_auth)&&void 0!==i&&i,a}return t(n,e),n}(k),kt=function(){function e(e){var t,n;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height}return e.payloadify=function(e){return e?O({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),Ft={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:re.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},xt=function(e){return v("number",e.prevResultSize)&&v("number",e.nextResultSize)&&v("boolean",e.isInclusive)&&v("boolean",e.reverse)&&v("string",e.messageTypeFilter)&&g(re,e.messageTypeFilter)&&E("string",e.customTypesFilter,!0)&&E("string",e.senderUserIdsFilter,!0)&&v("boolean",e.includeMetaArray)&&v("boolean",e.includeReactions)&&v("boolean",e.includeParentMessageInfo)},qt=function(e){function i(t,r){var s,i,a,o,u=this;if((u=e.call(this,t,r)||this).message=null,u.translations={},u.message=null!==(s=r.message)&&void 0!==s?s:"",u.messageType=ne.ADMIN,u.translations=null!==(i=r.translations)&&void 0!==i?i:{},r.parent_message_info){var c=r.parent_message_info,l=n(n({},c),{file:c.file,url:null===(a=c.file)||void 0===a?void 0:a.url,require_auth:null===(o=c.file)||void 0===o?void 0:o.require_auth});u.parentMessage=Qt(t,l)}return u}return t(i,e),i.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,parent_message_info:Vt(t.parentMessage)})):null},i.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return t=n(n({},Ft),t),it(this.messageId>0&&v("number",e)&&xt(t)).throw(p.invalidParameters),[4,Mn.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return[2,r.sent()]}}))}))},i}(Ut),Ht=function(){function e(e){var t,n;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.hasOwnProperty("detail")&&v("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return e?O({type:e.type,vendor:e.vendor,detail:e.detail}):null},e}(),Gt=function(e){function a(t,r){var s,a,o,u,c,l,h,d=this;if((d=e.call(this,t,r)||this).message="",d.messageParams=null,d.translations={},d.translationTargetLanguages=[],d.messageSurvivalSeconds=-1,d.plugins=[],d.message=r.message,d.messageType=ne.USER,d.translations=null!==(o=r.translations)&&void 0!==o?o:{},d.translationTargetLanguages=null!==(u=r.target_langs)&&void 0!==u?u:[],d.translations==={}&&d.translationTargetLanguages.length>0)try{for(var p=i(d.translationTargetLanguages),f=p.next();!f.done;f=p.next()){var _=f.value;d.translations[_]=""}}catch(e){s={error:e}}finally{try{f&&!f.done&&(a=p.return)&&a.call(p)}finally{if(s)throw s.error}}if(d.messageSurvivalSeconds=null!==(c=r.message_survival_seconds)&&void 0!==c?c:-1,d.plugins=r.plugins?r.plugins.map((function(e){return new Ht(e)})):[],r.parent_message_info){var m=r.parent_message_info,v=n(n({},m),{file:m.file,url:null===(l=m.file)||void 0===l?void 0:l.url,require_auth:null===(h=m.file)||void 0===h?void 0:h.require_auth});d.parentMessage=Qt(t,v)}return d}return t(a,e),a.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,message_survival_seconds:t.messageSurvivalSeconds,plugins:t.plugins.map((function(e){return Ht.payloadify(e)})),parent_message_info:Vt(t.parentMessage)})):null},a.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return t=n(n({},Ft),t),it(this.messageId>0&&v("number",e)&&xt(t)).throw(p.invalidParameters),[4,Mn.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return[2,r.sent()]}}))}))},a}(Dt),Vt=function(e){if(e)switch(e.messageType){case ne.USER:return Gt.payloadify(e);case ne.FILE:return Bt.payloadify(e);case ne.ADMIN:return qt.payloadify(e)}return null},Qt=function(e,t){switch(t.type){case"MESG":return new Gt(e,t);case"FILE":return new Bt(e,t);case"ADMM":case"BRDM":return new qt(e,t)}return null},Bt=function(e){function i(t,r){var s,i,a,o,u,c,l,h,d,p,f,_,m,v,g,y=this;(y=e.call(this,t,r)||this).messageParams=null,y.plainUrl="",y.requireAuth=!1,y.name=null,y.size=0,y.type=null,y.thumbnails=[],y.messageSurvivalSeconds=-1,y.messageType=ne.FILE;var E=null!==(s=r.file)&&void 0!==s?s:null;if(y.plainUrl=(null!==(a=null!==(i=null==E?void 0:E.url)&&void 0!==i?i:r.url)&&void 0!==a?a:"").split("?auth=")[0],y.name=null!==(u=null!==(o=null==E?void 0:E.name)&&void 0!==o?o:r.name)&&void 0!==u?u:"File",y.size=null!==(l=null!==(c=null==E?void 0:E.size)&&void 0!==c?c:r.size)&&void 0!==l?l:0,y.data=null!==(d=null!==(h=null==E?void 0:E.data)&&void 0!==h?h:r.custom)&&void 0!==d?d:"",y.type=E?null!==(p=E.type)&&void 0!==p?p:"":null!==(f=r.type)&&void 0!==f?f:"",y.requireAuth=null!==(_=r.require_auth)&&void 0!==_&&_,y.thumbnails=r.thumbnails?r.thumbnails.map((function(e){return new kt(n(n({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(y.requireAuth?"?auth=".concat(Ue(y._iid)):"")}))})):[],y.messageSurvivalSeconds=null!==(m=r.message_survival_seconds)&&void 0!==m?m:-1,r.parent_message_info){var b=r.parent_message_info,N=n(n({},b),{file:b.file,url:null===(v=b.file)||void 0===v?void 0:v.url,require_auth:null===(g=b.file)||void 0===g?void 0:g.require_auth});y.parentMessage=Qt(t,N)}return y}return t(i,e),i.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{url:t.plainUrl,require_auth:t.requireAuth,file:{name:t.name,size:t.size,type:t.type,data:t.data},thumbnails:t.thumbnails.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:t.messageSurvivalSeconds,parent_message_info:Vt(t.parentMessage)})):null},Object.defineProperty(i.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(Ue(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),i.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return t=n(n({},Ft),t),it(this.messageId>0&&v("number",e)&&xt(t)).throw(p.invalidParameters),[4,Mn.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return[2,r.sent()]}}))}))},i}(Dt),jt=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,a=t.logger;t.onlineDetector;var o=t.cacheContext,u=void 0===o?null:o;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=s,this._requestQueue=i,this._logger=a},e}(),zt=function(){function e(){this._onPending=W,this._onFailed=W,this._onSucceeded=W}return e.prototype._trigger=function(e,t){switch(t.sendingStatus){case ue.PENDING:this._onPending(t);break;case ue.FAILED:case ue.CANCELED:this._onFailed(e,t.isResendable?t:null);break;case ue.SUCCEEDED:this._onSucceeded(t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),Kt=function(e){function n(t,n){var r=e.call(this,t)||this;r.threadInfo=null,r.targetMessageId=0,r.channelUrl=null,r.channelType=null;var s=n.thread_info,i=n.root_message_id,a=n.channel_url,o=n.channel_type;return s&&v("object",s)&&v("number",i)&&v("string",a)&&v("string",o)&&(r.threadInfo=new yt(t,s),r.targetMessageId=i,r.channelUrl=a,r.channelType=o),r}return t(n,e),n}(De),Wt={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,includePollDetails:!1},Yt=function(){function e(e,t){var n;this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return v("number",this.limit)&&this.limit>0},e}(),Jt=function(e){function n(t){var n=t.channelCustomType,r=t.keyword,s=t.limit,i=t.reverse,a=t.exactMatch,o=t.channelUrl,u=t.order,c=t.messageTimestampFrom,l=t.messageTimestampTo,d=t.advancedQuery,p=t.targetFields,f=t.nextToken,_=e.call(this)||this;return _.method=h.GET,_.path="".concat(qe,"/messages"),_.params={custom_type:n,query:r,limit:s,reverse:i,exact_match:a,channel_url:o,message_ts_from:c,message_ts_to:l,sort_field:u,advanced_query:d,target_fields:p,after:f},_}return t(n,e),n}(P),Xt=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return Qt(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r}return t(n,e),n}(k);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(Mt||(Mt={}));var Zt,$t=function(e){function i(t,n){var r,s,i,a,o,u,c,l,h,d=this;return(d=e.call(this,t,n)||this).keyword="",d.reverse=!1,d.exactMatch=!1,d.channelUrl="",d.channelCustomType="",d.messageTimestampFrom=null,d.messageTimestampTo=null,d.order=Mt.SCORE,d.advancedQuery=!1,d.targetFields=null,d._nextToken="",d.keyword=n.keyword,d.reverse=null!==(r=n.reverse)&&void 0!==r&&r,d.exactMatch=null!==(s=n.exactMatch)&&void 0!==s&&s,d.channelUrl=null!==(i=n.channelUrl)&&void 0!==i?i:"",d.channelCustomType=null!==(a=n.channelCustomType)&&void 0!==a?a:"",d.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,d.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,d.order=null!==(c=n.order)&&void 0!==c?c:Mt.SCORE,d.advancedQuery=null!==(l=n.advancedQuery)&&void 0!==l&&l,d.targetFields=null!==(h=n.targetFields)&&void 0!==h?h:null,d}return t(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)&&v("string",this.keyword)&&this.keyword.length>0&&v("boolean",this.reverse)&&v("boolean",this.exactMatch)&&v("string",this.channelUrl)&&v("string",this.channelCustomType)&&(v("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(v("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&g(Mt,this.order)&&v("boolean",this.advancedQuery)&&E("string",this.targetFields,!0)},i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=Ya.of(this._iid).requestQueue,t=new Jt(n(n({},this),{nextToken:this._nextToken?this._nextToken:null})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=s.sent(),i=r.as(Xt),a=i.messages,o=i.hasNext,u=i.nextToken,this._nextToken=u,this._hasNext=o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},i}(Yt),en=function(e){function n(t,n,r,s){var i=e.call(this,t,s)||this;return i.channelUrl=n,i.channelType=r,i}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&v("string",this.channelUrl)&&g(ee,this.channelType)},n}(Yt),tn=function(e){function n(t,n,r,s){var i,a,o,u,c,l,h,d,p,f,_=this;return(_=e.call(this,t,n,r,s)||this).reverse=!1,_.messageTypeFilter=re.ALL,_.customTypesFilter=null,_.senderUserIdsFilter=null,_.replyType=ae.NONE,_.includeMetaArray=!1,_.includeReactions=!1,_.includeParentMessageInfo=!1,_.includeThreadInfo=!1,_.showSubchannelMessagesOnly=!1,_._edge=Number.MAX_SAFE_INTEGER,_.reverse=null!==(i=s.reverse)&&void 0!==i&&i,_.messageTypeFilter=null!==(a=s.messageTypeFilter)&&void 0!==a?a:re.ALL,_.customTypesFilter=null!==(o=s.customTypesFilter)&&void 0!==o?o:null,_.senderUserIdsFilter=null!==(u=s.senderUserIdsFilter)&&void 0!==u?u:null,_.replyType=null!==(c=s.replyType)&&void 0!==c?c:ae.NONE,_.includeMetaArray=null!==(l=s.includeMetaArray)&&void 0!==l&&l,_.includeReactions=null!==(h=s.includeReactions)&&void 0!==h&&h,_.includeParentMessageInfo=null!==(d=s.includeParentMessageInfo)&&void 0!==d&&d,_.includeThreadInfo=null!==(p=s.includeThreadInfo)&&void 0!==p&&p,_.showSubchannelMessagesOnly=null!==(f=s.showSubchannelMessagesOnly)&&void 0!==f&&f,_}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&v("boolean",this.reverse)&&g(re,this.messageTypeFilter)&&g(ae,this.replyType)&&E("string",this.customTypesFilter,!0)&&E("string",this.senderUserIdsFilter,!0)&&v("boolean",this.includeMetaArray)&&v("boolean",this.includeReactions)&&v("boolean",this.includeParentMessageInfo)&&v("boolean",this.includeThreadInfo)&&v("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Mn.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,o([Number.MAX_SAFE_INTEGER],a(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},n}(en),nn={channelUrl:null,scheduledMessageId:0},rn=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="message",t}return t(i,e),i.prototype.init=function(t,n){var r=n.sdkState,s=n.dispatcher,i=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:s,sessionManager:i,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new Mn(t,{sdkState:r,dispatcher:s,requestQueue:a,onlineDetector:u,cacheContext:c})},i.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},i.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},i.prototype.getMessage=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return e=n(n({},Wt),e),it(function(e){return v("string",e.channelUrl)&&v("string",e.channelType)&&g(ee,e.channelType)&&v("number",e.messageId)&&v("boolean",e.includeMetaArray)&&v("boolean",e.includeParentMessageInfo)&&v("boolean",e.includeThreadInfo)&&v("boolean",e.includePollDetails)}(e)).throw(p.invalidParameters),[2,this._manager.getMessage(e)]}))}))},i.prototype.getScheduledMessage=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return e=n(n({},nn),e),it(function(e){return v("string",e.channelUrl)&&v("number",e.scheduledMessageId)}(e)).throw(p.invalidParameters),[2,this._manager.getScheduledMessage(e)]}))}))},i}(jt),sn=function(e){function n(t){var n,r,s,i=[];return t.mentionType===ie.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"FILE",ackRequired:!0,payload:O({channel_url:t.channelUrl,url:t.url,name:null!==(n=t.fileName)&&void 0!==n?n:"",type:null!==(r=t.mimeType)&&void 0!==r?r:"",size:null!==(s=t.fileSize)&&void 0!==s?s:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:i,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==oe.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,is_reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId})})||this}return t(n,e),n}(j),an=function(e){function n(t){var n,r=this;r=e.call(this)||this;var s=[];return t.mentionType===ie.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId})))),r.method=h.POST,r.path="".concat(ze(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),r.params=O({message_type:ne.FILE,user_id:t.userId,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:s,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes.map((function(e){return kt.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return It.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,apple_critical_alert_options:At.payloadify(t.appleCriticalAlertOptions),reply_to_channel:t.isReplyToChannel,req_id:t.reqId}),r}return t(n,e),n}(P),on=function(e){function n(t,n,r){var s,i,a,o=this;(o=e.call(this,t,"FILE",r)||this).message=new Bt(t,r);var u=Ya.of(t).sdkState;return o.isMentioned=We(o.message.mentionType,null!==(s=o.message.mentionedUserIds)&&void 0!==s?s:null===(i=o.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return t(n,e),n}(B),un=function(e){function n(t,n){var r,s,i=this;(i=e.call(this,t,n)||this).message=new Bt(t,n);var a=Ya.of(t).sdkState;return i.isMentioned=We(i.message.mentionType,null!==(r=i.message.mentionedUserIds)&&void 0!==r?r:i.message.mentionedUsers.map((function(e){return e.userId})),a.userId),i.forceUpdateLastMessage=null!==(s=n.force_update_last_message)&&void 0!==s&&s,i}return t(n,e),n}(k);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(Zt||(Zt={}));var cn,ln=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,s=t.requestQueue,i=t.onlineDetector,a=t.cacheContext,o=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=s,this._cacheContext=a,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof ce&&(o._connectionState=e.stateType)})),this._onlineDetector=i}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===Y.CONNECTED||this._connectionState===Y.CONNECTING||this._connectionState===Y.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return this._shouldSendThroughWebSocket?(r=new sn(n(n({channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(r)]):[3,2];case 1:return i=s.sent(),[2,i.as(on).message];case 2:return r=new an(n(n({channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,userId:this._sdkState.userId,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),[2,i.as(un).message]}}))}))},e.prototype._resolveMessageQueue=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,c,l,h,d,f,_,m;return s(this,(function(s){switch(s.label){case 0:if(!(t=this._queueMap.get(e.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,s.label=1;case 1:s.trys.push([1,15,16,17]),a=i(t.messageQueue),o=a.next(),s.label=2;case 2:if(o.done)return[3,14];switch(c=o.value,c.state){case Zt.PENDING:case Zt.UPLOADING:return[3,3];case Zt.UPLOADED:return[3,4];case Zt.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(c),[3,13];case 4:if(!r)return[3,10];s.label=5;case 5:return s.trys.push([5,8,,9]),c.state=Zt.SENDING,[4,this._sendFileMessage(e,c)];case 6:return l=s.sent(),c.deferred.resolve(l),[4,me(100)];case 7:return s.sent(),[3,9];case 8:return h=s.sent(),c.deferred.reject(h),[3,9];case 9:return[3,11];case 10:n.push(c),s.label=11;case 11:return[3,13];case 12:return c.deferred.reject(c.error.code===u.REQUEST_CANCELED?p.fileUploadCanceled:c.error),[3,13];case 13:return o=a.next(),[3,2];case 14:return[3,17];case 15:return d=s.sent(),_={error:d},[3,17];case 16:try{o&&!o.done&&(m=a.return)&&m.call(a)}finally{if(_)throw _.error}return[7];case 17:return f=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,f?[4,this._resolveMessageQueue(e)]:[3,19];case 18:s.sent(),s.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,s.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c,l,h,d,f,_,m;return s(this,(function(s){switch(s.label){case 0:return t=this._queueMap.get(e.url),(n=t.messageQueue.find((function(e){return e.state===Zt.PENDING})))?N(n.params.file)?t.uploadQueue.length<6?(n.state=Zt.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!s.sent())return[3,8];s.label=2;case 2:return s.trys.push([2,4,5,7]),r=new Lt({file:n.params.file,channelUrl:e.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),a=i.as(Pt),o=a.url,u=a.fileSize,c=void 0===u?n.params.fileSize:u,l=a.thumbnailSizes,h=void 0===l?n.params.thumbnailSizes:l,d=a.requireAuth,f=void 0!==d&&d,n.params.fileUrl=o,n.params.fileSize=c,n.params.thumbnailSizes=h,n.params.requireAuth=f,n.requireAuth=f,n.state=Zt.UPLOADED,[3,7];case 4:return _=s.sent(),n.state=Zt.FAILED,n.error=_,[3,7];case 5:return(m=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(m,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 6:return s.sent(),[7];case 7:return[3,10];case 8:return n.state=Zt.FAILED,n.error=p.connectionRequired,(m=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(m,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=Zt.UPLOADED,[4,this._resolveMessageQueue(e)];case 12:s.sent(),s.label=13;case 13:return[2]}}))}))},e.prototype.request=function(e,t,n){var i,a,o;return r(this,void 0,void 0,(function(){var r;return s(this,(function(s){return r=new Z,N(n.file)&&(n.fileName=null!==(i=n.fileName)&&void 0!==i?i:n.file.name,n.mimeType=null!==(a=n.mimeType)&&void 0!==a?a:n.file.type,n.fileSize=null!==(o=n.fileSize)&&void 0!==o?o:n.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:t,params:n,state:Zt.PENDING,deferred:r,requireAuth:n.requireAuth}),this._uploadNextPendingItem(e),[2,r.promise]}))}))},e.prototype.cancel=function(e,t){var n,r;void 0===t&&(t=null);var s=this._queueMap.get(e.url);if(s){var u=t?[s.messageQueue.find((function(e){return e.requestId===t}))]:o([],a(s.messageQueue),!1);try{for(var c=i(u),l=c.next();!l.done;l=c.next()){var h=l.value;if(h)switch(h.state){case Zt.PENDING:h.state=Zt.FAILED,h.error=p.requestCanceled,this._resolveMessageQueue(e);break;case Zt.UPLOADING:this._requestQueue.cancel(h.requestId)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},e}(),hn={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:re.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:ae.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},dn={replyType:ae.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includePollDetails:!1},pn=function(e){return g(ae,e.replyType)&&v("boolean",e.includeReactions)&&v("boolean",e.includeMetaArray)&&v("boolean",e.includeParentMessageInfo)&&v("boolean",e.includeThreadInfo)&&v("boolean",e.includePollDetails)};!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"}(cn||(cn={}));var fn,_n=function(e){return e.startsWith("EVENT_")||e===cn.SYNC_MESSAGE_FILL||e===cn.SYNC_MESSAGE_CHANGELOGS},mn=function(e){function n(t){var n=t.messages,r=t.source,s=e.call(this)||this;return s.messages=n,s.source=r,s}return t(n,e),n}(D),vn=function(e){function n(t){var n=t.messageIds,r=t.source,s=e.call(this)||this;return s.messageIds=n,s.source=r,s}return t(n,e),n}(D),gn=function(e){function n(t){var n=t.reqId,r=t.source,s=e.call(this)||this;return s.reqId=n,s.source=r,s}return t(n,e),n}(D),yn=function(e){function n(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,i=t.includeMetaArray,a=t.includeReactions,o=t.includeThreadInfo,u=t.includeParentMessageInfo,c=t.includePollDetails,l=e.call(this)||this;return l.method=h.GET,l.path="".concat(ze(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:i,include_reactions:a,include_thread_info:o,include_parent_message_info:u,include_poll_details:c},l}return t(n,e),n}(P),En=function(e){function r(t,r){var s=e.call(this,t,r)||this;return s.message=r?Qt(t,n({},r)):null,s}return t(r,e),r}(k),bn=function(e){function n(t){var n=t.channelType,r=t.channelUrl,s=t.timestamp,i=void 0===s?null:s,a=t.token,o=void 0===a?null:a,u=t.prevResultSize,c=t.nextResultSize,l=t.isInclusive,d=t.reverse,p=t.messageTypeFilter,f=t.customTypesFilter,_=t.senderUserIdsFilter,m=t.replyType,v=t.includeMetaArray,g=t.includeReactions,y=t.parentMessageId,E=t.includeThreadInfo,b=t.includeParentMessageInfo,N=t.showSubchannelMessagesOnly,T=t.includePollDetails,I=e.call(this)||this;return I.method=h.GET,I.path="".concat(ze(n),"/").concat(encodeURIComponent(r),"/messages"),I.params=O({is_sdk:!0,prev_limit:u,next_limit:c,include:l,reverse:d,message_ts:i,message_id:o,message_type:null!=p?p:null,custom_types:f,sender_ids:_,include_reply_type:m,with_sorted_meta_array:v,include_reactions:g,parent_message_id:y,include_thread_info:E,include_parent_message_info:b,show_subchannel_message_only:N,include_poll_details:T}),I}return t(n,e),n}(P),Nn=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.messages.map((function(e){return Qt(t,e)})),r}return t(n,e),n}(k),Tn=function(e){function n(t){var n=t.channelType,r=t.channelUrl,s=t.timestamp,i=t.token,a=t.replyType,o=t.includeMetaArray,u=t.includeReactions,c=t.includeThreadInfo,l=t.includeParentMessageInfo,d=t.includePollDetails,p=e.call(this)||this;return p.method=h.GET,p.path="".concat(ze(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),p.params={change_ts:s,token:i,with_sorted_meta_array:o,include_reactions:u,include_thread_info:c,include_reply_type:a,include_parent_message_info:l,include_poll_details:d},p}return t(n,e),n}(P),In=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return Qt(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return t(n,e),n}(k),Cn=function(e){function n(t){var n=t.channelUrl,r=t.scheduledMessageId,s=e.call(this)||this;return s.method=h.GET,s.path="".concat(Pe,"/").concat(encodeURIComponent(n),"/scheduled_messages/").concat(encodeURIComponent(r)),s.params={},s}return t(n,e),n}(P),Sn=function(e){function r(t,r){var s=e.call(this,t,r)||this;return s.message=r?Qt(t,n({},r)):null,s}return t(r,e),r}(k),An={},Mn=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,s=t.requestQueue,i=t.onlineDetector,a=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=s,this._dispatcher=r,this._onlineDetector=i,this._cacheContext=a,this.fileMessageQueue=new ln(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:i,cacheContext:a}),An[e]=this}return e.of=function(e){return An[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=st(e);switch(t.messageType){case ne.USER:return new Gt(this._iid,Gt.payloadify(t));case ne.FILE:return new Bt(this._iid,Bt.payloadify(t));case ne.ADMIN:return new qt(this._iid,qt.payloadify(t))}return null},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return O({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations)})},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return O({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})},e.prototype.buildSenderFromSerializedData=function(e){var t=st(e);return new Rt(this._iid,Rt.payloadify(t))},e.prototype.getMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=new yn(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(En).message]}}))}))},e.prototype.getScheduledMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=new Cn(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Sn).message]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,i,a,o){return void 0===o&&(o=cn.REQUEST_MESSAGE),r(this,void 0,void 0,(function(){var r,u,c;return s(this,(function(s){switch(s.label){case 0:return r=new bn(n(n({channelType:t,channelUrl:e,timestamp:i},hn),a)),[4,this._requestQueue.send(r)];case 1:return u=s.sent(),c=u.as(Nn).messages,this._dispatcher.dispatch(new mn({messages:c,source:o})),[2,c]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,i,a){return void 0===a&&(a=cn.REQUEST_THREADED_MESSAGE),r(this,void 0,void 0,(function(){var r,o,u,c;return s(this,(function(s){switch(s.label){case 0:return r=new bn(n(n(n({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},Ft),i),{replyType:ae.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(r)];case 1:return o=s.sent(),u=o.as(Nn).messages,c=u.slice(1),this._dispatcher.dispatch(new mn({messages:c,source:a})),[2,{parentMessage:u[0],threadedMessages:c}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,i,a,o){return void 0===o&&(o=cn.REQUEST_MESSAGE_CHANGELOGS),r(this,void 0,void 0,(function(){var r,u,c,l,h,d,p,f;return s(this,(function(s){switch(s.label){case 0:return r=new Tn(O(n(n({channelType:t,channelUrl:e,timestamp:"number"==typeof i?i:null,token:"string"==typeof i?i:null},dn),a))),[4,this._requestQueue.send(r)];case 1:return u=s.sent(),c=u.as(In),l=c.updatedMessages,h=c.deletedMessagesInfo,d=c.hasMore,p=c.nextToken,f=h.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new mn({messages:l,source:o})),f.length>0&&this._dispatcher.dispatch(new vn({messageIds:f,source:o})),[2,{updatedMessages:l,deletedMessageIds:f,hasMore:d,token:p}]}}))}))},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(fn||(fn={}));var wn,Un=function(e){switch(e){case fn.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case fn.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Rn={data:null,customType:null,mentionType:ie.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Dn=function(e){return v("string",e.data,!0)&&v("string",e.customType,!0)&&g(ie,e.mentionType)&&E("string",e.mentionedUserIds,!0)&&E(ot,e.mentionedUsers,!0)&&v("string",e.mentionedMessageTemplate,!0)&&E(It,e.metaArrays,!0)&&v("number",e.parentMessageId,!0)&&v("boolean",e.isReplyToChannel)&&g(oe,e.pushNotificationDeliveryOption,!0)&&v(At,e.appleCriticalAlertOptions,!0)},On=n(n({},Rn),{message:null,translationTargetLanguages:null}),Ln=function(e){return Dn(e)&&v("string",e.message)&&E("string",e.translationTargetLanguages,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(wn||(wn={}));var Pn,kn,Fn,xn=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},qn=function(e){return e===wn.BLOB||e===wn.FILE},Hn=n(n({},Rn),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),Gn=function(e){return Dn(e)&&(N(e.file)||v("string",e.fileUrl))&&v("string",e.fileName,!0)&&v("string",e.mimeType,!0)&&v("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return v("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Vn="UnsentMessage",Qn="reqId",Bn={},jn=function(e){function a(t,n){var r=n.sdkState,s=n.cacheContext,i=e.call(this,t)||this;return i._sdkState=r,i._cacheContext=s,Bn[t]=i,i}return t(a,e),a.of=function(e){return Bn[e]},Object.defineProperty(a.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),a.prototype._serialize=function(e){if(e.messageId>0)throw p.invalidParameters;var t,r=n({},e.serialize());return e instanceof Gt?r.messageParams=(t=e.messageParams)?{isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption}:null:e instanceof Bt&&(r.messageParams=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null}(e.messageParams)),r},a.prototype._deserialize=function(e){return e?(e=n(n({},e),{messageId:parseInt(e.messageId)}),Mn.of(this._iid).buildMessageFromSerializedData(e)):null},a.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,null]}}))}))},a.prototype.fetch=function(e){var t=e.channelUrl,n=void 0===t?null:t,i=e.filter,a=void 0===i?new Ot:i,o=e.order,u=void 0===o?fn.CHANNEL_LATEST:o,c=e.sendingStatus,l=void 0===c?null:c,h=e.backward,d=void 0!==h&&h,p=e.parentMessageId,f=void 0===p?null:p;return r(this,void 0,void 0,(function(){var e,t,i,o,c=this;return s(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=Un(u),t={"/where":function(e){return!!(u!==fn.NEWEST_CHILD_MESSAGE||f&&0!==e.parentMessageId&&e.parentMessageId===f)&&a.match(c._deserialize(e))}},n&&(t.channelUrl=n),l&&(t.sendingStatus=l),i={where:t,index:e,backward:d},[4,this.collection.query(i)]):[3,3];case 1:return[4,h.sent().fetch({})];case 2:return o=h.sent(),[2,Promise.all(o.map((function(e){return r(c,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=this._deserialize(e),(n=e.messageParams)?(r=Mn.of(this._iid),t instanceof Gt?(t.messageParams=r.buildUserMessageCreateParamsFromSerializedData(n,t),[3,4]):[3,1]):[3,4];case 1:return t instanceof Bt?n.fileKey&&"string"==typeof n.fileKey&&qn(n.fileType)?(i=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:i.file=s.sent(),s.label=3;case 3:t.messageParams=r.buildFileMessageCreateParamsFromSerializedData(n,t),s.label=4;case 4:return[2,t]}}))}))})))];case 3:return[2,[]]}}))}))},a.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ot),r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:fn.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},a.prototype.upsert=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,3];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},a.prototype.upsertChildMessages=function(e){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},a.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,u;return s(this,(function(s){switch(s.label){case 0:if(!this.localCacheEnabled)return[3,8];s.label=1;case 1:s.trys.push([1,6,7,8]),t=i(e),n=t.next(),s.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:s.sent(),s.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return a=s.sent(),o={error:a},[3,8];case 7:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))},a.prototype.removeMessagesOfChannel=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},a.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},a.prototype.saveBlobs=function(e){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return e instanceof Bt&&e.messageParams&&((t=e.messageParams).file&&xn(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,t.fileType=wn.BLOB,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},a}(De);!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(Pn||(Pn={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(kn||(kn={})),function(e){e.CREATED_AT="created_at",e.SCHEDULED_AT="scheduled_at"}(Fn||(Fn={}));var zn,Kn,Wn,Yn,Jn,Xn,Zn,$n,er=function(e){switch(e){case Pn.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case Pn.CHRONOLOGICAL:return["-createdAt","syncIndex"];case Pn.CHANNEL_NAME_ALPHABETICAL:return["name"]}};!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(zn||(zn={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Kn||(Kn={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(Wn||(Wn={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(Yn||(Yn={})),function(e){e.ALL="all",e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Jn||(Jn={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(Xn||(Xn={})),function(e){e.AND="AND",e.OR="OR"}(Zn||(Zn={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}($n||($n={}));var tr,nr=function(){function e(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=Kn.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=Wn.ALL,this.publicChannelFilter=zn.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Yn.ALL,this.hiddenChannelFilter=Jn.UNHIDDEN,this.includeFrozen=!0}return e.prototype._isFriend=function(e){return!!e.friendDiscoveryKey||!!e.friendName},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=Zn.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t=new e;this.searchFilter&&t.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&t.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,s=n.fields;if(r&&s&&s.length>0&&!s.some((function(t){switch(t){case $n.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case $n.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,u=i.userIds,c=i.includeMode,l=i.queryType,h=e.members.map((function(e){return e.userId}));if(c){if(u.length>0)switch(l){case Zn.AND:if(u.some((function(e){return!h.includes(e)})))return!1;break;case Zn.OR:if(u.every((function(e){return!h.includes(e)})))return!1}}else{if(u.includes(t)||u.push(t),e.members.length>u.length)return!1;if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=o([],a(e),!1).sort(),r=o([],a(t),!1).sort(),s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}(u,h))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var d=this.nicknameContainsFilter.toLowerCase();if(e.members.every((function(e){return!e.nickname.toLowerCase().includes(d)})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.memberStateFilter)switch(this.memberStateFilter){case Kn.JOINED:if("joined"!==e.myMemberState)return!1;break;case Kn.INVITED:if("invited"!==e.myMemberState)return!1;break;case Kn.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case Kn.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1;break;case Kn.ALL:if("none"===e.myMemberState)return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case Jn.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case Jn.HIDDEN:if(!e.isHidden)return!1;break;case Jn.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case Jn.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===Yn.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case zn.PUBLIC:if(!e.isPublic)return!1;break;case zn.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case Wn.SUPER:if(!e.isSuper)return!1;break;case Wn.NON_SUPER:if(e.isSuper)return!1}return!0},e}(),rr=100,sr="GroupChannel",ir="url",ar="Message",or="messageId",ur=function(e){function u(t,n){var r=n.sdkState,s=n.cacheContext,i=e.call(this,t)||this;return i._channels=new Map,i._sdkState=r,i._cacheContext=s,i}return t(u,e),Object.defineProperty(u.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("GroupChannel"):null},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),u.prototype._serialize=function(e,t){return void 0===t&&(t=0),n(n({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},u.prototype._deserialize=function(e){return za.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(u.prototype,"channels",{get:function(){return o([],a(this._channels.values()),!1)},enumerable:!1,configurable:!0}),u.prototype.isCachedInMemory=function(e){return this._channels.has(e)},u.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,null];case 3:return[2,this._channels.get(e)]}}))}))},u.prototype.fetch=function(e){var t=e.token,n=e.limit,i=void 0===n?100:n,a=e.backward,o=void 0!==a&&a,u=e.filter,c=void 0===u?new nr:u,l=e.order,h=void 0===l?Pn.LATEST_LAST_MESSAGE:l;return r(this,void 0,void 0,(function(){var e,n,r,a,u=this;return s(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(e=er(h),n={where:function(e){if(t)switch(h){case Pn.CHANNEL_NAME_ALPHABETICAL:if(!o&&e.name.localeCompare(t)<0||o&&e.name.localeCompare(t)>0)return!1;break;case Pn.CHRONOLOGICAL:if(!o&&e.createdAt>t||o&&e.createdAt<t)return!1;break;case Pn.LATEST_LAST_MESSAGE:if(!o&&e.lastMessageUpdatedAt>t||o&&e.lastMessageUpdatedAt<t)return!1}return c.match(u._deserialize(e),u._sdkState.userId)},index:e,backward:o},[4,this.collection.query(n)]):[3,3];case 1:return[4,s.sent().fetch({limit:i})];case 2:return r=s.sent(),(a=r.map((function(e){return u._deserialize(e)}))).forEach((function(e){u._channels.has(e.url)||u._channels.set(e.url,e)})),[2,a];case 3:return[2,[]]}}))}))},u.prototype.upsert=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(s){switch(s.label){case 0:if(e.forEach((function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);Object.assign(t,e,{_iid:r._iid})}else r._channels.set(e.url,e)})),!this.localCacheEnabled)return[3,2];for(n in t=[],e)t.push(this._serialize(e[n],parseInt(n)));return[4,this.collection.upsertMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},u.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,u;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),t=i(e),n=t.next(),s.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:s.sent(),s.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return a=s.sent(),o={error:a},[3,7];case 6:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 7:return[2]}}))}))},u.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},u.prototype.clearMemoryCache=function(){this._channels.clear()},u.prototype._setBlockStateOfAllChannels=function(e,t,n){return r(this,void 0,void 0,(function(){var r,a,o,u,c,l,h,d,p,f,_,m,v,g,y,E,b,N,T;return s(this,(function(s){switch(s.label){case 0:if(r=[],e===this._sdkState.userId)try{for(a=i(this._channels.values()),o=a.next();!o.done;o=a.next()){d=o.value;try{for(g=void 0,u=i(d.members),c=u.next();!c.done;c=u.next())if((_=c.value).userId===t){_.isBlockedByMe=n,r.push(d);break}}catch(e){g={error:e}}finally{try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(g)throw g.error}}}}catch(e){m={error:e}}finally{try{o&&!o.done&&(v=a.return)&&v.call(a)}finally{if(m)throw m.error}}else if(t===this._sdkState.userId)try{for(l=i(this._channels.values()),h=l.next();!h.done;h=l.next()){d=h.value;try{for(N=void 0,p=i(d.members),f=p.next();!f.done;f=p.next())if((_=f.value).userId===e){_.isBlockingMe=n,r.push(d);break}}catch(e){N={error:e}}finally{try{f&&!f.done&&(T=p.return)&&T.call(p)}finally{if(N)throw N.error}}}}catch(e){E={error:e}}finally{try{h&&!h.done&&(b=l.return)&&b.call(l)}finally{if(E)throw E.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},u.prototype.block=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},u.prototype.unblock=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},u.prototype.markAsRead=function(e,t){return void 0===t&&(t=o([],a(this._channels.keys()),!1)),r(this,void 0,void 0,(function(){var n,r,a,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:n=[],s.label=1;case 1:s.trys.push([1,6,7,8]),r=i(t),a=r.next(),s.label=2;case 2:return a.done?[3,5]:(o=a.value,[4,this.get(o)]);case 3:(u=s.sent())._updateUnreadMemberState(this._sdkState.userId,e)&&(u._updateUnreadCount(0,0),n.push(u)),s.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return c=s.sent(),l={error:c},[3,8];case 7:try{a&&!a.done&&(h=r.return)&&h.call(r)}finally{if(l)throw l.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[2]}}))}))},u}(De),cr={},lr=function(e){function a(t,n){var r=n.sdkState,s=n.cacheContext,i=n.unsentMessageCache,a=e.call(this,t)||this;return a._sdkState=r,a._cacheContext=s,a._unsentMessageCache=i,cr[t]=a,a}return t(a,e),a.of=function(e){return cr[e]},Object.defineProperty(a.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e?e.collection("Message"):null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),a.prototype._serialize=function(e){return n(n({},e.serialize()),{messageId:"".concat(e.messageId)})},a.prototype._deserialize=function(e){return e=n(n({},e),{messageId:parseInt(e.messageId)}),Mn.of(this._iid).buildMessageFromSerializedData(e)},a.prototype.get=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserialize(t)];n.label=2;case 2:return[2,null]}}))}))},a.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,i=e.limit,a=void 0===i?100:i,o=e.filter,u=void 0===o?new Ot:o,c=e.order,l=void 0===c?fn.CHANNEL_LATEST:c,h=e.backward,d=void 0!==h&&h,p=e.parentMessageId,f=void 0===p?null:p;return r(this,void 0,void 0,(function(){var e,i,o,c=this;return s(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=Un(l),i={where:{channelUrl:t,"/where":function(e){if(n)switch(l){case fn.CHANNEL_LATEST:if(!d&&e.createdAt>n||d&&e.createdAt<n)return!1;break;case fn.NEWEST_CHILD_MESSAGE:if(!f||0===e.parentMessageId||e.parentMessageId!==f)return!1}return u.match(c._deserialize(e))}},index:e,backward:d},[4,this.collection.query(i)]):[3,3];case 1:return[4,h.sent().fetch({limit:a})];case 2:return o=h.sent(),[2,Promise.all(o.map((function(e){return r(c,void 0,void 0,(function(){var t,n,r;return s(this,(function(s){switch(s.label){case 0:return t=this._deserialize(e),(n=e.messageParams)?t instanceof Gt?(t.messageParams=n,[3,4]):[3,1]:[3,4];case 1:return t instanceof Bt?n.fileKey&&"string"==typeof n.fileKey&&qn(n.fileType)?(r=n,[4,this.collection.getBlob(n.fileKey)]):[3,3]:[3,4];case 2:r.file=s.sent(),s.label=3;case 3:t.messageParams=n,s.label=4;case 4:return[2,t]}}))}))})))];case 3:return[2,[]]}}))}))},a.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Ot),r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:fn.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},a.prototype.upsert=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:return r.sent(),[4,this.upsertChildMessages(e)];case 3:return r.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))},a.prototype.upsertChildMessages=function(e){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},a.prototype.remove=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,u;return s(this,(function(s){switch(s.label){case 0:if(!this.localCacheEnabled)return[3,8];s.label=1;case 1:s.trys.push([1,6,7,8]),t=i(e),n=t.next(),s.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:s.sent(),s.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return a=s.sent(),o={error:a},[3,8];case 7:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))},a.prototype.removeMessagesOfChannel=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:Un(fn.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.store).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return[2]}}))}))},a.prototype.removeUnderOffset=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:Un(fn.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},a.prototype.clear=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},a.prototype.countBetween=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i=this;return s(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=Un(fn.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return[2,s.sent()];case 2:return[2,0]}}))}))},a.prototype.saveBlobs=function(e){return r(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return r(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return e instanceof Bt&&e.messageParams&&((t=e.messageParams).file&&xn(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},a}(De);!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(tr||(tr={}));var hr,dr=function(){function e(e){this.category=e.cat,this.data=e.data}return e.getDataAsUserBlockEvent=function(e,t){var n=t.data,r=n.blocker,s=n.blockee;return{blocker:new ot(e,r),blockee:new ot(e,s)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new ot(e,t)})):[]}},e}();!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE"}(hr||(hr={}));var pr,fr=function(){function e(e){this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}return Object.defineProperty(e.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===ee.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===ee.OPEN},enumerable:!1,configurable:!0}),e}();!function(e){e.MUTED="muted",e.BANNED="banned"}(pr||(pr={}));var _r,mr=function(){function e(e){var t,n,r;this.restrictionType=null,this.description=null,this.endAt=-1,g(pr,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(r=null!==(n=e.end_at)&&void 0!==n?n:e.muted_end_at)&&void 0!==r?r:-1}return e.payloadify=function(e){return e?O({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null},e}(),vr=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.restrictionInfo=null,r.restrictionInfo=new mr(n),r}return t(r,e),r.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),mr.payloadify(t.restrictionInfo))):null},r}(ot);!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited"}(_r||(_r={}));var gr,yr,Er,br,Nr=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.state=null,r.role=null,r.isMuted=!1,r.isBlockedByMe=!1,r.isBlockingMe=!1,r.state=g(_r,n.state)?n.state:null,r.role=g(te,n.role)?n.role:null,n.hasOwnProperty("is_muted")&&(r.isMuted=n.is_muted),n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),n.hasOwnProperty("is_blocking_me")&&(r.isBlockingMe=n.is_blocking_me),r}return t(r,e),r.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{state:t.state,role:t.role,is_muted:t.isMuted,is_blocked_by_me:t.isBlockedByMe,is_blocking_me:t.isBlockingMe})):null},r}(vr);!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error"}(gr||(gr={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off"}(yr||(yr={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown"}(Er||(Er={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default"}(br||(br={}));var Tr,Ir=function(e){function n(t,n){var r,s,i=this;return(i=e.call(this,t)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",i.channelType=null!==(s=n.channel_type)&&void 0!==s?s:ee.GROUP,i.reader=new ot(i._iid,n.user),i.readAt=n.ts,i}return t(n,e),n}(De),Cr={data:null,customType:null,mentionType:ie.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Sr=function(e){return v("string",e.data,!0)&&v("string",e.customType,!0)&&g(ie,e.mentionType)&&E("string",e.mentionedUserIds,!0)&&E(ot,e.mentionedUsers,!0)&&v("string",e.mentionedMessageTemplate,!0)&&E(It,e.metaArrays,!0)&&g(oe,e.pushNotificationDeliveryOption,!0)&&v(At,e.appleCriticalAlertOptions,!0)},Ar=n(n({},Cr),{message:null,translationTargetLanguages:null}),Mr=function(e){return Sr(e)&&v("string",e.message,!0)&&E("string",e.translationTargetLanguages,!0)},wr=n({},Cr),Ur=function(e){function n(t){var n=t.channelUrl,r=t.channelType,s=t.token,i=t.limit,a=e.call(this)||this;return a.method=h.GET,a.path="".concat(ze(r),"/").concat(encodeURIComponent(n),"/operators"),a.params={token:s,limit:i},a}return t(n,e),n}(P),Rr=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.operators=n.operators.map((function(e){return new ot(t,e)})),r.token=n.next,r}return t(n,e),n}(k),Dr=function(e){function i(t,n,r,s){return e.call(this,t,n,r,s)||this}return t(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)},i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=Ya.of(this._iid).requestQueue,r=new Ur(n(n({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(r)]):[3,2]):[3,5];case 1:return i=s.sent(),a=i.as(Rr),o=a.operators,u=a.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},i}(en),Or=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.limit,a=t.token;return(n=e.call(this)||this).method=h.GET,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/mute"),n.params={limit:i,token:a},n}return t(n,e),n}(P),Lr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.token=null,r.mutedUsers=[];var s=n.next,i=n.muted_list;return r.token=s,i&&i.length>0&&(r.mutedUsers=i.map((function(e){return new vr(t,e)}))),r}return t(n,e),n}(k),Pr=function(e){function i(t,n,r,s){return e.call(this,t,n,r,s)||this}return t(i,e),i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=Ya.of(this._iid).requestQueue,t=new Or(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=s.sent(),i=r.as(Lr),a=i.mutedUsers,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},i}(en),kr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.limit,a=t.token;return(n=e.call(this)||this).method=h.GET,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/ban"),n.params=O({limit:i,token:a}),n}return t(n,e),n}(P),Fr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.token=null,r.bannedUsers=[];var s=n.next,i=n.banned_list;return r.token=s,i&&i.length>0&&(r.bannedUsers=i.map((function(e){return new vr(t,e.user)}))),r}return t(n,e),n}(k),xr=function(e){function i(t,n,r,s){return e.call(this,t,n,r,s)||this}return t(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)},i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=Ya.of(this._iid).requestQueue,t=new kr(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=s.sent(),i=r.as(Fr),a=i.bannedUsers,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},i}(en);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate"}(Tr||(Tr={}));var qr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.operatorUserIds;return(n=e.call(this)||this).method=h.POST,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:i},n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var Hr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.operatorUserIds;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/operators"),n.params={operator_ids:i},n}return t(n,e),n}(P);!function(e){function n(t,n){return e.call(this,t,n)||this}t(n,e)}(k);var Gr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.userId;return(n=e.call(this)||this).method=h.GET,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/mute/").concat(i),n}return t(n,e),n}(P),Vr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.isMuted=!1,r.startAt=null,r.endAt=null,r.remainingDuration=null,r.description=null;var s=n.is_muted,i=n.start_at,a=n.end_at,o=n.remaining_duration,u=n.description;return r.isMuted=s,r.startAt=i,r.endAt=a,r.remainingDuration=o,r.description=u,r}return t(n,e),n}(k),Qr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.keys;return(n=e.call(this)||this).method=h.GET,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={keys:i,include_ts:!0},n}return t(n,e),n}(P),Br=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.ts=null;var s=n.metadata,i=n.ts;return r.metadata=s,r.ts=null!=i?i:null,r}return t(n,e),n}(k),jr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.metadata,a=t.upsert;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:i,include_ts:!0,upsert:null!=a&&a},n}return t(n,e),n}(P),zr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.ts=null;var s=n.metadata,i=n.ts;return r.metadata=s,r.ts=null!=i?i:null,r}return t(n,e),n}(k),Kr=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.created=null,s.updated=null,s.deleted=null,r.data&&(s.created=r.data.created,s.updated=r.data.updated,s.deleted=r.data.deleted),s}return t(n,e),n}(B),Wr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.key;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metadata/").concat(i),n.params={include_ts:!0},n}return t(n,e),n}(P),Yr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.ts=null;var s=n.ts;return r.ts=null!=s?s:null,r}return t(n,e),n}(k),Jr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metadata"),n.params={include_ts:!0},n}return t(n,e),n}(P),Xr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.ts=null;var s=n.ts;return r.ts=null!=s?s:null,r}return t(n,e),n}(k),Zr=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.keys;return(n=e.call(this)||this).method=h.GET,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={keys:i},n}return t(n,e),n}(P),$r=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return t(n,e),n}(k),es=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.metaCounter;return(n=e.call(this)||this).method=h.POST,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:i},n}return t(n,e),n}(P),ts=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return t(n,e),n}(k),ns=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.metaCounter,a=t.upsert,o=void 0!==a&&a,u=t.mode,c=void 0===u?"set":u;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params={metacounter:i,upsert:o,mode:c},n}return t(n,e),n}(P),rs=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaCounter=n,r}return t(n,e),n}(k),ss=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.created=null,s.updated=null,s.deleted=null,r.data&&(s.created=r.data.created,s.updated=r.data.updated,s.deleted=r.data.deleted),s}return t(n,e),n}(B),is=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.key;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metacounter/").concat(i),n.params=null,n}return t(n,e),n}(P);!function(e){function n(t,n){return e.call(this,t,n)||this}t(n,e)}(k);var as=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/metacounter"),n.params=null,n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var os=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.userId,a=t.seconds,o=t.description;return(n=e.call(this)||this).method=h.POST,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/mute"),n.params={user_id:i,seconds:a,description:o},n}return t(n,e),n}(P);!function(e){function n(t,n){return e.call(this,t,n)||this}t(n,e)}(k);var us=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.user=new vr(t,r.data),s}return t(n,e),n}(B),cs=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.userId;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/mute/").concat(encodeURIComponent(i)),n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var ls=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.user=new vr(t,r.data),s}return t(n,e),n}(B),hs=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.userId,a=t.seconds,o=t.description;return(n=e.call(this)||this).method=h.POST,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/ban"),n.params=O({user_id:i,seconds:a,description:o}),n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var ds=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.memberCount=null,s.joinedMemberCount=null,s.user=new vr(t,r.data),r.data.member_count&&(s.memberCount=r.data.member_count),r.data.joined_member_count&&(s.joinedMemberCount=r.data.joined_member_count),s}return t(n,e),n}(B),ps=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.userId;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/ban/").concat(encodeURIComponent(i)),n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var fs=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.user=new vr(t,r.data),s}return t(n,e),n}(B),_s=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.freezing;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(ze(s),"/").concat(encodeURIComponent(r),"/freeze"),n.params={freeze:i},n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var ms=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.freeze=r.data.freeze,s}return t(n,e),n}(B),vs=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.category,a=t.userId,o=t.description;return(n=e.call(this)||this).method=h.POST,n.path="".concat(Ke(s),"/").concat(encodeURIComponent(r)),n.params={report_category:i,reporting_user_id:a,report_description:o},n}return t(n,e),n}(P),gs=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.category,a=t.userId,o=t.offendingUserId,u=t.description;return(n=e.call(this)||this).method=h.POST,n.path="/report/users/".concat(o),n.params={channel_url:r,channel_type:s===ee.OPEN?"open_channels":"group_channels",report_category:i,reporting_user_id:a,report_description:u},n}return t(n,e),n}(P),ys=function(e){function n(t){var n=this,r=t.channelUrl,s=t.channelType,i=t.category,a=t.userId,o=t.offendingUserId,u=t.messageId,c=t.description;return(n=e.call(this)||this).method=h.POST,n.path="".concat(Ke(s),"/").concat(encodeURIComponent(r),"/messages/").concat(u),n.params={report_category:i,reporting_user_id:a,report_description:c,offending_user_id:o},n}return t(n,e),n}(P),Es=function(e){function n(t){var n=[];return t.mentionType===ie.USERS&&(t.mentionedUserIds?n=t.mentionedUserIds:t.mentionedUsers&&(n=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"MESG",ackRequired:!0,payload:O({channel_url:t.channelUrl,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:n,mentioned_message_template:t.mentionedMessageTemplate,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==oe.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,is_reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId})})||this}return t(n,e),n}(j),bs=function(e){function n(t,n,r){var s,i,a,o=this;(o=e.call(this,t,"MESG",r)||this).message=new Gt(t,r);var u=Ya.of(t).sdkState;return o.isMentioned=We(o.message.mentionType,null!==(s=o.message.mentionedUserIds)&&void 0!==s?s:null===(i=o.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return t(n,e),n}(B),Ns=function(e){function n(t){var n=[];return t.mentionType===ie.USERS&&(t.mentionedUserIds?n=t.mentionedUserIds:t.mentionedUsers&&(n=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"MEDI",ackRequired:!0,payload:O({channel_url:t.channelUrl,msg_id:t.messageId,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:n,mentioned_message_template:t.mentionedMessageTemplate,apple_critical_alert_options:t.appleCriticalAlertOptions})})||this}return t(n,e),n}(j),Ts=function(e){function n(t,n,r){var s,i,a,o,u,c,l=this;(l=e.call(this,t,"MEDI",r)||this).message=new Gt(t,r);var h=Ya.of(t).sdkState;return l.mentionCountChange=Ye({mentionType:null!==(i=null===(s=r.old_values)||void 0===s?void 0:s.mention_type)&&void 0!==i?i:null,mentionedUserIds:null!==(o=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return t(n,e),n}(B),Is=function(e){function n(t){var n=[];return t.mentionType===ie.USERS&&(t.mentionedUserIds?n=t.mentionedUserIds:t.mentionedUsers&&(n=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"FEDI",ackRequired:!0,payload:O({channel_url:t.channelUrl,msg_id:t.messageId,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:n,apple_critical_alert_options:t.appleCriticalAlertOptions})})||this}return t(n,e),n}(j),Cs=function(e){function n(t,n,r){var s,i,a,o,u,c,l=this;(l=e.call(this,t,"FEDI",r)||this).message=new Bt(t,r);var h=Ya.of(t).sdkState;return l.mentionCountChange=Ye({mentionType:null!==(i=null===(s=r.old_values)||void 0===s?void 0:s.mention_type)&&void 0!==i?i:null,mentionedUserIds:null!==(o=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return t(n,e),n}(B),Ss=function(e){function n(t){var n=e.call(this)||this;return n.method=h.DELETE,n.path="".concat(ze(t.channelType),"/").concat(t.channelUrl,"/messages/").concat(t.messageId),n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var As,Ms=function(e){function n(t,n,r){var s=e.call(this,t,"DELM",r)||this;return s.channelUrl=r.channel_url,s.channelType=r.channel_type,s.messageId=Number(r.msg_id),s}return t(n,e),n}(B),ws=function(e){function n(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,i=t.reactionKey,a=e.call(this)||this;return a.method=h.POST,a.path="".concat(ze(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/reactions"),a.params={reaction:i},a}return t(n,e),n}(P),Us=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.reactionEvent=new Nt(n),r}return t(n,e),n}(k),Rs=function(e){function n(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,i=t.reactionKey,a=e.call(this)||this;return a.method=h.DELETE,a.path="".concat(ze(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/reactions"),a.params={reaction:i},a}return t(n,e),n}(P),Ds=function(e){function r(t,r){var s=e.call(this,t,r)||this;return s.reactionEvent=new Nt(n({},r)),s}return t(r,e),r}(k),Os=function(e){function n(t){var n=t.channelType,r=t.channelUrl,s=t.messageId,i=t.translationTargetLanguages,a=e.call(this)||this;return a.method=h.POST,a.path="".concat(ze(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(s),"/translation"),a.params={target_langs:i},a}return t(n,e),n}(P),Ls=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.message=new Gt(t,n),r}return t(n,e),n}(k),Ps=function(e){function c(t,n){var r,s,i,a,o=this;return(o=e.call(this,t)||this).url="",o.channelType=ee.BASE,o.name="",o.coverUrl="",o.customType="",o.data="",o.isFrozen=!1,o.isEphemeral=!1,o.creator=null,o.createdAt=0,o.url=n.channel_url,o.name=null!==(r=n.name)&&void 0!==r?r:"",o.coverUrl=null!==(s=n.cover_url)&&void 0!==s?s:"",o.customType=null!==(i=n.custom_type)&&void 0!==i?i:"",o.data=null!==(a=n.data)&&void 0!==a?a:"",o.isFrozen=!!v("boolean",n.freeze)&&n.freeze,o.isEphemeral=!!v("boolean",n.is_ephemeral)&&n.is_ephemeral,o.creator=n.created_by?new ot(o._iid,n.created_by):null,o.createdAt=1e3*n.created_at,o._cachedMetaData=new Map,n.metadata&&n.ts&&Object.keys(n.metadata).forEach((function(e){o._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts})})),o}return t(c,e),c.payloadify=function(t){return O(n(n({},e.payloadify.call(this,t)),{channel_url:t.url,name:t.name,cover_url:t.coverUrl,custom_type:t.customType,data:t.data,freeze:t.isFrozen,is_ephemeral:t.isEphemeral,created_by:ot.payloadify(t.creator),created_at:t.createdAt/1e3}))},c.prototype.isGroupChannel=function(){return this.channelType===ee.GROUP},c.prototype.isOpenChannel=function(){return this.channelType===ee.OPEN},Object.defineProperty(c.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e},enumerable:!1,configurable:!0}),c.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){var s=n._cachedMetaData.get(r);(!s||s.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))},c.prototype._removeFromCachedMetaData=function(e,t){var n=this;e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!1,r.updatedAt=t)}))},c.prototype._generateRequestId=function(){return"rq-".concat(M())},c.prototype.isIdentical=function(e){return e&&this.url===e.url},c.prototype.isEqual=function(e){return m(this,e)},c.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new Dr(this._iid,this.url,this.channelType,e)},c.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new Pr(this._iid,this.url,this.channelType,e)},c.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new xr(this._iid,this.url,this.channelType,e)},c.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new tn(this._iid,this.url,this.channelType,e)},c.prototype.addOperators=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return it(E("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new qr({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype.removeOperators=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return it(E("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new Hr({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype.getMyMutedInfo=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Gr({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(Vr),o=a.isMuted,u=a.startAt,c=a.endAt,l=a.remainingDuration,h=a.description,[2,{isMuted:o,startAt:u,endAt:c,remainingDuration:l,description:h}]}}))}))},c.prototype.getMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return it(E("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new Qr({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(Br),a=i.metadata,o=i.ts,this._upsertCachedMetaData(a,o),[2,a]}}))}))},c.prototype.getAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new Qr({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(Br),i=r.metadata,a=r.ts,this._upsertCachedMetaData(i,a),[2,i]}}))}))},c.prototype.createMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=Ya.of(this._iid).requestQueue,n=new Je({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(Xe).metaData,this._upsertCachedMetaData(i,0),[2,i]}}))}))},c.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return n=Ya.of(this._iid).requestQueue,r=new jr({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as(zr),o=a.metadata,u=a.ts,this._upsertCachedMetaData(o,u),[2,o]}}))}))},c.prototype.deleteMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new Wr({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(Yr).ts,this._removeFromCachedMetaData([e],i),[2]}}))}))},c.prototype.deleteAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new Jr({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=s.sent(),r=n.as(Xr).ts,this._removeFromCachedMetaData(o([],a(this._cachedMetaData.keys()),!1),r),[2]}}))}))},c.prototype.getMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(s){switch(s.label){case 0:return it(E("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new Zr({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=s.sent(),[2,r.as($r).metaCounter]}}))}))},c.prototype.getAllMetaCounters=function(){return r(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new Zr({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=r.sent(),[2,n.as($r).metaCounter]}}))}))},c.prototype.createMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(s){switch(s.label){case 0:return t=Ya.of(this._iid).requestQueue,n=new es({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return r=s.sent(),[2,r.as(ts).metaCounter]}}))}))},c.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return n=Ya.of(this._iid).requestQueue,r=new ns({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(rs).metaCounter]}}))}))},c.prototype.increaseMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(s){switch(s.label){case 0:return t=Ya.of(this._iid).requestQueue,n=new ns({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return r=s.sent(),[2,r.as(rs).metaCounter]}}))}))},c.prototype.decreaseMetaCounters=function(e){return r(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(s){switch(s.label){case 0:return t=Ya.of(this._iid).requestQueue,n=new ns({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return r=s.sent(),[2,r.as(rs).metaCounter]}}))}))},c.prototype.deleteMetaCounter=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return it(v("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new is({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype.deleteAllMetaCounters=function(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new as({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.muteUser=function(e,t,n){return r(this,void 0,void 0,(function(){return s(this,(function(r){return[2,this.muteUserWithUserId(e.userId,t,n)]}))}))},c.prototype.muteUserWithUserId=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)&&v("number",t,!0)&&v("string",n,!0)).throw(p.invalidParameters),r=Ya.of(this._iid).requestQueue,i=new os({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},c.prototype.unmuteUser=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.unmuteUserWithUserId(e.userId)]}))}))},c.prototype.unmuteUserWithUserId=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return it(v("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new cs({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype.banUser=function(e,t,n){return r(this,void 0,void 0,(function(){return s(this,(function(r){return[2,this.banUserWithUserId(e.userId,t,n)]}))}))},c.prototype.banUserWithUserId=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)&&v("number",t,!0)&&v("string",n,!0)).throw(p.invalidParameters),r=Ya.of(this._iid).requestQueue,i=new hs({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},c.prototype.unbanUser=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.unbanUserWithUserId(e.userId)]}))}))},c.prototype.unbanUserWithUserId=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return it(v("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,n=new ps({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype.freeze=function(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new _s({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},c.prototype.unfreeze=function(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new _s({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},c.prototype.getMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return t=n(n({},hn),t),it(v("number",e)&&function(e){return v("number",e.prevResultSize)&&v("number",e.nextResultSize)&&v("boolean",e.isInclusive)&&v("boolean",e.reverse)&&v("string",e.messageTypeFilter)&&g(re,e.messageTypeFilter)&&E("string",e.customTypesFilter,!0)&&E("string",e.senderUserIdsFilter,!0)&&g(ae,e.replyType)&&v("boolean",e.includeMetaArray)&&v("boolean",e.includeReactions)&&v("boolean",e.includeParentMessageInfo)&&v("boolean",e.includeThreadInfo)&&v("boolean",e.showSubchannelMessagesOnly)}(t)).throw(p.invalidParameters),[4,Mn.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,t)];case 1:return[2,r.sent()]}}))}))},c.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return t=n(n({},dn),t),it(v("number",e)&&pn(t)).throw(p.invalidParameters),[4,Mn.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,t)];case 1:return[2,r.sent()]}}))}))},c.prototype.getMessageChangeLogsSinceToken=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return t=n(n({},dn),t),it(v("string",e)&&pn(t)).throw(p.invalidParameters),[4,Mn.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,t)];case 1:return[2,r.sent()]}}))}))},c.prototype._createPendingSendableMessagePayload=function(e,t,n){var r=Ya.of(this._iid).sessionManager;return O({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((function(e){return It.payloadify(e)})):null,apple_critical_alert_options:e.appleCriticalAlertOptions?At.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:Rt.payloadify(r.currentUser),req_id:t,request_state:ue.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:e.mentionedUsers})},c.prototype._createPendingUserMessage=function(e,t,r){var s,a,o={};if(e.translationTargetLanguages)try{for(var u=i(e.translationTargetLanguages),c=u.next();!c.done;c=u.next()){o[c.value]=""}}catch(e){s={error:e}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(s)throw s.error}}var l=O(n(n({},this._createPendingSendableMessagePayload(e,t,r)),{type:ne.USER,message:e.message,translations:o})),h=new Gt(this._iid,l);return h.messageParams=e,h},c.prototype._createPendingFileMessage=function(e,t,r){var s=O(n(n({},this._createPendingSendableMessagePayload(e,t,r)),{type:ne.FILE,url:e.fileUrl,file:{name:e.fileName,size:e.fileSize,type:e.mimeType,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),i=new Bt(this._iid,s);return i.messageParams=e,i},c.prototype._markMessageAsFailed=function(e,t){var n=Ya.of(this._iid).cacheContext;e.errorCode=t.code,n.localCacheEnabled&&b(t.code)||(e.sendingStatus=t.code!==u.REQUEST_CANCELED?ue.FAILED:ue.CANCELED)},c.prototype.sendUserMessage=function(e){return e=n(n({},On),e),it(Ln(e)).throw(p.invalidParameters),this._sendUserMessage(e)},c.prototype._sendUserMessage=function(e,t,i){var a=this;void 0===t&&(t=Date.now()),void 0===i&&(i=null);var o=Ya.of(this._iid),u=o.dispatcher,c=o.requestQueue,l=i,h=new zt;if(!l){l=this._generateRequestId();var p=Ya.of(this._iid).dispatcher;me(2).then((function(){var n=a._createPendingUserMessage(e,l,t);p.dispatch(new mn({messages:[n],source:cn.EVENT_MESSAGE_SENT_PENDING})),ye((function(){return r(a,void 0,void 0,(function(){return s(this,(function(e){return[2,h._trigger(null,n)]}))}))}))})).catch((function(e){throw e}))}var f=new Es(n({channelUrl:this.url,channelType:this.channelType,reqId:l},e));return c.send(f).then((function(e){var t=e.as(bs).message;u.dispatch(new mn({messages:[t],source:cn.EVENT_MESSAGE_SENT_SUCCESS})),ye((function(){return r(a,void 0,void 0,(function(){return s(this,(function(e){return[2,h._trigger(null,t)]}))}))}))})).catch((function(n){if(d(n))throw n;me(2).then((function(){var i=a._createPendingUserMessage(e,l,t);a._markMessageAsFailed(i,n),u.dispatch(new mn({messages:[i],source:i.sendingStatus===ue.PENDING?cn.REQUEST_RESEND_MESSAGE:cn.EVENT_MESSAGE_SENT_FAILED})),ye((function(){return r(a,void 0,void 0,(function(){return s(this,(function(e){return[2,h._trigger(n,i)]}))}))}))})).catch((function(e){throw e}))})),h},c.prototype._autoResendUserMessage=function(e){return it(e instanceof Gt).throw(p.invalidParameters),this._sendUserMessage(e.messageParams,e.createdAt,e.reqId)},c.prototype.resendUserMessage=function(e){var t;return r(this,void 0,void 0,(function(){var n,r;return s(this,(function(s){var i;return it(e instanceof Gt).throw(p.invalidParameters),n=new Z,r=null!==(t=e.messageParams)&&void 0!==t?t:O({data:(i=e).data,customType:i.customType,mentionType:i.mentionType,mentionedUsers:i.mentionedUsers,mentionedUserIds:i.mentionedUserIds,mentionedMessageTemplate:i.mentionedMessageTemplate,metaArrays:i.metaArrays,parentMessageId:i.parentMessageId,appleCriticalAlertOptions:i.appleCriticalAlertOptions,message:i.message,translationTargetLanguages:Object.keys(i.translations)}),this._sendUserMessage(r).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},c.prototype.updateUserMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return t=n(n({},Ar),t),it(v("number",e)&&Mr(t)).throw(p.invalidParameters),r=Ya.of(this._iid),i=r.dispatcher,a=r.requestQueue,o=new Ns(n({channelType:this.channelType,channelUrl:this.url,messageId:e},t)),[4,a.send(o)];case 1:return u=s.sent(),c=u.as(Ts).message,i.dispatch(new mn({messages:[c],source:cn.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},c.prototype.copyUserMessage=function(e,t){var i,a,o;return r(this,void 0,void 0,(function(){var r,u;return s(this,(function(s){return it(e instanceof c&&t instanceof Gt&&e.url===t.channelUrl).throw(p.invalidParameters),r=new Z,u=null!==(i=t.messageParams)&&void 0!==i?i:n(n({},t),{mentionType:t.mentionType,mentionedUserIds:null!==(a=t.mentionedUserIds)&&void 0!==a?a:null===(o=t.mentionedUsers)||void 0===o?void 0:o.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(t.translations),pushNotificationDeliveryOption:oe.DEFAULT,parentMessageId:null,isReplyToChannel:!1}),e._sendUserMessage(u).onSucceeded((function(e){return r.resolve(e)})).onFailed((function(e){return r.reject(e)})),[2,r.promise]}))}))},c.prototype.translateUserMessage=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return it(e instanceof Gt&&e.messageId>0&&E("string",t)).throw(p.invalidParameters),n=Ya.of(this._iid).requestQueue,r=new Os({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Ls).message]}}))}))},c.prototype.sendFileMessage=function(e){return e=n(n({},Hn),e),it(Gn(e)).throw(p.invalidParameters),this._sendFileMessage(e)},c.prototype._sendFileMessage=function(e,t,n){var i=this;void 0===t&&(t=Date.now()),void 0===n&&(n=null);var a=Ya.of(this._iid).dispatcher,o=Mn.of(this._iid).fileMessageQueue,u=n,c=new zt;return u||(u=this._generateRequestId(),me(2).then((function(){var n=i._createPendingFileMessage(e,u,t);a.dispatch(new mn({messages:[n],source:cn.EVENT_MESSAGE_SENT_PENDING})),ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(e){return[2,c._trigger(null,n)]}))}))}))})).catch((function(e){throw e}))),o.request(this,u,e).then((function(e){a.dispatch(new mn({messages:[e],source:cn.EVENT_MESSAGE_SENT_SUCCESS})),ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(t){return[2,c._trigger(null,e)]}))}))}))})).catch((function(n){if(d(n))throw n;me(2).then((function(){var o=i._createPendingFileMessage(e,u,t);i._markMessageAsFailed(o,n),a.dispatch(new mn({messages:[o],source:o.sendingStatus===ue.PENDING?cn.REQUEST_RESEND_MESSAGE:cn.EVENT_MESSAGE_SENT_FAILED})),ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(e){return[2,c._trigger(n,o)]}))}))}))})).catch((function(e){throw e}))})),c},c.prototype._autoResendFileMessage=function(e){it(e instanceof Bt).throw(p.invalidParameters);var t=Ya.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.createdAt,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))},c.prototype.sendFileMessages=function(e){var t,r;it(e.every((function(e){return Gn(n(n({},Hn),e))}))).throw(p.invalidParameters);var s=new zt;try{for(var a=i(e),o=a.next();!o.done;o=a.next()){var u=o.value;this.sendFileMessage(u).onPending((function(e){return s._trigger(null,e)})).onFailed((function(e,t){return s._trigger(e,t)})).onSucceeded((function(e){return s._trigger(null,e)}))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return s},c.prototype.resendFileMessage=function(e,t){var n;return r(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){return it(e instanceof Bt&&t instanceof Blob).throw(p.invalidParameters),r=new Z,i=null!==(n=e.messageParams)&&void 0!==n?n:function(e,t){return void 0===t&&(t=null),O({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))})}(e,t),this._sendFileMessage(i).onFailed((function(e){return r.reject(e)})).onSucceeded((function(e){return r.resolve(e)})),[2,r.promise]}))}))},c.prototype.updateFileMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return t=n(n({},wr),t),it(v("number",e)&&function(e){return Sr(e)}(t)).throw(p.invalidParameters),r=Ya.of(this._iid),i=r.dispatcher,a=r.requestQueue,o=new Is(n({channelType:this.channelType,channelUrl:this.url,messageId:e},t)),[4,a.send(o)];case 1:return u=s.sent(),c=u.as(Cs).message,i.dispatch(new mn({messages:[c],source:cn.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},c.prototype.cancelUploadingFileMessage=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return it(v("string",e)).throw(p.invalidParameters),Mn.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},c.prototype.copyFileMessage=function(e,t){var i,a;return r(this,void 0,void 0,(function(){var r,o;return s(this,(function(s){return it(e instanceof c&&t instanceof Bt&&e.url===t.channelUrl).throw(p.invalidParameters),r=new Z,o=n(n({},t),{fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,mentionType:t.mentionType,mentionedUserIds:null!==(i=t.mentionedUserIds)&&void 0!==i?i:null===(a=t.mentionedUsers)||void 0===a?void 0:a.map((function(e){return e.userId})),pushNotificationDeliveryOption:oe.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:t.requireAuth}),e._sendFileMessage(o).onSucceeded((function(e){return r.resolve(e)})).onFailed((function(e){return r.reject(e)})),[2,r.promise]}))}))},c.prototype.deleteMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return it(e instanceof Dt).throw(p.invalidParameters),e.messageId>0?(t=Ya.of(this._iid).requestQueue,n=new Ss({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},c.prototype.addReaction=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return it(e instanceof Ut&&e.messageId>0&&v("string",t)).throw(p.invalidParameters),n=Ya.of(this._iid).requestQueue,r=new ws({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Us).reactionEvent]}}))}))},c.prototype.deleteReaction=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return it(e instanceof Ut&&e.messageId>0&&v("string",t)).throw(p.invalidParameters),n=Ya.of(this._iid).requestQueue,r=new Rs({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Ds).reactionEvent]}}))}))},c.prototype._updateMessageMetaArray=function(e,t,n,i){return r(this,void 0,void 0,(function(){var r,a,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return r=Ya.of(this._iid),a=r.dispatcher,o=r.requestQueue,u=new Ns({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:i}}),[4,o.send(u)];case 1:return c=s.sent(),l=c.as(Ts).message,a.dispatch(new mn({messages:[l],source:cn.EVENT_MESSAGE_UPDATED})),[2,l]}}))}))},c.prototype.createMessageMetaArrayKeys=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){return it(e instanceof Dt&&e.messageId>0&&E("string",t)).throw(p.invalidParameters),n=t.map((function(e){return new It({key:e})})),[2,this._updateMessageMetaArray(e.messageId,n,"add",!0)]}))}))},c.prototype.deleteMessageMetaArrayKeys=function(e,t){return r(this,void 0,void 0,(function(){var n;return s(this,(function(r){return it(e instanceof Dt&&e.messageId>0&&E("string",t)).throw(p.invalidParameters),n=t.map((function(e){return new It({key:e})})),[2,this._updateMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},c.prototype.addMessageMetaArrayValues=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){return it(e instanceof Dt&&e.messageId>0&&t.every((function(e){return e instanceof It}))).throw(p.invalidParameters),[2,this._updateMessageMetaArray(e.messageId,t,"add",!0)]}))}))},c.prototype.removeMessageMetaArrayValues=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){return it(e instanceof Dt&&e.messageId>0&&t.every((function(e){return e instanceof It}))).throw(p.invalidParameters),[2,this._updateMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},c.prototype.report=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return it(g(Tr,e)&&v("string",t)).throw(p.invalidParameters),n=Ya.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new vs({channelUrl:this.url,channelType:this.channelType,userId:r.userId,category:e,description:t}),[4,i.send(a)];case 1:return s.sent(),[2]}}))}))},c.prototype.reportUser=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return it(e instanceof ot&&g(Tr,t)&&v("string",n)).throw(p.invalidParameters),r=Ya.of(this._iid),i=r.sdkState,a=r.requestQueue,o=new gs({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.userId,category:t,description:n}),[4,a.send(o)];case 1:return s.sent(),[2]}}))}))},c.prototype.reportMessage=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return it(e instanceof Dt&&g(Tr,t)&&v("string",n)).throw(p.invalidParameters),r=Ya.of(this._iid),i=r.sdkState,a=r.requestQueue,o=new ys({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:t,description:n}),[4,a.send(o)];case 1:return s.sent(),[2]}}))}))},c}(De),ks=new Map,Fs=new Map,xs=new Map,qs=function(){function e(t){var n=t.key,i=t.concurrentCallLimit,a=void 0===i?2:i,o=t.backOffDelay,u=void 0===o?0:o,c=this;this._holdersKey=e.createSemaphoreHoldersKey(n),this._resolversKey=e.createSemaphoreResolversKey(n),this._chainProcessStateKey=e.createChainProcessStateKey(n),this._numLocks=a,this._backOffDelay=u,this._localAcquiredKeys=[],this._localResolversData=[],V()?(ks[this._holdersKey]||(ks[this._holdersKey]=[]),Fs[this._resolversKey]||(Fs[this._resolversKey]=[])):(window.addEventListener("storage",(function(e){return r(c,void 0,void 0,(function(){var t,n;return s(this,(function(r){if(this._localResolversData.length>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()&&this._hasHighestPriorityResolver())switch(e.key){case this._holdersKey:if(t=JSON.parse(e.oldValue),n=JSON.parse(e.newValue),!t||!n||n.length>=t.length)return[2];this._processChainResolve();break;case this._chainProcessStateKey:if(JSON.parse(e.newValue))return[2];this._processChainResolve();break;default:return[2]}return[2]}))}))})),window.addEventListener("beforeunload",(function(){var e=c._getLocalResolversData(),t=c._localResolversData.map((function(e){return e.key})),n=e.filter((function(e){return t.indexOf(e.key)<0}));window.localStorage.setItem(c._resolversKey,JSON.stringify(n)),c._localAcquiredKeys.forEach((function(e){return c.release(e)}))})))}return e.createSemaphoreHoldersKey=function(e){return"collection@semaphore_holders_for:"+e},e.createSemaphoreResolversKey=function(e){return"collection@semaphore_resolvers_for:"+e},e.createChainProcessStateKey=function(e){return"collection@semaphore_chain_process_state_for:"+e},Object.defineProperty(e.prototype,"numLocks",{get:function(){return this._numLocks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backOffDelay",{get:function(){return this._backOffDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numLocksAvailable",{get:function(){if(V())return this.numLocks-ks[this._holdersKey].length;var e=this._getLocalHoldersData();return this.numLocks-e.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"waitCount",{get:function(){return V()?Fs[this._resolversKey].length:this._getLocalResolversData().length},enumerable:!1,configurable:!0}),e.prototype._hasHighestPriorityResolver=function(){var e=this._getLocalResolversData();return e.length>0&&this._localResolversData.map((function(e){return e.key})).indexOf(e[0].key)>=0},e.prototype._isProcessChainAcquireRunning=function(){if(V())return xs[this._chainProcessStateKey];var e=window.localStorage[this._chainProcessStateKey];return void 0!==e&&JSON.parse(e)},e.prototype._setProcessChainAcquireRunning=function(e){V()?xs[this._chainProcessStateKey]=e:e?window.localStorage.setItem(this._chainProcessStateKey,JSON.stringify(e)):window.localStorage.removeItem(this._chainProcessStateKey)},e.prototype._processChainResolve=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this.waitCount>0&&this.numLocksAvailable>0&&!this._isProcessChainAcquireRunning()?(this._setProcessChainAcquireRunning(!0),this._tryResolve()?[4,me(this._backOffDelay)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:this._setProcessChainAcquireRunning(!1),V()?this._processChainResolve():(e=new StorageEvent("storage",{key:this._chainProcessStateKey,oldValue:JSON.stringify(!0),newValue:JSON.stringify(!1)}),dispatchEvent(e)),t.label=3;case 3:return[2]}}))}))},e.prototype.acquire=function(e){return void 0===e&&(e=0),r(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){return V()?[2,new Promise((function(t){for(var r={key:M(),resolver:function(e){return t(e)},priority:e},s=Fs[n._resolversKey],i=-1,a=0;a<s.length;a++)if(e>s[a].priority){i=a;break}i>=0?Fs[n._resolversKey].splice(i,0,r):Fs[n._resolversKey].push(r),n._processChainResolve()}))]:(t=this._getLocalResolversData(),[2,new Promise((function(r){for(var s=M(),i={key:s,priority:e},a={key:s,resolver:function(e){return r(e)},priority:e},o=-1,u=0;u<t.length;u++)if(e>t[u].priority){o=u;break}o>=0?(t.splice(o,0,i),n._localResolversData.splice(o,0,a)):(t.push(i),n._localResolversData.push(a)),window.localStorage.setItem(n._resolversKey,JSON.stringify(t)),n._processChainResolve()}))])}))}))},e.prototype.release=function(e){if(V()){if((t=ks[this._holdersKey].indexOf(e))>=0)return ks[this._holdersKey].splice(t,1),this._processChainResolve(),!0}else if(window.localStorage[this._holdersKey]){var t,n=JSON.parse(window.localStorage[this._holdersKey]),r=o([],a(n),!1);if((t=n.indexOf(e))>=0){n.splice(t,1),window.localStorage.setItem(this._holdersKey,JSON.stringify(n)),this._localAcquiredKeys.splice(this._localAcquiredKeys.indexOf(e),1);var s=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(r),newValue:JSON.stringify(n)});return dispatchEvent(s),!0}}return!1},e.prototype._tryResolve=function(){if(V()){if(ks[this._holdersKey].length<this.numLocks){var e=M();return ks[this._holdersKey]=o(o([],a(ks[this._holdersKey]),!1),[e],!1),(n=Fs[this._resolversKey].shift()).resolver(e),!0}}else{var t=this._getLocalHoldersData();if(t.length<this.numLocks){e=M();var n=this._localResolversData.shift(),r=this._getLocalResolversData(),s=r.map((function(e){return e.key})).indexOf(n.key);r.splice(s,1),window.localStorage.setItem(this._resolversKey,JSON.stringify(r)),window.localStorage.setItem(this._holdersKey,JSON.stringify(o(o([],a(t),!1),[e],!1))),this._localAcquiredKeys.push(e);var i=new StorageEvent("storage",{key:this._holdersKey,oldValue:JSON.stringify(o([],a(t),!1)),newValue:JSON.stringify(o(o([],a(t),!1),[e],!1))});return dispatchEvent(i),(0,n.resolver)(e),!0}}return!1},e.prototype._getLocalHoldersData=function(){var e=window.localStorage[this._holdersKey];return void 0!==e?JSON.parse(e):[]},e.prototype._getLocalResolversData=function(){var e=window.localStorage[this._resolversKey];return void 0!==e?JSON.parse(e):[]},e}();!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(As||(As={}));var Hs,Gs=function(e){function n(t,n,r,s){void 0===r&&(r=2),void 0===s&&(s=10);var i=e.call(this)||this;return i._worker=null,i._state=As.IDLE,i._semaphore=null,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=n,i._semaphore=new qs({key:t,concurrentCallLimit:r,backOffDelay:s}),i}return t(n,e),Object.defineProperty(n.prototype,"isIdle",{get:function(){return this._state===As.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this._state===As.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDone",{get:function(){return this._state===As.END},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),n.prototype._run=function(e){return r(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},n.prototype.start=function(e){this.isIdle&&(this._state=As.RUNNING,this._run(e))},n.prototype.stop=function(){this._state=As.IDLE,this.dispatch("stop")},n.prototype.end=function(){this._state=As.END,this.dispatch("end")},n}(U),Vs=function(e){this.source=e},Qs=function(e){this.source=e},Bs=function(){function e(e){var t=e.top,n=void 0===t?Number.MAX_SAFE_INTEGER:t,r=e.bottom,s=void 0===r?0:r;this.top=n,this.bottom=s}return e.prototype.includes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.every((function(t){return e.top<=t&&t<=e.bottom}))},e.prototype.overlap=function(e){return this.includes(e.top)||this.includes(e.bottom)},e.prototype.extends=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.top=Math.min.apply(Math,o([this.top],a(e),!1)),this.bottom=Math.max.apply(Math,o([this.bottom],a(e),!1))},e}(),js={},zs=function(){function e(e){var t=e._iid,n=e.channel,i=this;this._prevSync=null,this._nextSync=null,this._metadata=null,this._iid=t,this._channel=n;var a,o,u=Ya.of(this._iid),c=u.sdkState,l=u.logger;this._metadataKey=(a=c.userId,o=n.url,"sendbird:".concat(a,"@groupchannel/").concat(o,"/message/sync.meta"));var h=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(c.userId,n.url);this._prevSync=new Gs(h,(function(e){return r(i,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:if(s.sent(),l.debug("message background prev sync from",null===(i=this._metadata)||void 0===i?void 0:i.range.top),this._metadata.previousComplete)return[3,9];s.label=2;case 2:return s.trys.push([2,5,,8]),[4,Mn.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(o=null===(a=this._metadata.range)||void 0===a?void 0:a.top)&&void 0!==o?o:e,{prevResultSize:100,nextResultSize:0,replyType:ae.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},cn.SYNC_MESSAGE_BACKGROUND)];case 3:return n=s.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.top,this._metadata.previousComplete=!t.hasNext,l.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return s.sent(),[3,8];case 5:return(r=s.sent())instanceof p&&r.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:s.sent(),s.label=7;case 7:return t.hasNext=!1,t.nextToken=0,[3,8];case 8:return[3,10];case 9:t.hasNext=!1,s.label=10;case 10:return[2,t]}}))}))})),this._nextSync=new Gs(h,(function(e){return r(i,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return t={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return s.sent(),l.debug("message background next sync from",null===(r=this._metadata)||void 0===r?void 0:r.range.bottom),[4,Mn.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(a=null===(i=this._metadata.range)||void 0===i?void 0:i.bottom)&&void 0!==a?a:e,{prevResultSize:0,nextResultSize:100,replyType:ae.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},cn.SYNC_MESSAGE_BACKGROUND)];case 2:return n=s.sent(),this.extendRange(n),t.hasNext=n.length>=100,t.nextToken=this._metadata.range.bottom,l.debug("message background next sync progress",t),[4,this.saveMetadata()];case 3:return s.sent(),[2,t]}}))}))}))}return e.of=function(t,n){if(js[t]||(js[t]={}),!js[t][n.url]){var r=js[t][n.url]=new e({_iid:t,channel:n});Ya.of(t).dispatcher.on((function(e){if(e instanceof ce)if(e.stateType===Y.CONNECTED)r.resume();else r.pause()}))}return js[t][n.url]},Object.defineProperty(e.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,o([],a(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,o([],a(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,Ya.of(this._iid).cacheContext.store.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={range:new Bs(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!e&&e.previousComplete},t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,Ya.of(this._iid).cacheContext.store.set({key:this._metadataKey,value:this._metadata,generation:1})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){return Ya.of(this._iid).cacheContext.store.remove(this._metadataKey),[2]}))}))},e.prototype.resume=function(){var e,t,n,r;Ya.of(this._iid).logger.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now())},e.prototype.pause=function(){Ya.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e}(),Ks={},Ws=function(){function e(e){var t=e._iid,n=e.channel,i=this;this._sync=null,this._metadata=null,this._iid=t,this._channel=n;var a,o,u=Ya.of(this._iid).sdkState;this._metadataKey=(a=u.userId,o=n.url,"sendbird:".concat(a,"@groupchannel/").concat(o,"/message/changelogs.meta"));var c=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(u.userId,this._channel.url);this._sync=new Gs(c,(function(){return r(i,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:s.sent(),s.label=2;case 2:return s.trys.push([2,5,,8]),[4,Mn.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:ae.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includePollDetails:!0},cn.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=s.sent(),n=t.hasMore,r=t.token,e.hasNext=n,e.nextToken=r,this._metadata.token=r,[4,this.saveMetadata()];case 4:return s.sent(),[3,8];case 5:return(i=s.sent())instanceof p&&i.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:s.sent(),s.label=7;case 7:return e.hasNext=!1,e.nextToken="",[3,8];case 8:return[2,e]}}))}))}))}return e.of=function(t,n){if(Ks[t]||(Ks[t]={}),!Ks[t][n.url]){var r=Ks[t][n.url]=new e({_iid:t,channel:n});Ya.of(t).dispatcher.on((function(e){if(e instanceof ce)if(e.stateType===Y.CONNECTED)r.resume();else r.pause()}))}return Ks[t][n.url]},e.prototype.loadMetadata=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){switch(s.label){case 0:return this._metadata?[3,2]:(e=Ya.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.store.get(this._metadataKey)]);case 1:r=s.sent(),this._metadata={token:r?r.token:n/1e3},s.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this._metadata?[4,Ya.of(this._iid).cacheContext.store.set({key:this._metadataKey,value:this._metadata,generation:1})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){return Ya.of(this._iid).cacheContext.store.remove(this._metadataKey),[2]}))}))},e.prototype.resume=function(){this._sync.start(0)},e.prototype.pause=function(){this._sync.stop()},e}();!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS"}(Hs||(Hs={}));var Ys,Js=function(e){return e.startsWith("EVENT_")||e===Hs.SYNC_CHANNEL_BACKGROUND||e===Hs.SYNC_CHANNEL_CHANGELOGS},Xs=function(e){function n(t){var n=t.channels,r=t.source,s=e.call(this)||this;return s.channels=n,s.source=r,s}return t(n,e),n}(D),Zs=function(e){function n(t){var n=t.channelUrls,r=t.source,s=e.call(this)||this;return s.channelUrls=n,s.source=r,s}return t(n,e),n}(D),$s=function(e){function n(t){var n,r,s,i,a,o,u=this;return(u=e.call(this)||this).method=h.GET,u.path="".concat(ze(t.channelType),"/").concat(t.channelUrl,"/messages_gap"),u.params=O({prev_start_ts:t.prevStart,prev_end_ts:t.prevEnd,prev_cache_count:t.prevCount,next_start_ts:t.nextStart,next_end_ts:t.nextEnd,next_cache_count:t.nextCount,huge_gap_threshold:null!==(n=t.threshold)&&void 0!==n?n:null,reverse:!0,custom_types:null!==(r=t.customTypes)&&void 0!==r?r:["*"],message_type:null!==(s=t.messageType)&&void 0!==s?s:null,include_reactions:null===(i=t.includeReactions)||void 0===i||i,with_sorted_meta_array:null===(a=t.includeMetaArray)||void 0===a||a,show_subchannel_messages_only:null!==(o=t.showSubchannelMessagesOnly)&&void 0!==o&&o}),u}return t(n,e),n}(P),ei=function(e){function n(t,n){var r,s,i,a,o=this;return(o=e.call(this,t,n)||this).isHugeGap=n.is_huge_gap,o.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map((function(e){return Qt(t,e)})),o.prevHasMore=null!==(s=n.prev_hasmore)&&void 0!==s&&s,o.nextMessages=(null!==(i=n.next_messages)&&void 0!==i?i:[]).map((function(e){return Qt(t,e)})),o.nextHasmore=null!==(a=n.next_hasmore)&&void 0!==a&&a,o}return t(n,e),n}(k),ti=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},ni=function(e,t,n){if(e.length>0){var r=ti(e,t);if(r<0){for(var s=0,i=e.length-1,a=Math.floor((s+i)/2);s<i;){var o=ri(e[a],t,n);if(o>0)i=a,a=Math.floor((s+i)/2);else{if(!(o<0))return{place:a,contains:e[a].isIdentical(t)};s=a+1,a=Math.floor((s+i)/2)}}return{place:ri(e[a],t,n)>0?a:a+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},ri=function(e,t,n){switch(n){case Pn.LATEST_LAST_MESSAGE:return e.lastMessage&&t.lastMessage?t.lastMessage.createdAt-e.lastMessage.createdAt:e.lastMessage?-1:t.lastMessage?1:t.createdAt-e.createdAt;case Pn.CHRONOLOGICAL:return t.createdAt-e.createdAt;case Pn.CHANNEL_NAME_ALPHABETICAL:return e.name.localeCompare(t.name)}},si=function(e,t){if(t instanceof Dt)return e.findIndex((function(e){return e instanceof Dt&&t.isIdentical(e)}));e.findIndex((function(e){return e.isIdentical(t)}))},ii=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,s=Math.floor((n+r)/2);n<r;){var i=e[s].createdAt-t.createdAt;if(i>0)r=s,s=Math.floor((n+r)/2);else{if(!(i<0))return s;n=s+1,s=Math.floor((n+r)/2)}}return e[s].createdAt>t.createdAt?s:s+1}return e.length};!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"}(Ys||(Ys={}));var ai,oi,ui=function(){function e(){}return e.prototype._invokeResponse=function(e,t,n){var i=this;ye((function(){return r(i,void 0,void 0,(function(){return s(this,(function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),ci=function(){function e(e,t){var n=t.channel,u=t.filter,c=t.startingPoint,l=t.limit,h=this;this._channel=null,this._messages=[],this._unsentMessages=[],this._readReceiptMap=new Map,this._deliveryReceiptMap=new Map,this._iid=e,this._key="mc-".concat(M()),this.filter=null!=u?u:new Ot,this._channel=n,this._syncRange=new Bs({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint=c||Date.now()+6e5,this._limit=l||100;var d=za.of(this._iid);d.subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n,a,o,u,c=ti(e,h._channel);if(c>=0)switch(ye((function(){return r(h,void 0,void 0,(function(){var n;return s(this,(function(r){return n=new Vs(t),this._channel=e[c],this._handler.onChannelUpdated(n,this.channel),[2]}))}))})),t){case Hs.EVENT_CHANNEL_UPDATED:var l=!1;for(var d in h._messages){if((g=h._messages[d]).createdAt>=h._channel.messageOffsetTimestamp){l=!0;var p=parseInt(d);if(p>0){var f=h._messages.splice(0,p);h._removeMessagesFromView(f.map((function(e){return e.messageId})),cn.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!l&&h._messages.length>0&&h._removeMessagesFromView(h._messages.map((function(e){return e.messageId})),cn.EVENT_MESSAGE_OFFSET_UPDATED);break;case Hs.EVENT_CHANNEL_READ:var _=[];try{for(var m=i(h._messages),v=m.next();!v.done;v=m.next()){var g=v.value;if((b=h._readReceiptMap.get(g.messageId))>0)b!==h._channel.getUnreadMemberCount(g)&&_.push(g)}}catch(e){n={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}_.length>0&&h._updateMessagesToView(_,cn.EVENT_MESSAGE_READ);break;case Hs.EVENT_CHANNEL_DELIVERED:_=[];try{for(var y=i(h._messages),E=y.next();!E.done;E=y.next()){var b;g=E.value;if((b=h._deliveryReceiptMap.get(g.messageId))>0)b!==h._channel.getUndeliveredMemberCount(g)&&_.push(g)}}catch(e){o={error:e}}finally{try{E&&!E.done&&(u=y.return)&&u.call(y)}finally{if(o)throw o.error}}_.length>0&&h._updateMessagesToView(_,cn.EVENT_MESSAGE_READ)}},onRemove:function(e,t){e.indexOf(h.channel.url)>=0&&ye((function(){return r(h,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new Vs(t),this._handler.onChannelDeleted(e,this.channel.url),[2]}))}))}))}}),d.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,s=[],a=[];try{for(var o=i(e),u=o.next();!u.done;u=o.next()){var c=u.value;c.channelUrl===h._channel.url&&(h.filter.match(c)?s.push(c):a.push(c.messageId))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}if(_n(t)){if(s.length>0)switch(t){case cn.EVENT_MESSAGE_SENT_FAILED:case cn.EVENT_MESSAGE_SENT_SUCCESS:case cn.EVENT_MESSAGE_UPDATED:case cn.EVENT_MESSAGE_THREADINFO_UPDATED:case cn.EVENT_MESSAGE_REACTION_UPDATED:case cn.SYNC_MESSAGE_CHANGELOGS:h._updateMessagesToView(s,t);break;case cn.EVENT_MESSAGE_SENT_PENDING:case cn.EVENT_MESSAGE_RECEIVED:case cn.SYNC_MESSAGE_FILL:h._addMessagesToView(s,t)}a.length>0&&h._removeMessagesFromView(a,t)}},onRemove:function(e,t){h._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){h._removeUnsentMessageFromView(e,t)}});var p=Ya.of(this._iid).cacheContext;!this._channel.isSuper&&p.localCacheEnabled&&zs.of(this._iid,this._channel).resume(),Ws.of(this._iid,this._channel).resume(),this._prevFill=new Gs(this._key,(function(e){return r(h,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._limit,source:cn.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.min.apply(Math,o([],a(t.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(n),[2,{hasNext:t.length>=this._limit&&this.viewTop<n,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}}))}))})),this._nextFill=new Gs(this._key,(function(e){return r(h,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._limit,source:cn.SYNC_MESSAGE_FILL})];case 1:return(t=r.sent()).length>0?(n=Math.max.apply(Math,o([],a(t.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(n),[2,{hasNext:!(t.length>=this._limit&&this._hasNext)||this.viewBottom>n,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}}))}))}));var f=Ya.of(this._iid),_=f.dispatcher,m=f.logger;_.on((function(e){if(e instanceof ce)if(e.stateType===Y.CONNECTED)m.debug("check huge gap"),h._checkHugeGap();else h._prevFill.stop(),h._nextFill.stop()}))}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return o([],a(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===ue.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===ue.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,o(o([],a(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,o(o([],a(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype.setMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){var t=this;return e.filter((function(e){return e.createdAt>=t._channel.messageOffsetTimestamp}))},e.prototype._addMessagesToView=function(e,t){var n,u,c=this,l=this._filterUnderOffsetMessage(e),h=[],d=[];try{for(var p=i(l),f=p.next();!f.done;f=p.next()){var _=f.value;if(_.messageId>0){if((y=si(this._messages,_))<0){var m=si(this._unsentMessages,_);m<0?h.push(_):(this._unsentMessages.splice(m,1),d.push(_));var v=ii(this._messages,_);this._messages.splice(v,0,_)}else d.push(_),this._messages[y]=_;if(this._readReceiptMap.set(_.messageId,this._channel.getUnreadMemberCount(_)),this._deliveryReceiptMap.set(_.messageId,this._channel.getUndeliveredMemberCount(_)),_.updatedAt>0){var g=this._updateChildMessagesInView(_);d.push.apply(d,o([],a(g),!1))}}else{var y;if(_ instanceof Dt)(y=si(this._unsentMessages,_))<0?si(this._messages,_)<0&&(this._unsentMessages.push(_),h.push(_)):(d.push(_),this._unsentMessages[y]=_)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(u=p.return)&&u.call(p)}finally{if(n)throw n.error}}_n(t)&&ye((function(){return r(c,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new Qs(t),h.length>0&&this._handler.onMessagesAdded(e,this.channel,h),d.length>0&&this._handler.onMessagesUpdated(e,this.channel,d),[2]}))}))}))},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n.applyParentMessage(e)&&t.push(n)})),t},e.prototype._updateMessagesToView=function(e,t){var n,a,o=this,u=[];try{for(var c=i(e),l=c.next();!l.done;l=c.next()){var h,d=l.value;if(d.messageId>0)if((h=si(this._messages,d))>=0)u.push(d),this._messages[h]=d;else{var p=si(this._unsentMessages,d);if(p>=0){u.push(d),this._unsentMessages.splice(p,1);var f=ii(this._messages,d);this._messages.splice(f,0,d)}}else if(d instanceof Dt)(h=si(this._unsentMessages,d))>=0&&(u.push(d),this._unsentMessages[h]=d)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return _n(t)&&ye((function(){return r(o,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new Qs(t),u.length>0&&this._handler.onMessagesUpdated(e,this.channel,u),[2]}))}))})),u},e.prototype._removeMessagesFromView=function(e,t){var n,a,o=this,u=[],c=function(e){var t=l._messages.findIndex((function(t){return t.messageId===e}));t>=0&&(u.push(l._messages[t].messageId),l._messages.splice(t,1))},l=this;try{for(var h=i(e),d=h.next();!d.done;d=h.next()){c(d.value)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}return _n(t)&&u.length>0&&ye((function(){return r(o,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new Qs(t),u.length>0&&this._handler.onMessagesDeleted(e,this.channel,u),[2]}))}))})),u},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,i=void 0===n?0:n,u=t.nextLimit,c=void 0===u?0:u;return r(this,void 0,void 0,(function(){var t,n,r,u,l,h,d;return s(this,(function(s){switch(s.label){case 0:return t=za.of(this._iid),i>0?[4,t.getMessagesFromCache(this._channel.url,e,"prev",this.filter,this._limit)]:[3,2];case 1:return r=s.sent(),[3,3];case 2:r=[],s.label=3;case 3:return n=r,c>0?[4,t.getMessagesFromCache(this._channel.url,e,"next",this.filter,this._limit)]:[3,5];case 4:return l=s.sent(),[3,6];case 5:l=[],s.label=6;case 6:if(u=l,n.length>0&&u.length)for(d in h=n.map((function(e){return e.messageId})),u)if(h.includes(u[d].messageId)){u.splice(parseInt(d),1);break}return[2,o(o([],a(n),!1),a(u),!1).sort((function(e,t){return t.createdAt-e.createdAt}))]}}))}))},e.prototype._getRemoteMessages=function(e,t){var i=t.prevLimit,a=void 0===i?0:i,o=t.nextLimit,u=void 0===o?0:o,c=t.source,l=void 0===c?cn.REQUEST_MESSAGE:c;return r(this,void 0,void 0,(function(){var t,r;return s(this,(function(s){switch(s.label){case 0:return t=Mn.of(this._iid),a>0||u>0?[4,t.getMessagesByTimestamp(this._channel.url,this._channel.channelType,e,n(n({},this.filter),{prevResultSize:a,nextResultSize:u,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),l)]:[3,2];case 1:return r=s.sent(),[3,3];case 2:r=[],s.label=3;case 3:return[2,r]}}))}))},e.prototype._checkHugeGap=function(){return r(this,void 0,void 0,(function(){var e,t,i,u,c,l,h,d,p,f,_=this;return s(this,(function(m){switch(m.label){case 0:return this._messages.length>0?(e=this.viewTop,t=this._syncRange.top,i=this._syncRange.bottom,u=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,(c=za.of(this._iid)).getCachedMessageCountBetween(this._channel.url,this.filter,e,t)]):[3,4];case 1:return l=m.sent(),[4,c.getCachedMessageCountBetween(this._channel.url,this.filter,i,u)];case 2:return h=m.sent(),[4,ge((function(){return r(_,void 0,void 0,(function(){var c,d,p,f,_,m,v,g,y,E,b,N,T,I,C,S,A,M=this;return s(this,(function(w){switch(w.label){case 0:return c=Ya.of(this._iid),d=c.dispatcher,p=c.requestQueue,f=new $s(n({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:e,prevEnd:t,prevCount:l,nextStart:i,nextEnd:u,nextCount:h},this.filter)),[4,p.send(f)];case 1:return _=w.sent(),m=_.as(ei),v=m.isHugeGap,g=m.prevMessages,y=void 0===g?[]:g,E=m.prevHasMore,b=m.nextMessages,N=void 0===b?[]:b,T=m.nextHasmore,v?ye((function(){return r(M,void 0,void 0,(function(){return s(this,(function(e){return this._handler.onHugeGapDetected(),[2]}))}))})):(this._hasPrevious=E,this._hasNext=T,I=this.viewTop,C=this.viewBottom,S=Math.min.apply(Math,o([Number.MAX_SAFE_INTEGER],a(y.map((function(e){return e.createdAt}))),!1)),A=Math.max.apply(Math,o([0],a(N.map((function(e){return e.createdAt}))),!1)),d.dispatch(new mn({messages:y,source:cn.SYNC_MESSAGE_FILL})),d.dispatch(new mn({messages:N,source:cn.SYNC_MESSAGE_FILL})),this._syncRange.extends(S,A),I<S&&this._prevFill.start(S),C>A&&this._nextFill.start(A)),[2]}}))}))}),1)];case 3:return m.sent(),[3,6];case 4:return d=Math.floor(this._limit/2),[4,this._getRemoteMessages(Date.now(),{prevLimit:d,nextLimit:d,source:cn.SYNC_MESSAGE_FILL})];case 5:(p=m.sent()).length>0&&((f=this._syncRange).extends.apply(f,o([],a(p.map((function(e){return e.createdAt}))),!1)),p.length<d&&(this._hasPrevious=!1,this._hasNext=!1)),m.label=6;case 6:return[2]}}))}))},e.prototype._loadAllFailedMessages=function(){return r(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,za.of(this._iid).getAllFailedMessagesFromCache(this._channel.url,this.filter)];case 1:return e=t.sent(),this._unsentMessages=e,[2,e]}}))}))},e.prototype.initialize=function(e){var t=this,n=new ui;this._messages=[],this._unsentMessages=[],this._syncRange=new Bs({}),this._hasNext=!0,this._hasPrevious=!0;var r=Math.floor(this._limit/2);if(e===Ys.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){var r=t._filterUnderOffsetMessage(e);t._addMessagesToView(r,cn.REQUEST_MESSAGE),n._invokeResponse("local",null,r)})).catch((function(e){if(d(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){t._loadAllFailedMessages(),t._getRemoteMessages(t._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){var s;t._messages=[];var i=t._filterUnderOffsetMessage(e);i.length<r&&(t._hasPrevious=!1,t._hasNext=!1),i.length>0&&((s=t._syncRange).extends.apply(s,o([],a(i.map((function(e){return e.createdAt}))),!1)),t._addMessagesToView(i,cn.REQUEST_MESSAGE)),n._invokeResponse("remote",null,i)})).catch((function(e){if(d(e))throw e;n._invokeResponse("remote",e,null)}))}));return n},e.prototype.loadPrevious=function(){return r(this,void 0,void 0,(function(){var e,t,n,i,u=this;return s(this,(function(c){switch(c.label){case 0:return this._hasPrevious?(e=this.viewTop,t=[],[4,Ee((function(){return r(u,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{prevLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}}))}))}))]):[3,5];case 1:return c.sent(),n=zs.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,Ee((function(){return r(u,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{prevLimit:this._limit})];case 1:return t=r.apply(this,[s.sent()]),this._hasPrevious=t.length>=this._limit,t.length>0&&((i=this._syncRange).extends.apply(i,o([],a(t.map((function(e){return e.createdAt}))),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.top)),[2]}}))}))}))];case 2:return c.sent(),this._addMessagesToView(t,cn.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=t.length>=this._limit,t.length>0&&((i=this._syncRange).extends.apply(i,o([],a(t.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(t,cn.REQUEST_MESSAGE)),c.label=4;case 4:return[2,t];case 5:return[2,[]]}}))}))},e.prototype.loadNext=function(){return r(this,void 0,void 0,(function(){var e,t,n,i,u=this;return s(this,(function(c){switch(c.label){case 0:return e=this.viewBottom,t=[],[4,Ee((function(){return r(u,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=this._filterUnderOffsetMessage,[4,this._getLocalMessages(e,{nextLimit:this._limit})];case 1:return t=n.apply(this,[r.sent()]),[2]}}))}))}))];case 1:return c.sent(),n=zs.of(this._iid,this._channel),0!==t.length&&n.isWrappingMessages(t)?[3,3]:[4,Ee((function(){return r(u,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getRemoteMessages(e,{nextLimit:this._limit})];case 1:return t=r.apply(this,[s.sent()]),this._hasNext=t.length>=this._limit,t.length>0&&((i=this._syncRange).extends.apply(i,o([],a(t.map((function(e){return e.createdAt}))),!1)),n.range.overlap(this._syncRange)&&n.range.extends(this._syncRange.bottom)),[2]}}))}))}))];case 2:return c.sent(),this._addMessagesToView(t,cn.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=t.length>=this._limit,t.length>0&&((i=this._syncRange).extends.apply(i,o([],a(t.map((function(e){return e.createdAt}))),!1)),this._addMessagesToView(t,cn.REQUEST_MESSAGE)),c.label=4;case 4:return[2,t]}}))}))},e.prototype.removeFailedMessage=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,za.of(this._iid).removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){var e=za.of(this._iid);e.unsubscribeGroupChannelEvent(this._key),e.unsubscribeMessageEvent(this._key)},e}(),li={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},hi={hidePreviousMessages:!1,allowAutoUnhide:!0},di=function(e){function n(t){var n=this,r=t.channelUrl,s=t.token,i=t.limit,a=t.order,o=t.mutedMemberFilter,u=t.memberStateFilter,c=t.nicknameStartsWithFilter,l=t.operatorFilter;return(n=e.call(this)||this).method=h.GET,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/members"),n.params={token:s,limit:i,order:a,muted_member_filter:o,member_state_filter:u,nickname_startswith:c,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return t(n,e),n}(P),pi=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.token=null,r.members=[];var s=n.next,i=n.members;return r.token=s,i&&i.length>0&&(r.members=i.map((function(e){return new Nr(t,e)}))),r}return t(n,e),n}(k);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(ai||(ai={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(oi||(oi={}));var fi=function(e){function i(t,n,r){var s,i,a,o,u=this;return(u=e.call(this,t,n,ee.GROUP,r)||this).mutedMemberFilter=ai.ALL,u.memberStateFilter=Kn.ALL,u.nicknameStartsWithFilter=null,u.operatorFilter=Xn.ALL,u.order=oi.MEMBER_NICKNAME_ALPHABETICAL,u.mutedMemberFilter=null!==(s=r.mutedMemberFilter)&&void 0!==s?s:ai.ALL,u.memberStateFilter=null!==(i=r.memberStateFilter)&&void 0!==i?i:Kn.ALL,u.nicknameStartsWithFilter=null!==(a=r.nicknameStartsWithFilter)&&void 0!==a?a:null,u.order=null!==(o=r.order)&&void 0!==o?o:oi.MEMBER_NICKNAME_ALPHABETICAL,u}return t(i,e),i.prototype._validate=function(){return e.prototype._validate.call(this)&&g(ai,this.mutedMemberFilter)&&g(Kn,this.memberStateFilter)&&(v("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&g(Xn,this.operatorFilter)&&g(oi,this.order)},i.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=Ya.of(this._iid).requestQueue,t=new di(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=s.sent(),i=r.as(pi),a=i.members,o=i.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},i}(en),_i=function(e){function n(t){var n=t.channelUrl,r=t.isInternalCall,s=e.call(this)||this;return s.method=h.GET,s.path="".concat(r?ke:Pe,"/").concat(encodeURIComponent(n)),s.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},s}return t(n,e),n}(P),mi=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=null,r.channel=new va(t,n),r}return t(n,e),n}(k),vi=function(e){function n(t){var n=t.channelUrl;return e.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return t(n,e),n}(j),gi=function(e){function n(t,n,r){var s=e.call(this,t,"READ",r)||this;return s.readStatus=new Ir(t,r),s}return t(n,e),n}(B),yi=function(e){function n(t){var n=t.channelUrl,r=t.userId,s=e.call(this)||this;return(s=e.call(this)||this).method=h.PUT,s.path="".concat(Pe,"/").concat(encodeURIComponent(n),"/messages/mark_as_delivered"),s.params=O({userId:r}),s}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var Ei=function(e){function n(t,n,r){var s=e.call(this,t,"DLVR",r)||this;return s.channelUrl=r.channel_url,s.deliveredStateUpdate=r.updated,s}return t(n,e),n}(B),bi=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.event=new fr(r),s}return t(n,e),n}(B),Ni=function(e){function n(t){var n=this,r=t.channelUrl,s=t.userIds;return(n=e.call(this)||this).method=h.POST,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:s},n}return t(n,e),n}(P),Ti=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=new va(t,n),r}return t(n,e),n}(k),Ii=function(e){function n(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u,l=i.inviter,h=void 0===l?null:l,d=i.invitees,p=void 0===d?[]:d;return s.memberCount=o,s.joinedMemberCount=c,s.inviter=h?new ot(t,h):null,s.invitees=p.map((function(e){return new Nr(t,e)})),s}return t(n,e),n}(bi),Ci=function(e){function n(t){var n=this,r=t.channelUrl,s=t.userId,i=t.accessCode;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:s,access_code:i},n}return t(n,e),n}(P),Si=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=new va(t,n),r.channel.myMemberState=_r.JOINED,r}return t(n,e),n}(k),Ai=function(e){function n(t){var n=this,r=t.channelUrl,s=t.userId;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:s},n}return t(n,e),n}(P),Mi=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=new va(t,n),r.channel.myMemberState=_r.NONE,r}return t(n,e),n}(k),wi=function(e){function n(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u,l=i.inviter,h=void 0===l?null:l,d=i.invitee,p=void 0===d?null:d;return s.memberCount=o,s.joinedMemberCount=c,s.inviter=h?new ot(t,h):null,s.invitee=p?new Nr(t,p):null,s}return t(n,e),n}(bi),Ui=function(e){function n(t){var n=this,r=t.channelUrl,s=t.userId,i=t.accessCode;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:s,access_code:i},n}return t(n,e),n}(P),Ri=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=new va(t,n),r}return t(n,e),n}(k),Di=function(e){function n(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u,l=i.users,h=void 0===l?null:l;return s.memberCount=o,s.joinedMemberCount=c,s.members=Array.isArray(h)?h.map((function(e){return new Nr(t,e)})):[new Nr(t,r.data)],s}return t(n,e),n}(bi),Oi=function(e){function n(t){var n=this,r=t.channelUrl,s=t.userId,i=t.shouldRemoveOperatorStatus;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:s,should_remove_operator_status:i},n}return t(n,e),n}(P);!function(e){function n(t,n){return e.call(this,t,n)||this}t(n,e)}(k);var Li=function(e){function n(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data,a=i.member_count,o=void 0===a?null:a,u=i.joined_member_count,c=void 0===u?null:u;return s.memberCount=o,s.joinedMemberCount=c,s.member=new Nr(s._iid,r.data),s}return t(n,e),n}(bi),Pi=function(e){function n(t){var n=this,r=t.channelUrl,s=t.isDistinct,i=t.isPublic,a=t.isDiscoverable,o=t.coverUrl,u=t.coverImage,c=t.accessCode,l=t.name,d=t.data,p=t.customType,f=t.operatorUserIds,_=t.messageSurvivalSeconds;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r)),n.params=O({is_distinct:s,is_public:i,is_discoverable:a,name:l,data:d,custom_type:p,cover_url:o,cover_file:u,access_code:c,operator_ids:f,message_survival_seconds:_}),n}return t(n,e),n}(P),ki=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=new va(t,n),r}return t(n,e),n}(k),Fi=function(e){function n(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(Pe,"/").concat(encodeURIComponent(r)),n}return t(n,e),n}(P);!function(e){function n(t,n){return e.call(this,t,n)||this}t(n,e)}(k);var xi=function(e){function n(t){var n=this,r=t.channelUrl,s=t.userId,i=t.hidePreviousMessages,a=t.allowAutoUnhide;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:s,hide_previous_messages:i,allow_auto_unhide:a},n}return t(n,e),n}(P),qi=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return t(n,e),n}(k),Hi=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,r.data&&(s.allowAutoUnhide=r.data.allow_auto_unhide,s.hidePreviousMessages=r.data.hide_previous_messages),s.messageOffsetTimestamp=r.ts_message_offset,s}return t(n,e),n}(B),Gi=function(e){function n(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=h.DELETE,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/hide"),n}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var Vi=function(e){function n(t){var n=t.userId,r=e.call(this)||this;return r.method=h.GET,r.path="".concat(Oe,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(n,e),n}(P),Qi=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return t(n,e),n}(k),Bi=function(e){function n(t){var n=t.userId,r=t.pushTriggerOption,s=e.call(this)||this;return s.method=h.PUT,s.path="".concat(Oe,"/").concat(encodeURIComponent(n),"/push_preference"),s.params={push_trigger_option:r},s}return t(n,e),n}(P),ji=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return t(n,e),n}(k),zi=function(e){function n(t){var n=t.userId,r=t.channelUrl,s=t.countPreference,i=e.call(this)||this;return i.method=h.PUT,i.path="".concat(Oe,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),i.params={count_preference:s},i}return t(n,e),n}(P),Ki=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.countPreference=ha[n.count_preference],r}return t(n,e),n}(k),Wi=function(e){function n(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return t(n,e),n}(j),Yi=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.user=new ot(t,r.data),s}return t(n,e),n}(B),Ji=function(e){function n(t){var n=t.channelUrl,r=t.time;return e.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return t(n,e),n}(j),Xi=function(e){function n(t,n,r){var s=e.call(this,t,"SYEV",r)||this;return s.user=new ot(t,r.data),s}return t(n,e),n}(B),Zi=function(e){function n(t){var n=this,r=t.channelUrl;return(n=e.call(this)||this).method=h.PUT,n.path="".concat(Pe,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return t(n,e),n}(P),$i=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.messageOffsetTimestamp=null;var s=n.ts_message_offset;return r.messageOffsetTimestamp=null!=s?s:null,r}return t(n,e),n}(k),ea=n(n({},On),{scheduledAt:null}),ta=function(e){function n(t){var n,r=this;r=e.call(this)||this;var s=[];t.mentionType===ie.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId}))));var i=t.channelType,a=t.channelUrl;return r.method=h.POST,r.path="".concat(ze(i),"/").concat(encodeURIComponent(a),"/scheduled_messages"),r.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:se.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return It.payloadify(e)})),apple_critical_alert_options:At.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption},r}return t(n,e),n}(P),na=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.message=new Gt(t,n),r}return t(n,e),n}(k),ra=n(n({},Rn),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),sa=function(e){function n(t){var n,r=this;r=e.call(this)||this;var s=[];t.mentionType===ie.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId}))));var i=t.channelType,a=t.channelUrl;return r.method=h.POST,r.path="".concat(ze(i),"/").concat(encodeURIComponent(a),"/scheduled_messages"),r.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:se.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes.map((function(e){return kt.payloadify(e)})),custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return It.payloadify(e)})),apple_critical_alert_options:At.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption},r}return t(n,e),n}(P),ia=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.message=new Bt(t,n),r}return t(n,e),n}(k),aa=n(n({},Cr),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),oa=n(n({},Ar),{scheduledAt:null}),ua=function(e){function n(t){var n,r=this;r=e.call(this)||this;var s=[];t.mentionType===ie.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId}))));var i=t.channelType,a=t.channelUrl,o=t.scheduledMessageId;return r.method=h.PUT,r.path="".concat(ze(i),"/").concat(encodeURIComponent(a),"/scheduled_messages/").concat(encodeURIComponent(o)),r.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:se.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes.map((function(e){return kt.payloadify(e)})),custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return It.payloadify(e)})),apple_critical_alert_options:At.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption},r}return t(n,e),n}(P),ca=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.message=new Bt(t,n),r}return t(n,e),n}(k),la=function(e){function n(t){var n,r=this;r=e.call(this)||this;var s=[];t.mentionType===ie.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId}))));var i=t.channelType,a=t.channelUrl,o=t.scheduledMessageId;return r.method=h.PUT,r.path="".concat(ze(i),"/").concat(encodeURIComponent(a),"/scheduled_messages/").concat(encodeURIComponent(o)),r.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:se.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return It.payloadify(e)})),apple_critical_alert_options:At.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption},r}return t(n,e),n}(P);!function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.message=new Gt(t,n),r}t(n,e)}(k);var ha,da,pa,fa,_a=function(e){function n(t){var n=e.call(this)||this,r=t.channelType,s=t.channelUrl,i=t.scheduledMessageId;return n.method=h.DELETE,n.path="".concat(ze(r),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(i)),n}return t(n,e),n}(P),ma=function(e){function n(t){var n=e.call(this)||this,r=t.channelType,s=t.channelUrl,i=t.scheduledMessageId;return n.method=h.POST,n.path="".concat(ze(r),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(i),"/send_now"),n}return t(n,e),n}(P);!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(ha||(ha={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted"}(da||(da={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(pa||(pa={})),function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(fa||(fa={}));var va=function(e){function u(t,r){var s,i,u,c,l,h,d,p,f,_,m,y,E,b,N,T,I,C,S=this;return(S=e.call(this,t,r)||this)._unreadMemberStateMap=new Map,S._undeliveredMemberStateMap=new Map,S._typingStatus=new Map,S._lastMemberCountUpdated=0,S._typingStarted=0,S._typingEnded=0,S.isDistinct=!1,S.isSuper=!1,S.isBroadcast=!1,S.isExclusive=!1,S.isPublic=!1,S.isDiscoverable=!0,S.isAccessCodeRequired=!1,S.isPushEnabled=!1,S.unreadMessageCount=0,S.unreadMentionCount=0,S.members=[],S.memberCount=0,S.joinedMemberCount=0,S.hiddenState=pa.UNHIDDEN,S.lastMessage=null,S.messageOffsetTimestamp=0,S.messageSurvivalSeconds=-1,S.myMemberState=_r.NONE,S.myRole=te.NONE,S.myMutedState=da.UNMUTED,S.myLastRead=0,S.myCountPreference=ha.ALL,S.myPushTriggerOption=yr.DEFAULT,S.inviter=null,S.invitedAt=0,S.joinedAt=0,S.channelType=ee.GROUP,S.isDistinct=null!==(i=r.is_distinct)&&void 0!==i&&i,S.isSuper=null!==(u=r.is_super)&&void 0!==u&&u,S.isBroadcast=null!==(c=r.is_broadcast)&&void 0!==c&&c,S.isExclusive=null!==(l=r.is_exclusive)&&void 0!==l&&l,S.isPublic=null!==(h=r.is_public)&&void 0!==h&&h,S.isDiscoverable=null!==(d=r.is_discoverable)&&void 0!==d?d:S.isPublic,S.isAccessCodeRequired=null!==(p=r.is_access_code_required)&&void 0!==p&&p,S.isPushEnabled=null!==(f=r.is_push_enabled)&&void 0!==f&&f,Array.isArray(r.members)&&(s=S.members).push.apply(s,o([],a(r.members.map((function(e){return new Nr(S._iid,e)}))),!1)),S.memberCount=null!==(_=r.member_count)&&void 0!==_?_:0,S.joinedMemberCount=null!==(m=r.joined_member_count)&&void 0!==m?m:0,S.hiddenState=g(pa,r.hidden_state)?r.hidden_state:pa.UNHIDDEN,S.messageOffsetTimestamp=null!==(y=r.ts_message_offset)&&void 0!==y?y:0,S.messageSurvivalSeconds=null!==(E=r.message_survival_seconds)&&void 0!==E?E:-1,S.lastMessage=r.last_message?Qt(S._iid,n({channel_type:S.channelType},r.last_message)):null,r.read_receipt&&Object.keys(r.read_receipt).forEach((function(e){v("number",r.read_receipt[e])&&S._updateUnreadMemberState(e,r.read_receipt[e])})),r.delivery_receipt&&Object.keys(r.delivery_receipt).forEach((function(e){v("number",r.delivery_receipt[e])&&S._updateUndeliveredMemberState(e,r.delivery_receipt[e])})),S.myMemberState=g(_r,r.member_state)?r.member_state:_r.NONE,S.myRole=g(te,r.my_role)?r.my_role:te.NONE,g(da,r.is_muted)?S.myMutedState=r.is_muted:v("boolean",r.is_muted)?S.myMutedState=r.is_muted?da.MUTED:da.UNMUTED:S.myMutedState=da.UNMUTED,S.myCountPreference=g(ha,r.count_preference)?r.count_preference:ha.ALL,S.myPushTriggerOption=g(yr,r.push_trigger_option)?r.push_trigger_option:yr.ALL,S.myLastRead=null!==(b=r.user_last_read)&&void 0!==b?b:0,S.inviter=r.inviter?new ot(S._iid,r.inviter):null,S.invitedAt=null!==(N=r.invited_at)&&void 0!==N?N:0,S.joinedAt=null!==(T=r.joined_ts)&&void 0!==T?T:0,S._updateUnreadCount(null!==(I=r.unread_message_count)&&void 0!==I?I:0,null!==(C=r.unread_mention_count)&&void 0!==C?C:0),S}return t(u,e),Object.defineProperty(u.prototype,"isHidden",{get:function(){return this.hiddenState!==pa.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"isTyping",{get:function(){return Object.keys(this._typingStatus).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=i(this._unreadMemberStateMap),s=r.next();!s.done;s=r.next()){var o=a(s.value,2),u=o[0],c=o[1];n[u]=c}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=i(this._undeliveredMemberStateMap),s=r.next();!s.done;s=r.next()){var o=a(s.value,2),u=o[0],c=o[1];n[u]=c}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),u.payloadify=function(t){return t?O(n(n({},e.payloadify.call(this,t)),{is_access_code_required:t.isAccessCodeRequired,is_distinct:t.isDistinct,is_super:t.isSuper,is_broadcast:t.isBroadcast,is_exclusive:t.isExclusive,is_public:t.isPublic,is_discoverable:t.isDiscoverable,is_muted:t.myMutedState,is_push_enabled:t.isPushEnabled,unread_message_count:t.unreadMessageCount,unread_mention_count:t.unreadMentionCount,push_trigger_option:t.myPushTriggerOption,count_preference:t.myCountPreference,hidden_state:t.hiddenState,member_count:t.memberCount,joined_member_count:t.joinedMemberCount,member_state:t.myMemberState,my_role:t.myRole,user_last_read:t.myLastRead,ts_message_offset:t.messageOffsetTimestamp,message_survival_seconds:t.messageSurvivalSeconds,read_receipt:t.cachedUnreadMemberState,delivery_receipt:t.cachedUndeliveredMemberState,members:t.members.map((function(e){return Nr.payloadify(e)})),last_message:Vt(t.lastMessage),inviter:t.inviter?ot.payloadify(t.inviter):null,invited_at:t.invitedAt,joined_ts:t.joinedAt})):null},u.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===ha.ALL||this.myCountPreference===ha.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=Ya.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===ha.ALL||this.myCountPreference===ha.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},u.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),Ya.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},u.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);(!n||n<t)&&this._undeliveredMemberStateMap.set(e,t)},u.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus[e.userId]={user:e,ts:t}:delete this._typingStatus[e.userId]},u.prototype._invalidateTypingStatus=function(){var e=(new Date).getTime(),t=!1;for(var n in this._typingStatus){e-this._typingStatus[n].ts>=1e4&&(delete this._typingStatus[n],t=!0)}return t},u.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},u.prototype.isReadMessage=function(e){var t=Ya.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt},u.prototype.serialize=function(){var e=this;return rt(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))},u.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new ci(this._iid,n({channel:this},e))},u.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new fi(this._iid,this.url,e)},u.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var r=this.members[n];r.state===_r.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},u.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=this.members.findIndex((function(t){return t.userId===e.userId}));if(t>-1)return this.members.splice(t,1),this.memberCount--,!0}return!1},u.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof Dt&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=Ya.of(this._iid).sdkState,s=e.createdAt,a=0;try{for(var o=i(this.members),u=o.next();!u.done;u=o.next()){var c=u.value;if(r.userId!==c.userId&&c.state===_r.JOINED&&e.sender.userId!==c.userId)(this.cachedUnreadMemberState[c.userId]||0)<s&&a++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}return 0},u.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof Dt&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=Ya.of(this._iid).sdkState,s=e.createdAt,a=0;try{for(var o=i(this.members),u=o.next();!u.done;u=o.next()){var c=u.value;if(r.userId!==c.userId&&c.state===_r.JOINED&&e.sender.userId!==c.userId)(this.cachedUndeliveredMemberState[c.userId]||0)<s&&a++}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}return 0},u.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=Ya.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=[];return this.members.forEach((function(i){(t||i.userId!==r.userId&&i.userId!==e.sender.userId)&&(n._unreadMemberStateMap.get(i.userId)>=e.createdAt&&s.push(i))})),s},u.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=Ya.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=[];return this.members.forEach((function(i){(t||i.userId!==r.userId&&i.userId!==e.sender.userId)&&(n._unreadMemberStateMap.get(i.userId)<e.createdAt&&s.push(i))})),s},u.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=Ya.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(s){if(e||s.userId!==n.userId){var i=t._unreadMemberStateMap.get(s.userId);r[s.userId]=new Ir(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Nr.payloadify(s),ts:i})}})),r},u.prototype.getTypingUsers=function(){var e=[];for(var t in this._typingStatus){var n=this._typingStatus[t].user;e.push(n)}return e},u.prototype.invalidateTypingStatus=function(){var e=Ya.of(this._iid).typingIndicatorInvalidateTime,t=(new Date).getTime(),n=!1;for(var r in this._typingStatus){t-this._typingStatus[r].ts>=e&&(delete this._typingStatus[r],n=!0)}return n},u.prototype.refresh=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.requestQueue,n=e.dispatcher,r=new _i({channelUrl:this.url}),[4,t.send(r)];case 1:return i=s.sent(),a=i.as(mi).channel,n.dispatch(new Xs({channels:[a],source:Hs.REQUEST_CHANNEL})),[2,a]}}))}))},u.prototype.freeze=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.prototype.freeze.call(this)];case 1:return t.sent(),Ya.of(this._iid).dispatcher.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_HIDDEN})),[2]}}))}))},u.prototype.unfreeze=function(){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,e.prototype.unfreeze.call(this)];case 1:return t.sent(),Ya.of(this._iid).dispatcher.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_UNHIDDEN})),[2]}}))}))},u.prototype.updateChannel=function(e){return r(this,void 0,void 0,(function(){var t,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return e=n(n({},li),e),it(function(e){return v("string",e.coverUrl,!0)&&(N(e.coverImage)||v("string",e.coverImage)||null===e.coverImage)&&v("boolean",e.isDistinct,!0)&&v("boolean",e.isPublic,!0)&&v("boolean",e.isDiscoverable,!0)&&v("string",e.accessCode,!0)&&v("string",e.name,!0)&&v("string",e.data,!0)&&v("string",e.customType,!0)&&E("string",e.operatorUserIds,!0)&&v("number",e.messageSurvivalSeconds,!0)}(e)).throw(p.invalidParameters),t=Ya.of(this._iid),r=t.dispatcher,i=t.requestQueue,a=new Pi(n({channelUrl:this.url},e)),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(ki).channel,r.dispatch(new Xs({channels:[u],source:Hs.EVENT_CHANNEL_UPDATED})),[2,u]}}))}))},u.prototype.invite=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){return it(e.every((function(e){return e instanceof ot}))).throw(p.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},u.prototype.inviteWithUserIds=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return it(E("string",e)).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.dispatcher,r=t.requestQueue,i=new Ni({channelUrl:this.url,userIds:e}),[4,r.send(i)];case 1:return a=s.sent(),o=a.as(Ti).channel,n.dispatch(new Xs({channels:[o],source:Hs.EVENT_CHANNEL_INVITED})),[2,o]}}))}))},u.prototype.join=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,(function(){var t,n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)||null===e).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new Ui({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,i.send(a)];case 1:return o=s.sent(),(u=o.as(Ri).channel).myMemberState=_r.JOINED,n.dispatch(new Xs({channels:[u],source:Hs.EVENT_CHANNEL_JOINED})),[2,this]}}))}))},u.prototype.leave=function(e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Oi({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},u.prototype.acceptInvitation=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,(function(){var t,n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)||null===e).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new Ci({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,i.send(a)];case 1:return o=s.sent(),(u=o.as(Si).channel).myMemberState=_r.JOINED,n.dispatch(new Xs({channels:[u],source:Hs.EVENT_CHANNEL_ACCEPTED_INVITE})),[2,u]}}))}))},u.prototype.declineInvitation=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ai({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),(a=i.as(Mi).channel).myMemberState=_r.NONE,[2,a]}}))}))},u.prototype.sendUserMessage=function(t){var n=this,r=new zt,s=Ya.of(this._iid),i=s.dispatcher,a=s.autoResendManager;return e.prototype.sendUserMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){t&&a.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(e){var t=za.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n.lastMessage=e,t.handlers.map((function(e){return e.onChannelChanged(n)})),i.dispatch(new Xs({channels:[n],source:Hs.EVENT_MESSAGE_SENT})),r._trigger(null,e)})),r},u.prototype._autoResendUserMessage=function(t){var n=this,r=new zt,s=Ya.of(this._iid),i=s.dispatcher,a=s.autoResendManager;return e.prototype._autoResendUserMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){a.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(e){var t=za.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n.lastMessage=e,t.handlers.map((function(e){return e.onChannelChanged(n)})),i.dispatch(new Xs({channels:[n],source:Hs.EVENT_MESSAGE_SENT})),r._trigger(null,e)})),r},u.prototype.sendFileMessage=function(t){var n=this,r=new zt,s=Ya.of(this._iid),i=s.dispatcher,a=s.autoResendManager;return e.prototype.sendFileMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){t&&a.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(e){var t=za.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n.lastMessage=e,t.handlers.map((function(e){return e.onChannelChanged(n)})),i.dispatch(new Xs({channels:[n],source:Hs.EVENT_MESSAGE_SENT})),r._trigger(null,e)})),r},u.prototype._autoResendFileMessage=function(t){var n=this,r=new zt,s=Ya.of(this._iid),i=s.dispatcher,a=s.autoResendManager;return e.prototype._autoResendFileMessage.call(this,t).onPending((function(e){a.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){a.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(e){var t=za.of(n._iid);a.completeCurrentAndProcessNextAutoResend(e),n.lastMessage=e,t.handlers.map((function(e){return e.onChannelChanged(n)})),i.dispatch(new Xs({channels:[n],source:Hs.EVENT_MESSAGE_SENT})),r._trigger(null,e)})),r},u.prototype.deleteMessage=function(t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,e.prototype.deleteMessage.call(this,t)];case 1:return n.sent(),0===t.messageId&&Ya.of(this._iid).dispatcher.dispatch(new gn({reqId:t.reqId,source:cn.EVENT_MESSAGE_DELETED})),[2]}}))}))},u.prototype.hide=function(e){return r(this,void 0,void 0,(function(){var t,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return e=n(n({},hi),e),it(function(e){return v("boolean",e.hidePreviousMessages)&&v("boolean",e.allowAutoUnhide)}(e)).throw(p.invalidParameters),t=Ya.of(this._iid),r=t.dispatcher,i=t.sdkState,a=t.requestQueue,o=new xi(n({channelUrl:this.url,userId:i.userId},e)),[4,a.send(o)];case 1:return u=s.sent(),c=u.as(qi).messageOffsetTimestamp,this.hiddenState=e.allowAutoUnhide?pa.HIDDEN_ALLOW_AUTO_UNHIDE:pa.HIDDEN_PREVENT_AUTO_UNHIDE,e.hidePreviousMessages&&this._updateUnreadCount(0,0),c&&(this.messageOffsetTimestamp=c),r.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_HIDDEN})),[2,this]}}))}))},u.prototype.unhide=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new Gi({channelUrl:this.url}),[4,n.send(r)];case 1:return s.sent(),this.hiddenState=pa.UNHIDDEN,t.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_UNHIDDEN})),[2,this]}}))}))},u.prototype.delete=function(){return r(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return e=Ya.of(this._iid).requestQueue,t=new Fi({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},u.prototype.markAsRead=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a,o,u=this;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.sdkState,n=e.dispatcher,r=e.requestQueue,i=new vi({channelUrl:this.url}),[4,r.send(i)];case 1:return a=s.sent(),o=a.as(gi).readStatus,this._updateUnreadMemberState(t.userId,o.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),za.of(this._iid).handlers.map((function(e){return e.onChannelChanged(u)}))),n.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_READ})),[2]}}))}))},u.prototype.markAsDelivered=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new yi({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),[2]}}))}))},u.prototype.startTyping=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){return e=Ya.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,i=new Wi({channelUrl:this.url,time:this._typingStarted}),t.send(i)),[2]}))}))},u.prototype.endTyping=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){return e=Ya.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,i=new Ji({channelUrl:this.url,time:this._typingStarted}),t.send(i)),[2]}))}))},u.prototype.createScheduledUserMessage=function(e){return r(this,void 0,void 0,(function(){var t,r,i;return s(this,(function(s){switch(s.label){case 0:return e=n(n({},ea),e),it(function(e){return Ln(e)&&v("number",e.scheduledAt,!0)}(e)).throw(p.invalidParameters),t=Ya.of(this._iid).requestQueue,r=new ta(n({reqId:this._generateRequestId(),channelType:this.channelType,channelUrl:this.url},e)),[4,t.send(r)];case 1:return i=s.sent(),[2,i.as(na).message]}}))}))},u.prototype.updateScheduledUserMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,i,a;return s(this,(function(s){switch(s.label){case 0:return t=n(n({},oa),t),it(function(e){return Mr(e)&&v("number",e.scheduledAt,!0)}(t)).throw(p.invalidParameters),r=Ya.of(this._iid).requestQueue,i=new la(n({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},t)),[4,r.send(i)];case 1:return a=s.sent(),[2,a.as(na).message]}}))}))},u.prototype.createScheduledFileMessage=function(e){return r(this,void 0,void 0,(function(){var t,r;return s(this,(function(s){switch(s.label){case 0:return e=n(n({},ra),e),it(function(e){return Dn(e)&&v("number",e.scheduledAt)&&(N(e.file)||v("string",e.fileUrl))&&v("string",e.fileName,!0)&&v("string",e.mimeType,!0)&&v("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return v("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(e)).throw(p.invalidParameters),N(e.file)?[4,this._uploadFileAndUpdateParams(e)]:[3,2];case 1:s.sent(),s.label=2;case 2:return t=new sa(n(n({reqId:this._generateRequestId(),channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth})),[4,Ya.of(this._iid).requestQueue.send(t)];case 3:return r=s.sent(),[2,r.as(ia).message]}}))}))},u.prototype.updateScheduledFileMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return t=n(n({},aa),t),it(function(e){return Sr(e)&&v("number",e.scheduledAt,!0)&&(N(e.file)||v("string",e.fileUrl))&&v("string",e.fileName,!0)&&v("string",e.mimeType,!0)&&v("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return v("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(t)).throw(p.invalidParameters),N(t.file)?[4,this._uploadFileAndUpdateParams(t)]:[3,2];case 1:s.sent(),s.label=2;case 2:return r=new ua(n(n({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},t),{fileUrl:t.fileUrl,requireAuth:t.requireAuth})),[4,Ya.of(this._iid).requestQueue.send(r)];case 3:return i=s.sent(),[2,i.as(ca).message]}}))}))},u.prototype.cancelScheduledMessage=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=new _a({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,Ya.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},u.prototype.sendScheduledMessageNow=function(e){return r(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=new ma({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,Ya.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},u.prototype.getMyPushTriggerOption=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Vi({userId:t.userId}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Qi).pushTriggerOption]}}))}))},u.prototype.setMyPushTriggerOption=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return it(g(yr,e)).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Bi({userId:n.userId,pushTriggerOption:e}),[4,r.send(i)];case 1:return a=s.sent(),[2,a.as(ji).pushTriggerOption]}}))}))},u.prototype.setMyCountPreference=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return it(g(ha,e)).throw(p.invalidParameters),t=Ya.of(this._iid),n=t.dispatcher,r=t.sdkState,i=t.requestQueue,a=new zi({channelUrl:this.url,userId:r.userId,countPreference:e}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(Ki).countPreference,this.myCountPreference=u,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_CREATED})),[2,u]}}))}))},u.prototype.resetMyHistory=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return e=Ya.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new Zi({channelUrl:this.url}),[4,n.send(r)];case 1:return i=s.sent(),a=i.as($i).messageOffsetTimestamp,this.messageOffsetTimestamp=a,t.dispatch(new Xs({channels:[this],source:Hs.EVENT_CHANNEL_RESET_HISTORY})),[2,this]}}))}))},u.prototype._uploadFileAndUpdateParams=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c,l,h,d;return s(this,(function(s){switch(s.label){case 0:return N(e.file)?(t=Ya.of(this._iid).requestQueue,n=new Lt({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:r=s.sent(),i=r.as(Pt),a=i.url,o=i.fileSize,u=void 0===o?e.fileSize:o,c=i.thumbnailSizes,l=void 0===c?e.thumbnailSizes:c,h=i.requireAuth,d=void 0!==h&&h,e.fileUrl=a,e.fileSize=u,e.thumbnailSizes=l,e.requireAuth=d,s.label=2;case 2:return[2]}}))}))},u}(Ps),ga={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},ya=function(e){return E("string",e.invitedUserIds,!0)&&v("string",e.channelUrl,!0)&&v("string",e.coverUrl,!0)&&(N(e.coverImage)||v("string",e.coverImage)||null===e.coverImage)&&v("boolean",e.isDistinct,!0)&&v("boolean",e.isSuper,!0)&&v("boolean",e.isBroadcast,!0)&&v("boolean",e.isExclusive,!0)&&v("boolean",e.isPublic,!0)&&v("boolean",e.isStrict,!0)&&v("boolean",e.isDiscoverable,!0)&&v("boolean",e.isEphemeral,!0)&&v("string",e.accessCode,!0)&&v("string",e.name,!0)&&v("string",e.data,!0)&&v("string",e.customType,!0)&&E("string",e.operatorUserIds,!0)&&v("number",e.messageSurvivalSeconds,!0)},Ea={customTypes:null,includeEmpty:!1,includeFrozen:!0},ba=function(e){return E("string",e.customTypes,!0)&&v("boolean",e.includeEmpty)&&v("boolean",e.includeFrozen)},Na={memberStateFilter:Kn.ALL},Ta=function(e){return g(Kn,e.memberStateFilter)},Ia=function(e){function n(t,n){var r=n.userId,s=e.call(this)||this;return s._iid=t,s.userId=r,s}return t(n,e),n}(D),Ca=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,a=e.unsentMessageCache,o=e.dispatcher,u=this;this._observers=new Map,o.on((function(e){return r(u,void 0,void 0,(function(){var o,u,c,l,h=this;return s(this,(function(d){switch(d.label){case 0:return e instanceof Xs?(o=e.channels,l=e.source,u=o.filter((function(e){return e instanceof va})),[4,t.upsert(u)]):[3,2];case 1:return d.sent(),this._broadcastUpdateEvent(u,l),[3,7];case 2:return e instanceof Zs?(c=e.channelUrls,l=e.source,[4,t.remove(c)]):[3,5];case 3:return d.sent(),[4,Ee((function(){return r(h,void 0,void 0,(function(){var e,t,r,o,u,l;return s(this,(function(s){switch(s.label){case 0:s.trys.push([0,6,7,8]),e=i(c),t=e.next(),s.label=1;case 1:return t.done?[3,5]:(r=t.value,[4,n.removeMessagesOfChannel(r)]);case 2:return s.sent(),[4,a.removeMessagesOfChannel(r)];case 3:s.sent(),s.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return o=s.sent(),u={error:o},[3,8];case 7:try{t&&!t.done&&(l=e.return)&&l.call(e)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))}))];case 4:return d.sent(),this._broadcastRemoveEvent(c,l),[3,7];case 5:return e instanceof Ia?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,7];case 6:d.sent(),d.label=7;case 7:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var s=i(this._observers.values()),a=s.next();!a.done;a=s.next()){a.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=i(this._observers.values()),a=s.next();!a.done;a=s.next()){a.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),Sa=function(){function e(e){var t=e.messageCache,n=e.unsentMessageCache,i=e.dispatcher,a=e.logger,o=this;this._observers=new Map,this._logger=null,this._logger=a,i.on((function(e){return r(o,void 0,void 0,(function(){var i,a,o,u,c,l,h=this;return s(this,(function(d){switch(d.label){case 0:return e instanceof mn?(i=e.messages,l=e.source,a=i.filter((function(e){return e.messageId>0})),o=i.filter((function(e){return 0===e.messageId})),a.length>0?[4,Ee((function(){return r(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,t.upsert(a)];case 1:return e.sent(),[4,n.remove(a.map((function(e){return e instanceof Dt?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,5];case 1:d.sent(),this._broadcastUpdateEvent(a,l),d.label=2;case 2:return o.length>0?[4,Ee((function(){return r(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.upsert(o)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:d.sent(),this._broadcastUpdateEvent(o,l),d.label=4;case 4:return[3,9];case 5:return e instanceof vn?(u=e.messageIds,l=e.source,[4,Ee((function(){return r(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,t.remove(u)];case 1:return e.sent(),[2]}}))}))}))]):[3,7];case 6:return d.sent(),this._broadcastRemoveEvent(u,l),[3,9];case 7:return e instanceof gn?(c=e.reqId,l=e.source,[4,Ee((function(){return r(h,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,n.remove([c])];case 1:return e.sent(),[2]}}))}))}))]):[3,9];case 8:d.sent(),this._broadcastRemoveUnsentEvent(c,l),d.label=9;case 9:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var s=i(this._observers.values()),a=s.next();!a.done;a=s.next()){a.value.onUpdate(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=i(this._observers.values()),a=s.next();!a.done;a=s.next()){a.value.onRemove(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var s=i(this._observers.values()),a=s.next();!a.done;a=s.next()){a.value.onRemoveUnsent(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e}(),Aa=function(e){function n(t,n,r){var s=e.call(this,t,"USEV",r)||this;return s.event=new dr(r),s}return t(n,e),n}(B),Ma=function(e){function r(t){var r=t.userId,s=t.ts,i=t.token,a=t.filter,o=e.call(this)||this,u=n(n({},Ea),a),c=u.customTypes,l=u.includeEmpty,d=u.includeFrozen;return o.method=h.GET,o.path="".concat(Oe,"/").concat(encodeURIComponent(r),"/my_group_channels/changelogs"),o.params=O({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:s,token:i,custom_types:c,show_empty:l,show_frozen:d}),o}return t(r,e),r}(P),wa=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.updatedChannels=n.updated.map((function(e){return new va(t,e)})),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r}return t(n,e),n}(k),Ua=function(e){function n(t){var n=this,r=t.userId,s=t.token,i=t.limit,a=t.order,o=t.includeEmpty,u=t.memberStateFilter,c=t.superChannelFilter,l=t.publicChannelFilter,d=t.unreadChannelFilter,p=t.nicknameContainsFilter,f=t.channelNameContainsFilter,_=t.channelUrlsFilter,m=t.customTypesFilter,v=t.customTypeStartsWithFilter,g=t.hiddenChannelFilter,y=t.metadataOrderKeyFilter,E=t.metadataKey,b=t.metadataValues,N=t.metadataValueStartsWith,T=t.includeFrozen,I=t.includeMetaData,C=t.searchFilter,S=t.userIdsFilter;return(n=e.call(this)||this).method=h.GET,n.path="".concat(Oe,"/").concat(encodeURIComponent(r),"/my_group_channels"),n.params=O({token:s,limit:i,order:a,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,member_state_filter:u,super_mode:c,public_mode:l,unread_filter:d,members_nickname_contains:p,name_contains:f,channel_urls:_,custom_types:m,custom_type_startswith:v,hidden_mode:g,metadata_order_key:y,metadata_key:E,metadata_values:b,metadata_value_startswith:N,show_frozen:T,show_metadata:I}),C&&C.query&&C.fields&&(n.params.search_query=C.query,n.params.search_fields=C.fields),S&&S.userIds&&S.userIds.length>0&&(S.includeMode?(n.params.members_include_in=S.userIds,n.params.query_type=S.queryType.toUpperCase()):n.params.members_exactly_in=S.userIds),n}return t(n,e),n}(P),Ra=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.token=null,r.channels=[],r.ts=null;var s=n.next,i=n.channels,a=n.ts;return r.token=s,i&&i.length>0&&(r.channels=i.map((function(e){return e.ts=a,new va(t,e)}))),r.ts=null!=a?a:null,r}return t(n,e),n}(k),Da=function(e){function n(t){var n=t.userId,r=t.filter,s=e.call(this)||this,i=r.memberStateFilter;return s.method=h.GET,s.path="".concat(Oe,"/").concat(encodeURIComponent(n),"/group_channel_count"),s.params={state:null!=i?i:Kn.ALL},s}return t(n,e),n}(P),Oa=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.groupChannelCount=n.group_channel_count,r}return t(n,e),n}(k),La=function(e){function n(t){var n=this,r=t.userId,s=t.channelUrl,i=t.coverUrl,u=t.coverImage,c=t.isDistinct,l=t.isSuper,d=t.isBroadcast,p=t.isPublic,f=t.isExclusive,_=t.isDiscoverable,m=t.isStrict,v=t.isEphemeral,g=t.accessCode,y=t.name,E=t.data,b=t.customType,N=t.messageSurvivalSeconds,T=t.invitedUserIds,I=t.operatorUserIds;return(n=e.call(this)||this).method=h.POST,n.path=Pe,n.params=O({user_ids:o([r],a(null!=T?T:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:s,cover_url:i,cover_file:u,is_distinct:c,is_super:l,is_broadcast:d,is_exclusive:f,is_public:p,is_discoverable:_,strict:m,is_ephemeral:v,access_code:g,name:y,data:E,custom_type:b,operator_ids:I,message_survival_seconds:N}),n}return t(n,e),n}(P),Pa=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.channel=new va(t,n),r.isCreated=n.is_created,r}return t(n,e),n}(k),ka=function(e){function n(t){var n=t.userId,r=t.channelUrls,s=e.call(this)||this;return s.method=h.PUT,s.path="".concat(Oe,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),s.params={channel_urls:r},s}return t(n,e),n}(P);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(k);var Fa=function(e){function n(t,n,r){var s=e.call(this,t,n,r)||this,i=r.data.operators,a=void 0===i?[]:i;return s.operators=a.map((function(e){return new ot(s._iid,e)})),s}return t(n,e),n}(bi),xa=function(e){function n(t,n,r){var s=e.call(this,t,"MCNT",r)||this;return s.groupChannelMemberCounts=r.group_channels.map((function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),s.openChannelMemberCounts=r.open_channels.map((function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),s}return t(n,e),n}(B),qa=function(e){function n(t){var n=t.channelUrl,r=t.messageId;return e.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return t(n,e),n}(j),Ha=function(e){function n(t,n,r){var s,i,a,o=this;(o=e.call(this,t,"ADMM",r)||this).message=new qt(t,r);var u=Ya.of(t).sdkState;return o.isMentioned=We(o.message.mentionType,null!==(s=o.message.mentionedUserIds)&&void 0!==s?s:null===(i=o.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return t(n,e),n}(B),Ga=function(e){function n(t,n,r){var s,i,a,o,u,c,l=this;(l=e.call(this,t,"AEDI",r)||this).message=new qt(t,r);var h=Ya.of(t).sdkState;return l.mentionCountChange=Ye({mentionType:null!==(i=null===(s=r.old_values)||void 0===s?void 0:s.mention_type)&&void 0!==i?i:null,mentionedUserIds:null!==(o=null===(a=r.old_values)||void 0===a?void 0:a.mentioned_user_ids)&&void 0!==o?o:[]},{mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))},h.userId),l}return t(n,e),n}(B),Va=function(e){function n(t,n,r){var s=e.call(this,t,"MRCT",r)||this;return s.channelUrl=r.channel_url,s.channelType=r.channel_type,s.event=new Nt(r),s}return t(n,e),n}(B),Qa=function(e){function n(t,n,r){var s=e.call(this,t,"MTHD",r)||this;return s.event=new Kt(t,r),s}return t(n,e),n}(B),Ba=function(e){function n(t,n){var r,s,i,a,o,u,c,l,h,d,p,f,_,m,v,g,y,E,b,N,T=this;return(T=e.call(this,t,n)||this).includeEmpty=!1,T.includeFrozen=!0,T.includeMetaData=!0,T.channelUrlsFilter=null,T.customTypesFilter=null,T.customTypeStartsWithFilter=null,T.nicknameContainsFilter="",T.channelNameContainsFilter="",T.memberStateFilter=Kn.ALL,T.unreadChannelFilter=Yn.ALL,T.superChannelFilter=Wn.ALL,T.publicChannelFilter=zn.ALL,T.hiddenChannelFilter=Jn.UNHIDDEN,T.searchFilter={fields:[],query:null},T.userIdsFilter={userIds:[],includeMode:!0,queryType:Zn.AND},T.metadataKey=null,T.metadataValues=null,T.metadataOrderKeyFilter=null,T.metadataValueStartsWith=null,T.order=Pn.LATEST_LAST_MESSAGE,T.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,T.includeFrozen=null===(s=n.includeFrozen)||void 0===s||s,T.includeMetaData=null===(i=n.includeMetaData)||void 0===i||i,T.channelUrlsFilter=null!==(a=n.channelUrlsFilter)&&void 0!==a?a:null,T.customTypesFilter=null!==(o=n.customTypesFilter)&&void 0!==o?o:null,T.customTypeStartsWithFilter=null!==(u=n.customTypeStartsWithFilter)&&void 0!==u?u:"",T.nicknameContainsFilter=null!==(c=n.nicknameContainsFilter)&&void 0!==c?c:"",T.channelNameContainsFilter=null!==(l=n.channelNameContainsFilter)&&void 0!==l?l:"",T.memberStateFilter=null!==(h=n.memberStateFilter)&&void 0!==h?h:Kn.ALL,T.unreadChannelFilter=null!==(d=n.unreadChannelFilter)&&void 0!==d?d:Yn.ALL,T.superChannelFilter=null!==(p=n.superChannelFilter)&&void 0!==p?p:Wn.ALL,T.publicChannelFilter=null!==(f=n.publicChannelFilter)&&void 0!==f?f:zn.ALL,T.hiddenChannelFilter=null!==(_=n.hiddenChannelFilter)&&void 0!==_?_:Jn.UNHIDDEN,T.searchFilter=null!==(m=n.searchFilter)&&void 0!==m?m:{fields:[],query:null},T.userIdsFilter=null!==(v=n.userIdsFilter)&&void 0!==v?v:{userIds:[],includeMode:!0,queryType:Zn.AND},T.metadataKey=null!==(g=n.metadataKey)&&void 0!==g?g:null,T.metadataValues=null!==(y=n.metadataValues)&&void 0!==y?y:null,T.metadataOrderKeyFilter=null!==(E=n.metadataOrderKeyFilter)&&void 0!==E?E:null,T.metadataValueStartsWith=null!==(b=n.metadataValueStartsWith)&&void 0!==b?b:null,T.order=null!==(N=n.order)&&void 0!==N?N:Pn.LATEST_LAST_MESSAGE,T}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&v("boolean",this.includeEmpty)&&v("boolean",this.includeFrozen)&&v("boolean",this.includeMetaData)&&v("string",this.channelNameContainsFilter)&&E("string",this.channelUrlsFilter,!0)&&E("string",this.customTypesFilter,!0)&&v("string",this.customTypeStartsWithFilter)&&v("string",this.nicknameContainsFilter)&&g(Kn,this.memberStateFilter)&&g(Wn,this.superChannelFilter)&&g(zn,this.publicChannelFilter)&&g(Yn,this.unreadChannelFilter)&&g(Jn,this.hiddenChannelFilter)&&E($n,this.searchFilter.fields)&&v("string",this.searchFilter.query,!0)&&E("string",this.userIdsFilter.userIds)&&v("boolean",this.userIdsFilter.includeMode)&&g(Zn,this.userIdsFilter.queryType)&&g(Pn,this.order)&&v("string",this.metadataOrderKeyFilter,!0)&&v("string",this.metadataKey,!0)&&E("string",this.metadataValues,!0)&&v("string",this.metadataValueStartsWith,!0)},n.prototype.serialize=function(){return rt(this)},n.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,za.of(this._iid).getMyGroupChannels(this._token,this,this.limit)]):[3,2]:[3,5];case 1:return e=r.sent(),t=e.channels,n=e.token,this._token=n,this._hasNext=!!n,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},n}(Yt),ja={},za=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,s=t.dispatcher,a=t.sessionManager,o=t.requestQueue,u=t.logger,c=this;this._leftChannels=new Map,this._markAsReadAllLastSentAt=0,this._iid=e,this._sdkState=n,this._sessionManager=a,this._requestQueue=o,this._dispatcher=s,this._logger=u,this._groupChannelHandlers=new Map,this._groupChannelCache=new ur(this._iid,{sdkState:n,cacheContext:r}),this._unsentMessageCache=new jn(this._iid,{sdkState:n,cacheContext:r}),this._messageCache=new lr(this._iid,{sdkState:n,cacheContext:r,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new Ca({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s}),this._messageBroadcast=new Sa({messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:s,logger:u}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(c._dispatcher.dispatch(new Xs({channels:[e],source:Hs.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),c._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated(e)})))};try{for(var r=i(c._groupChannelCache.channels),s=r.next();!s.done;s=r.next()){n(s.value)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),1e3),this._dispatcher.on((function(e){e instanceof B&&c._handleEvent(e)})),ja[e]=this}return e.of=function(e){return ja[e]},Object.defineProperty(e.prototype,"handlers",{get:function(){return o([],a(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),e.prototype.buildGroupChannelFromSerializedData=function(e){var t=st(e);return new va(this._iid,va.payloadify(t))},e.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=st(e);return new Ba(this._iid,t)},e.prototype.buildMemberFromSerializedData=function(e){var t=st(e);return new Nr(this._iid,Nr.payloadify(t))},e.prototype.getChannelFromCache=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getChannelsFromCache=function(e,t,n){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n})];case 1:return[2,r.sent()]}}))}))},e.prototype._handleEvent=function(e){return r(this,void 0,void 0,(function(){var t,n,a,o,u,c,l,h,p,f,_,m,v,g,y,E,b,N,T,I,C,S,A,M,w,U,R,D,O,L,P,k,F,x,q,H,G,V,Q,B,j,z,K,W,Y,J,X,Z,$,ne,re,se,ie,ae,oe,ue,ce,le,he,de,pe,fe,_e,me,ve,ge,be,Ne,Te,Ie,Ce,Se,Ae,Me,we,Ue,Re,De,Oe,Le,Pe,ke,Fe,xe,qe,He,Ge,Ve,Qe,Be,je,ze,Ke,We,Ye,Je,Xe,Ze,$e,et,tt,nt,rt,st,it,at,ot,ut,ct,lt,ht,dt,pt,ft,_t,mt,vt,gt,yt,Et,bt,Nt,Tt=this;return s(this,(function(It){switch(It.label){case 0:switch(It.trys.push([0,72,,73]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"SYEV":return[3,32];case"USEV":return[3,70]}return[3,71];case 1:return h=null,"MESG"===e.code?h=e.as(bs):"FILE"===e.code?h=e.as(on):"ADMM"!==e.code&&"BRDM"!=e.code||(h=e.as(Ha)),h?(t=h.message,n=h.isMentioned,a=h.forceUpdateLastMessage,t.channelType!==ee.GROUP?[3,3]:(Ee((function(){return r(Tt,void 0,void 0,(function(){var e;return s(this,(function(n){return e=new qa(t),this._requestQueue.send(e),[2]}))}))})),A=this._groupChannelCache.isCachedInMemory(t.channelUrl),m=t instanceof Dt&&t.sender.userId===this._sdkState.userId,[4,this.getChannel(t.channelUrl,!0)])):[3,3];case 2:if((o=It.sent()).hiddenState=pa.UNHIDDEN,t instanceof Dt){u=Ya.of(this._iid).useMemberInfoInMessage;try{for(c=i(o.members),l=c.next();!l.done;l=c.next())if((Le=l.value).userId===t.sender.userId){u?(t.sender.nickname=Le.nickname,t.sender.plainProfileUrl=Le.plainProfileUrl,t.sender.metaData=Le.metaData,t.sender.isBlockedByMe=Le.isBlockedByMe):(Le.nickname=t.sender.nickname,Le.plainProfileUrl=t.sender.plainProfileUrl,Le.metaData=t.sender.metaData,Le.isBlockedByMe=t.sender.isBlockedByMe);break}}catch(e){pt={error:e}}finally{try{l&&!l.done&&(ft=c.return)&&ft.call(c)}finally{if(pt)throw pt.error}}u&&n&&t.mentionedUsers.forEach((function(e){var t,n;try{for(var r=i(o.members),s=r.next();!s.done;s=r.next()){var a=s.value;if(e.userId===a.userId){e.nickname=a.nickname,e.plainProfileUrl=a.plainProfileUrl,e.metaData=a.metaData;break}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),m&&(g=this._sessionManager.currentUser)&&(g.nickname=t.sender.nickname,g.plainProfileUrl=t.sender.plainProfileUrl,g.metaData=t.sender.metaData)}t.silent&&!m||(o.isEphemeral||A)&&((!o.lastMessage||o.lastMessage.createdAt<t.createdAt)&&(o.lastMessage=t),m||o._updateUnreadCount(o.unreadMessageCount+1,o.unreadMentionCount+(n?1:0))),a&&(!o.lastMessage||o.lastMessage.createdAt<t.createdAt)&&(o.lastMessage=t),this._dispatcher.dispatch(new Xs({channels:[o],source:Hs.EVENT_MESSAGE_RECEIVED})),t.silent&&!m||ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(o)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),this._dispatcher.dispatch(new mn({messages:[t],source:cn.EVENT_MESSAGE_RECEIVED})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,r,a,u,c;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),r=e.next();!r.done;r=e.next())(a=r.value).onMessageReceived(o,t),n&&a.onMentionReceived(o,t)}catch(e){u={error:e}}finally{try{r&&!r.done&&(c=e.return)&&c.call(e)}finally{if(u)throw u.error}}return[2]}))}))})),It.label=3;case 3:return[3,71];case 4:return h=null,"MEDI"===e.code?h=e.as(Ts):"FEDI"===e.code?h=e.as(Cs):"AEDI"===e.code&&(h=e.as(Ga)),h?(p=h.message,f=h.mentionCountChange,p.channelType!==ee.GROUP?[3,6]:(A=this._groupChannelCache.isCachedInMemory(p.channelUrl),[4,this.getChannel(p.channelUrl,!0)])):[3,6];case 5:_=It.sent(),m=p instanceof Dt&&p.sender.userId===this._sdkState.userId,v=!1,m?(g=this._sessionManager.currentUser)&&(g.nickname=p.sender.nickname,g.plainProfileUrl=p.sender.plainProfileUrl,g.metaData=p.sender.metaData):_.isReadMessage(p)&&0!==f&&!p.silent&&A&&(_._updateUnreadCount(_.unreadMessageCount,_.unreadMentionCount+f),v=!0),!_.lastMessage||_.lastMessage.createdAt<p.createdAt?(_.lastMessage=p,v=!0):_.lastMessage.isIdentical(p)&&(A?_.lastMessage.updatedAt<p.updatedAt&&(_.lastMessage=p,v=!0):v=!0),v&&(this._dispatcher.dispatch(new Xs({channels:[_],source:Hs.EVENT_MESSAGE_UPDATED})),p.silent&&!m||ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(_)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),this._dispatcher.dispatch(new mn({messages:[p],source:cn.EVENT_MESSAGE_UPDATED})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r,a;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated(_,p),0!==f&&n.onMentionReceived(_,p)}catch(e){r={error:e}}finally{try{t&&!t.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),It.label=6;case 6:return[3,71];case 7:return y=e.as(Ms),V=y.channelUrl,R=y.channelType,E=y.messageId,R!==ee.GROUP?[3,9]:[4,this.getChannel(V,!0)];case 8:b=It.sent(),this._dispatcher.dispatch(new vn({messageIds:[E],source:cn.EVENT_MESSAGE_DELETED})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onMessageDeleted(b,E)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),It.label=9;case 9:return[3,71];case 10:return(N=e.as(gi).readStatus).channelType!==ee.GROUP?[3,12]:(A=this._groupChannelCache.isCachedInMemory(N.channelUrl),[4,this.getChannel(N.channelUrl,!0)]);case 11:T=It.sent(),A&&T._updateUnreadMemberState(N.reader.userId,N.readAt),N.reader.userId===this._sdkState.userId?A?(T.unreadMessageCount>0||T.unreadMentionCount>0)&&(T._updateUnreadCount(0,0),this._dispatcher.dispatch(new Xs({channels:[T],source:Hs.EVENT_CHANNEL_READ})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(T)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):0!==T.unreadMessageCount&&0!==T.unreadMentionCount||(this._dispatcher.dispatch(new Xs({channels:[T],source:Hs.EVENT_CHANNEL_READ})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelChanged(T)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new Xs({channels:[T],source:Hs.EVENT_CHANNEL_READ})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUnreadMemberStatusUpdated(T)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),It.label=12;case 12:return[3,71];case 13:return I=e.as(Ei),V=I.channelUrl,C=I.deliveredStateUpdate,S=void 0===C?{}:C,A=this._groupChannelCache.isCachedInMemory(V),[4,this.getChannel(V,!0)];case 14:if(M=It.sent(),A)for(w in S)M._updateUndeliveredMemberState(w,S[w]);return this._dispatcher.dispatch(new Xs({channels:[M],source:Hs.EVENT_CHANNEL_DELIVERED})),Object.keys(S).some((function(e){return e!==Tt._sdkState.userId}))&&ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onUndeliveredMemberStatusUpdated(M)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),[3,71];case 15:return U=e.as(Va),V=U.channelUrl,R=U.channelType,D=U.event,R!==ee.GROUP?[3,18]:[4,this.getChannel(V,!0)];case 16:return O=It.sent(),[4,this.getMessageFromCache(D.messageId)];case 17:(k=It.sent())&&(k.applyReactionEvent(D),this._dispatcher.dispatch(new mn({messages:[k],source:cn.EVENT_MESSAGE_REACTION_UPDATED}))),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onReactionUpdated(O,D)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),It.label=18;case 18:return[3,71];case 19:return(L=e.as(Qa).event).channelType!==ee.GROUP?[3,22]:[4,this.getChannel(L.channelUrl,!0)];case 20:return P=It.sent(),[4,this.getMessageFromCache(L.targetMessageId)];case 21:(k=It.sent())&&(k.applyThreadInfoUpdateEvent(L),this._dispatcher.dispatch(new mn({messages:[k],source:cn.EVENT_MESSAGE_THREADINFO_UPDATED}))),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onThreadInfoUpdated(P,L)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))})),It.label=22;case 22:return[3,71];case 23:F=e.as(xa).groupChannelMemberCounts,x=[],It.label=24;case 24:It.trys.push([24,29,30,31]),q=i(F),H=q.next(),It.label=25;case 25:return H.done?[3,28]:(G=H.value,V=G.channelUrl,Ne=G.memberCount,Te=G.joinedMemberCount,Q=G.updatedAt,[4,this.getChannelFromCache(V)]);case 26:(B=It.sent())&&B._setLatestMemberCount(Ne,Te,Q)&&x.push(B),It.label=27;case 27:return H=q.next(),[3,25];case 28:return[3,31];case 29:return j=It.sent(),_t={error:j},[3,31];case 30:try{H&&!H.done&&(mt=q.return)&&mt.call(q)}finally{if(_t)throw _t.error}return[7];case 31:return x.length>0&&(this._dispatcher.dispatch(new Xs({channels:x,source:Hs.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),ye((function(){return r(Tt,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(s){try{for(e=i(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())t.value.onChannelMemberCountChanged(x)}catch(e){n={error:e}}finally{try{t&&!t.done&&(r=e.return)&&r.call(e)}finally{if(n)throw n.error}}return[2]}))}))}))),[3,71];case 32:if(!(z=e.as(bi).event).isGroupChannelEvent)return[3,69];switch(z.category){case hr.CHANNEL_JOIN:return[3,33];case hr.CHANNEL_LEAVE:return[3,35];case hr.CHANNEL_OPERATOR_UPDATE:return[3,39];case hr.CHANNEL_INVITE:return[3,41];case hr.CHANNEL_DECLINE_INVITE:return[3,43];case hr.TYPING_START:case hr.TYPING_END:return[3,45];case hr.USER_CHANNEL_MUTE:case hr.USER_CHANNEL_UNMUTE:return[3,47];case hr.USER_CHANNEL_BAN:return[3,49];case hr.USER_CHANNEL_UNBAN:return[3,53];case hr.CHANNEL_FREEZE:case hr.CHANNEL_UNFREEZE:return[3,55];case hr.CHANNEL_HIDE:return[3,57];case hr.CHANNEL_UNHIDE:return[3,59];case hr.CHANNEL_DELETED:return[3,61];case hr.CHANNEL_PROP_CHANGED:return[3,63];case hr.CHANNEL_META_DATA_CHANGED:return[3,65];case hr.CHANNEL_META_COUNTERS_CHANGED:return[3,67]}return[3,69];case 33:return[4,this.getChannel(z.channelUrl,!0)];case 34:return K=It.sent(),W=e.as(Di),Y=W.memberCount,J=W.joinedMemberCount,X=W.members,Z=!1,X.forEach((function(e){K.isExclusive||K.isSuper||K.isBroadcast?Z=Z||K._setLatestMemberCount(Y,J,z.ts):(e.state=_r.JOINED,K.addMember(e,z.ts),Tt._updateJoinedMemberCount(K)),e.userId===Tt._sdkState.userId&&(K.myMemberState=_r.JOINED)})),this._dispatcher.dispatch(new Xs({channels:[K],source:Hs.EVENT_CHANNEL_JOINED})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var r=i(X),s=r.next();!s.done;s=r.next()){var a=s.value;e.onUserJoined(K,a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}K.isBroadcast&&Z&&e.onChannelMemberCountChanged([K])})),[2]}))}))})),[3,69];case 35:return(Pe=this._leftChannels.get(z.channelUrl))?(ne=Pe.channel,[3,38]):[3,36];case 36:return[4,this.getChannel(z.channelUrl,!0)];case 37:ne=It.sent(),It.label=38;case 38:return $=ne,re=e.as(Li),Ne=re.memberCount,Te=re.joinedMemberCount,se=re.member,ie=!1,$.isExclusive||$.isSuper||$.isBroadcast?ie=$._setLatestMemberCount(Ne,Te,z.ts):($.removeMember(se),this._updateJoinedMemberCount($)),se.userId===this._sdkState.userId?$.isPublic?($.myMemberState=_r.NONE,$.invitedAt=0,$.joinedAt=0,$._updateUnreadCount(0,0),this._dispatcher.dispatch(new Xs({channels:[$],source:Hs.EVENT_CHANNEL_LEFT}))):(this._markAsLeave($),this._dispatcher.dispatch(new Zs({channelUrls:[$.url],source:Hs.EVENT_CHANNEL_LEFT}))):this._dispatcher.dispatch(new Xs({channels:[$],source:Hs.EVENT_CHANNEL_LEFT})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft($,se),$.isBroadcast&&ie&&e.onChannelMemberCountChanged([$])})),[2]}))}))})),[3,69];case 39:return[4,this.getChannel(z.channelUrl,!0)];case 40:ae=It.sent(),oe=e.as(Fa).operators,ue=oe.map((function(e){return e.userId}));try{for(ce=i(ae.members),le=ce.next();!le.done;le=ce.next())(Le=le.value).role=ue.includes(Le.userId)?te.OPERATOR:te.NONE}catch(e){vt={error:e}}finally{try{le&&!le.done&&(gt=ce.return)&&gt.call(ce)}finally{if(vt)throw vt.error}}return ae.myRole=ue.includes(this._sdkState.userId)?te.OPERATOR:te.NONE,this._dispatcher.dispatch(new Xs({channels:[ae],source:Hs.EVENT_CHANNEL_OPERATOR_UPDATED})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated(ae,oe)})),[2]}))}))})),[3,69];case 41:return[4,this.getChannel(z.channelUrl,!0)];case 42:he=It.sent(),de=e.as(Ii),Ne=de.memberCount,Te=de.joinedMemberCount,pe=de.inviter,(fe=de.invitees).forEach((function(e){return e.state=_r.INVITED}));try{for(_e=i(fe),me=_e.next();!me.done;me=_e.next())ve=me.value,he.isExclusive||he.isSuper||he.isBroadcast?he._setLatestMemberCount(Ne,Te,z.ts):he.addMember(ve,z.ts),this._sdkState.userId===ve.userId&&(he.hiddenState=pa.UNHIDDEN,he.myMemberState!==_r.JOINED&&(he.myMemberState=_r.INVITED),he.invitedAt=z.ts)}catch(e){yt={error:e}}finally{try{me&&!me.done&&(Et=_e.return)&&Et.call(_e)}finally{if(yt)throw yt.error}}return this._dispatcher.dispatch(new Xs({channels:[he],source:Hs.EVENT_CHANNEL_INVITED})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation(he,pe,fe)})),[2]}))}))})),[3,69];case 43:return[4,this.getChannel(z.channelUrl,!0)];case 44:return ge=It.sent(),be=e.as(wi),Ne=be.memberCount,Te=be.joinedMemberCount,Ie=be.inviter,Ce=be.invitee,ge.isExclusive||ge.isSuper||ge.isBroadcast?ge._setLatestMemberCount(Ne,Te,z.ts):ge.removeMember(Ce),this._sdkState.userId===Ce.userId?(ge.invitedAt=0,ge.myMemberState=_r.NONE,ge.isPublic?this._dispatcher.dispatch(new Xs({channels:[ge],source:Hs.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new Zs({channelUrls:[ge.url],source:Hs.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new Xs({channels:[ge],source:Hs.EVENT_CHANNEL_DECLINED_INVITE})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation(ge,Ie,Ce)})),[2]}))}))})),[3,69];case 45:return[4,this.getChannel(z.channelUrl,!0)];case 46:return Se=It.sent(),Ae=z.category===hr.TYPING_START,Me=e.as(Ae?Yi:Xi).user,Se._updateTypingStatus(Me,Ae?z.ts:0),this._dispatcher.dispatch(new Xs({channels:[Se],source:Hs.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(Se)})),[2]}))}))})),[3,69];case 47:return[4,this.getChannel(z.channelUrl,!0)];case 48:we=It.sent(),Ue=z.category===hr.USER_CHANNEL_MUTE,(Re=e.as(Ue?us:ls).user).userId===this._sdkState.userId&&(we.myMutedState=Ue?da.MUTED:da.UNMUTED);try{for(De=i(we.members),Oe=De.next();!Oe.done;Oe=De.next())if((Le=Oe.value).userId===Re.userId){Le.isMuted=Ue;break}}catch(e){bt={error:e}}finally{try{Oe&&!Oe.done&&(Nt=De.return)&&Nt.call(De)}finally{if(bt)throw bt.error}}return this._dispatcher.dispatch(new Xs({channels:[we],source:Ue?Hs.EVENT_CHANNEL_MUTED:Hs.EVENT_CHANNEL_UNMUTED})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Ue?e.onUserMuted(we,Re):e.onUserUnmuted(we,Re)})),[2]}))}))})),[3,69];case 49:return(Pe=this._leftChannels.get(z.channelUrl))?(Fe=Pe.channel,[3,52]):[3,50];case 50:return[4,this.getChannel(z.channelUrl,!0)];case 51:Fe=It.sent(),It.label=52;case 52:return ke=Fe,this._markAsLeave(ke),xe=e.as(ds).user,ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned(ke,xe)})),[2]}))}))})),[3,69];case 53:return[4,this.getChannel(z.channelUrl,!0)];case 54:return qe=It.sent(),He=e.as(fs).user,ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned(qe,He)})),[2]}))}))})),[3,69];case 55:return[4,this.getChannel(z.channelUrl,!0)];case 56:return Ge=It.sent(),Ve=e.as(ms).freeze,Ge.isFrozen=Ve,this._dispatcher.dispatch(new Xs({channels:[Ge],source:Ve?Hs.EVENT_CHANNEL_FROZEN:Hs.EVENT_CHANNEL_UNFROZEN})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Ve?e.onChannelFrozen(Ge):e.onChannelUnfrozen(Ge)})),[2]}))}))})),[3,69];case 57:return[4,this.getChannel(z.channelUrl,!0)];case 58:return Qe=It.sent(),Be=e.as(Hi),je=Be.allowAutoUnhide,ze=Be.hidePreviousMessages,Ke=Be.messageOffsetTimestamp,null!==je&&(Qe.hiddenState=je?pa.HIDDEN_ALLOW_AUTO_UNHIDE:pa.HIDDEN_PREVENT_AUTO_UNHIDE),null!==ze&&ze&&Qe._updateUnreadCount(0,0),null!==Ke&&(Qe.messageOffsetTimestamp=Ke),this._dispatcher.dispatch(new Xs({channels:[Qe],source:Hs.EVENT_CHANNEL_HIDDEN})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden(Qe)})),[2]}))}))})),[3,69];case 59:return[4,this.getChannel(z.channelUrl,!0)];case 60:return(We=It.sent()).hiddenState=pa.UNHIDDEN,this._dispatcher.dispatch(new Xs({channels:[We],source:Hs.EVENT_CHANNEL_UNHIDDEN})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(We)})),[2]}))}))})),[3,69];case 61:return[4,this.getChannel(z.channelUrl,!0)];case 62:return Ye=It.sent(),this._dispatcher.dispatch(new Zs({channelUrls:[z.channelUrl],source:Hs.EVENT_CHANNEL_DELETED})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted(Ye.url,Ye.channelType)})),[2]}))}))})),[3,69];case 63:return[4,this.getChannelWithoutCache(z.channelUrl,!0)];case 64:return Je=It.sent(),this._dispatcher.dispatch(new Xs({channels:[Je],source:Hs.EVENT_CHANNEL_UPDATED})),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Je)})),[2]}))}))})),[3,69];case 65:return[4,this.getChannel(z.channelUrl,!0)];case 66:return Xe=It.sent(),Ze=e.as(Kr),$e=Ze.created,et=Ze.updated,tt=Ze.deleted,$e&&Xe._upsertCachedMetaData($e,z.ts),et&&Xe._upsertCachedMetaData(et,z.ts),tt&&Xe._removeFromCachedMetaData(tt,z.ts),ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){$e&&e.onMetaDataCreated(Xe,$e),et&&e.onMetaDataUpdated(Xe,et),tt&&e.onMetaDataDeleted(Xe,tt)})),[2]}))}))})),[3,69];case 67:return[4,this.getChannel(z.channelUrl,!0)];case 68:return nt=It.sent(),rt=e.as(ss),st=rt.created,it=rt.updated,at=rt.deleted,ye((function(){return r(Tt,void 0,void 0,(function(){return s(this,(function(e){return this._groupChannelHandlers.forEach((function(e){st&&e.onMetaCounterCreated(nt,st),it&&e.onMetaCounterUpdated(nt,it),at&&e.onMetaCounterDeleted(nt,at)})),[2]}))}))})),[3,69];case 69:return[3,71];case 70:switch((ot=e.as(Aa).event).category){case tr.USER_BLOCK:ut=dr.getDataAsUserBlockEvent(this._iid,ot),lt=ut.blocker,ht=ut.blockee,this._groupChannelCache.block(lt.userId,ht.userId);break;case tr.USER_UNBLOCK:ct=dr.getDataAsUserBlockEvent(this._iid,ot),lt=ct.blocker,ht=ct.blockee,this._groupChannelCache.unblock(lt.userId,ht.userId)}return[3,71];case 71:return[3,73];case 72:if(dt=It.sent(),d(dt))throw dt;return[3,73];case 73:return[2]}}))}))},e.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)},e.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},e.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},e.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},e.prototype.subscribeGroupChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},e.prototype.unsubscribeGroupChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},e.prototype.subscribeMessageEvent=function(e,t){this._messageBroadcast.subscribe(e,t)},e.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},e.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===_r.JOINED})).length},e.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:it(v("string",e)).throw(p.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},e.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return it(v("string",e)).throw(p.invalidParameters),n=new _i({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(r=s.sent(),i=r.as(mi).channel,a=i.unreadMessageCount,o=i.unreadMentionCount,i.myCountPreference){case ha.UNREAD_MESSAGE_COUNT_ONLY:o=0;break;case ha.UNREAD_MENTION_COUNT_ONLY:a=0;break;case ha.OFF:a=0,o=0}return i._updateUnreadCount(a,o),[4,this._groupChannelCache.upsert([i])];case 2:return s.sent(),[2,i]}}))}))},e.prototype.getMyGroupChannels=function(e,t,i,a){return void 0===a&&(a=Hs.REQUEST_CHANNEL),r(this,void 0,void 0,(function(){var r,o,u,c,l;return s(this,(function(s){switch(s.label){case 0:return r=new Ua(n(n({},t),{userId:this._sdkState.userId,token:e,limit:i})),[4,this._requestQueue.send(r)];case 1:return o=s.sent(),u=o.as(Ra),c=u.channels,l=u.token,this._dispatcher.dispatch(new Xs({channels:c,source:a})),[2,{channels:c,token:l}]}}))}))},e.prototype.getMessageFromCache=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getMessagesFromCache=function(e,t,n,i,a){return void 0===a&&(a=100),r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:t,limit:a,filter:i,backward:"next"===n})];case 1:return[2,r.sent()]}}))}))},e.prototype.getAllFailedMessagesFromCache=function(e,t){return r(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:t,sendingStatus:ue.FAILED})];case 1:return[2,n.sent()]}}))}))},e.prototype.removeFailedMessageFromCache=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return t.sent(),[2]}}))}))},e.prototype.getCachedMessageCountBetween=function(e,t,n,i){return r(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,this._messageCache.countBetween(e,t,new Bs({top:n,bottom:i}))];case 1:return[2,r.sent()]}}))}))},e.prototype.getMyGroupChannelChangeLogs=function(e,t,i){return void 0===i&&(i=Hs.REQUEST_CHANNEL_CHANGELOGS),r(this,void 0,void 0,(function(){var r,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return t=n(n({},Ea),t),it(v("string",e)&&ba(t)).throw(p.invalidParameters),r=new Ma(O({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:t})),[4,this._requestQueue.send(r)];case 1:return a=s.sent(),o=a.as(wa),u=o.updatedChannels,c=o.deletedChannelUrls,u.length>0&&this._dispatcher.dispatch(new Xs({channels:u,source:i})),c.length>0&&this._dispatcher.dispatch(new Zs({channelUrls:c,source:i})),[2,o]}}))}))},e.prototype.getGroupChannelCount=function(e){return r(this,void 0,void 0,(function(){var t,r;return s(this,(function(s){switch(s.label){case 0:return e=n(n({},Na),e),it(Ta(e)).throw(p.invalidParameters),t=new Da({userId:this._sdkState.userId,filter:e}),[4,this._requestQueue.send(t)];case 1:return r=s.sent(),[2,r.as(Oa).groupChannelCount]}}))}))},e.prototype.createChannel=function(e){return r(this,void 0,void 0,(function(){var t,r,i;return s(this,(function(s){switch(s.label){case 0:return e=n(n({},ga),e),it(ya(e)).throw(p.invalidParameters),e.isPublic||(e.accessCode=null),t=new La(n({userId:this._sdkState.userId},e)),[4,this._requestQueue.send(t)];case 1:return r=s.sent(),i=r.as(Pa).channel,[4,this._groupChannelCache.upsert([i])];case 2:return s.sent(),[2,i]}}))}))},e.prototype.markAsReadAll=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return e=Date.now(),it(e-this._markAsReadAllLastSentAt>=1e3).throw(p.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new ka({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:s.sent(),n=this._groupChannelCache.channels;try{for(r=i(n),a=r.next();!a.done;a=r.next())(o=a.value)._updateUnreadMemberState(this._sdkState.userId,e),o._updateUnreadCount(0,0)}catch(e){u={error:e}}finally{try{a&&!a.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return n.length>0?[4,this._groupChannelCache.upsert(n)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},e.prototype.markAsReadWithChannelUrls=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:return t=Date.now(),it(E("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(p.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new ka({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:s.sent(),r=this._groupChannelCache.channels,a=[];try{for(o=i(r),u=o.next();!u.done;u=o.next())c=u.value,e.includes(c.url)&&(c._updateUnreadMemberState(this._sdkState.userId,t),c._updateUnreadCount(0,0),a.push(c))}catch(e){l={error:e}}finally{try{u&&!u.done&&(h=o.return)&&h.call(o)}finally{if(l)throw l.error}}return a.length>0?[4,this._groupChannelCache.upsert(a)]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},e.prototype.markAsDelivered=function(e){return r(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},e}(),Ka=function(){function e(e,t){var n=t.localCacheEnabled,r=t.dispatcher,s=t.sdkState,i=t.logger,a=this;this._iid=e,this._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=i,this._sdkState=s,this._localCacheEnabled&&r.on((function(e){if(e instanceof ce)switch(e.stateType){case Y.CONNECTED:a._isProcessingAutoResend||a.processAutoResendRegisteredPendingMessages().then((function(){return a._processNextAutoResend()}));break;case Y.DISCONNECTED:a._isProcessingAutoResend=!1}}))}return e.prototype.processNonAutoResendRegisteredPendingMessages=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,a,o;return s(this,(function(s){switch(s.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=s.sent();try{for(t=i(e),n=t.next();!n.done;n=t.next())0===(r=n.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",r.reqId),r.sendingStatus=ue.FAILED,r.errorCode=u.ACK_TIMEOUT,this._dispatcher.dispatch(new mn({messages:[r],source:cn.LOCAL_MESSAGE_FAILED})))}catch(e){a={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(a)throw a.error}}return[2]}}))}))},e.prototype.processAutoResendRegisteredPendingMessages=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=s.sent();try{for(t=i(e),n=t.next();!n.done;n=t.next())(r=n.value).errorCode&&b(r.errorCode)&&(a=(new Date).getTime(),o=r.createdAt+2592e5,a<=o?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(r.reqId)<0&&this._autoResendQueue.push(r):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(o).toLocaleString()),r.sendingStatus=ue.FAILED,this._dispatcher.dispatch(new mn({messages:[r],source:cn.LOCAL_MESSAGE_FAILED}))))}catch(e){u={error:e}}finally{try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}}return[2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled&&(e.sendingStatus===ue.SUCCEEDED||e.sendingStatus===ue.FAILED&&!b(e.errorCode))){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend()}},e.prototype._fetchAllCachedPendingMessages=function(){return r(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,jn.of(this._iid).fetch({sendingStatus:ue.PENDING,backward:!0})];case 1:return[2,e.sent()]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return r(this,void 0,void 0,(function(){var e,t,n;return s(this,(function(r){switch(r.label){case 0:if(!this._localCacheEnabled||"foreground"!==this._sdkState.appState)return[3,6];r.label=1;case 1:return r.trys.push([1,5,,6]),this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._logger.debug("processing auto-resend for message request id: ",e.reqId),[4,za.of(this._iid).getChannel(e.channelUrl,!0)]):[3,3];case 2:return t=r.sent(),e instanceof Gt?t._autoResendUserMessage(e):e instanceof Bt&&t._autoResendFileMessage(e),[3,4];case 3:this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1,r.label=4;case 4:return[3,6];case 5:return n=r.sent(),this._logger.warn("process auto-resend error: ",n),this._isProcessingAutoResend=!1,[3,6];case 6:return[2]}}))}))},e}(),Wa={},Ya=function(){function e(e,t){var n,r,s,i,a,o,u;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Wa[e]){Wa[e]=this;var c=null!==(n=t.options)&&void 0!==n?n:new T,h=this.sdkState={appId:t.appId,appVersion:null!==(r=t.appVersion)&&void 0!==r?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(s=t.apiHost)&&void 0!==s?s:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(i=t.websocketHost)&&void 0!==i?i:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new ve,responseTimeout:c.websocketResponseTimeout}};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var d=this.logger=new gt;this.logger.level=null!==(a=t.logLevel)&&void 0!==a?a:_t.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new S({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(o=t.localCacheEnabled)&&void 0!==o&&o}),this.debugMode=null!==(u=t.debugMode)&&void 0!==u&&u,this.maxSuperGroupChannelUnreadCount=l.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=c.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=c.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=c.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var p=this.dispatcher=new R,f=new A;this.requestQueue=new le(e,{auth:f,sdkState:h,dispatcher:p,logger:d}),this.sessionManager=new be({auth:f,sdkState:h,dispatcher:p,requestQueue:this.requestQueue,logger:d}),this.connectionManager=new pt(e,{sdkState:h,connectionHandlers:this.connectionHandlers,dispatcher:p,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:d}),this.statLogCollector=new mt({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:p}),this.autoResendManager=new Ka(e,{localCacheEnabled:this.cacheContext.localCacheEnabled,dispatcher:p,sdkState:h,logger:d})}return Wa[e]}return e.of=function(e){if(Wa[e])return Wa[e];throw p.lostInstance},e}();export{dr as $,h as A,Yt as B,p as C,a as D,U as E,i as F,Pn as G,o as H,De as I,C as J,I as K,c as L,re as M,sr as N,Ue as O,Er as P,H as Q,it as R,Wn as S,$t as T,fa as U,Ya as V,st as W,B as X,Aa as Y,tr as Z,t as _,v as a,fi as a$,ye as a0,X as a1,ut as a2,ct as a3,T as a4,M as a5,rn as a6,Ia as a7,lr as a8,jn as a9,ni as aA,Js as aB,nr as aC,rr as aD,Vs as aE,Ee as aF,Pe as aG,zn as aH,va as aI,kn as aJ,Xs as aK,Qt as aL,Fn as aM,Ba as aN,jt as aO,Ea as aP,ba as aQ,Na as aR,Ta as aS,ga as aT,ya as aU,ha as aV,$n as aW,Jn as aX,pa as aY,Nr as aZ,oi as a_,gr as aa,Qi as ab,Vi as ac,ji as ad,yr as ae,Bi as af,br as ag,xr as ah,Ps as ai,ee as aj,_t as ak,Pr as al,Dr as am,Ht as an,Tr as ao,vr as ap,mr as aq,pr as ar,te as as,nt as at,Gs as au,ce as av,Y as aw,za as ax,Hs as ay,Bs as az,E as b,_r as b0,Kn as b1,ci as b2,ui as b3,Ys as b4,Qs as b5,cn as b6,Ot as b7,da as b8,Xn as b9,Ha as bA,en as bB,rt as bC,Mn as bD,qt as bE,At as bF,Ut as bG,Bt as bH,ie as bI,It as bJ,zt as bK,Mt as bL,ne as bM,Ct as bN,St as bO,tn as bP,oe as bQ,Tt as bR,Nt as bS,vt as bT,ue as bU,ae as bV,Rt as bW,yt as bX,Kt as bY,kt as bZ,Gt as b_,Zn as ba,Ir as bb,Yn as bc,xe as bd,Fe as be,j as bf,d as bg,ss as bh,Kr as bi,ms as bj,hr as bk,ds as bl,fs as bm,us as bn,ls as bo,Fa as bp,bi as bq,xa as br,Qa as bs,Va as bt,Ms as bu,Ts as bv,Cs as bw,Ga as bx,bs as by,on as bz,g as c,Et as d,ir as e,ar as f,er as g,or as h,N as i,Un as j,fn as k,Vn as l,Qn as m,W as n,r as o,s as p,Oe as q,O as r,P as s,ot as t,n as u,k as v,Qe as w,bt as x,Ve as y,Ge as z};
