import{e,u as n,_ as t,s as r,q as a,g as s,o as i,p as o,b as c,c as l,a8 as u,r as h,A as d,d as f,f as p,h as _,O as v,b1 as C,ap as m,a as g,ba as y,aH as b,K as E,V as M,x as w,X as N,Y as U,W as I,al as D,B as T,aL as A,aA as k,am as S,aq as x,aF as H,aN as L}from"./lib/__bundle-753d9ea0.js";import{i as P,ay as O,p as F,q as R,_ as j,$ as V,a0 as G,a1 as B,a2 as q,a3 as z,t as W}from"./lib/__bundle-2cf97ad3.js";import{F as Q,D as J,E as X,T as K,I as $,J as ee,p as ne,K as te,L as re,m as ae,N as se,V as ie,W as oe,c as ce,X as le}from"./lib/__bundle-6aed501c.js";export{Y as FeedChannelEventContext,Z as NotificationEventContext}from"./lib/__bundle-6aed501c.js";import{g as ue,N as he}from"./lib/__bundle-ccebf220.js";import{D as de}from"./lib/__bundle-743309b9.js";import{a as fe,C as pe,b as _e,U as ve,A as Ce,B as me}from"./lib/__bundle-b19328da.js";import"./lib/__bundle-c336221f.js";var ge=function(){function t(e){this.id=e.id,this.name=e.name,this.isDefault=e.is_default}return t.payloadify=function(t){return e(n({id:t.id,name:t.name,is_default:t.isDefault}))},Object.defineProperty(t.prototype,"customType",{get:function(){return this.isDefault?"*":String(this.id)},enumerable:!1,configurable:!0}),t}(),ye=function(n){function u(e,t){var r=t.sdkState,a=t.cacheContext,s=t.channelManager,i=n.call(this,e)||this;return i._channels=new Map,i._sdkState=r,i._cacheContext=a,i._channelManager=s,i}return t(u,n),Object.defineProperty(u.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return r(!!e).throw(a.databaseError),e.collection(P)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),u.prototype._serialize=function(e,n){return void 0===n&&(n=0),s(s({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:n})},u.prototype._deserialize=function(e){return this._channelManager.buildFeedChannelFromSerializedData(e)},Object.defineProperty(u.prototype,"channels",{get:function(){return i([],o(this._channels.values()),!1)},enumerable:!1,configurable:!0}),u.prototype.isCachedInMemory=function(e){return this._channels.has(e)},u.prototype.get=function(e){return c(this,void 0,void 0,(function(){var n;return l(this,(function(t){switch(t.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(n=t.sent())return this._channels.set(e,this._deserialize(n)),[2,this._channels.get(e)];t.label=2;case 2:return[2,void 0];case 3:return[2,this._channels.get(e)]}}))}))},u.prototype.fetch=function(e){var n=e.token,t=e.limit,r=void 0===t?O:t,a=e.backward,s=void 0!==a&&a,i=e.order,o=void 0===i?"latest_last_message":i,u=e.borderlineChannelUrl;return c(this,void 0,void 0,(function(){var e,t,a,i,c=this;return l(this,(function(l){switch(l.label){case 0:return this.localCacheEnabled?(e=ue(o),t={where:function(e){if(n&&"latest_last_message"===o){if(!s&&e.lastMessageUpdatedAt>n||s&&e.lastMessageUpdatedAt<n)return!1;if(u&&u===e.url)return!1}return!0},index:e,backward:s},[4,this.collection.query(t)]):[3,3];case 1:return[4,l.sent().fetch({limit:r})];case 2:return a=l.sent(),(i=a.map((function(e){return c._deserialize(e)}))).forEach((function(e){c._channels.has(e.url)||c._channels.set(e.url,e)})),[2,i];case 3:return[2,[]]}}))}))},u.prototype.upsert=function(n){return c(this,void 0,void 0,(function(){var t,r,a,s=this;return l(this,(function(i){switch(i.label){case 0:if(t=[],n.forEach((function(n){if(s._channels.has(n.url)){var r=s._channels.get(n.url),a=e(n);Object.assign(r,a,{_iid:s._iid}),t.push(r)}else s._channels.set(n.url,n),t.push(n)})),!this.localCacheEnabled)return[3,2];for(a in r=[],t)r.push(this._serialize(t[a],parseInt(a)));return[4,this.collection.upsertMany(r)];case 1:i.sent(),i.label=2;case 2:return[2,t]}}))}))},u.prototype.remove=function(e){return c(this,void 0,void 0,(function(){var n,t,r,a,s,i;return l(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),n=h(e),t=n.next(),o.label=1;case 1:return t.done?[3,4]:(r=t.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return t=n.next(),[3,1];case 4:return[3,7];case 5:return a=o.sent(),s={error:a},[3,7];case 6:try{t&&!t.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},u.prototype.clear=function(){return c(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},u.prototype.clearMemoryCache=function(){this._channels.clear()},u}(u),be=!1,Ee=function(n){function r(t){var r=n.call(this)||this,a=t.userId,s=t.token,i=t.limit,o=t.includeEmpty;return r.method=d.GET,r.path="".concat(f,"/").concat(encodeURIComponent(a),"/my_group_channels"),r.params=e({token:s,limit:i,show_empty:null!=o?o:be,show_read_receipt:!0,show_delivery_receipt:!0,show_member:!0,is_feed_channel:!0,order:"latest_last_message"}),r}return t(r,n),r}(p),Me=function(e){function n(n,t){var r=e.call(this,n,t)||this;r.channels=[];var a=t.next,s=t.channels,i=t.ts;return r.token=a,r.ts=null!=i?i:0,r.channels=(null!=s?s:[]).map((function(e){return e.ts=i,new Ve(n,e)})),r}return t(n,e),n}(_),we=function(){function e(e){var n=e.feedChannelCache,t=e.messageCache,r=e.unsentMessageCache,a=e.dispatcher,s=this;this._observers=new Map,a.on((function(e){return c(s,void 0,void 0,(function(){var a,s,i,o,u,d,f,p=this;return l(this,(function(_){switch(_.label){case 0:return e instanceof J?(a=e.channels,d=e.source,f=e.isWebSocketEventComing,s=e.data,i=a.filter((function(e){return e instanceof Ve})),[4,n.upsert(i)]):[3,2];case 1:return o=_.sent(),f||this._broadcastUpdateEvent(o,d,s),[3,7];case 2:return e instanceof Q?(u=e.channelUrls,d=e.source,f=e.isWebSocketEventComing,[4,n.remove(u)]):[3,5];case 3:return _.sent(),[4,v((function(){return c(p,void 0,void 0,(function(){var e,n,a,s,i,o;return l(this,(function(c){switch(c.label){case 0:c.trys.push([0,6,7,8]),e=h(u),n=e.next(),c.label=1;case 1:return n.done?[3,5]:(a=n.value,[4,t.removeMessagesOfChannel(a)]);case 2:return c.sent(),[4,r.removeMessagesOfChannel(a)];case 3:c.sent(),c.label=4;case 4:return n=e.next(),[3,1];case 5:return[3,8];case 6:return s=c.sent(),i={error:s},[3,8];case 7:try{n&&!n.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))}))];case 4:return _.sent(),f||this._broadcastRemoveEvent(u,d),[3,7];case 5:return e instanceof de?[4,n.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,7];case 6:_.sent(),_.label=7;case 7:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,n,t){var r,a;try{for(var s=h(this._observers.values()),i=s.next();!i.done;i=s.next()){var o=i.value;o.onUpdate&&o.onUpdate(e,n,t)}}catch(e){r={error:e}}finally{try{i&&!i.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}},e.prototype._broadcastRemoveEvent=function(e,n){var t,r;try{for(var a=h(this._observers.values()),s=a.next();!s.done;s=a.next()){var i=s.value;i.onRemove&&i.onRemove(e,n)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.subscribe=function(e,n){this._observers.set(e,n)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),Ne=function(e){function n(n){var t=n.channelUrl,r=n.isInternalCall,a=e.call(this)||this;return a.method=d.GET,a.path="".concat(r?C:m,"/").concat(encodeURIComponent(t)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,is_feed_channel:!0},a}return t(n,e),n}(p),Ue=function(e){function n(n,t){var r=e.call(this,n,t)||this;return r.channel=new Ve(n,t),r}return t(n,e),n}(_),Ie={includeEmpty:!0},De=function(e){return g("boolean",e.includeEmpty)},Te=function(r){function a(t){var a=t.userId,i=t.ts,o=t.token,c=t.params,l=r.call(this)||this,u=s(s({},Ie),c).includeEmpty;return l.method=d.GET,l.path="".concat(f,"/").concat(encodeURIComponent(a),"/my_group_channels/changelogs"),l.params=e(n({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,is_feed_channel:!0,show_empty:u,change_ts:i||null,token:o})),l}return t(a,r),a}(p),Ae=function(e){function n(n,t){var r=e.call(this,n,t)||this;return r.updatedChannels=t.updated.map((function(e){return new Ve(n,e)})),r.deletedChannelUrls=t.deleted,r.hasMore=t.has_more,r.token=t.next,r}return t(n,e),n}(_),ke=function(e){function n(){var n=e.call(this)||this;return n.method=d.GET,n.path="".concat(y,"/settings"),n}return t(n,e),n}(p),Se=function(e){function n(n,t){var r=e.call(this,n,t)||this;return r.jsonString=JSON.stringify(t),r}return t(n,e),n}(_),xe=function(n){function r(t){var r=this,a=t.reverse,s=void 0!==a&&a,i=t.keys,o=t.limit,c=void 0===o?20:o,l=t.token;return(r=n.call(this)||this).method=d.GET,r.path="".concat(y,"/templates"),r.params=e({token:l,keys:i,limit:c,reverse:s,order:"updated_at",show_ui_template:!0,show_color_variables:!0}),r}return t(r,n),r}(p),He=function(e){function n(n,t){var r=e.call(this,n,t)||this,a=t.next,s=t.has_more,i=void 0!==s&&s,o=b(t,["next","has_more"]);return r.nextToken=a,r.hasMore=i,r.notificationTemplateList={jsonString:JSON.stringify(o)},r}return t(n,e),n}(_),Le={reverse:!1,keys:void 0,limit:20},Pe=function(n){function r(t){var r=this,a=t.key;return(r=n.call(this)||this).method=d.GET,r.path="".concat(y,"/templates/").concat(a),r.params=e({key:a}),r}return t(r,n),r}(p),Oe=function(e){function n(n,t){var r=e.call(this,n,t)||this;return r.jsonString=JSON.stringify(t),r}return t(n,e),n}(_),Fe={},Re=function(e){function u(n,t){var r,a=this;return(a=e.call(this,n,s(s({},t),{channelType:U.FEED}))||this)._disableMack=!1,a._disableMack=null!==(r=t.disableMack)&&void 0!==r&&r,a._feedChannelHandlers=new Map,a._feedChannelCache=new ye(a._iid,{sdkState:a._sdkState,cacheContext:a._cacheContext,channelManager:a}),a._feedChannelBroadcast=new we({feedChannelCache:a._feedChannelCache,dispatcher:a._dispatcher,messageCache:F.of(n),unsentMessageCache:R.of(n)}),a._dispatcher.on((function(e){e instanceof I&&a._handleEvent(e)})),Fe[n]||(Fe[n]=a),a}return t(u,e),u.of=function(e){return Fe[e]||(Fe[e]=new u(e,M.of(e))),Fe[e]},u.clear=function(e){Fe[e]&&delete Fe[e]},Object.defineProperty(u.prototype,"handlers",{get:function(){return i([],o(this._feedChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),u.prototype.buildFeedChannelFromSerializedData=function(e){var n=w(e);return new Ve(this._iid,Ve.payloadify(n))},u.prototype.addHandler=function(e,n){this._feedChannelHandlers.set(e,n)},u.prototype.removeHandler=function(e){this._feedChannelHandlers.delete(e)},u.prototype.clearHandler=function(){this._feedChannelHandlers.clear()},u.prototype.getMyFeedChannels=function(e,n,t){return c(this,void 0,void 0,(function(){var r,a,i,o,c;return l(this,(function(l){switch(l.label){case 0:return r=new Ee(s(s({},n),{userId:this._sdkState.userId,token:e,limit:t})),[4,this._requestQueue.send(r)];case 1:return a=l.sent(),i=a.as(Me),o=i.channels,c=i.token,[2,{channels:o,token:c}]}}))}))},u.prototype.getChannel=function(e,n){return void 0===n&&(n=!1),c(this,void 0,void 0,(function(){var t;return l(this,(function(s){switch(s.label){case 0:r(g("string",e)).throw(a.invalidParameters),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(t=s.sent())?[2,t]:[3,4];case 3:return s.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,n)];case 5:return[2,s.sent()]}}))}))},u.prototype.getChannelFromCache=function(e){var n;return c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return r(g("string",e)).throw(a.invalidParameters),[4,this._feedChannelCache.get(e)];case 1:return[2,null!==(n=t.sent())&&void 0!==n?n:null]}}))}))},u.prototype.getChannelWithoutCache=function(e,n){return void 0===n&&(n=!1),c(this,void 0,void 0,(function(){var t,s,i,c;return l(this,(function(l){switch(l.label){case 0:return r(g("string",e)).throw(a.invalidParameters),t=new Ne({channelUrl:e,isInternalCall:n}),[4,this._requestQueue.send(t)];case 1:return s=l.sent(),i=s.as(Ue).channel,[4,this.upsertChannelsToCache([i])];case 2:return c=o.apply(void 0,[l.sent(),1]),[2,c[0]]}}))}))},u.prototype.getMyFeedChannelChangeLogs=function(e,t,i){return void 0===i&&(i=N.REQUEST_CHANNEL_CHANGELOGS),c(this,void 0,void 0,(function(){var o,c,u,h,d,f,p,_;return l(this,(function(l){switch(l.label){case 0:return o=s(s({},Ie),t),r((g("string",e)||g("number",e))&&De(o)).throw(a.invalidParameters),c=new Te(n({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,params:o})),[4,this._requestQueue.send(c)];case 1:return u=l.sent(),h=u.as(Ae),d=h.updatedChannels,f=h.deletedChannelUrls,p=h.hasMore,_=h.token,d.length>0&&this._dispatcher.dispatch(new J({channels:d,source:i})),f.length>0&&this._dispatcher.dispatch(new Q({channelUrls:f,source:i})),[2,{updatedChannels:d,deletedChannelUrls:f,hasMore:p,token:_}]}}))}))},u.prototype.getTotalUnreadMessageCount=function(e){return c(this,void 0,void 0,(function(){var n,t,i,o,c,u,h;return l(this,(function(l){switch(l.label){case 0:return n=s(s({},K),e),r($(n)).throw(a.invalidParameters),t=M.of(this._iid),i=t.sdkState,o=t.requestQueue,c=new ee({userId:i.userId,filter:n,includeFeedChannel:!0}),[4,o.send(c)];case 1:return u=l.sent(),h=u.as(X).unreadFeedCount,[2,void 0===h?0:h]}}))}))},u.prototype.getGlobalNotificationChannelSetting=function(){return c(this,void 0,void 0,(function(){var e,n;return l(this,(function(t){switch(t.label){case 0:return e=new ke,[4,this._requestQueue.send(e)];case 1:return n=t.sent(),[2,{jsonString:n.as(Se).jsonString}]}}))}))},u.prototype.getNotificationTemplateListByToken=function(e,n){return void 0===n&&(n={}),c(this,void 0,void 0,(function(){var t,i,o,c,u,h,d;return l(this,(function(l){switch(l.label){case 0:return t=s(s({},Le),n),r(g("string",e)&&function(e){return g("boolean",e.reverse,!0)&&E("string",e.keys,!0)&&g("number",e.limit,!0)}(t)).throw(a.invalidParameters),i=new xe({token:e,keys:t.keys,reverse:t.reverse,limit:t.limit}),[4,this._requestQueue.send(i)];case 1:return o=l.sent(),c=o.as(He),u=c.hasMore,h=c.nextToken,d=c.notificationTemplateList,[2,{hasMore:u,token:h,notificationTemplateList:d}]}}))}))},u.prototype.getNotificationTemplate=function(e){return c(this,void 0,void 0,(function(){var n,t;return l(this,(function(s){switch(s.label){case 0:return r(g("string",e)).throw(a.invalidParameters),n=new Pe({key:e}),[4,this._requestQueue.send(n)];case 1:return t=s.sent(),[2,{jsonString:t.as(Oe).jsonString}]}}))}))},u.prototype.upsertChannelsToCache=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this._feedChannelCache.upsert(e)];case 1:return[2,n.sent()]}}))}))},u.prototype.removeChannelsFromCache=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this._feedChannelCache.remove(e)];case 1:return n.sent(),[2]}}))}))},u.prototype.refreshChannel=function(e,n,t){return void 0===n&&(n=!0),void 0===t&&(t=N.REFRESH_CHANNEL),c(this,void 0,void 0,(function(){var r,a,s,i,o;return l(this,(function(c){switch(c.label){case 0:return c.trys.push([0,5,,6]),r=new Ne({channelUrl:e,isInternalCall:n}),[4,this._requestQueue.send(r)];case 1:return a=c.sent(),(s=a.as(Ue).channel).myMemberState!==ne.NONE?[3,2]:(this._dispatcher.dispatch(new Q({channelUrls:[s.url],source:t})),[3,4]);case 2:return[4,this.upsertChannelsToCache([s])];case 3:i=c.sent(),this._dispatcher.dispatch(new J({channels:i,source:t})),c.label=4;case 4:return[3,6];case 5:return(o=c.sent()).code!==D.NON_AUTHORIZED&&o.code!==D.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new Q({channelUrls:[e],source:t})),[3,6];case 6:return[2]}}))}))},u.prototype.refreshNotificationCollections=function(){this._dispatcher.dispatch(new he)},u.prototype.subscribeChannelEvent=function(e,n){this._feedChannelBroadcast.subscribe(e,n)},u.prototype.unsubscribeChannelEvent=function(e){this._feedChannelBroadcast.unsubscribe(e)},u.prototype._handleEvent=function(e){return c(this,void 0,void 0,(function(){var n,t,r,a,s,i,o,u,d,f,p,_,C,m,g,y,b,E,w,U,I=this;return l(this,(function(D){switch(D.label){case 0:switch(e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"SYEV":return[3,13]}return[3,23];case 1:return(g="MESG"===e.code?e.as(q):"FILE"===e.code?e.as(z):"ADMM"===e.code||"BRDM"===e.code?e.as(Ce):null)&&g.message.channelType===this._channelType?(n=g.message,t=g.isMentioned,r=g.forceUpdateLastMessage,this._disableMack||v((function(){return c(I,void 0,void 0,(function(){var e;return l(this,(function(t){return e=new ie(n),this._requestQueue.send(e),[2]}))}))})),[4,this.getChannel(n.channelUrl,!0)]):[3,3];case 2:(a=D.sent())._runIfHandleableWithGroupChannel((function(e){var s,i,o,u=I._feedChannelCache.isCachedInMemory(n.channelUrl),d=n instanceof V&&n.sender.userId===I._sdkState.userId;if(e.hiddenState===ae.HIDDEN_ALLOW_AUTO_UNHIDE&&(e.hiddenState=ae.UNHIDDEN),n instanceof V){var f=M.of(I._iid).useMemberInfoInMessage;try{for(var p=h(e.members),_=p.next();!_.done;_=p.next()){var v=_.value;if(v.userId===n.sender.userId){f||(n.sender.nickname=v.nickname,n.sender.plainProfileUrl=v.plainProfileUrl,n.sender.metaData=v.metaData,n.sender.isBlockedByMe=v.isBlockedByMe);break}}}catch(e){s={error:e}}finally{try{_&&!_.done&&(i=p.return)&&i.call(p)}finally{if(s)throw s.error}}if(!f&&t&&(null===(o=n.mentionedUsers)||void 0===o||o.forEach((function(n){var t,r;try{for(var a=h(e.members),s=a.next();!s.done;s=a.next()){var i=s.value;if(n.userId===i.userId){n.nickname=i.nickname,n.plainProfileUrl=i.plainProfileUrl,n.metaData=i.metaData;break}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}))),d){var C=I._sessionManager.currentUser;C&&(C.nickname=n.sender.nickname,C.plainProfileUrl=n.sender.plainProfileUrl,C.metaData=n.sender.metaData)}}n.silent&&!d||(e.isEphemeral||u)&&((!e.lastMessage||e.lastMessage.createdAt<n.createdAt)&&(e.lastMessage=n),d||e._updateUnreadCount(e.unreadMessageCount+1,e.unreadMentionCount+(t?1:0))),r&&(!e.lastMessage||e.lastMessage.createdAt<n.createdAt)&&(e.lastMessage=n),I._dispatcher.dispatch(new J({channels:[a],source:N.EVENT_MESSAGE_RECEIVED})),n.silent&&!d||T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,s;return l(this,(function(i){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onChannelChanged&&t.onChannelChanged(a)}catch(e){r={error:e}}finally{try{n&&!n.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),I._dispatcher.dispatch(new k({messages:[n],source:N.EVENT_MESSAGE_RECEIVED})),T((function(){return c(I,void 0,void 0,(function(){var e,r,s,i,o;return l(this,(function(c){try{for(e=h(this._feedChannelHandlers.values()),r=e.next();!r.done;r=e.next())(s=r.value).onMessageReceived&&s.onMessageReceived(a,n),t&&s.onMentionReceived&&s.onMentionReceived(a,n)}catch(e){i={error:e}}finally{try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}}return[2]}))}))}))})),D.label=3;case 3:return[3,23];case 4:return(g="MEDI"===e.code?e.as(G):"FEDI"===e.code?e.as(B):"AEDI"===e.code?e.as(ve):null)&&g.message.channelType===this._channelType?(s=g.message,i=g.mentionCountChange,o=this._feedChannelCache.isCachedInMemory(s.channelUrl),[4,this.getChannel(s.channelUrl,!0)]):[3,6];case 5:(u=D.sent())._runIfHandleableWithGroupChannel((function(e){var n=s instanceof V&&s.sender.userId===I._sdkState.userId,t=!1;if(n){var r=s.sender,a=I._sessionManager.currentUser;a&&(a.nickname=r.nickname,a.plainProfileUrl=r.plainProfileUrl,a.metaData=r.metaData)}else e.isReadMessage(s)||0!==i&&!s.silent&&o&&(e._updateUnreadCount(e.unreadMessageCount,e.unreadMentionCount+i),t=!0);!e.lastMessage||e.lastMessage.createdAt<s.createdAt?(e.lastMessage=s,t=!0):e.lastMessage.isIdentical(s)&&(o?e.lastMessage.updatedAt<s.updatedAt&&(e.lastMessage=s,t=!0):t=!0);var d=!1;e.lastPinnedMessage&&e.lastPinnedMessage.messageId===s.messageId&&(e.lastPinnedMessage=s,t=!0,d=!0),t&&(I._dispatcher.dispatch(new J({channels:[u],source:d?N.EVENT_PINNED_MESSAGE_UPDATED:N.EVENT_MESSAGE_UPDATED})),s.silent&&!n||T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,a;return l(this,(function(s){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onChannelChanged&&t.onChannelChanged(u)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),I._dispatcher.dispatch(new k({messages:[s],source:N.EVENT_MESSAGE_UPDATED})),T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,a;return l(this,(function(o){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onMessageUpdated&&t.onMessageUpdated(u,s),0!==i&&t.onMentionReceived&&t.onMentionReceived(u,s)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))})),D.label=6;case 6:return[3,23];case 7:return(g="DELM"===e.code?e.as(j):null)&&g.channelType===this._channelType?(d=g.channelUrl,f=g.messageId,[4,this.getChannel(d,!0)]):[3,9];case 8:p=D.sent(),this._dispatcher.dispatch(new A({messageIds:[f],source:N.EVENT_MESSAGE_DELETED})),T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,a;return l(this,(function(s){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onMessageDeleted&&t.onMessageDeleted(p,f)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),D.label=9;case 9:return[3,23];case 10:return(g="READ"===e.code?e.as(se):null)?(_=g.readStatus,C=this._feedChannelCache.isCachedInMemory(_.channelUrl),[4,this.getChannel(_.channelUrl,!0)]):[3,12];case 11:(m=D.sent())._runIfHandleableWithGroupChannel((function(e){C&&e._updateUnreadMemberState(_.reader.userId,_.readAt),_.reader.userId===I._sdkState.userId?C?(e.unreadMessageCount>0||e.unreadMentionCount>0)&&(e._updateUnreadCount(0,0),I._dispatcher.dispatch(new J({channels:[m],source:N.EVENT_CHANNEL_READ})),T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,a;return l(this,(function(s){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onChannelChanged&&t.onChannelChanged(m)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))):0!==e.unreadMessageCount&&0!==e.unreadMentionCount||(I._dispatcher.dispatch(new J({channels:[m],source:N.EVENT_CHANNEL_READ})),T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,a;return l(this,(function(s){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onChannelChanged&&t.onChannelChanged(m)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))):(I._dispatcher.dispatch(new J({channels:[m],source:N.EVENT_CHANNEL_READ})),T((function(){return c(I,void 0,void 0,(function(){var e,n,t,r,a;return l(this,(function(s){try{for(e=h(this._feedChannelHandlers.values()),n=e.next();!n.done;n=e.next())(t=n.value).onUnreadMemberStatusUpdated&&t.onUnreadMemberStatusUpdated(m)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=e.return)&&a.call(e)}finally{if(r)throw r.error}}return[2]}))}))})))})),D.label=12;case 12:return[3,23];case 13:if(!(g="SYEV"===e.code?e.as(pe):null)||g.event.channelType!==this._channelType)return[3,22];switch(y=g.event,y.category){case _e.CHANNEL_INVITE:return[3,14];case _e.CHANNEL_DECLINE_INVITE:return[3,16];case _e.CHANNEL_DELETED:return[3,18];case _e.CHANNEL_PROP_CHANGED:return[3,20]}return[3,22];case 14:return[4,this.getChannel(y.channelUrl,!0)];case 15:return(b=D.sent())._runIfHandleableWithGroupChannel((function(n){var t,r,a=e.as(re),s=a.memberCount,i=a.joinedMemberCount,o=a.invitees;o.forEach((function(e){return e.state=ne.INVITED}));try{for(var c=h(o),l=c.next();!l.done;l=c.next()){var u=l.value;n.isExclusive||n.isSuper||n.isBroadcast?n._setLatestMemberCount(s,i,y.ts):n.addMember(u,y.ts),I._sdkState.userId===u.userId&&(n.hiddenState=ae.UNHIDDEN,n.myMemberState!==ne.JOINED&&(n.myMemberState=ne.INVITED),n.invitedAt=y.ts)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}I._dispatcher.dispatch(new J({channels:[b],source:N.EVENT_CHANNEL_INVITED}))})),[3,22];case 16:return[4,this.getChannel(y.channelUrl,!0)];case 17:return(E=D.sent())._runIfHandleableWithGroupChannel((function(n){var t=e.as(te),r=t.memberCount,a=t.joinedMemberCount,s=t.invitee;n.isExclusive||n.isSuper||n.isBroadcast?n._setLatestMemberCount(r,a,y.ts):n.removeMember(s),I._sdkState.userId===s.userId?(n.invitedAt=0,n.myMemberState=ne.NONE,n.isPublic?I._dispatcher.dispatch(new J({channels:[E],source:N.EVENT_CHANNEL_DECLINED_INVITE})):I._dispatcher.dispatch(new Q({channelUrls:[E.url],source:N.EVENT_CHANNEL_DECLINED_INVITE}))):I._dispatcher.dispatch(new J({channels:[E],source:N.EVENT_CHANNEL_DECLINED_INVITE}))})),[3,22];case 18:return[4,this.getChannel(y.channelUrl,!0)];case 19:return w=D.sent(),this._dispatcher.dispatch(new Q({channelUrls:[y.channelUrl],source:N.EVENT_CHANNEL_DELETED})),T((function(){return c(I,void 0,void 0,(function(){return l(this,(function(e){return this._feedChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(w.url,w.channelType)})),[2]}))}))})),[3,22];case 20:return[4,this.getChannelWithoutCache(y.channelUrl,!0)];case 21:return U=D.sent(),this._dispatcher.dispatch(new J({channels:[U],source:N.EVENT_CHANNEL_UPDATED})),T((function(){return c(I,void 0,void 0,(function(){return l(this,(function(e){return this._feedChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(U)})),[2]}))}))})),[3,22];case 22:return[3,23];case 23:return[2]}}))}))},u}(fe),je=function(e){function n(n,t){var r=e.call(this,n,s(s({},t),{channelManager:Re.of(n)}))||this,a=M.of(r._iid),i=a.connectionManager,o=a.dispatcher;return r._notificationCollectionEventContext=o.on((function(e){e instanceof he&&S(10).then((function(){i.isConnected||i.isConnecting||r.refresh()}))})),r}return t(n,e),n.prototype.dispose=function(){e.prototype.dispose.call(this),this._notificationCollectionEventContext.close()},n.prototype.setMessageCollectionHandler=function(e){this._setBaseMessageCollectionHandler(e)},n.prototype.refresh=function(){return c(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this._activate()];case 1:return e.sent(),[2]}}))}))},n}(oe),Ve=function(e){function n(n,t){var r,a,s=this;return(s=e.call(this,n,t)||this).channelType=U.FEED,s._groupChannel=new ce(n,t),s.isCategoryFilterEnabled=null!==(r=t.is_category_filter_enabled)&&void 0!==r&&r,s.isTemplateLabelEnabled=null===(a=t.is_template_label_enabled)||void 0===a||a,s.notificationCategories=t.categories?t.categories.map((function(e){return new ge(e)})):[],s}return t(n,e),n.payloadify=function(e){var n;return s(s({},ce.payloadify(null!==(n=e._groupChannel)&&void 0!==n?n:e)),{is_category_filter_enabled:e.isCategoryFilterEnabled,is_template_label_enabled:e.isTemplateLabelEnabled,categories:e.notificationCategories.map((function(e){return ge.payloadify(e)}))})},Object.defineProperty(n.prototype,"groupChannel",{get:function(){return this._groupChannel},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"url",{get:function(){return this._groupChannel.url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._groupChannel.name},set:function(e){this._groupChannel.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"createdAt",{get:function(){return this._groupChannel.createdAt},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"members",{get:function(){return this._groupChannel.members},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"memberCount",{get:function(){return this._groupChannel.memberCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"myMemberState",{get:function(){return this._groupChannel.myMemberState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"myLastRead",{get:function(){return this._groupChannel.myLastRead},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastMessage",{get:function(){return this._groupChannel.lastMessage},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"unreadMessageCount",{get:function(){return this._groupChannel.unreadMessageCount},enumerable:!1,configurable:!0}),n.prototype.serialize=function(){return s({},this._groupChannel.serialize())},n.prototype.refresh=function(){return c(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this._groupChannel._refresh(!0)];case 1:return e.sent(),[2,this]}}))}))},n.prototype.markAsRead=function(){return c(this,void 0,void 0,(function(){var e,n,t,r,a,s,i,o=this;return l(this,(function(c){switch(c.label){case 0:return e=M.of(this._iid),n=e.sdkState,t=e.dispatcher,r=e.requestQueue,a=new le({channelUrl:this.url}),[4,r.send(a)];case 1:return s=c.sent(),i=s.as(se).readStatus,this._groupChannel._updateUnreadMemberState(n.userId,i.readAt),(this._groupChannel.unreadMessageCount>0||this._groupChannel.unreadMentionCount>0)&&(this._groupChannel._updateUnreadCount(0,0),Re.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)}))),t.dispatch(new J({channels:[this],source:N.EVENT_CHANNEL_READ})),[2]}}))}))},n.prototype.createNotificationCollection=function(e){return void 0===e&&(e={}),new je(this._iid,s({channel:this},e))},n}(W),Ge=["onUserMuted","onUserUnmuted","onUserBanned","onUserUnbanned","onChannelFrozen","onChannelUnfrozen","onOperatorUpdated","onMetaDataCreated","onMetaDataUpdated","onMetaDataDeleted","onMetaCounterCreated","onMetaCounterUpdated","onMetaCounterDeleted","onReactionUpdated","onThreadInfoUpdated"],Be=function(e){function n(n){void 0===n&&(n={});var t=e.call(this)||this;return Object.keys(n).forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&-1===Ge.indexOf(e)&&(t[e]=n[e])})),t}return t(n,e),n}(function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.onUnreadMemberStatusUpdated=x,n.onUserMuted=x,n.onUserUnmuted=x,n.onUserBanned=x,n.onUserUnbanned=x,n.onChannelFrozen=x,n.onChannelUnfrozen=x,n.onOperatorUpdated=x,n.onMetaDataCreated=x,n.onMetaDataUpdated=x,n.onMetaDataDeleted=x,n.onMetaCounterCreated=x,n.onMetaCounterUpdated=x,n.onMetaCounterDeleted=x,n.onReactionUpdated=x,n.onThreadInfoUpdated=x,n}return t(n,e),n}(me)),qe=function(e){function r(n,t){var r,a=this;return(a=e.call(this,n,t)||this).includeEmpty=be,a.includeEmpty=null!==(r=t.includeEmpty)&&void 0!==r?r:be,a}return t(r,e),r.prototype._validate=function(){return e.prototype._validate.call(this)&&g("boolean",this.includeEmpty)},r.prototype.next=function(){return c(this,void 0,void 0,(function(){var e,t,r,i,o;return l(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=Re.of(this._iid),t=n(s({},this)),[4,e.getMyFeedChannels(this._token,t,this.limit)]):[3,2]:[3,5];case 1:return r=c.sent(),i=r.channels,o=r.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw a.queryInProgress;case 4:return[3,6];case 5:throw a.invalidParameters;case 6:return[2]}}))}))},r}(H),ze=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.name="feedChannel",n}return t(n,e),n.prototype.init=function(n,t){e.prototype.init.call(this,n,t),this._manager=new Re(n,t)},n.prototype.createMyFeedChannelListQuery=function(e){return void 0===e&&(e={}),new qe(this._iid,e)},n.prototype.addFeedChannelHandler=function(e,n){r(g("string",e)&&n instanceof Be).throw(a.invalidParameters),this._manager.addHandler(e,n)},n.prototype.removeFeedChannelHandler=function(e){r(g("string",e)).throw(a.invalidParameters),this._manager.removeHandler(e)},n.prototype.removeAllFeedChannelHandlers=function(){this._manager.clearHandler()},n.prototype.getChannel=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(n){return r(g("string",e)).throw(a.invalidParameters),[2,this._manager.getChannel(e)]}))}))},n.prototype.getMyFeedChannelChangeLogsByTimestamp=function(e,n){return void 0===n&&(n={}),c(this,void 0,void 0,(function(){var t;return l(this,(function(i){switch(i.label){case 0:return t=s(s({},Ie),n),r(g("number",e)&&De(t)).throw(a.invalidParameters),[4,this._manager.getMyFeedChannelChangeLogs(e,t)];case 1:return[2,i.sent()]}}))}))},n.prototype.getMyFeedChannelChangeLogsByToken=function(e,n){return void 0===n&&(n={}),c(this,void 0,void 0,(function(){var t;return l(this,(function(i){switch(i.label){case 0:return t=s(s({},Ie),n),r(g("string",e)&&De(t)).throw(a.invalidParameters),[4,this._manager.getMyFeedChannelChangeLogs(e,t)];case 1:return[2,i.sent()]}}))}))},n.prototype.getTotalUnreadMessageCount=function(e){return void 0===e&&(e={}),c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,n.sent()]}}))}))},n.prototype.getGlobalNotificationChannelSetting=function(){return c(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this._manager.getGlobalNotificationChannelSetting()];case 1:return[2,e.sent()]}}))}))},n.prototype.getNotificationTemplateListByToken=function(e,n){return void 0===n&&(n={}),c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,this._manager.getNotificationTemplateListByToken(e,n)];case 1:return[2,t.sent()]}}))}))},n.prototype.getNotificationTemplate=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this._manager.getNotificationTemplate(e)];case 1:return[2,n.sent()]}}))}))},n.prototype.refreshNotificationCollections=function(){this._manager.refreshNotificationCollections()},n}(L);export{Ve as FeedChannel,Be as FeedChannelHandler,qe as FeedChannelListQuery,ze as FeedChannelModule,ge as NotificationCategory,je as NotificationCollection};
