import{_ as e,i as t,a as n,b as r,c as i,n as s,I as u,d as l,e as h,A as f,f as p,g as v,h as _,U as m,j as y,k as g,l as I,m as w,B as N,S as T,V as A,o as D,p as K,q as j,D as H,v as V,r as G,C as z,u as Q,M as W,s as Y,W as X,t as J,w as Z,x as $,y as ee,z as te}from"./__bundle-86e9a5d0.js";export{E as ChannelType,C as ConnectionState,L as LogLevel,P as Plugin,R as Role,x as SendbirdChatOptions,S as SendbirdError,U as User,F as UserOnlineState}from"./__bundle-86e9a5d0.js";import{U as ne,S as re,N as ie,a as oe,g as se,G as ae,b as ue,c as ce,d as le,M as he,e as de,f as fe,P as pe,h as ve,i as _e,j as me,D as ye,k as be,l as ge,m as Ee,n as Ie,o as we,p as ke,q as Ne}from"./__bundle-e0e512f3.js";export{q as PushTemplate,k as PushTokenRegistrationState,P as PushTokenType,o as PushTriggerOption}from"./__bundle-e0e512f3.js";export{B as BannedUserListQuery,a as BaseChannel,M as MutedUserListQuery,O as OperatorListQuery,R as ReportCategory,b as RestrictedUser,c as RestrictionInfo,d as RestrictionType}from"./__bundle-edd6c4b7.js";var Oe=function(){this.profileImage=null,this.profileUrl=null,this.nickname=null},Te=function(r){function i(e){var t=r.call(this)||this;if(e)for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n]);return t}return e(i,r),i.prototype.validate=function(){return t(this.profileImage,!0)&&n("string",this.profileUrl,!0)&&n("string",this.nickname,!0)},i}(Oe),Se=function(){},Ce=function(t){function n(e){var n=t.call(this)||this;if(e)for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r]);return n}return e(n,t),n.prototype.validate=function(){return r(ne,this.keys)},n}(Se),xe=function(){this.channelCustomTypesFilter=[],this.superChannelFilter=re.ALL},Re=function(t){function n(e){var n=t.call(this)||this;if(e)for(var r in e)n.hasOwnProperty(r)&&(n[r]=e[r]);return n}return e(n,t),n.prototype.validate=function(){return r("string",this.channelCustomTypesFilter)&&i(re,this.superChannelFilter)},n}(xe),Le=function(){this.onSessionExpired=s,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=s,this.onSessionRefreshed=s,this.onSessionClosed=s},Ae=function(){this.onConnected=s,this.onReconnectStarted=s,this.onReconnectSucceeded=s,this.onReconnectFailed=s,this.onDisconnected=s},Pe=function(){this.onFriendsDiscovered=s,this.onTotalUnreadMessageCountUpdated=s};!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(u);var De=function(){function e(e){var t=e.logger,n=e.connectionDelegate;this.logger=t,this.connectionDelegate=n}return Object.defineProperty(e.prototype,"isAvailable",{get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype.onlineWorker=function(){try{this.isAvailable&&this.connectionDelegate.reconnect()}catch(e){this.logger.warn("`window.addEventListener.ononline` or `navigator.onLine` not found.")}},e.prototype.offlineWorker=function(){try{this.isAvailable&&this.connectionDelegate.disconnect()}catch(e){this.logger.warn("`window.addEventListener.ononline` or `navigator.onLine` not found.")}},e.prototype.start=function(){try{this.isAvailable&&(window.addEventListener("online",this.onlineWorker),window.addEventListener("offline",this.offlineWorker))}catch(e){this.logger.warn("`window.addEventListener.ononline` or `navigator.onLine` not found.")}},e.prototype.stop=function(){try{this.isAvailable&&(window.removeEventListener("online",this.onlineWorker,!1),window.removeEventListener("offline",this.offlineWorker,!1))}catch(e){this.logger.warn("`window.addEventListener.ononline` or `navigator.onLine` not found.")}},e.prototype.isOnline=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return this.isAvailable?[2,navigator.onLine]:[2,new Promise((function(e,t){fetch("https://www.google.com",{method:f.GET}).then((function(){return e(!0)})).catch((function(){return e(!1)}))}))]}))}))},e}(),Ue=function(t){function n(e){var n=e.userId,r=e.nickname,i=void 0===r?null:r,o=e.profileUrl,s=void 0===o?null:o,a=e.profileImage,u=void 0===a?null:a,c=e.preferredLanguages,l=void 0===c?null:c,h=t.call(this)||this;return h.method=f.PUT,h.path="".concat(p,"/").concat(encodeURIComponent(n)),h.params=v({nickname:i,profile_url:s,profile_file:u,preferred_languages:l}),h}return e(n,t),n}(_),Me=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.user=null,r.user=new m(e,y({},n)),r}return e(n,t),n}(g),qe=function(t){function n(e){var n=e.userId,r=e.token,i=t.call(this)||this;return i.method=f.POST,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/apns"),i.params={apns_device_token:r,always_push:!0},i}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.type=n.type?pe[n.type.toLowerCase()]:pe.UNKNOWN,r.user=new m(e,n.user),r}e(n,t)}(g);var Fe=function(t){function n(e){var n=e.userId,r=e.token,i=t.call(this)||this;return i.method=f.POST,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/gcm"),i.params={gcm_reg_token:r,always_push:!0},i}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.type=n.type?pe[n.type.toLowerCase()]:pe.UNKNOWN,r.user=new m(e,n.user),r}e(n,t)}(g);var Be=function(t){function n(e){var n=e.userId,r=e.token,i=t.call(this)||this;return i.method=f.DELETE,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/apns/").concat(encodeURIComponent(r)),i}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.user=new m(e,n.user),r}e(n,t)}(g);var Ke=function(t){function n(e){var n=e.userId,r=e.token,i=t.call(this)||this;return i.method=f.DELETE,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/gcm/").concat(encodeURIComponent(r)),i}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.token=n.token,r.user=new m(e,n.user),r}e(n,t)}(g);var je=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.DELETE,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/apns"),r}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.type=n.type?pe[n.type.toLowerCase()]:pe.UNKNOWN,r.user=new m(e,n.user),r}e(n,t)}(g);var He=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.DELETE,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/gcm"),r}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.type=n.type?pe[n.type.toLowerCase()]:pe.UNKNOWN,r.user=new m(e,n.user),r}e(n,t)}(g);var Ve=function(t){function n(e){var n=e.userId,r=e.type,i=e.token,o=e.ts,s=t.call(this)||this;return s.method=f.GET,s.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/").concat(encodeURIComponent(r),"/device_tokens"),s.params={created_ts:o,token:i},s}return e(n,t),n}(_),Ge=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTokens={type:n.type?pe[n.type.toLowerCase()]:pe.UNKNOWN,deviceTokens:n.device_tokens,hasMore:n.has_more,token:n.token},r}return e(n,t),n}(g),ze=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),r}return e(n,t),n}(_),Qe=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.autoAccept=n.auto_accept,r}return e(n,t),n}(g),We=function(t){function n(e){var n=e.userId,r=e.willAutoAccept,i=t.call(this)||this;return i.method=f.PUT,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),i.params={auto_accept:r},i}return e(n,t),n}(_),Ye=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.autoAccept=n.auto_accept,r}return e(n,t),n}(g),Xe=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/push_preference"),r}return e(n,t),n}(_),Je=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return e(n,t),n}(g),Ze=function(t){function n(e){var n=e.userId,r=e.doNotDisturbOn,i=e.startHour,o=e.startMin,s=e.endHour,a=e.endMin,u=e.timezone,c=t.call(this)||this;return c.method=f.PUT,c.path="".concat(p,"/").concat(encodeURIComponent(n),"/push_preference"),c.params={do_not_disturb:r,start_hour:i,start_min:o,end_hour:s,end_min:a,timezone:u},c}return e(n,t),n}(_),$e=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return e(n,t),n}(g),et=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/push_preference"),r}return e(n,t),n}(_),tt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return e(n,t),n}(g),nt=function(t){function n(e){var n=e.userId,r=e.snoozeOn,i=e.startTs,o=e.endTs,s=t.call(this)||this;return s.method=f.PUT,s.path="".concat(p,"/").concat(encodeURIComponent(n),"/push_preference"),s.params={snooze_enabled:r,snooze_start_ts:i,snooze_end_ts:o},s}return e(n,t),n}(_),rt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return e(n,t),n}(g),it=function(t){function n(e){var n=e.userId,r=e.blockedUserId,i=t.call(this)||this;return i.method=f.POST,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/block"),i.params={target_id:r},i}return e(n,t),n}(_);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.user=new m(e,n),r}e(n,t)}(g);var ot=function(t){function n(e){var n=e.userId,r=e.unblockedUserId,i=t.call(this)||this;return i.method=f.DELETE,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/block/").concat(encodeURIComponent(r)),i}return e(n,t),n}(_);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(g);var st=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/template"),r}return e(n,t),n}(_),at=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.name=n.name,r}return e(n,t),n}(g),ut=function(t){function n(e){var n=e.userId,r=e.templateName,i=t.call(this)||this;return i.method=f.PUT,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/push/template"),i.params={name:r},i}return e(n,t),n}(_),ct=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.name=n.name,r}return e(n,t),n}(g),lt=function(t){function n(e){var n=e.userId,r=e.token,i=t.call(this)||this;return i.method=f.GET,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/friends/changelogs"),i.params={token:r},i}return e(n,t),n}(_),ht=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.changelogs={addedUsers:n.added.map((function(t){return new m(e,t)})),updatedUsers:n.updated.map((function(t){return new m(e,t)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return e(n,t),n}(g),dt=function(t){function n(e){var n=e.userId,r=e.discoveries,i=t.call(this)||this;return i.method=f.PUT,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discoveries:r.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},i}return e(n,t),n}(_),ft=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return e(n,t),n}(g),pt=function(t){function n(e){var n=e.userId,r=e.discoveryKeys,i=t.call(this)||this;return i.method=f.DELETE,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discovery_keys:r},i}return e(n,t),n}(_);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(g);var vt=function(t){function n(e){var n=e.userId,r=e.userIds,i=t.call(this)||this;return i.method=f.POST,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return e(n,t),n}(_),_t=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new m(e,t)})),r}return e(n,t),n}(g),mt=function(t){function n(e){var n=e.userId,r=e.userIds,i=t.call(this)||this;return i.method=f.DELETE,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return e(n,t),n}(_);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(g);var yt=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(p,"/").concat(n,"/allow_friend_discovery"),r.params={},r}return e(n,t),n}(_),bt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return e(n,t),n}(g),gt=function(t){function n(e){var n=e.userId,r=e.allowFriendDiscovery,i=t.call(this)||this;return i.method=f.PUT,i.path="".concat(p,"/").concat(n,"/allow_friend_discovery"),i.params={allow_friend_discovery:r},i}return e(n,t),n}(_);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(g);var Et,It=function(t){function n(e){var n=e.userId,r=e.filter,i=t.call(this)||this,o=r.keys;return i.method=f.GET,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/unread_item_count"),i.params={item_keys:o},i}return e(n,t),n}(_),wt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return"number"==typeof n[ne.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(r.groupChannelUnreadMentionCount=n[ne.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[ne.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(r.groupChannelUnreadMessageCount=n[ne.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[ne.GROUP_CHANNEL_INVITATION_COUNT]&&(r.groupChannelInvitationCount=n[ne.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[ne.SUPER_UNREAD_MENTION_COUNT]&&(r.superGroupChannelUnreadMentionCount=n[ne.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[ne.SUPER_UNREAD_MESSAGE_COUNT]&&(r.superGroupChannelUnreadMessageCount=n[ne.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[ne.SUPER_INVITATION_COUNT]&&(r.superGroupChannelInvitationCount=n[ne.SUPER_INVITATION_COUNT]),"number"==typeof n[ne.NONSUPER_UNREAD_MENTION_COUNT]&&(r.nonSuperGroupChannelUnreadMentionCount=n[ne.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[ne.NONSUPER_UNREAD_MESSAGE_COUNT]&&(r.nonSuperGroupChannelUnreadMessageCount=n[ne.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[ne.NONSUPER_INVITATION_COUNT]&&(r.nonSuperGroupChannelInvitationCount=n[ne.NONSUPER_INVITATION_COUNT]),r}return e(n,t),n}(g),kt=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(p,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return e(n,t),n}(_),Nt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.unreadCount=n.unread_count,r}return e(n,t),n}(g),Ot=function(t){function n(e){var n=e.userId,r=e.filter,i=t.call(this)||this,o=r.channelCustomTypesFilter,s=r.superChannelFilter;return i.method=f.GET,i.path="".concat(p,"/").concat(encodeURIComponent(n),"/unread_message_count"),i.params={super_mode:null!=s?s:re.ALL,custom_types:o},i}return e(n,t),n}(_),Tt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.unreadCount=n.unread_count,r}return e(n,t),n}(g),St=function(e){this.key=null,this.url=null,this.key=e.key,this.url=e.url},Ct=function(e){var t,n,r;this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(t=e.id)&&void 0!==t?t:0,this.name=null!==(n=e.name)&&void 0!==n?n:"",this.url=null!==(r=e.url)&&void 0!==r?r:"",this.emojis=e.emojis?e.emojis.map((function(e){return new St(e)})):[]},xt=function(e){this.emojiHash=null,this.emojiCategories=[],this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new Ct(e)})):[]},Rt=function(t){function n(){var e=t.call(this)||this;return e.method=f.GET,e.path=I,e}return e(n,t),n}(_),Lt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.emojiContainer=new xt(n),r}return e(n,t),n}(g),At=function(t){function n(e){var n=e.categoryId,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(I,"/").concat(n),r}return e(n,t),n}(_),Pt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.emojiCategory=new Ct(n),r}return e(n,t),n}(g),Dt=function(t){function n(e){var n=e.key,r=t.call(this)||this;return r.method=f.GET,r.path="".concat(w,"/").concat(n),r}return e(n,t),n}(_),Ut=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.emoji=new St(n),r}return e(n,t),n}(g),Mt=function(t){function n(e){var n=e.limit,r=e.token,i=e.userIdsFilter,o=e.metaDataKeyFilter,s=e.metaDataValuesFilter,a=e.nicknameStartsWithFilter,u=t.call(this)||this;return u.method=f.GET,u.path=p,u.params=v({limit:n,token:r,user_ids:i,metadatakey:o,metadatavalues_in:s,nickname_startswith:a}),u}return e(n,t),n}(_),qt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new m(e,t)})),r.next=n.next,r}return e(n,t),n}(g),Ft=function(t){function i(e,n){var r,i,o,s=this;return(s=t.call(this,e,n)||this).userIdsFilter=null,s.metaDataKeyFilter=null,s.metaDataValuesFilter=null,s.nicknameStartsWithFilter=null,s.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,s.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,s.metaDataValuesFilter=null!==(o=n.metaDataValuesFilter)&&void 0!==o?o:null,s.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,s}return e(i,t),i.prototype._validate=function(){return t.prototype._validate.call(this)&&r("string",this.userIdsFilter,!0)&&n("string",this.metaDataKeyFilter,!0)&&r("string",this.metaDataValuesFilter,!0)&&n("string",this.metaDataKeyFilter,!0)},i.prototype.next=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=A.of(this._iid).requestQueue,t=new Mt(y(y({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=s.sent(),r=n.as(qt),i=r.users,o=r.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw T.queryInProgress;case 4:return[3,6];case 5:throw T.invalidParameters;case 6:return[2]}}))}))},i}(N),Bt=function(t){function n(e){var n=e.userId,r=e.limit,i=e.token,o=e.userIdsFilter,s=t.call(this)||this;return s.method=f.GET,s.path="".concat(p,"/").concat(n,"/block"),s.params=v({limit:r,token:i,user_ids:o}),s}return e(n,t),n}(_),Kt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.users=n.users.map((function(t){return new m(e,t)})),r.next=n.next,r}return e(n,t),n}(g),jt=function(t){function n(e,n){var r,i=this;return(i=t.call(this,e,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&r("string",this.userIdsFilter,!0)},n.prototype.next=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Bt(y(y({},this),{userId:t.userId,token:this._token})),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),o=i.as(Kt),s=o.users,a=o.next,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw T.queryInProgress;case 4:return[3,6];case 5:throw T.invalidParameters;case 6:return[2]}}))}))},n}(N),Ht=function(t){function n(e){var n=e.userId,r=e.limit,i=e.token,o=t.call(this)||this;return o.method=f.GET,o.path="".concat(p,"/").concat(encodeURIComponent(n),"/friends"),o.params={limit:r,token:i},o}return e(n,t),n}(_),Vt=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(t){return new m(e,t)})),r.next=n.next,r}return e(n,t),n}(g),Gt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)},n.prototype.next=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ht(y(y({},this),{userId:t.userId,token:this._token})),[4,n.send(r)]):[3,2]:[3,5];case 1:return i=c.sent(),o=i.as(Vt),s=o.users,a=o.hasMore,u=o.next,this._token=u,this._hasNext=a,this._isLoading=!1,[2,s];case 2:return[2,[]];case 3:throw T.queryInProgress;case 4:return[3,6];case 5:throw T.invalidParameters;case 6:return[2]}}))}))},n}(N),zt={},Qt=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,o=void 0===i?256:i,s=e.blockHashBase,a=void 0===s?2:s,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,h=void 0===l?11:l,d=e.transactionApplyDelay,f=void 0===d?200:d,p=e.disableLogger,v=void 0!==p&&p;return zt[t]||(this.itemSizeLimit=r,this.cacheLimit=o,this.blockHashBase=a,this.blockHashMultiplier=c,this.blockHashConstant=h,this.transactionApplyDelay=f,this.disableLogger=v,zt[t]=this),zt[t]}return e.get=function(e){return zt[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(Et||(Et={}));var Wt,Yt=function(t){function n(e){var n=e.code,r=void 0===n?Et.UNKNOWN_ERROR:n,i=e.message,o=void 0===i?"Unknown error occurred.":i,s=t.call(this,o)||this;return s.code=r,s}return e(n,t),Object.defineProperty(n,"storeNotDefined",{get:function(){return new n({code:Et.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailable",{get:function(){return new n({code:Et.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailableInPrivateBrowsing",{get:function(){return new n({code:Et.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeIsFull",{get:function(){return new n({code:Et.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeKeyTypeIsInvalid",{get:function(){return new n({code:Et.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenIntegrity",{get:function(){return new n({code:Et.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenBlob",{get:function(){return new n({code:Et.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeItemSizeExceeded",{get:function(){return new n({code:Et.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeReadFailed",{get:function(){return new n({code:Et.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeWriteFailed",{get:function(){return new n({code:Et.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseSchemaNotOnUpgrade",{get:function(){return new n({code:Et.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionNotReady",{get:function(){return new n({code:Et.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotMatch",{get:function(){return new n({code:Et.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionQueryNotValid",{get:function(){return new n({code:Et.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionInsertDuplicate",{get:function(){return new n({code:Et.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotFound",{get:function(){return new n({code:Et.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotGiven",{get:function(){return new n({code:Et.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionWriteFailed",{get:function(){return new n({code:Et.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionItemSizeExceeded",{get:function(){return new n({code:Et.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTableIsRequired",{get:function(){return new n({code:Et.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTypesNotMatch",{get:function(){return new n({code:Et.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"compareTypesNotMatch",{get:function(){return new n({code:Et.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"circularReferenceFound",{get:function(){return new n({code:Et.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),n}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(Wt||(Wt={}));var Xt,Jt=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw Yt.circularReferenceFound;t.set(e,!0);var n=null;if(Array.isArray(e))n=e.map((function(e){return Jt(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=Jt(e[r],t);return t.delete(e),n}return e},Zt=function(e,t){if(null==t)return 1;if(null==e)return-1;if(typeof e!=typeof t)throw Yt.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t)}return n},$t=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},en=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},tn=function(e,t){if(!t)return!1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return!tn(e,t)})))return!1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return!tn(e,t)})))return!1}else if("/where"===n){if(!(0,e[n])(t))return!1}else{var r=n;if("object"==typeof e[r]){var i=e[r];for(var o in i)switch(o){case"/eq":case"=":if((s=t[r])!==(a=i[o]))return!1;break;case"/neq":case"!=":if((s=t[r])===(a=i[o]))return!1;break;case"/gt":case">":var s=t[r],a=i[o];if(!(Zt(s,a)>0))return!1;break;case"/gte":case">=":s=t[r],a=i[o];if(!(Zt(s,a)>=0))return!1;break;case"/lt":case"<":s=t[r],a=i[o];if(!(Zt(s,a)<0))return!1;break;case"/lte":case"<=":s=t[r],a=i[o];if(!(Zt(s,a)<=0))return!1;break;case"/in":s=t[r];if(!(a=i[o]).includes(s))return!1;break;case"/nin":s=t[r];if((a=i[o]).includes(s))return!1;break;case"/contain":s=t[r],a=i[o];if(!s.includes(a))return!1;break;case"/regex":s=t[r];if(!(a=i[o]).test(s))return!1;break;case"/where":s=t[r];if(!(0,i[o])(s))return!1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return!1}else if(e[r]!==t[r])return!1}}return!0}return e(t)},nn=function(){},rn=function(){return Promise.resolve()},on=function(e){return e},sn=function(e,t){t(null)};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(Xt||(Xt={}));var an,un,cn,ln=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,o=e.iterator,s=e.map,a=void 0===s?on:s,u=e.backward,c=void 0===u?rn:u,l=e.forward,h=void 0===l?rn:l,d=e.complete,f=void 0===d?nn:d;this._prevValue=n,this._nextValue=i,this._error=null,this._map=a,this._backward=c,this._forward=h,this._iterator=o,this._complete=f}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return l(this,void 0,void 0,(function(){var e,t,n;return h(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.next=function(){return l(this,void 0,void 0,(function(){var e,t,n;return h(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return[3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,r.sent()];case 6:this._complete(),r.label=7;case 7:return[2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},e}(),hn=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,o=e.blockManager,s=e.indexer;this.condition=n,this.backward=i,this._blockManager=o,this._indexer=s}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var o=this._indexer.fields[i],s=1;if("-"===o[0]&&(o=o.slice(1),s=-1),this.condition[o])if("object"==typeof this.condition[o]){var a=s>0?n:t;for(var u in this.condition[o])if(a.includes(u))for(var c=r;c>=0;c--)if(s*Zt(this._indexer.origin[c].columnValues[i],this.condition[o][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(s*Zt(this._indexer.origin[c].columnValues[i],this.condition[o])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var h=function(r){var i=d._indexer.fields[r],o=1;if("-"===i[0]&&(i=i.slice(1),o=-1),d.condition[i])if("object"==typeof d.condition[i])Object.keys(d.condition[i]).forEach((function(s){if((o>0?t:n).includes(s))for(var a=l;a<e._indexer.origin.length;a++)if(o*Zt(e._indexer.origin[a].columnValues[r],e.condition[i][s])>=0){l=a;break}}));else for(var s=l;s<d._indexer.origin.length;s++)if(o*Zt(d._indexer.origin[s].columnValues[r],d.condition[i])>=0){l=s;break}},d=this,i=0;i<this._indexer.fields.length;i++)h(i);return Math.max(l-1,0)},e.prototype.each=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u=this;return h(this,(function(c){switch(c.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[++n]){if(!u._indexer.origin[++t])return!1;n=0}return!0}return!1},i=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[--n]){if(!u._indexer.origin[--t])return!1;n=u._indexer.origin[t].keys.length-1}return!0}return!1},o=null,!this._indexer.origin[t])return[3,4];s=this.backward?i:r,c.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if(a=c.sent(),tn(this.condition,a))return o=a,[3,4];c.label=3;case 3:if(s())return[3,1];c.label=4;case 4:return[4,new Promise((function(s){var a=new ln({initialNextValue:Jt(o),iterator:e,forward:function(){return l(u,void 0,void 0,(function(){var e,o;return h(this,(function(s){switch(s.label){case 0:e=this.backward?i:r,s.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return o=s.sent(),tn(this.condition,o)?[2,Jt(o)]:[3,1];case 3:return[2,null]}}))}))},backward:function(){return l(u,void 0,void 0,(function(){var e,o;return h(this,(function(s){switch(s.label){case 0:e=this.backward?r:i,s.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return o=s.sent(),tn(this.condition,o)?[2,Jt(o)]:[3,1];case 3:return[2,null]}}))}))},complete:s});e(a)}))];case 5:return[2,c.sent()]}}))}))},e}(),dn=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,o=e.mutex,s=e.blockManager,a=e.indexer;this._mutex=o,this._iterator=new hn({condition:n,backward:i,blockManager:s,indexer:a})}return e.prototype.fetch=function(e){return void 0===e&&(e={}),l(this,void 0,void 0,(function(){var t,n,r,i,o=this;return h(this,(function(s){switch(s.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return[2,[]];if(n<0)throw Yt.collectionQueryNotValid;s.label=1;case 1:return s.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return s.sent(),[4,this._iterator.each((function(e){return l(o,void 0,void 0,(function(){return h(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return s.sent(),this._mutex.unlock(),[2,r];case 4:throw i=s.sent(),this._mutex.unlock(),i;case 5:return[2]}}))}))},e.prototype.count=function(){return l(this,void 0,void 0,(function(){var e,t,n=this;return h(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return l(n,void 0,void 0,(function(){return h(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return[2]}}))}))},e}(),fn=function(e){return"".concat("nest","@").concat(e)},pn=function(e,t){return"".concat(fn(e),"/").concat(t)},vn=function(e,t){return"".concat(pn(e,t),".metadata")},_n=function(e,t){return"".concat(pn(e,t),"/block.")},mn=function(e,t){return"".concat(pn(e,t),"/blob.")},yn=function(e,t,n,r){return void 0===r&&(r=0),"".concat(mn(e,t)).concat(n,".").concat(r)},bn=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this._store=r}return e.prototype._makeShards=function(e,t){var n=Math.max(this._store.itemSizeLimit-1024,0);if(n>0){for(var r=Math.ceil(e.data.length/n),i="".concat(r,".").concat(e.type,".").concat(t),o=[],s=0;s<e.data.length;s+=n){var a=e.data.slice(s,s+n);o.push(a)}return{blobId:i,shards:o}}return{blobId:null,shards:null}},e.prototype._encode=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){var n=new FileReader;n.onload=function(){t({data:n.result,type:e.type})},n.readAsDataURL(e)}))];case 1:return[2,t.sent()]}}))}))},e.prototype._decode=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return"undefined"==typeof fetch?[3,3]:[4,fetch(e.data)];case 1:return[4,a.sent().blob()];case 2:return[2,a.sent()];case 3:for(512,t=[],n=atob(e.data.split(",")[1]),r=0;r<n.length;r+=512){for(i=n.slice(r,r+512),o=new Array(i.length),s=0;s<i.length;s++)o[s]=i.charCodeAt(s);t.push(new Uint8Array(o))}return[2,new Blob(t,{type:e.type})]}}))}))},e.prototype.get=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:if(t=[],n=D(e.split("."),2),r=n[0],i=n[1],!((o=parseInt(r))>0))return[3,6];s=0,c.label=1;case 1:return s<o?(a=yn(this.dbname,this.collectionName,e,s),[4,this._store.get(a)]):[3,4];case 2:if(!(u=c.sent())||!u.d)throw Yt.storeBrokenBlob;t.push(u.d),c.label=3;case 3:return s++,[3,1];case 4:return[4,this._decode({data:t.join(""),type:i})];case 5:return[2,c.sent()];case 6:return[2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),l(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:return n=[],[4,this._encode(e)];case 1:if(r=c.sent(),i=this._makeShards(r,t),o=i.blobId,s=i.shards,!o)return[3,3];for(a=0;a<s.length;a++)u=yn(this.dbname,this.collectionName,o,a),n.push({key:u,value:{d:s[a]},generation:1});return[4,this._store.setMany(n)];case 2:if(c.sent().some((function(e){return e instanceof Error})))throw Yt.storeWriteFailed;return[2,o];case 3:return[2,null]}}))}))},e.prototype.remove=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:if(t=[],n=D(e.split("."),1),r=n[0],!((i=parseInt(r))>0))return[3,2];for(o=0;o<i;o++)t.push(yn(this.dbname,this.collectionName,e,o));return[4,this._store.removeMany(t)];case 1:s.sent(),s.label=2;case 2:return[2]}}))}))},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:return e=mn(this.dbname,this.collectionName),t=[],[4,this._store.getAllKeys()];case 1:n=u.sent();try{for(r=K(n),i=r.next();!i.done;i=r.next())(o=i.value).startsWith(e)&&t.push(o)}catch(e){s={error:e}}finally{try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(s)throw s.error}}return[4,this._store.removeMany(n)];case 2:return u.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(an||(an={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(un||(un={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(cn||(cn={}));var gn=[un.PENDING,un.VOLATILE],En={},In=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return En[t]||(this.dbname=t,this._items=[],this._limit=r,En[t]=this),En[t]}return e.get=function(e){return En[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=cn.DEFAULT),l(this,void 0,void 0,(function(){var r,i;return h(this,(function(o){switch(o.label){case 0:return(r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return(i=o.sent())&&(r={key:t,value:i,generation:1,state:n===cn.PERSISTENT?un.PERSISTENT:un.VOLATILE},this.put(r)),[3,3];case 2:n===cn.PERSISTENT&&(r.state=un.PERSISTENT),o.label=3;case 3:return[2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=cn.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===cn.PERSISTENT&&(r.state=un.PERSISTENT),t!==cn.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)gn.includes(this._items[r].state)&&gn.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].generation=e.generation,this._items[r].value=e.value);else{this._items.push(e);var i=this._items.filter((function(e){return e.state===un.VOLATILE})),o=i.length-this._limit;if(o>0){var s=[];try{for(var a=K(this._items),u=a.next();!u.done;u=a.next()){var c=u.value;c.state===un.VOLATILE&&o>0?o--:s.push(c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this._items=s}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return!e(t)}))},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==un.VOLATILE}))},e}(),wn=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return"".concat(pn(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return"".concat(pn(e,t),"/trans.recordset")}(t,n),this._store=r}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(t=n.sent()||[]).push.apply(t,j([],D(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],o=[],s=i.requests.length-1;s>=0;s--){var a=i.requests[s],u=a.data;n[u.key]||(o.unshift(a),n[u.key]=!0)}o.length>0&&(i.requests=o,t.unshift(i))}return t},e.prototype._applyRecord=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,l;return h(this,(function(h){switch(h.label){case 0:n=In.get(this.dbname),r=t.generation,i=t.requests,o=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i.map((function(e){return y(y({},e.data),{generation:r})})))];case 2:for(s=h.sent(),a=0;a<i.length;a++)s[a]instanceof Error&&(o||(o=s[a]),u=i[a].data,n.put(y(y({},u),{generation:r,state:un.PERSISTENT})));return[3,4];case 3:return c=h.sent(),o=c,[3,4];case 4:return o?[3,6]:(l=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:l,generation:r})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),[3,7];case 6:this._onError.forEach((function(e){return e(o)})),h.label=7;case 7:return[2]}}))}))},e.prototype.init=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=K(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return o=u.sent(),s={error:o},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}return[7];case 10:return[2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case an.COMMIT:this._onCommit.set(t,n);break;case an.WRITE:this._onWrite.set(t,n);break;case an.ERROR:this._onError.set(t,n)}},e.prototype.requestWrite=function(e,t){void 0===t&&(t=null),this._requests.push({data:e,options:t}),In.get(this.dbname).put(y({state:un.PENDING,generation:this.generation},e))},e.prototype.requestMultipleWrite=function(e,t){var n,r;void 0===t&&(t=null);var i=In.get(this.dbname);try{for(var o=K(e),s=o.next();!s.done;s=o.next()){var a=s.value;this._requests.push({data:a,options:t}),i.put(y({state:un.PENDING,generation:this.generation},a))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return In.get(this.dbname).clearByCondition((function(e){return e.state===un.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a,u,c,l,d,f=this;return h(this,(function(h){switch(h.label){case 0:if(!((e=this._requests).length>0))return[3,4];for(t=[],n={},a=e.length-1;a>=0;a--)r=e[a],c=r.data,n[c.key]||(n[c.key]=!0,t.unshift(r));return i={generation:this.generation,requests:t},[4,this._getReducedRecordset([i])];case 1:return o=h.sent(),[4,this._store.set({key:this.recordsetKey,value:o,generation:this.generation})];case 2:return h.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata,generation:1})];case 3:for(h.sent(),s=In.get(this.dbname),a=0;a<t.length;a++)u=t[a],c=u.data,l=u.options,s.put(y(y({},c),{generation:i.generation,state:l&&l.persistent?un.PERSISTENT:un.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})))})),d=Qt.get(this.dbname),setTimeout((function(){try{f._applyRecord(o,i)}catch(e){f._onError.forEach((function(t){return t(e)}))}}),d.transactionApplyDelay),h.label=4;case 4:return[2]}}))}))},e}(),kn=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,o=e.limit;this.blockId=t,this.keyName=n,this.limit=o,this._items=j([],D(i),!1)}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1},e.prototype.clear=function(){this._items=[]},e}(),Nn=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,o=void 0===i?$t:i,s=e.transaction,a=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=o,this.metadata=r,this._transaction=s,this._store=a}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,o="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||$t)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(_n(n,r)).concat(i,".").concat(o);var n,r,i,o},e.prototype._findBlock=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:t=In.get(this.dbname),n=this.metadata.blockLevel,s.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=s.sent())&&(o=kn.createFromCacheItem(i),o.getItemByKey(e)))return[2,o];s.label=3;case 3:return n--,[3,1];case 4:return[2,null]}}))}))},e.prototype.getFromBlock=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return[2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return n=Qt.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,In.get(this.dbname).find(this._store,r)];case 1:return o=a.sent(),(s=o?kn.createFromCacheItem(o):new kn({blockId:r,keyName:this.keyName,items:[],limit:i})).add(t)?(this._transaction.requestWrite({key:s.blockId,value:s.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return[4,this._findBlock(e)];case 1:return(t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:return e=_n(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=c.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:c.sent(),r=In.get(this.dbname);try{for(i=K(n),o=i.next();!o.done;o=i.next())s=o.value,r.remove(s)}catch(e){a={error:e}}finally{try{o&&!o.done&&(u=i.return)&&u.call(i)}finally{if(a)throw a.error}}return[2]}}))}))},e}(),On=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,o=e.transaction,s=e.store,a=this;this._origin=[],this._table=[],this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=function(e,t,n){return"".concat(pn(e,t),"/index.").concat(n)}(this.dbname,this.collectionName,this.fields.join(">")),this._transaction=o,this._store=s,this._transaction.on(an.COMMIT,this.indexerKey,(function(){return a.commit()})),this._transaction.on(an.ERROR,this.indexerKey,(function(){return a.abort()}))}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=D(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=D(this.indexOf(n),2),i=r[0];if(r[1]){var o=this._table[i].keys.indexOf(t);if(o>-1)return this._table[i].keys.splice(o,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return!1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,o=[];try{for(var s=K(this.fields),a=s.next();!a.done;a=s.next()){var u=a.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw Yt.indexTypesNotMatch;o.push(e[u])}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Zt(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else{if(!(i<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]},e.prototype.ensure=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a,u,c,l,d,f,p,v,_,m;return h(this,(function(h){switch(h.label){case 0:return[4,(e=In.get(this.dbname)).find(this._store,this.indexerKey,cn.PERSISTENT)];case 1:return(t=h.sent())?[3,11]:(n=_n(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=h.sent(),h.label=3;case 3:h.trys.push([3,8,9,10]),i=K(r),o=i.next(),h.label=4;case 4:return o.done?[3,7]:(s=o.value).startsWith(n)?[4,e.find(this._store,s,cn.NO_CACHE)]:[3,6];case 5:a=h.sent(),u=kn.createFromCacheItem(a);try{for(_=void 0,c=K(u.items),l=c.next();!l.done;l=c.next())d=l.value,this._addItem(d)}catch(e){_={error:e}}finally{try{l&&!l.done&&(m=c.return)&&m.call(c)}finally{if(_)throw _.error}}h.label=6;case 6:return o=i.next(),[3,4];case 7:return[3,10];case 8:return f=h.sent(),p={error:f},[3,10];case 9:try{o&&!o.done&&(v=i.return)&&v.call(i)}finally{if(p)throw p.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=Jt(this._origin),h.label=12;case 12:return[2]}}))}))},e.prototype.drop=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return In.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.addItem=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=Jt(this._origin)},e.prototype.abort=function(){this._table=Jt(this._origin)},e}(),Tn="undefined"!=typeof document&&"undefined"!=typeof navigator;Tn&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var Sn=Tn&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");Tn&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),Tn&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),Tn&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var Cn,xn,Rn=Tn&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),Ln=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Cn||(Cn={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(xn||(xn={}));var An,Pn={},Dn=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=Cn.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],Pn[e]&&!t.forceCreate||(this.nodeId=Ln(),this.key=e,Tn&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t,r,i=e.data,o=i.nodeId,s=i.requestId,a=i.key,u=i.op,c=i.data;if(o!==n.nodeId&&a===n.key)switch(u){case xn.NEWNODE:n._sendSync();break;case xn.CLAIM_HOST:n._sendSync(),n._hostId=o;break;case xn.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var l=c,h=l.currentItemRequestId,d=l.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:xn.REQUEST_LOCK,ts:e.ts})};try{for(var p=K(d),v=p.next();!v.done;v=p.next()){f(v.value)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===h})),n._completeSync()}break;case xn.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=null,n._acquire(n._queue[0]));break;case xn.REQUEST_LOCK:n._requestLock(i);break;case xn.ACQUIRE_LOCK:var _=n._queue.find((function(e){return e.requestId===s}));n._acquire(_);break;case xn.RELEASE_LOCK:n._release(s)}})),window.addEventListener("beforeunload",(function(){n._send(xn.REMOVENODE)}))),Pn[e]=this),Pn[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==Cn.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n,r;if(void 0===t&&(t={}),Tn){var i={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:Ln(),key:this.key,op:e,data:null!==(r=t.data)&&void 0!==r?r:null,ts:Date.now()};return window.postMessage(i,"*"),i}return null},e.prototype._acquire=function(e){void 0===e&&(e=null),e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(xn.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e)}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(xn.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},i=!1;for(var o in t._queue)if(t._queue[o].ts>r.ts){t._queue.splice(parseInt(o),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(xn.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})},e.prototype._waitUntilSyncCompleted=function(){return l(this,void 0,void 0,(function(){var e=this;return h(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t)}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))},e.prototype._completeSync=function(){this.isInSync||(this._state=Cn.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])},e.prototype.registerNode=function(){this._send(xn.NEWNODE),this._waitSync()},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(xn.CLAIM_HOST),this._waitSync()},e.prototype.lock=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(xn.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)},e}(),Un=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,o=e.indexes,s=e.store,a=this;this._state=Wt.INIT,this._metadata=null,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=j([[r]],D(o.filter((function(e){return On.createKey(e)!==a.keyName}))),!1),this._keyHash=i,this._store=s,this._mutex=new Dn(function(e,t){return"".concat(pn(e,t),".lock")}(t,n)),this._blobContainer=new bn({dbname:t,collectionName:n,store:s}),this._transaction=new wn({dbname:t,collectionName:n,store:s})}return e.metadataOf=function(e,t,n){return l(this,void 0,void 0,(function(){var r;return h(this,(function(i){switch(i.label){case 0:return r=vn(e,t),[4,n.get(r)];case 1:return[2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.init=function(){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u,c,l,d,f,p,v,_=this;return h(this,(function(h){switch(h.label){case 0:return[4,this._mutex.lock()];case 1:h.sent(),h.label=2;case 2:return h.trys.push([2,9,,10]),t=Qt.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=h.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:h.sent(),this._blockManager=new Nn({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=j([],D(this.indexes),!1),i=[],o=r.map((function(e){return On.createKey(e)})),s=n?n.indexes.map((function(e){return On.createKey(e)})):[];try{for(a=K(s),u=a.next();!u.done;u=a.next())c=u.value,o.includes(c)||i.push(On.parseKey(c))}catch(e){p={error:e}}finally{try{u&&!u.done&&(v=a.return)&&v.call(a)}finally{if(p)throw p.error}}return(l=[]).push.apply(l,j([],D(r.map((function(e){var t=new On({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store});return _._indexers.push(t),t.ensure()}))),!1)),l.push.apply(l,j([],D(i.map((function(e){return new On({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store}).drop()}))),!1)),[4,Promise.all(l)];case 5:return h.sent(),[4,this._transaction.commit()];case 6:return h.sent(),o.sort().join(",")===s.sort().join(",")?[3,8]:(d=vn(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata,generation:1})]);case 7:h.sent(),h.label=8;case 8:return this._state=Wt.READY,this._mutex.unlock(),[3,10];case 9:throw f=h.sent(),this._mutex.unlock(),f;case 10:return[2]}}))}))},e.prototype.close=function(){this._state=Wt.CLOSED},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return"string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=On.createKey(e);try{for(var i=K(this._indexers),o=i.next();!o.done;o=i.next()){var s=o.value;if(r===On.createKey(s.fields))return s}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},e.prototype._upgradeBlockLevel=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return e=vn(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata,generation:1})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return a.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return a.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return a.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:a.sent(),a.label=5;case 5:a.trys.push([5,10,11,12]),n=K(this._indexers),r=n.next(),a.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:a.sent(),a.label=8;case 8:return r=n.next(),[3,6];case 9:return[3,12];case 10:return i=a.sent(),o={error:i},[3,12];case 11:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 12:return[3,14];case 13:throw Yt.collectionInsertDuplicate;case 14:return[2]}}))}))},e.prototype._requestUpsert=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u,c,l,d,f,p;return h(this,(function(h){switch(h.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=h.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return h.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return h.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:h.sent(),h.label=5;case 5:h.trys.push([5,10,11,12]),r=K(this._indexers),i=r.next(),h.label=6;case 6:return i.done?[3,9]:[4,(u=i.value).addItem(e)];case 7:h.sent(),h.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return o=h.sent(),l={error:o},[3,12];case 11:try{i&&!i.done&&(d=r.return)&&d.call(r)}finally{if(l)throw l.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(t,e)];case 14:h.sent(),h.label=15;case 15:h.trys.push([15,21,22,23]),s=K(this._indexers),a=s.next(),h.label=16;case 16:return a.done?[3,20]:0===(u=a.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return h.sent(),[4,u.addItem(e)];case 18:h.sent(),h.label=19;case 19:return a=s.next(),[3,16];case 20:return[3,23];case 21:return c=h.sent(),f={error:c},[3,23];case 22:try{a&&!a.done&&(p=s.return)&&p.call(s)}finally{if(f)throw f.error}return[7];case 23:return[2]}}))}))},e.prototype._requestUpdate=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return(n=c.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:c.sent(),c.label=3;case 3:c.trys.push([3,9,10,11]),r=K(this._indexers),i=r.next(),c.label=4;case 4:return i.done?[3,8]:0===(o=i.value).diff(o.getColumnValues(n),o.getColumnValues(e))?[3,7]:[4,o.removeItem(n)];case 5:return c.sent(),[4,o.addItem(e)];case 6:c.sent(),c.label=7;case 7:return i=r.next(),[3,4];case 8:return[3,11];case 9:return s=c.sent(),a={error:s},[3,11];case 10:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(a)throw a.error}return[7];case 11:return[2]}}))}))},e.prototype._requestRemove=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return[4,this._blockManager.getFromBlock(e)];case 1:return(t=a.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:a.sent(),a.label=3;case 3:a.trys.push([3,8,9,10]),n=K(this._indexers),r=n.next(),a.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:a.sent(),a.label=6;case 6:return r=n.next(),[3,4];case 7:return[3,10];case 8:return i=a.sent(),o={error:i},[3,10];case 9:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 10:return[2]}}))}))},e.prototype._requestClear=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:o.sent(),o.label=2;case 2:o.trys.push([2,7,8,9]),e=K(this._indexers),t=e.next(),o.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:o.sent(),o.label=5;case 5:return t=e.next(),[3,3];case 6:return[3,9];case 7:return n=o.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(r)throw r.error}return[7];case 9:return[2]}}))}))},e.prototype.getByKey=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return this._state!==Wt.READY?[3,6]:[4,this._mutex.lock()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,Jt(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return[3,7];case 6:throw Yt.collectionNotReady;case 7:return[2]}}))}))},e.prototype.query=function(e){return void 0===e&&(e={}),this._state===Wt.READY?new dn({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null},e.prototype.insertOne=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return this._state!==Wt.READY?[3,8]:[4,this._mutex.lock()];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Yt.collectionKeyNotGiven;return[4,this._requestInsert(Jt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Yt.collectionNotReady;case 9:return[2]}}))}))},e.prototype.insertMany=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u=this;return h(this,(function(c){switch(c.label){case 0:return this._state!==Wt.READY?[3,15]:[4,this._mutex.lock()];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Yt.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=K(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(Jt(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=c.sent(),s={error:i},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return o=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw Yt.collectionNotReady;case 16:return[2]}}))}))},e.prototype.upsertOne=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return this._state!==Wt.READY?[3,8]:[4,this._mutex.lock()];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Yt.collectionKeyNotGiven;return[4,this._requestUpsert(Jt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Yt.collectionNotReady;case 9:return[2]}}))}))},e.prototype.upsertMany=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u=this;return h(this,(function(c){switch(c.label){case 0:return this._state!==Wt.READY?[3,15]:[4,this._mutex.lock()];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return!u._hasPropertyOfKeyName(e)})))throw Yt.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=K(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(Jt(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return[3,10];case 8:return i=c.sent(),s={error:i},[3,10];case 9:try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return o=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),o;case 14:return[3,16];case 15:throw Yt.collectionNotReady;case 16:return[2]}}))}))},e.prototype.update=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return this._state!==Wt.READY?[3,8]:[4,this._mutex.lock()];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw Yt.collectionKeyNotGiven;return[4,this._requestUpdate(Jt(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Yt.collectionNotReady;case 9:return[2]}}))}))},e.prototype.updateIf=function(e,t){return l(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,d=this;return h(this,(function(f){switch(f.label){case 0:return this._state!==Wt.READY?[3,16]:[4,this._mutex.lock()];case 1:f.sent(),f.label=2;case 2:return f.trys.push([2,13,,15]),n=[],[4,new hn({condition:e,blockManager:this._blockManager,indexer:this._getIndexerBy(null)}).each((function(r){return l(d,void 0,void 0,(function(){var i,o;return h(this,(function(s){if(r.error)throw r.stop(),r.error;if(r.hasNext){if(i=r.nextValue,tn(e,i)&&t.set){if("function"!=typeof t.set)for(o in t.set)i[o]=t.set[o];else t.set(i);n.push(i)}r.next()}else r.stop();return[2]}))}))}))];case 3:f.sent(),f.label=4;case 4:f.trys.push([4,9,10,11]),r=K(n),i=r.next(),f.label=5;case 5:return i.done?[3,8]:(o=i.value,[4,this._requestUpdate(Jt(o))]);case 6:f.sent(),f.label=7;case 7:return i=r.next(),[3,5];case 8:return[3,11];case 9:return s=f.sent(),u={error:s},[3,11];case 10:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return f.sent(),this._mutex.unlock(),[2,n];case 13:return a=f.sent(),[4,this._transaction.clear()];case 14:throw f.sent(),this._mutex.unlock(),a;case 15:return[3,17];case 16:throw this._transaction.clear(),Yt.collectionNotReady;case 17:return[2]}}))}))},e.prototype.remove=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return this._state!==Wt.READY?[3,8]:[4,this._mutex.lock()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Yt.collectionNotReady;case 9:return[2]}}))}))},e.prototype.removeIf=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u,c=this;return h(this,(function(d){switch(d.label){case 0:return this._state!==Wt.READY?[3,15]:[4,this._mutex.lock()];case 1:d.sent(),d.label=2;case 2:return d.trys.push([2,13,,14]),t=[],[4,new hn({condition:e,blockManager:this._blockManager,indexer:this._getIndexerBy(null)}).each((function(n){return l(c,void 0,void 0,(function(){var r,i;return h(this,(function(o){if(n.error)throw n.stop(),n.error;return n.hasNext?(r=n.nextValue,tn(e,r)&&(i=r[this.keyName],t.push(i)),n.next()):n.stop(),[2]}))}))}))];case 3:d.sent(),d.label=4;case 4:d.trys.push([4,9,10,11]),n=K(t),r=n.next(),d.label=5;case 5:return r.done?[3,8]:(i=r.value,[4,this._requestRemove(i)]);case 6:d.sent(),d.label=7;case 7:return r=n.next(),[3,5];case 8:return[3,11];case 9:return o=d.sent(),a={error:o},[3,11];case 10:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(a)throw a.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return d.sent(),this._mutex.unlock(),[2,t];case 13:throw s=d.sent(),this._mutex.unlock(),s;case 14:return[3,16];case 15:throw this._transaction.clear(),Yt.collectionNotReady;case 16:return[2]}}))}))},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return this._state!==Wt.READY?[3,8]:[4,this._mutex.lock()];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Yt.collectionNotReady;case 9:return[2]}}))}))},e.prototype.getBlob=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this._blobContainer.save(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),Mn={},qn=function(){function e(e){void 0===e&&(e={});var t=e.itemSizeLimit,n=void 0===t?4194304:t,r=e.delay,i=void 0===r?1:r,o=e.encryption,s=void 0===o?H:o;this._encryption=s,this.itemSizeLimit=n,this.delay=i,this.observer={}}return Object.defineProperty(e.prototype,"rawData",{get:function(){return Mn[this.dbname]},set:function(e){Mn[this.dbname]=e},enumerable:!1,configurable:!0}),e.prototype.observe=function(e,t,n){var r=this;this.observer[e]={},t.forEach((function(t){return r.observer[e][t]=n}))},e.prototype.init=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this.dbname=e,Mn[this.dbname]={},[2]}))}))},e.prototype.getAllKeys=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){return[2,Object.keys(Mn[this.dbname])]}))}))},e.prototype.get=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return[4,en(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.get?t.get(e):null)throw n;return[2,Mn[this.dbname][e]?this._encryption.decrypt(Mn[this.dbname][e]):null]}}))}))},e.prototype.set=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:return[4,en(this.delay)];case 1:if(s.sent(),t=e.key,n=e.value,r=this.observer[t],i=r&&r.set?r.set(t):null)throw i;if(o=this._encryption.encrypt(n),JSON.stringify(o).length<this.itemSizeLimit)return Mn[this.dbname][t]=o,[2,Mn[this.dbname][t]];throw Yt.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return l(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){switch(r.label){case 0:return[4,en(this.delay)];case 1:return r.sent(),t=[],e.forEach((function(e){var r=e.key,i=e.value,o=n.observer[r];if(o&&o.set?o.set(r):null)t.push(Yt.collectionWriteFailed);else{var s=n._encryption.encrypt(i);JSON.stringify(s).length<n.itemSizeLimit?(Mn[n.dbname][r]=s,t.push(i)):t.push(Yt.storeItemSizeExceeded)}})),[2,t]}}))}))},e.prototype.remove=function(e){return l(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return[4,en(this.delay)];case 1:if(r.sent(),t=this.observer[e],n=t&&t.remove?t.remove(e):null)throw n;return Mn[this.dbname][e]&&delete Mn[this.dbname][e],[2,e]}}))}))},e.prototype.removeMany=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:return[4,en(this.delay)];case 1:u.sent();try{for(t=K(e),n=t.next();!n.done;n=t.next()){if(r=n.value,i=this.observer[r],o=i&&i.remove?i.remove(r):null)throw o;Mn[this.dbname][r]&&delete Mn[this.dbname][r]}}catch(e){s={error:e}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(s)throw s.error}}return[2,e]}}))}))},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,en(this.delay)];case 1:return e.sent(),Mn[this.dbname]={},[2]}}))}))},e}(),Fn=function(){function e(e){void 0===e&&(e={}),this.itemSizeLimit=104857600;var t=e.encryption,n=void 0===t?H:t;this._window="undefined"!=typeof window?window:null,this._indexedDB=this._window?this._window.indexedDB||this._window.mozIndexedDB||this._window.webkitIndexedDB||this._window.msIndexedDB:null,this._encryption=n}return e.prototype.init=function(e){return l(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){switch(r.label){case 0:return this.dbname=e,[4,new Promise((function(e,t){if(n._window&&Tn)if(Sn){var r=n._indexedDB.open("_testMozilla");r.onerror=function(){return t(Yt.storeNotAvailableInPrivateBrowsing)},r.onsuccess=function(){return e()}}else Rn?n._window.indexedDB||!n._window.PointerEvent&&!n._window.MSPointerEvent||t(Yt.storeNotAvailableInPrivateBrowsing):e();else t(Yt.storeNotAvailable)}))];case 1:return r.sent(),t=this,[4,new Promise((function(t,r){var i=n._indexedDB.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore("NestDBStore",{keyPath:"key"})})),i.addEventListener("success",(function(e){return t(e.target.result)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 2:return t._database=r.sent(),[2]}}))}))},e.prototype.getAllKeys=function(){return l(this,void 0,void 0,(function(){var e=this;return h(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=e._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").getAllKeys();r.addEventListener("success",(function(e){return t(e.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 1:return[2,t.sent()]}}))}))},e.prototype.get=function(e){return l(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){var i=t._database.transaction("NestDBStore","readonly").objectStore("NestDBStore").get(e);i.addEventListener("success",(function(e){return n(e.target.result?t._encryption.decrypt(e.target.result.value):null)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 1:return[2,n.sent()]}}))}))},e.prototype.set=function(e){return l(this,void 0,void 0,(function(){var t,n,r=this;return h(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,[4,new Promise((function(e,i){var o=r._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").put({key:t,value:r._encryption.encrypt(n)});o.addEventListener("success",(function(t){e(t.target.result)})),o.addEventListener("error",(function(e){return i(e.target.error)}))}))];case 1:return i.sent(),[2,n]}}))}))},e.prototype.setMany=function(e){return l(this,void 0,void 0,(function(){var t,n,r=this;return h(this,(function(i){switch(i.label){case 0:return t=[],n=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),e.forEach((function(e){var i=e.key,o=e.value;t.push(new Promise((function(e){var t=n.put({key:i,value:r._encryption.encrypt(o)});t.addEventListener("success",(function(t){e(t.target.result)})),t.addEventListener("error",(function(){e(Yt.collectionWriteFailed)}))})))})),[4,Promise.all(t)];case 1:return i.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return l(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){var i=t._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))];case 1:return[2,n.sent()]}}))}))},e.prototype.removeMany=function(e){return l(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return t=this._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore"),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}))}))})))];case 1:return[2,n.sent()]}}))}))},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){var e=this;return h(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,n){var r=e._database.transaction("NestDBStore","readwrite").objectStore("NestDBStore").clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}))}))];case 1:return[2,t.sent()]}}))}))},e}(),Bn=function(){function e(e){var t=e.AsyncStorage,n=e.encryption,r=void 0===n?H:n;this.itemSizeLimit=6291456,this._asyncStorage=t,this._encryption=r}return e.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},e.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},e.prototype.init=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return this.dbname=e,[2]}))}))},e.prototype.getAllKeys=function(){return l(this,void 0,void 0,(function(){var e,t=this;return h(this,(function(n){switch(n.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substr("".concat(t.dbname,"/").length)}))]}}))}))},e.prototype.get=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return n=(t=this._encryption).decrypt,i=(r=JSON).parse,[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,n.apply(t,[i.apply(r,[o.sent()])])]}}))}))},e.prototype.set=function(e){return l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:return t=e.key,n=e.value,(r=JSON.stringify(this._encryption.encrypt(n))).length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(t),r)]:[3,2];case 1:return i.sent(),[2,JSON.parse(r)];case 2:throw Yt.storeItemSizeExceeded}}))}))},e.prototype.setMany=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u,c,l;return h(this,(function(h){switch(h.label){case 0:t=[],h.label=1;case 1:h.trys.push([1,10,11,12]),n=K(e),r=n.next(),h.label=2;case 2:if(r.done)return[3,9];i=r.value,h.label=3;case 3:return h.trys.push([3,7,,8]),o=i.key,s=i.value,(a=JSON.stringify(this._encryption.encrypt(s))).length<this.itemSizeLimit?[4,this._asyncStorage.setItem(this._getActualKey(o),a)]:[3,5];case 4:return h.sent(),t.push(s),[3,6];case 5:t.push(Yt.storeItemSizeExceeded),h.label=6;case 6:return[3,8];case 7:return h.sent(),t.push(Yt.collectionWriteFailed),[3,8];case 8:return r=n.next(),[3,2];case 9:return[3,12];case 10:return u=h.sent(),c={error:u},[3,12];case 11:try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 12:return[2,t]}}))}))},e.prototype.remove=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this._asyncStorage.removeItem(this._getActualKey(e))];case 1:return t.sent(),[2,e]}}))}))},e.prototype.removeMany=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,7]),t=K(e),n=t.next(),a.label=1;case 1:return n.done?[3,4]:(r=n.value,[4,this._asyncStorage.removeItem(this._getActualKey(r))]);case 2:a.sent(),a.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return i=a.sent(),o={error:i},[3,7];case 6:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 7:return[2,e]}}))}))},e.prototype.clear=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))},e}(),Kn=!0,jn=function(){function e(){}return e.off=function(){Kn=!1},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Kn&&console.log.apply(console,j(["".concat("[NESTDB]","[LOG]")],D(e),!1))},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Kn&&console.warn.apply(console,j(["".concat("[NESTDB]","[WARNING]")],D(e),!1))},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Kn&&console.error.apply(console,j(["".concat("[NESTDB]","[ERROR]")],D(e),!1))},e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(An||(An={}));var Hn=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=An.INIT,this._config=i||new Qt({dbname:t}),this._store=r,this._event={success:nn,error:nn,upgrade:sn},this._collections=new Map,this._globalMutex=new Dn("".concat(this.name,".lock")),this._config.disableLogger&&jn.off(),new In({dbname:t,limit:this._config.cacheLimit})}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.commitSchema=function(e){return l(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){switch(n.label){case 0:return this._state!==An.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return l(t,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Un({dbname:this.name,collectionName:t,keyName:n,keyHash:e.keyHash||null,indexes:i,store:this._store})),[4,this._collections.get(t).init()];case 1:return o.sent(),[2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw Yt.databaseSchemaNotOnUpgrade;case 3:return[2]}}))}))},e.prototype.open=function(){var e;return l(this,void 0,void 0,(function(){var t,n,r,i,o=this;return h(this,(function(s){switch(s.label){case 0:return[4,this._globalMutex.lock()];case 1:if(s.sent(),this._state===An.OPENED)return[3,12];this._state=An.OPENING,s.label=2;case 2:return s.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return s.sent(),a=this.name,t="".concat(fn(a),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r=null!==(e=s.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var i=function(e){r.version<o._version?o._event.upgrade(r.version,(function(n){return l(o,void 0,void 0,(function(){var i;return h(this,(function(o){switch(o.label){case 0:if(n)return[3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r,generation:this._version})];case 2:return o.sent(),e({continued:!0}),[3,4];case 3:return i=o.sent(),e({continued:!1,err:i}),[3,4];case 4:return[3,6];case 5:e({continued:!1,err:n}),o.label=6;case 6:return[2]}}))}))})):e({continued:!1})},s=function(t){var a=t.continued,u=void 0!==a&&a,c=t.err,d=void 0===c?null:c;if(u)setTimeout((function(){return i(s)}),10);else if(d)jn.error(d.message),o._globalMutex.unlock(),o._event.error(d),n(d);else{var f=[];r.collectionNames.forEach((function(e){o._collections.has(e)||f.push(l(o,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return[4,Un.metadataOf(this.name,e,this._store)];case 1:return(t=r.sent())?(n=new Un({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))})))})),Promise.all(f).then((function(){o._state=An.OPENED,o._globalMutex.unlock(),o._event.success(),e()})).catch((function(e){jn.error(e.message),o._globalMutex.unlock(),o._event.error(e),n(e)}))}};i(s)}))];case 5:switch(i=s.sent(),i.code){case Et.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case Et.STORE_NOT_AVAILABLE:return[3,8]}return[3,10];case 6:return jn.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new qn({}),this._globalMutex.unlock(),this._event.error(i),[4,this.open()];case 7:return s.sent(),[3,11];case 8:return jn.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new qn({}),this._globalMutex.unlock(),this._event.error(i),[4,this.open()];case 9:return s.sent(),[3,11];case 10:throw jn.error(i.message),this._globalMutex.unlock(),this._event.error(i),i;case 11:return[3,12];case 12:return[2]}var a}))}))},e.prototype.close=function(){this._state=An.CLOSED,this._collections.forEach((function(e){return e.close()}))},e.prototype.reset=function(){return l(this,void 0,void 0,(function(){var e,t=this;return h(this,(function(n){switch(n.label){case 0:return(e=In.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(fn(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=sn;else this._event[e]=nn},e.prototype.collection=function(e){return this._collections.get(e)||null},e}(),Vn=null,Gn=function(){function e(e,t,n){var r=this;this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=t;var i=A.of(e),o=i.sdkState,s=i.cacheContext,a=i.connectionManager,u=i.dispatcher,c=i.sessionManager,d=i.requestQueue,f=i.logger,p=i.userEventHandlers;n.forEach((function(t){t.init(e,{sdkState:o,cacheContext:s,dispatcher:u,sessionManager:c,requestQueue:d,logger:f}),r[t.name]=t})),this._onlineDetector=new De({logger:f,connectionDelegate:{reconnect:function(){"foreground"===o.appState&&a.reconnect()},disconnect:function(){return a.disconnect()}}}),u.on((function(t){if(t instanceof X){if("USEV"===t.code){var n=t.as(ve).event;if(n.category===_e.FRIEND_DISCOVERED){var i=me.getDataAsFriendDiscoveredEvent(e,n).friendDiscoveries;J((function(){return l(r,void 0,void 0,(function(){return h(this,(function(e){return[2,p.forEach((function(e){e.onFriendsDiscovered(i)}))]}))}))}))}}}else if(t instanceof Z){var o=A.of(r._iid).subscribedUnreadMessageCount,s=!1,a=t.ts;if("number"==typeof a&&a>o.ts){if(o.all!==t.all&&(s=!0),o.all=t.all>=0?t.all:0,t.customTypes)for(var u in t.customTypes)o.customTypes[u]!==t.customTypes[u]&&(s=!0),o.customTypes[u]=t.customTypes[u];s=s&&o.ts>0,o.ts=a}s&&J((function(){return l(r,void 0,void 0,(function(){return h(this,(function(e){return[2,p.forEach((function(e){e.onTotalUnreadMessageCountUpdated(o.all,o.customTypes)}))]}))}))}))}}))}return e.init=function(t){var n=t.appId,r=t.appVersion,i=void 0===r?null:r,o=t.modules,s=void 0===o?[]:o,a=t.options,u=void 0===a?new $:a,c=t.debugMode,l=void 0!==c&&c,h=t.customApiHost,d=t.customWebSocketHost,f=t.newInstance,p=void 0!==f&&f,v=t.logLevel,_=t.localCacheEnabled,m=void 0!==_&&_,y=t.localCacheEncryption,b=void 0===y?{encrypt:function(e){return e},decrypt:function(e){return e}}:y,g=t.useAsyncStorageStore,E=void 0===g?null:g;if(!Vn||p){var I="su-".concat(ee()),w=b,k=new qn({encryption:w});l||(k=E?new Bn({AsyncStorage:E,encryption:w}):new Fn({encryption:w})),new A(I,{appId:n,appVersion:i,options:u,apiHost:null!=h?h:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(n,".sendbird.com"),store:k,encryption:w,logLevel:v,localCacheEnabled:m,debugMode:l});var N=new e(I,u,j(j([],D(s),!1),[new te],!1));return Vn||(Vn=N),N}},Object.defineProperty(e,"instance",{get:function(){return Vn},enumerable:!1,configurable:!0}),Object.defineProperty(e,"version",{get:function(){return V},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appId",{get:function(){return A.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appVersion",{get:function(){var e;return null!==(e=A.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debugMode",{get:function(){return A.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"logLevel",{get:function(){return A.of(this._iid).logger.level},set:function(e){A.of(this._iid).logger.level=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCacheEnabled",{get:function(){return A.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ekey",{get:function(){return G(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentUser",{get:function(){var e;return null!==(e=A.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionState",{get:function(){var e=A.of(this._iid).connectionManager;return e.isConnected?z.OPEN:e.isConnecting?z.CONNECTING:z.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastConnectedAt",{get:function(){var e=A.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fcmPushToken",{get:function(){return this._fcmPushToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"apnsPushToken",{get:function(){return this._apnsPushToken},enumerable:!1,configurable:!0}),e.prototype.getMemoryStoreForDebugging=function(){var e=A.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof qn?n.store:null;throw T.debugModeRequired},e.prototype.addExtension=function(e,t){var n=A.of(this._iid).sdkState;["sb_uikit","sb_syncmanager"].indexOf(e)>-1&&(n.extensions[e]=t)},e.prototype.initializeCache=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:return t=A.of(this._iid),n=t.sdkState,r=t.cacheContext,i=t.connectionManager,o=t.dispatcher,n.userId&&n.userId===e?[3,3]:[4,i.logout()];case 1:return u.sent(),n.userId=e,r.localCacheEnabled?(s="sendbird@".concat(n.appId,"/").concat(e,".db"),r.nestdb&&r.nestdb.state!==An.CLOSED&&r.nestdb.name===s?[3,3]:((a=r.nestdb=new Hn({name:"sendbird@".concat(n.appId,"/").concat(e,".db"),version:1,store:r.store})).on("upgrade",function(e){return function(t,n){0===t?e.commitSchema([{collectionName:ie,keyName:oe,index:[se(ae.LATEST_LAST_MESSAGE),se(ae.CHRONOLOGICAL),se(ae.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:ue,keyName:ce,index:[le(he.CHANNEL_LATEST)]},{collectionName:de,keyName:fe,index:[le(he.CHANNEL_LATEST)]},{collectionName:"Poll",keyName:"pollId"}]).then((function(){return n()})).catch((function(e){return n(e)})):n()}}(a)),[4,a.open()])):[3,3];case 2:u.sent(),o.dispatch(new ye(this._iid,{userId:e})),u.label=3;case 3:return[2]}}))}))},e.prototype.clearCache=function(){return l(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return(e=A.of(this._iid).cacheContext).localCacheEnabled&&e.nestdb?(e.nestdb.close(),[4,e.nestdb.reset()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.connect=function(e,t){return void 0===t&&(t=null),l(this,void 0,void 0,(function(){var n,r,i,o;return h(this,(function(s){switch(s.label){case 0:n=A.of(this._iid).connectionManager,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.initializeCache(e)];case 2:return s.sent(),[3,4];case 3:return s.sent(),r=A.of(this._iid),i=r.cacheContext,o=r.logger,i.localCacheEnabled=!1,o.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return this._onlineDetector.start(),[4,n.connect(t)];case 5:return s.sent(),[2,this.currentUser]}}))}))},e.prototype.reconnect=function(){var e=A.of(this._iid),t=e.connectionManager,n=e.sessionManager.auth.hasSession;return n&&t.reconnect().catch((function(){})),n},e.prototype.disconnect=function(){return l(this,void 0,void 0,(function(){var e,t,n,r;return h(this,(function(i){switch(i.label){case 0:return e=A.of(this._iid),t=e.connectionManager,n=e.cacheContext,r=e.requestQueue,this._onlineDetector.stop(),r.cancelAll(),[4,t.logout()];case 1:return i.sent(),n.localCacheEnabled?[4,this.clearCache()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},e.prototype.setBackgroundState=function(){var e=A.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background())},e.prototype.setForegroundState=function(){var e=A.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.reconnect())},e.prototype.setSessionHandler=function(e){Q(e instanceof Le).throw(T.invalidParameters),A.of(this._iid).sessionManager.handler=e},e.prototype.addUserEventHandler=function(e,t){Q(n("string",e)&&t instanceof Pe).throw(T.invalidParameters),A.of(this._iid).userEventHandlers.set(e,t)},e.prototype.removeUserEventHandler=function(e){A.of(this._iid).userEventHandlers.delete(e)},e.prototype.removeAllUserEventHandler=function(){A.of(this._iid).userEventHandlers.clear()},e.prototype.addConnectionHandler=function(e,t){Q(n("string",e)&&t instanceof Ae).throw(T.invalidParameters),A.of(this._iid).connectionHandlers.set(e,t)},e.prototype.removeConnectionHandler=function(e){A.of(this._iid).connectionHandlers.delete(e)},e.prototype.removeAllConnectionHandler=function(){A.of(this._iid).connectionHandlers.clear()},e.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new Ft(this._iid,e)},e.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new jt(this._iid,e)},e.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new Gt(this._iid,e)},e.prototype.createMessageSearchQuery=function(e){return new W(this._iid,e)},e.prototype.buildUserFromSerializedData=function(e){var t=Y(e);return new m(this._iid,m.payloadify(t))},e.prototype.updateCurrentUserInfo=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return Q(e instanceof Te&&e.validate()).throw(T.invalidParameters),this.currentUser?(t=A.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Ue(y({userId:n.userId},e)),[4,r.send(i)]):[3,2];case 1:return o=a.sent(),s=o.as(Me).user,this.currentUser&&(e.nickname&&(this.currentUser.nickname=s.nickname),(e.profileUrl||e.profileImage)&&(this.currentUser.plainProfileUrl=s.profileUrl)),[2,s];case 2:throw T.connectionRequired}}))}))},e.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return l(this,void 0,void 0,(function(){var t,n,i,o,s,a;return h(this,(function(u){switch(u.label){case 0:return Q(r("string",e)).throw(T.invalidParameters),this.currentUser?(t=A.of(this._iid),n=t.sdkState,i=t.requestQueue,o=new Ue({userId:n.userId,preferredLanguages:e}),[4,i.send(o)]):[3,2];case 1:return s=u.sent(),a=s.as(Me).user,this.currentUser&&(this.currentUser.preferredLanguages=a.preferredLanguages),[2,a];case 2:throw T.connectionRequired}}))}))},e.prototype.registerFCMPushTokenForCurrentUser=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:if(Q(n("string",e)).throw(T.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new Fe({userId:r.userId,token:e}),[4,i.send(o)];case 2:return s.sent(),this._fcmPushToken="",[2,be.SUCCESS];case 3:return s.sent(),[2,be.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=e,[2,be.PENDING];case 6:return[2]}}))}))},e.prototype.unregisterFCMPushTokenForCurrentUser=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:if(Q(n("string",e)).throw(T.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new Ke({userId:r.userId,token:e}),[4,i.send(o)];case 2:return s.sent(),this._fcmPushToken="",[2,be.SUCCESS];case 3:return s.sent(),[2,be.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=e,[2,be.PENDING];case 6:return[2]}}))}))},e.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return l(this,void 0,void 0,(function(){var e,t,n,r;return h(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new He({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},e.prototype.registerAPNSPushTokenForCurrentUser=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:if(Q(n("string",e)).throw(T.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new qe({userId:r.userId,token:e}),[4,i.send(o)];case 2:return s.sent(),this._fcmPushToken="",[2,be.SUCCESS];case 3:return s.sent(),[2,be.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=e,[2,be.PENDING];case 6:return[2]}}))}))},e.prototype.unregisterAPNSPushTokenForCurrentUser=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:if(Q(n("string",e)).throw(T.invalidParameters),!this.currentUser)return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new Be({userId:r.userId,token:e}),[4,i.send(o)];case 2:return s.sent(),this._fcmPushToken="",[2,be.SUCCESS];case 3:return s.sent(),[2,be.ERROR];case 4:return[3,6];case 5:return this._fcmPushToken=e,[2,be.PENDING];case 6:return[2]}}))}))},e.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return l(this,void 0,void 0,(function(){var e,t,n,r;return h(this,(function(i){switch(i.label){case 0:return this.currentUser?(e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new je({userId:t.userId}),[4,n.send(r)]):[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},e.prototype.getChannelInvitationPreference=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ze({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,{autoAccept:i.as(Qe).autoAccept}]}}))}))},e.prototype.setChannelInvitationPreference=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return Q(n("boolean",e)).throw(T.invalidParameters),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new We({userId:r.userId,willAutoAccept:e}),[4,i.send(o)];case 1:return s=a.sent(),[2,{autoAccept:s.as(Ye).autoAccept}]}}))}))},e.prototype.getDoNotDisturb=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Xe({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(Je).preference]}}))}))},e.prototype.setDoNotDisturb=function(e,t,r,i,o,s){return void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=""),l(this,void 0,void 0,(function(){var a,u,c,l,d;return h(this,(function(h){switch(h.label){case 0:return Q(n("boolean",e)&&n("number",t)&&n("number",r)&&n("number",i)&&n("number",o)&&n("string",s)).throw(T.invalidParameters),a=A.of(this._iid),u=a.sdkState,c=a.requestQueue,l=new Ze({userId:u.userId,doNotDisturbOn:e,startHour:t,startMin:r,endHour:i,endMin:o,timezone:s}),[4,c.send(l)];case 1:return d=h.sent(),[2,d.as($e).preference]}}))}))},e.prototype.getSnoozePeriod=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new et({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(tt).snoozePeriod]}}))}))},e.prototype.setSnoozePeriod=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=0),l(this,void 0,void 0,(function(){var i,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:return Q(n("boolean",e)&&n("number",t)&&n("number",r)).throw(T.invalidParameters),i=A.of(this._iid),o=i.sdkState,s=i.requestQueue,a=new nt({userId:o.userId,snoozeOn:e,startTs:t,endTs:r}),[4,s.send(a)];case 1:return u=c.sent(),[2,u.as(rt).snoozePeriod]}}))}))},e.prototype.getMyPushTokensByToken=function(e,t){return l(this,void 0,void 0,(function(){var r,o,s,a,u;return h(this,(function(c){switch(c.label){case 0:return Q(n("string",e)&&i(pe,t)).throw(T.invalidParameters),r=A.of(this._iid),o=r.sdkState,s=r.requestQueue,a=new Ve({userId:o.userId,type:t,token:e}),[4,s.send(a)];case 1:return u=c.sent(),[2,u.as(Ge).pushTokens]}}))}))},e.prototype.getPushTriggerOption=function(){return l(this,void 0,void 0,(function(){var e,t,n,r;return h(this,(function(i){switch(i.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ee({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(ge).pushTriggerOption]}}))}))},e.prototype.setPushTriggerOption=function(e){return l(this,void 0,void 0,(function(){var t,n,r,o;return h(this,(function(s){switch(s.label){case 0:return Q(i(we,e)).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,r=t.requestQueue,o=new ke({userId:n.userId,pushTriggerOption:e}),[4,r.send(o)];case 1:return[2,s.sent().as(Ie).pushTriggerOption]}}))}))},e.prototype.getPushTemplate=function(){return l(this,void 0,void 0,(function(){var e,t,n,r;return h(this,(function(i){switch(i.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new st({userId:t.userId}),[4,n.send(r)];case 1:return[2,i.sent().as(at).name]}}))}))},e.prototype.setPushTemplate=function(e){return l(this,void 0,void 0,(function(){var t,n,r,o;return h(this,(function(s){switch(s.label){case 0:return Q(i(Ne,e)).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,r=t.requestQueue,o=new ut({userId:n.userId,templateName:e}),[4,r.send(o)];case 1:return[2,s.sent().as(ct).name]}}))}))},e.prototype.blockUser=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:return Q(e instanceof m||n("string",e)).throw(T.invalidParameters),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new it({userId:r.userId,blockedUserId:e instanceof m?e.userId:e}),[4,i.send(o)];case 1:return s.sent(),[2]}}))}))},e.prototype.blockUserWithUserId=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this.blockUser(e)]}))}))},e.prototype.unblockUser=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:return Q(e instanceof m||n("string",e)).throw(T.invalidParameters),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new ot({userId:r.userId,unblockedUserId:e instanceof m?e.userId:e}),[4,i.send(o)];case 1:return s.sent(),[2]}}))}))},e.prototype.unblockUserWithUserId=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this.unblockUser(e)]}))}))},e.prototype.getFriendChangeLogsByToken=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o,s;return h(this,(function(a){switch(a.label){case 0:return Q(n("string",e)).throw(T.invalidParameters),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new lt({userId:r.userId,token:e}),[4,i.send(o)];case 1:return s=a.sent(),[2,s.as(ht).changelogs]}}))}))},e.prototype.getAllowFriendDiscovery=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new yt({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(bt).allowFriendDiscovery]}}))}))},e.prototype.setAllowFriendDiscovery=function(e){return l(this,void 0,void 0,(function(){var t,r,i,o;return h(this,(function(s){switch(s.label){case 0:return Q(n("boolean",e)).throw(T.invalidParameters),t=A.of(this._iid),r=t.sdkState,i=t.requestQueue,o=new gt({userId:r.userId,allowFriendDiscovery:e}),[4,i.send(o)];case 1:return s.sent(),[2,e]}}))}))},e.prototype.uploadFriendDiscoveries=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:return t=A.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new dt({userId:n.userId,discoveries:e}),[4,r.send(i)];case 1:return o=s.sent(),[2,o.as(ft).friendDiscoveryRequestId]}}))}))},e.prototype.deleteFriendDiscovery=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this.deleteFriendDiscoveries([e])]}))}))},e.prototype.deleteFriendDiscoveries=function(e){return l(this,void 0,void 0,(function(){var t,n,i,o;return h(this,(function(s){switch(s.label){case 0:return Q(r("string",e)).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,i=t.requestQueue,o=new pt({userId:n.userId,discoveryKeys:e}),[4,i.send(o)];case 1:return s.sent(),[2]}}))}))},e.prototype.addFriends=function(e){return l(this,void 0,void 0,(function(){var t,n,i,o,s;return h(this,(function(a){switch(a.label){case 0:return Q(r("string",e)).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,i=t.requestQueue,o=new vt({userId:n.userId,userIds:e}),[4,i.send(o)];case 1:return s=a.sent(),[2,s.as(_t).users]}}))}))},e.prototype.deleteFriend=function(e){return l(this,void 0,void 0,(function(){return h(this,(function(t){return[2,this.deleteFriends([e])]}))}))},e.prototype.deleteFriends=function(e){return l(this,void 0,void 0,(function(){var t,n,i,o;return h(this,(function(s){switch(s.label){case 0:return Q(r("string",e)).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,i=t.requestQueue,o=new mt({userId:n.userId,userIds:e}),[4,i.send(o)];case 1:return s.sent(),[2]}}))}))},e.prototype.getAllEmoji=function(){return l(this,void 0,void 0,(function(){var e,t,n;return h(this,(function(r){switch(r.label){case 0:return e=A.of(this._iid).requestQueue,t=new Rt,[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(Lt).emojiContainer]}}))}))},e.prototype.getEmojiCategory=function(e){return l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:return t=A.of(this._iid).requestQueue,n=new At({categoryId:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Pt).emojiCategory]}}))}))},e.prototype.getEmoji=function(e){return l(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(i){switch(i.label){case 0:return t=A.of(this._iid).requestQueue,n=new Dt({key:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(Ut).emoji]}}))}))},e.prototype.getUnreadItemCount=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return Q(e instanceof Ce&&e.validate()).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new It({userId:n.userId,filter:e}),[4,r.send(i)];case 1:return[2,o.sent().as(wt)]}}))}))},e.prototype.getTotalUnreadChannelCount=function(){return l(this,void 0,void 0,(function(){var e,t,n,r,i;return h(this,(function(o){switch(o.label){case 0:return e=A.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new kt({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(Nt).unreadCount]}}))}))},e.prototype.getTotalUnreadMessageCount=function(e){return l(this,void 0,void 0,(function(){var t,n,r,i,o;return h(this,(function(s){switch(s.label){case 0:return Q(e instanceof Re&&e.validate()).throw(T.invalidParameters),t=A.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Ot({userId:n.userId,filter:e}),[4,r.send(i)];case 1:return o=s.sent(),[2,o.as(Tt).unreadCount]}}))}))},e.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=A.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},e.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=A.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e},e.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=A.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},e}();export{Ft as ApplicationUserListQuery,jt as BlockedUserListQuery,Ae as ConnectionHandler,St as Emoji,Ct as EmojiCategory,xt as EmojiContainer,Gt as FriendListQuery,qn as MemoryStore,Le as SessionHandler,Re as TotalUnreadMessageCountParams,xe as TotalUnreadMessageCountParamsProperties,Ce as UnreadItemCountParams,Se as UnreadItemCountParamsProperties,Pe as UserEventHandler,Te as UserUpdateParams,Oe as UserUpdateParamsProperties,Gn as default};
