/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function i(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function u(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var c,l="4.2.6",d=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return"4.2.6"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(c||(c={}));var h,p=function(e){return!(e instanceof f&&!e.shouldThrowOutside)},f=function(e){function n(t){var r=t.code,i=void 0===r?0:r,s=t.message,a=e.call(this,s)||this;return a.shouldThrowOutside=!1,a.name="SendbirdError",a.code=i,Object.setPrototypeOf(a,n.prototype),a}return t(n,e),Object.defineProperty(n.prototype,"isInvalidTokenError",{get:function(){return this.code===c.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===c.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===c.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:c.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:c.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRenew",{get:function(){return new n({code:c.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:c.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:c.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:c.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:c.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"notSupportedError",{get:function(){return new n({code:c.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:c.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:c.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:c.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:c.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:c.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:c.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:c.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:c.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:c.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:c.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:c.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),_=[c.CONNECTION_REQUIRED,c.NETWORK_ERROR,c.ACK_TIMEOUT,c.WEBSOCKET_CONNECTION_CLOSED,c.WEBSOCKET_CONNECTION_FAILED,c.FILE_UPLOAD_CANCEL_FAILED,c.REQUEST_CANCELED,c.INTERNAL_SERVER_ERROR,c.RATE_LIMIT_EXCEEDED,c.UNKNOWN_SERVER_ERROR],g=[c.WEBSOCKET_CONNECTION_CLOSED,c.WEBSOCKET_CONNECTION_FAILED,c.CONNECTION_REQUIRED],y=function(e,t){if(e!==t){var r=n({},e),i=n({},t);return(!r.hasOwnProperty("messageId")||!i.hasOwnProperty("messageId")||r.messageId===i.messageId)&&((!r.hasOwnProperty("reqId")||!i.hasOwnProperty("reqId")||r.reqId===i.reqId)&&(r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,JSON.stringify(r)===JSON.stringify(i)))}return!0},m=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||("string"!=typeof e?"object"==typeof e?v(e,t):E(e,t):typeof t===e)},v=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Object.values(e).includes(t)},E=function(e,t){return t instanceof e},b=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return m(e,t)}))},I=function(e){return e>0&&g.indexOf(e)>=0},S=function(e,t){if(void 0===t&&(t=!1),t&&null===e)return!0;var n=m("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},T=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=u([],o(e),!1).sort(),r=u([],o(t),!1).sort(),i=0;i<n.length;++i)if(n[i]!==r[i])return!1;return!0},A=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,r=void 0===n||n,i=t.typingIndicatorInvalidateTime,s=void 0===i?1e4:i,a=t.typingIndicatorThrottle,o=void 0===a?1e3:a,u=t.websocketResponseTimeout,c=void 0===u?1e4:u;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberInfoInMessage=r,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=o,this._websocketResponseTimeout=c}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){m("boolean",e)&&(this._useMemberInfoInMessage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){m("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){m("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){m("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),e}(),C={encrypt:function(e){return e},decrypt:function(e){return e}},N=function(){function e(e){var t=e.store;this._preference=new Map,this._store=t}return e.prototype._savePreferenceKeys=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._store.set({key:this._keysAddress,value:u([],o(this._preference.keys()),!1),generation:1})];case 1:return e.sent(),[2]}}))}))},e.prototype.init=function(e){var t;return i(this,void 0,void 0,(function(){var n,r,i,o,u,c,l,d;return s(this,(function(s){switch(s.label){case 0:return this._keysAddress=e,[4,this._store.get(e)];case 1:n=null!==(t=s.sent())&&void 0!==t?t:[],s.label=2;case 2:s.trys.push([2,7,8,9]),r=a(n),i=r.next(),s.label=3;case 3:return i.done?[3,6]:(o=i.value,[4,this._store.get(o)]);case 4:(u=s.sent())&&this._preference.set(o,u),s.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return c=s.sent(),l={error:c},[3,9];case 8:try{i&&!i.done&&(d=r.return)&&d.call(r)}finally{if(l)throw l.error}return[7];case 9:return[2]}}))}))},e.prototype.get=function(e){var t;return i(this,void 0,void 0,(function(){return s(this,(function(n){return[2,null!==(t=this._preference.get(e))&&void 0!==t?t:null]}))}))},e.prototype.set=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=!this._preference.has(e),[4,this._store.set({key:e,value:t,generation:1})];case 1:return r.sent(),this._preference.set(e,t),n?[4,this._savePreferenceKeys()]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._store.remove(e)];case 1:return t.sent(),this._preference.delete(e),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._store.removeMany(u([],o(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}}))}))},e}(),w=function(e){var t=e.encryption,n=void 0===t?null:t,r=e.store,i=void 0===r?null:r,s=e.localCacheEnabled,a=void 0===s||s;this.nestdb=null,this.store=i,this.preference=new N({store:i}),this.encryption=null!=n?n:C,this.localCacheEnabled=a},O=function(){function e(){this.sessionKey=null,this.authToken=null}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=null,this.sessionKey=null},e}(),R=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},D=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=R()}return e.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},e}(),M=function(){function e(){this._container={}}return e.prototype.on=function(e,t){return new D({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new D({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var s=[];try{for(var o=a(i.keys()),u=o.next();!u.done;u=o.next()){var c=u.value,l=i.get(c);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&s.push(c))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}s.forEach((function(e){return i.delete(e)}))}},e}(),L=function(){function e(){this._dispatcher=new M}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},e}(),k=function(){},P=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(h||(h={}));var U,q=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=R(),t}return t(n,e),n.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},n.prototype.encodeParams=function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,t=P(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=this,t=P(this.params);if(Object.keys(t).some((function(e){return S(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var i,s=t[r];if(S(s)){var a=s;n.append(r,a,null!==(i=a.name)&&void 0!==i?i:"filename")}else n.append(r,e.stringifyParams(s))})),n}return JSON.stringify(t)},enumerable:!1,configurable:!0}),n}(k),x=function(e){function r(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return t(r,e),Object.defineProperty(r.prototype,"payload",{get:function(){return n({},this._payload)},enumerable:!1,configurable:!0}),r.prototype.as=function(e){return new e(this._iid,this.payload)},r}(k),F=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t,n}return t(n,e),n}(k),G=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(k),Q=function(e){function n(t){var n=e.call(this)||this;return n.statLog=t,n}return t(n,e),n}(k);!function(e){e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(U||(U={}));var j,K=function(){function e(e){var t=e.type,n=e.data,r=e.ts,i=void 0===r?Date.now():r;this.type=t,this.createdAt=i,this.data=n}return e.payloadify=function(e){return P({stat_type:e.type,ts:e.createdAt,data:P(e.data)})},e}(),z=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,a=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof F&&a.cancel(e.requestId)})),this._logger=s}return Object.defineProperty(e.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",i=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(d.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(i)},enumerable:!1,configurable:!0}),e.prototype._createHeader=function(e,t){void 0===t&&(t=null);var r=this._sdkState,i=r.appId,s=r.appVersion,a=n(n({},e.headers),{SendBird:"JS,".concat(d.OS_VERSION,",").concat(d.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(a["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(a["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(a["App-Id"]=i,a["Access-Token"]=this._auth.authToken),a},e.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new Q(new K({type:U.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))},e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,c,l,d,p,_,g,y,m;return s(this,(function(s){switch(s.label){case 0:t=e.path,n=e.method,r=![h.GET,h.DELETE].includes(n),i=this._sdkState.api,a="".concat(i.host).concat(t).concat(r?"":e.query),o=r?e.payload:null,u=this._createHeader(e,o instanceof FormData?o:null),c=new AbortController,l=c.signal,this._abortControl.set(e.requestId,c),d=Date.now(),s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(a,{method:n,body:o,headers:u,signal:l})];case 2:return[4,(p=s.sent()).json()];case 3:if(_=s.sent(),p.ok||p.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,d,null),[2,new x(this._iid,_)];throw _?(g=new f(_),!e.requireAuth&&g.isSessionKeyExpiredError&&this._dispatcher.dispatch(new G),this._statLogApiResult(e,d,g),g):(g=f.requestFailed,this._statLogApiResult(e,d,g),g);case 4:throw y=s.sent(),this._statLogApiResult(e,d,y),y instanceof f?(this._logger.debug("fail api request",y),y):"AbortError"===y.name?f.requestCanceled:(m=f.networkError,this._logger.debug("fail api request",m),m);case 5:return[2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},e.prototype.cancelAll=function(){var e,t;try{for(var n=a(this._abortControl.values()),r=n.next();!r.done;r=n.next()){r.value.abort()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},e}(),B=function(e){function n(t,n,r,i){void 0===i&&(i="");var s=e.call(this)||this;return s._iid=t,s.code=n,s.payload=r,s.requestId=r?r.req_id:i,s}return t(n,e),n.createFromRawMessage=function(e,t){var r=t.substring(0,4),i=null;try{i=JSON.parse(t.substring(4))}catch(e){r="NOOP"}finally{return new n(e,r,i)}},n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(k),V=function(){};!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED"}(j||(j={}));var H,W=function(e){function n(t,n){var r=n.sdkState,i=n.dispatcher,s=n.logger,a=e.call(this)||this;return a.lastActive=0,a._iid=t,a._sdkState=r,a._dispatcher=i,a._logger=s,a}return t(n,e),Object.defineProperty(n.prototype,"isOpen",{get:function(){return this.connectionState===j.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return j.CONNECTING;case 1:return j.OPEN}return j.CLOSED},enumerable:!1,configurable:!0}),n.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach((function(e){if(e&&m("string",e)){var n=B.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?t.dispatch("message",n):"PONG"===n.code?t.dispatch("pong"):"EXPR"===n.code?n.payload&&n.payload.expires_in>=0&&t._dispatcher.dispatch(new G):"NOOP"===n.code||t.dispatch("message",n)}}))},this._ws.onerror=function(){t._logger.debug("websocket error"),t.dispatch("error",f.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t.dispatch("close")},this.lastActive=Date.now()},n.prototype.disconnect=function(){var e=this;return new Promise((function(t){e._logger.debug("websocket disconnect"),e._ws&&e.connectionState!==j.CLOSED?(e._ws.onopen=V,e._ws.onmessage=V,e._ws.onerror=V,e._ws.onclose=function(){e.dispatch("close"),t()},e._ws.close(),e._ws=null):t()}))},n.prototype.send=function(e){if(!this._ws)throw f.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},n.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},n}(M),Y=function(e){function n(t){var n,r=t.code,i=t.ackRequired,s=t.payload,a=void 0===s?null:s,o=this;return(o=e.call(this)||this).code=r,o.payload=a,o.requestId=null!==(n=o.payload.req_id)&&void 0!==n?n:R(),o.ackRequired=i,o.payload.req_id=o.requestId,o}return t(n,e),n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n}(k),J=function(e){function n(t){var n=t.all,r=t.custom_types,i=t.ts,s=e.call(this)||this;return s.all=n,s.customTypes=r,s.ts=i,s}return t(n,e),n}(k),X=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))},Z=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,a=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=s,this.apiClient=new z(e,{auth:n,sdkState:r,dispatcher:i,logger:s}),this.websocketClient=new W(e,{sdkState:r,dispatcher:i,logger:s}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new J(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new f({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(f.connectionClosed)})),a._ackStateMap.clear()}))}return e.prototype._sendApiRequest=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.apiClient.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i=this;return s(this,(function(s){if(t=new X,e.ackRequired){n=null,r=function(r,s){void 0===r&&(r=null),void 0===s&&(s=null),i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(i._logger.debug("fail websocket request",r),t.reject(r)):(i._logger.debug("receive websocket ack",e.requestId),t.resolve(s)))};try{n=setTimeout((function(){return r(f.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(null,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e)}catch(e){r(e)}}else try{this.websocketClient.send(e),t.resolve(null)}catch(e){t.reject(e)}return[2,t.promise]}))}))},e.prototype.send=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e instanceof q?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return e instanceof Y?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw f.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e)},e.prototype.cancelAll=function(){this.apiClient.cancelAll()},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT"}(H||(H={}));var $=function(e){function n(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return t(n,e),n}(k),ee=function(){function e(e,t){var n=t.auth,r=t.sdkState,a=t.dispatcher,o=t.logger,u=this;this._currentConnectionStateType=H.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new Z(e,{auth:n,sdkState:r,dispatcher:a,logger:o}),this._auth=n,this._logger=o,this._dispatcher=a,this._dispatcher.on((function(e){if(e instanceof $){var t=e.stateType;switch(u._currentConnectionStateType=t,t){case H.CONNECTED:var n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return i(u,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:t=e.command,n=e.deferred,r=e.timeout,clearTimeout(r),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.send(t)];case 2:return i=s.sent(),n.resolve(i),[3,4];case 3:return a=s.sent(),n.reject(a),[3,4];case 4:return[2]}}))}))}));break;case H.INITIALIZED:case H.DISCONNECTED:case H.LOGOUT:n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return i(u,void 0,void 0,(function(){var t,n;return s(this,(function(r){return t=e.deferred,n=e.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(f.connectionClosed):t.reject(f.connectionRequired),[2]}))}))}))}}}))}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===H.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===H.CONNECTING||this._currentConnectionStateType===H.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return e instanceof Y?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:return[2,i.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new X,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),f.connectionRequired;case 3:return[3,7];case 4:return e instanceof q?this._auth.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new X,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=f.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}}))}))},e.prototype.forceSend=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._logger.debug("send forced request",e),[4,this.commandRouter.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(f.connectionRequired),this._lazyCallQueue.splice(t,1))},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},e}(),te="/".concat("v3","/users"),ne="/".concat("v3","/storage/file"),re="/".concat("v3","/group_channels"),ie="/".concat("v3","/sdk/group_channels"),se="/".concat("v3","/open_channels"),ae="/".concat("v3","/sdk/open_channels"),oe="/".concat("v3","/search"),ue="/".concat("v3","/report"),ce="/".concat("v3","/emojis"),le="/".concat("v3","/emoji_categories"),de="/".concat("v3","/polls"),he="/".concat("v3","/scheduled_messages"),pe="/".concat("v3","/sdk/statistics"),fe=function(e){function n(t){var n=t.userId,r=t.authToken,i=t.expiringSession,s=void 0===i||i,a=e.call(this)||this;return a.path="".concat(te,"/").concat(n,"/session_key"),a.method=h.POST,a.params={token:r,expiring_session:!!s},a.requireAuth=!1,a}return t(n,e),n}(q),_e=function(e){function n(t){var n=t.authToken,r=t.expiringSession,i=void 0===r||r,s=t.requestId,a=void 0===s?null:s;return e.call(this,{code:"LOGI",payload:{token:n,expiring_session:i?1:0,req_id:a},ackRequired:!0})||this}return t(n,e),n}(Y),ge=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.key;return r.key=i,r}return t(n,e),n}(x),ye=function(e){function n(t,n,r){var i=e.call(this,t,"LOGI",r)||this;return i.error=null,i.newKey=r.new_key,i.error=r.error?new f(r.error):null,i}return t(n,e),n}(B),me=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(k),ve=function(e){return i(void 0,void 0,void 0,(function(){return s(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},Ee=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),be=function(e,t,n){return void 0===n&&(n=new Ee),i(void 0,void 0,void 0,(function(){var r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:r=0,i=null,a=function(e){return void 0===e&&(e=null),i=null!=e?e:new Error("Halted")},o=function(){r=0},s.label=1;case 1:if(!(-1===t||r<t))return[3,9];s.label=2;case 2:return s.trys.push([2,4,,8]),[4,e(a,o)];case 3:if(u=s.sent(),i)throw i;return[2,u];case 4:if(c=s.sent(),i)return[3,6];if(++r===t)throw c;return[4,ve(n.calcTimeout(r))];case 5:return s.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},Ie=function(e){return i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof f))throw t;return t.throwOutside(),[3,3];case 3:return[2]}}))}))},Se=function(e){return i(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},Te=function(e){function n(t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.requestQueue,a=t.logger,o=e.call(this)||this;return o._currentConnectionStateType=H.INITIALIZED,o._isRefreshingAuthToken=!1,o._isRefreshingSessionKey=!1,o.auth=n,o._sdkState=r,o._dispatcher=i,o._requestQueue=s,o._logger=a,o._dispatcher.on((function(e){if(e instanceof $){var t=e.stateType;o._currentConnectionStateType=t}else e instanceof G&&o.handler&&(o._logger.debug("session expired"),o.handler.onSessionExpired(),o.refresh())})),o}return t(n,e),n.prototype.createRefreshWebsocketCommand=function(e,t){return void 0===t&&(t=null),new _e({authToken:e,expiringSession:!0,requestId:t})},n.prototype._refreshSessionKeyByWebSocket=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return t=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(t)];case 1:if(n=s.sent(),r=n.as(ye),i=r.newKey,a=r.error)throw a;return this.auth.sessionKey=null!=i?i:this.auth.sessionKey,[2]}}))}))},n.prototype._refreshSessionKeyByApi=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return t=new fe({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,be((function(e){return i(n,void 0,void 0,(function(){var n,r,i;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(t)];case 1:return n=s.sent(),r=n.as(ge).key,this.auth.sessionKey=r,[3,3];case 2:if(i=s.sent(),!this._isSessionRelatedError(i))throw i;return e(i),[3,3];case 3:return[2]}}))}))}),3)];case 1:return r.sent(),[2]}}))}))},n.prototype._refreshSessionKey=function(e,t){return void 0===t&&(t=!0),i(this,void 0,void 0,(function(){var n,r,i,a;return s(this,(function(s){switch(s.label){case 0:if(this._currentConnectionStateType!==H.CONNECTED)return[3,9];s.label=1;case 1:return s.trys.push([1,3,,9]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return s.sent(),this.complete(),[2];case 3:return n=s.sent(),this._isSessionRelatedError(n)?t?(r=this.auth,[4,this._receiveNewAuthToken()]):[3,8]:[3,8];case 4:return r.authToken=s.sent(),this.auth.authToken?[4,this._refreshSessionKey(this.auth.authToken,!1)]:[3,6];case 5:return s.sent(),this.complete(),[3,7];case 6:this.close(),s.label=7;case 7:return[2];case 8:return[3,9];case 9:return s.trys.push([9,11,,20]),[4,this._refreshSessionKeyByApi(e)];case 10:return s.sent(),this.complete(),[3,20];case 11:return i=s.sent(),this._isSessionRelatedError(i)?t?(a=this.auth,[4,this._receiveNewAuthToken()]):[3,16]:[3,18];case 12:return a.authToken=s.sent(),this.auth.authToken?[4,this._refreshSessionKeyByApi(this.auth.authToken)]:[3,14];case 13:return s.sent(),this.complete(),[3,15];case 14:this.close(),s.label=15;case 15:return[3,17];case 16:throw i;case 17:return[3,19];case 18:throw i;case 19:return[3,20];case 20:return[2]}}))}))},n.prototype._receiveNewAuthToken=function(){var e=this,t=new X;return Ie((function(){return i(e,void 0,void 0,(function(){var e=this;return s(this,(function(n){return this._isRefreshingAuthToken=!0,this.auth.clear(),this.handler.onSessionTokenRequired((function(n){e._isRefreshingAuthToken=!1,e.dispatch("refresh-authtoken"),t.resolve(n)}),(function(n){e._isRefreshingAuthToken=!1,t.reject(n)})),[2]}))}))})),t.promise},n.prototype._isSessionRelatedError=function(e){return e instanceof f&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError)},Object.defineProperty(n.prototype,"isSessionKeyRefreshing",{get:function(){return this._isRefreshingSessionKey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),n.prototype.complete=function(){var e=this;this.dispatch("refresh"),Ie((function(){return i(e,void 0,void 0,(function(){return s(this,(function(e){return this._logger.debug("session refreshed"),this.handler.onSessionRefreshed(),[2]}))}))}))},n.prototype.error=function(e){var t=this;Ie((function(){return i(t,void 0,void 0,(function(){return s(this,(function(t){return this.handler.onSessionError(e),[2]}))}))}))},n.prototype.close=function(){var e=this;this.dispatch("close"),Ie((function(){return i(e,void 0,void 0,(function(){return s(this,(function(e){return this._logger.debug("session closed"),this.handler.onSessionClosed(),[2]}))}))}))},n.prototype.refresh=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(!this.handler)return[3,7];if(this._isRefreshingSessionKey)return[3,7];if(this._isRefreshingSessionKey=!0,this.auth.authToken)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._receiveNewAuthToken()];case 2:return(e=n.sent())?(this._logger.debug("session refreshing.."),this.auth.authToken=e,[3,4]):(this.close(),this._isRefreshingSessionKey=!1,[2]);case 3:throw n.sent(),t=f.sessionTokenRequestFailed,this._dispatcher.dispatch(new me),this.error(t),this._isRefreshingSessionKey=!1,t;case 4:return n.trys.push([4,6,,7]),[4,this._refreshSessionKey(this.auth.authToken)];case 5:return n.sent(),this._isRefreshingSessionKey=!1,[3,7];case 6:throw n.sent(),t=f.sessionTokenRefreshFailed,this._dispatcher.dispatch(new me),this.error(t),this._isRefreshingSessionKey=!1,t;case 7:return[2]}}))}))},n}(M),Ae=function(){function e(){this.type=H.NONE,this.name="none"}return e.prototype.run=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2]}))}))},e}(),Ce=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=H.LOGOUT,t.name="logout",t}return t(n,e),n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(a){switch(a.label){case 0:return t=Date.now(),n=e.sdkState.userId,[4,e.logout()];case 1:return a.sent(),[4,e.changeState(new De,t)];case 2:return a.sent(),Ie((function(){return i(r,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onDisconnected(n)})),[2]}))}))})),[2]}}))}))},n}(Ae),Ne=function(e){function n(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=H.DISCONNECTED,r.name="disconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return t(n,e),n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),this._autoReconnect?[4,e.changeState(new we,t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return r.sent(),[4,e.changeState(new Re({authToken:t}),n)];case 2:return r.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new we,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ce,t)];case 1:return n.sent(),[2]}}))}))},n}(Ae),we=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=H.RECONNECTING,t.name="reconnecting",t._haltConnect=null,t._resetConnect=null,t._callbacks=[],t}return t(n,e),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=null)},n.prototype._flushCallbacks=function(e){void 0===e&&(e=null),this._haltConnect=null,this._resetConnect=null,this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r,a,o,u,l=this;return s(this,(function(d){switch(d.label){case 0:t=Date.now(),n=new X,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),Ie((function(){return i(l,void 0,void 0,(function(){return s(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted()})),[2]}))}))})),d.label=1;case 1:return d.trys.push([1,4,,9]),r=e.sdkState.websocket,a=r.reconnectMaxRetry,o=r.reconnectRetryStrategy,[4,be((function(t,n){return i(l,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:this._haltConnect=t,this._resetConnect=n,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.connect()];case 2:return i.sent(),[3,4];case 3:if((r=i.sent())instanceof f&&r.code===c.CONNECTION_CANCELED)return t(r),[2];throw r;case 4:return[2]}}))}))}),a,o)];case 2:return d.sent(),[4,e.changeState(new Oe,t)];case 3:return d.sent(),Ie((function(){return i(l,void 0,void 0,(function(){return s(this,(function(t){return this._flushCallbacks(null),e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded()})),[2]}))}))})),[3,9];case 4:return u=d.sent(),p(u)?[3,7]:u instanceof f?u.code===c.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Ne({autoReconnect:!1}),t)]:[3,6];case 5:d.sent(),d.label=6;case 6:return Ie((function(){return i(l,void 0,void 0,(function(){return s(this,(function(t){return this._flushCallbacks(u),e.connectionHandlers.forEach((function(e){e.onReconnectFailed()})),[2]}))}))})),[3,8];case 7:throw u;case 8:return[3,9];case 9:return[2,n.promise]}}))}))},n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return n=new X,this._halt(f.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var r=Date.now();e.changeState(new Re({authToken:t}),r).then((function(){n.resolve()})).catch((function(e){n.reject(e)}))})),[2,n.promise]}))}))},n.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,r=void 0!==n&&n;return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new X,this._resetConnect&&r&&this._resetConnect(),this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){t.error;var n=t.autoReconnect,r=void 0===n||n;return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(f.connectionCanceled),[4,e.changeState(new Ne({autoReconnect:r}),t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(f.connectionCanceled),[4,e.changeState(new Ce,t)];case 1:return n.sent(),[2]}}))}))},n}(Ae),Oe=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=H.CONNECTED,t.name="connected",t}return t(n,e),n.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),[4,e.changeState(new we,t)];case 2:return n.sent(),[2]}}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return i(this,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return t=Date.now(),[4,e.changeState(new Ne({autoReconnect:n}),t)];case 1:return r.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ce,t)];case 1:return n.sent(),[2]}}))}))},n}(Ae),Re=function(e){function n(t){var n=t.authToken,r=e.call(this)||this;return r.type=H.CONNECTING,r.name="connecting",r._authToken="",r._haltConnect=null,r._callbacks=[],r._authToken=n,r}return t(n,e),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=null)},n.prototype._flushCallbacks=function(e){void 0===e&&(e=null),this._haltConnect=null,this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r,a=this;return s(this,(function(o){switch(o.label){case 0:t=Date.now(),n=new X,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),o.label=1;case 1:return o.trys.push([1,4,,10]),[4,be((function(t){return i(a,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if((n=r.sent())instanceof f&&n.code===c.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return[2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return o.sent(),[4,e.changeState(new Oe,t)];case 3:return o.sent(),Ie((function(){return i(a,void 0,void 0,(function(){return s(this,(function(t){return this._flushCallbacks(null),e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId)})),[2]}))}))})),[3,10];case 4:return r=o.sent(),p(r)?[3,8]:[4,e.disconnect()];case 5:return o.sent(),r instanceof f?r.code===c.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new De,t)]:[3,7];case 6:o.sent(),o.label=7;case 7:return Ie((function(){return i(a,void 0,void 0,(function(){return s(this,(function(e){return this._flushCallbacks(r),[2]}))}))})),[3,9];case 8:throw r;case 9:return[3,10];case 10:return[2,n.promise]}}))}))},n.prototype.onConnect=function(e){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){return e=new X,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,r=void 0===n?null:n;return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(null!=r?r:f.connectionCanceled),[4,e.changeState(new Ce,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(f.connectionCanceled),[4,e.changeState(new Ce,t)];case 1:return n.sent(),[2]}}))}))},n}(Ae),De=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=H.INITIALIZED,t.name="initialized",t}return t(n,e),n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.changeState(new Re({authToken:t}),n)];case 1:return r.sent(),[2]}}))}))},n}(Ae),Me=function(e){function n(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return t(n,e),n}(Y),Le=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=r}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this,n=new Me;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e.prototype.refreshTimer=function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e}(),ke=function(){function e(e){this._iid="",this._iid=e}return e.payloadify=function(e){return e?{}:null},e}(),Pe=new Map,Ue=function(e,t){var n;return void 0===t&&(t=null),null!==t&&Pe.set(e,t),null!==(n=Pe.get(e))&&void 0!==n?n:""},qe=function(e){function n(t){var n=t.userId,r=t.metadata,i=e.call(this)||this;return i.method=h.POST,i.path="".concat(te,"/").concat(n,"/metadata"),i.params={metadata:r},i}return t(n,e),n}(q),xe=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaData=n,r}return t(n,e),n}(x),Fe=function(e){function n(t){var n=t.userId,r=t.metadata,i=t.upsert,s=e.call(this)||this;return s.method=h.PUT,s.path="".concat(te,"/").concat(n,"/metadata"),s.params={metadata:r,upsert:i},s}return t(n,e),n}(q),Ge=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return t(n,e),n}(x),Qe=function(e){function n(t){var n=t.userId,r=t.metadataKey,i=e.call(this)||this;return i.method=h.DELETE,i.path="".concat(te,"/").concat(n,"/metadata/").concat(r),i}return t(n,e),n}(q);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(x);var je=function(e){function n(t){var n=t.userId,r=e.call(this)||this;return r.method=h.DELETE,r.path="".concat(te,"/").concat(n,"/metadata"),r}return t(n,e),n}(q);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(x);var Ke,ze=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},Be=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},Ve=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable"}(Ke||(Ke={}));var He,We,Ye,Je,Xe,Ze,$e,et=function(e){function r(t,n){var r,i,s,a,c,l,d,h,p,f,_,g,y=this;return(y=e.call(this,t)||this).userId=null!==(i=null!==(r=n.guest_id)&&void 0!==r?r:n.user_id)&&void 0!==i?i:"",y.nickname=null!==(a=null!==(s=n.nickname)&&void 0!==s?s:n.name)&&void 0!==a?a:"",y.plainProfileUrl=null!==(l=null!==(c=n.profile_url)&&void 0!==c?c:n.image)&&void 0!==l?l:"",y.requireAuth=null!==(d=n.require_auth_for_profile_image)&&void 0!==d&&d,y.metaData=null!==(h=n.metadata)&&void 0!==h?h:{},y.connectionStatus=Ke.NON_AVAILABLE,v(Ke,n.is_online)?y.connectionStatus=n.is_online:m("boolean",n.is_online)&&(y.connectionStatus=n.is_online?Ke.ONLINE:Ke.OFFLINE),y.isActive=null===(p=n.is_active)||void 0===p||p,y.lastSeenAt=null!==(f=n.last_seen_at)&&void 0!==f?f:null,y.preferredLanguages=n.preferred_languages?u([],o(n.preferred_languages),!1):null,y.friendDiscoveryKey=null!==(_=n.friend_discovery_key)&&void 0!==_?_:null,y.friendName=null!==(g=n.friend_name)&&void 0!==g?g:null,y}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})):null},Object.defineProperty(r.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(Ue(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),r.prototype.serialize=function(){return ze(this)},r.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return m("string",e)}))},r.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r]}))},r.prototype.createMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return Ve(this._isValidMetaData(e)).throw(f.invalidParameters),t=pr.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new qe({userId:n.userId,metadata:e}),[4,r.send(i)];case 1:return a=s.sent(),o=a.as(xe).metaData,this._applyMetaData(o),[2,this.metaData]}}))}))},r.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i,a,o,u;return s(this,(function(s){switch(s.label){case 0:return Ve(this._isValidMetaData(e)).throw(f.invalidParameters),n=pr.of(this._iid),r=n.sdkState,i=n.requestQueue,a=new Fe({userId:r.userId,metadata:e,upsert:t}),[4,i.send(a)];case 1:return o=s.sent(),u=o.as(Ge).metadata,this._applyMetaData(u),[2,this.metaData]}}))}))},r.prototype.deleteMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a;return s(this,(function(s){switch(s.label){case 0:return Ve(m("string",e)).throw(f.invalidParameters),t=pr.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Qe({userId:n.userId,metadataKey:e}),[4,r.send(i)];case 1:return s.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}}))}))},r.prototype.deleteAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return s(this,(function(i){switch(i.label){case 0:return e=pr.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new je({userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.metaData={},[2]}}))}))},r}(ke);!function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin"}(He||(He={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(We||(We={})),function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(Ye||(Ye={})),function(e){e.USERS="users",e.CHANNEL="channel"}(Je||(Je={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(Xe||(Xe={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress"}(Ze||(Ze={})),function(e){e.PENDING="pending",e.SCHEDULED="scheduled",e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled"}($e||($e={}));var tt,nt=function(e){function r(t,n){var r,i,s,a=this;return(a=e.call(this,t)||this).replyCount=0,a.mostRepliedUsers=null,a.lastRepliedAt=0,a.updatedAt=0,a.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,a.mostRepliedUsers=n.hasOwnProperty("most_replies")&&b("object",n.most_replies)?n.most_replies.map((function(e){return new et(a._iid,e)})):[],a.lastRepliedAt=null!==(i=n.last_replied_at)&&void 0!==i?i:0,a.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,a}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{reply_count:t.replyCount,most_replies:Array.isArray(t.mostRepliedUsers)?t.mostRepliedUsers.map((function(e){return et.payloadify(e)})):[],last_replied_at:t.lastRepliedAt,updated_at:t.updatedAt})):null},r}(ke);!function(e){e.ADD="add",e.DELETE="delete"}(tt||(tt={}));var rt,it,st,at,ot=function(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=m("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,s=e.updated_at;t&&m("string",n)&&m("string",r)&&v(tt,r)&&m("string",i)&&i&&m("number",s)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=s)},ut=function(){function e(e){var t,n,r,i=e.key,s=null!==(r=u([],o(e.user_ids),!1))&&void 0!==r?r:[],c=e.updated_at;m("string",i)&&i&&b("string",s)&&s.length>0&&m("number",c)&&(this.key=i,this.userIds=s,this.updatedAt=c);var l={};try{for(var d=a(this.userIds),h=d.next();!h.done;h=d.next()){l[h.value]=this.updatedAt}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}this._version=l}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return e?P({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case tt.ADD:t<0&&this.userIds.push(e.userId);break;case tt.DELETE:t>=0&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}},e}(),ct=function(){function e(e){this.key=e.key,this.value=b("string",e.value)?u([],o(e.value),!1):[]}return e.payloadify=function(e){var t;return e?P({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null},e}(),lt=function(){function e(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return e?P({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null},e}(),dt=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new lt(e["og:image"]))}return e.payloadify=function(e){return e?P({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?lt.payloadify(e.defaultImage):null}):null},e}(),ht=function(){function e(e){var t,n;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.prototype.serialize=function(){return{name:this.name,volume:this.volume}},e.payloadify=function(e){return e?P({name:e.name,volume:e.volume}):null},e}();!function(e){e.BASE="base",e.GROUP="group",e.OPEN="open"}(rt||(rt={})),function(e){e.OPERATOR="operator",e.NONE="none"}(it||(it={})),function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled"}(st||(st={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(at||(at={}));var pt,ft=function(e){switch(e){case He.BASE:return"";case He.USER:return"MESG";case He.FILE:return"FILE";case He.ADMIN:return"ADMM"}},_t=function(e){function r(t,n){var r,i,s,a,o,u,c,l,d,h,p,f,_,g,y=this;(y=e.call(this,t)||this).channelUrl=null,y.channelType=rt.BASE,y.messageId=0,y.parentMessageId=null,y.parentMessage=null,y.silent=!1,y.isOperatorMessage=!1,y.messageType=He.BASE,y.data=null,y.customType=null,y.mentionType=null,y.mentionedUsers=[],y.mentionedUserIds=[],y.mentionedMessageTemplate=null,y.threadInfo=null,y.reactions=[],y.metaArrays=[],y.ogMetaData=null,y.appleCriticalAlertOptions=null,y.createdAt=0,y.updatedAt=0,y.scheduledInfo=null,y.extendedMessage={},y._scheduledStatus=null,y.messageId=null!==(i=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==i?i:0,y.channelUrl=n.channel_url,y.channelType=v(rt,n.channel_type)?n.channel_type:rt.GROUP,n.channel&&(n.channel.channel_url&&(y.channelUrl=n.channel.channel_url),n.channel.channel_type&&(y.channelType=n.channel.channel_type)),y.parentMessageId=null!==(s="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==s?s:0,y.data=null!==(a=n.data)&&void 0!==a?a:"",y.customType=null!==(o=n.custom_type)&&void 0!==o?o:"",y.mentionType=v(Je,n.mention_type)?n.mention_type:null;var m=n.mentioned_users;y.mentionedUsers=m?m.map((function(e){return new et(y._iid,e)})):null;var E=n.mentioned_user_ids;y.mentionedUserIds=null!=E?E:null,y.mentionedUsers&&!y.mentionedUserIds&&(y.mentionedUserIds=y.mentionedUsers.map((function(e){return e.userId}))),y.mentionedMessageTemplate=null!==(u=n.mentioned_message_template)&&void 0!==u?u:"",y.threadInfo=n.thread_info?new nt(y._iid,n.thread_info):null,y.reactions=n.reactions?n.reactions.map((function(e){return new ut(e)})):[];for(var b=null!==(c=n.metaarray)&&void 0!==c?c:{},I=null!==(l=n.metaarray_key_order)&&void 0!==l?l:Object.keys(b).sort((function(e,t){return e.localeCompare(t)})),S=0;S<I.length;S++){var T=I[S];y.metaArrays.push(new ct({key:T,value:b[T]||[]}))}return n.sorted_metaarray&&(y.metaArrays=n.sorted_metaarray.map((function(e){return new ct(e)}))),y.ogMetaData=n.og_tag?new dt(n.og_tag):null,y.silent=null!==(d=n.silent)&&void 0!==d&&d,y.isOperatorMessage=null!==(h=n.is_op_msg)&&void 0!==h&&h,y.appleCriticalAlertOptions=n.apple_critical_alert_options?new ht(n.apple_critical_alert_options):null,y.createdAt=null!==(f=null!==(p=n.created_at)&&void 0!==p?p:n.ts)&&void 0!==f?f:0,y.updatedAt=null!==(_=n.updated_at)&&void 0!==_?_:0,"number"==typeof n.scheduled_message_id&&"number"==typeof n.scheduled_at&&n.scheduled_status&&(y.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},y._scheduledStatus=n.scheduled_status),y.extendedMessage=null!==(g=n.extended_message)&&void 0!==g?g:{},y}return t(r,e),r.payloadify=function(t){var r,i,s,a;return t?P(n(n({},e.payloadify.call(this,t)),{channel_url:t.channelUrl,channel_type:t.channelType,message_id:t.messageId,type:ft(t.messageType),parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,mentioned_user_ids:t.mentionedUserIds,mentioned_users:null===(r=t.mentionedUsers)||void 0===r?void 0:r.map((function(e){return et.payloadify(e)})),mentioned_message_template:t.mentionedMessageTemplate,thread_info:t.threadInfo?nt.payloadify(t.threadInfo):null,reactions:t.reactions.map((function(e){return ut.payloadify(e)})),sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return ct.payloadify(e)})),og_tag:dt.payloadify(t.ogMetaData),silent:t.silent,is_op_msg:t.isOperatorMessage,apple_critical_alert_options:ht.payloadify(t.appleCriticalAlertOptions),created_at:t.createdAt,updated_at:t.updatedAt,scheduled_message_id:null===(s=t.scheduledInfo)||void 0===s?void 0:s.scheduledMessageId,scheduled_at:null===(a=t.scheduledInfo)||void 0===a?void 0:a.scheduledAt,scheduled_status:t._scheduledStatus,extended_message:t.extendedMessage})):null},r.prototype.isIdentical=function(e){return this.messageId===e.messageId},r.prototype.isEqual=function(e){return y(this,e)},r.prototype.isUserMessage=function(){return this.messageType===He.USER},r.prototype.isFileMessage=function(){return this.messageType===He.FILE},r.prototype.isAdminMessage=function(){return this.messageType===He.ADMIN},r.prototype.serialize=function(){return ze(this)},r.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},r.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},r.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new ut(ut.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},r.prototype.applyParentMessage=function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1},r}(ke),gt=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.role=null,r.isBlockedByMe=!1,r.role=v(it,n.role)?n.role:it.NONE,n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),r}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{role:t.role,is_blocked_by_me:t.isBlockedByMe})):null},r}(et),yt=function(e){function r(t,n){var r,i,s,a,o=this;if((o=e.call(this,t,n)||this).sender=null,o.reqId="",o.replyToChannel=!1,o.sendingStatus=null,o.errorCode=0,o.sender=n.user?new gt(o._iid,n.user):n.sender_id,o.reqId=null!==(i=null!==(r=n.req_id)&&void 0!==r?r:n.request_id)&&void 0!==i?i:"",o.replyToChannel=null!==(s=n.is_reply_to_channel)&&void 0!==s&&s,n.request_state&&v($e,n.request_state)&&(o.sendingStatus=n.request_state),!o.sendingStatus)if(o.messageId>0)o.sendingStatus=$e.SUCCEEDED;else if(o.scheduledInfo)switch(o._scheduledStatus=n.scheduled_status,n.scheduled_status){case at.SENT:case at.IN_QUEUE:o.sendingStatus=$e.SUCCEEDED;break;case at.PENDING:o.sendingStatus=$e.SCHEDULED;break;case at.FAILED:case at.REMOVED:o.sendingStatus=$e.FAILED;break;case at.CANCELED:o.sendingStatus=$e.CANCELED}else o.sendingStatus=$e.PENDING;return o.errorCode=null!==(a=n.error_code)&&void 0!==a?a:0,o}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{user:gt.payloadify(t.sender),req_id:t.reqId,is_reply_to_channel:t.replyToChannel,request_state:t.sendingStatus,error_code:t.errorCode})):null},Object.defineProperty(r.prototype,"isResendable",{get:function(){return this.sendingStatus===$e.FAILED&&((e=this.errorCode)>0&&_.indexOf(e)>=0);var e},enumerable:!1,configurable:!0}),r.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},r}(_t),mt=function(){function e(){this.messageTypeFilter=We.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=Xe.NONE}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e]})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case We.USER:if(e.messageType!==He.USER)return!1;break;case We.FILE:if(e.messageType!==He.FILE)return!1;break;case We.ADMIN:if(e.messageType!==He.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof yt))return!1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return!1}switch(this.replyType){case Xe.NONE:if(e.parentMessageId>0)return!1;break;case Xe.ONLY_REPLY_TO_CHANNEL:if(e instanceof yt&&e.parentMessageId>0&&!e.replyToChannel)return!1}return!0},e}(),vt=function(e){function n(t){var n=e.call(this)||this;if(n.method=h.POST,n.path="".concat(ne),n.params=P({file:t.file,channel_url:t.channelUrl}),t.thumbnailSizes)for(var r=0;r<t.thumbnailSizes.length;r++){var i=t.thumbnailSizes[r],s=i.maxWidth,a=i.maxHeight;n.params["thumbnail".concat(r+1)]="".concat(s,",").concat(a)}return n.requestId=t.requestId,n}return t(n,e),n}(q),Et=function(e){function n(t,n){var r,i,s,a=this;return(a=e.call(this,t,n)||this).url=n.url,a.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,a.thumbnailSizes=null!==(i=n.thumbnails)&&void 0!==i?i:[],a.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,a}return t(n,e),n}(x),bt=function(){function e(e){var t,n;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height}return e.payloadify=function(e){return e?P({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),It={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:We.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},St=function(e){return m("number",e.prevResultSize)&&m("number",e.nextResultSize)&&m("boolean",e.isInclusive)&&m("boolean",e.reverse)&&m("string",e.messageTypeFilter)&&v(We,e.messageTypeFilter)&&b("string",e.customTypesFilter,!0)&&b("string",e.senderUserIdsFilter,!0)&&m("boolean",e.includeMetaArray)&&m("boolean",e.includeReactions)&&m("boolean",e.includeParentMessageInfo)},Tt=function(e){function r(t,r){var i,s,a,o,u=this;if((u=e.call(this,t,r)||this).message=null,u.translations={},u.message=null!==(i=r.message)&&void 0!==i?i:"",u.messageType=He.ADMIN,u.translations=null!==(s=r.translations)&&void 0!==s?s:{},r.parent_message_info){var c=r.parent_message_info,l=n(n({},c),{message_id:u.parentMessageId,channel_url:u.channelUrl,channel_type:u.channelType,file:c.file,url:null===(a=c.file)||void 0===a?void 0:a.url,require_auth:null===(o=c.file)||void 0===o?void 0:o.require_auth});u.parentMessage=Pt(t,l)}return u}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,parent_message_info:kt(t.parentMessage)})):null},r.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return r=n(n({},It),t),Ve(this.messageId>0&&m("number",e)&&St(r)).throw(f.invalidParameters),[4,wn.of(this._iid).getThreadedMessagesByTimestamp(this,e,r)];case 1:return[2,i.sent()]}}))}))},r}(_t),At=function(){function e(e){var t,n;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.hasOwnProperty("detail")&&m("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return e?P({type:e.type,vendor:e.vendor,detail:e.detail}):null},e}();!function(e){e.OPEN="open",e.CLOSED="closed"}(pt||(pt={}));var Ct,Nt="removed",wt=function(e){switch(e){case pt.OPEN:return pt.OPEN;case pt.CLOSED:return pt.CLOSED}},Ot=function(e){return!e||e.text&&m("string",e.text)},Rt=function(e){return b("string",e)&&e.every((function(e){return""!==e.trim()}))},Dt=function(e){function r(t,n){var r,i,s,a,o,u,c,l=this;return(l=e.call(this,t)||this).pollId=0,l.id=0,l.text=null,l.voteCount=0,l.createdBy=null,l.createdAt=0,l.updatedAt=0,l._lastVotedAt=0,l.pollId=null!==(r=n.poll_id)&&void 0!==r?r:0,l.id=null!==(i=n.id)&&void 0!==i?i:0,l.text=null!==(s=n.text)&&void 0!==s?s:null,l.voteCount=null!==(a=n.vote_count)&&void 0!==a?a:0,l.createdBy=null!==(o=n.created_by)&&void 0!==o?o:null,l.createdAt=null!==(u=n.created_at)&&void 0!==u?u:0,l.updatedAt=null!==(c=n.updated_at)&&void 0!==c?c:0,l}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{vote_count:t.voteCount,poll_id:t.pollId,text:t.text,created_at:t.createdAt,id:t.id,created_by:t.createdBy,updated_at:t.updatedAt})):null},r}(ke),Mt=function(e){function r(t,n){var r,i,s,a,o,u,c,l,d,h,p,f,_,g=this;return(g=e.call(this,t)||this).id=0,g.title=null,g.createdAt=0,g.updatedAt=0,g.closeAt=-1,g.status=pt.CLOSED,g.messageId=0,g.data=null,g.voterCount=-1,g.options=[],g.createdBy=null,g.allowUserSuggestion=!1,g.allowMultipleVotes=!1,g.votedPollOptionIds=[],g.id=null!==(r=n.id)&&void 0!==r?r:0,g.title=null!==(i=n.title)&&void 0!==i?i:null,g.createdAt=null!==(s=n.created_at)&&void 0!==s?s:0,g.updatedAt=null!==(a=n.updated_at)&&void 0!==a?a:0,g.closeAt=null!==(o=n.close_at)&&void 0!==o?o:-1,g.status=null!==(u=wt(n.status))&&void 0!==u?u:pt.CLOSED,g.messageId=null!==(c=n.message_id)&&void 0!==c?c:0,g.data=null!==(l=n.data)&&void 0!==l?l:null,g.voterCount=null!==(d=n.voter_count)&&void 0!==d?d:-1,g.options=n.options?n.options.map((function(e){return new Dt(g._iid,e)})):[],g.createdBy=null!==(h=n.created_by)&&void 0!==h?h:null,g.allowUserSuggestion=null!==(p=n.allow_user_suggestion)&&void 0!==p&&p,g.allowMultipleVotes=null!==(f=n.allow_multiple_votes)&&void 0!==f&&f,g.votedPollOptionIds=null!==(_=n.voted_option_ids)&&void 0!==_?_:[],g}return t(r,e),r.prototype._applyPollUpdatePayload=function(e){var t,n,r,i,s,a,o,u,c=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(i=wt(e.status))&&void 0!==i?i:this.status,this.data=null!==(s=e.data)&&void 0!==s?s:this.data,this.voterCount=null!==(a=e.voter_count)&&void 0!==a?a:this.voterCount,this.options=e.options?e.options.map((function(e){return new Dt(c._iid,e)})):this.options,this.allowUserSuggestion=null!==(o=e.allow_user_suggestion)&&void 0!==o?o:this.allowUserSuggestion,this.allowMultipleVotes=null!==(u=e.allow_multiple_votes)&&void 0!==u?u:this.allowMultipleVotes},r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{id:t.id,title:t.title,created_at:t.createdAt,updated_at:t.updatedAt,close_at:t.closeAt,status:t.status,message_id:t.messageId,data:t.data,voter_count:t.voterCount,options:t.options.map((function(e){return Dt.payloadify(e)})),created_by:t.createdBy,allow_user_suggestion:t.allowUserSuggestion,allow_multiple_votes:t.allowMultipleVotes,voted_option_ids:t.votedPollOptionIds})):null},r.prototype.applyPollUpdateEvent=function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)},r.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,i=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var s=t[r];i>s._lastVotedAt&&(s.voteCount=e.vote_count,s._lastVotedAt=i)}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),!0},r}(ke),Lt=function(e){function r(t,r){var i,s,o,u,c,l,d,h=this;if((h=e.call(this,t,r)||this).message="",h.messageParams=null,h.translations={},h.translationTargetLanguages=[],h.messageSurvivalSeconds=-1,h.plugins=[],h._poll=null,h.message=r.message,h.messageType=He.USER,h.translations=null!==(o=r.translations)&&void 0!==o?o:{},h.translationTargetLanguages=null!==(u=r.target_langs)&&void 0!==u?u:[],0===Object.keys(h.translations).length&&h.translationTargetLanguages.length>0)try{for(var p=a(h.translationTargetLanguages),f=p.next();!f.done;f=p.next()){var _=f.value;h.translations[_]=""}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}if(h.messageSurvivalSeconds=null!==(c=r.message_survival_seconds)&&void 0!==c?c:-1,h.plugins=r.plugins?r.plugins.map((function(e){return new At(e)})):[],h._poll=r.poll?new Mt(h._iid,r.poll):null,r.parent_message_info){var g=r.parent_message_info,y=n(n({},g),{created_at:g.ts,message_id:h.parentMessageId,channel_url:h.channelUrl,channel_type:h.channelType,file:g.file,url:null===(l=g.file)||void 0===l?void 0:l.url,require_auth:null===(d=g.file)||void 0===d?void 0:d.require_auth});h.parentMessage=Pt(t,P(y))}return h}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,message_survival_seconds:t.messageSurvivalSeconds,plugins:t.plugins.map((function(e){return At.payloadify(e)})),poll:Mt.payloadify(t._poll),parent_message_info:kt(t.parentMessage)})):null},r.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return r=n(n({},It),t),Ve(this.messageId>0&&m("number",e)&&St(r)).throw(f.invalidParameters),[4,wn.of(this._iid).getThreadedMessagesByTimestamp(this,e,r)];case 1:return[2,i.sent()]}}))}))},r.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(r.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),r}(yt),kt=function(e){if(e)switch(e.messageType){case He.USER:return Lt.payloadify(e);case He.FILE:return Ut.payloadify(e);case He.ADMIN:return Tt.payloadify(e)}return null},Pt=function(e,t){switch(t.type){case"MESG":return new Lt(e,t);case"FILE":return new Ut(e,t);case"ADMM":case"BRDM":return new Tt(e,t)}return null},Ut=function(e){function r(t,r){var i,s,a,o,u,c,l,d,h,p,f,_,g,y,m,v=this;(v=e.call(this,t,r)||this).messageParams=null,v.plainUrl="",v.requireAuth=!1,v.name=null,v.size=0,v.type=null,v.thumbnails=[],v.messageSurvivalSeconds=-1,v.messageType=He.FILE;var E=null!==(i=r.file)&&void 0!==i?i:null;if(v.plainUrl=(null!==(a=null!==(s=null==E?void 0:E.url)&&void 0!==s?s:r.url)&&void 0!==a?a:"").split("?auth=")[0],v.name=null!==(u=null!==(o=null==E?void 0:E.name)&&void 0!==o?o:r.name)&&void 0!==u?u:"File",v.size=null!==(l=null!==(c=null==E?void 0:E.size)&&void 0!==c?c:r.size)&&void 0!==l?l:0,v.data=null!==(h=null!==(d=null==E?void 0:E.data)&&void 0!==d?d:r.custom)&&void 0!==h?h:"",v.type=E?null!==(p=E.type)&&void 0!==p?p:"":null!==(f=r.type)&&void 0!==f?f:"",v.requireAuth=null!==(_=r.require_auth)&&void 0!==_&&_,v.thumbnails=r.thumbnails?r.thumbnails.map((function(e){return new bt(n(n({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(v.requireAuth?"?auth=".concat(Ue(v._iid)):"")}))})):[],v.messageSurvivalSeconds=null!==(g=r.message_survival_seconds)&&void 0!==g?g:-1,r.parent_message_info){var b=r.parent_message_info,I=n(n({},b),{message_id:v.parentMessageId,channel_url:v.channelUrl,channel_type:v.channelType,file:b.file,url:null===(y=b.file)||void 0===y?void 0:y.url,require_auth:null===(m=b.file)||void 0===m?void 0:m.require_auth});v.parentMessage=Pt(t,I)}return v}return t(r,e),r.payloadify=function(t){return t?P(n(n({},e.payloadify.call(this,t)),{url:t.plainUrl,require_auth:t.requireAuth,file:{name:t.name,size:t.size,type:t.type,data:t.data},thumbnails:t.thumbnails.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:t.messageSurvivalSeconds,parent_message_info:kt(t.parentMessage)})):null},Object.defineProperty(r.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(Ue(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),r.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var r;return s(this,(function(i){switch(i.label){case 0:return r=n(n({},It),t),Ve(this.messageId>0&&m("number",e)&&St(r)).throw(f.invalidParameters),[4,wn.of(this._iid).getThreadedMessagesByTimestamp(this,e,r)];case 1:return[2,i.sent()]}}))}))},r}(yt),qt=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger;t.onlineDetector;var o=t.cacheContext,u=void 0===o?null:o;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},e}(),xt=function(){function e(){this._onPending=V,this._onFailed=V,this._onSucceeded=V}return e.prototype._trigger=function(e,t){switch(t.sendingStatus){case $e.PENDING:this._onPending(t);break;case $e.FAILED:case $e.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);break;case $e.SCHEDULED:case $e.SUCCEEDED:this._onSucceeded(t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),Ft=function(e){function n(t,n){var r=e.call(this,t)||this;r.threadInfo=null,r.targetMessageId=0,r.channelUrl=null,r.channelType=null;var i=n.thread_info,s=n.root_message_id,a=n.channel_url,o=n.channel_type;return i&&m("object",i)&&m("number",s)&&m("string",a)&&m("string",o)&&(r.threadInfo=new nt(t,i),r.targetMessageId=s,r.channelUrl=a,r.channelType=o),r}return t(n,e),n}(ke),Gt={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},Qt=function(){function e(e,t){var n;this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return m("number",this.limit)&&this.limit>0},e}(),jt=function(e){function n(t){var n=t.channelCustomType,r=t.keyword,i=t.limit,s=t.reverse,a=t.exactMatch,o=t.channelUrl,u=t.order,c=t.messageTimestampFrom,l=t.messageTimestampTo,d=t.advancedQuery,p=t.targetFields,f=t.nextToken,_=e.call(this)||this;return _.method=h.GET,_.path="".concat(oe,"/messages"),_.params={custom_type:n,query:r,limit:i,reverse:s,exact_match:a,channel_url:o,message_ts_from:c,message_ts_to:l,sort_field:u,advanced_query:d,target_fields:p,after:f},_}return t(n,e),n}(q),Kt=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return Pt(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r.totalCount=n.total_count,r}return t(n,e),n}(x);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(Ct||(Ct={}));var zt,Bt=function(e){function r(t,n){var r,i,s,a,o,u,c,l,d,h=this;return(h=e.call(this,t,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl="",h.channelCustomType="",h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=Ct.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.totalCount=-1,h.keyword=n.keyword,h.reverse=null!==(r=n.reverse)&&void 0!==r&&r,h.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,h.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:"",h.channelCustomType=null!==(a=n.channelCustomType)&&void 0!==a?a:"",h.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,h.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,h.order=null!==(c=n.order)&&void 0!==c?c:Ct.SCORE,h.advancedQuery=null!==(l=n.advancedQuery)&&void 0!==l&&l,h.targetFields=null!==(d=n.targetFields)&&void 0!==d?d:null,h}return t(r,e),r.prototype._validate=function(){return e.prototype._validate.call(this)&&m("string",this.keyword)&&this.keyword.length>0&&m("boolean",this.reverse)&&m("boolean",this.exactMatch)&&m("string",this.channelUrl)&&m("string",this.channelCustomType)&&(m("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(m("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&v(Ct,this.order)&&m("boolean",this.advancedQuery)&&b("string",this.targetFields,!0)},r.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,r,i,a,o,u,c;return s(this,(function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=pr.of(this._iid).requestQueue,t=new jt(n(n({},this),{nextToken:this._nextToken?this._nextToken:null})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=s.sent(),i=r.as(Kt),a=i.messages,o=i.hasNext,u=i.nextToken,c=i.totalCount,this._nextToken=u,this._hasNext=o,this._isLoading=!1,this.totalCount=c,[2,a];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},r}(Qt),Vt=function(e){function n(t,n,r,i){var s=e.call(this,t,i)||this;return s.channelUrl=n,s.channelType=r,s}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&m("string",this.channelUrl)&&v(rt,this.channelType)},n}(Qt),Ht=function(e){function n(t,n,r,i){var s,a,o,u,c,l,d,h,p,f,_=this;return(_=e.call(this,t,n,r,i)||this).reverse=!1,_.messageTypeFilter=We.ALL,_.customTypesFilter=null,_.senderUserIdsFilter=null,_.replyType=Xe.NONE,_.includeMetaArray=!1,_.includeReactions=!1,_.includeParentMessageInfo=!1,_.includeThreadInfo=!1,_.showSubchannelMessagesOnly=!1,_._edge=Number.MAX_SAFE_INTEGER,_.reverse=null!==(s=i.reverse)&&void 0!==s&&s,_.messageTypeFilter=null!==(a=i.messageTypeFilter)&&void 0!==a?a:We.ALL,_.customTypesFilter=null!==(o=i.customTypesFilter)&&void 0!==o?o:null,_.senderUserIdsFilter=null!==(u=i.senderUserIdsFilter)&&void 0!==u?u:null,_.replyType=null!==(c=i.replyType)&&void 0!==c?c:Xe.NONE,_.includeMetaArray=null!==(l=i.includeMetaArray)&&void 0!==l&&l,_.includeReactions=null!==(d=i.includeReactions)&&void 0!==d&&d,_.includeParentMessageInfo=null!==(h=i.includeParentMessageInfo)&&void 0!==h&&h,_.includeThreadInfo=null!==(p=i.includeThreadInfo)&&void 0!==p&&p,_.showSubchannelMessagesOnly=null!==(f=i.showSubchannelMessagesOnly)&&void 0!==f&&f,_}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&m("boolean",this.reverse)&&v(We,this.messageTypeFilter)&&v(Xe,this.replyType)&&b("string",this.customTypesFilter,!0)&&b("string",this.senderUserIdsFilter,!0)&&m("boolean",this.includeMetaArray)&&m("boolean",this.includeReactions)&&m("boolean",this.includeParentMessageInfo)&&m("boolean",this.includeThreadInfo)&&m("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,wn.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,u([Number.MAX_SAFE_INTEGER],o(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw f.queryInProgress;case 4:return[3,6];case 5:throw f.invalidParameters;case 6:return[2]}}))}))},n}(Vt),Wt={channelUrl:null,scheduledMessageId:0},Yt=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="message",t}return t(r,e),r.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new wn(t,{sdkState:r,dispatcher:i,requestQueue:a,onlineDetector:u,cacheContext:c})},r.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},r.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},r.prototype.getMessage=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(r){return t=n(n({},Gt),e),Ve(function(e){return m("string",e.channelUrl)&&m("string",e.channelType)&&v(rt,e.channelType)&&m("number",e.messageId)&&m("boolean",e.includeMetaArray)&&m("boolean",e.includeParentMessageInfo)&&m("boolean",e.includeThreadInfo)}(t)).throw(f.invalidParameters),[2,this._manager.getMessage(t)]}))}))},r.prototype.getScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(r){return t=n(n({},Wt),e),Ve(function(e){return m("string",e.channelUrl)&&m("number",e.scheduledMessageId)}(t)).throw(f.invalidParameters),[2,this._manager.getScheduledMessage(t)]}))}))},r}(qt),Jt=function(e){switch(e){case rt.GROUP:return re;case rt.OPEN:return se;default:return null}},Xt=function(e){switch(e){case rt.GROUP:return"".concat(ue,"/group_channels");case rt.OPEN:return"".concat(ue,"/open_channels");default:return null}},Zt=function(e,t,n){var r,i;switch(e){case Je.CHANNEL:return!0;case Je.USERS:if(t)try{for(var s=a(t),o=s.next();!o.done;o=s.next()){if(o.value===n)return!0}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},$t=function(e,t,n){var r=Zt(e.mentionType,e.mentionedUserIds,n),i=Zt(t.mentionType,t.mentionedUserIds,n);return!r&&i?1:r&&!i?-1:0},en=function(e){function n(t){var n,r,i,s=[];return t.mentionType===Je.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId})))),e.call(this,{code:"FILE",ackRequired:!0,payload:P({channel_url:t.channelUrl,url:t.url,name:null!==(n=t.fileName)&&void 0!==n?n:"",type:null!==(r=t.mimeType)&&void 0!==r?r:"",size:null!==(i=t.fileSize)&&void 0!==i?i:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:s,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==Ze.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId,pin_message:t.isPinnedMessage})})||this}return t(n,e),n}(Y),tn=function(e){function n(t){var n,r=this;r=e.call(this)||this;var i=[];return t.mentionType===Je.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),r.method=h.POST,r.path="".concat(Jt(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),r.params=P({message_type:He.FILE,user_id:t.userId,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:i,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes.map((function(e){return bt.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(n=t.metaArrays)||void 0===n?void 0:n.map((function(e){return ct.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,apple_critical_alert_options:ht.payloadify(t.appleCriticalAlertOptions),reply_to_channel:t.isReplyToChannel,req_id:t.reqId,pin_message:t.isPinnedMessage}),r}return t(n,e),n}(q),nn=function(e){function n(t,n,r){var i,s,a,o=this;(o=e.call(this,t,"FILE",r)||this).message=new Ut(t,r);var u=pr.of(t).sdkState;return o.isMentioned=Zt(o.message.mentionType,null!==(i=o.message.mentionedUserIds)&&void 0!==i?i:null===(s=o.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),u.userId),o.forceUpdateLastMessage=null!==(a=r.force_update_last_message)&&void 0!==a&&a,o}return t(n,e),n}(B),rn=function(e){function n(t,n){var r,i,s=this;(s=e.call(this,t,n)||this).message=new Ut(t,n);var a=pr.of(t).sdkState;return s.isMentioned=Zt(s.message.mentionType,null!==(r=s.message.mentionedUserIds)&&void 0!==r?r:s.message.mentionedUsers.map((function(e){return e.userId})),a.userId),s.forceUpdateLastMessage=null!==(i=n.force_update_last_message)&&void 0!==i&&i,s}return t(n,e),n}(x);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(zt||(zt={}));var sn,an=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext,o=this;this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=a,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof $&&(o._connectionState=e.stateType)})),this._onlineDetector=s}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===H.CONNECTED||this._connectionState===H.CONNECTING||this._connectionState===H.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return this._shouldSendThroughWebSocket?(r=new en(n(n({},t.params),{channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,requireAuth:t.requireAuth,reqId:t.requestId})),[4,this._requestQueue.send(r)]):[3,2];case 1:return i=s.sent(),[2,i.as(nn).message];case 2:return r=new tn(n(n({},t.params),{channelUrl:e.url,channelType:e.channelType,url:t.params.fileUrl,userId:this._sdkState.userId,requireAuth:t.requireAuth,reqId:t.requestId})),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),[2,i.as(rn).message]}}))}))},e.prototype._resolveMessageQueue=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u,l,d,h,p,_,g;return s(this,(function(s){switch(s.label){case 0:if(!(t=this._queueMap.get(e.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,s.label=1;case 1:s.trys.push([1,15,16,17]),i=a(t.messageQueue),o=i.next(),s.label=2;case 2:if(o.done)return[3,14];switch(u=o.value,u.state){case zt.PENDING:case zt.UPLOADING:return[3,3];case zt.UPLOADED:return[3,4];case zt.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(u),[3,13];case 4:if(!r)return[3,10];s.label=5;case 5:return s.trys.push([5,8,,9]),u.state=zt.SENDING,[4,this._sendFileMessage(e,u)];case 6:return l=s.sent(),u.deferred.resolve(l),[4,ve(100)];case 7:return s.sent(),[3,9];case 8:return d=s.sent(),u.deferred.reject(d),[3,9];case 9:return[3,11];case 10:n.push(u),s.label=11;case 11:return[3,13];case 12:return u.deferred.reject(u.error.code===c.REQUEST_CANCELED?f.fileUploadCanceled:u.error),[3,13];case 13:return o=i.next(),[3,2];case 14:return[3,17];case 15:return h=s.sent(),_={error:h},[3,17];case 16:try{o&&!o.done&&(g=i.return)&&g.call(i)}finally{if(_)throw _.error}return[7];case 17:return p=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,p?[4,this._resolveMessageQueue(e)]:[3,19];case 18:s.sent(),s.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,s.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o,u,l,d,h,p,_,g,y;return s(this,(function(s){switch(s.label){case 0:return t=this._queueMap.get(e.url),(n=t.messageQueue.find((function(e){return e.state===zt.PENDING})))?S(n.params.file)?t.uploadQueue.length<6?(n.state=zt.UPLOADING,t.uploadQueue.push(n),[4,this._onlineDetector.isOnline()]):[3,10]:[3,11]:[3,13];case 1:if(!s.sent())return[3,8];s.label=2;case 2:return s.trys.push([2,4,5,7]),r=new vt({file:n.params.file,channelUrl:e.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),a=i.as(Et),o=a.url,u=a.fileSize,l=void 0===u?n.params.fileSize:u,d=a.thumbnailSizes,h=void 0===d?n.params.thumbnailSizes:d,p=a.requireAuth,_=void 0!==p&&p,n.params.fileUrl=o,n.params.fileSize=l,n.params.thumbnailSizes=h,n.params.requireAuth=_,n.requireAuth=_,n.state=zt.UPLOADED,[3,7];case 4:return(g=s.sent()).code===c.REQUEST_FAILED?n.error=new f({code:c.NETWORK_ERROR,message:"Failed to upload a file."}):n.error=g,n.state=zt.FAILED,[3,7];case 5:return(y=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(y,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 6:return s.sent(),[7];case 7:return[3,10];case 8:return n.state=zt.FAILED,n.error=f.connectionRequired,(y=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(y,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return n.params.thumbnailSizes=[],n.state=zt.UPLOADED,[4,this._resolveMessageQueue(e)];case 12:s.sent(),s.label=13;case 13:return[2]}}))}))},e.prototype.request=function(e,t,n){var r,a,o;return i(this,void 0,void 0,(function(){var i;return s(this,(function(s){return i=new X,S(n.file)&&(n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(a=n.mimeType)&&void 0!==a?a:n.file.type,n.fileSize=null!==(o=n.fileSize)&&void 0!==o?o:n.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:t,params:n,state:zt.PENDING,deferred:i,requireAuth:n.requireAuth}),this._uploadNextPendingItem(e),[2,i.promise]}))}))},e.prototype.cancel=function(e,t){var n,r;void 0===t&&(t=null);var i=this._queueMap.get(e.url);if(i){var s=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:u([],o(i.messageQueue),!1);try{for(var c=a(s),l=c.next();!l.done;l=c.next()){var d=l.value;if(d)switch(d.state){case zt.PENDING:d.state=zt.FAILED,d.error=f.requestCanceled,this._resolveMessageQueue(e);break;case zt.UPLOADING:this._requestQueue.cancel(d.requestId)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},e}(),on={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:We.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:Xe.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},un=function(e){return m("number",e.prevResultSize)&&m("number",e.nextResultSize)&&m("boolean",e.isInclusive)&&m("boolean",e.reverse)&&m("string",e.messageTypeFilter)&&v(We,e.messageTypeFilter)&&b("string",e.customTypesFilter,!0)&&b("string",e.senderUserIdsFilter,!0)&&v(Xe,e.replyType)&&m("boolean",e.includeMetaArray)&&m("boolean",e.includeReactions)&&m("boolean",e.includeParentMessageInfo)&&m("boolean",e.includeThreadInfo)&&m("boolean",e.showSubchannelMessagesOnly)},cn={replyType:Xe.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},ln=function(e){return v(Xe,e.replyType)&&m("boolean",e.includeReactions)&&m("boolean",e.includeMetaArray)&&m("boolean",e.includeParentMessageInfo)&&m("boolean",e.includeThreadInfo)};!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",e.EVENT_POLL_VOTED="EVENT_POLL_VOTED",e.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"}(sn||(sn={}));var dn,hn=function(e){return e.startsWith("EVENT_")||e===sn.SYNC_MESSAGE_FILL||e===sn.SYNC_MESSAGE_CHANGELOGS||e===sn.SYNC_POLL_CHANGELOGS},pn=function(e){function n(t){var n=t.messages,r=t.source,i=e.call(this)||this;return i.messages=n,i.source=r,i}return t(n,e),n}(k),fn=function(e){function n(t){var n=t.messageIds,r=t.source,i=e.call(this)||this;return i.messageIds=n,i.source=r,i}return t(n,e),n}(k),_n=function(e){function n(t){var n=t.reqId,r=t.source,i=e.call(this)||this;return i.reqId=n,i.source=r,i}return t(n,e),n}(k),gn=function(e){function n(t){var n=t.polls,r=t.source,i=e.call(this)||this;return i.polls=n,i.source=r,i}return t(n,e),n}(k),yn=function(e){function n(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=n,i.source=r,i}return t(n,e),n}(k),mn=function(e){function n(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=null,i.source=null,i.event=n,i.source=r,i}return t(n,e),n}(k),vn=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.includeMetaArray,a=t.includeReactions,o=t.includeThreadInfo,u=t.includeParentMessageInfo,c=e.call(this)||this;return c.method=h.GET,c.path="".concat(Jt(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i)),c.params={is_sdk:!0,with_sorted_meta_array:s,include_reactions:a,include_thread_info:o,include_parent_message_info:u,include_poll_details:!0},c}return t(n,e),n}(q),En=function(e){function r(t,r){var i=e.call(this,t,r)||this;return i.message=r?Pt(t,n({},r)):null,i}return t(r,e),r}(x),bn=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=void 0===i?null:i,a=t.token,o=void 0===a?null:a,u=t.prevResultSize,c=t.nextResultSize,l=t.isInclusive,d=t.reverse,p=t.messageTypeFilter,f=t.customTypesFilter,_=t.senderUserIdsFilter,g=t.replyType,y=t.includeMetaArray,m=t.includeReactions,v=t.parentMessageId,E=t.includeThreadInfo,b=t.includeParentMessageInfo,I=t.showSubchannelMessagesOnly,S=e.call(this)||this;return S.method=h.GET,S.path="".concat(Jt(n),"/").concat(encodeURIComponent(r),"/messages"),S.params=P({is_sdk:!0,prev_limit:u,next_limit:c,include:l,reverse:d,message_ts:s,message_id:o,message_type:null!=p?p:null,custom_types:f,sender_ids:_,include_reply_type:g,with_sorted_meta_array:y,include_reactions:m,parent_message_id:v,include_thread_info:E,include_parent_message_info:b,show_subchannel_message_only:I,include_poll_details:!0}),S}return t(n,e),n}(q),In=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.messages.map((function(e){return Pt(t,e)})),r}return t(n,e),n}(x),Sn=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=t.token,a=t.replyType,o=t.includeMetaArray,u=t.includeReactions,c=t.includeThreadInfo,l=t.includeParentMessageInfo,d=e.call(this)||this;return d.method=h.GET,d.path="".concat(Jt(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),d.params={change_ts:i,token:s,with_sorted_meta_array:o,include_reactions:u,include_thread_info:c,include_reply_type:a,include_parent_message_info:l,include_poll_details:!0},d}return t(n,e),n}(q),Tn=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return Pt(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return t(n,e),n}(x),An=function(e){function n(t){var n=t.channelUrl,r=t.scheduledMessageId,i=e.call(this)||this;return i.method=h.GET,i.path="".concat(re,"/").concat(encodeURIComponent(n),"/scheduled_messages/").concat(encodeURIComponent(r)),i.params={},i}return t(n,e),n}(q),Cn=function(e){function r(t,r){var i=e.call(this,t,r)||this;return i.message=r?Pt(t,n({},r)):null,i}return t(r,e),r}(x),Nn={},wn=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._cacheContext=a,this.fileMessageQueue=new an(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:a}),Nn[e]=this}return e.of=function(e){return Nn[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=Be(e);switch(t.messageType){case He.USER:return new Lt(this._iid,Lt.payloadify(t));case He.FILE:return new Ut(this._iid,Ut.payloadify(t));case He.ADMIN:return new Tt(this._iid,Tt.payloadify(t))}return null},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return P({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId})},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){return P({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})},e.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return n(n({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return n(n({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildSenderFromSerializedData=function(e){var t=Be(e);return new gt(this._iid,gt.payloadify(t))},e.prototype.getMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=new vn(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(En).message]}}))}))},e.prototype.getScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=new An(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Cn).message]}}))}))},e.prototype.getMessagesByMessageId=function(e,t,r,a,o){return void 0===o&&(o=sn.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var i,u,c;return s(this,(function(s){switch(s.label){case 0:return i=new bn(n(n({channelType:t,channelUrl:e,token:String(r)},on),a)),[4,this._requestQueue.send(i)];case 1:return u=s.sent(),c=u.as(In).messages,this._dispatcher.dispatch(new pn({messages:c,source:o})),[2,c]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,r,a,o){return void 0===o&&(o=sn.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var i,u,c;return s(this,(function(s){switch(s.label){case 0:return i=new bn(n(n({channelType:t,channelUrl:e,timestamp:r},on),a)),[4,this._requestQueue.send(i)];case 1:return u=s.sent(),c=u.as(In).messages,this._dispatcher.dispatch(new pn({messages:c,source:o})),[2,c]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,r,a){return void 0===a&&(a=sn.REQUEST_THREADED_MESSAGE),i(this,void 0,void 0,(function(){var i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return i=new bn(n(n(n({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},It),r),{replyType:Xe.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(i)];case 1:return o=s.sent(),u=o.as(In).messages,(c=u.slice(1)).forEach((function(t){t.parentMessage=e})),this._dispatcher.dispatch(new pn({messages:c,source:a})),[2,{parentMessage:u[0],threadedMessages:c}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,r,a,o){return void 0===o&&(o=sn.REQUEST_MESSAGE_CHANGELOGS),i(this,void 0,void 0,(function(){var i,u,c,l,d,h,p,f;return s(this,(function(s){switch(s.label){case 0:return i=new Sn(P(n(n({channelType:t,channelUrl:e,timestamp:"number"==typeof r?r:null,token:"string"==typeof r?r:null},cn),a))),[4,this._requestQueue.send(i)];case 1:return u=s.sent(),c=u.as(Tn),l=c.updatedMessages,d=c.deletedMessagesInfo,h=c.hasMore,p=c.nextToken,f=d.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new pn({messages:l,source:o})),f.length>0&&this._dispatcher.dispatch(new fn({messageIds:f,source:o})),[2,{updatedMessages:l,deletedMessageIds:f,hasMore:h,token:p}]}}))}))},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(dn||(dn={}));var On,Rn=function(e){switch(e){case dn.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case dn.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Dn={data:null,customType:null,mentionType:Je.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null,isPinnedMessage:!1},Mn=function(e){return m("string",e.data,!0)&&m("string",e.customType,!0)&&v(Je,e.mentionType)&&b("string",e.mentionedUserIds,!0)&&b(et,e.mentionedUsers,!0)&&m("string",e.mentionedMessageTemplate,!0)&&b(ct,e.metaArrays,!0)&&m("number",e.parentMessageId,!0)&&m("boolean",e.isReplyToChannel)&&v(Ze,e.pushNotificationDeliveryOption,!0)&&m(ht,e.appleCriticalAlertOptions,!0)&&m("boolean",e.isPinnedMessage,!0)},Ln=function(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}:null},kn=n(n({},Dn),{message:null,translationTargetLanguages:null,pollId:null}),Pn=function(e){var t;return P({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)})},Un=function(e){return Mn(e)&&m("string",e.message)&&b("string",e.translationTargetLanguages,!0)&&m("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(On||(On={}));var qn,xn=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},Fn=function(e){return e===On.BLOB||e===On.FILE},Gn=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},Qn=n(n({},Dn),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),jn=function(e,t){var n;return void 0===t&&(t=null),e.messageParams?(!e.url&&S(t)&&(e.messageParams.file=t),e.messageParams):P({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:null!=t?t:null===(n=e.messageParams)||void 0===n?void 0:n.file,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))})},Kn=function(e){return Mn(e)&&(S(e.file)||m("string",e.fileUrl))&&m("string",e.fileName,!0)&&m("string",e.mimeType,!0)&&m("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return m("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},zn=n(n({},kn),{scheduledAt:null}),Bn=function(e){return Un(e)&&m("number",e.scheduledAt,!0)},Vn=n(n({},Dn),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),Hn=function(e){return Mn(e)&&m("number",e.scheduledAt)&&(S(e.file)||m("string",e.fileUrl))&&m("string",e.fileName,!0)&&m("string",e.mimeType,!0)&&m("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return m("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Wn="UnsentMessage",Yn="reqId",Jn={},Xn=function(e){function r(t,n){var r=n.sdkState,i=n.cacheContext,s=e.call(this,t)||this;return s._sdkState=r,s._cacheContext=i,Jn[t]=s,s}return t(r,e),r.of=function(e){return Jn[e]},Object.defineProperty(r.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return e&&e.collection("UnsentMessage")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),r.prototype._serialize=function(e){if(e.messageId>0)throw f.invalidParameters;var t,r=n({},e.serialize());return e instanceof Lt?(e.messageParams&&(r.messageParams=Ln(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,n(n({},Ln(t)),{scheduledAt:t.scheduledAt})))):e instanceof Ut&&(e.messageParams&&(r.messageParams=Gn(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r.scheduledInfo.scheduledMessageParams=function(e){return n(n({},Gn(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))),r},r.prototype._deserialize=function(e){return e?(e=n(n({},e),{messageId:parseInt(e.messageId)}),wn.of(this._iid).buildMessageFromSerializedData(e)):null},r.prototype._deserializeWithMessageCreateParams=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,a,o;return s(this,(function(s){switch(s.label){case 0:return t=wn.of(this._iid),n=this._deserialize(e),e.messageParams?n instanceof Lt?(r=e.messageParams,n.messageParams=t.buildUserMessageCreateParamsFromSerializedData(r,n),[3,4]):[3,1]:[3,4];case 1:return n instanceof Ut?(r=e.messageParams).fileKey&&"string"==typeof r.fileKey&&Fn(r.fileType)?(i=r,[4,this.collection.getBlob(r.fileKey)]):[3,3]:[3,4];case 2:i.file=s.sent(),s.label=3;case 3:n.messageParams=t.buildFileMessageCreateParamsFromSerializedData(r,n),s.label=4;case 4:return n.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?n instanceof Lt?(a=e.scheduledInfo.scheduledMessageParams,n.scheduledInfo.scheduledMessageParams=t.buildScheduledUserMessageCreateParamsFromSerializedData(a,n),[3,8]):[3,5]:[3,8];case 5:return n instanceof Ut?(a=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof a.fileKey&&Fn(a.fileType)?(o=a,[4,this.collection.getBlob(a.fileKey)]):[3,7]:[3,8];case 6:o.file=s.sent(),s.label=7;case 7:n.scheduledInfo.scheduledMessageParams=t.buildScheduledFileMessageCreateParamsFromSerializedData(a,n),s.label=8;case 8:return[2,n]}}))}))},r.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return[2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return[2,null]}}))}))},r.prototype.fetch=function(e){var t=e.channelUrl,n=void 0===t?null:t,r=e.filter,a=void 0===r?new mt:r,o=e.order,u=void 0===o?dn.CHANNEL_LATEST:o,c=e.sendingStatus,l=void 0===c?null:c,d=e.backward,h=void 0!==d&&d,p=e.parentMessageId,f=void 0===p?null:p;return i(this,void 0,void 0,(function(){var e,t,r,o,c=this;return s(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?(e=Rn(u),t={"/where":function(e){return!!(u!==dn.NEWEST_CHILD_MESSAGE||f&&0!==e.parentMessageId&&e.parentMessageId===f)&&a.match(c._deserialize(e))}},n&&(t.channelUrl=n),l&&(t.sendingStatus=l),r={where:t,index:e,backward:h},[4,this.collection.query(r)]):[3,3];case 1:return[4,d.sent().fetch({})];case 2:return o=d.sent(),[2,Promise.all(o.map((function(e){return i(c,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._deserializeWithMessageCreateParams(e)];case 1:return[2,t.sent()]}}))}))})))];case 3:return[2,[]]}}))}))},r.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new mt),i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,this.fetch({filter:t,order:dn.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,n.sent()]}}))}))},r.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return s(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,3];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},r.prototype.upsertChildMessages=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},r.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o,u;return s(this,(function(s){switch(s.label){case 0:if(!this.localCacheEnabled)return[3,8];s.label=1;case 1:s.trys.push([1,6,7,8]),t=a(e),n=t.next(),s.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:s.sent(),s.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(u=t.return)&&u.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}}))}))},r.prototype.removeMessagesOfChannel=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},r.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},r.prototype.saveBlobs=function(e){return i(this,void 0,void 0,(function(){var t=this;return s(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return e instanceof Ut?e.messageParams&&(t=e.messageParams).file&&xn(t.file)?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2]:[3,4];case 1:r=i.sent(),t.fileKey=r,t.fileType=On.BLOB,i.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((n=e.scheduledInfo.scheduledMessageParams).file&&xn(n.file))?[4,this.collection.saveBlob(n.file,e.reqId)]:[3,4];case 3:r=i.sent(),n.fileKey=r,n.fileType=On.BLOB,i.label=4;case 4:return[2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},r}(ke),Zn=function(e){function n(t){var n=t.message,r=e.call(this)||this;return r.message=n,r}return t(n,e),n}(k),$n={},er=function(){function e(e,t){var n=t.localCacheEnabled,r=t.dispatcher,i=t.sdkState,s=t.logger,a=this;$n[e]=this,this._iid=e,$n[e]=this,this._localCacheEnabled=n,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=r,this._logger=s,this._sdkState=i,this._localCacheEnabled&&r.on((function(e){if(e instanceof $)switch(e.stateType){case H.CONNECTED:a._isProcessingAutoResend||a.processAutoResendRegisteredPendingMessages().then((function(){return a._processNextAutoResend()}));break;case H.DISCONNECTED:a._isProcessingAutoResend=!1}}))}return e.of=function(e){return $n[e]},e.prototype.processNonAutoResendRegisteredPendingMessages=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o;return s(this,(function(s){switch(s.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=s.sent();try{for(t=a(e),n=t.next();!n.done;n=t.next())0===(r=n.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",r.reqId),r.sendingStatus=$e.FAILED,r.errorCode=c.ACK_TIMEOUT,this._dispatcher.dispatch(new pn({messages:[r],source:sn.LOCAL_MESSAGE_FAILED})))}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=t.return)&&o.call(t)}finally{if(i)throw i.error}}return[2]}}))}))},e.prototype.processAutoResendRegisteredPendingMessages=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,o,u,c;return s(this,(function(s){switch(s.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:e=s.sent();try{for(t=a(e),n=t.next();!n.done;n=t.next())(r=n.value).errorCode&&I(r.errorCode)&&(i=(new Date).getTime(),o=r.createdAt+2592e5,i<=o?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(r.reqId)<0&&this._autoResendQueue.push(r):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(o).toLocaleString()),r.sendingStatus=$e.FAILED,this._dispatcher.dispatch(new pn({messages:[r],source:sn.LOCAL_MESSAGE_FAILED}))))}catch(e){u={error:e}}finally{try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(u)throw u.error}}return[2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled&&(e.sendingStatus===$e.SUCCEEDED||e.sendingStatus===$e.FAILED&&!I(e.errorCode))){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend()}},e.prototype._fetchAllCachedPendingMessages=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:return(e=Xn.of(this._iid))?[4,e.fetch({sendingStatus:$e.PENDING,backward:!0})]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=[],n.label=3;case 3:return[2,t]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._dispatcher.dispatch(new Zn({message:e})),this._logger.debug("processing auto-resend for message request id: ",e.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}return[2]}))}))},e}(),tr=function(){function e(e){void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_SAFE_INTEGER,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[],this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history")}return e.payloadify=function(e){return{emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/1048576,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction}},e}(),nr=function(e){function n(t){var n=t.userProfile,r=e.call(this)||this;return r.userProfile=n,r}return t(n,e),n}(k),rr=function(){function e(e,t){var n,r,i,s,a,o,u,c,l,d,h,p,f,_;this._iid=e,this.appInfo=new tr(t),this.user=new et(e,t),this.connectedAt=1e3*(null!==(n=t.login_ts)&&void 0!==n?n:0),this.firstConnectedAt=0,this.pingInterval=null!==(r=t.ping_interval)&&void 0!==r?r:15e3,this.pongTimeout=null!==(i=t.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(a=null===(s=t.reconnect)||void 0===s?void 0:s.interval)&&void 0!==a?a:3e3,this.reconnectMaxInterval=null!==(u=null===(o=t.reconnect)||void 0===o?void 0:o.max_interval)&&void 0!==u?u:6e4,this.reconnectRetryCount=null!==(l=null===(c=t.reconnect)||void 0===c?void 0:c.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(h=null===(d=t.reconnect)||void 0===d?void 0:d.mul)&&void 0!==h?h:2,this.maxUnreadCountOnSuperGroup=null!==(p=t.max_unread_cnt_on_super_group)&&void 0!==p?p:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(f=t.concurrent_call_limit)&&void 0!==f?f:5,this.backOffDelay=null!==(_=t.back_off_delay)&&void 0!==_?_:100}return e.payloadify=function(e){return n(n(n({},et.payloadify(e.user)),tr.payloadify(e.appInfo)),{login_ts:e.connectedAt/1e3,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=pr.of(this._iid);r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}},r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new nr({userProfile:this}))},e}(),ir=function(e){function r(t,n,r){var i,s=this;return(s=e.call(this,t,n,r)||this).error=null,s.userProfile=new rr(t,r),s.key=r.key,s.ekey=null!==(i=r.ekey)&&void 0!==i?i:"",s.error=r.error?new f(r):null,s}return t(r,e),r.asError=function(e){return new r(null,"LOGI",n({user_id:null,error:!0},e))},r.prototype.applyTo=function(e){if(this.error)throw this.error;var t=pr.of(e);if(!t)throw f.lostInstance;t.sessionManager.auth.sessionKey=this.key,Ue(e,this.ekey),this.userProfile.apply()},r}(B),sr=function(e){function n(t){var n=e.call(this)||this;return n.enabled=t,n}return t(n,e),n}(k),ar=function(e){function n(t,n){var r=n.sdkState,i=n.cacheContext,s=n.connectionHandlers,a=n.sessionManager,o=n.websocketClient,u=n.dispatcher,c=n.logger,l=n.entryState,d=void 0===l?new De:l,h=e.call(this)||this;return h._currentState=null,h._loginTimer=null,h._unresolvedLogi=null,h._stateUpdatedAt=0,h._connectingAt=0,h._connectionRequestQueue=[],h._iid=t,h.sdkState=r,h.cacheContext=i,h.connectionHandlers=s,h._sessionManager=a,h._websocketClient=o,h._dispatcher=u,h._logger=c,h._currentState=d,h.sdkState.websocket.pingerDisabled||(h._pinger=new Le({pingDelegate:{send:function(e){return h._websocketClient.send(e)},error:function(e){return h._websocketClient.error(e)}},sdkState:h.sdkState,logger:c})),h._websocketClient.on("open",(function(){h._tryResolveConnectionRequest()})).on("message",(function(e){if("LOGI"===e.code)h._loginTimer&&(clearTimeout(h._loginTimer),h._loginTimer=null),h._dispatcher.dispatch(e.as(ir))})).on("ping-refresh",(function(){var e;return null===(e=h._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=h._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=h._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){return h._rejectConnectionRequest(f.networkError)})),h._dispatcher.on((function(e){e instanceof ir&&(h._unresolvedLogi=e,h._tryResolveConnectionRequest())})),h}return t(n,e),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return t>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=t,this._dispatcher.dispatch(new $({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return n.sent(),[2,!0];case 2:return[2,!1]}}))}))},n.prototype._tryResolveConnectionRequest=function(){var e,t=this._unresolvedLogi;if(this._websocketClient.isOpen&&t)if(this._unresolvedLogi=null,t.error)this._sessionManager.auth.authToken=null,(t.error.isSessionKeyExpiredError||t.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new G),this._rejectConnectionRequest(t.error);else{t.applyTo(this._iid);var n=t.userProfile;this._enableStatLog(n.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),this._statLogConnection(null),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground";var r=er.of(this._iid);null==r||r.processNonAutoResendRegisteredPendingMessages()}},n.prototype._rejectConnectionRequest=function(e){var t;null===(t=this._pinger)||void 0===t||t.stop(),this._connectionRequestQueue.length>0&&(this._connectionRequestQueue.forEach((function(t){return t.reject(e)})),this._connectionRequestQueue=[],this._statLogConnection(e))},n.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,s=t.extensions,a=this.cacheContext.localCacheEnabled,o=this._sessionManager.auth,u=s.sb_syncmanager?"s".concat(s.sb_syncmanager):"",c=s.sb_uikit?"u".concat(s.sb_uikit):"",l="JS/c".concat(d.SDK_VERSION,"/").concat(u,"/").concat(c);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(d.OS_VERSION),"&sv=").concat(encodeURIComponent(d.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(o.hasSession?"&key=".concat(encodeURIComponent(o.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat(l,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(a?1:0,"&include_poll_details=1")},n.prototype._enableStatLog=function(e){this._dispatcher.dispatch(new sr(e))},n.prototype._statLogConnection=function(e){this._dispatcher.dispatch(new Q(new K({type:U.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))},n.prototype.connect=function(e){return void 0===e&&(e=""),i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){return t=this._url(e),n=new X,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){r._loginTimer=null,r._dispatcher.dispatch(ir.asError(f.loginTimeout))}),this.sdkState.websocket.responseTimeout),this._sessionManager.auth.authToken=e,this._websocketClient.connect(t)),[2,n.promise]}))}))},n.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(ir.asError(f.connectionRenew))},n.prototype.disconnect=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}}))}))},n.prototype.logout=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.sdkState.userId=null,this._unresolvedLogi=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),[4,this.disconnect()];case 1:return e.sent(),[2]}}))}))},n}(M),or=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,i=t.connectionHandlers,s=t.sessionManager,a=t.websocketClient,o=t.dispatcher,u=t.logger,c=t.disableWebSocketCloseEventHandling,l=void 0!==c&&c;this._context=null,this._disableWebSocketCloseEventHandling=!1,this._logger=u,this._disableWebSocketCloseEventHandling=l,this._context=new ar(e,{sdkState:n,cacheContext:r,connectionHandlers:i,sessionManager:s,websocketClient:a,dispatcher:o,logger:u}),this._sdkState=n,this._sessionManager=s,this._websocketClient=a}return e.prototype._registerEventDispatcher=function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",(function(){e.isConnected||(e._logger.debug("try reconnect by session token refresh"),e.reconnect())})).on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),e.reconnect())})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"===e._sdkState.appState&&(e._sessionManager.isRefreshingAuthToken||(e._logger.debug("try reconnect by websocket connection closed"),e.reconnect()))})))},e.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=null),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=null)},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===H.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===H.CONNECTING||e.type===H.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onConnect(this._context,e)];case 1:return t.sent(),this._registerEventDispatcher(),[2]}}))}))},e.prototype.reconnect=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{})];case 1:return e.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}}))}))},e.prototype.background=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return void 0===e&&(e=null),i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.logout=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._clearEventDispatcher(),[4,e.onLogout(this._context)];case 1:return t.sent(),[2]}}))}))},e}(),ur=function(e){function n(t){var n=t.deviceId,r=t.statLogs,i=e.call(this)||this;return i.method=h.POST,i.path="".concat(pe),i.params={device_id:n,log_entries:r.map((function(e){return K.payloadify(e)}))},i}return t(n,e),n}(q);!function(e){e[e.PENDING=0]="PENDING",e[e.ENABLED=1]="ENABLED",e[e.DISABLED=2]="DISABLED"}(qn||(qn={}));var cr,lr=function(){function e(e){var t=e.cacheContext,n=e.requestQueue,r=e.dispatcher,i=e.baseLimit,s=void 0===i?100:i,a=e.maxLimit,o=void 0===a?1e3:a,u=e.minLimit,c=void 0===u?10:u;this.queue=[],this.enabledstate=qn.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=R(),this.cacheContext=t,this.requestQueue=n,this.dispatcher=r,this.baseLimit=s,this.limit=s,this.maxLimit=o,this.minLimit=c}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.enabledstate===qn.ENABLED},enumerable:!1,configurable:!0}),e.prototype._save=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return K.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype._flush=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(!this.isEnabled)return[3,7];if(this.isFlushing)return[3,7];this.isFlushing=!0,n.label=1;case 1:return n.trys.push([1,5,6,7]),(e=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length>0?(t=new ur({deviceId:this.deviceId,statLogs:e}),[4,this.requestQueue.send(t)]):[3,4];case 2:return n.sent(),this.queue=this.queue.slice(e.length),[4,this._save()];case 3:n.sent(),n.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,7];case 5:return n.sent(),this.limit=this.limit+20,[3,7];case 6:return this.isFlushing=!1,[7];case 7:return[2]}}))}))},e.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(i){switch(i.label){case 0:return this.key=e,this.cacheContext.localCacheEnabled?[4,this.cacheContext.preference.get(this.key)]:[3,4];case 1:return(t=i.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map((function(e){return new K({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit?(n=Math.min(Math.floor(18e4*Math.random()),100),[4,ve(n)]):[3,4]):[3,4];case 2:return i.sent(),[4,this._flush()];case 3:i.sent(),i.label=4;case 4:return this.dispatcher.on((function(e){if(e instanceof Q){var t=e.statLog;r.put(t)}else e instanceof sr&&(r.enabledstate=e.enabled?qn.ENABLED:qn.DISABLED,r.isEnabled?r.queue.length>=r.limit&&r._flush():r.clear())})),[2]}}))}))},e.prototype.put=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.enabledstate===qn.DISABLED?[3,3]:(this.queue.push(e),[4,this._save()]);case 1:return t.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}}))}))},e}();!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.DEBUG=2]="DEBUG",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR"}(cr||(cr={}));var dr=function(){function e(){this.level=cr.WARN}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=cr.VERBOSE&&console.log.apply(console,u(["[verbose]"],o(e),!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=cr.DEBUG&&console.log.apply(console,u(["[debug]"],o(e),!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=cr.INFO&&console.log.apply(console,u(["[info]"],o(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=cr.WARN&&console.warn.apply(console,u(["[warn]"],o(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=cr.ERROR&&console.error.apply(console,u(["[error]"],o(e),!1))},e}(),hr={},pr=function(){function e(e,t){var n,r,i,s,a,o,u,c;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!hr[e]){hr[e]=this;var l=null!==(n=t.options)&&void 0!==n?n:new A,h=this.sdkState={appId:t.appId,appVersion:null!==(r=t.appVersion)&&void 0!==r?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(i=t.apiHost)&&void 0!==i?i:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(s=t.websocketHost)&&void 0!==s?s:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new Ee,responseTimeout:l.websocketResponseTimeout}};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var p=this.logger=new dr;this.logger.level=null!==(a=t.logLevel)&&void 0!==a?a:cr.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new w({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(o=t.localCacheEnabled)&&void 0!==o&&o}),this.debugMode=null!==(u=t.debugMode)&&void 0!==u&&u,this.maxSuperGroupChannelUnreadCount=d.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=l.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=l.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=l.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var f=this.dispatcher=new L,_=new O;this.requestQueue=new ee(e,{auth:_,sdkState:h,dispatcher:f,logger:p}),this.sessionManager=new Te({auth:_,sdkState:h,dispatcher:f,requestQueue:this.requestQueue,logger:p}),this.connectionManager=new or(e,{sdkState:h,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:f,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(c=t.disableWebSocketCloseEventHandling)&&void 0!==c&&c,logger:p}),this.statLogCollector=new lr({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:f})}return hr[e]}return e.of=function(e){if(hr[e])return hr[e];throw f.lostInstance},e.clear=function(e){hr[e]&&delete hr[e]},e}();export{Bt as $,h as A,xn as B,rt as C,k as D,M as E,Ut as F,te as G,le as H,ke as I,ce as J,b as K,Qt as L,sn as M,Wn as N,u as O,Mt as P,o as Q,C as R,f as S,r as T,et as U,pr as V,B as W,l as X,Ue as Y,j as Z,t as _,de as a,wt as a$,Be as a0,er as a1,Ie as a2,J as a3,nr as a4,rr as a5,A as a6,R as a7,Yt as a8,Xn as a9,pn as aA,p as aB,I as aC,Qn as aD,Kn as aE,xt as aF,on as aG,un as aH,cn as aI,ln as aJ,X as aK,Pn as aL,jn as aM,_t as aN,yt as aO,T as aP,We as aQ,st as aR,Se as aS,mn as aT,yn as aU,_n as aV,fn as aW,ie as aX,re as aY,he as aZ,at as a_,cr as aa,At as ab,it as ac,Ke as ad,Je as ae,ct as af,Ze as ag,ht as ah,Xt as ai,ue as aj,Y as ak,Lt as al,Zt as am,$t as an,ot as ao,Ye as ap,bt as aq,y as ar,Ht as as,gt as at,$e as au,He as av,c as aw,kn as ax,Un as ay,ve as az,q as b,ze as b0,Pt as b1,Zn as b2,nn as b3,Nt as b4,$ as b5,H as b6,Xe as b7,hn as b8,be as b9,kt as ba,zn as bb,Bn as bc,Vn as bd,Hn as be,Et as bf,vt as bg,Tt as bh,Ft as bi,ae as bj,se as bk,Ct as bl,lt as bm,dt as bn,ut as bo,tt as bp,nt as bq,x as c,Dt as d,P as e,Ot as f,Jt as g,v as h,m as i,i as j,s as k,n as l,gn as m,Vt as n,qt as o,pt as p,S as q,V as r,Rn as s,dn as t,Ve as u,Rt as v,Yn as w,wn as x,mt as y,a as z};
