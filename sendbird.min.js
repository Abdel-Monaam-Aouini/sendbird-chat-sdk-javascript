var Sendbird=function(e){"use strict";function t(){t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,s=Object.create(i.prototype),o=new T(r||[]);return a(s,"_invoke",{value:b(e,n,o)}),s}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function f(){}function p(){}function v(){}var _={};c(_,s,(function(){return this}));var m=Object.getPrototypeOf,g=m&&m(m(S([])));g&&g!==n&&r.call(g,s)&&(_=g);var y=v.prototype=f.prototype=Object.create(_);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(a,i,s,o){var u=d(e[a],e,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,s,o)}),(function(e){n("throw",e,s,o)})):t.resolve(l).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,o)}))}o(u.arg)}var i;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return i=i?i.then(a,a):a()}})}function b(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return I()}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var o=w(s,n);if(o){if(o===h)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=d(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=d(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function S(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return p.prototype=v,a(y,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:p,configurable:!0}),p.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},k(E.prototype),c(E.prototype,o,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var s=new E(l(t,n,r,a),i);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},k(y),c(y,u,"Generator"),c(y,s,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=S,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var o=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(o&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;x(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,k(r.key),r)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function l(e,t,n){return l=c()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&u(a,n.prototype),a},l.apply(null,arguments)}function d(e){var t="function"==typeof Map?new Map:void 0;return d=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return l(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)},d(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){var t=c();return function(){var n,r=o(e);if(t){var a=o(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,n)}}function p(){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},p.apply(this,arguments)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,s,o=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);u=!0);}catch(e){c=!0,a=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw a}}return o}}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=m(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function k(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function E(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))}var b,w="4.9.6",C=function(){function e(){r(this,e)}return i(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}},{key:"SDK_VERSION",get:function(){return w}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",get:function(){return 100}},{key:"INTERNAL_CALL",get:function(){return"ic"}}]),e}();!function(e){e[e.STAT_LOG_NOT_ALLOWED=400108]="STAT_LOG_NOT_ALLOWED",e[e.NON_AUTHORIZED=400108]="NON_AUTHORIZED",e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",e[e.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",e[e.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.SESSION_REVOKED=400310]="SESSION_REVOKED",e[e.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_COMMAND=700700]="INVALID_COMMAND",e[e.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",e[e.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",e[e.DATABASE_ERROR=800700]="DATABASE_ERROR"}(b||(b={}));var x,T,S,I,N,A=function(e){return!(e instanceof M&&!e.shouldThrowOutside)},M=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.code,s=void 0===i?0:i,o=e.message,u=void 0===o?"":o;return r(this,n),(a=t.call(this,u)).shouldThrowOutside=!1,a.name="SendbirdError",a.code=s,Object.setPrototypeOf(h(a),n.prototype),a}return i(n,[{key:"isInvalidTokenError",get:function(){return this.code===b.INVALID_TOKEN}},{key:"isSessionTokenExpiredError",get:function(){return this.code===b.SESSION_TOKEN_EXPIRED}},{key:"isSessionKeyExpiredError",get:function(){return this.code===b.SESSION_KEY_EXPIRED}},{key:"isSessionRevokedError",get:function(){return this.code===b.SESSION_REVOKED}},{key:"isUserAuthDeactivedError",get:function(){return this.code===b.USER_AUTH_DEACTIVATED}},{key:"isUserAuthDeletedOrNotFoundError",get:function(){return this.code===b.USER_AUTH_DELETED_OR_NOT_FOUND}},{key:"throwOutside",value:function(){throw this.shouldThrowOutside=!0,this}}],[{key:"debugModeRequired",get:function(){return new n({code:b.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})}},{key:"lostInstance",get:function(){return new n({code:b.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})}},{key:"invalidCommand",get:function(){return new n({code:b.INVALID_COMMAND,message:"Cannot send invalid command."})}},{key:"unknown",get:function(){return new n({code:b.UNKNOWN_ERROR,message:"Unknown error occurred."})}},{key:"connectionRenew",get:function(){return new n({code:b.CONNECTION_RENEW,message:"Connection restarts."})}},{key:"invalidConnectionStateTransition",get:function(){return new n({code:b.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})}},{key:"connectionRequired",get:function(){return new n({code:b.CONNECTION_REQUIRED,message:"Connection is required."})}},{key:"connectionCanceled",get:function(){return new n({code:b.CONNECTION_CANCELED,message:"Connection is canceled."})}},{key:"invalidParameters",get:function(){return new n({code:b.INVALID_PARAMETER,message:"Invalid parameters."})}},{key:"notSupportedError",get:function(){return new n({code:b.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})}},{key:"networkError",get:function(){return new n({code:b.NETWORK_ERROR,message:"There was a network error."})}},{key:"markAsReadAllRateLimitExceeded",get:function(){return new n({code:b.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})}},{key:"queryInProgress",get:function(){return new n({code:b.QUERY_IN_PROGRESS,message:"Query in progress."})}},{key:"noAckTimeout",get:function(){return new n({code:b.ACK_TIMEOUT,message:"Command received no ack."})}},{key:"loginTimeout",get:function(){return new n({code:b.LOGIN_TIMEOUT,message:"Connection timeout."})}},{key:"connectionClosed",get:function(){return new n({code:b.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})}},{key:"requestFailed",get:function(){return new n({code:b.REQUEST_FAILED,message:"Request failed."})}},{key:"fileUploadCanceled",get:function(){return new n({code:b.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})}},{key:"requestCanceled",get:function(){return new n({code:b.REQUEST_CANCELED,message:"Request has been canceled."})}},{key:"sessionTokenRefreshFailed",get:function(){return new n({code:b.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})}},{key:"sessionTokenRequestFailed",get:function(){return new n({code:b.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})}},{key:"databaseError",get:function(){return new n({code:b.DATABASE_ERROR,message:"Database error."})}},{key:"fileSizeLimitExceededError",get:function(){return new n({code:b.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})}}]),n}(d(Error)),O=[b.CONNECTION_REQUIRED,b.NETWORK_ERROR,b.ACK_TIMEOUT,b.WEBSOCKET_CONNECTION_CLOSED,b.WEBSOCKET_CONNECTION_FAILED,b.FILE_UPLOAD_CANCEL_FAILED,b.REQUEST_CANCELED,b.INTERNAL_SERVER_ERROR,b.RATE_LIMIT_EXCEEDED,b.UNKNOWN_SERVER_ERROR],U=[b.WEBSOCKET_CONNECTION_CLOSED,b.WEBSOCKET_CONNECTION_FAILED,b.CONNECTION_REQUIRED],D=function(e,t){if(e!==t){var n=Object.assign({},e),r=Object.assign({},t);return(!n.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||n.messageId===r.messageId)&&((!n.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||n.reqId===r.reqId)&&(n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(n)===JSON.stringify(r)))}return!0},L=function(e,t){return!(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])||null!=t)||("string"!=typeof e?"object"===n(e)?R(e,t):P(e,t):n(t)===e)},R=function(e,t){return!(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])||null!=t)||Object.values(e).includes(t)},P=function(e,t){return t instanceof e},F=function(e,t){return!(!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])||null!=t)||Array.isArray(t)&&t.every((function(t){return L(e,t)}))},H=function(e){return e>0&&U.indexOf(e)>=0},q=function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&null==e)return!0;var t="object"===n(e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!t){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return t},G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.useMemberInfoInMessage,a=void 0===n||n,i=t.typingIndicatorInvalidateTime,s=void 0===i?1e4:i,o=t.typingIndicatorThrottle,u=void 0===o?1e3:o,c=t.websocketResponseTimeout,l=void 0===c?1e4:c,d=t.websocketPayloadDecompression,h=void 0===d||d,f=t.sessionTokenRefreshTimeout,p=void 0===f?60:f;r(this,e),this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=a,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=p,this.websocketPayloadDecompression=h}return i(e,[{key:"useMemberInfoInMessage",get:function(){return this._useMemberInfoInMessage},set:function(e){L("boolean",e)&&(this._useMemberInfoInMessage=e)}},{key:"typingIndicatorInvalidateTime",get:function(){return this._typingIndicatorInvalidateTime},set:function(e){L("number",e)&&(this._typingIndicatorInvalidateTime=e)}},{key:"typingIndicatorThrottle",get:function(){return this._typingIndicatorThrottle},set:function(e){L("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)}},{key:"websocketResponseTimeout",get:function(){return this._websocketResponseTimeout},set:function(e){L("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)}},{key:"sessionTokenRefreshTimeout",get:function(){return this._sessionTokenRefreshTimeout},set:function(e){L("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)}}]),e}(),j={encrypt:function(e){return e},decrypt:function(e){return e}},z=function(){function e(t){var n=t.store;r(this,e),this._preference=new Map,this._store=n}return i(e,[{key:"_savePreferenceKeys",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.set({key:this._keysAddress,value:_(this._preference.keys())});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._version=r,this._keysAddress=e,i="".concat(e,".metadata.version"),t.next=5,this._store.get(i);case 5:return s=t.sent,t.next=8,this._store.get(e);case 8:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=12;break}t.t0=void 0!==n;case 12:if(!t.t0){t.next=16;break}t.t2=n,t.next=17;break;case 16:t.t2=[];case 17:if(o=t.t2,s&&!(s.version<this._version)){t.next=23;break}return t.next=21,this._resetPreferenceData(o,i);case 21:t.next=42;break;case 23:u=y(o),t.prev=24,u.s();case 26:if((c=u.n()).done){t.next=34;break}return l=c.value,t.next=30,this._store.get(l);case 30:(d=t.sent)&&this._preference.set(l,d);case 32:t.next=26;break;case 34:t.next=39;break;case 36:t.prev=36,t.t3=t.catch(24),u.e(t.t3);case 39:return t.prev=39,u.f(),t.finish(39);case 42:case"end":return t.stop()}}),a,this,[[24,36,39,42]])})))}},{key:"_resetPreferenceData",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._preference=new Map,t.next=3,this._store.removeMany(e);case 3:return t.next=5,this._store.set({key:n,value:{version:this._version}});case 5:case"end":return t.stop()}}),r,this)})))}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._preference.get(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"set",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=!this._preference.has(e),t.next=3,this._store.set({key:e,value:n});case 3:if(this._preference.set(e,n),!a){t.next=7;break}return t.next=7,this._savePreferenceKeys();case 7:case"end":return t.stop()}}),r,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._store.remove(e);case 2:return this._preference.delete(e),t.next=5,this._savePreferenceKeys();case 5:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.removeMany(_(this._preference.keys()));case 2:return this._preference.clear(),e.next=5,this._savePreferenceKeys();case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),V=function(){function e(t){var n=t.encryption,a=t.store,i=t.localCacheEnabled,s=t.localCacheConfig;r(this,e),this.store=a,this.preference=new z({store:a}),this.encryption=null!=n?n:j,this.localCacheEnabled=i,this.localCacheConfig=s}return i(e,[{key:"replaceStore",value:function(e){this.store=e,this.preference=new z({store:e})}}]),e}();e.PushTokenRegistrationState=void 0,(x=e.PushTokenRegistrationState||(e.PushTokenRegistrationState={})).SUCCESS="success",x.PENDING="pending",x.ERROR="error",e.PushTriggerOption=void 0,(T=e.PushTriggerOption||(e.PushTriggerOption={})).DEFAULT="default",T.ALL="all",T.MENTION_ONLY="mention_only",T.OFF="off",e.PushTokenType=void 0,(S=e.PushTokenType||(e.PushTokenType={})).FCM="gcm",S.APNS="apns",S.UNKNOWN="unknown",e.PushTemplate=void 0,(I=e.PushTemplate||(e.PushTemplate={})).ALTERNATIVE="alternative",I.DEFAULT="default",function(e){e.CUSTOM="custom",e.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(N||(N={}));var B,Q,K,W,Y,Z,J,X,$,ee,te=function(){function e(t){var n=t.channel,a=t.cachedMessageCount;r(this,e),this._cachedMessageCount=0,this._channel=n,this._cachedMessageCount=a}return i(e,[{key:"channel",get:function(){return this._channel}},{key:"cachedMessageCount",get:function(){return this._cachedMessageCount}}]),e}(),ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.maxSize,a=void 0===n?256:n,i=t.clearOrder,s=void 0===i?N.MESSAGE_COLLECTION_ACCESSED_AT:i,o=t.customClearOrderComparator;r(this,e),this._clearOrderComparatorUseMessageCollectionAccessedAt=function(e,t){return e.channel.messageCollectionLastAccessedAt===t.channel.messageCollectionLastAccessedAt?e.channel.lastMessage&&!t.channel.lastMessage?1:!e.channel.lastMessage&&t.channel.lastMessage?-1:e.channel.lastMessage||t.channel.lastMessage?e.channel.lastMessage.createdAt-t.channel.lastMessage.createdAt:0:e.channel.messageCollectionLastAccessedAt>t.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(a,64),o?(this._clearOrder=s,this._customClearOrderComparator=o):this._clearOrder=N.MESSAGE_COLLECTION_ACCESSED_AT}return i(e,[{key:"maxSize",get:function(){return this._maxSize}},{key:"clearOrder",get:function(){return this._clearOrder}},{key:"clearOrderComparator",get:function(){var e;return this._clearOrder===N.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:null!==(e=this._customClearOrderComparator)&&void 0!==e?e:this._clearOrderComparatorUseMessageCollectionAccessedAt}}]),e}(),re=function(){function e(){r(this,e)}return i(e,[{key:"hasSession",get:function(){return!!this.sessionKey}},{key:"clear",value:function(){this.authToken=void 0,this.sessionKey=void 0}}]),e}(),ae=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},ie=function(){function e(t){var n=t.container;r(this,e),this._container={},this._container=n,this.key=ae()}return i(e,[{key:"_register",value:function(e,t,n){var r;return e in this._container||(this._container[e]=new Map),null===(r=this._container[e])||void 0===r||r.set(this.key,{occurence:t,handler:n}),this}},{key:"on",value:function(e,t){return this._register(e,-1,t)}},{key:"once",value:function(e,t){return this._register(e,1,t)}},{key:"close",value:function(){var e;for(var t in this._container)null===(e=this._container[t])||void 0===e||e.delete(this.key)}}]),e}(),se=function(){function e(){r(this,e),this._container={}}return i(e,[{key:"on",value:function(e,t){return new ie({container:this._container}).on(e,t)}},{key:"once",value:function(e,t){return new ie({container:this._container}).once(e,t)}},{key:"dispatch",value:function(e,t){var n=this._container[e];if(n){var r,a=[],i=y(n.keys());try{for(i.s();!(r=i.n()).done;){var s=r.value,o=n.get(s);o.handler(t),o.occurence>0&&(o.occurence--,0===o.occurence&&a.push(s))}}catch(e){i.e(e)}finally{i.f()}a.forEach((function(e){return n.delete(e)}))}}}]),e}(),oe=function(){function e(){r(this,e),this._dispatcher=new se}return i(e,[{key:"on",value:function(e){return this._dispatcher.on("event",e)}},{key:"once",value:function(e){return this._dispatcher.once("event",e)}},{key:"dispatch",value:function(e){this._dispatcher.dispatch("event",e)}}]),e}(),ue=i((function e(){r(this,e)})),ce=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0===e[n]||Number.isNaN(e[n])||null===e[n]||(t[n]=e[n])})),t},le=function e(t){if(null!=t){if("object"===n(t)){if(Array.isArray(t)){var r=_(t);for(var a in r)r[a]=e(r[a]);return r}for(var i in t)null===t[i]&&delete t[i];return t}return t}};e.ChannelType=void 0,(B=e.ChannelType||(e.ChannelType={})).BASE="base",B.GROUP="group",B.OPEN="open",B.FEED="feed",e.Role=void 0,(Q=e.Role||(e.Role={})).OPERATOR="operator",Q.NONE="none",e.MutedState=void 0,(K=e.MutedState||(e.MutedState={})).MUTED="muted",K.UNMUTED="unmuted",e.MessageType=void 0,(W=e.MessageType||(e.MessageType={})).BASE="base",W.USER="user",W.FILE="file",W.ADMIN="admin",e.MessageTypeFilter=void 0,(Y=e.MessageTypeFilter||(e.MessageTypeFilter={})).ALL="",Y.USER="MESG",Y.FILE="FILE",Y.ADMIN="ADMM",function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(Z||(Z={})),e.MentionType=void 0,(J=e.MentionType||(e.MentionType={})).USERS="users",J.CHANNEL="channel",e.ReplyType=void 0,(X=e.ReplyType||(e.ReplyType={})).ALL="all",X.NONE="none",X.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",e.PushNotificationDeliveryOption=void 0,($=e.PushNotificationDeliveryOption||(e.PushNotificationDeliveryOption={})).DEFAULT="default",$.SUPPRESS="suppress",e.SendingStatus=void 0,(ee=e.SendingStatus||(e.SendingStatus={})).PENDING="pending",ee.SCHEDULED="scheduled",ee.SUCCEEDED="succeeded",ee.FAILED="failed",ee.CANCELED="canceled";var de,he="v3",fe="/".concat(he,"/users"),pe="/".concat(he,"/storage/file"),ve="/".concat(he,"/group_channels"),_e="/".concat(he,"/sdk/group_channels"),me="/".concat(he,"/open_channels"),ge="/".concat(he,"/sdk/open_channels"),ye="/".concat(he,"/search"),ke="/".concat(he,"/report"),Ee="/".concat(he,"/emojis"),be="/".concat(he,"/emoji_categories"),we="/".concat(he,"/polls"),Ce="/".concat(he,"/scheduled_messages"),xe="/".concat(he,"/sdk/ui_kit/configuration"),Te="/".concat(he,"/sdk/statistics"),Se=function(t){switch(t){case e.ChannelType.FEED:case e.ChannelType.GROUP:return ve;case e.ChannelType.OPEN:return me;default:return null}},Ie=function(t){switch(t){case e.ChannelType.GROUP:return"".concat(ke,"/group_channels");case e.ChannelType.OPEN:return"".concat(ke,"/open_channels");default:return null}},Ne=function(t,n,r){switch(t){case e.MentionType.CHANNEL:return!0;case e.MentionType.USERS:if(n){var a,i=y(n);try{for(i.s();!(a=i.n()).done;){if(a.value===r)return!0}}catch(e){i.e(e)}finally{i.f()}}}return!1},Ae=function(e,t,n){var r,a,i,s,o=Ne(null!==(r=e.mentionType)&&void 0!==r?r:null,null!==(a=e.mentionedUserIds)&&void 0!==a?a:[],n),u=Ne(null!==(i=t.mentionType)&&void 0!==i?i:null,null!==(s=t.mentionedUserIds)&&void 0!==s?s:[],n);return!o&&u?1:o&&!u?-1:0},Me=function e(t,r,a){var i,s=r||new FormData;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var u=t[o],c=a?"".concat(a,"[").concat(o,"]"):o;q(u)?s.append(c,u,null!==(i=u.name)&&void 0!==i?i:"filename"):"object"!==n(u)||null===u||Array.isArray(u)||u instanceof Blob?s.append(c,String(u)):s=e(u,s,c)}return s};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(de||(de={}));var Oe,Ue=function(e){s(a,e);var t=f(a);function a(){var e;return r(this,a),(e=t.apply(this,arguments)).params={},e.requireAuth=!0,e.headers={},e.requestId=ae(),e}return i(a,[{key:"encodeParams",value:function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"===n(e)?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))}},{key:"query",get:function(){var e=this,t=ce(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))}},{key:"payload",get:function(){var e=ce(this.params);return Object.keys(e).some((function(t){return q(e[t])}))?Me(e):JSON.stringify(e)}}]),a}(ue),De=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this))._iid=e,i._payload=a,i}return i(n,[{key:"payload",get:function(){return Object.assign({},this._payload)}},{key:"as",value:function(e){return new e(this._iid,this.payload)}}]),n}(ue),Le=function(e){s(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).requestId=e,a}return i(n)}(ue),Re=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.expires_in,s=e.reason,o=void 0===s?b.SESSION_KEY_EXPIRED:s;switch(r(this,n),(a=t.call(this)).expiresIn=null!=i?i:0,o){case b.SESSION_KEY_EXPIRED:case b.SESSION_TOKEN_EXPIRED:case b.SESSION_REVOKED:case b.USER_AUTH_DEACTIVATED:case b.USER_AUTH_DELETED_OR_NOT_FOUND:a.error=new M({code:o})}return a}return i(n,[{key:"invalidateSessionToken",get:function(){var e;return!!(null===(e=this.error)||void 0===e?void 0:e.isSessionTokenExpiredError)}}]),n}(ue),Pe=function(e){s(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).statLog=e,a}return i(n)}(ue);!function(e){e.FEATURE_LOCALCACHE="feature:local_cache",e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(Oe||(Oe={}));var Fe,He,qe,Ge=function(){function e(t){var n=t.type,a=t.data,i=t.ts,s=void 0===i?Date.now():i;r(this,e),this.type=n,this.createdAt=s,this.data=a}return i(e,null,[{key:"payloadify",value:function(e){return ce({stat_type:e.type,ts:e.createdAt,data:ce(e.data)})}}]),e}(),je=function(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},ze=function(){return!("undefined"==typeof navigator||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};e.SendbirdProduct=void 0,(Fe=e.SendbirdProduct||(e.SendbirdProduct={})).CHAT="chat",Fe.CALLS="calls",Fe.DESK="desk",Fe.LIVE="live",Fe.UIKIT_CHAT="uikit-chat",Fe.UIKIT_LIVE="uikit-live",e.SendbirdPlatform=void 0,(He=e.SendbirdPlatform||(e.SendbirdPlatform={})).ANDROID="android",He.IOS="ios",He.JS="js",He.UNREAL="unreal",He.UNITY="unity",He.REACT_NATIVE="react-native",He.FLUTTER="flutter",e.DeviceOsPlatform=void 0,(qe=e.DeviceOsPlatform||(e.DeviceOsPlatform={})).ANDROID="android",qe.IOS="ios",qe.WEB="web",qe.MOBILE_WEB="mobile_web",qe.WINDOWS="windows";var Ve=i((function e(){r(this,e)}));Ve.sendbirdSdkUserAgentWithExtension=function(t){var n=je()?e.SendbirdPlatform.REACT_NATIVE:e.SendbirdPlatform.JS,r={main_sdk_info:"chat/".concat(n,"/").concat(C.SDK_VERSION),device_os_platform:ze()?"mobile-web":"web",os_version:C.OS_VERSION};if(t){var a=t.sendbirdExtensions,i=t.deviceOS,s=t.customData,o=void 0===s?{}:s;i.version&&(r.os_version=i.version),i.platform&&(r.device_os_platform=i.platform),a.length>0&&(r.extension_sdk_info=a.map((function(e){var t=e.product,n=e.platform,r=e.version;return"".concat(t,"/").concat(n,"/").concat(r)})).join(",")),Object.keys(r).forEach((function(e){return delete o[e]})),Object.keys(o).length>0&&(r=Object.assign(Object.assign({},r),o))}return Object.entries(r).map((function(e){var t=v(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(r)})).join("&")},Ve.userAgentWithExtension=function(e){var t=je()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",a=e["device-os-platform"]?"o".concat(e["device-os-platform"]):ze()?"omobile-web":"oweb";return"".concat(t,"/c").concat(C.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(a)};var Be=function(){function e(t,n){var a=this,i=n.auth,s=n.sdkState,o=n.dispatcher,u=n.logger,c=n.useFetchCompat,l=void 0!==c&&c;r(this,e),this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=t,this._auth=i,this._sdkState=s,this._dispatcher=o,this._dispatcher.on((function(e){e instanceof Le&&a.cancel(e.requestId)})),this._logger=u,this._shouldImportFetchCompat=l}return i(e,[{key:"_createHeader",value:function(e,t){var n=this._sdkState,r=n.appId,a=n.appVersion,i=n.sendbirdRuntimeEnvironment,s=Object.assign(Object.assign({},e.headers),{SendBird:"JS,".concat(C.OS_VERSION,",").concat(C.SDK_VERSION,",").concat(r).concat(a?",".concat(a):""),"SB-User-Agent":Ve.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":Ve.sendbirdSdkUserAgentWithExtension(i)});return t||(s["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(s["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(s["App-Id"]=r,s["Access-Token"]=this._auth.authToken),s}},{key:"_statLogApiResult",value:function(e,t,n){this._dispatcher.dispatch(new Pe(new Ge({type:Oe.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))}},{key:"send",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h,f,p,v,_,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.path,a=e.method,i=![de.GET,de.DELETE].includes(a),s=this._sdkState.api,o="".concat(s.host).concat(r).concat(i?"":e.query),u=i?e.payload:null,c=this._createHeader(e,u instanceof FormData?u:void 0),l=new AbortController,d=l.signal,this._abortControl.set(e.requestId,l),h=Date.now(),t.prev=10,this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{fetch:null}).fetch=null),"undefined"!=typeof AbortController){t.next=15;break}return t.next=15,Promise.resolve().then((function(){return e_}));case 15:if("function"==typeof fetch){t.next=18;break}return t.next=18,Promise.resolve().then((function(){return E_}));case 18:return t.next=20,fetch(o,{method:a,body:u,headers:c,signal:d});case 20:return f=t.sent,t.next=23,f.json();case 23:if(p=t.sent,!f.ok&&!f.redirected){t.next=30;break}return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,h),t.abrupt("return",new De(this._iid,p));case 30:if(!p){t.next=37;break}throw((v=new M(p)).isSessionKeyExpiredError||v.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new Re({reason:v.code})),this._statLogApiResult(e,h,v),v;case 37:throw _=M.requestFailed,this._statLogApiResult(e,h,_),_;case 40:t.next=57;break;case 42:if(t.prev=42,t.t0=t.catch(10),this._statLogApiResult(e,h,t.t0),!(t.t0 instanceof M)){t.next=50;break}throw this._logger.debug("fail api request",t.t0),t.t0;case 50:if("AbortError"!==t.t0.name){t.next=54;break}throw M.requestCanceled;case 54:throw m=M.networkError,this._logger.debug("fail api request",m),m;case 57:case"end":return t.stop()}}),n,this,[[10,42]])})))}},{key:"cancel",value:function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))}},{key:"cancelAll",value:function(){var e,t=y(this._abortControl.values());try{for(t.s();!(e=t.n()).done;){e.value.abort()}}catch(e){t.e(e)}finally{t.f()}this._abortControl.clear()}}]),e}(),Qe=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return r(this,n),(s=t.call(this))._iid=e,s.code=a,s.payload=i,s.requestId=null!==(o=i.req_id)&&void 0!==o?o:u,s}return i(n,[{key:"convertToMessage",value:function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")}},{key:"as",value:function(e){return new e(this._iid,this.code,this.payload)}}],[{key:"createFromRawMessage",value:function(e,t){var r=t.substring(0,4),a={};try{a=JSON.parse(t.substring(4))}catch(e){r="NOOP"}finally{return new n(e,r,a)}}}]),n}(ue),Ke=function(){};function We(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ye=256,Ze=286,Je=30,Xe=15,$e=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),et=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),tt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),nt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rt=new Array(576);We(rt);const at=new Array(60);We(at);const it=new Array(512);We(it);const st=new Array(256);We(st);const ot=new Array(29);We(ot);const ut=new Array(Je);function ct(e,t,n,r,a){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=a,this.has_stree=e&&e.length}let lt,dt,ht;function ft(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}We(ut);const pt=e=>e<256?it[e]:it[256+(e>>>7)],vt=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},_t=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,vt(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},mt=(e,t,n)=>{_t(e,n[2*t],n[2*t+1])},gt=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},yt=(e,t,n)=>{const r=new Array(16);let a,i,s=0;for(a=1;a<=Xe;a++)s=s+n[a-1]<<1,r[a]=s;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=gt(r[t]++,t))}},kt=e=>{let t;for(t=0;t<Ze;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Je;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Et=e=>{e.bi_valid>8?vt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},bt=(e,t,n,r)=>{const a=2*t,i=2*n;return e[a]<e[i]||e[a]===e[i]&&r[t]<=r[n]},wt=(e,t,n)=>{const r=e.heap[n];let a=n<<1;for(;a<=e.heap_len&&(a<e.heap_len&&bt(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!bt(t,r,e.heap[a],e.depth));)e.heap[n]=e.heap[a],n=a,a<<=1;e.heap[n]=r},Ct=(e,t,n)=>{let r,a,i,s,o=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+o++],r+=(255&e.pending_buf[e.sym_buf+o++])<<8,a=e.pending_buf[e.sym_buf+o++],0===r?mt(e,a,t):(i=st[a],mt(e,i+Ye+1,t),s=$e[i],0!==s&&(a-=ot[i],_t(e,a,s)),r--,i=pt(r),mt(e,i,n),s=et[i],0!==s&&(r-=ut[i],_t(e,r,s)))}while(o<e.sym_next);mt(e,256,t)},xt=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,a=t.stat_desc.has_stree,i=t.stat_desc.elems;let s,o,u,c=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<i;s++)0!==n[2*s]?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=c<2?++c:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,a&&(e.static_len-=r[2*u+1]);for(t.max_code=c,s=e.heap_len>>1;s>=1;s--)wt(e,n,s);u=i;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],wt(e,n,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,n[2*u]=n[2*s]+n[2*o],e.depth[u]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,n[2*s+1]=n[2*o+1]=u,e.heap[1]=u++,wt(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,u=t.stat_desc.max_length;let c,l,d,h,f,p,v=0;for(h=0;h<=Xe;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)l=e.heap[c],h=n[2*n[2*l+1]+1]+1,h>u&&(h=u,v++),n[2*l+1]=h,l>r||(e.bl_count[h]++,f=0,l>=o&&(f=s[l-o]),p=n[2*l],e.opt_len+=p*(h+f),i&&(e.static_len+=p*(a[2*l+1]+f)));if(0!==v){do{for(h=u-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[u]--,v-=2}while(v>0);for(h=u;0!==h;h--)for(l=e.bl_count[h];0!==l;)d=e.heap[--c],d>r||(n[2*d+1]!==h&&(e.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),l--)}})(e,t),yt(n,c,e.bl_count)},Tt=(e,t,n)=>{let r,a,i=-1,s=t[1],o=0,u=7,c=4;for(0===s&&(u=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)a=s,s=t[2*(r+1)+1],++o<u&&a===s||(o<c?e.bl_tree[2*a]+=o:0!==a?(a!==i&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=a,0===s?(u=138,c=3):a===s?(u=6,c=3):(u=7,c=4))},St=(e,t,n)=>{let r,a,i=-1,s=t[1],o=0,u=7,c=4;for(0===s&&(u=138,c=3),r=0;r<=n;r++)if(a=s,s=t[2*(r+1)+1],!(++o<u&&a===s)){if(o<c)do{mt(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==i&&(mt(e,a,e.bl_tree),o--),mt(e,16,e.bl_tree),_t(e,o-3,2)):o<=10?(mt(e,17,e.bl_tree),_t(e,o-3,3)):(mt(e,18,e.bl_tree),_t(e,o-11,7));o=0,i=a,0===s?(u=138,c=3):a===s?(u=6,c=3):(u=7,c=4)}};let It=!1;const Nt=(e,t,n,r)=>{_t(e,0+(r?1:0),3),Et(e),vt(e,n),vt(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var At=(e,t,n,r)=>{let a,i,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Ye;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),xt(e,e.l_desc),xt(e,e.d_desc),s=(e=>{let t;for(Tt(e,e.dyn_ltree,e.l_desc.max_code),Tt(e,e.dyn_dtree,e.d_desc.max_code),xt(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*nt[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=a&&(a=i)):a=i=n+5,n+4<=a&&-1!==t?Nt(e,t,n,r):4===e.strategy||i===a?(_t(e,2+(r?1:0),3),Ct(e,rt,at)):(_t(e,4+(r?1:0),3),((e,t,n,r)=>{let a;for(_t(e,t-257,5),_t(e,n-1,5),_t(e,r-4,4),a=0;a<r;a++)_t(e,e.bl_tree[2*nt[a]+1],3);St(e,e.dyn_ltree,t-1),St(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),Ct(e,e.dyn_ltree,e.dyn_dtree)),kt(e),r&&Et(e)},Mt={_tr_init:e=>{It||((()=>{let e,t,n,r,a;const i=new Array(16);for(n=0,r=0;r<28;r++)for(ot[r]=n,e=0;e<1<<$e[r];e++)st[n++]=r;for(st[n-1]=r,a=0,r=0;r<16;r++)for(ut[r]=a,e=0;e<1<<et[r];e++)it[a++]=r;for(a>>=7;r<Je;r++)for(ut[r]=a<<7,e=0;e<1<<et[r]-7;e++)it[256+a++]=r;for(t=0;t<=Xe;t++)i[t]=0;for(e=0;e<=143;)rt[2*e+1]=8,e++,i[8]++;for(;e<=255;)rt[2*e+1]=9,e++,i[9]++;for(;e<=279;)rt[2*e+1]=7,e++,i[7]++;for(;e<=287;)rt[2*e+1]=8,e++,i[8]++;for(yt(rt,287,i),e=0;e<Je;e++)at[2*e+1]=5,at[2*e]=gt(e,5);lt=new ct(rt,$e,257,Ze,Xe),dt=new ct(at,et,0,Je,Xe),ht=new ct(new Array(0),tt,0,19,7)})(),It=!0),e.l_desc=new ft(e.dyn_ltree,lt),e.d_desc=new ft(e.dyn_dtree,dt),e.bl_desc=new ft(e.bl_tree,ht),e.bi_buf=0,e.bi_valid=0,kt(e)},_tr_stored_block:Nt,_tr_flush_block:At,_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(st[n]+Ye+1)]++,e.dyn_dtree[2*pt(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{_t(e,2,3),mt(e,256,rt),(e=>{16===e.bi_valid?(vt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Ot=(e,t,n,r)=>{let a=65535&e|0,i=e>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{a=a+t[r++]|0,i=i+a|0}while(--s);a%=65521,i%=65521}return a|i<<16|0};const Ut=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Dt=(e,t,n,r)=>{const a=Ut,i=r+n;e^=-1;for(let n=r;n<i;n++)e=e>>>8^a[255&(e^t[n])];return-1^e},Lt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Rt={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Pt,_tr_stored_block:Ft,_tr_flush_block:Ht,_tr_tally:qt,_tr_align:Gt}=Mt,{Z_NO_FLUSH:jt,Z_PARTIAL_FLUSH:zt,Z_FULL_FLUSH:Vt,Z_FINISH:Bt,Z_BLOCK:Qt,Z_OK:Kt,Z_STREAM_END:Wt,Z_STREAM_ERROR:Yt,Z_DATA_ERROR:Zt,Z_BUF_ERROR:Jt,Z_DEFAULT_COMPRESSION:Xt,Z_FILTERED:$t,Z_HUFFMAN_ONLY:en,Z_RLE:tn,Z_FIXED:nn,Z_DEFAULT_STRATEGY:rn,Z_UNKNOWN:an,Z_DEFLATED:sn}=Rt,on=258,un=262,cn=42,ln=113,dn=666,hn=(e,t)=>(e.msg=Lt[t],t),fn=e=>2*e-(e>4?9:0),pn=e=>{let t=e.length;for(;--t>=0;)e[t]=0},vn=e=>{let t,n,r,a=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=a?n-a:0}while(--t);t=a,r=t;do{n=e.prev[--r],e.prev[r]=n>=a?n-a:0}while(--t)};let _n=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const mn=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},gn=(e,t)=>{Ht(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,mn(e.strm)},yn=(e,t)=>{e.pending_buf[e.pending++]=t},kn=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},En=(e,t,n,r)=>{let a=e.avail_in;return a>r&&(a=r),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),n),1===e.state.wrap?e.adler=Ot(e.adler,t,a,n):2===e.state.wrap&&(e.adler=Dt(e.adler,t,a,n)),e.next_in+=a,e.total_in+=a,a)},bn=(e,t)=>{let n,r,a=e.max_chain_length,i=e.strstart,s=e.prev_length,o=e.nice_match;const u=e.strstart>e.w_size-un?e.strstart-(e.w_size-un):0,c=e.window,l=e.w_mask,d=e.prev,h=e.strstart+on;let f=c[i+s-1],p=c[i+s];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,c[n+s]===p&&c[n+s-1]===f&&c[n]===c[i]&&c[++n]===c[i+1]){i+=2,n++;do{}while(c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&c[++i]===c[++n]&&i<h);if(r=on-(h-i),i=h-on,r>s){if(e.match_start=t,s=r,r>=o)break;f=c[i+s-1],p=c[i+s]}}}while((t=d[t&l])>u&&0!=--a);return s<=e.lookahead?s:e.lookahead},wn=e=>{const t=e.w_size;let n,r,a;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-un)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),vn(e),r+=t),0===e.strm.avail_in)break;if(n=En(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=_n(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=_n(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<un&&0!==e.strm.avail_in)},Cn=(e,t)=>{let n,r,a,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(n=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>a&&(n=a),n<i&&(0===n&&t!==Bt||t===jt||n!==r+e.strm.avail_in))break;s=t===Bt&&n===r+e.strm.avail_in?1:0,Ft(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,mn(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(En(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==jt&&t!==Bt&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(En(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,i=a>e.w_size?e.w_size:a,r=e.strstart-e.block_start,(r>=i||(r||t===Bt)&&t!==jt&&0===e.strm.avail_in&&r<=a)&&(n=r>a?a:r,s=t===Bt&&0===e.strm.avail_in&&n===r?1:0,Ft(e,e.block_start,n,s),e.block_start+=n,mn(e.strm)),s?3:1)},xn=(e,t)=>{let n,r;for(;;){if(e.lookahead<un){if(wn(e),e.lookahead<un&&t===jt)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-un&&(e.match_length=bn(e,n)),e.match_length>=3)if(r=qt(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=_n(e,e.ins_h,e.window[e.strstart+1]);else r=qt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(gn(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Bt?(gn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(gn(e,!1),0===e.strm.avail_out)?1:2},Tn=(e,t)=>{let n,r,a;for(;;){if(e.lookahead<un){if(wn(e),e.lookahead<un&&t===jt)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-un&&(e.match_length=bn(e,n),e.match_length<=5&&(e.strategy===$t||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,r=qt(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=_n(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(gn(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=qt(e,0,e.window[e.strstart-1]),r&&gn(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=qt(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Bt?(gn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(gn(e,!1),0===e.strm.avail_out)?1:2};function Sn(e,t,n,r,a){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=a}const In=[new Sn(0,0,0,0,Cn),new Sn(4,4,8,4,xn),new Sn(4,5,16,8,xn),new Sn(4,6,32,32,xn),new Sn(4,4,16,16,Tn),new Sn(8,16,32,32,Tn),new Sn(8,16,128,128,Tn),new Sn(8,32,128,256,Tn),new Sn(32,128,258,1024,Tn),new Sn(32,258,258,4096,Tn)];function Nn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=sn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),pn(this.dyn_ltree),pn(this.dyn_dtree),pn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),pn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),pn(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const An=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==cn&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==ln&&t.status!==dn?1:0},Mn=e=>{if(An(e))return hn(e,Yt);e.total_in=e.total_out=0,e.data_type=an;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?cn:ln,e.adler=2===t.wrap?0:1,t.last_flush=-2,Pt(t),Kt},On=e=>{const t=Mn(e);var n;return t===Kt&&((n=e.state).window_size=2*n.w_size,pn(n.head),n.max_lazy_match=In[n.level].max_lazy,n.good_match=In[n.level].good_length,n.nice_match=In[n.level].nice_length,n.max_chain_length=In[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Un=(e,t,n,r,a,i)=>{if(!e)return Yt;let s=1;if(t===Xt&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),a<1||a>9||n!==sn||r<8||r>15||t<0||t>9||i<0||i>nn||8===r&&1!==s)return hn(e,Yt);8===r&&(r=9);const o=new Nn;return e.state=o,o.strm=e,o.status=cn,o.wrap=s,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=n,On(e)};var Dn={deflateInit:(e,t)=>Un(e,t,sn,15,8,rn),deflateInit2:Un,deflateReset:On,deflateResetKeep:Mn,deflateSetHeader:(e,t)=>An(e)||2!==e.state.wrap?Yt:(e.state.gzhead=t,Kt),deflate:(e,t)=>{if(An(e)||t>Qt||t<0)return e?hn(e,Yt):Yt;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===dn&&t!==Bt)return hn(e,0===e.avail_out?Jt:Yt);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(mn(e),0===e.avail_out)return n.last_flush=-1,Kt}else if(0===e.avail_in&&fn(t)<=fn(r)&&t!==Bt)return hn(e,Jt);if(n.status===dn&&0!==e.avail_in)return hn(e,Jt);if(n.status===cn&&0===n.wrap&&(n.status=ln),n.status===cn){let t=sn+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=en||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,kn(n,t),0!==n.strstart&&(kn(n,e.adler>>>16),kn(n,65535&e.adler)),e.adler=1,n.status=ln,mn(e),0!==n.pending)return n.last_flush=-1,Kt}if(57===n.status)if(e.adler=0,yn(n,31),yn(n,139),yn(n,8),n.gzhead)yn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),yn(n,255&n.gzhead.time),yn(n,n.gzhead.time>>8&255),yn(n,n.gzhead.time>>16&255),yn(n,n.gzhead.time>>24&255),yn(n,9===n.level?2:n.strategy>=en||n.level<2?4:0),yn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(yn(n,255&n.gzhead.extra.length),yn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Dt(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(yn(n,0),yn(n,0),yn(n,0),yn(n,0),yn(n,0),yn(n,9===n.level?2:n.strategy>=en||n.level<2?4:0),yn(n,3),n.status=ln,mn(e),0!==n.pending)return n.last_flush=-1,Kt;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=Dt(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=a,mn(e),0!==n.pending)return n.last_flush=-1,Kt;t=0,r-=a}let a=new Uint8Array(n.gzhead.extra);n.pending_buf.set(a.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=Dt(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Dt(e.adler,n.pending_buf,n.pending-r,r)),mn(e),0!==n.pending)return n.last_flush=-1,Kt;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,yn(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Dt(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=Dt(e.adler,n.pending_buf,n.pending-r,r)),mn(e),0!==n.pending)return n.last_flush=-1,Kt;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,yn(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=Dt(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(mn(e),0!==n.pending))return n.last_flush=-1,Kt;yn(n,255&e.adler),yn(n,e.adler>>8&255),e.adler=0}if(n.status=ln,mn(e),0!==n.pending)return n.last_flush=-1,Kt}if(0!==e.avail_in||0!==n.lookahead||t!==jt&&n.status!==dn){let r=0===n.level?Cn(n,t):n.strategy===en?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(wn(e),0===e.lookahead)){if(t===jt)return 1;break}if(e.match_length=0,n=qt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(gn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Bt?(gn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(gn(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===tn?((e,t)=>{let n,r,a,i;const s=e.window;for(;;){if(e.lookahead<=on){if(wn(e),e.lookahead<=on&&t===jt)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,r=s[a],r===s[++a]&&r===s[++a]&&r===s[++a])){i=e.strstart+on;do{}while(r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&r===s[++a]&&a<i);e.match_length=on-(i-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=qt(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=qt(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(gn(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Bt?(gn(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(gn(e,!1),0===e.strm.avail_out)?1:2})(n,t):In[n.level].func(n,t);if(3!==r&&4!==r||(n.status=dn),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),Kt;if(2===r&&(t===zt?Gt(n):t!==Qt&&(Ft(n,0,0,!1),t===Vt&&(pn(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),mn(e),0===e.avail_out))return n.last_flush=-1,Kt}return t!==Bt?Kt:n.wrap<=0?Wt:(2===n.wrap?(yn(n,255&e.adler),yn(n,e.adler>>8&255),yn(n,e.adler>>16&255),yn(n,e.adler>>24&255),yn(n,255&e.total_in),yn(n,e.total_in>>8&255),yn(n,e.total_in>>16&255),yn(n,e.total_in>>24&255)):(kn(n,e.adler>>>16),kn(n,65535&e.adler)),mn(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Kt:Wt)},deflateEnd:e=>{if(An(e))return Yt;const t=e.state.status;return e.state=null,t===ln?hn(e,Zt):Kt},deflateSetDictionary:(e,t)=>{let n=t.length;if(An(e))return Yt;const r=e.state,a=r.wrap;if(2===a||1===a&&r.status!==cn||r.lookahead)return Yt;if(1===a&&(e.adler=Ot(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===a&&(pn(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const i=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,wn(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=_n(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,wn(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=o,e.avail_in=i,r.wrap=a,Kt},deflateInfo:"pako deflate (from Nodeca project)"};const Ln=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Rn={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Ln(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,a=e.length;t<a;t++){let a=e[t];n.set(a,r),r+=a.length}return n}};let Pn=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Pn=!1}const Fn=new Uint8Array(256);for(let e=0;e<256;e++)Fn[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Fn[254]=Fn[254]=1;var Hn={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,a,i,s=e.length,o=0;for(a=0;a<s;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<s&&(r=e.charCodeAt(a+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),i=0,a=0;i<o;a++)n=e.charCodeAt(a),55296==(64512&n)&&a+1<s&&(r=e.charCodeAt(a+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),a++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,a;const i=new Array(2*n);for(a=0,r=0;r<n;){let t=e[r++];if(t<128){i[a++]=t;continue}let s=Fn[t];if(s>4)i[a++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?i[a++]=65533:t<65536?i[a++]=t:(t-=65536,i[a++]=55296|t>>10&1023,i[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Pn)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(i,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Fn[e[n]]>t?n:t}};var qn=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Gn=Object.prototype.toString,{Z_NO_FLUSH:jn,Z_SYNC_FLUSH:zn,Z_FULL_FLUSH:Vn,Z_FINISH:Bn,Z_OK:Qn,Z_STREAM_END:Kn,Z_DEFAULT_COMPRESSION:Wn,Z_DEFAULT_STRATEGY:Yn,Z_DEFLATED:Zn}=Rt;function Jn(e){this.options=Rn.assign({level:Wn,method:Zn,chunkSize:16384,windowBits:15,memLevel:8,strategy:Yn},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qn,this.strm.avail_out=0;let n=Dn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Qn)throw new Error(Lt[n]);if(t.header&&Dn.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Hn.string2buf(t.dictionary):"[object ArrayBuffer]"===Gn.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Dn.deflateSetDictionary(this.strm,e),n!==Qn)throw new Error(Lt[n]);this._dict_set=!0}}function Xn(e,t){const n=new Jn(t);if(n.push(e,!0),n.err)throw n.msg||Lt[n.err];return n.result}Jn.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let a,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Bn:jn,"string"==typeof e?n.input=Hn.string2buf(e):"[object ArrayBuffer]"===Gn.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(i===zn||i===Vn)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(a=Dn.deflate(n,i),a===Kn)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),a=Dn.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Qn;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Jn.prototype.onData=function(e){this.chunks.push(e)},Jn.prototype.onEnd=function(e){e===Qn&&(this.result=Rn.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var $n={Deflate:Jn,deflate:Xn,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Xn(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Xn(e,t)},constants:Rt};const er=16209;var tr=function(e,t){let n,r,a,i,s,o,u,c,l,d,h,f,p,v,_,m,g,y,k,E,b,w,C,x;const T=e.state;n=e.next_in,C=e.input,r=n+(e.avail_in-5),a=e.next_out,x=e.output,i=a-(t-e.avail_out),s=a+(e.avail_out-257),o=T.dmax,u=T.wsize,c=T.whave,l=T.wnext,d=T.window,h=T.hold,f=T.bits,p=T.lencode,v=T.distcode,_=(1<<T.lenbits)-1,m=(1<<T.distbits)-1;e:do{f<15&&(h+=C[n++]<<f,f+=8,h+=C[n++]<<f,f+=8),g=p[h&_];t:for(;;){if(y=g>>>24,h>>>=y,f-=y,y=g>>>16&255,0===y)x[a++]=65535&g;else{if(!(16&y)){if(0==(64&y)){g=p[(65535&g)+(h&(1<<y)-1)];continue t}if(32&y){T.mode=16191;break e}e.msg="invalid literal/length code",T.mode=er;break e}k=65535&g,y&=15,y&&(f<y&&(h+=C[n++]<<f,f+=8),k+=h&(1<<y)-1,h>>>=y,f-=y),f<15&&(h+=C[n++]<<f,f+=8,h+=C[n++]<<f,f+=8),g=v[h&m];n:for(;;){if(y=g>>>24,h>>>=y,f-=y,y=g>>>16&255,!(16&y)){if(0==(64&y)){g=v[(65535&g)+(h&(1<<y)-1)];continue n}e.msg="invalid distance code",T.mode=er;break e}if(E=65535&g,y&=15,f<y&&(h+=C[n++]<<f,f+=8,f<y&&(h+=C[n++]<<f,f+=8)),E+=h&(1<<y)-1,E>o){e.msg="invalid distance too far back",T.mode=er;break e}if(h>>>=y,f-=y,y=a-i,E>y){if(y=E-y,y>c&&T.sane){e.msg="invalid distance too far back",T.mode=er;break e}if(b=0,w=d,0===l){if(b+=u-y,y<k){k-=y;do{x[a++]=d[b++]}while(--y);b=a-E,w=x}}else if(l<y){if(b+=u+l-y,y-=l,y<k){k-=y;do{x[a++]=d[b++]}while(--y);if(b=0,l<k){y=l,k-=y;do{x[a++]=d[b++]}while(--y);b=a-E,w=x}}}else if(b+=l-y,y<k){k-=y;do{x[a++]=d[b++]}while(--y);b=a-E,w=x}for(;k>2;)x[a++]=w[b++],x[a++]=w[b++],x[a++]=w[b++],k-=3;k&&(x[a++]=w[b++],k>1&&(x[a++]=w[b++]))}else{b=a-E;do{x[a++]=x[b++],x[a++]=x[b++],x[a++]=x[b++],k-=3}while(k>2);k&&(x[a++]=x[b++],k>1&&(x[a++]=x[b++]))}break}}break}}while(n<r&&a<s);k=f>>3,n-=k,f-=k<<3,h&=(1<<f)-1,e.next_in=n,e.next_out=a,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=a<s?s-a+257:257-(a-s),T.hold=h,T.bits=f};const nr=15,rr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ar=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ir=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),sr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var or=(e,t,n,r,a,i,s,o)=>{const u=o.bits;let c,l,d,h,f,p,v=0,_=0,m=0,g=0,y=0,k=0,E=0,b=0,w=0,C=0,x=null;const T=new Uint16Array(16),S=new Uint16Array(16);let I,N,A,M=null;for(v=0;v<=nr;v++)T[v]=0;for(_=0;_<r;_++)T[t[n+_]]++;for(y=u,g=nr;g>=1&&0===T[g];g--);if(y>g&&(y=g),0===g)return a[i++]=20971520,a[i++]=20971520,o.bits=1,0;for(m=1;m<g&&0===T[m];m++);for(y<m&&(y=m),b=1,v=1;v<=nr;v++)if(b<<=1,b-=T[v],b<0)return-1;if(b>0&&(0===e||1!==g))return-1;for(S[1]=0,v=1;v<nr;v++)S[v+1]=S[v]+T[v];for(_=0;_<r;_++)0!==t[n+_]&&(s[S[t[n+_]]++]=_);if(0===e?(x=M=s,p=20):1===e?(x=rr,M=ar,p=257):(x=ir,M=sr,p=0),C=0,_=0,v=m,f=i,k=y,E=0,d=-1,w=1<<y,h=w-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){I=v-E,s[_]+1<p?(N=0,A=s[_]):s[_]>=p?(N=M[s[_]-p],A=x[s[_]-p]):(N=96,A=0),c=1<<v-E,l=1<<k,m=l;do{l-=c,a[f+(C>>E)+l]=I<<24|N<<16|A|0}while(0!==l);for(c=1<<v-1;C&c;)c>>=1;if(0!==c?(C&=c-1,C+=c):C=0,_++,0==--T[v]){if(v===g)break;v=t[n+s[_]]}if(v>y&&(C&h)!==d){for(0===E&&(E=y),f+=m,k=v-E,b=1<<k;k+E<g&&(b-=T[k+E],!(b<=0));)k++,b<<=1;if(w+=1<<k,1===e&&w>852||2===e&&w>592)return 1;d=C&h,a[d]=y<<24|k<<16|f-i|0}}return 0!==C&&(a[f+C]=v-E<<24|64<<16|0),o.bits=y,0};const{Z_FINISH:ur,Z_BLOCK:cr,Z_TREES:lr,Z_OK:dr,Z_STREAM_END:hr,Z_NEED_DICT:fr,Z_STREAM_ERROR:pr,Z_DATA_ERROR:vr,Z_MEM_ERROR:_r,Z_BUF_ERROR:mr,Z_DEFLATED:gr}=Rt,yr=16180,kr=16190,Er=16191,br=16192,wr=16194,Cr=16199,xr=16200,Tr=16206,Sr=16209,Ir=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Nr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ar=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<yr||t.mode>16211?1:0},Mr=e=>{if(Ar(e))return pr;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=yr,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,dr},Or=e=>{if(Ar(e))return pr;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Mr(e)},Ur=(e,t)=>{let n;if(Ar(e))return pr;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?pr:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Or(e))},Dr=(e,t)=>{if(!e)return pr;const n=new Nr;e.state=n,n.strm=e,n.window=null,n.mode=yr;const r=Ur(e,t);return r!==dr&&(e.state=null),r};let Lr,Rr,Pr=!0;const Fr=e=>{if(Pr){Lr=new Int32Array(512),Rr=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(or(1,e.lens,0,288,Lr,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;or(2,e.lens,0,32,Rr,0,e.work,{bits:5}),Pr=!1}e.lencode=Lr,e.lenbits=9,e.distcode=Rr,e.distbits=5},Hr=(e,t,n,r)=>{let a;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(a=i.wsize-i.wnext,a>r&&(a=r),i.window.set(t.subarray(n-r,n-r+a),i.wnext),(r-=a)?(i.window.set(t.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0};var qr={inflateReset:Or,inflateReset2:Ur,inflateResetKeep:Mr,inflateInit:e=>Dr(e,15),inflateInit2:Dr,inflate:(e,t)=>{let n,r,a,i,s,o,u,c,l,d,h,f,p,v,_,m,g,y,k,E,b,w,C=0;const x=new Uint8Array(4);let T,S;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ar(e)||!e.output||!e.input&&0!==e.avail_in)return pr;n=e.state,n.mode===Er&&(n.mode=br),s=e.next_out,a=e.output,u=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,d=o,h=u,w=dr;e:for(;;)switch(n.mode){case yr:if(0===n.wrap){n.mode=br;break}for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,x[0]=255&c,x[1]=c>>>8&255,n.check=Dt(n.check,x,2,0),c=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Sr;break}if((15&c)!==gr){e.msg="unknown compression method",n.mode=Sr;break}if(c>>>=4,l-=4,b=8+(15&c),0===n.wbits&&(n.wbits=b),b>15||b>n.wbits){e.msg="invalid window size",n.mode=Sr;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Er,c=0,l=0;break;case 16181:for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(n.flags=c,(255&n.flags)!==gr){e.msg="unknown compression method",n.mode=Sr;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Sr;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(x[0]=255&c,x[1]=c>>>8&255,n.check=Dt(n.check,x,2,0)),c=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(x[0]=255&c,x[1]=c>>>8&255,x[2]=c>>>16&255,x[3]=c>>>24&255,n.check=Dt(n.check,x,4,0)),c=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(x[0]=255&c,x[1]=c>>>8&255,n.check=Dt(n.check,x,2,0)),c=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(x[0]=255&c,x[1]=c>>>8&255,n.check=Dt(n.check,x,2,0)),c=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(f=n.length,f>o&&(f=o),f&&(n.head&&(b=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+f),b)),512&n.flags&&4&n.wrap&&(n.check=Dt(n.check,r,f,i)),o-=f,i+=f,n.length-=f),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;f=0;do{b=r[i+f++],n.head&&b&&n.length<65536&&(n.head.name+=String.fromCharCode(b))}while(b&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=Dt(n.check,r,f,i)),o-=f,i+=f,b)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;f=0;do{b=r[i+f++],n.head&&b&&n.length<65536&&(n.head.comment+=String.fromCharCode(b))}while(b&&f<o);if(512&n.flags&&4&n.wrap&&(n.check=Dt(n.check,r,f,i)),o-=f,i+=f,b)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Sr;break}c=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Er;break;case 16189:for(;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}e.adler=n.check=Ir(c),c=0,l=0,n.mode=kr;case kr:if(0===n.havedict)return e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=l,fr;e.adler=n.check=1,n.mode=Er;case Er:if(t===cr||t===lr)break e;case br:if(n.last){c>>>=7&l,l-=7&l,n.mode=Tr;break}for(;l<3;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}switch(n.last=1&c,c>>>=1,l-=1,3&c){case 0:n.mode=16193;break;case 1:if(Fr(n),n.mode=Cr,t===lr){c>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Sr}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Sr;break}if(n.length=65535&c,c=0,l=0,n.mode=wr,t===lr)break e;case wr:n.mode=16195;case 16195:if(f=n.length,f){if(f>o&&(f=o),f>u&&(f=u),0===f)break e;a.set(r.subarray(i,i+f),s),o-=f,i+=f,u-=f,s+=f,n.length-=f;break}n.mode=Er;break;case 16196:for(;l<14;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(n.nlen=257+(31&c),c>>>=5,l-=5,n.ndist=1+(31&c),c>>>=5,l-=5,n.ncode=4+(15&c),c>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Sr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.lens[I[n.have++]]=7&c,c>>>=3,l-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},w=or(0,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,w){e.msg="invalid code lengths set",n.mode=Sr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;C=n.lencode[c&(1<<n.lenbits)-1],_=C>>>24,m=C>>>16&255,g=65535&C,!(_<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(g<16)c>>>=_,l-=_,n.lens[n.have++]=g;else{if(16===g){for(S=_+2;l<S;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(c>>>=_,l-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=Sr;break}b=n.lens[n.have-1],f=3+(3&c),c>>>=2,l-=2}else if(17===g){for(S=_+3;l<S;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=_,l-=_,b=0,f=3+(7&c),c>>>=3,l-=3}else{for(S=_+7;l<S;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=_,l-=_,b=0,f=11+(127&c),c>>>=7,l-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Sr;break}for(;f--;)n.lens[n.have++]=b}}if(n.mode===Sr)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Sr;break}if(n.lenbits=9,T={bits:n.lenbits},w=or(1,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,w){e.msg="invalid literal/lengths set",n.mode=Sr;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},w=or(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,w){e.msg="invalid distances set",n.mode=Sr;break}if(n.mode=Cr,t===lr)break e;case Cr:n.mode=xr;case xr:if(o>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=l,tr(e,h),s=e.next_out,a=e.output,u=e.avail_out,i=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,n.mode===Er&&(n.back=-1);break}for(n.back=0;C=n.lencode[c&(1<<n.lenbits)-1],_=C>>>24,m=C>>>16&255,g=65535&C,!(_<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(m&&0==(240&m)){for(y=_,k=m,E=g;C=n.lencode[E+((c&(1<<y+k)-1)>>y)],_=C>>>24,m=C>>>16&255,g=65535&C,!(y+_<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=y,l-=y,n.back+=y}if(c>>>=_,l-=_,n.back+=_,n.length=g,0===m){n.mode=16205;break}if(32&m){n.back=-1,n.mode=Er;break}if(64&m){e.msg="invalid literal/length code",n.mode=Sr;break}n.extra=15&m,n.mode=16201;case 16201:if(n.extra){for(S=n.extra;l<S;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;C=n.distcode[c&(1<<n.distbits)-1],_=C>>>24,m=C>>>16&255,g=65535&C,!(_<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(0==(240&m)){for(y=_,k=m,E=g;C=n.distcode[E+((c&(1<<y+k)-1)>>y)],_=C>>>24,m=C>>>16&255,g=65535&C,!(y+_<=l);){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}c>>>=y,l-=y,n.back+=y}if(c>>>=_,l-=_,n.back+=_,64&m){e.msg="invalid distance code",n.mode=Sr;break}n.offset=g,n.extra=15&m,n.mode=16203;case 16203:if(n.extra){for(S=n.extra;l<S;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Sr;break}n.mode=16204;case 16204:if(0===u)break e;if(f=h-u,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Sr;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=a,p=s-n.offset,f=n.length;f>u&&(f=u),u-=f,n.length-=f;do{a[s++]=v[p++]}while(--f);0===n.length&&(n.mode=xr);break;case 16205:if(0===u)break e;a[s++]=n.length,u--,n.mode=xr;break;case Tr:if(n.wrap){for(;l<32;){if(0===o)break e;o--,c|=r[i++]<<l,l+=8}if(h-=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?Dt(n.check,a,h,s-h):Ot(n.check,a,h,s-h)),h=u,4&n.wrap&&(n.flags?c:Ir(c))!==n.check){e.msg="incorrect data check",n.mode=Sr;break}c=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===o)break e;o--,c+=r[i++]<<l,l+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Sr;break}c=0,l=0}n.mode=16208;case 16208:w=hr;break e;case Sr:w=vr;break e;case 16210:return _r;default:return pr}return e.next_out=s,e.avail_out=u,e.next_in=i,e.avail_in=o,n.hold=c,n.bits=l,(n.wsize||h!==e.avail_out&&n.mode<Sr&&(n.mode<Tr||t!==ur))&&Hr(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?Dt(n.check,a,h,e.next_out-h):Ot(n.check,a,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Er?128:0)+(n.mode===Cr||n.mode===wr?256:0),(0===d&&0===h||t===ur)&&w===dr&&(w=mr),w},inflateEnd:e=>{if(Ar(e))return pr;let t=e.state;return t.window&&(t.window=null),e.state=null,dr},inflateGetHeader:(e,t)=>{if(Ar(e))return pr;const n=e.state;return 0==(2&n.wrap)?pr:(n.head=t,t.done=!1,dr)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,a,i;return Ar(e)?pr:(r=e.state,0!==r.wrap&&r.mode!==kr?pr:r.mode===kr&&(a=1,a=Ot(a,t,n,0),a!==r.check)?vr:(i=Hr(e,t,n,n),i?(r.mode=16210,_r):(r.havedict=1,dr)))},inflateInfo:"pako inflate (from Nodeca project)"};var Gr=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const jr=Object.prototype.toString,{Z_NO_FLUSH:zr,Z_FINISH:Vr,Z_OK:Br,Z_STREAM_END:Qr,Z_NEED_DICT:Kr,Z_STREAM_ERROR:Wr,Z_DATA_ERROR:Yr,Z_MEM_ERROR:Zr}=Rt;function Jr(e){this.options=Rn.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qn,this.strm.avail_out=0;let n=qr.inflateInit2(this.strm,t.windowBits);if(n!==Br)throw new Error(Lt[n]);if(this.header=new Gr,qr.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Hn.string2buf(t.dictionary):"[object ArrayBuffer]"===jr.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=qr.inflateSetDictionary(this.strm,t.dictionary),n!==Br)))throw new Error(Lt[n])}function Xr(e,t){const n=new Jr(t);if(n.push(e),n.err)throw n.msg||Lt[n.err];return n.result}Jr.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,a=this.options.dictionary;let i,s,o;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Vr:zr,"[object ArrayBuffer]"===jr.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=qr.inflate(n,s),i===Kr&&a&&(i=qr.inflateSetDictionary(n,a),i===Br?i=qr.inflate(n,s):i===Yr&&(i=Kr));n.avail_in>0&&i===Qr&&n.state.wrap>0&&0!==e[n.next_in];)qr.inflateReset(n),i=qr.inflate(n,s);switch(i){case Wr:case Yr:case Kr:case Zr:return this.onEnd(i),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||i===Qr))if("string"===this.options.to){let e=Hn.utf8border(n.output,n.next_out),t=n.next_out-e,a=Hn.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(a)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==Br||0!==o){if(i===Qr)return i=qr.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},Jr.prototype.onData=function(e){this.chunks.push(e)},Jr.prototype.onEnd=function(e){e===Br&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Rn.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var $r={Inflate:Jr,inflate:Xr,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Xr(e,t)},ungzip:Xr,constants:Rt};const{Deflate:ea,deflate:ta,deflateRaw:na,gzip:ra}=$n,{Inflate:aa,inflate:ia,inflateRaw:sa,ungzip:oa}=$r;var ua,ca={Deflate:ea,deflate:ta,deflateRaw:na,gzip:ra,Inflate:aa,inflate:ia,inflateRaw:sa,ungzip:oa,constants:Rt},la=function(e){return E(void 0,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=ca.ungzip(e),t.abrupt("return",String.fromCharCode.apply(null,r));case 2:case"end":return t.stop()}}),n)})))};e.ConnectionState=void 0,(ua=e.ConnectionState||(e.ConnectionState={})).CONNECTING="CONNECTING",ua.OPEN="OPEN",ua.CLOSED="CLOSED";var da,ha=function(n){s(o,n);var a=f(o);function o(e,t){var n,i=t.sdkState,s=t.dispatcher,u=t.logger;return r(this,o),(n=a.call(this)).lastActive=0,n._iid=e,n._sdkState=i,n._dispatcher=s,n._logger=u,n}return i(o,[{key:"isOpen",get:function(){return this.connectionState===e.ConnectionState.OPEN}},{key:"connectionState",get:function(){if(this._ws)switch(this._ws.readyState){case 0:return e.ConnectionState.CONNECTING;case 1:return e.ConnectionState.OPEN}return e.ConnectionState.CLOSED}},{key:"ws",get:function(){var e;return null!==(e=this._ws)&&void 0!==e?e:null}},{key:"_handleMessage",value:function(e){var t=this;e.split("\n").forEach((function(e){if(e){var n=Qe.createFromRawMessage(t._iid,e);if(t._logger.debug("receive websocket event",n),"LOGI"===n.code)t.dispatch("message",n);else if("PONG"===n.code)t.dispatch("pong");else if("EXPR"===n.code){if(n.payload){var r=new Re(n.payload);r.expiresIn>=0&&t._dispatcher.dispatch(r)}}else"NOOP"===n.code||t.dispatch("message",n)}}))}},{key:"connect",value:function(e){var n=this;this._ws=new WebSocket(e),this._ws.onopen=function(){n._logger.debug("websocket open"),n.dispatch("open")},this._ws.onmessage=function(e){return E(n,void 0,void 0,t().mark((function n(){var r,a,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(null===(r=this._sdkState.websocket)||void 0===r?void 0:r.compression)?e.data instanceof Blob?((a=new FileReader).readAsArrayBuffer(e.data),a.onloadend=function(){return E(i,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,la(a.result);case 2:n=e.sent,this._handleMessage(n);case 4:case"end":return e.stop()}}),e,this)})))}):"string"==typeof e.data&&this._handleMessage(e.data):this._handleMessage(e.data);case 1:case"end":return n.stop()}}),n,this)})))},this._ws.onerror=function(){n._logger.debug("websocket error"),n.dispatch("error",M.networkError)},this._ws.onclose=function(){n._logger.debug("websocket close"),n.dispatch("close")},this.lastActive=Date.now()}},{key:"disconnect",value:function(){var t=this;return new Promise((function(n){t._logger.debug("websocket disconnect"),t._ws&&t.connectionState!==e.ConnectionState.CLOSED?(t._ws.onopen=Ke,t._ws.onmessage=Ke,t._ws.onerror=Ke,t._ws.onclose=function(){t.dispatch("close"),n()},t._ws.close(),t._ws=void 0):n()}))}},{key:"send",value:function(e){if(!this._ws)throw M.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())}},{key:"error",value:function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)}}]),o}(se),fa=function(e){s(n,e);var t=f(n);function n(e){var a,i,s=e.code,o=e.ackRequired,u=e.payload,c=void 0===u?{}:u;return r(this,n),(a=t.call(this)).code=s,a.payload=c,a.requestId=null!==(i=a.payload.req_id)&&void 0!==i?i:ae(),a.ackRequired=o,a.payload.req_id=a.requestId,a}return i(n,[{key:"convertToMessage",value:function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")}}]),n}(ue),pa=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.all,s=e.feed,o=e.custom_types,u=e.ts;return r(this,n),(a=t.call(this)).all=i,a.feed=s,a.customTypes=o,a.ts=u,a}return i(n)}(ue),va=i((function e(){var t=this;r(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),_a=function(){function e(t,n){var a=this,i=n.auth,s=n.sdkState,o=n.dispatcher,u=n.logger,c=n.useFetchCompat,l=void 0!==c&&c;r(this,e),this._ackStateMap=new Map,this._sdkState=s,this._dispatcher=o,this._logger=u,this.apiClient=new Be(t,{auth:i,sdkState:s,dispatcher:o,logger:u,useFetchCompat:l}),this.websocketClient=new ha(t,{sdkState:s,dispatcher:o,logger:u}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new pa(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new M({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(M.connectionClosed)})),a._ackStateMap.clear()}))}return i(e,[{key:"_sendApiRequest",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.apiClient.send(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"_sendWebsocketRequest",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._sdkState.websocket){t.next=2;break}throw M.connectionRequired;case 2:if(r=new va,e.ackRequired){i=function(t,n){s._ackStateMap.has(e.requestId)&&(s._ackStateMap.delete(e.requestId),a&&(clearTimeout(a),a=null),t?(s._logger.debug("fail websocket request",t),r.reject(t)):(s._logger.debug("receive websocket ack",e.requestId),r.resolve(n)))};try{a=setTimeout((function(){return i(M.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return i(void 0,e)},reject:function(e){return i(e)}}),this.websocketClient.send(e)}catch(e){i(e)}}else try{this.websocketClient.send(e),r.resolve()}catch(e){r.reject(e)}return t.abrupt("return",r.promise);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"send",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Ue)){t.next=6;break}return t.next=3,this._sendApiRequest(e);case 3:case 9:return t.abrupt("return",t.sent);case 6:if(!(e instanceof fa)){t.next=10;break}return t.next=9,this._sendWebsocketRequest(e);case 10:throw M.invalidParameters;case 11:case"end":return t.stop()}}),n,this)})))}},{key:"cancel",value:function(e){this.apiClient.cancel(e)}},{key:"cancelAll",value:function(){this.apiClient.cancelAll()}}]),e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",e[e.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",e[e.LOGOUT=7]="LOGOUT"}(da||(da={}));var ma,ga=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.stateType;return r(this,n),(a=t.call(this)).stateType=i,a}return i(n)}(ue),ya=function(){function e(n,a){var i=this,s=a.auth,o=a.sdkState,u=a.dispatcher,c=a.logger,l=a.useFetchCompat,d=void 0!==l&&l;r(this,e),this._currentConnectionStateType=da.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new _a(n,{auth:s,sdkState:o,dispatcher:u,logger:c,useFetchCompat:d}),this._auth=s,this._logger=c,this._dispatcher=u,this._dispatcher.on((function(e){if(e instanceof ga){var n=e.stateType;switch(i._currentConnectionStateType=n,n){case da.CONNECTED:var r=i._lazyCallQueue;i._lazyCallQueue=[],r.forEach((function(e){return E(i,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.command,a=e.deferred,i=e.timeout,clearTimeout(i),t.prev=2,t.next=5,this.send(r);case 5:s=t.sent,a.resolve(s),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),a.reject(t.t0);case 12:case"end":return t.stop()}}),n,this,[[2,9]])})))}));break;case da.INITIALIZED:case da.INTERNAL_DISCONNECTED:case da.EXTERNAL_DISCONNECTED:case da.LOGOUT:var a=i._lazyCallQueue;i._lazyCallQueue=[],a.forEach((function(e){return E(i,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.deferred,a=e.timeout,clearTimeout(a),this._auth&&this._auth.hasSession?r.reject(M.connectionClosed):r.reject(M.connectionRequired);case 3:case"end":return t.stop()}}),n,this)})))}))}}}))}return i(e,[{key:"isReady",get:function(){return this._currentConnectionStateType===da.CONNECTED}},{key:"isLazyCallActivated",get:function(){return this._currentConnectionStateType===da.CONNECTING||this._currentConnectionStateType===da.RECONNECTING}},{key:"send",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof fa)){t.next=19;break}if(!this.isReady){t.next=8;break}return this._logger.debug("send websocket request",e),t.next=5,this.commandRouter.send(e);case 5:case 24:return t.abrupt("return",t.sent);case 8:if(!this.isLazyCallActivated){t.next=15;break}return this._logger.debug("wait websocket request",e),r=new va,this._lazyCallQueue.push({command:e,deferred:r,timeout:setTimeout((function(){return s.timeout(e.requestId)}),1e4)}),t.abrupt("return",r.promise);case 15:throw this._logger.debug("fail websocket request"),M.connectionRequired;case 17:case 37:t.next=40;break;case 19:if(!(e instanceof Ue)){t.next=39;break}if(!this._auth.hasSession){t.next=27;break}return this._logger.debug("send api request",e),t.next=24,this.commandRouter.send(e);case 27:if(!this.isLazyCallActivated){t.next=34;break}return this._logger.debug("wait api request",e),a=new va,this._lazyCallQueue.push({command:e,deferred:a,timeout:setTimeout((function(){return s.timeout(e.requestId)}),1e4)}),t.abrupt("return",a.promise);case 34:throw i=M.connectionRequired,this._logger.debug("fail api request",i),i;case 39:throw M.invalidCommand;case 40:case"end":return t.stop()}}),n,this)})))}},{key:"forceSend",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.debug("send forced request",e),!(e instanceof fa||e instanceof Ue)){t.next=7;break}return t.next=4,this.commandRouter.send(e);case 4:return t.abrupt("return",t.sent);case 7:throw M.invalidCommand;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"timeout",value:function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(M.connectionRequired),this._lazyCallQueue.splice(t,1))}},{key:"cancel",value:function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)}},{key:"cancelAll",value:function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()}}]),e}(),ka="sendbird@devicetokens",Ea=function(){function e(t){var n=t.type,a=t.token;r(this,e),this.type=n,this.token=a}return i(e,null,[{key:"payloadify",value:function(e){return ce(le({type:e.type,token:e.token}))}}]),e}(),ba=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.authToken,o=e.expiringSession,u=void 0===o||o;return r(this,n),(a=t.call(this)).path="".concat(fe,"/").concat(i,"/session_key"),a.method=de.POST,a.params={token:s,expiring_session:!!u},a.requireAuth=!1,a}return i(n)}(Ue),wa=function(e){s(n,e);var t=f(n);function n(e){var a=e.authToken,i=e.expiringSession,s=void 0===i||i,o=e.requestId,u=void 0===o?"":o;return r(this,n),t.call(this,{code:"LOGI",payload:{token:a,expiring_session:s?1:0,req_id:u},ackRequired:!0})}return i(n)}(fa),Ca=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.key;return i.key=s,i}return i(n)}(De),xa=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o;return r(this,n),(s=t.call(this,e,"LOGI",i)).error=null,s.newKey=null,s.newKey=null!==(o=i.new_key)&&void 0!==o?o:null,s.error=i.error?new M(i.error):null,s}return i(n)}(Qe),Ta=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n)}(ue),Sa=function(e){return E(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),n)})))},Ia=function(){function e(){r(this,e)}return i(e,[{key:"calcTimeout",value:function(){return 0}}]),e}(),Na=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ia;return E(void 0,void 0,void 0,t().mark((function a(){var i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=0,s=null,o=function(e){return s=null!=e?e:new Error("Halted")},u=function(){i=0};case 4:if(!(-1===n||i<n)){t.next=29;break}return t.prev=5,t.next=8,e(o,u);case 8:if(c=t.sent,s){t.next=13;break}return t.abrupt("return",c);case 13:throw s;case 14:t.next=27;break;case 16:if(t.prev=16,t.t0=t.catch(5),s){t.next=26;break}if(++i!==n){t.next=22;break}throw t.t0;case 22:return t.next=24,Sa(r.calcTimeout(i));case 24:t.next=27;break;case 26:throw s;case 27:t.next=4;break;case 29:throw"It should not happen.";case 30:case"end":return t.stop()}}),a,null,[[5,16]])})))},Aa=function(e){return E(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=12;break;case 5:if(t.prev=5,t.t0=t.catch(0),!(t.t0 instanceof M)){t.next=11;break}t.t0.throwOutside(),t.next=12;break;case 11:throw t.t0;case 12:case"end":return t.stop()}}),n,null,[[0,5]])})))},Ma=function(e){return E(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),n,null,[[0,5]])})))},Oa=new WeakMap,Ua=function(e){s(a,e);var n=f(a);function a(e){var t,i=e.auth,s=e.cacheContext,o=e.sdkState,u=e.dispatcher,c=e.requestQueue,l=e.logger;return r(this,a),(t=n.call(this))._currentConnectionStateType=da.INITIALIZED,t._isRefreshingAuthToken=!1,t._isRefreshingSessionKey=!1,t.currentUser=null,t.auth=i,t._cacheContext=s,t._sdkState=o,t._dispatcher=u,t._requestQueue=c,t._logger=l,t._deviceTokens=[],t._dispatcher.on((function(e){var n;if(e instanceof ga){var r=e.stateType;t._currentConnectionStateType=r}else e instanceof Re&&t.handler&&(e.invalidateSessionToken&&(t.auth.authToken=void 0),e.error&&(e.error.isSessionKeyExpiredError||e.error.isSessionTokenExpiredError)&&(t._logger.debug("session expired"),(null===(n=t.handler)||void 0===n?void 0:n.onSessionExpired)&&t.handler.onSessionExpired(),t.refresh()))})),t}return i(a,[{key:"ekey",get:function(){return Oa.get(this)}},{key:"deviceTokens",get:function(){return this._deviceTokens}},{key:"deviceTokenLastDeletedAt",get:function(){return this._deviceTokenLastDeletedAt}},{key:"indexOfDeviceToken",value:function(e,t){return this._deviceTokens.findIndex((function(n){return n.type===e&&n.token===t}))}},{key:"hasDeviceToken",value:function(e,t){return this.indexOfDeviceToken(e,t)>=0}},{key:"createRefreshWebsocketCommand",value:function(e,t){return new wa({authToken:e,expiringSession:!0,requestId:t})}},{key:"_refreshSessionKeyByWebSocket",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.createRefreshWebsocketCommand(e),t.next=3,this._requestQueue.forceSend(r);case 3:if(a=t.sent,i=a.as(xa),s=i.newKey,!(o=i.error)){t.next=7;break}throw o;case 7:this.auth.sessionKey=null!=s?s:this.auth.sessionKey;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"_refreshSessionKeyByApi",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new ba({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),n.next=3,Na((function(e){return E(a,void 0,void 0,t().mark((function n(){var a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._requestQueue.forceSend(r);case 3:a=t.sent,i=a.as(Ca),s=i.key,this.auth.sessionKey=s,t.next=15;break;case 8:if(t.prev=8,t.t0=t.catch(0),!this._isSessionRelatedError(t.t0)){t.next=14;break}e(t.t0),t.next=15;break;case 14:throw t.t0;case 15:case"end":return t.stop()}}),n,this,[[0,8]])})))}),3);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"_refreshSessionKey",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._currentConnectionStateType!==da.CONNECTED){t.next=26;break}return t.prev=1,t.next=4,this._refreshSessionKeyByWebSocket(e);case 4:return this.complete(),t.abrupt("return");case 8:if(t.prev=8,t.t0=t.catch(1),!this._isSessionRelatedError(t.t0)){t.next=26;break}if(!n){t.next=26;break}return t.next=14,this._receiveNewAuthToken();case 14:if(!(a=t.sent)){t.next=22;break}return this.auth.authToken=a,t.next=19,this._refreshSessionKey(this.auth.authToken,!1);case 19:this.complete(),t.next=25;break;case 22:return t.next=24,this.clear();case 24:this.close();case 25:return t.abrupt("return");case 26:return t.prev=26,t.next=29,this._refreshSessionKeyByApi(e);case 29:this.complete(),t.next=55;break;case 32:if(t.prev=32,t.t1=t.catch(26),!this._isSessionRelatedError(t.t1)){t.next=54;break}if(!n){t.next=51;break}return t.next=38,this._receiveNewAuthToken();case 38:if(!(i=t.sent)){t.next=46;break}return this.auth.authToken=i,t.next=43,this._refreshSessionKeyByApi(this.auth.authToken);case 43:this.complete(),t.next=49;break;case 46:return t.next=48,this.clear();case 48:this.close();case 49:t.next=52;break;case 51:throw t.t1;case 52:t.next=55;break;case 54:throw t.t1;case 55:case"end":return t.stop()}}),r,this,[[1,8],[26,32]])})))}},{key:"_receiveNewAuthToken",value:function(){var e=this,n=new va;return Aa((function(){return E(e,void 0,void 0,t().mark((function e(){var r,a,i,s,o=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._isRefreshingAuthToken=!0,this.auth.clear(),this.handler.onSessionTokenRequired?(r=null,a=function(){r&&(clearTimeout(r),r=null)},i=function(e){a(),o._isRefreshingAuthToken&&(o._isRefreshingAuthToken=!1,o.dispatch("refresh-authtoken"),n.resolve(e))},s=function(e){a(),o._isRefreshingAuthToken&&(o._isRefreshingAuthToken=!1,n.reject(e))},r=setTimeout((function(){return s()}),1e3*this._sdkState.sessionTokenRefreshTimeout),this.handler.onSessionTokenRequired(i,s)):n.resolve(null);case 3:case"end":return e.stop()}}),e,this)})))})),n.promise}},{key:"_isSessionRelatedError",value:function(e){return e instanceof M&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError||e.isSessionRevokedError)}},{key:"isSessionKeyRefreshing",get:function(){return this._isRefreshingSessionKey}},{key:"isRefreshingAuthToken",get:function(){return this._isRefreshingAuthToken}},{key:"login",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.key,i=e.ekey,s=e.userProfile,o=e.deviceTokenLastDeletedAt,u=void 0===o?0:o,this.auth.sessionKey=a,Oa.set(this,i),this._deviceTokenCacheEnabled=null===(n=null==s?void 0:s.appInfo)||void 0===n?void 0:n.deviceTokenCache,c=this._cacheContext.preference,!this._deviceTokenCacheEnabled){t.next=20;break}return t.next=8,c.get(ka);case 8:if((l=t.sent)&&!(l.lastDeletedAt<u)){t.next=16;break}return this._deviceTokens=[],this._deviceTokenLastDeletedAt=u,t.next=14,this.saveDeviceToken();case 14:t.next=18;break;case 16:this._deviceTokens=l.tokens.map((function(e){return new Ea(Ea.payloadify(e))})),this._deviceTokenLastDeletedAt=l.lastDeletedAt;case 18:t.next=22;break;case 20:return t.next=22,c.remove(ka);case 22:case"end":return t.stop()}}),r,this)})))}},{key:"complete",value:function(){var e=this;this.dispatch("refresh"),Aa((function(){return E(e,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.debug("session refreshed"),(null===(n=this.handler)||void 0===n?void 0:n.onSessionRefreshed)&&this.handler.onSessionRefreshed();case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"error",value:function(e){var n=this;Aa((function(){return E(n,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(null===(r=this.handler)||void 0===r?void 0:r.onSessionError)&&this.handler.onSessionError(e);case 1:case"end":return t.stop()}}),n,this)})))}))}},{key:"close",value:function(){var e=this;this.dispatch("close"),Aa((function(){return E(e,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.debug("session closed"),(null===(n=this.handler)||void 0===n?void 0:n.onSessionClosed)&&this.handler.onSessionClosed();case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"refresh",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.handler){e.next=39;break}if(this._isRefreshingSessionKey){e.next=39;break}if(this._isRefreshingSessionKey=!0,this.auth.authToken){e.next=26;break}return e.prev=4,e.next=7,this._receiveNewAuthToken();case 7:if(!(n=e.sent)){e.next=13;break}this._logger.debug("session refreshing.."),this.auth.authToken=n,e.next=17;break;case 13:return e.next=15,this.clear();case 15:return this._isRefreshingSessionKey=!1,e.abrupt("return");case 17:e.next=26;break;case 19:throw e.prev=19,e.t0=e.catch(4),r=M.sessionTokenRequestFailed,this._dispatcher.dispatch(new Ta),this.error(r),this._isRefreshingSessionKey=!1,r;case 26:return e.prev=26,e.next=29,this._refreshSessionKey(this.auth.authToken);case 29:this._isRefreshingSessionKey=!1,e.next=39;break;case 32:throw e.prev=32,e.t1=e.catch(26),a=M.sessionTokenRefreshFailed,this._dispatcher.dispatch(new Ta),this.error(a),this._isRefreshingSessionKey=!1,a;case 39:case"end":return e.stop()}}),e,this,[[4,19],[26,32]])})))}},{key:"setDeviceToken",value:function(e,t){if(this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,t)<0)return this._deviceTokens.push(new Ea({type:e,token:t})),!0;return!1}},{key:"unsetDeviceToken",value:function(e,t){if(this._deviceTokenCacheEnabled){var n=this.indexOfDeviceToken(e,t);n>=0&&this._deviceTokens.splice(n,1)}}},{key:"unsetDeviceTokens",value:function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter((function(t){return t.type!==e})):[])}},{key:"setDeviceTokenDeletedAt",value:function(e){e>0&&(this._deviceTokenLastDeletedAt=e)}},{key:"saveDeviceToken",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._deviceTokenCacheEnabled){e.next=4;break}return n=this._cacheContext.preference,e.next=4,n.set(ka,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentUser=null,this.auth.clear(),this.close(),Oa.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,e.next=8,this.saveDeviceToken();case 8:case"end":return e.stop()}}),e,this)})))}}]),a}(se),Da=function(){function e(){r(this,e),this.type=da.NONE,this.name="none"}return i(e,[{key:"run",value:function(e){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onConnect",value:function(e,n){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onReconnect",value:function(e,n){return n.resetReconnectCount,E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onDisconnect",value:function(e,n){return n.error,n.autoReconnect,E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}}]),e}(),La=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=da.LOGOUT,e.name="logout",e}return i(a,[{key:"run",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),a=e.sdkState.userId,n.next=4,e.logout();case 4:return n.next=6,e.changeState(new Ga,r);case 6:Aa((function(){return E(i,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.connectionHandlers.forEach((function(e){e.onDisconnected&&e.onDisconnected(a)}));case 1:case"end":return t.stop()}}),n)})))}));case 7:case"end":return n.stop()}}),n)})))}}]),a}(Da),Ra=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.call(this)).type=da.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return i(a,[{key:"run",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.disconnect();case 2:case"end":return t.stop()}}),n)})))}},{key:"onConnect",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new qa({authToken:n}),a);case 5:case"end":return t.stop()}}),r)})))}},{key:"onReconnect",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new Fa,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new La,r);case 3:case"end":return t.stop()}}),n)})))}}]),a}(Da),Pa=function(e){s(a,e);var n=f(a);function a(e){var t,i=e.autoReconnect;return r(this,a),(t=n.call(this)).type=da.INTERNAL_DISCONNECTED,t.name="internaldisconnected",t._autoReconnect=!1,t._autoReconnect=i,t}return i(a,[{key:"run",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.disconnect();case 3:if(!this._autoReconnect){t.next=6;break}return t.next=6,e.changeState(new Fa,r);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"onConnect",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new qa({authToken:n}),a);case 5:case"end":return t.stop()}}),r)})))}},{key:"onReconnect",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new Fa,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new Ra,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new La,r);case 3:case"end":return t.stop()}}),n)})))}}]),a}(Da),Fa=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=da.RECONNECTING,e.name="reconnecting",e._callbacks=[],e}return i(a,[{key:"_halt",value:function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)}},{key:"_flushCallbacks",value:function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach((function(t){return t(e)}))}},{key:"run",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),a=new va,this._callbacks.push((function(e){return e?a.reject(e):a.resolve()})),Aa((function(){return E(u,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.connectionHandlers.forEach((function(e){e.onReconnectStarted&&e.onReconnectStarted()}));case 1:case"end":return t.stop()}}),n)})))})),n.prev=4,i=e.sdkState.websocket,s=i.reconnectMaxRetry,o=i.reconnectRetryStrategy,n.next=8,Na((function(n,r){return E(u,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._haltConnect=n,this._resetConnect=r,t.prev=2,t.next=5,e.connect();case 5:t.next=17;break;case 7:if(t.prev=7,t.t0=t.catch(2),e.clearLoginTimer(),!(t.t0 instanceof M)){t.next=16;break}t.t1=t.t0.code,t.next=t.t1===b.CONNECTION_CANCELED?14:16;break;case 14:return n(t.t0),t.abrupt("return");case 16:throw t.t0;case 17:case"end":return t.stop()}}),a,this,[[2,7]])})))}),s,o);case 8:return n.next=10,e.changeState(new Ha,r);case 10:Aa((function(){return E(u,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(),e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded&&e.onReconnectSucceeded()}));case 2:case"end":return t.stop()}}),n,this)})))})),n.next=24;break;case 13:if(n.prev=13,n.t0=n.catch(4),A(n.t0)){n.next=23;break}if(!(n.t0 instanceof M)){n.next=20;break}if(n.t0.code===b.CONNECTION_CANCELED){n.next=20;break}return n.next=20,e.changeState(new Pa({autoReconnect:!1}),r);case 20:Aa((function(){return E(u,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(n.t0),e.connectionHandlers.forEach((function(e){e.onReconnectFailed&&e.onReconnectFailed()}));case 2:case"end":return t.stop()}}),r,this)})))})),n.next=24;break;case 23:throw n.t0;case 24:return n.abrupt("return",a.promise);case 25:case"end":return n.stop()}}),n,this,[[4,13]])})))}},{key:"onConnect",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new va,this._halt(M.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var t=Date.now();e.changeState(new qa({authToken:n}),t).then((function(){a.resolve()})).catch((function(e){a.reject(e)}))})),t.abrupt("return",a.promise);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"onReconnect",value:function(e,n){var r=n.resetReconnectCount,a=void 0!==r&&r;return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new va,this._resetConnect&&a&&this._resetConnect(),this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),e.abrupt("return",n.promise);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"onDisconnect",value:function(e,n){n.error;var r=n.autoReconnect,a=void 0===r||r;return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(M.connectionCanceled),t.next=4,e.changeState(new Pa({autoReconnect:a}),r);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(M.connectionCanceled),t.next=4,e.changeState(new Ra,r);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(M.connectionCanceled),t.next=4,e.changeState(new La,r);case 4:case"end":return t.stop()}}),n,this)})))}}]),a}(Da),Ha=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=da.CONNECTED,e.name="connected",e}return i(a,[{key:"onReconnect",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new Fa,r);case 5:case"end":return t.stop()}}),n)})))}},{key:"onDisconnect",value:function(e,n){var r=n.autoReconnect;return E(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.changeState(new Pa({autoReconnect:r}),a);case 3:case"end":return t.stop()}}),n)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new Ra,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new La,r);case 3:case"end":return t.stop()}}),n)})))}}]),a}(Da),qa=function(e){s(a,e);var n=f(a);function a(e){var t,i=e.authToken;return r(this,a),(t=n.call(this)).type=da.CONNECTING,t.name="connecting",t._authToken="",t._callbacks=[],t._authToken=i,t}return i(a,[{key:"_halt",value:function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)}},{key:"_flushCallbacks",value:function(e){this._haltConnect=void 0,this._callbacks.forEach((function(t){return t(e)}))}},{key:"run",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),a=new va,this._callbacks.push((function(e){return e?a.reject(e):a.resolve()})),n.prev=3,n.next=6,Na((function(n){return E(i,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._haltConnect=n,t.prev=1,t.next=4,e.connect(this._authToken);case 4:t.next=16;break;case 6:if(t.prev=6,t.t0=t.catch(1),e.clearLoginTimer(),!(t.t0 instanceof M)){t.next=15;break}t.t1=t.t0.code,t.next=t.t1===b.CONNECTION_CANCELED?13:15;break;case 13:return n(t.t0),t.abrupt("return");case 15:throw t.t0;case 16:case"end":return t.stop()}}),r,this,[[1,6]])})))}),e.sdkState.websocket.connectMaxRetry);case 6:return n.next=8,e.changeState(new Ha,r);case 8:Aa((function(){return E(i,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(),e.connectionHandlers.forEach((function(t){t.onConnected&&t.onConnected(e.sdkState.userId)}));case 2:case"end":return t.stop()}}),n,this)})))})),n.next=24;break;case 11:if(n.prev=11,n.t0=n.catch(3),A(n.t0)){n.next=23;break}return n.next=16,e.disconnect();case 16:if(!(n.t0 instanceof M)){n.next=20;break}if(n.t0.code===b.CONNECTION_CANCELED){n.next=20;break}return n.next=20,e.changeState(new Ga,r);case 20:Aa((function(){return E(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._flushCallbacks(n.t0);case 1:case"end":return e.stop()}}),e,this)})))})),n.next=24;break;case 23:throw n.t0;case 24:return n.abrupt("return",a.promise);case 25:case"end":return n.stop()}}),n,this,[[3,11]])})))}},{key:"onConnect",value:function(e){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new va,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),e.abrupt("return",n.promise);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"onDisconnect",value:function(e,n){var r=n.error,a=void 0===r?null:r,i=n.autoReconnect,s=void 0!==i&&i;return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Date.now(),this._halt(null!=a?a:M.connectionCanceled),!e.hasSession){t.next=7;break}return t.next=5,e.changeState(new Pa({autoReconnect:s}),r);case 5:t.next=9;break;case 7:return t.next=9,e.changeState(new La,r);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"onDisconnectWebSocket",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Date.now(),this._halt(M.connectionCanceled),!e.hasSession){t.next=7;break}return t.next=5,e.changeState(new Ra,r);case 5:t.next=9;break;case 7:return t.next=9,e.changeState(new La,r);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"onLogout",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(M.connectionCanceled),t.next=4,e.changeState(new La,r);case 4:case"end":return t.stop()}}),n,this)})))}}]),a}(Da),Ga=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=da.INITIALIZED,e.name="initialized",e}return i(a,[{key:"onConnect",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.changeState(new qa({authToken:n}),a);case 3:case"end":return t.stop()}}),r)})))}}]),a}(Da),ja=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})}return i(n)}(fa),za=function(){function e(t){var n=t.pingDelegate,a=t.sdkState,i=t.logger;r(this,e),this.pingDelegate=n,this.sdkState=a,this._logger=i}return i(e,[{key:"isWaiting",get:function(){return!!this._pingTimeoutTimer}},{key:"ping",value:function(){var e,t=this;if(!this.sdkState.websocket)throw M.connectionRequired;var n=new ja;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error()}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return n}},{key:"pong",value:function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)}},{key:"refreshTimer",value:function(){var e,t=this;if(!this.sdkState.websocket)throw M.connectionRequired;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)}},{key:"start",value:function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()}},{key:"stop",value:function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)}}]),e}(),Va=function(){function e(t){var n,a,i,s;r(this,e),this.isEnabled=null!==(n=t.enabled)&&void 0!==n&&n,this.feedChannels=null!==(a=t.feed_channels)&&void 0!==a?a:{},this.templateListToken=null!==(i=t.template_list_token)&&void 0!==i?i:null,this.settingsUpdatedAt=null!==(s=t.settings_updated_at)&&void 0!==s?s:0}return i(e,null,[{key:"payloadify",value:function(e){return ce(le({enabled:e.isEnabled,feed_channels:e.feedChannels,template_list_token:e.templateListToken,settings_updated_at:e.settingsUpdatedAt}))}}]),e}(),Ba=function(e){return"sendbird@".concat(e,"/changelog_include_chat_notifications")},Qa=function(){function e(t){var n;r(this,e),this.lastUpdatedAt=null!==(n=t.last_updated_at)&&void 0!==n?n:0}return i(e,null,[{key:"payloadify",value:function(e){return ce(le({last_updated_at:e.lastUpdatedAt}))}}]),e}(),Ka=1048576,Wa=function(){function e(){var t,n,a,i,s,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.emojiHash=o.emoji_hash||"",this.uploadSizeLimit=o.file_upload_size_limit?o.file_upload_size_limit*Ka:Number.MAX_SAFE_INTEGER,this.useReaction=!!o.use_reaction,this.applicationAttributes=null!==(t=o.application_attributes)&&void 0!==t?t:[],this.premiumFeatureList=null!==(n=o.premium_feature_list)&&void 0!==n?n:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=null!==(a=o.multiple_file_send_max_size)&&void 0!==a?a:5,this.allowSdkStatsUpload=null===(i=o.allow_sdk_log_ingestion)||void 0===i||i,this.uikitConfigInfo=new Qa(null!==(s=o.uikit_config)&&void 0!==s?s:{}),this.notificationInfo=o.notifications?new Va(o.notifications):null}return i(e,null,[{key:"payloadify",value:function(e){return ce(le({emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/Ka,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction,allow_sdk_log_ingestion:e.allowSdkStatsUpload,uikit_config:e.uikitConfigInfo?Qa.payloadify(e.uikitConfigInfo):null,notifications:e.notificationInfo?Va.payloadify(e.notificationInfo):null}))}}]),e}(),Ya=function(){function e(t){r(this,e),this._iid="",this._iid=t}return i(e,null,[{key:"payloadify",value:function(e){return{}}}]),e}(),Za=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.metadata;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(fe,"/").concat(i,"/metadata"),a.params={metadata:s},a}return i(n)}(Ue),Ja=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).metaData=a,i}return i(n)}(De),Xa=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.metadata,o=e.upsert;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(i,"/metadata"),a.params={metadata:s,upsert:o},a}return i(n)}(Ue),$a=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).metadata=a,i}return i(n)}(De),ei=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.metadataKey;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(i,"/metadata/").concat(s),a}return i(n)}(Ue),ti=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(i,"/metadata"),a}return i(n)}(Ue),ni=function(e,t){var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},ri=function(e,t){var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},ai=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};e.UserOnlineState=void 0,(ma=e.UserOnlineState||(e.UserOnlineState={})).ONLINE="online",ma.OFFLINE="offline",ma.NON_AVAILABLE="nonavailable";var ii,si=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h,f,p,v,m,g,y;return r(this,u),(i=a.call(this,t)).userId=null!==(o=null!==(s=n.guest_id)&&void 0!==s?s:n.user_id)&&void 0!==o?o:"",i.nickname=null!==(l=null!==(c=n.nickname)&&void 0!==c?c:n.name)&&void 0!==l?l:"",i.plainProfileUrl=null!==(h=null!==(d=n.profile_url)&&void 0!==d?d:n.image)&&void 0!==h?h:"",i.requireAuth=null!==(f=n.require_auth_for_profile_image)&&void 0!==f&&f,i.metaData=null!==(p=n.metadata)&&void 0!==p?p:{},i.connectionStatus=e.UserOnlineState.NON_AVAILABLE,R(e.UserOnlineState,n.is_online)?i.connectionStatus=n.is_online:L("boolean",n.is_online)&&(i.connectionStatus=n.is_online?e.UserOnlineState.ONLINE:e.UserOnlineState.OFFLINE),i.isActive=null===(v=n.is_active)||void 0===v||v,i.lastSeenAt=null!==(m=n.last_seen_at)&&void 0!==m?m:null,i.preferredLanguages=n.preferred_languages?_(n.preferred_languages):null,i.friendDiscoveryKey=null!==(g=n.friend_discovery_key)&&void 0!==g?g:null,i.friendName=null!==(y=n.friend_name)&&void 0!==y?y:null,i}return i(u,[{key:"profileUrl",get:function(){var e=Ei.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl}},{key:"serialize",value:function(){return ni(this)}},{key:"_isValidMetaData",value:function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return L("string",e)}))}},{key:"_applyMetaData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e).forEach((function(r){n?delete t.metaData[r]:t.metaData[r]=e[r]}))}},{key:"createMetaData",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(this._isValidMetaData(e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Za({userId:a.userId,metadata:e}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(Ja),c=u.metaData,this._applyMetaData(c),t.abrupt("return",this.metaData);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"updateMetaData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(this._isValidMetaData(e)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new Xa({userId:i.userId,metadata:e,upsert:n}),t.next=5,s.send(o);case 5:return u=t.sent,c=u.as($a),l=c.metadata,this._applyMetaData(l),t.abrupt("return",this.metaData);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"deleteMetaData",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new ei({userId:a.userId,metadataKey:e}),t.next=5,i.send(s);case 5:return this._applyMetaData((n={},u=!0,(o=k(o=e))in n?Object.defineProperty(n,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[o]=u,n),!0),t.abrupt("return",this.metaData);case 7:case"end":return t.stop()}var n,o,u}),n,this)})))}},{key:"deleteAllMetaData",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new ti({userId:r.userId}),e.next=4,a.send(i);case 4:this.metaData={};case 5:case"end":return e.stop()}}),e,this)})))}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))}}]),u}(Ya),oi=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userProfile;return r(this,n),(a=t.call(this)).userProfile=i,a}return i(n)}(ue),ui=function(){function e(t,n){var a,i,s,o,u,c,l,d,h,f,p,v,_,m;r(this,e),this._iid=t,this.appInfo=new Wa(n),this.user=new si(t,n),this.connectedAt=null!==(a=n.login_ts)&&void 0!==a?a:0,this.firstConnectedAt=0,this.pingInterval=null!==(i=n.ping_interval)&&void 0!==i?i:15e3,this.pongTimeout=null!==(s=n.pong_timeout)&&void 0!==s?s:5e3,this.reconnectInterval=null!==(u=null===(o=n.reconnect)||void 0===o?void 0:o.interval)&&void 0!==u?u:3e3,this.reconnectMaxInterval=null!==(l=null===(c=n.reconnect)||void 0===c?void 0:c.max_interval)&&void 0!==l?l:6e4,this.reconnectRetryCount=null!==(h=null===(d=n.reconnect)||void 0===d?void 0:d.retry_cnt)&&void 0!==h?h:5,this.reconnectIntervalMultiple=null!==(p=null===(f=n.reconnect)||void 0===f?void 0:f.mul)&&void 0!==p?p:2,this.maxUnreadCountOnSuperGroup=null!==(v=n.max_unread_cnt_on_super_group)&&void 0!==v?v:100,this.profileImageEncryption=!!n.profile_image_encryption,this.concurrentCallLimit=null!==(_=n.concurrent_call_limit)&&void 0!==_?_:5,this.backOffDelay=null!==(m=n.back_off_delay)&&void 0!==m?m:100}return i(e,[{key:"apply",value:function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=Ei.of(this._iid);r.sdkState.websocket&&(r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}}),r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new oi({userProfile:this}))}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign(Object.assign({},si.payloadify(e.user)),Wa.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})))}}]),e}(),ci=function(e){s(a,e);var n=f(a);function a(e,t,i){var s,o,u,c;return r(this,a),(s=n.call(this,e,t,i)).error=null,s.userProfile=new ui(e,i),s.deviceTokenLastDeletedAt=null!==(o=i.device_token_last_deleted_at)&&void 0!==o?o:0,s.key=null!==(u=i.key)&&void 0!==u?u:"",s.ekey=null!==(c=i.ekey)&&void 0!==c?c:"",s.error=i.error?new M(i):null,s}return i(a,[{key:"applyTo",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.error){t.next=12;break}if(!(r=Ei.of(e))){t.next=9;break}return a=r.sessionManager,t.next=6,a.login(this);case 6:this.userProfile.apply(),t.next=10;break;case 9:throw M.lostInstance;case 10:t.next=13;break;case 12:throw this.error;case 13:case"end":return t.stop()}}),n,this)})))}}],[{key:"asError",value:function(e){return new a("","LOGI",Object.assign({user_id:"",error:!0},e))}}]),a}(Qe),li=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.request,s=void 0===i||i,o=e.features,u=void 0===o?{}:o,c=e.options,l=void 0===c?{}:c;return r(this,n),(a=t.call(this)).request=s,a.features=Object.assign({localCache:!0},u),a.options=Object.assign({ingestion:!0},l),a}return i(n)}(ue),di=function(e){s(a,e);var n=f(a);function a(e,t){var i,s,o=t.sdkState,u=t.cacheContext,c=t.connectionHandlers,l=t.sessionManager,d=t.websocketClient,h=t.dispatcher,f=t.logger,p=t.entryState,v=void 0===p?new Ga:p;return r(this,a),(i=n.call(this))._stateUpdatedAt=0,i._connectingAt=0,i._connectionRequestQueue=[],i._iid=e,i.sdkState=o,i.cacheContext=u,i.connectionHandlers=c,i._sessionManager=l,i._websocketClient=d,i._dispatcher=h,i._logger=f,i._currentState=v,(null===(s=i.sdkState.websocket)||void 0===s?void 0:s.pingerDisabled)||(i._pinger=new za({pingDelegate:{send:function(e){return i._websocketClient.send(e)},error:function(e){return i._websocketClient.error(e)}},sdkState:i.sdkState,logger:f})),i._websocketClient.on("open",(function(){i._tryResolveConnectionRequest()})).on("message",(function(e){if("LOGI"===e.code)i.clearLoginTimer(),i._dispatcher.dispatch(e.as(ci))})).on("ping-refresh",(function(){var e;return null===(e=i._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=i._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=i._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){i._logiProcessingTimer=setTimeout((function(){i._logiProcessingTimer=void 0,i._unresolvedLogi||i._rejectConnectionRequest(M.networkError)}),500)})),i._dispatcher.on((function(e){e instanceof ci&&(i._unresolvedLogi=e,i._tryResolveConnectionRequest())})),i}return i(a,[{key:"currentState",get:function(){return this._currentState}},{key:"hasSession",get:function(){return this._sessionManager.auth.hasSession}},{key:"changeState",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n>=this._stateUpdatedAt)){t.next=8;break}return this._currentState=e,this._stateUpdatedAt=n,this._dispatcher.dispatch(new ga({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),t.next=7,this._currentState.run(this);case 7:return t.abrupt("return",!0);case 8:return t.abrupt("return",!1);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"_tryResolveConnectionRequest",value:function(){var e;return E(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this._unresolvedLogi,!this._websocketClient.isOpen||!r){t.next=18;break}if(this._unresolvedLogi=void 0,r.error){t.next=15;break}return t.next=6,r.applyTo(this._iid);case 6:a=r.userProfile,this._enableStatLog({request:a.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:a.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish")},options:{ingestion:a.appInfo.allowSdkStatsUpload}}),this._statLogConnection(),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground",t.next=18;break;case 15:this._sessionManager.auth.authToken=void 0,(r.error.isSessionKeyExpiredError||r.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new Re({reason:r.error.code})),this._rejectConnectionRequest(r.error);case 18:case"end":return t.stop()}}),n,this)})))}},{key:"_rejectConnectionRequest",value:function(e){var t;if(null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var n=this._connectionRequestQueue;this._connectionRequestQueue=[],n.forEach((function(t){return t.reject(e)})),this._statLogConnection(e)}}},{key:"_url",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=this.sdkState,a=r.appId,i=r.appVersion,s=r.userId,o=r.extensions,u=r.sendbirdRuntimeEnvironment,c=this.cacheContext.localCacheEnabled,l=this._sessionManager.auth,d=null===(e=this.sdkState.websocket)||void 0===e?void 0:e.compression,h=!!(null!==(t=this.sdkState.extensions)&&void 0!==t?t:{}).sb_uikit,f=Ve.userAgentWithExtension(o);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(C.OS_VERSION),"&sv=").concat(encodeURIComponent(C.SDK_VERSION),"&ai=").concat(a).concat(i?"&av=".concat(i):"").concat(l.hasSession?"&key=".concat(encodeURIComponent(l.sessionKey)):"&user_id=".concat(encodeURIComponent(s),"&access_token=").concat(encodeURIComponent(n)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(f,"&SB-SDK-User-Agent=").concat(encodeURIComponent(Ve.sendbirdSdkUserAgentWithExtension(u)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(c?1:0,"&include_poll_details=1").concat(h?"&uikit_config=1":"")}},{key:"_enableStatLog",value:function(e){var t=e.request,n=e.features,r=e.options,a=void 0===r?{}:r;this._dispatcher.dispatch(new li({request:t,features:n,options:a}))}},{key:"_statLogConnection",value:function(e){var t;this._dispatcher.dispatch(new Pe(new Ge({type:Oe.WEBSOCKET_CONNECT,data:{host_url:null===(t=this.sdkState.websocket)||void 0===t?void 0:t.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))}},{key:"connect",value:function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,t().mark((function r(){var a,i,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(M.connectionCanceled)),a=this._url(n),i=new va,this._connectionRequestQueue.push(i),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){s._loginTimer=void 0,s._rejectConnectionRequest(M.loginTimeout)}),null===(e=this.sdkState.websocket)||void 0===e?void 0:e.responseTimeout),n&&(this._sessionManager.auth.authToken=n),this._websocketClient.connect(a)),t.abrupt("return",i.promise);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"cancelConnectForRetry",value:function(){this._dispatcher.dispatch(ci.asError(M.connectionRenew))}},{key:"disconnect",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._websocketClient.disconnect();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"logout",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,e.next=4,this._sessionManager.clear();case 4:return e.next=6,this.disconnect();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearLoginTimer",value:function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)}}]),a}(se),hi=function(){function e(t,n){var a=n.sdkState,i=n.cacheContext,s=n.connectionHandlers,o=n.sessionManager,u=n.websocketClient,c=n.dispatcher,l=n.logger,d=n.disableWebSocketCloseEventHandling,h=void 0!==d&&d;r(this,e),this._disableWebSocketCloseEventHandling=!1,this._externalCalledWebSocketClose=!1,this._logger=l,this._disableWebSocketCloseEventHandling=h,this._context=new di(t,{sdkState:a,cacheContext:i,connectionHandlers:s,sessionManager:o,websocketClient:u,dispatcher:c,logger:l}),this._sdkState=a,this._sessionManager=o,this._websocketClient=u}return i(e,[{key:"_registerEventDispatcher",value:function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",(function(){e.isConnected||(e._logger.debug("try reconnect by session token refresh"),e.reconnect())})).on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),e.reconnect())})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"!==e._sdkState.appState||e._externalCalledWebSocketClose||e._sessionManager.isRefreshingAuthToken||(e._logger.debug("try reconnect by websocket connection closed"),e.reconnect())})))}},{key:"_clearEventDispatcher",value:function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)}},{key:"isConnected",get:function(){return this._context.currentState.type===da.CONNECTED}},{key:"isConnecting",get:function(){var e=this._context.currentState;return e.type===da.CONNECTING||e.type===da.RECONNECTING}},{key:"websocketClient",get:function(){return this._websocketClient}},{key:"connect",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._context.currentState,this._externalCalledWebSocketClose=!1,t.next=4,r.onConnect(this._context,e);case 4:this._registerEventDispatcher();case 5:case"end":return t.stop()}}),n,this)})))}},{key:"reconnect",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,this._externalCalledWebSocketClose=!1,e.next=4,n.onReconnect(this._context,{});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resetAndReconnect",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,this._externalCalledWebSocketClose=!1,e.next=4,n.onReconnect(this._context,{resetReconnectCount:!0});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"background",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,this._externalCalledWebSocketClose=!0,e.next=4,n.onDisconnect(this._context,{autoReconnect:!1});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"disconnect",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._context.currentState,t.next=3,r.onDisconnect(this._context,{error:e,autoReconnect:!0});case 3:case"end":return t.stop()}}),n,this)})))}},{key:"disconnectWebSocket",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,this._externalCalledWebSocketClose=!0,e.next=4,n.onDisconnectWebSocket(this._context);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"logout",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,this._clearEventDispatcher(),e.next=4,n.onLogout(this._context);case 4:case"end":return e.stop()}}),e,this)})))}}]),e}(),fi=function(e){s(n,e);var t=f(n);function n(e){var a,i,s,o,u,c=e.type,l=e.data,d=e.ts,h=void 0===d?Date.now():d;return r(this,n),(a=t.call(this,{type:c,data:l,ts:h})).date=new Date(h),a.key="".concat((i=a.date,s=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),u=String(i.getDate()).padStart(2,"0"),"".concat(s).concat(o).concat(u)),"_").concat(c),a}return i(n)}(Ge),pi=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.deviceId,s=e.statLogs;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(Te),a.params={device_id:i,log_entries:s.map((function(e){return Ge.payloadify(e)}))},a}return i(n)}(Ue),vi=function e(t,r){if(null!==t&&null!==r){var a,i=Object.keys(t),s=Object.keys(r),o={},u=y(_(new Set([].concat(i,s))));try{for(u.s();!(a=u.n()).done;){var c=a.value,l=n(t[c]),d=n(r[c]);"undefined"===l?o[c]=r[c]:"undefined"===d?o[c]=t[c]:l!==d?o[c]=r[c]:"object"===l&&t[c]&&r[c]?o[c]=e(t[c],r[c]):o[c]=r[c]}}catch(e){u.e(e)}finally{u.f()}return o}return r};!function(e){e[e.PENDING=0]="PENDING",e[e.COLLECT_ONLY=1]="COLLECT_ONLY",e[e.ENABLED=2]="ENABLED",e[e.DISABLED=3]="DISABLED"}(ii||(ii={}));var _i,mi=function(e){s(a,e);var n=f(a);function a(e){var t,i=e.cacheContext,s=e.requestQueue,o=e.dispatcher,u=e.baseLimit,c=void 0===u?100:u,l=e.maxLimit,d=void 0===l?1e3:l,h=e.minLimit,f=void 0===h?10:h;return r(this,a),(t=n.call(this)).queue=[],t.enabledState=ii.PENDING,t.isFlushing=!1,t.generation=1,t.lastFlushedAt=0,t._collectRequestStat=!0,t._collectFeatureLocalCacheStat=!0,t.deviceId=ae(),t.cacheContext=i,t.requestQueue=s,t.dispatcher=o,t.baseLimit=c,t.limit=c,t.maxLimit=d,t.minLimit=f,t}return i(a,[{key:"isEnabled",get:function(){return this.enabledState===ii.ENABLED}},{key:"_arrangeStat",value:function(){var e=[];this._collectRequestStat&&e.push.apply(e,_(this.queue.filter((function(e){return e.type===Oe.API_RESULT||e.type===Oe.WEBSOCKET_CONNECT})))),this._collectFeatureLocalCacheStat&&e.push.apply(e,_(this.queue.filter((function(e){return e.type===Oe.FEATURE_LOCALCACHE})))),this.queue=e}},{key:"_save",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.enabledState!==ii.ENABLED){e.next=4;break}return e.next=3,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return Ge.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt});case 3:this.dispatch("save",_(this.queue));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_flush",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=34;break}if(this.isFlushing){e.next=34;break}if(this.isFlushing=!0,e.prev=3,this._arrangeStat(),n=this.queue.filter((function(e){if(e instanceof fi){var t=new Date,n=[e.date.getFullYear(),t.getFullYear()],r=n[0],a=n[1];if(r<a)return!0;if(r===a){var i=[e.date.getMonth(),t.getMonth()],s=i[0],o=i[1];if(s<o)return!0;if(s===o){var u=[e.date.getDate(),t.getDate()];return u[0]<u[1]}}}return!1})),r=this.queue.filter((function(e){return!(e instanceof fi)})),!((a=[].concat(_(n),_(r)).slice(0,Math.min(this.limit,this.maxLimit))).length>0)){e.next=16;break}return i=new pi({deviceId:this.deviceId,statLogs:a}),e.next=12,this.requestQueue.send(i);case 12:return this.dispatch("flush",a),this.queue=[].concat(_(n),_(r)).slice(a.length),e.next=16,this._save();case 16:this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),e.next=31;break;case 20:if(e.prev=20,e.t0=e.catch(3),!(e.t0 instanceof M)){e.next=30;break}if(e.t0.code!==b.STAT_LOG_NOT_ALLOWED){e.next=29;break}return e.next=26,this.clear();case 26:this.enabledState=ii.DISABLED,e.next=30;break;case 29:e.t0.code===b.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=ii.COLLECT_ONLY);case 30:this.limit=this.limit+20;case 31:return e.prev=31,this.isFlushing=!1,e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[3,20,31,34]])})))}},{key:"init",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.key=e,t.next=3,this.cacheContext.preference.get(this.key);case 3:if(!(r=t.sent)){t.next=15;break}if(this.deviceId=r.deviceId,this.queue=r.statLogs.map((function(e){return new Ge({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=r.generation,this.lastFlushedAt=r.lastFlushedAt,!(Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit)){t.next=15;break}return a=Math.min(Math.floor(18e4*Math.random()),100),t.next=13,Sa(a);case 13:return t.next=15,this._flush();case 15:this.commandEventContext||(this.commandEventContext=this.dispatcher.on((function(e){if(e instanceof Pe){var t=e.statLog;i.put(t)}else if(e instanceof li){var n=e.request,r=e.features,a=e.options;i._collectRequestStat=n,i._collectFeatureLocalCacheStat=null==r?void 0:r.localCache,i._arrangeStat(),i._collectRequestStat||i._collectFeatureLocalCacheStat?i.enabledState=a.ingestion?ii.ENABLED:ii.COLLECT_ONLY:i.enabledState=ii.DISABLED,i.isEnabled?i.queue.length>=i.limit&&i._flush():i.clear()}})));case 16:case"end":return t.stop()}}),n,this)})))}},{key:"put",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabledState===ii.DISABLED){t.next=7;break}return e instanceof fi?this._collectFeatureLocalCacheStat&&(r=this.queue.filter((function(t){return t instanceof fi&&t.key===e.key})),a=v(r,1),(i=a[0])?i.data=vi(i.data,e.data):this.queue.push(e)):this._collectRequestStat&&this.queue.push(e),t.next=4,this._save();case 4:if(!(this.queue.length>=this.limit)){t.next=7;break}return t.next=7,this._flush();case 7:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queue=[],this.generation=1,e.next=4,this._save();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"close",value:function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)}}]),a}(se);e.LogLevel=void 0,(_i=e.LogLevel||(e.LogLevel={}))[_i.NONE=0]="NONE",_i[_i.VERBOSE=1]="VERBOSE",_i[_i.DEBUG=2]="DEBUG",_i[_i.INFO=3]="INFO",_i[_i.WARN=4]="WARN",_i[_i.ERROR=5]="ERROR";var gi,yi=function(){function t(){r(this,t),this.level=e.LogLevel.WARN}return i(t,[{key:"verbose",value:function(){if(this.level<=e.LogLevel.VERBOSE){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[verbose]"].concat(r))}}},{key:"debug",value:function(){if(this.level<=e.LogLevel.DEBUG){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[debug]"].concat(r))}}},{key:"info",value:function(){if(this.level<=e.LogLevel.INFO){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[info]"].concat(r))}}},{key:"warn",value:function(){if(this.level<=e.LogLevel.WARN){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).warn.apply(t,["[warn]"].concat(r))}}},{key:"error",value:function(){if(this.level<=e.LogLevel.ERROR){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).error.apply(t,["[error]"].concat(r))}}}]),t}(),ki={},Ei=function(){function t(n,a){var i,s,o,u,c,l,d,h,f,p;if(r(this,t),this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!ki[n]){ki[n]=this;var v=null!==(i=a.options)&&void 0!==i?i:new G,_=this.sdkState={appId:a.appId,appVersion:null!==(s=a.appVersion)&&void 0!==s?s:"",appState:"foreground",userId:void 0,extensions:{},api:{host:null!==(o=a.apiHost)&&void 0!==o?o:"https://api-".concat(a.appId,".sendbird.com")},websocket:{host:null!==(u=a.websocketHost)&&void 0!==u?u:"wss://ws-".concat(a.appId,".sendbird.com"),pingerDisabled:!!a.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new Ia,responseTimeout:v.websocketResponseTimeout},sessionTokenRefreshTimeout:v.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var m=this.logger=new yi;this.logger.level=null!==(c=a.logLevel)&&void 0!==c?c:e.LogLevel.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var g=this.cacheContext=new V({encryption:a.encryption,store:a.store,localCacheEnabled:null!==(l=a.localCacheEnabled)&&void 0!==l&&l,localCacheConfig:null!==(d=a.localCacheConfig)&&void 0!==d?d:new ne});this.debugMode=null!==(h=a.debugMode)&&void 0!==h&&h,this.maxSuperGroupChannelUnreadCount=C.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=v.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=v.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=v.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var y=this.dispatcher=new oe,k=new re;this.requestQueue=new ya(n,{auth:k,sdkState:_,dispatcher:y,logger:m,useFetchCompat:a.useFetchCompat}),this.sessionManager=new Ua({auth:k,cacheContext:g,sdkState:_,dispatcher:y,requestQueue:this.requestQueue,logger:m}),this.connectionManager=new hi(n,{sdkState:_,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:y,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(f=a.disableWebSocketCloseEventHandling)&&void 0!==f&&f,logger:m}),this.statLogCollector=new mi({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:y}),this.appStateToggleEnabled=null===(p=a.appStateToggleEnabled)||void 0===p||p}return ki[n]}return i(t,[{key:"hasExtension",value:function(e){return this.sdkState.extensions&&this.sdkState.extensions[e]}}],[{key:"of",value:function(e){if(ki[e])return ki[e];throw M.lostInstance}},{key:"clear",value:function(e){ki[e]&&delete ki[e]}}]),t}(),bi=function(){function e(){r(this,e)}return i(e,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,a=t.sessionManager,i=t.requestQueue,s=t.logger;t.onlineDetector;var o=t.cacheContext;this._iid=e,this._cacheContext=o,this._sdkState=n,this._dispatcher=r,this._sessionManager=a,this._requestQueue=i,this._logger=s}}]),e}(),wi=function(e){s(n,e);var t=f(n);function n(e){var a;if(r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(pe),a.params=ce({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var i=0;i<e.thumbnailSizes.length;i++){var s=e.thumbnailSizes[i],o=s.maxWidth,u=s.maxHeight;a.params["thumbnail".concat(i+1)]="".concat(o,",").concat(u)}return a.requestId=e.requestId,a}return i(n)}(Ue),Ci=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u;return r(this,n),(i=t.call(this,e,a)).url=a.url,i.fileSize=null!==(s=a.file_size)&&void 0!==s?s:0,i.thumbnailSizes=null!==(o=a.thumbnails)&&void 0!==o?o:[],i.requireAuth=null!==(u=a.require_auth)&&void 0!==u&&u,i}return i(n)}(De),xi=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u;return r(this,n),(i=t.call(this,e)).replyCount=0,i.lastRepliedAt=0,i.updatedAt=0,i.replyCount=null!==(s=a.reply_count)&&void 0!==s?s:0,i.mostRepliedUsers=a.most_replies&&F("object",a.most_replies)?a.most_replies.map((function(e){return new si(i._iid,e)})):[],i.lastRepliedAt=null!==(o=a.last_replied_at)&&void 0!==o?o:0,i.updatedAt=null!==(u=a.updated_at)&&void 0!==u?u:0,i}return i(n,null,[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(n),"payloadify",this).call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((function(e){return si.payloadify(e)})):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))}}]),n}(Ya);e.ReactionEventOperation=void 0,(gi=e.ReactionEventOperation||(e.ReactionEventOperation={})).ADD="add",gi.DELETE="delete";var Ti,Si,Ii=i((function t(n){r(this,t),this.messageId=0,this.operation=null,this.updatedAt=0;var a=L("string",n.msg_id)?parseInt(n.msg_id):n.msg_id,i=n.user_id,s=n.operation?n.operation.toLowerCase():null,o=n.reaction,u=n.updated_at;a&&L("string",i)&&L("string",s)&&R(e.ReactionEventOperation,s)&&L("string",o)&&o&&L("number",u)&&(this.messageId=a,this.userId=i,this.key=o,this.operation=s,this.updatedAt=u)})),Ni=function(){function t(e){var n;r(this,t);var a=e.key,i=null!==(n=_(e.user_ids))&&void 0!==n?n:[],s=e.updated_at;L("string",a)&&a&&F("string",i)&&i.length>0&&L("number",s)&&(this.key=a,this.userIds=i,this.updatedAt=s);var o,u={},c=y(this.userIds);try{for(c.s();!(o=c.n()).done;){u[o.value]=this.updatedAt}}catch(e){c.e(e)}finally{c.f()}this._version=u}return i(t,[{key:"isEmpty",get:function(){return 0===this.userIds.length}},{key:"applyEvent",value:function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var n=this.userIds.indexOf(t.userId);switch(t.operation){case e.ReactionEventOperation.ADD:n<0&&this.userIds.push(t.userId);break;case e.ReactionEventOperation.DELETE:n>=0&&this.userIds.splice(n,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}}}],[{key:"payloadify",value:function(e){return ce(le({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}))}}]),t}(),Ai=function(){function e(t){r(this,e),this.key=t.key,this.value=F("string",t.value)?_(t.value):[]}return i(e,null,[{key:"payloadify",value:function(e){var t;return ce(le({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}))}}]),e}(),Mi=function(){function e(t){r(this,e),this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=t.url,t.secure_url&&(this.secureUrl=t.secure_url),t.type&&(this.type=t.type),t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.alt&&(this.alt=t.alt)}return i(e,null,[{key:"payloadify",value:function(e){var t,n;return ce(le({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}))}}]),e}(),Oi=function(){function e(t){r(this,e),this.title=null,this.url=null,this.description=null,this.defaultImage=null,t["og:title"]&&(this.title=t["og:title"]),t["og:url"]&&(this.url=t["og:url"]),t["og:description"]&&(this.description=t["og:description"]),t["og:image"]&&(this.defaultImage=new Mi(t["og:image"]))}return i(e,null,[{key:"payloadify",value:function(e){return ce(le({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Mi.payloadify(e.defaultImage):null}))}}]),e}(),Ui=function(){function e(t){var n,a;r(this,e),this.volume=0,this.name=null!==(n=t.name)&&void 0!==n?n:"default",this.volume=null!==(a=t.volume)&&void 0!==a?a:1}return i(e,[{key:"serialize",value:function(){return{name:this.name,volume:this.volume}}}],[{key:"payloadify",value:function(e){return ce(le({name:e.name,volume:e.volume}))}}]),e}(),Di=function(t){s(a,t);var n=f(a);function a(t,i){var s,o;return r(this,a),(s=n.call(this,t,i)).isBlockedByMe=!1,s.role=R(e.Role,i.role)?i.role:e.Role.NONE,s.isBlockedByMe=null!==(o=i.is_blocked_by_me)&&void 0!==o&&o,s}return i(a,null,[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(a),"payloadify",this).call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))}}]),a}(si);e.ScheduledStatus=void 0,(Ti=e.ScheduledStatus||(e.ScheduledStatus={})).PENDING="pending",Ti.SENT="sent",Ti.FAILED="failed",Ti.CANCELED="canceled",function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(Si||(Si={}));var Li,Ri=function(t){switch(t){case e.MessageType.BASE:return"";case e.MessageType.USER:return"MESG";case e.MessageType.FILE:return"FILE";case e.MessageType.ADMIN:return"ADMM"}},Pi=function(t){s(a,t);var n=f(a);function a(t,i){var s,o,u,c,l,d,h,f,p,v,_,m,g,y,k,E,b;r(this,a),(s=n.call(this,t)).channelType=e.ChannelType.BASE,s.parentMessage=null,s.silent=!1,s.isOperatorMessage=!1,s.messageType=e.MessageType.BASE,s.mentionType=null,s.threadInfo=null,s.reactions=[],s.metaArrays=[],s.appleCriticalAlertOptions=null,s.createdAt=0,s.updatedAt=0,s.scheduledInfo=null,s.extendedMessage={},s._isContinuousMessages=!1,s._scheduledStatus=null,s.messageId=null!==(u=null!==(o=i.msg_id)&&void 0!==o?o:i.message_id)&&void 0!==u?u:0,s.channelUrl=i.channel_url,s.channelType=R(e.ChannelType,i.channel_type)?i.channel_type:e.ChannelType.GROUP,i.channel&&(i.channel.channel_url&&(s.channelUrl=i.channel.channel_url),i.channel.channel_type&&(s.channelType=i.channel.channel_type)),s.parentMessageId=null!==(c="string"==typeof i.parent_message_id?parseInt(i.parent_message_id):i.parent_message_id)&&void 0!==c?c:0,s.data=null!==(l=i.data)&&void 0!==l?l:"",s.customType=null!==(d=i.custom_type)&&void 0!==d?d:"",s.mentionType=R(e.MentionType,i.mention_type)?i.mention_type:null,s.mentionedUsers=i.mentioned_users?i.mentioned_users.map((function(e){return new si(s._iid,e)})):null,s.mentionedUserIds=null!==(h=i.mentioned_user_ids)&&void 0!==h?h:null,s.mentionedUsers&&!s.mentionedUserIds&&(s.mentionedUserIds=s.mentionedUsers.map((function(e){return e.userId}))),s.mentionedMessageTemplate=null!==(f=i.mentioned_message_template)&&void 0!==f?f:"",s.threadInfo=i.thread_info?new xi(s._iid,i.thread_info):null,s.reactions=i.reactions?i.reactions.map((function(e){return new Ni(e)})):[];var w=null!==(p=i.metaarray)&&void 0!==p?p:{},C=null!==(v=i.metaarray_key_order)&&void 0!==v?v:Object.keys(w).sort((function(e,t){return e.localeCompare(t)}));s.metaArrays=[];for(var x=0;x<C.length;x++){var T=C[x];s.metaArrays.push(new Ai({key:T,value:w[T]||[]}))}return i.sorted_metaarray&&(s.metaArrays=i.sorted_metaarray.map((function(e){return new Ai(e)}))),s.ogMetaData=i.og_tag?new Oi(i.og_tag):null,s.silent=null!==(_=i.silent)&&void 0!==_&&_,s.isOperatorMessage=null!==(m=i.is_op_msg)&&void 0!==m&&m,s.appleCriticalAlertOptions=i.apple_critical_alert_options?new Ui(i.apple_critical_alert_options):null,s.createdAt=null!==(y=null!==(g=i.created_at)&&void 0!==g?g:i.ts)&&void 0!==y?y:0,s.updatedAt=null!==(k=i.updated_at)&&void 0!==k?k:0,"number"==typeof i.scheduled_message_id&&"number"==typeof i.scheduled_at&&i.scheduled_status&&(s.scheduledInfo={scheduledMessageId:i.scheduled_message_id,scheduledAt:i.scheduled_at},s._scheduledStatus=i.scheduled_status),s.extendedMessage=null!==(E=i.extended_message)&&void 0!==E?E:{},s._isContinuousMessages=null!==(b=i.is_continuous_messages)&&void 0!==b&&b,s}return i(a,[{key:"isIdentical",value:function(e){return this.messageId===e.messageId}},{key:"isEqual",value:function(e){return D(this,e)}},{key:"isUserMessage",value:function(){return this.messageType===e.MessageType.USER}},{key:"isFileMessage",value:function(){return this.messageType===e.MessageType.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")}},{key:"isMultipleFilesMessage",value:function(){return this.messageType===e.MessageType.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")}},{key:"isAdminMessage",value:function(){return this.messageType===e.MessageType.ADMIN}},{key:"serialize",value:function(){return ni(this)}},{key:"getMetaArraysByKeys",value:function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))}},{key:"applyThreadInfoUpdateEvent",value:function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1}},{key:"applyReactionEvent",value:function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Ni(Ni.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}}},{key:"applyParentMessage",value:function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1}}],[{key:"payloadify",value:function(e){var t,n,r,i;return ce(le(Object.assign(Object.assign({},p(o(a),"payloadify",this).call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:Ri(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(t=e.mentionedUsers)||void 0===t?void 0:t.map((function(e){return si.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?xi.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return Ni.payloadify(e)})),sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((function(e){return Ai.payloadify(e)})),og_tag:e.ogMetaData?Oi.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?Ui.payloadify(e.appleCriticalAlertOptions):null,created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(r=e.scheduledInfo)||void 0===r?void 0:r.scheduledMessageId,scheduled_at:null===(i=e.scheduledInfo)||void 0===i?void 0:i.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})))}},{key:"_getParentMessageInfoPayload",value:function(e){return ce(le({type:Ri(e.messageType),ts:e.createdAt,user:e.sender?Di.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth}}))}}]),a}(Ya),Fi=function(t){s(a,t);var n=f(a);function a(t,i){var s,o,u,c,l;if(r(this,a),(s=n.call(this,t,i)).reqId="",s.replyToChannel=!1,s.errorCode=0,s.sender=i.user?new Di(s._iid,i.user):i.sender_id,s.reqId=null!==(u=null!==(o=i.req_id)&&void 0!==o?o:i.request_id)&&void 0!==u?u:"",s.replyToChannel=null!==(c=i.is_reply_to_channel)&&void 0!==c&&c,i.request_state&&R(e.SendingStatus,i.request_state)&&(s.sendingStatus=i.request_state),!s.sendingStatus)if(s.messageId>0)s.sendingStatus=e.SendingStatus.SUCCEEDED;else if(s.scheduledInfo)switch(i.scheduled_status&&(s._scheduledStatus=i.scheduled_status),i.scheduled_status){case Si.SENT:case Si.IN_QUEUE:s.sendingStatus=e.SendingStatus.SUCCEEDED;break;case Si.PENDING:s.sendingStatus=e.SendingStatus.SCHEDULED;break;case Si.FAILED:case Si.REMOVED:s.sendingStatus=e.SendingStatus.FAILED;break;case Si.CANCELED:s.sendingStatus=e.SendingStatus.CANCELED}else s.sendingStatus=e.SendingStatus.PENDING;return s.errorCode=null!==(l=i.error_code)&&void 0!==l?l:0,s}return i(a,[{key:"isResendable",get:function(){return this.sendingStatus===e.SendingStatus.FAILED&&((t=this.errorCode)>0&&O.indexOf(t)>=0);var t}},{key:"isIdentical",value:function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(a),"payloadify",this).call(this,e)),{user:Di.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))}}]),a}(Pi),Hi=function(){function e(t){var n,a;r(this,e),this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(n=t.real_width)&&void 0!==n?n:t.width,this.realHeight=null!==(a=t.real_height)&&void 0!==a?a:t.height}return i(e,[{key:"plainUrl",get:function(){return this.url.split("?auth=")[0]}}],[{key:"payloadify",value:function(e){return ce(le({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}))}}]),e}(),qi={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Gi=function(t){return L("number",t.prevResultSize)&&L("number",t.nextResultSize)&&L("boolean",t.isInclusive)&&L("boolean",t.reverse)&&L("string",t.messageTypeFilter)&&R(e.MessageTypeFilter,t.messageTypeFilter)&&F("string",t.customTypesFilter,!0)&&F("string",t.senderUserIdsFilter,!0)&&L("boolean",t.includeMetaArray)&&L("boolean",t.includeReactions)&&L("boolean",t.includeParentMessageInfo)},ji=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l;if(r(this,u),(i=a.call(this,t,n)).translations={},i.message=null!==(s=n.message)&&void 0!==s?s:"",i.messageType=e.MessageType.ADMIN,i.translations=null!==(o=n.translations)&&void 0!==o?o:{},n.parent_message_info){var d=n.parent_message_info;i.parentMessage=$i(t,ce(le(Object.assign(Object.assign({},d),{message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:d.file,url:null===(c=d.file)||void 0===c?void 0:c.url,require_auth:null===(l=d.file)||void 0===l?void 0:l.require_auth}))))}return i}return i(u,[{key:"getThreadedMessagesByTimestamp",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},qi),n),ai(this.messageId>0&&L("number",e)&&Gi(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?p(o(u),"_getParentMessageInfoPayload",this).call(this,e.parentMessage):null})))}}]),u}(Pi),zi=function(){function e(t){var n,a;r(this,e),this.detail={},this.type=null!==(n=t.type)&&void 0!==n?n:"",this.vendor=null!==(a=t.vendor)&&void 0!==a?a:"",t.detail&&L("object",t.detail)&&!Array.isArray(t.detail)&&(this.detail=t.detail)}return i(e,null,[{key:"payloadify",value:function(e){return ce(le({type:e.type,vendor:e.vendor,detail:e.detail}))}}]),e}();!function(e){e.OPEN="open",e.CLOSED="closed"}(Li||(Li={}));var Vi="removed",Bi=function(e){switch(e){case"open":return Li.OPEN;case"closed":return Li.CLOSED;default:return null}},Qi=function(e){return!e||!!e.text&&L("string",e.text)},Ki=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u,c,l,d,h;return r(this,n),(i=t.call(this,e)).pollId=0,i.id=0,i.text=null,i.voteCount=0,i.createdBy=null,i.createdAt=0,i.updatedAt=0,i._lastVotedAt=0,i.pollId=null!==(s=a.poll_id)&&void 0!==s?s:0,i.id=null!==(o=a.id)&&void 0!==o?o:0,i.text=null!==(u=a.text)&&void 0!==u?u:null,i.voteCount=null!==(c=a.vote_count)&&void 0!==c?c:0,i.createdBy=null!==(l=a.created_by)&&void 0!==l?l:null,i.createdAt=null!==(d=a.created_at)&&void 0!==d?d:0,i.updatedAt=null!==(h=a.updated_at)&&void 0!==h?h:0,i}return i(n,null,[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(n),"payloadify",this).call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))}}]),n}(Ya),Wi=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u,c,l,d,h,f,p,v,_,m,g;return r(this,n),(i=t.call(this,e)).id=0,i.title=null,i.createdAt=0,i.updatedAt=0,i.closeAt=-1,i.status=Li.CLOSED,i.messageId=0,i.data=null,i.voterCount=-1,i.options=[],i.createdBy=null,i.allowUserSuggestion=!1,i.allowMultipleVotes=!1,i.votedPollOptionIds=[],i.id=null!==(s=a.id)&&void 0!==s?s:0,i.title=null!==(o=a.title)&&void 0!==o?o:null,i.createdAt=null!==(u=a.created_at)&&void 0!==u?u:0,i.updatedAt=null!==(c=a.updated_at)&&void 0!==c?c:0,i.closeAt=null!==(l=a.close_at)&&void 0!==l?l:-1,i.status=null!==(d=Bi(a.status))&&void 0!==d?d:Li.CLOSED,i.messageId=null!==(h=a.message_id)&&void 0!==h?h:0,i.data=null!==(f=a.data)&&void 0!==f?f:null,i.voterCount=null!==(p=a.voter_count)&&void 0!==p?p:-1,i.options=a.options?a.options.map((function(e){return new Ki(i._iid,e)})):[],i.createdBy=null!==(v=a.created_by)&&void 0!==v?v:null,i.allowUserSuggestion=null!==(_=a.allow_user_suggestion)&&void 0!==_&&_,i.allowMultipleVotes=null!==(m=a.allow_multiple_votes)&&void 0!==m&&m,i.votedPollOptionIds=null!==(g=a.voted_option_ids)&&void 0!==g?g:[],i}return i(n,[{key:"_applyPollUpdatePayload",value:function(e){var t,n,r,a,i,s,o,u,c=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(a=Bi(e.status))&&void 0!==a?a:this.status,this.data=null!==(i=e.data)&&void 0!==i?i:this.data,this.voterCount=null!==(s=e.voter_count)&&void 0!==s?s:this.voterCount,e.options&&(this.options=e.options.map((function(e){return new Ki(c._iid,e)})),this.votedPollOptionIds=e.options.filter((function(e){return e.vote_count>0})).map((function(e){return e.id}))),this.allowUserSuggestion=null!==(o=e.allow_user_suggestion)&&void 0!==o?o:this.allowUserSuggestion,this.allowMultipleVotes=null!==(u=e.allow_multiple_votes)&&void 0!==u?u:this.allowMultipleVotes}},{key:"applyPollUpdateEvent",value:function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)}},{key:"applyPollVoteEvent",value:function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,a=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var i=t[r];a>=i._lastVotedAt&&(i.voteCount=e.vote_count,i._lastVotedAt=a)}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),"number"==typeof r.voter_count&&(this.voterCount=r.voter_count),!0}},{key:"serialize",value:function(){return ni(this)}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(n),"payloadify",this).call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map((function(e){return Ki.payloadify(e)})),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))}}]),n}(Ya),Yi=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d;if(r(this,u),(i=a.call(this,t,n)).message="",i.messageParams=null,i.translations={},i.translationTargetLanguages=[],i.messageSurvivalSeconds=-1,i.plugins=[],i._poll=null,i.message=n.message,i.messageType=e.MessageType.USER,i.translations=null!==(s=n.translations)&&void 0!==s?s:{},i.translationTargetLanguages=null!==(o=n.target_langs)&&void 0!==o?o:[],0===Object.keys(i.translations).length&&i.translationTargetLanguages.length>0){var h,f=y(i.translationTargetLanguages);try{for(f.s();!(h=f.n()).done;){var p=h.value;i.translations[p]=""}}catch(e){f.e(e)}finally{f.f()}}if(i.messageSurvivalSeconds=null!==(c=n.message_survival_seconds)&&void 0!==c?c:-1,i.plugins=n.plugins?n.plugins.map((function(e){return new zi(e)})):[],i._poll=n.poll?new Wi(i._iid,n.poll):null,n.parent_message_info){var v=n.parent_message_info;i.parentMessage=$i(t,ce(le(Object.assign(Object.assign({},v),{created_at:v.ts,message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:v.file,url:null===(l=v.file)||void 0===l?void 0:l.url,require_auth:null===(d=v.file)||void 0===d?void 0:d.require_auth}))))}return i}return i(u,[{key:"getThreadedMessagesByTimestamp",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},qi),n),ai(this.messageId>0&&L("number",e)&&Gi(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"applyPoll",value:function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)}},{key:"poll",get:function(){return this._poll}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return zi.payloadify(e)})),poll:e._poll?Wi.payloadify(e._poll):null,parent_message_info:e.parentMessage?p(o(u),"_getParentMessageInfoPayload",this).call(this,e.parentMessage):null})))}}]),u}(Fi),Zi=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u,c,l;r(this,n),(i=t.call(this,e)).plainUrl="",i.fileName=null,i.mimeType=null,i.fileSize=0,i.thumbnails=[],i._requireAuth=!1,i.plainUrl=null!==(s=a.url)&&void 0!==s?s:"",i.fileName=null!==(o=a.file_name)&&void 0!==o?o:null,i.mimeType=null!==(u=a.file_type)&&void 0!==u?u:null,i.fileSize=null!==(c=a.file_size)&&void 0!==c?c:0,i._requireAuth=null!==(l=a.require_auth)&&void 0!==l&&l;var d=Ei.of(i._iid).sessionManager;return i.thumbnails=a.thumbnails?a.thumbnails.map((function(e){return new Hi(Object.assign(Object.assign({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(i._requireAuth?"?auth=".concat(d.ekey):"")}))})):[],i}return i(n,[{key:"url",get:function(){var e=Ei.of(this._iid).sessionManager;return this._requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl}}],[{key:"payloadify",value:function(e){var t;return ce(le({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:e._requireAuth}))}}]),n}(Ya),Ji=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d;if(r(this,u),(i=a.call(this,t,n)).messageParams=null,i.fileInfoList=[],i.messageSurvivalSeconds=-1,i.messageType=e.MessageType.FILE,i.fileInfoList=null!==(o=null===(s=n.files)||void 0===s?void 0:s.map((function(e){return new Zi(t,e)})))&&void 0!==o?o:[],i.messageSurvivalSeconds=null!==(c=n.message_survival_seconds)&&void 0!==c?c:-1,n.parent_message_info){var h=n.parent_message_info;i.parentMessage=$i(t,ce(le(Object.assign(Object.assign({},h),{created_at:h.ts,message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:h.file,url:null===(l=h.file)||void 0===l?void 0:l.url,require_auth:null===(d=h.file)||void 0===d?void 0:d.require_auth}))))}return i}return i(u,[{key:"getThreadedMessagesByTimestamp",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},qi),n),ai(this.messageId>0&&L("number",e)&&Gi(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{files:e.fileInfoList&&e.fileInfoList&&Array.isArray(e.fileInfoList)?e.fileInfoList.map((function(e){return Zi.payloadify(e)})):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?p(o(u),"_getParentMessageInfoPayload",this).call(this,e.parentMessage):null})))}},{key:"_isMultipleFilesMessagePayload",value:function(e){var t=e.files;return Array.isArray(t)&&t.length>=2}},{key:"_isMultipleFilesMessageSerializedData",value:function(e){var t=e.fileInfoList;return Array.isArray(t)}}]),u}(Fi),Xi=function(t){switch(t.messageType){case e.MessageType.USER:return Yi.payloadify(t);case e.MessageType.FILE:return t.fileInfoList?Ji.payloadify(t):es.payloadify(t);case e.MessageType.ADMIN:return ji.payloadify(t);default:throw M.unknown}},$i=function(e,t){switch(t.type){case"MESG":return new Yi(e,t);case"FILE":return Ji._isMultipleFilesMessagePayload(t)?new Ji(e,t):new es(e,t);case"ADMM":case"BRDM":return new ji(e,t)}throw M.unknown},es=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h,f,p,v,_,m,g,y,k;r(this,u),(i=a.call(this,t,n)).messageParams=null,i.plainUrl="",i.requireAuth=!1,i.thumbnails=[],i.messageSurvivalSeconds=-1,i.messageType=e.MessageType.FILE;var E=n.file;i.plainUrl=(null!==(o=null!==(s=null==E?void 0:E.url)&&void 0!==s?s:n.url)&&void 0!==o?o:"").split("?auth=")[0],i.name=null!==(l=null!==(c=null==E?void 0:E.name)&&void 0!==c?c:n.name)&&void 0!==l?l:"File",i.size=null!==(h=null!==(d=null==E?void 0:E.size)&&void 0!==d?d:n.size)&&void 0!==h?h:0,i.data=null!==(p=null!==(f=null==E?void 0:E.data)&&void 0!==f?f:n.custom)&&void 0!==p?p:"",i.type=E?null!==(v=E.type)&&void 0!==v?v:"":null!==(_=n.type)&&void 0!==_?_:"";var b=Ei.of(i._iid).sessionManager;if(i.requireAuth=null!==(m=n.require_auth)&&void 0!==m&&m,i.thumbnails=n.thumbnails?n.thumbnails.map((function(e){return new Hi(Object.assign(Object.assign({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(i.requireAuth?"?auth=".concat(b.ekey):"")}))})):[],i.messageSurvivalSeconds=null!==(g=n.message_survival_seconds)&&void 0!==g?g:-1,n.parent_message_info){var w=n.parent_message_info;i.parentMessage=$i(t,ce(le(Object.assign(Object.assign({},w),{created_at:w.ts,message_id:i.parentMessageId,channel_url:i.channelUrl,channel_type:i.channelType,file:w.file,url:null===(y=w.file)||void 0===y?void 0:y.url,require_auth:null===(k=w.file)||void 0===k?void 0:k.require_auth}))))}return i}return i(u,[{key:"url",get:function(){var e=Ei.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl}},{key:"getThreadedMessagesByTimestamp",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},qi),n),ai(this.messageId>0&&L("number",e)&&Gi(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}}],[{key:"payloadify",value:function(e){var t;return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?p(o(u),"_getParentMessageInfoPayload",this).call(this,e.parentMessage):null})))}}]),u}(Fi),ts=function(t){s(a,t);var n=f(a);function a(t){var i,s,o;r(this,a);var u=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?u=t.mentionedUserIds:t.mentionedUsers&&(u=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"FILE",ackRequired:!0,payload:ce(le({channel_url:t.channelUrl,files:t.files?is(t.files):null,url:t.url,name:null!==(i=t.fileName)&&void 0!==i?i:"",type:null!==(s=t.mimeType)&&void 0!==s?s:"",size:null!==(o=t.fileSize)&&void 0!==o?o:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:u,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId?t.parentMessageId:null,req_id:t.reqId,pin_message:t.isPinnedMessage}))})}return i(a)}(fa),ns=function(t){s(a,t);var n=f(a);function a(t){var i,s,o;r(this,a),i=n.call(this);var u=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?u=t.mentionedUserIds:t.mentionedUsers&&(u=t.mentionedUsers.map((function(e){return e.userId})))),i.method=de.POST,i.path="".concat(Se(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),i.params=ce(le({message_type:e.MessageType.FILE,user_id:t.userId,files:t.files?is(t.files):null,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:u,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:null===(s=t.thumbnailSizes)||void 0===s?void 0:s.map((function(e){return Hi.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(o=t.metaArrays)||void 0===o?void 0:o.map((function(e){return Ai.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId?t.parentMessageId:null,apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,reply_to_channel:t.isReplyToChannel,req_id:t.reqId,pin_message:t.isPinnedMessage})),i}return i(a)}(Ue),rs=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c,l;r(this,n),(s=t.call(this,e,"FILE",i)).message=i.files&&i.files.length>=2?new Ji(e,i):new es(e,i);var d=Ei.of(e).sdkState;return s.isMentioned=Ne(s.message.mentionType,null!==(c=null!==(o=s.message.mentionedUserIds)&&void 0!==o?o:null===(u=s.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})))&&void 0!==c?c:[],d.userId),s.forceUpdateLastMessage=null!==(l=i.force_update_last_message)&&void 0!==l&&l,s}return i(n)}(Qe),as=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u,c;r(this,n),(i=t.call(this,e,a)).message=a.files&&a.files.length>=2?new Ji(e,a):new es(e,a);var l=Ei.of(e).sdkState;return i.isMentioned=Ne(i.message.mentionType,null!==(u=null!==(s=i.message.mentionedUserIds)&&void 0!==s?s:null===(o=i.message.mentionedUsers)||void 0===o?void 0:o.map((function(e){return e.userId})))&&void 0!==u?u:[],l.userId),i.forceUpdateLastMessage=null!==(c=a.force_update_last_message)&&void 0!==c&&c,i}return i(n)}(De);function is(e){return e.map((function(e){var t,n;return ce(le({url:e.fileUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnailSizes)||void 0===t?void 0:t.map((function(e){return Hi.payloadify(e)})),require_auth:null===(n=e._uploadedMetaData)||void 0===n?void 0:n.requireAuth}))}))}var ss;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(ss||(ss={}));var os=function(){function e(t,n){var a=this,i=n.sdkState,s=n.dispatcher,o=n.requestQueue,u=n.onlineDetector,c=n.cacheContext;r(this,e),this._queueMap=new Map,this._iid=t,this._sdkState=i,this._requestQueue=o,this._cacheContext=c,this._dispatcher=s,this._dispatcher.on((function(e){e instanceof ga&&(a._connectionState=e.stateType)})),this._onlineDetector=u}return i(e,[{key:"_shouldSendThroughWebSocket",get:function(){return this._connectionState===da.CONNECTED||this._connectionState===da.CONNECTING||this._connectionState===da.RECONNECTING}},{key:"_sendFileMessage",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this._createSendFileMessageRequestParams(e,n),!this._shouldSendThroughWebSocket){t.next=10;break}return i=new ts(a),t.next=5,this._requestQueue.send(i);case 5:return s=t.sent,o=s.as(rs),u=o.message,t.abrupt("return",u);case 10:return c=new ns(Object.assign(Object.assign({},a),{userId:this._sdkState.userId})),t.next=13,this._requestQueue.send(c);case 13:return l=t.sent,d=l.as(as),h=d.message,t.abrupt("return",h);case 16:case"end":return t.stop()}}),r,this)})))}},{key:"_createSendFileMessageRequestParams",value:function(e,t){var n=Object.assign(Object.assign({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){var r=t.params;n.files=r.fileInfoList}else{var a=t.params;n.url=a.fileUrl,n.requireAuth=a.requireAuth}return n}},{key:"_resolveMessageQueue",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=this._queueMap.get(e.url))){t.next=58;break}if(a.isResolving){t.next=57;break}a.isResolving=!0,i=[],s=!0,o=y(a.messageQueue),t.prev=7,o.s();case 9:if((u=o.n()).done){t.next=40;break}c=u.value,t.t0=c.state,t.next=t.t0===ss.PENDING||t.t0===ss.UPLOADING?14:t.t0===ss.UPLOADED?17:t.t0===ss.FAILED?35:38;break;case 14:return s=!1,i.push(c),t.abrupt("break",38);case 17:if(!s){t.next=33;break}return t.prev=18,c.state=ss.SENDING,t.next=22,this._sendFileMessage(e,c);case 22:return l=t.sent,c.deferred.resolve(l),t.next=26,Sa(100);case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(18),c.deferred.reject(t.t1);case 31:t.next=34;break;case 33:i.push(c);case 34:return t.abrupt("break",38);case 35:return d=null!==(n=c.error)&&void 0!==n?n:M.unknown,c.deferred.reject(d.code===b.REQUEST_CANCELED?M.fileUploadCanceled:d),t.abrupt("break",38);case 38:t.next=9;break;case 40:t.next=45;break;case 42:t.prev=42,t.t2=t.catch(7),o.e(t.t2);case 45:return t.prev=45,o.f(),t.finish(45);case 48:if(h=a.isResolveRequestPending,a.messageQueue=i,a.isResolving=!1,a.isResolveRequestPending=!1,!h){t.next=55;break}return t.next=55,this._resolveMessageQueue(e);case 55:t.next=58;break;case 57:a.isResolveRequestPending=!0;case 58:case"end":return t.stop()}}),r,this,[[7,42,45,48],[18,28]])})))}},{key:"_uploadNextPendingItem",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h,f;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=this._queueMap.get(e.url))){t.next=30;break}if(!(i=a.messageQueue.find((function(e){return e.state===ss.PENDING})))){t.next=30;break}if(!i.multipleFileUploadInfo){t.next=19;break}if(s=i.multipleFileUploadInfo,o=s.uploadIndex,u=s.uploadCount,c=s.requestHandler,l=i.params,d=l.fileInfoList[o],!q(d.file)||(null===(n=d._uploadedMetaData)||void 0===n?void 0:n.isUploaded)){t.next=13;break}return t.next=11,this._tryUploadNextItemAndUpdateItemState(e,a,i);case 11:t.next=14;break;case 13:i.state=o<u-1?ss.PENDING:ss.UPLOADED;case 14:h=o,null==c||c._triggerOnFileUploaded(i.requestId,h,d,i.error),i.multipleFileUploadInfo.uploadIndex++,t.next=27;break;case 19:if(f=i.params,!q(f.file)){t.next=25;break}return t.next=23,this._tryUploadNextItemAndUpdateItemState(e,a,i);case 23:t.next=27;break;case 25:f.thumbnailSizes=[],i.state=ss.UPLOADED;case 27:return this._uploadNextPendingItem(e),t.next=30,this._resolveMessageQueue(e);case 30:case"end":return t.stop()}}),r,this)})))}},{key:"_tryUploadNextItemAndUpdateItemState",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._onlineDetector.isOnline();case 2:if(i=t.sent,s=Ei.of(this._iid),s.sessionManager.currentUser&&i){t.next=8;break}return r.error=M.connectionRequired,r.state=ss.FAILED,t.abrupt("return");case 8:if(!(n.uploadQueue.length<6)){t.next=31;break}if(r.state=ss.UPLOADING,n.uploadQueue.push(r),t.prev=11,!r.multipleFileUploadInfo){t.next=20;break}return o=r.multipleFileUploadInfo,u=o.uploadIndex,c=o.uploadCount,l=r.params,t.next=17,this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,r,l);case 17:r.state=u<c-1?ss.PENDING:ss.UPLOADED,t.next=24;break;case 20:return d=r.params,t.next=23,this._uploadNextFileForSingleFileItemAndUpdateParams(e,r,d);case 23:r.state=ss.UPLOADED;case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(11),r.error=t.t0.code===b.REQUEST_FAILED?new M({code:b.NETWORK_ERROR,message:"Failed to upload a file."}):t.t0,r.state=ss.FAILED;case 30:this._dequeueUploadItem(n,r);case 31:case"end":return t.stop()}}),a,this,[[11,26]])})))}},{key:"_dequeueUploadItem",value:function(e,t){var n=e.uploadQueue.findIndex((function(e){return e.requestId===t.requestId}));n>=0&&e.uploadQueue.splice(n,1)}},{key:"_uploadNextFileForSingleFileItemAndUpdateParams",value:function(e,n,r){var a,i,s;return E(this,void 0,void 0,t().mark((function o(){var u,c,l,d,h,f,p,v,_,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=new wi({file:r.file,channelUrl:e.url,thumbnailSizes:r.thumbnailSizes,requestId:n.requestId}),t.next=3,this._requestQueue.send(u);case 3:c=t.sent,l=c.as(Ci),d=l.url,h=l.fileSize,f=void 0===h?r.fileSize:h,p=l.thumbnailSizes,v=void 0===p?r.thumbnailSizes:p,_=l.requireAuth,m=void 0!==_&&_,r.fileName=null!==(a=r.fileName)&&void 0!==a?a:r.file.name,r.mimeType=null!==(i=r.mimeType)&&void 0!==i?i:r.file.type,r.fileSize=null!==(s=r.fileSize)&&void 0!==s?s:r.file.size,r.fileUrl=d,r.fileSize=f,r.thumbnailSizes=v,r.requireAuth=m;case 12:case"end":return t.stop()}}),o,this)})))}},{key:"_uploadNextFileForMultipleFilesItemAndUpdateParams",value:function(e,n,r){var a,i,s;return E(this,void 0,void 0,t().mark((function o(){var u,c,l,d,h,f,p,v,_,m,g,y;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=n.multipleFileUploadInfo.uploadIndex,c=r.fileInfoList[u],l=new wi({file:c.file,channelUrl:e.url,thumbnailSizes:c.thumbnailSizes,requestId:n.requestId}),t.next=5,this._requestQueue.send(l);case 5:d=t.sent,h=d.as(Ci),f=h.url,p=h.fileSize,v=void 0===p?c.fileSize:p,_=h.thumbnailSizes,m=void 0===_?c.thumbnailSizes:_,g=h.requireAuth,y=void 0!==g&&g,c.fileName=null!==(a=c.fileName)&&void 0!==a?a:c.file.name,c.mimeType=null!==(i=c.mimeType)&&void 0!==i?i:c.file.type,c.fileSize=null!==(s=c.fileSize)&&void 0!==s?s:c.file.size,c.file=void 0,c.fileUrl=f,c.fileSize=v,c.thumbnailSizes=m,c._uploadedMetaData=Object.assign(Object.assign({},c._uploadedMetaData),{requireAuth:y,isUploaded:!0});case 15:case"end":return t.stop()}}),o,this)})))}},{key:"request",value:function(e,n,r,a){return E(this,void 0,void 0,t().mark((function i(){var s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._queueMap.has(e.url)||(s={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(e.url,s)),o=this._queueMap.get(e.url),u=new va,c={requestId:n,params:r,state:ss.PENDING,deferred:u},us(r)&&(l={uploadIndex:0,uploadCount:r.fileInfoList.length,requestHandler:a},c.multipleFileUploadInfo=l),o.messageQueue.push(c),this._uploadNextPendingItem(e),t.abrupt("return",u.promise);case 8:case"end":return t.stop()}}),i,this)})))}},{key:"cancel",value:function(e,t){var n=this._queueMap.get(e.url);if(n){var r,a=t?[n.messageQueue.find((function(e){return e.requestId===t}))]:_(n.messageQueue),i=y(a);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(s)switch(s.state){case ss.PENDING:s.state=ss.FAILED,s.error=M.requestCanceled,this._resolveMessageQueue(e);break;case ss.UPLOADING:this._requestQueue.cancel(s.requestId)}}}catch(e){i.e(e)}finally{i.f()}}}}]),e}();function us(e){return"fileInfoList"in e}var cs,ls={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:e.ReplyType.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},ds=function(t){return L("number",t.prevResultSize)&&L("number",t.nextResultSize)&&L("boolean",t.isInclusive)&&L("boolean",t.reverse)&&L("string",t.messageTypeFilter)&&R(e.MessageTypeFilter,t.messageTypeFilter)&&F("string",t.customTypesFilter,!0)&&F("string",t.senderUserIdsFilter,!0)&&R(e.ReplyType,t.replyType)&&L("boolean",t.includeMetaArray)&&L("boolean",t.includeReactions)&&L("boolean",t.includeParentMessageInfo)&&L("boolean",t.includeThreadInfo)&&L("boolean",t.showSubchannelMessagesOnly)},hs={replyType:e.ReplyType.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},fs=function(t){return R(e.ReplyType,t.replyType)&&L("boolean",t.includeReactions)&&L("boolean",t.includeMetaArray)&&L("boolean",t.includeParentMessageInfo)&&L("boolean",t.includeThreadInfo)};e.CollectionEventSource=void 0,(cs=e.CollectionEventSource||(e.CollectionEventSource={})).UNKNOWN="UNKNOWN",cs.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",cs.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",cs.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",cs.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",cs.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",cs.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",cs.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",cs.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",cs.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",cs.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",cs.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",cs.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",cs.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",cs.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",cs.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",cs.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",cs.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",cs.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",cs.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",cs.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",cs.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",cs.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",cs.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",cs.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",cs.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",cs.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",cs.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",cs.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",cs.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",cs.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",cs.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",cs.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",cs.REQUEST_CHANNEL="REQUEST_CHANNEL",cs.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",cs.REFRESH_CHANNEL="REFRESH_CHANNEL",cs.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",cs.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",cs.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",cs.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",cs.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",cs.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",cs.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",cs.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",cs.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",cs.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",cs.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",cs.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",cs.REQUEST_MESSAGE="REQUEST_MESSAGE",cs.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",cs.EVENT_POLL_VOTED="EVENT_POLL_VOTED",cs.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",cs.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",cs.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",cs.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",cs.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",cs.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",cs.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",cs.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",cs.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",cs.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",cs.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";var ps,vs=Object.assign({},e.CollectionEventSource),_s=function(t){return t.startsWith("EVENT_")||t.startsWith("LOCAL_MESSAGE_")||t===e.CollectionEventSource.SYNC_MESSAGE_FILL||t===e.CollectionEventSource.SYNC_MESSAGE_CHANGELOGS||t===e.CollectionEventSource.SYNC_POLL_CHANGELOGS},ms=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.messages,s=e.source,o=e.isWebSocketEventComing,u=void 0!==o&&o;return r(this,n),(a=t.call(this)).messages=i,a.source=s,a.isWebSocketEventComing=u,a}return i(n)}(ue),gs=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.messageIds,s=e.source,o=e.isWebSocketEventComing,u=void 0!==o&&o;return r(this,n),(a=t.call(this)).messageIds=i,a.source=s,a.isWebSocketEventComing=u,a}return i(n)}(ue),ys=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.reqId,s=e.source;return r(this,n),(a=t.call(this)).reqId=i,a.source=s,a}return i(n)}(ue),ks=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.polls,s=e.source;return r(this,n),(a=t.call(this)).polls=i,a.source=s,a}return i(n)}(ue),Es=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.event,s=e.source;return r(this,n),(a=t.call(this)).event=i,a.source=s,a}return i(n)}(ue),bs=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.event,s=e.source;return r(this,n),(a=t.call(this)).event=i,a.source=s,a}return i(n)}(ue),ws=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/").concat(encodeURIComponent(o)),a.params={is_sdk:!0,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_parent_message_info:d,include_poll_details:!0},a}return i(n)}(Ue),Cs=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).message=a?$i(e,Object.assign({},a)):null,i}return i(n)}(De),xs=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token,c=e.prevResultSize,l=e.nextResultSize,d=e.isInclusive,h=e.reverse,f=e.messageTypeFilter,p=e.customTypesFilter,v=e.senderUserIdsFilter,_=e.replyType,m=e.includeMetaArray,g=e.includeReactions,y=e.parentMessageId,k=e.includeThreadInfo,E=e.includeParentMessageInfo,b=e.showSubchannelMessagesOnly,w=e.checkingContinuousMessages;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages"),a.params=ce(le({is_sdk:!0,prev_limit:c,next_limit:l,include:d,reverse:h,message_ts:o,message_id:u,message_type:null!=f?f:null,custom_types:p,sender_ids:v,include_reply_type:_,with_sorted_meta_array:m,include_reactions:g,parent_message_id:y,include_thread_info:k,include_parent_message_info:E,show_subchannel_message_only:b,include_poll_details:!0,checking_continuous_messages:w})),a}return i(n)}(Ue),Ts=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).messages=a.messages.map((function(t){return $i(e,t)})),i}return i(n)}(De),Ss=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token,c=e.replyType,l=e.includeMetaArray,d=e.includeReactions,h=e.includeThreadInfo,f=e.includeParentMessageInfo;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/changelogs"),a.params={change_ts:o,token:u,with_sorted_meta_array:l,include_reactions:d,include_thread_info:h,include_reply_type:c,include_parent_message_info:f,include_poll_details:!0},a}return i(n)}(Ue),Is=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).updatedMessages=a.updated.map((function(t){return $i(e,t)})),i.deletedMessagesInfo=a.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),i.hasMore=a.has_more,i.nextToken=a.next,i}return i(n)}(De),Ns=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.scheduledMessageId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(s)),a.params={},a}return i(n)}(Ue),As=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).message=a?$i(e,Object.assign({},a)):null,i}return i(n)}(De);e.RestrictionType=void 0,(ps=e.RestrictionType||(e.RestrictionType={})).MUTED="muted",ps.BANNED="banned";var Ms,Os=function(){function t(n){var a,i,s,o;r(this,t),this.restrictionType=null,R(e.RestrictionType,n.restriction_type)&&(this.restrictionType=n.restriction_type),this.description=null!==(a=n.description)&&void 0!==a?a:null,this.endAt=null!==(s=null!==(i=n.end_at)&&void 0!==i?i:n.muted_end_at)&&void 0!==s?s:-1,this.remainingDuration=null!==(o=n.remaining_duration)&&void 0!==o?o:-1}return i(t,null,[{key:"payloadify",value:function(e){return ce(le({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt,remaining_duration:e.remainingDuration}))}}]),t}(),Us=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).restrictionInfo=new Os(a),i}return i(n,null,[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(n),"payloadify",this).call(this,e)),Os.payloadify(e.restrictionInfo))))}}]),n}(si),Ds=function(e){s(n,e);var t=f(n);function n(e,a){var i,s;return r(this,n),(i=t.call(this,e,a)).isMuted=!1,i.isMuted=null!==(s=a.is_muted)&&void 0!==s&&s,i}return i(n)}(si),Ls=function(){function t(){r(this,t),this._onPending=Ke,this._onFailed=Ke,this._onSucceeded=Ke}return i(t,[{key:"_trigger",value:function(t){switch(null==t?void 0:t.sendingStatus){case e.SendingStatus.PENDING:0===t.errorCode&&this._onPending(t);break;case e.SendingStatus.SCHEDULED:case e.SendingStatus.SUCCEEDED:this._onSucceeded(t)}}},{key:"_triggerFailed",value:function(t,n){switch(null==n?void 0:n.sendingStatus){case e.SendingStatus.FAILED:case e.SendingStatus.CANCELED:this._onFailed(t,n.scheduledInfo?null:n)}}},{key:"onPending",value:function(e){return this._onPending=e,this}},{key:"onFailed",value:function(e){return this._onFailed=e,this}},{key:"onSucceeded",value:function(e){return this._onSucceeded=e,this}}]),t}(),Rs={data:void 0,customType:void 0,mentionType:e.MentionType.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},Ps=function(t){return L("string",t.data,!0)&&L("string",t.customType,!0)&&R(e.MentionType,t.mentionType)&&F("string",t.mentionedUserIds,!0)&&F(si,t.mentionedUsers,!0)&&L("string",t.mentionedMessageTemplate,!0)&&F(Ai,t.metaArrays,!0)&&L("number",t.parentMessageId,!0)&&L("boolean",t.isReplyToChannel)&&R(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&L(Ui,t.appleCriticalAlertOptions,!0)&&L("boolean",t.isPinnedMessage,!0)},Fs=function(e){return{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}},Hs=Object.assign(Object.assign({},Rs),{message:"",translationTargetLanguages:void 0,pollId:void 0}),qs=function(e){var t;return ce(le({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)}))},Gs=function(e){return Ps(e)&&L("string",e.message)&&F("string",e.translationTargetLanguages,!0)&&L("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(Ms||(Ms={}));var js,zs=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},Vs=function(e){return e===Ms.BLOB||e===Ms.FILE},Bs=function(e){return{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}},Qs=Object.assign(Object.assign({},Rs),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1}),Ks=function(e,t){var n;return e.messageParams?(!e.url&&q(t)&&(e.messageParams.file=t),e.messageParams):ce(le({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:null===(n=e.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))}))},Ws=function(e){return Ps(e)&&(q(e.file)||L("string",e.fileUrl))&&L("string",e.fileName,!0)&&L("string",e.mimeType,!0)&&L("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return L("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Ys={data:void 0,customType:void 0,mentionType:e.MentionType.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},Zs=function(t){return L("string",t.data,!0)&&L("string",t.customType,!0)&&R(e.MentionType,t.mentionType)&&F("string",t.mentionedUserIds,!0)&&F(si,t.mentionedUsers,!0)&&L("string",t.mentionedMessageTemplate,!0)&&F(Ai,t.metaArrays,!0)&&R(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&L(Ui,t.appleCriticalAlertOptions,!0)},Js=Object.assign(Object.assign({},Ys),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),Xs=function(e){return Zs(e)&&L("string",e.message,!0)&&F("string",e.translationTargetLanguages,!0)&&L("number",e.pollId,!0)},$s=Object.assign({},Ys),eo=function(e){return Zs(e)},to=function(){function e(t,n){var a;r(this,e),this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=t,this.limit=null!==(a=n.limit)&&void 0!==a?a:20}return i(e,[{key:"hasNext",get:function(){return this._hasNext}},{key:"isLoading",get:function(){return this._isLoading}},{key:"_validate",value:function(){return L("number",this.limit)&&this.limit>0}}]),e}(),no=function(t){s(a,t);var n=f(a);function a(e,t,i,s){var o;return r(this,a),(o=n.call(this,e,s)).channelUrl=t,o.channelType=i,o}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)&&L("string",this.channelUrl)&&R(e.ChannelType,this.channelType)}}]),a}(to),ro=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.channelType,o=e.token,u=e.limit;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/operators"),a.params={token:o,limit:u},a}return i(n)}(Ue),ao=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).operators=a.operators.map((function(t){return new si(e,t)})),i.token=a.next,i}return i(n)}(De),io=function(e){s(a,e);var n=f(a);function a(e,t,i,s){return r(this,a),n.call(this,e,t,i,s)}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(n=[],!this._hasNext){e.next=15;break}return this._isLoading=!0,r=Ei.of(this._iid),a=r.requestQueue,i=new ro(Object.assign(Object.assign({},this),{channelUrl:this.channelUrl,token:this._token})),e.next=9,a.send(i);case 9:return s=e.sent,o=s.as(ao),u=o.operators,c=o.token,this._token=c,this._hasNext=!!c,this._isLoading=!1,e.abrupt("return",u);case 15:return e.abrupt("return",n);case 18:throw M.queryInProgress;case 19:e.next=22;break;case 21:throw M.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),a}(no),so=function(n){s(u,n);var a=f(u);function u(t,n,i,s){var o,c,l,d,h,f,p,v,_,m,g;return r(this,u),(o=a.call(this,t,n,i,s)).reverse=!1,o.messageTypeFilter=e.MessageTypeFilter.ALL,o.customTypesFilter=null,o.senderUserIdsFilter=null,o.replyType=e.ReplyType.NONE,o.includeMetaArray=!1,o.includeReactions=!1,o.includeParentMessageInfo=!1,o.includeThreadInfo=!1,o.showSubchannelMessagesOnly=!1,o._edge=Number.MAX_SAFE_INTEGER,o.reverse=null!==(c=s.reverse)&&void 0!==c&&c,o.messageTypeFilter=null!==(l=s.messageTypeFilter)&&void 0!==l?l:e.MessageTypeFilter.ALL,o.customTypesFilter=null!==(d=s.customTypesFilter)&&void 0!==d?d:null,o.senderUserIdsFilter=null!==(h=s.senderUserIdsFilter)&&void 0!==h?h:null,o.replyType=null!==(f=s.replyType)&&void 0!==f?f:e.ReplyType.NONE,o.includeMetaArray=null!==(p=s.includeMetaArray)&&void 0!==p&&p,o.includeReactions=null!==(v=s.includeReactions)&&void 0!==v&&v,o.includeParentMessageInfo=null!==(_=s.includeParentMessageInfo)&&void 0!==_&&_,o.includeThreadInfo=null!==(m=s.includeThreadInfo)&&void 0!==m&&m,o.showSubchannelMessagesOnly=null!==(g=s.showSubchannelMessagesOnly)&&void 0!==g&&g,o}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)&&L("boolean",this.reverse)&&R(e.MessageTypeFilter,this.messageTypeFilter)&&R(e.ReplyType,this.replyType)&&F("string",this.customTypesFilter,!0)&&F("string",this.senderUserIdsFilter,!0)&&L("boolean",this.includeMetaArray)&&L("boolean",this.includeReactions)&&L("boolean",this.includeParentMessageInfo)&&L("boolean",this.includeThreadInfo)&&L("boolean",this.showSubchannelMessagesOnly)}},{key:"load",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=18;break}if(this._isLoading){e.next=15;break}if(!this._hasNext){e.next=12;break}return this._isLoading=!0,n=Ll.of(this._iid),e.next=7,n.getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,le({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}));case 7:return r=e.sent,this._edge=Math.min.apply(Math,[Number.MAX_SAFE_INTEGER].concat(_(r.map((function(e){return e.createdAt}))))),this._hasNext=r.length>=this.limit,this._isLoading=!1,e.abrupt("return",r);case 12:return e.abrupt("return",[]);case 15:throw M.queryInProgress;case 16:e.next=19;break;case 18:throw M.invalidParameters;case 19:case"end":return e.stop()}}),e,this)})))}}]),u}(no),oo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.limit,u=e.token;return(a=t.call(this)).method=de.GET,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/mute"),a.params={limit:o,token:u},a}return i(n)}(Ue),uo=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).mutedUsers=[];var s=a.next,o=a.muted_list;return i.token=s,o&&o.length>0&&(i.mutedUsers=o.map((function(t){return new Us(e,t)}))),i}return i(n)}(De),co=function(e){s(a,e);var n=f(a);function a(e,t,i,s){return r(this,a),n.call(this,e,t,i,s)}return i(a,[{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new oo(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(uo),o=s.mutedUsers,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(no),lo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.limit,u=e.token;return(a=t.call(this)).method=de.GET,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/ban"),a.params=ce({limit:o,token:u}),a}return i(n)}(Ue),ho=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).bannedUsers=[];var s=a.next,o=a.banned_list;return i.token=s,o&&o.length>0&&(i.bannedUsers=o.map((function(t){return new Us(e,t.user)}))),i}return i(n)}(De),fo=function(e){s(a,e);var n=f(a);function a(e,t,i,s){return r(this,a),n.call(this,e,t,i,s)}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new lo(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(ho),o=s.bannedUsers,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(no);e.ReportCategory=void 0,(js=e.ReportCategory||(e.ReportCategory={})).SPAM="spam",js.HARASSING="harassing",js.SUSPICIOUS="suspicious",js.INAPPROPRIATE="inappropriate";var po,vo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(a=t.call(this)).method=de.POST,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/operators"),a.params={operator_ids:o},a}return i(n)}(Ue),_o=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.operatorUserIds;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/operators"),a.params={operator_ids:o},a}return i(n)}(Ue),mo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.userId;return(a=t.call(this)).method=de.GET,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/mute/").concat(o),a}return i(n)}(Ue),go=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).isMuted=!1,i.startAt=0,i.endAt=0;var s=a.is_muted,o=a.start_at,u=a.end_at,c=a.remaining_duration,l=a.description;return i.isMuted=s,i.startAt=o,i.endAt=u,i.remainingDuration=c,i.description=l,i}return i(n)}(De),yo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.keys;return(a=t.call(this)).method=de.GET,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={keys:o,include_ts:!0},a}return i(n)}(Ue),ko=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.metadata,o=a.ts;return i.metadata=s,i.ts=o,i}return i(n)}(De),Eo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.metadata;return(a=t.call(this)).method=de.POST,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={metadata:o,include_ts:!0},a}return i(n)}(Ue),bo=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o;return r(this,n),(i=t.call(this,e,a)).metaData=null!==(s=a.metadata)&&void 0!==s?s:{},i.ts=null!==(o=a.ts)&&void 0!==o?o:null,i}return i(n)}(De),wo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.metadata,u=e.upsert;return(a=t.call(this)).method=de.PUT,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={metadata:o,include_ts:!0,upsert:null!=u&&u},a}return i(n)}(Ue),Co=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.metadata,o=a.ts;return i.metadata=s,i.ts=o,i}return i(n)}(De),xo=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),s=t.call(this,e,"SYEV",i),i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return i(n)}(Qe),To=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.key;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(o),a.params={include_ts:!0},a}return i(n)}(Ue),So=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.ts;return i.ts=s,i}return i(n)}(De),Io=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metadata"),a.params={include_ts:!0},a}return i(n)}(Ue),No=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.ts;return i.ts=s,i}return i(n)}(De),Ao=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.keys;return(a=t.call(this)).method=de.GET,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={keys:o},a}return i(n)}(Ue),Mo=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).metaCounter=a,i}return i(n)}(De),Oo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.metaCounter;return(a=t.call(this)).method=de.POST,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={metacounter:o},a}return i(n)}(Ue),Uo=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).metaCounter=a,i}return i(n)}(De),Do=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.metaCounter,u=e.upsert,c=void 0!==u&&u,l=e.mode,d=void 0===l?"set":l;return(a=t.call(this)).method=de.PUT,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={metacounter:o,upsert:c,mode:d},a}return i(n)}(Ue),Lo=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).metaCounter=a,i}return i(n)}(De),Ro=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),s=t.call(this,e,"SYEV",i),i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return i(n)}(Qe),Po=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.key;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(o),a.params={},a}return i(n)}(Ue),Fo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/metacounter"),a.params={},a}return i(n)}(Ue),Ho=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(a=t.call(this)).method=de.POST,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/mute"),a.params={user_id:o,seconds:u,description:c},a}return i(n)}(Ue),qo=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).user=new Us(e,i.data),s}return i(n)}(Qe),Go=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.userId;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(o)),a}return i(n)}(Ue),jo=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).user=new Us(e,i.data),s}return i(n)}(Qe),zo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(a=t.call(this)).method=de.POST,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/ban"),a.params=ce({user_id:o,seconds:u,description:c}),a}return i(n)}(Ue),Vo=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).user=new Us(e,i.data),i.data.member_count&&(s.memberCount=i.data.member_count),i.data.joined_member_count&&(s.joinedMemberCount=i.data.joined_member_count),s}return i(n)}(Qe),Bo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.userId;return(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(o)),a}return i(n)}(Ue),Qo=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).user=new Us(e,i.data),s}return i(n)}(Qe),Ko=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.freezing;return(a=t.call(this)).method=de.PUT,a.path="".concat(Se(s),"/").concat(encodeURIComponent(i),"/freeze"),a.params={freeze:o},a}return i(n)}(Ue),Wo=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).freeze=i.data.freeze,s}return i(n)}(Qe),Yo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.category,u=e.userId,c=e.description;return(a=t.call(this)).method=de.POST,a.path="".concat(Ie(s),"/").concat(encodeURIComponent(i)),a.params={report_category:o,reporting_user_id:u,report_description:c},a}return i(n)}(Ue),Zo=function(t){s(a,t);var n=f(a);function a(t){var i;r(this,a);var s=t.channelUrl,o=t.channelType,u=t.category,c=t.userId,l=t.offendingUserId,d=t.description;return(i=n.call(this)).method=de.POST,i.path="".concat(ke,"/users/").concat(l),i.params={channel_url:s,channel_type:o===e.ChannelType.OPEN?"open_channels":"group_channels",report_category:u,reporting_user_id:c,report_description:d},i}return i(a)}(Ue),Jo=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.channelType,o=e.category,u=e.userId,c=e.offendingUserId,l=e.messageId,d=e.description;return(a=t.call(this)).method=de.POST,a.path="".concat(Ie(s),"/").concat(encodeURIComponent(i),"/messages/").concat(l),a.params={report_category:o,reporting_user_id:u,report_description:d,offending_user_id:c},a}return i(n)}(Ue),Xo=function(t){s(a,t);var n=f(a);function a(t){r(this,a);var i=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"MESG",ackRequired:!0,payload:ce(le({channel_url:t.channelUrl,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:i,mentioned_message_template:t.mentionedMessageTemplate,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId?t.parentMessageId:null,req_id:t.reqId,poll_id:t.pollId,pin_message:t.isPinnedMessage}))})}return i(a)}(fa),$o=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c,l;r(this,n),(s=t.call(this,e,"MESG",i)).message=new Yi(e,i);var d=Ei.of(e).sdkState;return s.isMentioned=Ne(s.message.mentionType,null!==(c=null!==(o=s.message.mentionedUserIds)&&void 0!==o?o:null===(u=s.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})))&&void 0!==c?c:[],d.userId),s.forceUpdateLastMessage=null!==(l=i.force_update_last_message)&&void 0!==l&&l,s}return i(n)}(Qe),eu=function(t){s(a,t);var n=f(a);function a(t){r(this,a);var i=null;return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"MEDI",ackRequired:!0,payload:ce(le({channel_url:t.channelUrl,msg_id:t.messageId,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:i,mentioned_message_template:t.mentionedMessageTemplate,apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,poll_id:t.pollId}))})}return i(a)}(fa),tu=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c,l,d;r(this,n),(s=t.call(this,e,"MEDI",i)).message=new Yi(e,i);var h=Ei.of(e).sdkState;return s.mentionCountChange=Ae({mentionType:null===(o=i.old_values)||void 0===o?void 0:o.mention_type,mentionedUserIds:null!==(c=null===(u=i.old_values)||void 0===u?void 0:u.mentioned_user_ids)&&void 0!==c?c:[]},le({mentionType:s.message.mentionType,mentionedUserIds:null!==(l=s.message.mentionedUserIds)&&void 0!==l?l:null===(d=s.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))}),h.userId),s}return i(n)}(Qe),nu=function(t){s(a,t);var n=f(a);function a(t){r(this,a);var i=null;return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"FEDI",ackRequired:!0,payload:ce(le({channel_url:t.channelUrl,msg_id:t.messageId,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:i,apple_critical_alert_options:t.appleCriticalAlertOptions}))})}return i(a)}(fa),ru=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c,l,d;r(this,n),(s=t.call(this,e,"FEDI",i)).message=new es(e,i);var h=Ei.of(e).sdkState;return s.mentionCountChange=Ae({mentionType:null===(o=i.old_values)||void 0===o?void 0:o.mention_type,mentionedUserIds:null!==(c=null===(u=i.old_values)||void 0===u?void 0:u.mentioned_user_ids)&&void 0!==c?c:[]},le({mentionType:s.message.mentionType,mentionedUserIds:null!==(l=s.message.mentionedUserIds)&&void 0!==l?l:null===(d=s.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))}),h.userId),s}return i(n)}(Qe),au=function(e){s(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),a}return i(n)}(Ue),iu=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"DELM",i)).channelUrl=i.channel_url,s.channelType=i.channel_type,s.messageId=Number(i.msg_id),s}return i(n)}(Qe),su=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.reactionKey;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/reactions"),a.params={reaction:u},a}return i(n)}(Ue),ou=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).reactionEvent=new Ii(a),i}return i(n)}(De),uu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.reactionKey;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/reactions"),a.params={reaction:u},a}return i(n)}(Ue),cu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).reactionEvent=new Ii(Object.assign({},a)),i}return i(n)}(De),lu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId,u=e.translationTargetLanguages;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/").concat(encodeURIComponent(o),"/translation"),a.params={target_langs:u},a}return i(n)}(Ue),du=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).message=new Yi(e,a),i}return i(n)}(De),hu=function(t){s(a,t);var n=f(a);function a(t){var i,s;r(this,a),i=n.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl;return i.method=de.POST,i.path="".concat(Se(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),i.params=ce(le({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Z.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(s=t.metaArrays)||void 0===s?void 0:s.map((function(e){return Ai.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption})),i}return i(a)}(Ue),fu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).message=new Yi(e,a),i}return i(n)}(De),pu=function(t){s(a,t);var n=f(a);function a(t){var i,s;r(this,a),i=n.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl;return i.method=de.POST,i.path="".concat(Se(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),i.params=le({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Z.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return Hi.payloadify(e)})):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(s=t.metaArrays)||void 0===s?void 0:s.map((function(e){return Ai.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,push_option:t.pushNotificationDeliveryOption}),i}return i(a)}(Ue),vu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).message=new es(e,a),i}return i(n)}(De),_u=function(e){return L("string",e.title,!0)&&Qi(e.data)&&L("boolean",e.allowUserSuggestion,!0)&&L("boolean",e.allowMultipleVotes,!0)&&L("number",e.closeAt,!0)},mu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.pollId,s=e.title,o=e.data,u=e.allowUserSuggestion,c=e.allowMultipleVotes,l=e.closeAt;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(i)),a.params={title:s,data:o,allow_user_suggestion:u,allow_multiple_votes:c,close_at:l},a}return i(n)}(Ue),gu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).poll=new Wi(e,a),i}return i(n)}(De),yu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.pollId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(we,"/").concat(encodeURIComponent(i)),a}return i(n)}(Ue),ku=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.pollId;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(i),"/close"),a}return i(n)}(Ue),Eu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).poll=new Wi(e,a),i}return i(n)}(De),bu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId,u=e.optionText;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(we,"/").concat(encodeURIComponent(o),"/options"),a.params={channel_url:i,channel_type:s,text:u},a}return i(n)}(Ue),wu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).poll=new Wi(e,a),i}return i(n)}(De),Cu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.pollId,s=e.pollOptionId,o=e.optionText;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),a.params={text:o},a}return i(n)}(Ue),xu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).poll=new Wi(e,a),i}return i(n)}(De),Tu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.pollId,s=e.pollOptionId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(we,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(s)),a}return i(n)}(Ue),Su=function(t){s(a,t);var n=f(a);function a(t){var i=t.reqId,s=t.channelType,o=t.channelUrl,u=t.pollId,c=t.pollOptionIds;return r(this,a),n.call(this,{code:"VOTE",ackRequired:!0,payload:ce({req_id:i,channel_type:s===e.ChannelType.OPEN?"open_channels":"group_channels",channel_url:o,poll_id:u,option_ids:c})})}return i(a)}(fa),Iu=i((function e(t){r(this,e),this.pollId=0,this.messageId=0,this.pollId=t.poll_id,this.messageId=t.message_id,this._payload=t})),Nu=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"VOTE",i)).event=new Iu(i),s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return i(n)}(Qe),Au=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.title,s=e.optionTexts,o=e.data,u=e.allowUserSuggestion,c=e.allowMultipleVotes,l=e.closeAt;return r(this,n),(a=t.call(this)).method=de.POST,a.path=we,a.params={title:i,options:s,data:o,allow_user_suggestion:u,allow_multiple_votes:c,close_at:l},a}return i(n)}(Ue),Mu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).poll=new Wi(e,a),i}return i(n)}(De),Ou=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(we,"/").concat(encodeURIComponent(o)),a.params={channel_url:i,channel_type:s},a}return i(n)}(Ue),Uu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).poll=new Wi(e,a),i}return i(n)}(De),Du=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId,u=e.pollOptionId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(we,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(u)),a.params={channel_url:i,channel_type:s},a}return i(n)}(Ue),Lu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).pollOption=new Ki(e,a),i}return i(n)}(De),Ru=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/polls/changelogs"),a.params=ce({change_ts:o,token:u}),a}return i(n)}(Ue),Pu=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).updatedPolls=a.updated.map((function(t){return function(e,t){return new Wi(e,t)}(e,t)})),i.deletedPollIds=a.deleted.map((function(e){return e})),i.hasMore=a.has_more,i.nextToken=a.next,i}return i(n)}(De),Fu={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},Hu=function(e){return L("string",e.title)&&(t=e.optionTexts,F("string",t)&&t.every((function(e){return""!==e.trim()})))&&Qi(e.data)&&L("boolean",e.allowUserSuggestion,!0)&&L("boolean",e.allowMultipleVotes,!0)&&L("number",e.closeAt,!0);var t},qu={channelUrl:"",channelType:e.ChannelType.BASE,pollId:0,pollOptionId:0},Gu=function(t){return L("string",t.channelUrl)&&""!==t.channelUrl&&R(e.ChannelType,t.channelType)&&L("number",t.pollId)&&t.pollId>0&&L("number",t.pollOptionId)&&t.pollOptionId>0},ju={channelUrl:"",channelType:e.ChannelType.BASE,pollId:0},zu=function(t){return L("string",t.channelUrl)&&""!==t.channelUrl&&R(e.ChannelType,t.channelType)&&L("number",t.pollId)},Vu={},Bu=function(){function n(e,t){var a=t.sdkState,i=t.dispatcher,s=t.sessionManager,o=t.requestQueue,u=t.logger;r(this,n),this._iid=e,this._sdkState=a,this._sessionManager=s,this._requestQueue=o,this._dispatcher=i,this._logger=u,Vu[e]=this}return i(n,[{key:"buildPollFromSerializedData",value:function(e){var t=ri(e);return new Wi(this._iid,Wi.payloadify(t))}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(zu(e)).throw(M.invalidParameters),r=new Ou(Object.assign({},e)),t.next=4,this._requestQueue.send(r);case 4:return a=t.sent,i=a.as(Uu),s=i.poll,t.abrupt("return",s);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"create",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(Hu(e)).throw(M.invalidParameters),r=new Au(Object.assign({},e)),t.next=4,this._requestQueue.send(r);case 4:return a=t.sent,i=a.as(Mu),s=i.poll,t.abrupt("return",s);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"getOption",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(Gu(e)).throw(M.invalidParameters),r=new Du(Object.assign({},e)),t.next=4,this._requestQueue.send(r);case 4:return a=t.sent,i=a.as(Lu),s=i.pollOption,t.abrupt("return",s);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"getPollChangeLogs",value:function(n,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.CollectionEventSource.SYNC_POLL_CHANGELOGS;return E(this,void 0,void 0,t().mark((function e(){var s,o,u,c,l,d,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Ru(le({channelType:r,channelUrl:n,timestamp:"number"==typeof a?a:null,token:"string"==typeof a?a:null})),e.next=3,this._requestQueue.send(s);case 3:return o=e.sent,u=o.as(Pu),c=u.updatedPolls,l=u.deletedPollIds,d=u.hasMore,h=u.nextToken,c.length>0&&this._dispatcher.dispatch(new ks({polls:c,source:i})),e.abrupt("return",{updatedPolls:c,deletedPollIds:l,hasMore:d,token:h});case 7:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Vu[e]}}]),n}(),Qu="GroupChannel",Ku="Message",Wu=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.channelType,o=e.token,u=e.limit;return r(this,n),(a=t.call(this)).method=de.GET,a.path=we,a.params={channel_url:i,channel_type:s,token:o,limit:u},a}return i(n)}(Ue),Yu=function(e){s(n,e);var t=f(n);function n(e,a){var i,s;return r(this,n),(i=t.call(this,e,a)).polls=(null!==(s=a.polls)&&void 0!==s?s:[]).map((function(t){return new Wi(e,t)})),i.token=a.next,i}return i(n)}(De),Zu=function(e){s(a,e);var n=f(a);function a(e,t){return r(this,a),n.call(this,e,t.channelUrl,t.channelType,t)}return i(a,[{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new Wu(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(Yu),o=s.polls,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(no),Ju=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.channelType,o=e.pollId,u=e.pollOptionId,c=e.token,l=e.limit;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(we,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(u),"/voters"),a.params={channel_url:i,channel_type:s,token:c,limit:l},a}return i(n)}(Ue),Xu=function(e){s(n,e);var t=f(n);function n(e,a){var i,s;return r(this,n),(i=t.call(this,e,a)).voters=(null!==(s=a.voters)&&void 0!==s?s:[]).map((function(t){return new si(e,t)})),i.token=a.next,i}return i(n)}(De),$u=function(e){s(a,e);var n=f(a);function a(e,t){var i;return r(this,a),(i=n.call(this,e,t.channelUrl,t.channelType,t)).pollId=t.pollId,i.pollOptionId=t.pollOptionId,i}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)&&L("number",this.pollId)&&L("number",this.pollOptionId)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new Ju(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(Xu),o=s.voters,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(no),ec=Object.assign(Object.assign({},Rs),{fileInfoList:[]}),tc=function(e){return(q(e.file)||L("string",e.fileUrl))&&L("string",e.fileName,!0)&&L("string",e.mimeType,!0)&&L("number",e.fileSize,!0)&&(void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return e.maxWidth>0&&e.maxHeight>0})))},nc=function(e){s(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments))._onFileUploaded=Ke,e}return i(n,[{key:"_triggerOnFileUploaded",value:function(e,t,n,r){this._onFileUploaded(e,t,n,r)}},{key:"onFileUploaded",value:function(e){return this._onFileUploaded=e,this}},{key:"onPending",value:function(e){return p(o(n.prototype),"onPending",this).call(this,e),this}},{key:"onFailed",value:function(e){return p(o(n.prototype),"onFailed",this).call(this,e),this}},{key:"onSucceeded",value:function(e){return p(o(n.prototype),"onSucceeded",this).call(this,e),this}}]),n}(Ls),rc=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h;return r(this,u),(i=a.call(this,t))._name="",i._createdAt=0,i.channelType=e.ChannelType.BASE,i.coverUrl="",i.customType="",i.data="",i.isFrozen=!1,i.isEphemeral=!1,i.creator=null,i._messageCollectionLastAccessedAt=0,i._url=n.channel_url,i._name=null!==(s=n.name)&&void 0!==s?s:"",i._createdAt=1e3*n.created_at,i.coverUrl=null!==(o=n.cover_url)&&void 0!==o?o:"",i.customType=null!==(c=n.custom_type)&&void 0!==c?c:"",i.data=null!==(l=n.data)&&void 0!==l?l:"",i.isFrozen=null!==(d=n.freeze)&&void 0!==d&&d,i.isEphemeral=null!==(h=n.is_ephemeral)&&void 0!==h&&h,i.creator=n.created_by?new si(i._iid,n.created_by):null,n.metadata&&Object.keys(n.metadata).length>0&&n.ts&&(i._cachedMetaData=new Map,Object.keys(n.metadata).forEach((function(e){i._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts})}))),i}return i(u,[{key:"url",get:function(){return this._url}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"createdAt",get:function(){return this._createdAt}},{key:"toJSON",value:function(){return Object.assign(Object.assign({},this),{url:this._url,name:this._name,createdAt:this._createdAt})}},{key:"isGroupChannel",value:function(){return this.channelType===e.ChannelType.GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===e.ChannelType.OPEN}},{key:"isFeedChannel",value:function(){return this.channelType===e.ChannelType.FEED}},{key:"cachedMetaData",get:function(){var e={};return this._cachedMetaData?(this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e):e}},{key:"messageCollectionLastAccessedAt",get:function(){return this._messageCollectionLastAccessedAt}},{key:"_updateMessageCollectionLastAccessedAt",value:function(){this._messageCollectionLastAccessedAt=Date.now()}},{key:"_update",value:function(e){var t=ce(e);Object.assign(this,t)}},{key:"_upsertCachedMetaData",value:function(e,t){var n=this;Object.keys(e).forEach((function(r){n._cachedMetaData||(n._cachedMetaData=new Map);var a=n._cachedMetaData.get(r);(!a||a.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))}},{key:"_updateCachedMetaData",value:function(e,t){var n=this;this._cachedMetaData?this._cachedMetaData.forEach((function(r,a){var i;r.updatedAt<=t&&n._cachedMetaData.set(a,{value:null!==(i=e[a])&&void 0!==i?i:r.value,isRemoved:!e[a],updatedAt:t})})):(this._cachedMetaData=new Map,Object.keys(e).forEach((function(r){n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})})))}},{key:"_removeFromCachedMetaData",value:function(e,t){var n=this;this._cachedMetaData&&e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!0,r.updatedAt=t)}))}},{key:"_runIfHandleableWithGroupChannel",value:function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)}},{key:"_generateRequestId",value:function(){return"rq-".concat(ae())}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return D(this,e)}},{key:"createOperatorListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new io(this._iid,this.url,this.channelType,e)}},{key:"createMutedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new co(this._iid,this.url,this.channelType,e)}},{key:"createBannedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new fo(this._iid,this.url,this.channelType,e)}},{key:"createPreviousMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new so(this._iid,this.url,this.channelType,e)}},{key:"addOperators",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new vo({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"removeOperators",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new _o({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getMyMutedInfo",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c,l,d,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new mo({channelUrl:this.url,channelType:this.channelType,userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(go),u=o.isMuted,c=o.startAt,l=o.endAt,d=o.remainingDuration,h=o.description,e.abrupt("return",{isMuted:u,startAt:c,endAt:l,remainingDuration:d,description:h});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMetaData",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new yo({channelUrl:this.url,channelType:this.channelType,keys:e}),t.next=5,a.send(i);case 5:return s=t.sent,o=s.as(ko),u=o.metadata,c=o.ts,this._upsertCachedMetaData(u,c),t.abrupt("return",u);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getAllMetaData",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new yo({channelUrl:this.url,channelType:this.channelType,keys:[]}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(ko),o=s.metadata,u=s.ts,this._updateCachedMetaData(o,u),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"createMetaData",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.requestQueue,i=new Eo({channelUrl:this.url,channelType:this.channelType,metadata:e}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(bo),u=o.metaData,this._upsertCachedMetaData(u,0),t.abrupt("return",u);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"updateMetaData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Ei.of(this._iid),i=a.requestQueue,s=new wo({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:n}),t.next=4,i.send(s);case 4:return o=t.sent,u=o.as(Co),c=u.metadata,l=u.ts,this._upsertCachedMetaData(c,l),t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"deleteMetaData",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new To({channelUrl:this.url,channelType:this.channelType,key:e}),t.next=5,a.send(i);case 5:s=t.sent,o=s.as(So),u=o.ts,this._removeFromCachedMetaData([e],u);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"deleteAllMetaData",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Io({channelUrl:this.url,channelType:this.channelType}),e.next=4,r.send(a);case 4:i=e.sent,s=i.as(No),o=s.ts,this._removeFromCachedMetaData(_(this._cachedMetaData.keys()),o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMetaCounters",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new Ao({channelUrl:this.url,channelType:this.channelType,keys:e}),t.next=5,a.send(i);case 5:return s=t.sent,o=s.as(Mo),u=o.metaCounter,t.abrupt("return",u);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getAllMetaCounters",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Ao({channelUrl:this.url,channelType:this.channelType,keys:[]}),e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(Mo),o=s.metaCounter,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"createMetaCounters",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.requestQueue,i=new Oo({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(Uo),u=o.metaCounter,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"updateMetaCounters",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Ei.of(this._iid),i=a.requestQueue,s=new Do({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:n}),t.next=4,i.send(s);case 4:return o=t.sent,u=o.as(Lo),c=u.metaCounter,t.abrupt("return",c);case 7:case"end":return t.stop()}}),r,this)})))}},{key:"increaseMetaCounters",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.requestQueue,i=new Do({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(Lo),u=o.metaCounter,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"decreaseMetaCounters",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.requestQueue,i=new Do({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(Lo),u=o.metaCounter,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"deleteMetaCounter",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new Po({channelUrl:this.url,channelType:this.channelType,key:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"deleteAllMetaCounters",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Fo({channelUrl:this.url,channelType:this.channelType}),e.next=4,r.send(a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"muteUser",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.muteUserWithUserId(e.userId,n,r));case 1:case"end":return t.stop()}}),a,this)})))}},{key:"muteUserWithUserId",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)&&L("number",n,!0)&&L("string",r,!0)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new Ho({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:n,description:r}),t.next=5,s.send(o);case 5:case"end":return t.stop()}}),a,this)})))}},{key:"unmuteUser",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unmuteUserWithUserId(e.userId));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"unmuteUserWithUserId",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new Go({channelUrl:this.url,channelType:this.channelType,userId:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"banUser",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.banUserWithUserId(e.userId,n,r));case 1:case"end":return t.stop()}}),a,this)})))}},{key:"banUserWithUserId",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)&&L("number",n,!0)&&L("string",r,!0)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new zo({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:n,description:r}),t.next=5,s.send(o);case 5:case"end":return t.stop()}}),a,this)})))}},{key:"unbanUser",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unbanUserWithUserId(e.userId));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"unbanUserWithUserId",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new Bo({channelUrl:this.url,channelType:this.channelType,userId:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"freeze",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Ko({channelUrl:this.url,channelType:this.channelType,freezing:!0}),e.next=4,r.send(a);case 4:this.isFrozen=!0;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"unfreeze",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Ko({channelUrl:this.url,channelType:this.channelType,freezing:!1}),e.next=4,r.send(a);case 4:this.isFrozen=!1;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getMessagesByMessageId",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},ls),n),ai(L("number",e)&&ds(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getMessagesByMessageId(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"getMessagesByTimestamp",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},ls),n),ai(L("number",e)&&ds(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getMessagesByTimestamp(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"getMessageChangeLogsSinceTimestamp",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},hs),n),ai(L("number",e)&&fs(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getMessageChangelogs(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"getMessageChangeLogsSinceToken",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},hs),n),ai(L("string",e)&&fs(a)).throw(M.invalidParameters),i=Ll.of(this._iid),t.next=5,i.getMessageChangelogs(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"_createPendingSendableMessagePayload",value:function(t,n,r){var a,i=Ei.of(this._iid).sessionManager;return ce(le({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,sorted_metaarray:t.metaArrays?t.metaArrays.map((function(e){return Ai.payloadify(e)})):null,apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,created_at:r,user:i.currentUser?Di.payloadify(i.currentUser):null,req_id:n,request_state:e.SendingStatus.PENDING,mentioned_user_ids:t.mentionedUserIds,mentioned_users:null===(a=t.mentionedUsers)||void 0===a?void 0:a.map((function(e){return si.payloadify(e)}))}))}},{key:"_createPendingUserMessage",value:function(t,n,r){var a={};if(t.translationTargetLanguages){var i,s=y(t.translationTargetLanguages);try{for(s.s();!(i=s.n()).done;){a[i.value]=""}}catch(e){s.e(e)}finally{s.f()}}var o=ce(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.USER,message:t.message,translations:a})),u=new Yi(this._iid,o);return u.messageParams=t,u}},{key:"_createPendingScheduledUserMessage",value:function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r}},{key:"_createPendingFileMessage",value:function(t,n,r){var a,i,s,o,u,c,l=ce(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.FILE,url:t.fileUrl,file:{name:null!==(a=t.fileName)&&void 0!==a?a:null===(i=t.file)||void 0===i?void 0:i.name,size:null!==(s=t.fileSize)&&void 0!==s?s:null===(o=t.file)||void 0===o?void 0:o.size,type:null!==(u=t.mimeType)&&void 0!==u?u:null===(c=t.file)||void 0===c?void 0:c.type,data:t.data},thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),d=new es(this._iid,l);return d.messageParams=t,d}},{key:"_createPendingMultipleFilesMessage",value:function(t,n,r){var a=ce(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.FILE})),i=new Ji(this._iid,a);return i.messageParams=t,i}},{key:"_createPendingScheduledFileMessage",value:function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r}},{key:"_markMessageAsFailed",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.errorCode=n.code,n.code===b.REQUEST_CANCELED||n.code===b.FILE_UPLOAD_CANCEL_FAILED?t.sendingStatus=e.SendingStatus.CANCELED:r||(t.sendingStatus=e.SendingStatus.FAILED)}},{key:"sendUserMessage",value:function(e){var t=Object.assign(Object.assign({},Hs),e);return ai(Gs(t)).throw(M.invalidParameters),this._sendUserMessage(t)}},{key:"_sendUserMessage",value:function(n,r){var a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=Ei.of(this._iid),o=s.dispatcher,u=s.requestQueue,c=null!=r?r:this._generateRequestId(),l=Date.now(),d=new Ls;return c||(c=this._generateRequestId()),Sa(2).then((function(){var r=a._createPendingUserMessage(n,c,l);o.dispatch(new ms({messages:[r],source:i?e.CollectionEventSource.LOCAL_MESSAGE_RESEND_STARTED:e.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d._trigger(r));case 1:case"end":return e.stop()}}),e)})))}));var s=new Xo(Object.assign(Object.assign({},n),{channelUrl:a.url,channelType:a.channelType,reqId:c}));u.send(s).then((function(n){var r=n.as($o).message;o.dispatch(new ms({messages:[r],source:e.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d._trigger(r));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(r){if(A(r))throw r;Sa(2).then((function(){var i=a._createPendingUserMessage(n,c,l),s=Ei.of(a._iid).cacheContext.localCacheEnabled&&H(r.code);a._markMessageAsFailed(i,r,s),o.dispatch(new ms({messages:[i],source:i.sendingStatus===e.SendingStatus.PENDING?e.CollectionEventSource.REQUEST_RESEND_MESSAGE:e.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d._triggerFailed(r,i));case 1:case"end":return e.stop()}}),e)})))}))}))}))})),d}},{key:"_autoResendUserMessage",value:function(e){return ai(e instanceof Yi&&!!e.messageParams).throw(M.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)}},{key:"resendUserMessage",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e instanceof Yi&&!e.scheduledInfo).throw(M.invalidParameters),a=new va,i=null!==(n=e.messageParams)&&void 0!==n?n:qs(e),this._sendUserMessage(i,e.reqId,!0).onFailed((function(e){return a.reject(e)})).onSucceeded((function(e){return a.resolve(e)})),t.abrupt("return",a.promise);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"updateUserMessage",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Js),n),ai(L("number",e)&&Xs(a)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new eu(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},a)),t.next=6,s.send(o);case 6:return u=t.sent,c=u.as(tu),l=c.message,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"copyUserMessage",value:function(n,r){var a,i,s;return E(this,void 0,void 0,t().mark((function o(){var c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(n instanceof u&&r instanceof Yi&&r.sendingStatus===e.SendingStatus.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(M.invalidParameters),ai(!r.poll).throw(M.notSupportedError),c=new va,l=null!==(a=r.messageParams)&&void 0!==a?a:le(Object.assign(Object.assign({},r),{mentionType:r.mentionType,mentionedUserIds:null!==(i=r.mentionedUserIds)&&void 0!==i?i:null===(s=r.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(r.translations),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),n._sendUserMessage(l).onSucceeded((function(e){c.resolve(e)})).onFailed((function(e){return c.reject(e)})),t.abrupt("return",c.promise);case 6:case"end":return t.stop()}}),o,this)})))}},{key:"translateUserMessage",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e instanceof Yi&&e.messageId>0&&F("string",n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new lu({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:n}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(du),c=u.message,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"_createScheduledUserMessage",value:function(e,n){var r=this,a=Ei.of(this._iid).requestQueue,i=Date.now(),s=this._generateRequestId();Sa(2).then((function(){var a=r._createPendingScheduledUserMessage(e,s,i);Aa((function(){return E(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(a));case 1:case"end":return e.stop()}}),e)})))}))}));var o=new hu(Object.assign({reqId:s,channelType:this.channelType,channelUrl:this.url},e));a.send(o).then((function(e){var a=e.as(fu).message;Aa((function(){return E(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(a));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(a){if(A(a))throw a;Sa(2).then((function(){var o=r._createPendingScheduledUserMessage(e,s,i);r._markMessageAsFailed(o,a),Aa((function(){return E(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(o));case 1:case"end":return e.stop()}}),e)})))}))}))}))}},{key:"sendFileMessage",value:function(e){var t=Object.assign(Object.assign({},Qs),e);return ai(Ws(t)).throw(M.invalidParameters),this._sendFileMessage(t)}},{key:"sendMultipleFilesMessage",value:function(e){var t,n=Object.assign(Object.assign({},ec),e),r=Ei.of(this._iid);ai(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return Ps(e)&&Array.isArray(e.fileInfoList)&&e.fileInfoList.length>=2&&e.fileInfoList.length<=t&&e.fileInfoList.every((function(e){return tc(e)}))}(n,null===(t=r.appInfo)||void 0===t?void 0:t.multipleFilesMessageFileCountLimit)).throw(M.invalidParameters);var a=!!e.fileInfoList.find((function(e){var t=r.appInfo.uploadSizeLimit;return e.file instanceof Blob&&e.file.size>t||e.fileSize>t}));return ai(!a).throw(M.fileSizeLimitExceededError),this._sendMultipleFilesMessage(n)}},{key:"_sendFileMessage",value:function(n,r){var a=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=Ei.of(this._iid).dispatcher,o=Ll.of(this._iid).fileMessageQueue,u=null!=r?r:this._generateRequestId(),c=Date.now(),l=new Ls;return u||(u=this._generateRequestId()),Sa(2).then((function(){var r=a._createPendingFileMessage(n,u,c);s.dispatch(new ms({messages:[r],source:i?e.CollectionEventSource.LOCAL_MESSAGE_RESEND_STARTED:e.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(r));case 1:case"end":return e.stop()}}),e)})))})),o.request(a,u,n).then((function(n){s.dispatch(new ms({messages:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(n));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(r){if(A(r))throw r;Sa(2).then((function(){var i=a._createPendingFileMessage(n,u,c),o=Ei.of(a._iid).cacheContext.localCacheEnabled&&H(r.code);a._markMessageAsFailed(i,r,o),s.dispatch(new ms({messages:[i],source:i.sendingStatus===e.SendingStatus.PENDING?e.CollectionEventSource.REQUEST_RESEND_MESSAGE:r.code===b.FILE_UPLOAD_CANCEL_FAILED?e.CollectionEventSource.LOCAL_MESSAGE_CANCELED:e.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._triggerFailed(r,i));case 1:case"end":return e.stop()}}),e)})))}))}))}))})),l}},{key:"_autoResendFileMessage",value:function(e){ai(e instanceof es&&!!e.messageParams).throw(M.invalidParameters);var t=Ei.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))}},{key:"_sendMultipleFilesMessage",value:function(n,r){var a=this,i=Ei.of(this._iid).dispatcher,s=Ll.of(this._iid).fileMessageQueue,o=null!=r?r:this._generateRequestId(),u=Date.now(),c=new nc;return o||(o=this._generateRequestId()),Sa(2).then((function(){var r=a._createPendingMultipleFilesMessage(n,o,u);i.dispatch(new ms({messages:[r],source:e.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._trigger(r));case 1:case"end":return e.stop()}}),e)})))})),s.request(a,o,n,c).then((function(n){i.dispatch(new ms({messages:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._trigger(n));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(r){if(A(r))throw r;Sa(2).then((function(){var s=a._createPendingMultipleFilesMessage(n,o,u);a._markMessageAsFailed(s,r),i.dispatch(new ms({messages:[s],source:e.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED})),Aa((function(){return E(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._triggerFailed(r,s));case 1:case"end":return e.stop()}}),e)})))}))}))}))})),c}},{key:"_createScheduledFileMessage",value:function(e,n,r,a){var i=this,s=Ei.of(this._iid).requestQueue,o=new pu(Object.assign(Object.assign({reqId:r,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));s.send(o).then((function(e){var r=e.as(vu).message;Aa((function(){return E(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(r));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(s){if(A(s))throw s;Sa(2).then((function(){var o=i._createPendingScheduledFileMessage(e,r,a);i._markMessageAsFailed(o,s),Aa((function(){return E(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._triggerFailed(s,o));case 1:case"end":return e.stop()}}),e)})))}))}))}))}},{key:"sendFileMessages",value:function(e){ai(e.every((function(e){return Ws(Object.assign(Object.assign({},Qs),e))}))).throw(M.invalidParameters);var t,n=new Ls,r=y(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.sendFileMessage(a).onPending((function(e){return n._trigger(e)})).onFailed((function(e,t){return n._triggerFailed(e,t)})).onSucceeded((function(e){return n._trigger(e)}))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"resendFileMessage",value:function(e,n){var r;return E(this,void 0,void 0,t().mark((function a(){var i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Boolean(e.url)||q(n)||q(null===(r=e.messageParams)||void 0===r?void 0:r.file),ai(e instanceof es&&i&&!e.scheduledInfo).throw(M.invalidParameters),s=new va,o=Ks(e,n),this._sendFileMessage(o,e.reqId,!0).onFailed((function(e){return s.reject(e)})).onSucceeded((function(e){return s.resolve(e)})),t.abrupt("return",s.promise);case 6:case"end":return t.stop()}}),a,this)})))}},{key:"updateFileMessage",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},$s),n),ai(L("number",e)&&eo(a)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new nu(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},a)),t.next=6,s.send(o);case 6:return u=t.sent,c=u.as(ru),l=c.message,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"cancelUploadingFileMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ll.of(this._iid),r.fileMessageQueue.cancel(this,e),t.abrupt("return",!0);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"copyFileMessage",value:function(n,r){var a,i,s;return E(this,void 0,void 0,t().mark((function o(){var c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(n instanceof u&&r instanceof es&&r.sendingStatus===e.SendingStatus.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(M.invalidParameters),c=new va,l=le(Object.assign(Object.assign({},r),{fileUrl:r.url,fileName:r.name,fileSize:r.size,mimeType:r.type,mentionType:r.mentionType,mentionedUserIds:null!==(a=r.mentionedUserIds)&&void 0!==a?a:null===(i=r.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(s=r.thumbnails)||void 0===s?void 0:s.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:r.requireAuth,isPinnedMessage:!1})),n._sendFileMessage(l).onSucceeded((function(e){return c.resolve(e)})).onFailed((function(e){return c.reject(e)})),t.abrupt("return",c.promise);case 5:case"end":return t.stop()}}),o,this)})))}},{key:"deleteMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai(e instanceof Pi).throw(M.invalidParameters),!(e.messageId>0)){t.next=6;break}return r=Ei.of(this._iid),a=r.requestQueue,i=new au({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),t.next=6,a.send(i);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"addReaction",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e instanceof Pi&&e.messageId>0&&L("string",n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new su({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:n}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(ou),c=u.reactionEvent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"deleteReaction",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e instanceof Pi&&e.messageId>0&&L("string",n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new uu({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:n}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(cu),c=u.reactionEvent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"_updateUserMessageMetaArray",value:function(n,r,a,i){return E(this,void 0,void 0,t().mark((function s(){var o,u,c,l,d,h,f;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Ei.of(this._iid),u=o.dispatcher,c=o.requestQueue,l=new eu({channelType:this.channelType,channelUrl:this.url,messageId:n,metaArrayParams:{array:r,mode:a,upsert:i}}),t.next=4,c.send(l);case 4:return d=t.sent,h=d.as(tu),f=h.message,u.dispatch(new ms({messages:[f],source:e.CollectionEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",f);case 8:case"end":return t.stop()}}),s,this)})))}},{key:"_updateFileMessageMetaArray",value:function(n,r,a,i){return E(this,void 0,void 0,t().mark((function s(){var o,u,c,l,d,h,f;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Ei.of(this._iid),u=o.dispatcher,c=o.requestQueue,l=new nu({channelType:this.channelType,channelUrl:this.url,messageId:n,metaArrayParams:{array:r,mode:a,upsert:i}}),t.next=4,c.send(l);case 4:return d=t.sent,h=d.as(ru),f=h.message,u.dispatch(new ms({messages:[f],source:e.CollectionEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",f);case 8:case"end":return t.stop()}}),s,this)})))}},{key:"createMessageMetaArrayKeys",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai(e instanceof Pi&&e.messageId>0&&F("string",n)).throw(M.invalidParameters),a=n.map((function(e){return new Ai({key:e})})),!(e instanceof es)){t.next=6;break}return t.abrupt("return",this._updateFileMessageMetaArray(e.messageId,a,"add",!0));case 6:return t.abrupt("return",this._updateUserMessageMetaArray(e.messageId,a,"add",!0));case 7:case"end":return t.stop()}}),r,this)})))}},{key:"deleteMessageMetaArrayKeys",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai(e instanceof Pi&&e.messageId>0&&F("string",n)).throw(M.invalidParameters),a=n.map((function(e){return new Ai({key:e})})),!(e instanceof es)){t.next=6;break}return t.abrupt("return",this._updateFileMessageMetaArray(e.messageId,a,"remove",!0));case 6:return t.abrupt("return",this._updateUserMessageMetaArray(e.messageId,a,"remove",!0));case 7:case"end":return t.stop()}}),r,this)})))}},{key:"addMessageMetaArrayValues",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai(e instanceof Pi&&e.messageId>0&&n.every((function(e){return e instanceof Ai}))).throw(M.invalidParameters),!(e instanceof es)){t.next=5;break}return t.abrupt("return",this._updateFileMessageMetaArray(e.messageId,n,"add",!0));case 5:return t.abrupt("return",this._updateUserMessageMetaArray(e.messageId,n,"add",!0));case 6:case"end":return t.stop()}}),r,this)})))}},{key:"removeMessageMetaArrayValues",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai(e instanceof Pi&&e.messageId>0&&n.every((function(e){return e instanceof Ai}))).throw(M.invalidParameters),!(e instanceof es)){t.next=5;break}return t.abrupt("return",this._updateFileMessageMetaArray(e.messageId,n,"remove",!0));case 5:return t.abrupt("return",this._updateUserMessageMetaArray(e.messageId,n,"remove",!0));case 6:case"end":return t.stop()}}),r,this)})))}},{key:"report",value:function(n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(R(e.ReportCategory,n)&&L("string",r)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.sdkState,o=i.requestQueue,u=new Yo({channelUrl:this.url,channelType:this.channelType,userId:s.userId,category:n,description:r}),t.next=5,o.send(u);case 5:case"end":return t.stop()}}),a,this)})))}},{key:"reportUser",value:function(n,r,a){return E(this,void 0,void 0,t().mark((function i(){var s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(n instanceof si&&R(e.ReportCategory,r)&&L("string",a)).throw(M.invalidParameters),s=Ei.of(this._iid),o=s.sdkState,u=s.requestQueue,c=new Zo({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:n.userId,category:r,description:a}),t.next=5,u.send(c);case 5:case"end":return t.stop()}}),i,this)})))}},{key:"reportMessage",value:function(n,r,a){return E(this,void 0,void 0,t().mark((function i(){var s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(n instanceof Fi&&R(e.ReportCategory,r)&&L("string",a)).throw(M.invalidParameters),s=Ei.of(this._iid),o=s.sdkState,u=s.requestQueue,c=new Jo({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:n.sender.userId,messageId:n.messageId,category:r,description:a}),t.next=5,u.send(c);case 5:case"end":return t.stop()}}),i,this)})))}},{key:"updatePoll",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("number",e)&&_u(n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new mu(Object.assign({pollId:e},n)),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(gu),c=u.poll,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"deletePoll",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=L("number",e),ai(r).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new yu({pollId:e}),t.next=6,i.send(s);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"closePoll",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=L("number",e),ai(r).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new ku({pollId:e}),t.next=6,i.send(s);case 6:return o=t.sent,u=o.as(Eu),c=u.poll,t.abrupt("return",c);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"addPollOption",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=L("number",e)&&L("string",n)&&""!==n.trim(),ai(a).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new bu({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:n}),t.next=6,s.send(o);case 6:return u=t.sent,c=u.as(wu),l=c.poll,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"updatePollOption",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=L("number",e)&&L("number",n)&&L("string",r)&&""!==r.trim(),ai(i).throw(M.invalidParameters),s=Ei.of(this._iid),o=s.requestQueue,u=new Cu({pollId:e,pollOptionId:n,optionText:r}),t.next=6,o.send(u);case 6:return c=t.sent,l=c.as(xu),d=l.poll,t.abrupt("return",d);case 9:case"end":return t.stop()}}),a,this)})))}},{key:"deletePollOption",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=L("number",e)&&L("number",n),ai(a).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new Tu({pollId:e,pollOptionId:n}),t.next=6,s.send(o);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"votePoll",value:function(n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=L("number",n)&&F("number",r),ai(i).throw(M.invalidParameters),s=Ei.of(this._iid),o=s.requestQueue,u=s.dispatcher,c=new Su({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:n,pollOptionIds:r}),t.next=6,o.send(c);case 6:return l=t.sent,d=l.as(Nu),h=d.event,u.dispatch(new bs({event:h,source:e.CollectionEventSource.EVENT_POLL_VOTED})),t.abrupt("return",h);case 10:case"end":return t.stop()}}),a,this)})))}},{key:"getPollChangeLogsSinceTimestamp",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("number",e)).throw(M.invalidParameters),r=Bu.of(this._iid),t.next=4,r.getPollChangeLogs(this.url,this.channelType,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getPollChangeLogsSinceToken",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e,!0)),r=Bu.of(this._iid),t.next=4,r.getPollChangeLogs(this.url,this.channelType,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"createPollListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new Zu(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})}},{key:"createPollVoterListQuery",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return new $u(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?si.payloadify(e.creator):null,created_at:e.createdAt/1e3})))}}]),u}(Ya),ac=i((function e(t){r(this,e),this.key=t.key,this.url=t.url})),ic=i((function e(t){r(this,e),this.id=t.id,this.name=t.name,this.url=t.url,this.emojis=t.emojis?t.emojis.map((function(e){return new ac(e)})):[]})),sc=i((function e(t){r(this,e),this.emojiHash=t.emoji_hash||"",this.emojiCategories=t.emoji_categories?t.emoji_categories.map((function(e){return new ic(e)})):[]})),oc=function(e){s(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return i(n)}(i((function e(){r(this,e),this.onConnected=Ke,this.onReconnectStarted=Ke,this.onReconnectSucceeded=Ke,this.onReconnectFailed=Ke,this.onDisconnected=Ke}))),uc=function(e){s(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return i(n)}(i((function e(){r(this,e),this.onSessionExpired=Ke,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=Ke,this.onSessionRefreshed=Ke,this.onSessionClosed=Ke}))),cc=function(e){s(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return i(n)}(i((function e(){r(this,e),this.onFriendsDiscovered=Ke,this.onTotalUnreadMessageCountChanged=Ke,this.onTotalUnreadMessageCountUpdated=Ke}))),lc=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.limit,s=e.token,o=e.userIdsFilter,u=e.metaDataKeyFilter,c=e.metaDataValuesFilter,l=e.nicknameStartsWithFilter;return r(this,n),(a=t.call(this)).method=de.GET,a.path=fe,a.params=ce({limit:i,token:s,user_ids:o,metadatakey:u,metadatavalues_in:c,nickname_startswith:l}),a}return i(n)}(Ue),dc=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).users=a.users.map((function(t){return new si(e,t)})),i.next=a.next,i}return i(n)}(De),hc=function(e){s(a,e);var n=f(a);function a(e,t){var i,s,o,u;return r(this,a),(i=n.call(this,e,t)).userIdsFilter=null,i.metaDataKeyFilter=null,i.metaDataValuesFilter=null,i.nicknameStartsWithFilter=null,i.userIdsFilter=null!==(s=t.userIdsFilter)&&void 0!==s?s:null,i.metaDataKeyFilter=null!==(o=t.metaDataKeyFilter)&&void 0!==o?o:null,i.metaDataValuesFilter=null!==(u=t.metaDataValuesFilter)&&void 0!==u?u:null,i.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,i}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)&&F("string",this.userIdsFilter,!0)&&L("string",this.metaDataKeyFilter,!0)&&F("string",this.metaDataValuesFilter,!0)&&L("string",this.metaDataKeyFilter,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new lc(le(Object.assign(Object.assign({},this),{token:this._token}))),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(dc),o=s.users,u=s.next,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(to),fc=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.limit,o=e.token,u=e.userIdsFilter;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(i,"/block"),a.params=ce({limit:s,token:o,user_ids:u}),a}return i(n)}(Ue),pc=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).users=a.users.map((function(t){return new si(e,t)})),i.next=a.next,i}return i(n)}(De),vc=function(e){s(a,e);var n=f(a);function a(e,t){var i,s;return r(this,a),(i=n.call(this,e,t)).userIdsFilter=null,i.userIdsFilter=null!==(s=t.userIdsFilter)&&void 0!==s?s:null,i}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)&&F("string",this.userIdsFilter,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new fc(le(Object.assign(Object.assign({},this),{userId:r.userId,token:this._token}))),e.next=8,a.send(i);case 8:return s=e.sent,o=s.as(pc),u=o.users,c=o.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,e.abrupt("return",u);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(to),_c=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.limit,o=e.token;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/friends"),a.params={limit:s,token:o},a}return i(n)}(Ue),mc=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).hasMore=a.has_more,i.users=a.users.map((function(t){return new si(e,t)})),i.next=a.next,i}return i(n)}(De),gc=function(e){s(a,e);var n=f(a);function a(){return r(this,a),n.apply(this,arguments)}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new _c(Object.assign(Object.assign({},this),{userId:r.userId,token:this._token})),e.next=8,a.send(i);case 8:return s=e.sent,o=s.as(mc),u=o.users,c=o.hasMore,l=o.next,this._token=l,this._hasNext=c,this._isLoading=!1,e.abrupt("return",u);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(to),yc={},kc=function(){function e(t){var n=t.dbname,a=t.itemSizeLimit,i=void 0===a?1048576:a,s=t.cacheLimit,o=void 0===s?256:s,u=t.blockHashBase,c=void 0===u?2:u,l=t.blockHashMultiplier,d=void 0===l?10:l,h=t.blockHashConstant,f=void 0===h?11:h,p=t.transactionApplyDelay,v=void 0===p?200:p,_=t.disableLogger,m=void 0!==_&&_;return r(this,e),yc[n]||(this.itemSizeLimit=i,this.cacheLimit=o,this.blockHashBase=c,this.blockHashMultiplier=d,this.blockHashConstant=f,this.transactionApplyDelay=v,this.disableLogger=m,yc[n]=this),yc[n]}return i(e,null,[{key:"get",value:function(e){return yc[e]}}]),e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(po||(po={}));var Ec,bc=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.code,s=void 0===i?po.UNKNOWN_ERROR:i,o=e.message,u=void 0===o?"Unknown error occurred.":o;return r(this,n),(a=t.call(this,u)).code=s,Object.setPrototypeOf(h(a),n.prototype),a}return i(n,null,[{key:"storeNotDefined",get:function(){return new n({code:po.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})}},{key:"storeNotAvailable",get:function(){return new n({code:po.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})}},{key:"storeNotAvailableInPrivateBrowsing",get:function(){return new n({code:po.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})}},{key:"storeIsFull",get:function(){return new n({code:po.STORE_IS_FULL,message:"Store is full."})}},{key:"storeNotInitialized",get:function(){return new n({code:po.STORE_NOT_INITIALIZED,message:"Store is not initialized."})}},{key:"storeKeyTypeIsInvalid",get:function(){return new n({code:po.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})}},{key:"storeBrokenIntegrity",get:function(){return new n({code:po.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})}},{key:"storeBrokenBlob",get:function(){return new n({code:po.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})}},{key:"storeEncryptionInvalid",get:function(){return new n({code:po.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})}},{key:"storeItemSizeExceeded",get:function(){return new n({code:po.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})}},{key:"storeReadFailed",get:function(){return new n({code:po.STORE_READ_FAILED,message:"Failed to read from store."})}},{key:"storeWriteFailed",get:function(){return new n({code:po.STORE_WRITE_FAILED,message:"Failed to write to store."})}},{key:"databaseSchemaNotOnUpgrade",get:function(){return new n({code:po.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})}},{key:"collectionNotReady",get:function(){return new n({code:po.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})}},{key:"collectionKeyNotMatch",get:function(){return new n({code:po.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})}},{key:"collectionQueryNotValid",get:function(){return new n({code:po.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})}},{key:"collectionInsertDuplicate",get:function(){return new n({code:po.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})}},{key:"collectionKeyNotFound",get:function(){return new n({code:po.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})}},{key:"collectionKeyNotGiven",get:function(){return new n({code:po.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})}},{key:"collectionWriteFailed",get:function(){return new n({code:po.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})}},{key:"collectionItemSizeExceeded",get:function(){return new n({code:po.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})}},{key:"indexTableIsRequired",get:function(){return new n({code:po.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})}},{key:"indexTypesNotMatch",get:function(){return new n({code:po.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})}},{key:"compareTypesNotMatch",get:function(){return new n({code:po.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})}},{key:"circularReferenceFound",get:function(){return new n({code:po.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})}}]),n}(d(Error));!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(Ec||(Ec={}));var wc,Cc=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap;if("object"===n(t)&&null!==t){if(r.has(t))throw bc.circularReferenceFound;var a;if(r.set(t,!0),Array.isArray(t))a=t.map((function(t){return e(t,r)}));else if(t instanceof RegExp)a=t;else if(t instanceof Date)a=t;else for(var i in a={},t)a[i]=e(t[i],r);return r.delete(t),a}return t},xc=function(e,t){if(null==t)return 1;if(null==e)return-1;if(n(e)!==n(t))throw bc.compareTypesNotMatch;var r=0;switch(n(e)){case"boolean":case"number":r=e-t;break;case"string":r=e.localeCompare(t)}return r},Tc=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},Sc=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},Ic=function e(t,r){if(!r)return!1;if("function"!=typeof t){for(var a in t){if(["/and","&&"].includes(a)){if(t[a].some((function(t){return!e(t,r)})))return!1}else if(["/or","||"].includes(a)){if(t[a].every((function(t){return!e(t,r)})))return!1}else if("/where"===a){if(!(0,t[a])(r))return!1}else{var i=a;if("object"===n(t[i])){var s=t[i];for(var o in s)switch(o){case"/eq":case"=":if(r[i]!==s[o])return!1;break;case"/neq":case"!=":if(r[i]===s[o])return!1;break;case"/gt":case">":var u=r[i],c=s[o];if(!(xc(u,c)>0))return!1;break;case"/gte":case">=":var l=r[i],d=s[o];if(!(xc(l,d)>=0))return!1;break;case"/lt":case"<":var h=r[i],f=s[o];if(!(xc(h,f)<0))return!1;break;case"/lte":case"<=":var p=r[i],v=s[o];if(!(xc(p,v)<=0))return!1;break;case"/in":var _=r[i];if(!s[o].includes(_))return!1;break;case"/nin":var m=r[i];if(s[o].includes(m))return!1;break;case"/contain":var g=r[i],y=s[o];if(!g.includes(y))return!1;break;case"/regex":var k=r[i];if(!s[o].test(k))return!1;break;case"/where":var E=r[i];if(!(0,s[o])(E))return!1}}else if("function"==typeof t[i]){if(!t[i](r[i]))return!1}else if(t[i]!==r[i])return!1}}return!0}return t(r)},Nc=function(){},Ac=function(){return Promise.resolve()},Mc=function(e){return e},Oc=function(e,t){t()};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(wc||(wc={}));var Uc,Dc,Lc,Rc=function(){function e(t){var n=t.initialPrevValue,a=void 0===n?null:n,i=t.initialNextValue,s=void 0===i?null:i,o=t.iterator,u=t.map,c=void 0===u?Mc:u,l=t.backward,d=void 0===l?Ac:l,h=t.forward,f=void 0===h?Ac:h,p=t.complete,v=void 0===p?Nc:p;r(this,e),this._prevValue=a,this._nextValue=s,this._error=null,this._map=c,this._backward=d,this._forward=f,this._iterator=o,this._complete=v}return i(e,[{key:"prevValue",get:function(){return this._map(this._prevValue)}},{key:"nextValue",get:function(){return this._map(this._nextValue)}},{key:"error",get:function(){return this._error}},{key:"hasPrevious",get:function(){return!!this._prevValue}},{key:"hasNext",get:function(){return!!this._nextValue}},{key:"prev",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasPrevious){e.next=20;break}return e.prev=1,n=this._prevValue,e.next=5,this._backward();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=null;case 8:this._prevValue=e.t0,this._nextValue=n,e.next=15;break;case 12:e.prev=12,e.t1=e.catch(1),this._error=e.t1;case 15:return e.next=17,this._iterator(this);case 17:return e.abrupt("return",e.sent);case 20:this._complete();case 21:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasNext){e.next=20;break}return e.prev=1,n=this._nextValue,e.next=5,this._forward();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=null;case 8:this._nextValue=e.t0,this._prevValue=n,e.next=15;break;case 12:e.prev=12,e.t1=e.catch(1),this._error=e.t1;case 15:return e.next=17,this._iterator(this);case 17:return e.abrupt("return",e.sent);case 20:this._complete();case 21:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"stop",value:function(){this._prevValue=null,this._nextValue=null,this._complete()}}]),e}(),Pc=function(){function e(t){var n=t.condition,a=void 0===n?{}:n,i=t.backward,s=void 0!==i&&i,o=t.blockManager,u=t.indexer;r(this,e),this.condition=a,this.backward=s,this._blockManager=o,this._indexer=u}return i(e,[{key:"findOptimizedStartPosition",value:function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var a=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],o=1;if("-"===s[0]&&(s=s.slice(1),o=-1),this.condition[s])if("object"===n(this.condition[s])){var u=o>0?r:t;for(var c in this.condition[s])if(u.includes(c))for(var l=a;l>=0;l--)if(o*xc(this._indexer.origin[l].columnValues[i],this.condition[s][c])<=0){a=l;break}}else for(var d=a;d>=0;d--)if(o*xc(this._indexer.origin[d].columnValues[i],this.condition[s])<=0){a=d;break}}return Math.min(a+1,this._indexer.origin.length-1)}var h=0;if("function"!=typeof this.condition)for(var f=function(a){var i=e._indexer.fields[a],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),e.condition[i])if("object"===n(e.condition[i]))Object.keys(e.condition[i]).forEach((function(n){if((s>0?t:r).includes(n))for(var o=h;o<e._indexer.origin.length;o++)if(s*xc(e._indexer.origin[o].columnValues[a],e.condition[i][n])>=0){h=o;break}}));else for(var o=h;o<e._indexer.origin.length;o++)if(s*xc(e._indexer.origin[o].columnValues[a],e.condition[i])>=0){h=o;break}},p=0;p<this._indexer.fields.length;p++)f(p);return Math.max(h-1,0)}},{key:"each",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.findOptimizedStartPosition(),a=0,this.backward&&this._indexer.origin[r]&&(a=this._indexer.origin[r].keys.length-1),i=function(){if(l._indexer.origin[r]){if(!l._indexer.origin[r].keys[++a]){if(!l._indexer.origin[++r])return!1;a=0}return!0}return!1},s=function(){if(l._indexer.origin[r]){if(!l._indexer.origin[r].keys[--a]){if(!l._indexer.origin[--r])return!1;a=l._indexer.origin[r].keys.length-1}return!0}return!1},o=null,!this._indexer.origin[r]){n.next=15;break}u=this.backward?s:i;case 8:return n.next=10,this._blockManager.getFromBlock(this._indexer.origin[r].keys[a]);case 10:if(!(c=n.sent)||!Ic(this.condition,c)){n.next=14;break}return o=c,n.abrupt("break",15);case 14:if(u()){n.next=8;break}case 15:return n.next=17,new Promise((function(n){var u=new Rc({initialNextValue:Cc(o),iterator:e,forward:function(){return E(l,void 0,void 0,t().mark((function e(){var n,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.backward?s:i;case 1:if(!n()){e.next=9;break}return e.next=4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[a]);case 4:if(!(o=e.sent)||!Ic(this.condition,o)){e.next=7;break}return e.abrupt("return",Cc(o));case 7:e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))},backward:function(){return E(l,void 0,void 0,t().mark((function e(){var n,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.backward?i:s;case 1:if(!n()){e.next=9;break}return e.next=4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[a]);case 4:if(!(o=e.sent)||!Ic(this.condition,o)){e.next=7;break}return e.abrupt("return",Cc(o));case 7:e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))},complete:n});e(u)}));case 17:return n.abrupt("return",n.sent);case 18:case"end":return n.stop()}}),n,this)})))}}]),e}(),Fc=function(){function e(t){var n=t.condition,a=void 0===n?{}:n,i=t.backward,s=void 0!==i&&i,o=t.mutex,u=t.blockManager,c=t.indexer;r(this,e),this._mutex=o,this._iterator=new Pc({condition:a,backward:s,blockManager:u,indexer:c})}return i(e,[{key:"fetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Math.max(e.offset||0,0),0!==(a="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER)){n.next=6;break}return n.abrupt("return",[]);case 6:if(!(a<0)){n.next=8;break}throw bc.collectionQueryNotValid;case 8:return n.prev=8,i=[],n.next=12,this._mutex.lock();case 12:return n.next=14,this._iterator.each((function(e){return E(s,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.error?e.stop():e.hasNext?0===r?(i.push(e.nextValue),0<a&&a<=i.length?e.stop():e.next()):(r--,e.next()):e.stop();case 1:case"end":return t.stop()}}),n)})))}));case 14:return this._mutex.unlock(),n.abrupt("return",i);case 18:throw n.prev=18,n.t0=n.catch(8),this._mutex.unlock(),n.t0;case 22:case"end":return n.stop()}}),n,this,[[8,18]])})))}},{key:"count",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=0,e.next=4,this._mutex.lock();case 4:return e.next=6,this._iterator.each((function(e){return E(r,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.error?e.stop():e.hasNext?(n++,e.next()):e.stop();case 1:case"end":return t.stop()}}),r)})))}));case 6:return this._mutex.unlock(),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(0),this._mutex.unlock(),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})))}}]),e}(),Hc=function(e){return"".concat("nest","@").concat(e)},qc=function(e,t){return"".concat(Hc(e),"/").concat(t)},Gc=function(e,t){return"".concat(qc(e,t),".metadata")},jc=function(e,t){return"".concat(qc(e,t),"/block.")},zc=function(e,t){return"".concat(qc(e,t),"/blob.")},Vc=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return"".concat(zc(e,t)).concat(n,".").concat(r)},Bc=function(){function e(t){var n=t.dbname,a=t.collectionName,i=t.store;r(this,e),this.dbname=n,this.collectionName=a,this.store=i}return i(e,[{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.get(e);case 2:if(!(r=t.sent)){t.next=19;break}if(a=r.data,i=r.type,"undefined"==typeof fetch){t.next=14;break}return t.next=8,fetch(a);case 8:return s=t.sent,t.next=11,s.blob();case 11:return t.abrupt("return",t.sent);case 14:for(512,o=[],u=atob(a.split(",")[1]),c=0;c<u.length;c+=512){for(l=u.slice(c,c+512),d=new Array(l.length),h=0;h<l.length;h++)d[h]=l.charCodeAt(h);o.push(new Uint8Array(d))}return t.abrupt("return",new Blob(o,{type:i}));case 19:return t.abrupt("return",null);case 20:case"end":return t.stop()}}),n,this)})))}},{key:"save",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Date.now());return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){var r=Vc(u.dbname,u.collectionName,n),a=new FileReader;a.onload=function(){t({blobId:r,data:a.result,type:e.type})},a.readAsDataURL(e)}));case 2:return a=t.sent,i=a.blobId,s=a.data,o=a.type,t.next=8,this.store.set({key:i,value:{data:s,type:o}});case 8:return t.abrupt("return",i);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.remove(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zc(this.dbname,this.collectionName),e.next=3,this.store.getAllKeys();case 3:return r=e.sent,e.next=6,Promise.all(r.filter((function(e){return e.startsWith(n)})).map((function(e){return E(a,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.remove(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))})));case 6:case"end":return e.stop()}}),e,this)})))}}]),e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(Uc||(Uc={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(Dc||(Dc={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(Lc||(Lc={}));var Qc,Kc,Wc=[Dc.PENDING,Dc.VOLATILE],Yc={},Zc=function(){function e(t){var n=t.dbname,a=t.limit,i=void 0===a?256:a;return r(this,e),Yc[n]||(this.dbname=n,this._items=[],this._limit=i,Yc[n]=this),Yc[n]}return i(e,[{key:"items",get:function(){return this._items}},{key:"find",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lc.DEFAULT;return E(this,void 0,void 0,t().mark((function a(){var i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.get(n)){t.next=8;break}return t.next=4,e.get(n);case 4:(s=t.sent)&&(i={key:n,value:s,state:r===Lc.PERSISTENT?Dc.PERSISTENT:Dc.VOLATILE},this.put(i)),t.next=9;break;case 8:r===Lc.PERSISTENT&&(i.state=Dc.PERSISTENT);case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),a,this)})))}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lc.DEFAULT,n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===Lc.PERSISTENT&&(r.state=Dc.PERSISTENT),t!==Lc.NO_CACHE&&this.put(r),r}return null}},{key:"put",value:function(e){if(this._limit>0){var t=this._items.map((function(e){return e.key})).indexOf(e.key);if(t>-1)Wc.includes(this._items[t].state)&&Wc.includes(e.state)?(this._items.splice(t,1),this._items.push(e)):(this._items[t].state=e.state,this._items[t].value=e.value);else{this._items.push(e);var n=this._items.filter((function(e){return e.state===Dc.VOLATILE})),r=n.length-this._limit;if(r>0){var a,i=[],s=y(this._items);try{for(s.s();!(a=s.n()).done;){var o=a.value;o.state===Dc.VOLATILE&&r>0?r--:i.push(o)}}catch(e){s.e(e)}finally{s.f()}this._items=i}}}}},{key:"remove",value:function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)}},{key:"clearByCondition",value:function(e){this._items=this._items.filter((function(t){return!e(t)}))}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._items=e?[]:this._items.filter((function(e){return e.state!==Dc.VOLATILE}))}}],[{key:"get",value:function(e){return Yc[e]}}]),e}(),Jc=function(){function e(t){var n=t.dbname,a=t.collectionName,i=t.store;r(this,e),this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=n,this.collectionName=a,this.metadataKey=function(e,t){return"".concat(qc(e,t),"/trans.metadata")}(n,a),this.recordsetKey=function(e,t){return"".concat(qc(e,t),"/trans.recordset")}(n,a),this._store=i}return i(e,[{key:"generation",get:function(){return this._metadata?this._metadata.generation:0}},{key:"requestCount",get:function(){return this._requests.length}},{key:"_getReducedRecordset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._store.get(this.recordsetKey);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:return(r=t.t0).push.apply(r,_(e)),t.abrupt("return",this._reduceRecordSet(r));case 8:case"end":return t.stop()}}),n,this)})))}},{key:"_reduceRecordSet",value:function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var a=e[r],i=[],s=a.requests.length-1;s>=0;s--){var o=a.requests[s],u=o.data;n[u.key]||(i.unshift(o),n[u.key]=!0)}i.length>0&&(a.requests=i,t.unshift(a))}return t}},{key:"_applyRecord",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Zc.get(this.dbname),i=n.generation,s=n.requests,o=null,t.prev=3,t.next=6,this._store.setMany(s.map((function(e){return Object.assign(Object.assign({},e.data),{generation:i})})));case 6:for(u=t.sent,c=0;c<s.length;c++)u[c]instanceof Error&&(o||(o=u[c]),l=s[c].data,a.put(Object.assign(Object.assign({},l),{state:Dc.PERSISTENT})));t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),o=t.t0;case 13:if(o){t.next=20;break}return d=e.filter((function(e){return e.generation!==i})),t.next=17,this._store.set({key:this.recordsetKey,value:d});case 17:this._onWrite.forEach((function(e){e(s.map((function(e){return e.data})))})),t.next=21;break;case 20:this._onError.forEach((function(e){o&&e(o)}));case 21:case"end":return t.stop()}}),r,this,[[3,10]])})))}},{key:"init",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.get(this.metadataKey);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={generation:1};case 5:return this._metadata=e.t0,e.next=8,this._getReducedRecordset();case 8:n=e.sent,r=y(n),e.prev=10,r.s();case 12:if((a=r.n()).done){e.next=18;break}return i=a.value,e.next=16,this._applyRecord(n,i);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(10),r.e(e.t1);case 23:return e.prev=23,r.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[10,20,23,26]])})))}},{key:"on",value:function(e,t,n){switch(e){case Uc.COMMIT:this._onCommit.set(t,n);break;case Uc.WRITE:this._onWrite.set(t,n);break;case Uc.ERROR:this._onError.set(t,n)}}},{key:"requestWrite",value:function(e,t){this._requests.push({data:e,options:t}),Zc.get(this.dbname).put(Object.assign({state:Dc.PENDING},e))}},{key:"requestMultipleWrite",value:function(e,t){var n,r=Zc.get(this.dbname),a=y(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;this._requests.push({data:i,options:t}),r.put(Object.assign({state:Dc.PENDING},i))}}catch(e){a.e(e)}finally{a.f()}}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Zc.get(this.dbname).clearByCondition((function(e){return e.state===Dc.PENDING})),this._requests=[];case 3:case"end":return e.stop()}}),e,this)})))}},{key:"commit",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c,l,d,h,f,p,v,_=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this._requests).length>0)){e.next=20;break}for(r=[],a={},i=n.length-1;i>=0;i--)s=n[i],o=s.data,a[o.key]||(a[o.key]=!0,r.unshift(s));return u={generation:this.generation,requests:r},e.next=8,this._getReducedRecordset([u]);case 8:return c=e.sent,e.next=11,this._store.set({key:this.recordsetKey,value:c});case 11:return this._metadata.generation++,e.next=14,this._store.set({key:this.metadataKey,value:this._metadata});case 14:for(l=Zc.get(this.dbname),d=0;d<r.length;d++)h=r[d],f=h.data,p=h.options,l.put(Object.assign(Object.assign({},f),{state:p&&p.persistent?Dc.PERSISTENT:Dc.VOLATILE}));this._requests=[],this._onCommit.forEach((function(e){e(n.map((function(e){return e.data})))})),v=kc.get(this.dbname),setTimeout((function(){try{_._applyRecord(c,u)}catch(e){_._onError.forEach((function(t){return t(e)}))}}),v.transactionApplyDelay);case 20:case"end":return e.stop()}}),e,this)})))}}]),e}(),Xc=function(){function e(t){var n=t.blockId,a=t.keyName,i=t.items,s=void 0===i?[]:i,o=t.limit;r(this,e),this.blockId=n,this.keyName=a,this.limit=o,this._items=_(s)}return i(e,[{key:"isEmpty",get:function(){return 0===this._items.length}},{key:"items",get:function(){return this._items}},{key:"serialize",value:function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}}},{key:"getItemByKey",value:function(e){var t=this,n=this._items.find((function(n){var r=n[t.keyName];return e===r}));return null!=n?n:null}},{key:"has",value:function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)}},{key:"add",value:function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)}},{key:"remove",value:function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1}},{key:"clear",value:function(){this._items=[]}}],[{key:"createFromCacheItem",value:function(t){return t?new e(t.value):null}}]),e}(),$c=function(){function e(t){var n=t.dbname,a=t.collectionName,i=t.metadata,s=t.hashFunction,o=void 0===s?Tc:s,u=t.transaction,c=t.store;r(this,e),this.dbname=n,this.collectionName=a,this.hashFunction=o,this.metadata=i,this._transaction=u,this._store=c}return i(e,[{key:"keyName",get:function(){return this.metadata.keyName}},{key:"createBlockId",value:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.metadata.blockLevel;return t=this.dbname,n=this.collectionName,r=i,a="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||Tc)(e,r)}(e,i,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(jc(t,n)).concat(r,".").concat(a)}},{key:"_findBlock",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=Zc.get(this.dbname),a=this.metadata.blockLevel;case 2:if(!(a>0)){t.next=15;break}return i=this.createBlockId(e,a),t.next=6,r.find(this._store,i);case 6:if(!(s=t.sent)){t.next=12;break}if(o=Xc.createFromCacheItem(s),!(null==o?void 0:o.getItemByKey(e))){t.next=12;break}return t.abrupt("return",o);case 12:a--,t.next=2;break;case 15:return t.abrupt("return",null);case 16:case"end":return t.stop()}}),n,this)})))}},{key:"getFromBlock",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._findBlock(e);case 2:return r=t.sent,t.abrupt("return",r?r.getItemByKey(e):null);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"putToBlock",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=kc.get(this.dbname),i=this.createBlockId(e),s=Math.floor(this._store.itemSizeLimit/a.itemSizeLimit),o=Zc.get(this.dbname),t.next=6,o.find(this._store,i);case 6:if(u=t.sent,!(null==(c=u?Xc.createFromCacheItem(u):new Xc({blockId:i,keyName:this.keyName,items:[],limit:s}))?void 0:c.add(n))){t.next=11;break}return this._transaction.requestWrite({key:c.blockId,value:c.serialize()}),t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"removeFromBlock",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._findBlock(e);case 2:if(!(r=t.sent)){t.next=7;break}if(!r.remove(e)){t.next=7;break}return this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),t.abrupt("return",!0);case 7:return t.abrupt("return",!1);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"clearAllBlocks",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=jc(this.dbname,this.collectionName),e.next=3,this._store.getAllKeys();case 3:return r=e.sent,a=r.filter((function(e){return e.startsWith(n)})),e.next=7,this._store.removeMany(a);case 7:return e.next=9,this._transaction.clear();case 9:Zc.get(this.dbname).clearByCondition((function(e){return e.key.startsWith(n)}));case 11:case"end":return e.stop()}}),e,this)})))}}]),e}(),el={},tl=function(){function e(t){var n=this,a=t.dbname,i=t.collectionName,s=t.keyName,o=t.fields,u=t.transaction,c=t.store;r(this,e),this._origin=[],this._table=[];var l=function(e,t,n){return"".concat(qc(e,t),"/index.").concat(n)}(a,i,o.join(">"));return el[l]||(this.dbname=a,this.collectionName=i,this.keyName=s,this.fields=o,this.indexerKey=l,this._transaction=u,this._store=c,this._transaction.on(Uc.COMMIT,this.indexerKey,(function(){return n.commit()})),this._transaction.on(Uc.ERROR,this.indexerKey,(function(){return n.abort()}))),el[l]}return i(e,[{key:"_addItem",value:function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=v(this.indexOf(n),2),a=r[0];return r[1]?!this._table[a].keys.includes(t)&&(this._table[a].keys.push(t),!0):(this._table.splice(a,0,{columnValues:n,keys:[t]}),!0)}},{key:"_removeItem",value:function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=v(this.indexOf(n),2),a=r[0];if(r[1]){var i=this._table[a].keys.indexOf(t);if(i>-1)return this._table[a].keys.splice(i,1),0===this._table[a].keys.length&&this._table.splice(a,1),!0}return!1}},{key:"origin",get:function(){return this._origin}},{key:"table",get:function(){return this._table}},{key:"getColumnValues",value:function(e){var t,r,a,i=[],s=y(this.fields);try{for(s.s();!(t=s.n()).done;){var o=t.value;if("-"===o[0]&&(o=o.slice(1)),r=e[o],a=void 0,a=n(r),null!==r&&"undefined"!==a&&"boolean"!==a&&"number"!==a&&"string"!==a)throw bc.indexTypesNotMatch;i.push(e[o])}}catch(e){s.e(e)}finally{s.f()}return i}},{key:"diff",value:function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,a=xc(e[n],t[n]);if(0!==a)return r*a}return 0}},{key:"indexOf",value:function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),a=this.diff(e,this._table[r].columnValues);if(a>0)t=r+1;else{if(!(a<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]}},{key:"ensure",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c,l,d,h,f;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Zc.get(this.dbname),e.next=3,n.find(this._store,this.indexerKey,Lc.PERSISTENT);case 3:if(r=e.sent){e.next=33;break}return a=jc(this.dbname,this.collectionName),e.next=8,this._store.getAllKeys();case 8:i=e.sent,s=y(i),e.prev=10,s.s();case 12:if((o=s.n()).done){e.next=22;break}if(!(u=o.value).startsWith(a)){e.next=20;break}return e.next=17,n.find(this._store,u,Lc.NO_CACHE);case 17:if(c=e.sent,l=Xc.createFromCacheItem(c)){d=y(l.items);try{for(d.s();!(h=d.n()).done;)f=h.value,this._addItem(f)}catch(e){d.e(e)}finally{d.f()}}case 20:e.next=12;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(10),s.e(e.t0);case 27:return e.prev=27,s.f(),e.finish(27);case 30:this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),e.next=35;break;case 33:this._origin=r.value,this._table=Cc(this._origin);case 35:el[this.indexerKey]=this;case 36:case"end":return e.stop()}}),e,this,[[10,24,27,30]])})))}},{key:"drop",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Zc.get(this.dbname).remove(this.indexerKey),e.next=4,this._store.remove(this.indexerKey);case 4:delete el[this.indexerKey];case 5:case"end":return e.stop()}}),e,this)})))}},{key:"addItem",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 1:case"end":return t.stop()}}),n,this)})))}},{key:"removeItem",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 1:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"commit",value:function(){this._origin=this._table,this._table=Cc(this._origin)}},{key:"abort",value:function(){this._table=Cc(this._origin)}}],[{key:"createKey",value:function(e){return e.join(">")}},{key:"parseKey",value:function(e){return e.split(">")}},{key:"clearIndexerMap",value:function(){for(var e in el)delete el[e]}}]),e}(),nl=function(){return"undefined"!=typeof document&&"undefined"!=typeof navigator&&"ReactNative"!==navigator.product},rl=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(Qc||(Qc={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(Kc||(Kc={}));var al,il={},sl=function(){function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,e),this._state=Qc.PROCESSING,this._queue=[],this._activationQueue=[],il[t]&&!a.forceCreate||(this.nodeId=rl(),this.key=t,nl()&&(a.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t=e.data,r=t.nodeId,a=t.requestId,i=t.key,s=t.op,o=t.data;if(r!==n.nodeId&&i===n.key)switch(s){case Kc.NEWNODE:n._sendSync();break;case Kc.CLAIM_HOST:n._sendSync(),n._hostId=r;break;case Kc.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var u,c=o.currentItemRequestId,l=y(o.queue);try{var d=function(){var e=u.value,t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:Kc.REQUEST_LOCK,ts:e.ts})};for(l.s();!(u=l.n()).done;)d()}catch(e){l.e(e)}finally{l.f()}n._currentItem=n._queue.find((function(e){return e.requestId===c})),n._completeSync()}break;case Kc.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==t.nodeId})),n._currentItem&&n._currentItem.nodeId===t.nodeId&&(n._currentItem=void 0,n._acquire(n._queue[0]));break;case Kc.REQUEST_LOCK:n._requestLock(t);break;case Kc.ACQUIRE_LOCK:var h=n._queue.find((function(e){return e.requestId===a}));n._acquire(h);break;case Kc.RELEASE_LOCK:n._release(a)}})),window.addEventListener("beforeunload",(function(){n._send(Kc.REMOVENODE)}))),il[t]=this),il[t]}return i(e,[{key:"locked",get:function(){return!!this._currentItem}},{key:"isHost",get:function(){return this._hostId===this.nodeId}},{key:"isInSync",get:function(){return this._state==Qc.DONE}},{key:"_send",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={nodeId:this.nodeId,requestId:null!==(t=null==n?void 0:n.requestId)&&void 0!==t?t:rl(),key:this.key,op:e,data:n.data,ts:Date.now()};return nl()&&window.postMessage(r,"*"),r}},{key:"_acquire",value:function(e){e?(this._currentItem=e,this._currentItem.onAcquired&&this._currentItem.onAcquired(e.requestId)):this._currentItem=void 0}},{key:"_release",value:function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=void 0,t.nodeId===this.nodeId&&this._send(Kc.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased&&t.onReleased(e)}}},{key:"_requestLock",value:function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(Kc.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},a=!1;for(var i in t._queue)if(t._queue[i].ts>r.ts){t._queue.splice(parseInt(i),0,r),a=!0;break}a||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))}},{key:"_sendSync",value:function(){var e;this.isHost&&this._send(Kc.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})}},{key:"_waitUntilSyncCompleted",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHost||this.isInSync){e.next=2;break}return e.abrupt("return",new Promise((function(e){n._activationQueue.push(e)})));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"_waitSync",value:function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))}},{key:"_completeSync",value:function(){this.isInSync||(this._state=Qc.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])}},{key:"registerNode",value:function(){this._send(Kc.NEWNODE),this._waitSync()}},{key:"claimHost",value:function(){this._hostId=this.nodeId,this._send(Kc.CLAIM_HOST),this._waitSync()}},{key:"lock",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._waitUntilSyncCompleted();case 2:return n=this._send(Kc.REQUEST_LOCK),e.next=5,this._requestLock(n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"unlock",value:function(){var e;(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)&&this._release(this._currentItem.requestId)}}]),e}(),ol=function(){function e(t){var n=this,a=t.dbname,i=t.collectionName,s=t.keyName,o=t.keyHash,u=t.indexes,c=t.store;r(this,e),this._state=Ec.INIT,this._indexers=[],this.dbname=a,this.name=i,this.keyName=s,this.indexes=[[s]].concat(_(u.filter((function(e){return tl.createKey(e)!==n.keyName})))),this._keyHash=o,this._store=c,this._mutex=new sl(function(e,t){return"".concat(qc(e,t),".lock")}(a,i)),this._blobContainer=new Bc({dbname:a,collectionName:i,store:c}),this._transaction=new Jc({dbname:a,collectionName:i,store:c})}return i(e,[{key:"state",get:function(){return this._state}},{key:"isReady",get:function(){return this._state===Ec.READY}},{key:"init",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h,f,p=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._mutex.lock();case 2:return t.prev=2,r=kc.get(this.dbname),t.next=6,e.metadataOf(this.dbname,this.name,this._store);case 6:return a=t.sent,this._metadata=a||{keyName:this.keyName,blockLevel:1,blockHashBase:r.blockHashBase,blockHashMultiplier:r.blockHashMultiplier,blockHashConstant:r.blockHashConstant,indexes:this.indexes},t.next=10,this._transaction.init();case 10:this._blockManager=new $c({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),i=_(this.indexes),s=[],o=i.map((function(e){return tl.createKey(e)})),u=a?a.indexes.map((function(e){return tl.createKey(e)})):[],c=y(u);try{for(c.s();!(l=c.n()).done;)d=l.value,o.includes(d)||s.push(tl.parseKey(d))}catch(e){c.e(e)}finally{c.f()}return(h=[]).push.apply(h,_(i.map((function(e){var t=new tl({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store});return p._indexers.push(t),t.ensure()})))),h.push.apply(h,_(s.map((function(e){return new tl({dbname:p.dbname,collectionName:p.name,keyName:p.keyName,fields:e,transaction:p._transaction,store:p._store}).drop()})))),t.next=22,Promise.all(h);case 22:return t.next=24,this._transaction.commit();case 24:if(o.sort().join(",")===u.sort().join(",")){t.next=29;break}return f=Gc(this.dbname,this.name),this._metadata.indexes=i,t.next=29,this._store.set({key:f,value:this._metadata});case 29:this._state=Ec.READY,this._mutex.unlock(),t.next=37;break;case 33:throw t.prev=33,t.t0=t.catch(2),this._mutex.unlock(),t.t0;case 37:case"end":return t.stop()}}),n,this,[[2,33]])})))}},{key:"close",value:function(){this._state=Ec.CLOSED}},{key:"_hasPropertyOfKeyName",value:function(e){var t=e[this.keyName];return"string"==typeof t&&!!t}},{key:"_getIndexerBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=[this.keyName]);var t,n=tl.createKey(e),r=y(this._indexers);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(n===tl.createKey(a.fields))return a}}catch(e){r.e(e)}finally{r.f()}throw bc.indexTableIsRequired}},{key:"_upgradeBlockLevel",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Gc(this.dbname,this.name),this._metadata.blockLevel++,e.next=4,this._store.set({key:n,value:this._metadata});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_requestInsert",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[this.keyName],t.next=3,this._blockManager.getFromBlock(r);case 3:if(t.sent){t.next=32;break}return t.next=7,this._blockManager.putToBlock(r,e);case 7:if(t.sent){t.next=13;break}return t.next=11,this._upgradeBlockLevel();case 11:return t.next=13,this._blockManager.putToBlock(r,e);case 13:a=y(this._indexers),t.prev=14,a.s();case 16:if((i=a.n()).done){t.next=22;break}return s=i.value,t.next=20,s.addItem(e);case 20:t.next=16;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(14),a.e(t.t0);case 27:return t.prev=27,a.f(),t.finish(27);case 30:t.next=33;break;case 32:throw bc.collectionInsertDuplicate;case 33:case"end":return t.stop()}}),n,this,[[14,24,27,30]])})))}},{key:"_requestUpsert",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[this.keyName],t.next=3,this._blockManager.getFromBlock(r);case 3:if(a=t.sent){t.next=32;break}return t.next=7,this._blockManager.putToBlock(r,e);case 7:if(t.sent){t.next=13;break}return t.next=11,this._upgradeBlockLevel();case 11:return t.next=13,this._blockManager.putToBlock(r,e);case 13:i=y(this._indexers),t.prev=14,i.s();case 16:if((s=i.n()).done){t.next=22;break}return o=s.value,t.next=20,o.addItem(e);case 20:t.next=16;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(14),i.e(t.t0);case 27:return t.prev=27,i.f(),t.finish(27);case 30:t.next=54;break;case 32:return t.next=34,this._blockManager.putToBlock(r,e);case 34:u=y(this._indexers),t.prev=35,u.s();case 37:if((c=u.n()).done){t.next=46;break}if(0===(l=c.value).diff(l.getColumnValues(a),l.getColumnValues(e))){t.next=44;break}return t.next=42,l.removeItem(a);case 42:return t.next=44,l.addItem(e);case 44:t.next=37;break;case 46:t.next=51;break;case 48:t.prev=48,t.t1=t.catch(35),u.e(t.t1);case 51:return t.prev=51,u.f(),t.finish(51);case 54:case"end":return t.stop()}}),n,this,[[14,24,27,30],[35,48,51,54]])})))}},{key:"_requestUpdate",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[this.keyName],t.next=3,this._blockManager.getFromBlock(r);case 3:if(!(a=t.sent)){t.next=27;break}return t.next=7,this._blockManager.putToBlock(r,e);case 7:i=y(this._indexers),t.prev=8,i.s();case 10:if((s=i.n()).done){t.next=19;break}if(0===(o=s.value).diff(o.getColumnValues(a),o.getColumnValues(e))){t.next=17;break}return t.next=15,o.removeItem(a);case 15:return t.next=17,o.addItem(e);case 17:t.next=10;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(8),i.e(t.t0);case 24:return t.prev=24,i.f(),t.finish(24);case 27:case"end":return t.stop()}}),n,this,[[8,21,24,27]])})))}},{key:"_requestRemove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blockManager.getFromBlock(e);case 2:if(!(r=t.sent)){t.next=23;break}return t.next=6,this._blockManager.removeFromBlock(e);case 6:a=y(this._indexers),t.prev=7,a.s();case 9:if((i=a.n()).done){t.next=15;break}return s=i.value,t.next=13,s.removeItem(r);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),a.e(t.t0);case 20:return t.prev=20,a.f(),t.finish(20);case 23:case"end":return t.stop()}}),n,this,[[7,17,20,23]])})))}},{key:"_requestClear",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blockManager.clearAllBlocks();case 2:n=y(this._indexers),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=11;break}return a=r.value,e.next=9,a.clear();case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})))}},{key:"getByKey",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=17;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,t.next=6,this._blockManager.getFromBlock(e);case 6:return r=t.sent,this._mutex.unlock(),t.abrupt("return",Cc(r));case 11:throw t.prev=11,t.t0=t.catch(3),this._mutex.unlock(),t.t0;case 15:t.next=18;break;case 17:throw bc.collectionNotReady;case 18:case"end":return t.stop()}}),n,this,[[3,11]])})))}},{key:"query",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.isReady)return new Fc({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward});throw bc.collectionNotReady}},{key:"insertOne",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw bc.collectionKeyNotGiven;case 6:return t.next=8,this._requestInsert(Cc(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw bc.collectionNotReady;case 23:case"end":return t.stop()}}),n,this,[[3,14]])})))}},{key:"insertMany",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=37;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,!e.some((function(e){return!s._hasPropertyOfKeyName(e)}))){t.next=6;break}throw bc.collectionKeyNotGiven;case 6:r=y(e),t.prev=7,r.s();case 9:if((a=r.n()).done){t.next=15;break}return i=a.value,t.next=13,this._requestInsert(Cc(i));case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),r.e(t.t0);case 20:return t.prev=20,r.f(),t.finish(20);case 23:return t.next=25,this._transaction.commit();case 25:return this._mutex.unlock(),t.abrupt("return",e);case 29:return t.prev=29,t.t1=t.catch(3),t.next=33,this._transaction.clear();case 33:throw this._mutex.unlock(),t.t1;case 35:t.next=38;break;case 37:throw bc.collectionNotReady;case 38:case"end":return t.stop()}}),n,this,[[3,29],[7,17,20,23]])})))}},{key:"upsertOne",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw bc.collectionKeyNotGiven;case 6:return t.next=8,this._requestUpsert(Cc(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw bc.collectionNotReady;case 23:case"end":return t.stop()}}),n,this,[[3,14]])})))}},{key:"upsertMany",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=37;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,!e.some((function(e){return!s._hasPropertyOfKeyName(e)}))){t.next=6;break}throw bc.collectionKeyNotGiven;case 6:r=y(e),t.prev=7,r.s();case 9:if((a=r.n()).done){t.next=15;break}return i=a.value,t.next=13,this._requestUpsert(Cc(i));case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),r.e(t.t0);case 20:return t.prev=20,r.f(),t.finish(20);case 23:return t.next=25,this._transaction.commit();case 25:return this._mutex.unlock(),t.abrupt("return",e);case 29:return t.prev=29,t.t1=t.catch(3),t.next=33,this._transaction.clear();case 33:throw this._mutex.unlock(),t.t1;case 35:t.next=38;break;case 37:throw bc.collectionNotReady;case 38:case"end":return t.stop()}}),n,this,[[3,29],[7,17,20,23]])})))}},{key:"update",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw bc.collectionKeyNotGiven;case 6:return t.next=8,this._requestUpdate(Cc(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw bc.collectionNotReady;case 23:case"end":return t.stop()}}),n,this,[[3,14]])})))}},{key:"updateIf",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h,f,p,v=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.isReady){r.next=31;break}return r.next=3,this._mutex.lock();case 3:return r.prev=3,a=e.where,i=void 0===a?{}:a,s=e.index,o=void 0===s?null:s,u=e.backward,c=void 0!==u&&u,l=[],d=new Pc({condition:i,blockManager:this._blockManager,backward:c,indexer:this._getIndexerBy(o)}),r.next=9,d.each((function(e){return E(v,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.error){t.next=4;break}if(e.hasNext){if(a=e.nextValue,Ic(i,a)&&n.set){if("function"!=typeof n.set)for(s in n.set)a[s]=n.set[s];else n.set(a);l.push(a)}e.next()}else e.stop();t.next=6;break;case 4:throw e.stop(),e.error;case 6:case"end":return t.stop()}}),r)})))}));case 9:h=0,f=l;case 10:if(!(h<f.length)){r.next=17;break}return p=f[h],r.next=14,this._requestUpdate(Cc(p));case 14:h++,r.next=10;break;case 17:return r.next=19,this._transaction.commit();case 19:return this._mutex.unlock(),r.abrupt("return",l);case 23:return r.prev=23,r.t0=r.catch(3),r.next=27,this._transaction.clear();case 27:throw this._mutex.unlock(),r.t0;case 29:r.next=33;break;case 31:throw this._transaction.clear(),bc.collectionNotReady;case 33:case"end":return r.stop()}}),r,this,[[3,23]])})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=19;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,t.next=6,this._requestRemove(e);case 6:return t.next=8,this._transaction.commit();case 8:this._mutex.unlock(),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(3),t.next=15,this._transaction.clear();case 15:throw this._mutex.unlock(),t.t0;case 17:t.next=20;break;case 19:throw bc.collectionNotReady;case 20:case"end":return t.stop()}}),n,this,[[3,11]])})))}},{key:"removeIf",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h,f,p=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isReady){n.next=29;break}return n.next=3,this._mutex.lock();case 3:return n.prev=3,r=e.where,a=void 0===r?{}:r,i=e.index,s=void 0===i?null:i,o=e.backward,u=void 0!==o&&o,c=[],l=new Pc({condition:a,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(s)}),n.next=9,l.each((function(e){return E(p,void 0,void 0,t().mark((function n(){var r,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.error){t.next=4;break}e.hasNext?(r=e.nextValue,Ic(a,r)&&(i=r[this.keyName],c.push(i)),e.next()):e.stop(),t.next=6;break;case 4:throw e.stop(),e.error;case 6:case"end":return t.stop()}}),n,this)})))}));case 9:d=0,h=c;case 10:if(!(d<h.length)){n.next=17;break}return f=h[d],n.next=14,this._requestRemove(f);case 14:d++,n.next=10;break;case 17:return n.next=19,this._transaction.commit();case 19:return this._mutex.unlock(),n.abrupt("return",c);case 23:throw n.prev=23,n.t0=n.catch(3),this._mutex.unlock(),n.t0;case 27:n.next=31;break;case 29:throw this._transaction.clear(),bc.collectionNotReady;case 31:case"end":return n.stop()}}),n,this,[[3,23]])})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isReady){e.next=19;break}return e.next=3,this._mutex.lock();case 3:return e.prev=3,e.next=6,this._requestClear();case 6:return e.next=8,this._transaction.commit();case 8:this._mutex.unlock(),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(3),e.next=15,this._transaction.clear();case 15:throw this._mutex.unlock(),e.t0;case 17:e.next=20;break;case 19:throw bc.collectionNotReady;case 20:case"end":return e.stop()}}),e,this,[[3,11]])})))}},{key:"getBlob",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"saveBlob",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.save(e,n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"removeBlob",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.remove(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"removeAllBlobs",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blobContainer.clear();case 2:case"end":return e.stop()}}),e,this)})))}}],[{key:"metadataOf",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Gc(e,n),t.next=3,r.get(i);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),a)})))}}]),e}(),ul="[NESTDB]",cl=!0,ll=function(){function e(){r(this,e)}return i(e,null,[{key:"off",value:function(){cl=!1}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];cl&&(e=console).log.apply(e,["".concat(ul,"[LOG]")].concat(n))}},{key:"warning",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];cl&&(e=console).warn.apply(e,["".concat(ul,"[WARNING]")].concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];cl&&(e=console).error.apply(e,["".concat(ul,"[ERROR]")].concat(n))}}]),e}(),dl=[{},{a:700400,n:"error"}],hl=function(){function e(t){var n,a,i;r(this,e),this.encryption=null!==(n=t.encryption)&&void 0!==n?n:j,this.itemSizeLimit=null!==(a=t.itemSizeLimit)&&void 0!==a?a:4194304,this.metadataBuffer=null!==(i=t.metadataBuffer)&&void 0!==i?i:256}return i(e,[{key:"_encryptionCheckKey",get:function(){return"".concat(this.dbname,".encrypt")}},{key:"_reservedKeys",get:function(){return[this._encryptionCheckKey]}},{key:"_getRawKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e).concat(t)}},{key:"_generateShardPostfixArray",value:function(){return _(Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1).keys())}},{key:"_shardify",value:function(e){var t=this,n=e.key,r=e.value,a=JSON.stringify(this.encryption.encrypt(r)),i=Math.ceil(a.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(i).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:a.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:i}),r}))}},{key:"_resetIfEncryptionChanged",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this._encryptionCheckKey);case 2:if(n=e.sent,r={encrypted:dl.map((function(e){var t;return null===(t=o.encryption)||void 0===t?void 0:t.encrypt(e)}))},!(n&&n.encrypted&&Array.isArray(n.encrypted))){e.next=17;break}e.t0=t().keys(n.encrypted);case 6:if((e.t1=e.t0()).done){e.next=17;break}if(a=e.t1.value,i=JSON.stringify(n.encrypted[a]),s=JSON.stringify(r.encrypted[a]),i===s){e.next=15;break}return ll.warning("Encryption algorithm has changed. Stored data would be cleared."),e.next=14,this.clear();case 14:return e.abrupt("break",17);case 15:e.next=6;break;case 17:return e.next=19,this.set({key:this._encryptionCheckKey,value:r});case 19:case"end":return e.stop()}}),e,this)})))}},{key:"adjustedItemSizeLimit",get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)}},{key:"usage",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,e.next=3,this._getAllRawKeys();case 3:r=e.sent,a=y(r),e.prev=5,a.s();case 7:if((i=a.n()).done){e.next=15;break}return s=i.value,e.next=11,this._getRaw(s);case 11:(o=e.sent)&&(n+=JSON.stringify(o).length);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),a.e(e.t0);case 20:return e.prev=20,a.f(),e.finish(20);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}}),e,this,[[5,17,20,23]])})))}},{key:"getAllKeys",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getAllRawKeys();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})).filter((function(e){return!r._reservedKeys.includes(e)})));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this._getRawKey(e,".0"),n.next=3,this._getRaw(r);case 3:if(!(a=n.sent)){n.next=21;break}if(n.prev=5,i=a.data,!((null==(s=a.metadata)?void 0:s.shards)&&s.shards>1)){n.next=13;break}return n.next=10,Promise.all(this._generateShardPostfixArray(null==s?void 0:s.shards).map((function(n){return E(u,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n>0)){t.next=10;break}return a=this._getRawKey(e,".".concat(n)),t.next=4,this._getRaw(a);case 4:if(s=t.sent){t.next=7;break}throw bc.storeBrokenIntegrity;case 7:return t.abrupt("return",s.data);case 10:return t.abrupt("return",i);case 11:case"end":return t.stop()}}),r,this)})))})));case 10:n.t0=n.sent,n.next=14;break;case 13:n.t0=[i];case 14:return o=n.t0,n.abrupt("return",this.encryption.decrypt(JSON.parse(o.join(""))));case 18:return n.prev=18,n.t1=n.catch(5),n.abrupt("return",null);case 21:return n.abrupt("return",null);case 22:case"end":return n.stop()}}),n,this,[[5,18]])})))}},{key:"set",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._shardify(e),t.next=3,this._setRaw(r);case 3:return t.abrupt("return",Object.assign({},e.value));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"setMany",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],t.next=3,this._setRaw(r.concat.apply(r,_(e.map((function(e){return a._shardify(e)})))));case 3:return t.abrupt("return",e.map((function(e){return e.value})));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getRawKey(e,".0"),t.next=3,this._getRaw(r);case 3:if(!(a=t.sent)){t.next=9;break}return i=a.metadata,t.next=8,this._removeRaw(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(t){return s._getRawKey(e,".".concat(t))})));case 8:return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),n,this)})))}},{key:"removeMany",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=[],a=y(e),n.prev=2,s=t().mark((function e(){var n,a,s,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.value,a=o._getRawKey(n,".0"),e.next=4,o._getRaw(a);case 4:(s=e.sent)&&(u=s.metadata,r.push.apply(r,_(o._generateShardPostfixArray(null==u?void 0:u.shards).map((function(e){return o._getRawKey(n,".".concat(e))})))));case 6:case"end":return e.stop()}}),e)})),a.s();case 5:if((i=a.n()).done){n.next=9;break}return n.delegateYield(s(),"t0",7);case 7:n.next=5;break;case 9:n.next=14;break;case 11:n.prev=11,n.t1=n.catch(2),a.e(n.t1);case 14:return n.prev=14,a.f(),n.finish(14);case 17:if(!(r.length>0)){n.next=20;break}return n.next=20,this._removeRaw(r);case 20:return n.abrupt("return",e);case 21:case"end":return n.stop()}}),n,this,[[2,11,14,17]])})))}}]),e}(),fl={},pl=function(e){s(a,e);var n=f(a);function a(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,a),e=n.call(this,Object.assign(Object.assign({},i),{itemSizeLimit:null!==(t=i.itemSizeLimit)&&void 0!==t?t:4194304}));var s=i.delay,o=void 0===s?1:s;return e.delay=o,e.observer={},e}return i(a,[{key:"rawData",get:function(){return fl[this.dbname]},set:function(e){fl[this.dbname]=e}},{key:"_getAllRawKeys",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fl[this.dbname]){e.next=4;break}return e.abrupt("return",Object.keys(fl[this.dbname]));case 4:throw bc.storeNotAvailable;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!fl[this.dbname]){t.next=6;break}return t.next=3,Sc(this.delay);case 3:return t.abrupt("return",fl[this.dbname][e]?Object.assign({key:e},fl[this.dbname][e]):null);case 6:throw bc.storeNotAvailable;case 7:case"end":return t.stop()}}),n,this)})))}},{key:"_setRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!fl[this.dbname]){t.next=7;break}return t.next=3,Sc(this.delay);case 3:r=y(e);try{for(r.s();!(a=r.n()).done;)i=a.value,s=i.key,o=i.data,u=i.metadata,fl[this.dbname][s]=Object.freeze({data:o,metadata:u})}catch(e){r.e(e)}finally{r.f()}t.next=8;break;case 7:throw bc.storeNotAvailable;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"_removeRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!fl[this.dbname]){t.next=7;break}return t.next=3,Sc(this.delay);case 3:r=y(e);try{for(r.s();!(a=r.n()).done;)i=a.value,fl[this.dbname][i]&&delete fl[this.dbname][i]}catch(e){r.e(e)}finally{r.f()}t.next=8;break;case 7:throw bc.storeNotAvailable;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"observe",value:function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))}},{key:"checkAvailability",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"init",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.dbname=e,fl[this.dbname]||(fl[this.dbname]={}),t.next=4,this._resetIfEncryptionChanged();case 4:case"end":return t.stop()}}),n,this)})))}},{key:"set",value:function(e){var n=this,r=Object.create(null,{set:{get:function(){return p(o(a.prototype),"set",n)}}});return E(this,void 0,void 0,t().mark((function n(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=this.observer[e.key])||"function"!=typeof a.set){t.next=5;break}if(!(i=a.set())){t.next=5;break}throw i;case 5:return t.abrupt("return",r.set.call(this,e));case 6:case"end":return t.stop()}}),n,this)})))}},{key:"setMany",value:function(e){var n=this,r=Object.create(null,{setMany:{get:function(){return p(o(a.prototype),"setMany",n)}}});return E(this,void 0,void 0,t().mark((function n(){var a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=y(e),t.prev=1,a.s();case 3:if((i=a.n()).done){t.next=12;break}if(s=i.value,!(o=this.observer[s.key])||"function"!=typeof o.set){t.next=10;break}if(!(u=o.set())){t.next=10;break}throw u;case 10:t.next=3;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),a.e(t.t0);case 17:return t.prev=17,a.f(),t.finish(17);case 20:return t.abrupt("return",r.setMany.call(this,e));case 21:case"end":return t.stop()}}),n,this,[[1,14,17,20]])})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sc(this.delay);case 2:fl[this.dbname]={};case 3:case"end":return e.stop()}}),e,this)})))}}]),a}(hl),vl="NestDBStore";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.OPENING=1]="OPENING",e[e.OPEN=2]="OPEN",e[e.CLOSED=3]="CLOSED"}(al||(al={}));var _l,ml=function(e){s(a,e);var n=f(a);function a(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,a),(e=n.call(this,Object.assign(Object.assign({},i),{itemSizeLimit:null!==(t=i.itemSizeLimit)&&void 0!==t?t:104857600})))._storeName=vl,e._state=al.UNINITIALIZED,e._openJobQueue=[],e._window="undefined"!=typeof window?window:void 0,e._indexedDb=e._window?e._window.indexedDB||e._window.mozIndexedDB||e._window.webkitIndexedDB||e._window.msIndexedDB:void 0,e}return i(a,[{key:"state",get:function(){return this._state}},{key:"_openDatabase",value:function(e){var t=this;return new Promise((function(n,r){if(t._indexedDb){t._state=al.OPENING;var a=t._indexedDb.open(e);a.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(vl,{keyPath:"key"})})),a.addEventListener("success",(function(r){t._state=al.OPEN,t._database=r.target.result,t._openJobQueue.forEach((function(e){return e()})),t._openJobQueue=[],t._database.onclose=function(){t._database=void 0,t._state=al.OPENING,setTimeout((function(){t._openDatabase(e)}),5)},n(t._database)})),a.addEventListener("error",(function(e){t._state=al.UNINITIALIZED,r(e.target.error)}))}else r(bc.storeNotAvailable)}))}},{key:"_getObjectStore",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._database){t.next=4;break}return t.abrupt("return",this._database.transaction(this._storeName,e).objectStore(this._storeName));case 4:t.t0=this._state,t.next=t.t0===al.UNINITIALIZED||t.t0===al.OPEN?7:t.t0===al.OPENING||t.t0===al.CLOSED?8:9;break;case 7:throw bc.storeNotInitialized;case 8:return t.abrupt("return",new Promise((function(t){r._openJobQueue.push((function(){return t(r._getObjectStore(e))}))})));case 9:return t.next=11,this._getObjectStore(e);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),n,this)})))}},{key:"_getAllRawKeys",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getObjectStore("readonly");case 2:return n=e.sent,e.next=5,new Promise((function(e,t){var r=n.getAllKeys();r.addEventListener("success",(function(t){e(t.target.result)})),r.addEventListener("error",(function(e){return t(e.target.error)}))}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getObjectStore("readonly");case 2:return r=t.sent,t.next=5,new Promise((function(t,n){var a=r.get(e);a.addEventListener("success",(function(e){var n;t(null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.result)})),a.addEventListener("error",(function(e){return n(e.target.error)}))}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"_setRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getObjectStore("readwrite");case 2:return r=t.sent,t.next=5,Promise.all(e.map((function(e){return new Promise((function(t,n){var a=r.put(e);a.addEventListener("success",(function(e){t(e.target.result)})),a.addEventListener("error",(function(){n("Failed to write.")}))}))})));case 5:case"end":return t.stop()}}),n,this)})))}},{key:"_removeRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getObjectStore("readwrite");case 2:return r=t.sent,t.next=5,Promise.all(e.map((function(e){return new Promise((function(t,n){var a=r.delete(e);a.addEventListener("success",(function(){return t(e)})),a.addEventListener("error",(function(e){return n(e.target.error)}))}))})));case 5:case"end":return t.stop()}}),n,this)})))}},{key:"_triggerDatabaseClose",value:function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))}},{key:"checkAvailability",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null==(n="undefined"!=typeof window?window:null)?void 0:n.indexedDB)||(null==n?void 0:n.mozIndexedDB)||(null==n?void 0:n.webkitIndexedDB)||(null==n?void 0:n.msIndexedDB))){e.next=16;break}if(this._indexedDb=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB,!this._window||!nl()){e.next=13;break}if(!(nl()&&navigator.userAgent&&navigator.userAgent.includes("Edge/"))){e.next=9;break}if(this._window.indexedDB||!n.PointerEvent&&!n.MSPointerEvent){e.next=7;break}throw bc.storeNotAvailableInPrivateBrowsing;case 7:e.next=11;break;case 9:return e.next=11,new Promise((function(e,t){if(r._indexedDb)try{var n=r._indexedDb.open("_testMozilla");n.onerror=function(){return t(bc.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}}catch(e){t(bc.storeNotAvailableInPrivateBrowsing)}else t(bc.storeNotAvailable)}));case 11:e.next=14;break;case 13:case 16:throw bc.storeNotAvailable;case 14:e.next=17;break;case 17:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.dbname=e,t.next=3,this.checkAvailability();case 3:return t.next=5,this._openDatabase(e);case 5:return t.next=7,this._resetIfEncryptionChanged();case 7:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getObjectStore("readwrite");case 2:return n=e.sent,e.next=5,new Promise((function(e,t){var r=n.clear();r.addEventListener("success",(function(){return e()})),r.addEventListener("error",(function(e){return t(e.target.error)}))}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}}]),a}(hl),gl=function(e){s(a,e);var n=f(a);function a(e){var t;r(this,a);var i=e.AsyncStorage,s=e.itemSizeLimit,o=void 0===s?6291456:s,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["AsyncStorage","itemSizeLimit"]);return(t=n.call(this,Object.assign(Object.assign({},u),{itemSizeLimit:o})))._asyncStorage=i,t}return i(a,[{key:"_isBelonging",value:function(e){return e.startsWith("".concat(this.dbname,"/"))}},{key:"_getActualKey",value:function(e){return"".concat(this.dbname,"/").concat(e)}},{key:"_getAllRawKeys",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._asyncStorage.getAllKeys();case 2:return n=e.sent,r=n.filter((function(e){return a._isBelonging(e)})),e.abrupt("return",r.map((function(e){return e.substring("".concat(a.dbname,"/").length)})));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._asyncStorage.getItem(this._getActualKey(e));case 2:return r=t.sent,t.abrupt("return",r?JSON.parse(r):null);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"_setRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],a=y(e);try{for(a.s();!(i=a.n()).done;)s=i.value,o=s.key,s.data.length<=this.adjustedItemSizeLimit&&r.push([this._getActualKey(o),JSON.stringify(s)])}catch(e){a.e(e)}finally{a.f()}return t.next=5,this._asyncStorage.multiSet(r);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"_removeRaw",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._asyncStorage.multiRemove(e.map((function(e){return r._getActualKey(e)})));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"checkAvailability",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._asyncStorage){e.next=2;break}throw bc.storeNotAvailable;case 2:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.dbname=e,t.next=3,this._resetIfEncryptionChanged();case 3:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllKeys();case 2:return n=e.sent,e.next=5,this.removeMany(n);case 5:case"end":return e.stop()}}),e,this)})))}}]),a}(hl),yl=function(e){return E(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.usage();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n)})))};!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(_l||(_l={}));var kl,El=function(){function e(t){var n=t.name,a=t.version,i=t.store,s=t.config;r(this,e),this.name=n,this._version=a,this._state=_l.INIT,this._config=s||new kc({dbname:n}),this._store=i,this._event={success:Nc,error:Nc,storeReplaced:Nc,upgrade:Oc},this._collections=new Map,this._globalMutex=new sl("".concat(this.name,".lock")),this._config.disableLogger&&ll.off(),new Zc({dbname:n,limit:this._config.cacheLimit})}return i(e,[{key:"version",get:function(){return this._version}},{key:"state",get:function(){return this._state}},{key:"store",get:function(){return this._store}},{key:"estimateUsage",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yl(this._store);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"commitSchema",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._state!==_l.OPENING){n.next=5;break}return n.next=3,Promise.all(e.map((function(e){return E(r,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.collectionName,a=e.keyName,i=e.index,s=void 0===i?[]:i,this._collections.has(r)||this._collections.set(r,new ol({dbname:this.name,collectionName:r,keyName:a,indexes:s,store:this._store})),!(o=this._collections.get(r))){t.next=6;break}return t.next=6,o.init();case 6:case"end":return t.stop()}}),n,this)})))})));case 3:n.next=6;break;case 5:throw bc.databaseSchemaNotOnUpgrade;case 6:case"end":return n.stop()}}),n,this)})))}},{key:"open",value:function(){var e;return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._globalMutex.lock();case 2:if(this._state===_l.OPENED){n.next=49;break}return this._state=_l.OPENING,n.prev=4,n.next=7,this._store.init(this.name);case 7:return o=this.name,r="".concat(Hc(o),".metadata"),a={version:0,collectionNames:[]},n.next=11,this._store.get(r);case 11:if(n.t1=e=n.sent,n.t0=null!==n.t1,!n.t0){n.next=15;break}n.t0=void 0!==e;case 15:if(!n.t0){n.next=19;break}n.t2=e,n.next=20;break;case 19:n.t2=a;case 20:return i=n.t2,n.abrupt("return",new Promise((function(e,n){var a=function(e){i.version<s._version?s._event.upgrade(i.version,(function(n){return E(s,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=14;break}return i.version++,i.collectionNames=Array.from(this._collections.keys()),t.prev=3,t.next=6,this._store.set({key:r,value:i});case 6:e({continued:!0}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),e({continued:!1,err:t.t0});case 12:t.next=15;break;case 14:e({continued:!1,err:n});case 15:case"end":return t.stop()}}),a,this,[[3,9]])})))})):e({continued:!1})};a((function r(o){var u=o.continued,c=void 0!==u&&u,l=o.err,d=void 0===l?null:l;if(c)setTimeout((function(){return a(r)}),10);else if(d)ll.error(d.message),s._globalMutex.unlock(),s._event.error(d),n(d);else{var h=[];i.collectionNames.forEach((function(e){var n=s._collections.get(e);n&&n.state===Ec.READY||h.push(E(s,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ol.metadataOf(this.name,e,this._store);case 2:if(!(r=t.sent)){t.next=8;break}return a=new ol({dbname:this.name,collectionName:e,keyName:r.keyName,indexes:r.indexes,store:this._store}),this._collections.set(e,a),t.next=8,a.init();case 8:case"end":return t.stop()}}),n,this)}))))})),Promise.all(h).then((function(){s._state=_l.OPENED,s._globalMutex.unlock(),s._event.success(),e()})).catch((function(e){ll.error(e.message),s._globalMutex.unlock(),s._event.error(e),n(e)}))}}))})));case 24:n.prev=24,n.t3=n.catch(4),n.t4=n.t3.code,n.next=n.t4===po.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING?29:n.t4===po.STORE_NOT_AVAILABLE?37:45;break;case 29:return ll.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new pl({}),this._globalMutex.unlock(),this._event.error(n.t3),this._event.storeReplaced(this._store),n.next=36,this.open();case 36:return n.abrupt("break",49);case 37:return ll.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new pl({}),this._globalMutex.unlock(),this._event.error(n.t3),this._event.storeReplaced(this._store),n.next=44,this.open();case 44:return n.abrupt("break",49);case 45:throw ll.error(n.t3.message),this._globalMutex.unlock(),this._event.error(n.t3),n.t3;case 49:case"end":return n.stop()}var o}),n,this,[[4,24]])})))}},{key:"close",value:function(){this._collections.forEach((function(e){return e.close()})),this._state=_l.CLOSED}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"reset",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.close(),(n=Zc.get(this.name))&&n.clearByCondition((function(e){return e.key.startsWith(Hc(r.name))})),e.next=5,this._store.clear();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"on",value:function(e,t){this._event[e]=t}},{key:"off",value:function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=Oc;else this._event[e]=Nc}},{key:"collection",value:function(e){var t=this._collections.get(e);if(t)return t;throw bc.collectionNotReady}}]),e}(),bl=function(){function t(){r(this,t),this.messageTypeFilter=e.MessageTypeFilter.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=e.ReplyType.NONE}return i(t,[{key:"clone",value:function(){var e=new t,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e}},{key:"match",value:function(t){switch(this.messageTypeFilter){case e.MessageTypeFilter.USER:if(t.messageType!==e.MessageType.USER)return!1;break;case e.MessageTypeFilter.FILE:if(t.messageType!==e.MessageType.FILE)return!1;break;case e.MessageTypeFilter.ADMIN:if(t.messageType!==e.MessageType.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(t instanceof Fi))return!1;if(!this.senderUserIdsFilter.includes(t.sender.userId))return!1}switch(this.replyType){case e.ReplyType.NONE:if(t.parentMessageId>0)return!1;break;case e.ReplyType.ONLY_REPLY_TO_CHANNEL:if(t instanceof Fi&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0}}]),t}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(kl||(kl={}));var wl,Cl=function(e){switch(e){case kl.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case kl.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},xl=Object.assign(Object.assign({},Hs),{scheduledAt:void 0}),Tl=Object.assign(Object.assign({},Rs),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),Sl="UnsentMessage",Il={},Nl=function(e){s(a,e);var n=f(a);function a(e){var t;return r(this,a),(t=n.call(this,e))._mutex=new sl("unsendmessagecache.lock"),Il[e]=h(t),t}return i(a,[{key:"_cacheContext",get:function(){return Ei.of(this._iid).cacheContext}},{key:"collection",get:function(){var e=this._cacheContext.nestdb,t=null==e?void 0:e.collection(Sl);if(!t)throw M.databaseError;return t}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){if(e.messageId>0)throw M.invalidParameters;var t,n=Object.assign({},e.serialize());return e instanceof Yi?(e.messageParams&&(n.messageParams=Fs(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,Object.assign(Object.assign({},Fs(t)),{scheduledAt:t.scheduledAt})))):e instanceof es?(e.messageParams&&(n.messageParams=Bs(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=function(e){return Object.assign(Object.assign({},Bs(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof Ji&&e.messageParams&&(n.messageParams=function(e){return ce({fileInfoList:e.fileInfoList,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption})}(e.messageParams)),n}},{key:"_deserialize",value:function(e){return e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)}),Ll.of(this._iid).buildMessageFromSerializedData(e)}},{key:"_deserializeWithMessageCreateParams",value:function(e){var n,r,a;return E(this,void 0,void 0,t().mark((function i(){var s,o,u,c,l,d,h,f=this;return t().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=Ll.of(this._iid),o=this._deserialize(e),!e.messageParams){i.next=32;break}if(!(o instanceof Yi)){i.next=8;break}u=e.messageParams,o.messageParams=s.buildUserMessageCreateParamsFromSerializedData(u,o),i.next=32;break;case 8:if(!(o instanceof es)){i.next=26;break}if(!(c=e.messageParams).fileKey||"string"!=typeof c.fileKey||!Vs(null!==(n=c.fileType)&&void 0!==n?n:"")){i.next=23;break}return i.next=13,this.collection.getBlob(c.fileKey);case 13:if(i.t1=r=i.sent,i.t0=null!==i.t1,!i.t0){i.next=17;break}i.t0=void 0!==r;case 17:if(!i.t0){i.next=21;break}i.t2=r,i.next=22;break;case 21:i.t2=void 0;case 22:c.file=i.t2;case 23:o.messageParams=s.buildFileMessageCreateParamsFromSerializedData(c,o),i.next=32;break;case 26:if(!(o instanceof Ji)){i.next=32;break}if(!(l=e.messageParams)||!l.fileInfoList){i.next=32;break}return o.messageParams=s.buildMultipleFilesMessageCreateParamsFromSerializedData(l,o),i.next=32,Promise.all(o.messageParams.fileInfoList.map((function(e){return E(f,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof(null===(r=e._uploadedMetaData)||void 0===r?void 0:r.fileKey)||!Vs(null!==(i=null===(a=e._uploadedMetaData)||void 0===a?void 0:a.fileType)&&void 0!==i?i:"")){t.next=13;break}return t.next=3,this.collection.getBlob(e._uploadedMetaData.fileKey);case 3:if(t.t1=s=t.sent,t.t0=null!==t.t1,!t.t0){t.next=7;break}t.t0=void 0!==s;case 7:if(!t.t0){t.next=11;break}t.t2=s,t.next=12;break;case 11:t.t2=void 0;case 12:e.file=t.t2;case 13:case"end":return t.stop()}}),n,this)})))})));case 32:if(!(o.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams)){i.next=54;break}if(!(o instanceof Yi)){i.next=38;break}d=e.scheduledInfo.scheduledMessageParams,o.scheduledInfo.scheduledMessageParams=s.buildScheduledUserMessageCreateParamsFromSerializedData(d,o),i.next=54;break;case 38:if(!(o instanceof es)){i.next=54;break}if(!(h=e.scheduledInfo.scheduledMessageParams).fileKey||"string"!=typeof h.fileKey||"string"!=typeof h.fileType||!Vs(h.fileType)){i.next=53;break}return i.next=43,this.collection.getBlob(h.fileKey);case 43:if(i.t4=a=i.sent,i.t3=null!==i.t4,!i.t3){i.next=47;break}i.t3=void 0!==a;case 47:if(!i.t3){i.next=51;break}i.t5=a,i.next=52;break;case 51:i.t5=void 0;case 52:h.file=i.t5;case 53:o.scheduledInfo.scheduledMessageParams=s.buildScheduledFileMessageCreateParamsFromSerializedData(h,o);case 54:return i.abrupt("return",o);case 55:case"end":return i.stop()}}),i,this)})))}},{key:"_getFileInfoBlobKey",value:function(e,t){return"".concat(e,".").concat(t)}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return t.next=3,this.collection.getByKey("".concat(e));case 3:if(!(r=t.sent)){t.next=6;break}return t.abrupt("return",this._deserializeWithMessageCreateParams(r));case 6:return t.abrupt("return",void 0);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"fetch",value:function(e){var n=e.channelUrl,r=e.filter,a=void 0===r?new bl:r,i=e.order,s=void 0===i?kl.CHANNEL_LATEST:i,o=e.sendingStatus,u=e.backward,c=void 0!==u&&u,l=e.parentMessageId;return E(this,void 0,void 0,t().mark((function e(){var r,i,u,d,h,f=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=13;break}return r=Cl(s),i={"/where":function(e){return!!(s!==kl.NEWEST_CHILD_MESSAGE||l&&0!==e.parentMessageId&&e.parentMessageId===l)&&a.match(f._deserialize(e))}},n&&(i.channelUrl=n),o&&(i.sendingStatus=o),u={where:i,index:r,backward:c},e.next=8,this.collection.query(u);case 8:return d=e.sent,e.next=11,d.fetch({});case 11:return h=e.sent,e.abrupt("return",Promise.all(h.map((function(e){return E(f,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._deserializeWithMessageCreateParams(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}))));case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,this)})))}},{key:"getAllChildMessages",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bl;return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch({filter:n,order:kl.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,Promise.all(e.map((function(e){return E(r,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof es||e instanceof Ji)){t.next=7;break}return t.next=3,this._mutex.lock();case 3:return t.next=5,this.saveBlob(e);case 5:return t.next=7,this._mutex.unlock();case 7:return r=this._serialize(e),t.next=10,this.collection.upsertOne(r);case 10:case"end":return t.stop()}}),n,this)})))})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"upsertChildMessages",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,Promise.all(e.map((function(e){return E(r,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=[],!(e.threadInfo&&e.threadInfo.replyCount>0)){t.next=5;break}return t.next=4,this.getAllChildMessages(e);case 4:r=t.sent;case 5:if(!(r.length>0)){t.next=9;break}return r.forEach((function(t){return t.applyParentMessage(e)})),t.next=9,this.upsert(r);case 9:case"end":return t.stop()}}),n,this)})))})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=18;break}r=y(e),t.prev=2,r.s();case 4:if((a=r.n()).done){t.next=10;break}return i=a.value,t.next=8,this.collection.remove(i);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),n,this,[[2,12,15,18]])})))}},{key:"removeMessagesOfChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e}});case 3:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=3;break}return e.next=3,this.collection.clear();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"saveBlob",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e instanceof es)){n.next=19;break}if(!e.messageParams){n.next=9;break}if(!(r=e.messageParams).file||!zs(r.file)){n.next=9;break}return n.next=6,this.collection.saveBlob(r.file,e.reqId);case 6:a=n.sent,r.fileKey=a,r.fileType=Ms.BLOB;case 9:if(!e.scheduledInfo||!e.scheduledInfo.scheduledMessageParams){n.next=17;break}if(!(i=e.scheduledInfo.scheduledMessageParams).file||!zs(i.file)){n.next=17;break}return n.next=14,this.collection.saveBlob(i.file,e.reqId);case 14:s=n.sent,i.fileKey=s,i.fileType=Ms.BLOB;case 17:n.next=24;break;case 19:if(!(e instanceof Ji)){n.next=24;break}if(!((o=e.messageParams)&&o.fileInfoList&&Array.isArray(o.fileInfoList))){n.next=24;break}return n.next=24,Promise.all(o.fileInfoList.map((function(n,r){return E(u,void 0,void 0,t().mark((function a(){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.file||!zs(n.file)){t.next=7;break}return t.next=3,this.collection.saveBlob(n.file,this._getFileInfoBlobKey(e.reqId,r));case 3:i=t.sent,n._uploadedMetaData||(n._uploadedMetaData={}),n._uploadedMetaData.fileKey=i,n._uploadedMetaData.fileType=Ms.BLOB;case 7:case"end":return t.stop()}}),a,this)})))})));case 24:case"end":return n.stop()}}),n,this)})))}}],[{key:"of",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Il[e]&&!t||(Il[e]=new a(e)),Il[e]}}]),a}(Ya),Al={},Ml=function(e){s(a,e);var n=f(a);function a(e){var t;return r(this,a),t=n.call(this,e),Al[e]=h(t),t}return i(a,[{key:"_sdkState",get:function(){return Ei.of(this._iid).sdkState}},{key:"_cacheContext",get:function(){return Ei.of(this._iid).cacheContext}},{key:"_unsentMessageCache",get:function(){return Nl.of(this._iid)}},{key:"collection",get:function(){var e=this._cacheContext.nestdb;return ai(!!e).throw(M.databaseError),e.collection(Ku)}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){return Object.assign(Object.assign({},e.serialize()),{messageId:"".concat(e.messageId)})}},{key:"_deserialize",value:function(e){return e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)}),Ll.of(this._iid).buildMessageFromSerializedData(e)}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return t.next=3,this.collection.getByKey("".concat(e));case 3:if(!(r=t.sent)){t.next=6;break}return t.abrupt("return",this._deserialize(r));case 6:return t.abrupt("return",void 0);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"fetch",value:function(e){var n=e.channelUrl,r=e.token,a=e.limit,i=void 0===a?100:a,s=e.filter,o=void 0===s?new bl:s,u=e.order,c=void 0===u?kl.CHANNEL_LATEST:u,l=e.backward,d=void 0!==l&&l,h=e.parentMessageId,f=e.isPollOnly,p=void 0!==f&&f,v=e.exactMatch,_=void 0!==v&&v,m=e.inclusive,g=void 0===m||m;return E(this,void 0,void 0,t().mark((function e(){var a,s,u,l,f=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=10;break}return a=Cl(c),s={where:{channelUrl:n,"/where":function(e){if(r)switch(c){case kl.CHANNEL_LATEST:if(_&&e.createdAt!==r)return!1;if(d){if(g&&e.createdAt<r||!g&&e.createdAt<=r)return!1}else if(g&&e.createdAt>r||!g&&e.createdAt>=r)return!1;break;case kl.NEWEST_CHILD_MESSAGE:if(!h||0===e.parentMessageId||e.parentMessageId!==h)return!1}return!(p&&!e._poll)&&o.match(f._deserialize(e))}},index:a,backward:d},e.next=5,this.collection.query(s);case 5:return u=e.sent,e.next=8,u.fetch({limit:null!=i?i:void 0});case 8:return l=e.sent,e.abrupt("return",Promise.all(l.map((function(e){return E(f,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._deserialize(e));case 1:case"end":return t.stop()}}),n,this)})))}))));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getAllChildMessages",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bl;return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:kl.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=10;break}return t.next=3,this.saveBlobs(e);case 3:return r=e.map((function(e){return a._serialize(e)})),t.next=6,this.collection.upsertMany(r);case 6:return t.next=8,this.upsertChildMessages(e);case 8:return t.next=10,this._unsentMessageCache.upsertChildMessages(e);case 10:case"end":return t.stop()}}),n,this)})))}},{key:"upsertChildMessages",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,Promise.all(e.map((function(e){return E(r,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=[],!((null===(r=e.threadInfo)||void 0===r?void 0:r.replyCount)&&e.threadInfo.replyCount>0)){t.next=5;break}return t.next=4,this.getAllChildMessages(e);case 4:a=t.sent;case 5:if(!(a.length>0)){t.next=9;break}return a.forEach((function(t){return t.applyParentMessage(e)})),t.next=9,this.upsert(a);case 9:case"end":return t.stop()}}),n,this)})))})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=18;break}r=y(e),t.prev=2,r.s();case 4:if((a=r.n()).done){t.next=10;break}return i=a.value,t.next=8,this.collection.remove("".concat(i));case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),n,this,[[2,12,15,18]])})))}},{key:"removeMessagesOfChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=12;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e},index:Cl(kl.CHANNEL_LATEST)});case 3:return r=this._cacheContext.preference,t.next=6,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"));case 6:return t.next=8,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"));case 8:return t.next=10,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"));case 10:return t.next=12,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"));case 12:case"end":return t.stop()}}),n,this)})))}},{key:"removeUnderOffset",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":n}},index:Cl(kl.CHANNEL_LATEST)});case 3:case"end":return t.stop()}}),r,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=3;break}return e.next=3,this.collection.clear();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"countBetween",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return i=Cl(kl.CHANNEL_LATEST),s=this.collection.query({where:{channelUrl:e,"/where":function(e){var t=o._deserialize(e);return r.includes(t.createdAt)&&n.match(t)}},index:i}),t.next=5,s.count();case 5:return t.abrupt("return",t.sent);case 6:return t.abrupt("return",0);case 7:case"end":return t.stop()}}),a,this)})))}},{key:"saveBlobs",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all(e.map((function(e){return E(r,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof es&&e.messageParams)){t.next=7;break}if(!(r=e.messageParams).file||!zs(r.file)){t.next=7;break}return t.next=5,this.collection.saveBlob(r.file,e.reqId);case 5:a=t.sent,r.fileKey=a;case 7:case"end":return t.stop()}}),n,this)})))})));case 2:case"end":return n.stop()}}),n)})))}},{key:"_getGroupChannelPreferenceSize",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=0,a=this._cacheContext.preference,t.next=4,a.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"));case 4:return i=t.sent,t.next=7,a.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"));case 7:return s=t.sent,t.next=10,a.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"));case 10:return o=t.sent,t.next=13,a.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"));case 13:return u=t.sent,i&&(r+=JSON.stringify(i).length),s&&(r+=JSON.stringify(s).length),o&&(r+=JSON.stringify(o).length),u&&(r+=JSON.stringify(u).length),t.abrupt("return",r);case 19:case"end":return t.stop()}}),n,this)})))}}],[{key:"of",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Al[e]&&!t||(Al[e]=new a(e)),Al[e]}}]),a}(Ya),Ol={},Ul=function(e){s(a,e);var n=f(a);function a(e){var i;return r(this,a),(i=n.call(this,e))._observers=new Map,i._dispatcherContext=i._dispatcher.on((function(e){return E(h(i),void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h,f,p,v,_,m,g,y,k,b,w,C=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e instanceof ms)){n.next=14;break}if(r=e.messages,a=e.source,i=e.isWebSocketEventComing,s=r.filter((function(e){return e.messageId>0})),o=r.filter((function(e){return 0===e.messageId})),!(s.length>0)){n.next=8;break}return n.next=7,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._messageCache.upsert(s);case 2:return e.next=4,this._unsentMessageCache.remove(s.map((function(e){return e instanceof Fi?e.reqId:null})).filter((function(e){return null!==e})));case 4:case"end":return e.stop()}}),e,this)})))}));case 7:i||this._broadcastUpdateEvent(s,a);case 8:if(!(o.length>0)){n.next=12;break}return n.next=11,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._unsentMessageCache.upsert(o);case 2:case"end":return e.stop()}}),e,this)})))}));case 11:i||this._broadcastUpdateEvent(o,a);case 12:n.next=61;break;case 14:if(!(e instanceof gs)){n.next=21;break}return u=e.messageIds,c=e.source,l=e.isWebSocketEventComing,n.next=18,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._messageCache.remove(u);case 2:case"end":return e.stop()}}),e,this)})))}));case 18:l||this._broadcastRemoveEvent(u,c),n.next=61;break;case 21:if(!(e instanceof ys)){n.next=28;break}return d=e.reqId,h=e.source,n.next=25,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._unsentMessageCache.remove([d]);case 2:case"end":return e.stop()}}),e,this)})))}));case 25:this._broadcastRemoveUnsentEvent(d,h),n.next=61;break;case 28:if(!(e instanceof ks)){n.next=41;break}if(f=e.polls,p=e.source,!this._cacheContext.localCacheEnabled){n.next=38;break}return v=f.map((function(e){return e.messageId})),n.next=34,Promise.all(v.map((function(e){return C._messageCache.get(e)})));case 34:return _=n.sent.filter((function(e){return e})),_.length>0&&f.forEach((function(e){var t=_.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),n.next=38,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._messageCache.upsert(_);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}));case 38:this._broadcastPollChangeLogEvent(f,p),n.next=61;break;case 41:if(!(e instanceof Es)){n.next=52;break}return m=e.event,g=e.source,n.next=45,this._messageCache.get(m.messageId);case 45:if(!((y=n.sent)&&y.isUserMessage()&&y.poll&&y.poll.applyPollUpdateEvent(m))){n.next=49;break}return n.next=49,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._messageCache.upsert([y]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}));case 49:this._broadcastPollUpdateEvent(m,g),n.next=61;break;case 52:if(!(e instanceof bs)){n.next=61;break}return k=e.event,b=e.source,n.next=56,this._messageCache.get(k.messageId);case 56:if(!((w=n.sent)&&w.isUserMessage()&&w.poll&&w.poll.applyPollVoteEvent(k))){n.next=60;break}return n.next=60,Ma((function(){return E(C,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._messageCache.upsert([w]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}));case 60:this._broadcastPollVoteEvent(k,b);case 61:case"end":return n.stop()}}),n,this)})))})),i}return i(a,[{key:"_cacheContext",get:function(){return Ei.of(this._iid).cacheContext}},{key:"_dispatcher",get:function(){return Ei.of(this._iid).dispatcher}},{key:"_messageCache",get:function(){return Ml.of(this._iid)}},{key:"_unsentMessageCache",get:function(){return Nl.of(this._iid)}},{key:"_broadcastUpdateEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onUpdate&&a.onUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollChangeLogEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onPollChangeLogUpdate&&a.onPollChangeLogUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollUpdateEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onPollUpdate&&a.onPollUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollVoteEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onPollVote&&a.onPollVote(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onRemove&&a.onRemove(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveUnsentEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onRemoveUnsent&&a.onRemoveUnsent(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"subscribe",value:function(e,t){this._observers.set(e,t)}},{key:"unsubscribe",value:function(e){this._observers.delete(e)}},{key:"unsubscribeAll",value:function(){this._observers.clear()}}],[{key:"of",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ol[e]&&!n||(Ol[e]&&(null===(t=Ol[e]._dispatcherContext)||void 0===t||t.close()),Ol[e]=new a(e)),Ol[e]}}]),a}(Ya),Dl={},Ll=function(){function n(e,t){var a=t.sdkState,i=t.dispatcher,s=t.requestQueue,o=t.onlineDetector,u=t.cacheContext;r(this,n),this._iid=e,this._sdkState=a,this._requestQueue=s,this._dispatcher=i,this._cacheContext=u,Ml.of(e),Nl.of(e),Ul.of(e),this.fileMessageQueue=new os(e,{sdkState:a,dispatcher:i,requestQueue:s,onlineDetector:o,cacheContext:u}),Dl[e]=this}return i(n,[{key:"buildMessageFromSerializedData",value:function(t){var n=ri(t);switch(n.messageType){case e.MessageType.USER:return new Yi(this._iid,Yi.payloadify(n));case e.MessageType.FILE:return Ji._isMultipleFilesMessageSerializedData(n)?new Ji(this._iid,Ji.payloadify(n)):new es(this._iid,es.payloadify(n));case e.MessageType.ADMIN:return new ji(this._iid,ji.payloadify(n))}throw M.invalidParameters}},{key:"buildUserMessageCreateParamsFromSerializedData",value:function(e,t){return ce(le({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId}))}},{key:"buildFileMessageCreateParamsFromSerializedData",value:function(e,t){var n;return ce(le({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:null===(n=t.thumbnails)||void 0===n?void 0:n.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth}))}},{key:"buildMultipleFilesMessageCreateParamsFromSerializedData",value:function(e,t){return ce({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,fileInfoList:e.fileInfoList})}},{key:"buildScheduledUserMessageCreateParamsFromSerializedData",value:function(e,t){return Object.assign(Object.assign({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}},{key:"buildScheduledFileMessageCreateParamsFromSerializedData",value:function(e,t){return Object.assign(Object.assign({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}},{key:"buildSenderFromSerializedData",value:function(e){var t=ri(e);return new Di(this._iid,Di.payloadify(t))}},{key:"getMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new ws(e),t.next=3,this._requestQueue.send(r);case 3:return a=t.sent,i=a.as(Cs),s=i.message,t.abrupt("return",s);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"getScheduledMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Ns(e),t.next=3,this._requestQueue.send(r);case 3:return a=t.sent,i=a.as(As),s=i.message,t.abrupt("return",s);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"getMessagesByMessageId",value:function(n,r,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.CollectionEventSource.REQUEST_MESSAGE;return E(this,void 0,void 0,t().mark((function e(){var o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new xs(Object.assign(Object.assign({channelType:r,channelUrl:n,token:String(a)},ls),i)),e.next=3,this._requestQueue.send(o);case 3:return u=e.sent,c=u.as(Ts),l=c.messages,this._dispatcher.dispatch(new ms({messages:l,source:s})),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMessagesByTimestamp",value:function(n,r,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.CollectionEventSource.REQUEST_MESSAGE;return E(this,void 0,void 0,t().mark((function e(){var o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new xs(Object.assign(Object.assign({channelType:r,channelUrl:n,timestamp:a},ls),i)),e.next=3,this._requestQueue.send(o);case 3:return u=e.sent,c=u.as(Ts),l=c.messages,this._dispatcher.dispatch(new ms({messages:l,source:s})),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"_getMessagesByTimestampForCollection",value:function(n,r,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.CollectionEventSource.REQUEST_MESSAGE,o=arguments.length>5?arguments[5]:void 0;return E(this,void 0,void 0,t().mark((function e(){var u,c,l,d,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new xs(Object.assign(Object.assign(Object.assign({channelType:r,channelUrl:n,timestamp:a},ls),i),{checkingContinuousMessages:o})),e.next=3,this._requestQueue.send(u);case 3:return c=e.sent,l=c.payload,d=c.as(Ts),h=d.messages,this._dispatcher.dispatch(new ms({messages:h,source:s})),e.abrupt("return",{messages:h,isContinuousMessages:l});case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getThreadedMessagesByTimestamp",value:function(n,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.CollectionEventSource.REQUEST_THREADED_MESSAGE;return E(this,void 0,void 0,t().mark((function s(){var o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new xs(Object.assign(Object.assign(Object.assign({channelUrl:n.channelUrl,channelType:n.channelType,timestamp:r},qi),a),{replyType:e.ReplyType.ALL,parentMessageId:n.messageId,includeThreadInfo:!0})),t.next=3,this._requestQueue.send(o);case 3:return u=t.sent,c=u.as(Ts),l=c.messages,(d=l.slice(1)).forEach((function(e){e.parentMessage=n})),this._dispatcher.dispatch(new ms({messages:d,source:i})),t.abrupt("return",{parentMessage:l[0],threadedMessages:d});case 9:case"end":return t.stop()}}),s,this)})))}},{key:"getMessageChangelogs",value:function(n,r,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.CollectionEventSource.REQUEST_MESSAGE_CHANGELOGS;return E(this,void 0,void 0,t().mark((function e(){var o,u,c,l,d,h,f,p;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Ss(ce(le(Object.assign(Object.assign({channelType:r,channelUrl:n,timestamp:"number"==typeof a?a:null,token:"string"==typeof a?a:null},hs),i)))),e.next=3,this._requestQueue.send(o);case 3:return u=e.sent,c=u.as(Is),l=c.updatedMessages,d=c.deletedMessagesInfo,h=c.hasMore,f=c.nextToken,p=d.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new ms({messages:l,source:s})),p.length>0&&this._dispatcher.dispatch(new gs({messageIds:p,source:s})),e.abrupt("return",{updatedMessages:l,deletedMessageIds:p,hasMore:h,token:f});case 9:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Dl[e]}}]),n}(),Rl=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e)).targetMessageId=0;var s=a.thread_info,o=a.parent_message_id,u=a.channel_url,c=a.channel_type;return s&&L("object",s)&&L("number",o)&&L("string",u)&&L("string",c)&&(i.threadInfo=new xi(e,s),i.targetMessageId=o,i.channelUrl=u,i.channelType=c),i}return i(n)}(Ya),Pl={channelUrl:"",channelType:e.ChannelType.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},Fl=function(t){return L("string",t.channelUrl)&&R(e.ChannelType,t.channelType)&&L("number",t.messageId)&&L("boolean",t.includeReactions,!0)&&L("boolean",t.includeMetaArray,!0)&&L("boolean",t.includeParentMessageInfo,!0)&&L("boolean",t.includeThreadInfo,!0)},Hl=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelCustomType,s=e.keyword,o=e.limit,u=e.reverse,c=e.exactMatch,l=e.channelUrl,d=e.order,h=e.messageTimestampFrom,f=e.messageTimestampTo,p=e.advancedQuery,v=e.targetFields,_=e.nextToken;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(ye,"/messages"),a.params={custom_type:i,query:s,limit:o,reverse:u,exact_match:c,channel_url:l,message_ts_from:h,message_ts_to:f,sort_field:d,advanced_query:p,target_fields:v,after:_},a}return i(n)}(Ue),ql=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).messages=a.results.map((function(t){return $i(e,t)})),i.hasNext=a.has_next,i.nextToken=a.end_cursor,i.totalCount=a.total_count,i}return i(n)}(De);e.MessageSearchOrder=void 0,(wl=e.MessageSearchOrder||(e.MessageSearchOrder={})).SCORE="score",wl.TIMESTAMP="ts";var Gl,jl,zl,Vl=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h,f,p,v;return r(this,u),(i=a.call(this,t,n)).keyword="",i.reverse=!1,i.exactMatch=!1,i.channelUrl="",i.channelCustomType="",i.messageTimestampFrom=null,i.messageTimestampTo=null,i.order=e.MessageSearchOrder.SCORE,i.advancedQuery=!1,i.targetFields=null,i._nextToken="",i.totalCount=-1,i.keyword=n.keyword,i.reverse=null!==(s=n.reverse)&&void 0!==s&&s,i.exactMatch=null!==(o=n.exactMatch)&&void 0!==o&&o,i.channelUrl=null!==(c=n.channelUrl)&&void 0!==c?c:"",i.channelCustomType=null!==(l=n.channelCustomType)&&void 0!==l?l:"",i.messageTimestampFrom=null!==(d=n.messageTimestampFrom)&&void 0!==d?d:null,i.messageTimestampTo=null!==(h=n.messageTimestampTo)&&void 0!==h?h:null,i.order=null!==(f=n.order)&&void 0!==f?f:e.MessageSearchOrder.SCORE,i.advancedQuery=null!==(p=n.advancedQuery)&&void 0!==p&&p,i.targetFields=null!==(v=n.targetFields)&&void 0!==v?v:null,i}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)&&L("string",this.keyword)&&this.keyword.length>0&&L("boolean",this.reverse)&&L("boolean",this.exactMatch)&&L("string",this.channelUrl)&&L("string",this.channelCustomType)&&(L("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(L("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&R(e.MessageSearchOrder,this.order)&&L("boolean",this.advancedQuery)&&F("string",this.targetFields,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(!this._hasNext){e.next=15;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new Hl(le(Object.assign(Object.assign({},this),{nextToken:this._nextToken?this._nextToken:null}))),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(ql),o=s.messages,u=s.hasNext,c=s.nextToken,l=s.totalCount,this._nextToken=c,this._hasNext=u,this._isLoading=!1,this.totalCount=l,e.abrupt("return",o);case 15:return e.abrupt("return",[]);case 18:throw M.queryInProgress;case 19:e.next=22;break;case 21:throw M.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),u}(to),Bl={channelUrl:"",scheduledMessageId:0},Ql=function(e){return L("string",e.channelUrl)&&""!==e.channelUrl&&L("number",e.scheduledMessageId)&&e.scheduledMessageId>0},Kl=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="message",e}return i(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;p(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Ll(e,{sdkState:n,dispatcher:r,requestQueue:s,onlineDetector:c,cacheContext:l})}},{key:"buildMessageFromSerializedData",value:function(e){return this._manager.buildMessageFromSerializedData(e)}},{key:"buildSenderFromSerializedData",value:function(e){return this._manager.buildSenderFromSerializedData(e)}},{key:"getMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Pl),e),ai(Fl(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.getMessage(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getScheduledMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Bl),e),ai(Ql(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.getScheduledMessage(r));case 3:case"end":return t.stop()}}),n,this)})))}}]),a}(bi),Wl=i((function e(t,n){r(this,e),this.pollId=0,this.messageId=0,this.pollId=n.poll.id,this.messageId=n.poll.message_id,this._iid=t,this._payload=n})),Yl=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="poll",e}return i(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;p(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Bu(e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:u,onlineDetector:c,cacheContext:l})}},{key:"create",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Fu),e),ai(Hu(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.create(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},ju),e),ai(zu(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.get(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getOption",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},qu),e),ai(Gu(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.getOption(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"buildPollFromSerializedData",value:function(e){return this._manager.buildPollFromSerializedData(e)}}]),a}(bi),Zl={profileImage:void 0,profileUrl:void 0,nickname:void 0},Jl=function(e){return q(e.profileImage,!0)&&L("string",e.profileUrl,!0)&&L("string",e.nickname,!0)};e.GroupChannelListOrder=void 0,(Gl=e.GroupChannelListOrder||(e.GroupChannelListOrder={})).LATEST_LAST_MESSAGE="latest_last_message",Gl.CHRONOLOGICAL="chronological",Gl.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Gl.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.PublicGroupChannelListOrder=void 0,(jl=e.PublicGroupChannelListOrder||(e.PublicGroupChannelListOrder={})).CHRONOLOGICAL="chronological",jl.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",jl.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.ScheduledMessageListOrder=void 0,(zl=e.ScheduledMessageListOrder||(e.ScheduledMessageListOrder={})).CREATED_AT="created_at",zl.SCHEDULED_AT="scheduled_at";var Xl,$l=function(t){switch(t){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case e.GroupChannelListOrder.CHRONOLOGICAL:return["-createdAt","syncIndex"];case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return["name"];default:return["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},ed=function(t){return{v2:t.commitSchema([{collectionName:Qu,keyName:"url",index:[$l(e.GroupChannelListOrder.LATEST_LAST_MESSAGE),$l(e.GroupChannelListOrder.CHRONOLOGICAL),$l(e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:Ku,keyName:"messageId",index:[Cl(kl.CHANNEL_LATEST),Cl(kl.NEWEST_CHILD_MESSAGE)]},{collectionName:Sl,keyName:"reqId",index:[Cl(kl.CHANNEL_LATEST),Cl(kl.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]),v3:t.commitSchema([{collectionName:"FeedChannel",keyName:"url",index:[["-lastMessageUpdatedAt","-createdAt","syncIndex"]]}])}},td=function(e,t){return function(n,r){switch(n){case 1:e.clear().then((function(){t.clear().then((function(){ed(e).v2.then((function(){return r()})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}))})).catch((function(e){return r(e)}));break;case 2:ed(e).v3.then((function(){return r()})).catch((function(e){return r(e)}));break;default:r()}}},nd=function(){return"undefined"!=typeof document?document.visibilityState:"visible"},rd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.getVisibilityState,s=void 0===i?nd:i,o=e.initialState,u=void 0===o?"visible":o,c=e.isEnabled,l=void 0===c||c,d=e.pauseCheckDelay,f=void 0===d?3e4:d;return r(this,n),(a=t.call(this))._pauseCheckDelay=3e4,a._currentState="visible",a._getVisibilityState=s,a._pauseCheckDelay=f,a._currentState=u,a._isEnabled=l,a._boundToggleState=a._toggleState.bind(h(a)),a}return i(n,[{key:"currentState",get:function(){return this._currentState}},{key:"isAvailable",get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener}},{key:"_toggleState",value:function(){var e=this,t=this._getVisibilityState();"hidden"!==t?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=void 0,e.dispatch("pause")}),this._pauseCheckDelay)),this._currentState=t}},{key:"start",value:function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}))}},{key:"stop",value:function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0})}}]),n}(se),ad=function(){function e(t){var n=this,a=t.logger,i=t.connectionDelegate,s=void 0===i?null:i;r(this,e),this._onlineWorker=function(){var e;return null===(e=n.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=n.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(n.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(n.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=a,s&&(this.connectionDelegate=s)}return i(e,[{key:"isAvailableOnWeb",get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine}},{key:"setOnlineListener",value:function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e)}},{key:"setOfflineListener",value:function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e)}},{key:"start",value:function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]}},{key:"stop",value:function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t()}catch(t){e.logger.warn(t.message)}})),this.unsubscribes=[]}},{key:"isOnline",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAvailableOnWeb){e.next=4;break}return e.abrupt("return",navigator.onLine);case 4:return e.abrupt("return",new Promise((function(e){fetch("https://www.google.com",{method:de.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}))})));case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),id=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.message;return r(this,n),(a=t.call(this)).message=i,a}return i(n)}(ue),sd={},od=function(){function n(e,t){var a=this,i=t.localCacheEnabled,s=t.dispatcher,o=t.sdkState,u=t.logger;r(this,n),this._iid=e,sd[e]=this,this._localCacheEnabled=i,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=s,this._logger=u,this._sdkState=o,this._localCacheEnabled&&s.on((function(e){if(e instanceof ga)switch(e.stateType){case da.CONNECTED:a._isProcessingAutoResend||a.processAutoResendRegisteredPendingMessages().then((function(){return a._processNextAutoResend()}));break;case da.INTERNAL_DISCONNECTED:case da.EXTERNAL_DISCONNECTED:a._isProcessingAutoResend=!1}}))}return i(n,[{key:"processNonAutoResendRegisteredPendingMessages",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchAllCachedPendingMessages();case 2:r=t.sent,a=y(r);try{for(a.s();!(i=a.n()).done;)0===(s=i.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",s.reqId),s.sendingStatus=e.SendingStatus.FAILED,s.errorCode=b.ACK_TIMEOUT,this._dispatcher.dispatch(new ms({messages:[s],source:e.CollectionEventSource.LOCAL_MESSAGE_FAILED})))}catch(e){a.e(e)}finally{a.f()}case 5:case"end":return t.stop()}}),n,this)})))}},{key:"processAutoResendRegisteredPendingMessages",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchAllCachedPendingMessages();case 2:r=t.sent,a=y(r);try{for(a.s();!(i=a.n()).done;)(s=i.value).errorCode&&H(s.errorCode)&&(o=(new Date).getTime(),u=s.createdAt+2592e5,o<=u?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(s.reqId)<0&&this._autoResendQueue.push(s):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(u).toLocaleString()),s.sendingStatus=e.SendingStatus.FAILED,this._dispatcher.dispatch(new ms({messages:[s],source:e.CollectionEventSource.LOCAL_MESSAGE_FAILED}))))}catch(e){a.e(e)}finally{a.f()}case 5:case"end":return t.stop()}}),n,this)})))}},{key:"completeCurrentAndProcessNextAutoResend",value:function(t){if(this._localCacheEnabled&&(t.sendingStatus===e.SendingStatus.SUCCEEDED||t.sendingStatus===e.SendingStatus.FAILED&&!H(t.errorCode))){var n=this.indexOf(t);n>=0&&this._autoResendQueue.splice(n,1),0===n&&this._processNextAutoResend()}}},{key:"_fetchAllCachedPendingMessages",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=Nl.of(this._iid))){t.next=7;break}return t.next=4,r.fetch({sendingStatus:e.SendingStatus.PENDING,backward:!0});case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0=[];case 8:return t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"indexOf",value:function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1}},{key:"_isNotInQueue",value:function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)}},{key:"_processNextAutoResend",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),n=this._autoResendQueue[0],this._dispatcher.dispatch(new id({message:n})),this._logger.debug("processing auto-resend for message request id: ",n.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}case 1:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return sd[e]}}]),n}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(Xl||(Xl={}));var ud,cd,ld=function(){function e(t){r(this,e),this.category=t.cat,this.data=t.data}return i(e,null,[{key:"getDataAsUserBlockEvent",value:function(e,t){var n=t.data,r=n.blocker,a=n.blockee;return{blocker:new si(e,r),blockee:new si(e,a)}}},{key:"getDataAsFriendDiscoveredEvent",value:function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new si(e,t)})):[]}}}]),e}(),dd=function(e){s(n,e);var t=f(n);function n(e,a){var i,s=a.userId;return r(this,n),(i=t.call(this))._iid=e,i.userId=s,i}return i(n)}(ue),hd=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.call(this)}return i(n)}(ue),fd=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"USEV",i)).event=new ld(i),s}return i(n)}(Qe),pd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.nickname,o=e.profileUrl,u=e.profileImage,c=e.preferredLanguages;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i)),a.params=ce(le({nickname:s,profile_url:o,profile_file:u,preferred_languages:c})),a}return i(n)}(Ue),vd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).user=new si(e,Object.assign({},a)),i}return i(n)}(De),_d=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.token;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/apns"),a.params={apns_device_token:s,always_push:!0},a}return i(n)}(Ue),md=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.token;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/gcm"),a.params={gcm_reg_token:s,always_push:!0},a}return i(n)}(Ue),gd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.token;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/apns/").concat(encodeURIComponent(s)),a}return i(n)}(Ue),yd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.token;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/gcm/").concat(encodeURIComponent(s)),a}return i(n)}(Ue),kd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/apns"),a}return i(n)}(Ue),Ed=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/gcm"),a}return i(n)}(Ue),bd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.type,o=e.token,u=e.ts;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/").concat(encodeURIComponent(s),"/device_tokens"),a.params={created_ts:u,token:o},a}return i(n)}(Ue),wd=function(t){s(a,t);var n=f(a);function a(t,i){var s;return r(this,a),(s=n.call(this,t,i)).pushTokens={type:i.type?e.PushTokenType[i.type.toLowerCase()]:e.PushTokenType.UNKNOWN,deviceTokens:i.device_tokens,hasMore:i.has_more,token:i.token},s}return i(a)}(De),Cd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/channel_invitation_preference"),a}return i(n)}(Ue),xd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).autoAccept=a.auto_accept,i}return i(n)}(De),Td=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.willAutoAccept;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/channel_invitation_preference"),a.params={auto_accept:s},a}return i(n)}(Ue),Sd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).autoAccept=a.auto_accept,i}return i(n)}(De),Id=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference"),a}return i(n)}(Ue),Nd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).preference={doNotDisturbOn:a.do_not_disturb,startHour:a.start_hour,startMin:a.start_min,endHour:a.end_hour,endMin:a.end_min,timezone:a.timezone},i}return i(n)}(De),Ad=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.doNotDisturbOn,o=e.startHour,u=e.startMin,c=e.endHour,l=e.endMin,d=e.timezone;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference"),a.params={do_not_disturb:s,start_hour:o,start_min:u,end_hour:c,end_min:l,timezone:d},a}return i(n)}(Ue),Md=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).preference={doNotDisturbOn:a.do_not_disturb,startHour:a.start_hour,startMin:a.start_min,endHour:a.end_hour,endMin:a.end_min,timezone:a.timezone},i}return i(n)}(De),Od=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference"),a}return i(n)}(Ue),Ud=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).snoozePeriod={isSnoozeOn:a.snooze_enabled},"number"==typeof a.snooze_start_ts&&(i.snoozePeriod.startTs=a.snooze_start_ts),"number"==typeof a.snooze_end_ts&&(i.snoozePeriod.endTs=a.snooze_end_ts),i}return i(n)}(De),Dd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.snoozeOn,o=e.startTs,u=e.endTs;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference"),a.params={snooze_enabled:s,snooze_start_ts:o,snooze_end_ts:u},a}return i(n)}(Ue),Ld=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).snoozePeriod={isSnoozeOn:a.snooze_enabled},"number"==typeof a.snooze_start_ts&&(i.snoozePeriod.startTs=a.snooze_start_ts),"number"==typeof a.snooze_end_ts&&(i.snoozePeriod.endTs=a.snooze_end_ts),i}return i(n)}(De),Rd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.blockedUserId;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/block"),a.params={target_id:s},a}return i(n)}(Ue),Pd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.unblockedUserId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/block/").concat(encodeURIComponent(s)),a}return i(n)}(Ue),Fd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference"),a}return i(n)}(Ue),Hd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i}return i(n)}(De),qd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.pushTriggerOption;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference"),a.params={push_trigger_option:s},a}return i(n)}(Ue),Gd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i}return i(n)}(De),jd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/template"),a}return i(n)}(Ue),zd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).name=a.name,i}return i(n)}(De),Vd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.templateName;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push/template"),a.params={name:s},a}return i(n)}(Ue),Bd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).name=a.name,i}return i(n)}(De),Qd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.token;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/friends/changelogs"),a.params={token:s},a}return i(n)}(Ue),Kd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).changelogs={addedUsers:a.added.map((function(t){return new si(e,t)})),updatedUsers:a.updated.map((function(t){return new si(e,t)})),deletedUserIds:a.deleted,hasMore:a.has_more,token:a.next},i}return i(n)}(De),Wd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.discoveries;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/friend_discoveries"),a.params={friend_discoveries:s.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},a}return i(n)}(Ue),Yd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).friendDiscoveryRequestId=a.friend_discovery_request_id,i}return i(n)}(De),Zd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.discoveryKeys;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/friend_discoveries"),a.params={friend_discovery_keys:s},a}return i(n)}(Ue),Jd=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.userIds;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/friends"),a.params={user_ids:s},a}return i(n)}(Ue),Xd=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).users=a.users.map((function(t){return new si(e,t)})),i}return i(n)}(De),$d=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.userIds;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/friends"),a.params={user_ids:s},a}return i(n)}(Ue),eh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(i,"/allow_friend_discovery"),a.params={},a}return i(n)}(Ue),th=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).allowFriendDiscovery=a.allow_friend_discovery,i}return i(n)}(De),nh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.allowFriendDiscovery;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(i,"/allow_friend_discovery"),a.params={allow_friend_discovery:s},a}return i(n)}(Ue),rh=function(e){s(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.call(this)).method=de.GET,e.path=be,e}return i(n)}(Ue),ah=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).emojiContainer=new sc(a),i}return i(n)}(De),ih=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.categoryId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(be,"/").concat(i),a}return i(n)}(Ue),sh=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).emojiCategory=new ic(a),i}return i(n)}(De),oh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.key;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Ee,"/").concat(i),a}return i(n)}(Ue),uh=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).emoji=new ac(a),i}return i(n)}(De),ch=function(e){s(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.call(this)).method=de.GET,e.path="".concat(xe),e}return i(n)}(Ue),lh=function(e){s(n,e);var t=f(n);function n(e,a){var i,s;r(this,n);var o=null!=a?a:{};return(i=t.call(this,e,a)).uikitConfiguration={string:JSON.stringify(o),json:o},i.updatedAt=null!==(s=null==a?void 0:a.updated_at)&&void 0!==s?s:0,i}return i(n)}(De),dh=function(){function n(e,a,i){var s=this;r(this,n),this._storeInitialized=!1,this._iid=e,this.options=a;var o=Ei.of(e),u=o.sdkState,c=o.cacheContext,l=o.dispatcher,d=o.sessionManager,h=o.requestQueue,f=o.logger,p=o.userEventHandlers,v=o.appStateToggleEnabled;this._onlineDetector=new ad({logger:f,connectionDelegate:{reconnect:function(){var t=Ei.of(e),n=t.sdkState,r=t.connectionManager,a=t.sessionManager;a.auth.hasSession?"foreground"===n.appState&&r.resetAndReconnect():r.connect(a.auth.authToken)},disconnect:function(){Ei.of(e).connectionManager.disconnect()}}});var _=new od(e,{localCacheEnabled:c.localCacheEnabled,dispatcher:l,sdkState:u,logger:f});i.forEach((function(t){t.init(e,{sdkState:u,cacheContext:c,dispatcher:l,sessionManager:d,requestQueue:h,logger:f,onlineDetector:s._onlineDetector}),s[t.name]=t})),this._appStateChangeDetector=new rd({isEnabled:v}),this._appStateChangeDetector.on("resume",(function(){f.debug("the page resumes from freeze"),s.setForegroundState()})).on("pause",(function(){f.debug("the page freezes"),s.setBackgroundState()})),l.on((function(n){var r;if(n instanceof ga){if(n.stateType===da.CONNECTED)_.processNonAutoResendRegisteredPendingMessages()}else if(n instanceof Qe){if("USEV"===n.code){var a=n.as(fd).event;if(a.category===Xl.FRIEND_DISCOVERED){var i=ld.getDataAsFriendDiscoveredEvent(e,a).friendDiscoveries;Aa((function(){return E(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.forEach((function(e){e.onFriendsDiscovered&&e.onFriendsDiscovered(i)})));case 1:case"end":return e.stop()}}),e)})))}))}}}else if(n instanceof pa){var o=Ei.of(s._iid).subscribedUnreadMessageCount,l=!1,d=n.ts;if("number"==typeof d&&d>o.ts){if(o.all!==n.all&&(l=!0),o.all=n.all>=0?n.all:0,n.customTypes)for(var h in n.customTypes)o.customTypes[h]!==n.customTypes[h]&&(l=!0),o.customTypes[h]=n.customTypes[h];l=l&&o.ts>0,o.ts=d}l&&Aa((function(){return E(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.forEach((function(e){e.onTotalUnreadMessageCountChanged&&e.onTotalUnreadMessageCountChanged({groupChannelCount:o.all,feedChannelCount:o.feed,customTypeUnreadCount:o.customTypes}),e.onTotalUnreadMessageCountUpdated&&e.onTotalUnreadMessageCountUpdated(o.all,o.customTypes)})));case 1:case"end":return e.stop()}}),e)})))}))}else n instanceof oi?(c.preference.set(s._getUserProfileCacheKey(u.userId),ui.payloadify(n.userProfile)),(null===(r=n.userProfile.appInfo.notificationInfo)||void 0===r?void 0:r.isEnabled)&&c.preference.set(Ba(s.appId),{value:!0})):n instanceof Re&&n.error&&(n.error.isSessionRevokedError||n.error.isUserAuthDeactivedError||n.error.isUserAuthDeletedOrNotFoundError)&&(f.debug("session revoked."),s.disconnect())}))}return i(n,[{key:"appId",get:function(){return Ei.of(this._iid).sdkState.appId}},{key:"appInfo",get:function(){var e=Ei.of(this._iid).appInfo;return null!=e?e:null}},{key:"appVersion",get:function(){var e;return null!==(e=Ei.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""}},{key:"debugMode",get:function(){return!!Ei.of(this._iid).debugMode}},{key:"logLevel",get:function(){return Ei.of(this._iid).logger.level},set:function(e){Ei.of(this._iid).logger.level=e}},{key:"isCacheEnabled",get:function(){return Ei.of(this._iid).cacheContext.localCacheEnabled}},{key:"localCacheConfig",get:function(){var e=Ei.of(this._iid).cacheContext;return e.localCacheEnabled?e.localCacheConfig:null}},{key:"ekey",get:function(){return Ei.of(this._iid).sessionManager.ekey}},{key:"currentUser",get:function(){var e;return null!==(e=Ei.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null}},{key:"connectionState",get:function(){var t=Ei.of(this._iid).connectionManager;return t.isConnected?e.ConnectionState.OPEN:t.isConnecting?e.ConnectionState.CONNECTING:e.ConnectionState.CLOSED}},{key:"lastConnectedAt",get:function(){var e=Ei.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0}},{key:"fcmPushToken",get:function(){var e;return null!==(e=this._fcmPushToken)&&void 0!==e?e:null}},{key:"apnsPushToken",get:function(){var e;return null!==(e=this._apnsPushToken)&&void 0!==e?e:null}},{key:"_getNestDBVersion",value:function(){return 3}},{key:"_getCurrentPreferenceVersion",value:function(){return 1}},{key:"_getPreferenceCacheKey",value:function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")}},{key:"_getUserProfileCacheKey",value:function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")}},{key:"getMemoryStoreForDebugging",value:function(){var e=Ei.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof pl?n.store:null;throw M.debugModeRequired}},{key:"addExtension",value:function(e,t){var n=Ei.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&n.extensions&&(n.extensions[e]=t)}},{key:"addSendbirdExtensions",value:function(e,t,n){var r=Ei.of(this._iid),a=r.logger,i=r.sdkState,s=new RegExp("^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$");if(0===e.length)return a.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(e.find((function(e){return!s.test(e.version)})))return a.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(n)for(var o=0,u=Object.entries(n);o<u.length;o++){var c=v(u[o],2),l=c[0],d=c[1];if(/&|=/.test(l)||/&|=/.test(d))return a.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}return i.sendbirdRuntimeEnvironment={sendbirdExtensions:e,deviceOS:t,customData:n},!0}},{key:"setOnlineListener",value:function(e){this._onlineDetector.setOnlineListener(e)}},{key:"setOfflineListener",value:function(e){this._onlineDetector.setOfflineListener(e)}},{key:"_safeInitializeStore",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.cacheContext,t.prev=1,t.next=4,a.store.init(e);case 4:this._storeInitialized=!0,t.next=12;break;case 7:return t.prev=7,t.t0=t.catch(1),a.replaceStore(new pl),t.next=12,this._safeInitializeStore(e);case 12:case"end":return t.stop()}}),n,this,[[1,7]])})))}},{key:"initializeCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Ei.of(this._iid),a=r.sdkState,i=r.cacheContext,s=r.connectionManager,o=r.dispatcher,u=r.logger,a.userId&&a.userId===e){t.next=30;break}return t.next=4,s.logout();case 4:if(c="sendbird@".concat(a.appId,"/").concat(e,".db"),!i.localCacheEnabled){t.next=27;break}if(t.prev=6,i.nestdb&&i.nestdb.state!==_l.CLOSED&&i.nestdb.name===c){t.next=15;break}return(l=i.nestdb=new El({name:"sendbird@".concat(a.appId,"/").concat(e,".db"),version:this._getNestDBVersion(),store:i.store})).on("upgrade",td(l,i.store)),l.on("storeReplaced",(function(e){i.replaceStore(e),i.localCacheEnabled=!1,l.on("upgrade",td(l,i.store))})),t.next=13,l.open();case 13:this._storeInitialized=!0,o.dispatch(new dd(this._iid,{userId:e}));case 15:a.userId=e,t.next=25;break;case 18:return t.prev=18,t.t0=t.catch(6),u.warn("Nest DB Open Failed. ",t.t0),t.next=23,this._safeInitializeStore(c);case 23:throw a.userId=e,M.databaseError;case 25:t.next=30;break;case 27:return t.next=29,this._safeInitializeStore(c);case 29:a.userId=e;case 30:case"end":return t.stop()}}),n,this,[[6,18]])})))}},{key:"getCacheDataSize",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ei.of(this._iid),!(r=n.cacheContext).localCacheEnabled||!r.nestdb){e.next=5;break}return e.next=4,r.nestdb.estimateUsage();case 4:return e.abrupt("return",e.sent);case 5:return e.abrupt("return",0);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearCachedData",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ei.of(this._iid),!(r=n.cacheContext).localCacheEnabled){e.next=5;break}if(!r.nestdb){e.next=5;break}return e.next=5,r.nestdb.clear();case 5:if(!this._storeInitialized){e.next=8;break}return e.next=8,r.preference.clear();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"clearCachedMessages",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(ai(F("string",e)).throw(M.invalidParameters),r=Ml.of(this._iid),a=Nl.of(this._iid),!r||!a){n.next=6;break}return n.next=6,Promise.all(e.map((function(e){return E(i,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.removeMessagesOfChannel(e);case 2:return t.next=4,a.removeMessagesOfChannel(e);case 4:case"end":return t.stop()}}),n)})))})));case 6:case"end":return n.stop()}}),n,this)})))}},{key:"connect",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)&&L("string",n,!0)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.sdkState,s=a.cacheContext,o=a.connectionManager,u=a.statLogCollector,t.prev=2,t.next=5,this.initializeCache(e);case 5:c=Ei.of(this._iid),c.dispatcher.dispatch(new hd),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(2),l=Ei.of(this._iid),d=l.logger,s.localCacheEnabled=!1,d.warn("Cache initialization failed - cache is not available.");case 14:return t.next=16,s.preference.init(this._getPreferenceCacheKey(e),this._getCurrentPreferenceVersion());case 16:return t.next=18,s.preference.get(this._getUserProfileCacheKey(e));case 18:return(h=t.sent)&&new ui(this._iid,h).apply(),t.next=22,u.init("sendbird@".concat(i.appId,"/").concat(e,".statlog"));case 22:return t.prev=22,t.next=25,o.connect(n);case 25:return t.prev=25,this._onlineDetector.start(),this._appStateChangeDetector.start(),t.finish(25);case 29:return t.abrupt("return",this.currentUser);case 30:case"end":return t.stop()}}),r,this,[[2,9],[22,,25,29]])})))}},{key:"reconnect",value:function(){var e=Ei.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),t.resetAndReconnect().then((function(){n.appState="foreground"})).catch((function(){}))),r}},{key:"disconnect",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.connectionManager,a=n.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),a.cancelAll(),e.next=6,r.logout();case 6:return e.next=8,this.clearCachedData();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"disconnectWebSocket",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.connectionManager,a=n.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),a.cancelAll(),e.next=6,r.disconnectWebSocket();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setBackgroundState",value:function(){var e=Ei.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background())}},{key:"setForegroundState",value:function(){var e=Ei.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect())}},{key:"setSessionHandler",value:function(e){ai(e instanceof uc).throw(M.invalidParameters),Ei.of(this._iid).sessionManager.handler=e}},{key:"addUserEventHandler",value:function(e,t){ai(L("string",e)&&t instanceof cc).throw(M.invalidParameters),Ei.of(this._iid).userEventHandlers.set(e,t)}},{key:"removeUserEventHandler",value:function(e){Ei.of(this._iid).userEventHandlers.delete(e)}},{key:"removeAllUserEventHandler",value:function(){Ei.of(this._iid).userEventHandlers.clear()}},{key:"addConnectionHandler",value:function(e,t){ai(L("string",e)&&t instanceof oc).throw(M.invalidParameters),Ei.of(this._iid).connectionHandlers.set(e,t)}},{key:"removeConnectionHandler",value:function(e){Ei.of(this._iid).connectionHandlers.delete(e)}},{key:"removeAllConnectionHandler",value:function(){Ei.of(this._iid).connectionHandlers.clear()}},{key:"createApplicationUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new hc(this._iid,e)}},{key:"createBlockedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new vc(this._iid,e)}},{key:"createFriendListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new gc(this._iid,e)}},{key:"createMessageSearchQuery",value:function(e){return new Vl(this._iid,e)}},{key:"createPollListQuery",value:function(e){return new Zu(this._iid,Object.assign({},e))}},{key:"createPollVoterListQuery",value:function(e){return new $u(this._iid,Object.assign({},e))}},{key:"buildUserFromSerializedData",value:function(e){var t=ri(e);return new si(this._iid,si.payloadify(t))}},{key:"updateCurrentUserInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object.assign(Object.assign({},Zl),e),ai(Jl(r)).throw(M.invalidParameters),!this.currentUser){t.next=13;break}return a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new pd(Object.assign({userId:i.userId},r)),t.next=7,s.send(o);case 7:return u=t.sent,c=u.as(vd),l=c.user,this.currentUser&&(r.nickname&&(this.currentUser.nickname=l.nickname),(r.profileUrl||r.profileImage)&&(this.currentUser.plainProfileUrl=l.profileUrl)),t.abrupt("return",l);case 13:throw M.connectionRequired;case 14:case"end":return t.stop()}}),n,this)})))}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ai(F("string",e)).throw(M.invalidParameters),!this.currentUser){t.next=12;break}return r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new pd({userId:a.userId,preferredLanguages:e}),t.next=6,i.send(s);case 6:return o=t.sent,u=o.as(vd),c=u.user,this.currentUser&&(this.currentUser.preferredLanguages=c.preferredLanguages),t.abrupt("return",c);case 12:throw M.connectionRequired;case 13:case"end":return t.stop()}}),n,this)})))}},{key:"registerFCMPushTokenForCurrentUser",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(ai(L("string",n)).throw(M.invalidParameters),!this.currentUser){r.next=20;break}if(r.prev=2,a=Ei.of(this._iid),i=a.sessionManager,s=a.sdkState,o=a.requestQueue,!i.hasDeviceToken(e.PushTokenType.FCM,n)){r.next=6;break}return r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 6:return u=new md({userId:s.userId,token:n}),r.next=9,o.send(u);case 9:return r.next=11,Ma((function(){return E(c,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.setDeviceToken(e.PushTokenType.FCM,n),t.next=3,i.saveDeviceToken();case 3:case"end":return t.stop()}}),r)})))}));case 11:return this._fcmPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._fcmPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterFCMPushTokenForCurrentUser",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(ai(L("string",n)).throw(M.invalidParameters),!this.currentUser){r.next=20;break}return r.prev=2,a=Ei.of(this._iid),i=a.sessionManager,s=a.sdkState,o=a.requestQueue,u=new yd({userId:s.userId,token:n}),r.next=7,o.send(u);case 7:return c=r.sent,l=c.lastDeletedAt,r.next=11,Ma((function(){return E(d,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.unsetDeviceToken(e.PushTokenType.FCM,n),i.setDeviceTokenDeletedAt(l),t.next=4,i.saveDeviceToken();case 4:case"end":return t.stop()}}),r)})))}));case 11:return this._fcmPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._fcmPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterFCMPushTokenAllForCurrentUser",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.currentUser){n.next=9;break}return r=Ei.of(this._iid),a=r.sessionManager,i=r.sdkState,s=r.requestQueue,o=new Ed({userId:i.userId}),n.next=5,s.send(o);case 5:return u=n.sent,c=u.lastDeletedAt,n.next=9,Ma((function(){return E(l,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.unsetDeviceTokens(e.PushTokenType.FCM),a.setDeviceTokenDeletedAt(c),t.next=4,a.saveDeviceToken();case 4:case"end":return t.stop()}}),n)})))}));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"registerAPNSPushTokenForCurrentUser",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(ai(L("string",n)).throw(M.invalidParameters),!this.currentUser){r.next=20;break}if(r.prev=2,a=Ei.of(this._iid),i=a.sessionManager,s=a.sdkState,o=a.requestQueue,!i.hasDeviceToken(e.PushTokenType.APNS,n)){r.next=6;break}return r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 6:return u=new _d({userId:s.userId,token:n}),r.next=9,o.send(u);case 9:return r.next=11,Ma((function(){return E(c,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.setDeviceToken(e.PushTokenType.APNS,n),t.next=3,i.saveDeviceToken();case 3:case"end":return t.stop()}}),r)})))}));case 11:return this._apnsPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._apnsPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(ai(L("string",n)).throw(M.invalidParameters),!this.currentUser){r.next=20;break}return r.prev=2,a=Ei.of(this._iid),i=a.sessionManager,s=a.sdkState,o=a.requestQueue,u=new gd({userId:s.userId,token:n}),r.next=7,o.send(u);case 7:return c=r.sent,l=c.lastDeletedAt,r.next=11,Ma((function(){return E(d,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.unsetDeviceToken(e.PushTokenType.APNS,n),i.setDeviceTokenDeletedAt(l),t.next=4,i.saveDeviceToken();case 4:case"end":return t.stop()}}),r)})))}));case 11:return this._apnsPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._apnsPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.currentUser){n.next=9;break}return r=Ei.of(this._iid),a=r.sessionManager,i=r.sdkState,s=r.requestQueue,o=new kd({userId:i.userId}),n.next=5,s.send(o);case 5:return u=n.sent,c=u.lastDeletedAt,n.next=9,Ma((function(){return E(l,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.unsetDeviceTokens(e.PushTokenType.APNS),a.setDeviceTokenDeletedAt(c),t.next=4,a.saveDeviceToken();case 4:case"end":return t.stop()}}),n)})))}));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"getChannelInvitationPreference",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Cd({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(xd),u=o.autoAccept,e.abrupt("return",{autoAccept:u});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setChannelInvitationPreference",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("boolean",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Td({userId:a.userId,willAutoAccept:e}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(Sd),c=u.autoAccept,t.abrupt("return",{autoAccept:c});case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getDoNotDisturb",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Id({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(Nd),u=o.preference,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setDoNotDisturb",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return E(this,void 0,void 0,t().mark((function o(){var u,c,l,d,h,f,p;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("boolean",e)&&L("number",n)&&L("number",r)&&L("number",a)&&L("number",i)&&L("string",s)).throw(M.invalidParameters),u=Ei.of(this._iid),c=u.sdkState,l=u.requestQueue,d=new Ad({userId:c.userId,doNotDisturbOn:e,startHour:n,startMin:r,endHour:a,endMin:i,timezone:s}),t.next=5,l.send(d);case 5:return h=t.sent,f=h.as(Md),p=f.preference,t.abrupt("return",p);case 8:case"end":return t.stop()}}),o,this)})))}},{key:"getSnoozePeriod",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Od({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(Ud),u=o.snoozePeriod,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setSnoozePeriod",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("boolean",e)&&L("number",n)&&L("number",r)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.sdkState,o=i.requestQueue,u=new Dd({userId:s.userId,snoozeOn:e,startTs:n,endTs:r}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Ld),d=l.snoozePeriod,t.abrupt("return",d);case 8:case"end":return t.stop()}}),a,this)})))}},{key:"getMyPushTokensByToken",value:function(n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d,h,f,p,v;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",n)&&R(e.PushTokenType,r)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.sdkState,o=i.requestQueue,u=i.sessionManager,c=new bd({userId:s.userId,type:r,token:n}),t.next=5,o.send(c);case 5:l=t.sent,d=l.as(wd),h=d.pushTokens,f=y(h.deviceTokens);try{for(f.s();!(p=f.n()).done;)v=p.value,u.setDeviceToken(h.type,v)}catch(e){f.e(e)}finally{f.f()}return t.next=11,u.saveDeviceToken();case 11:return t.abrupt("return",h);case 12:case"end":return t.stop()}}),a,this)})))}},{key:"getPushTriggerOption",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Fd({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,e.abrupt("return",s.as(Hd).pushTriggerOption);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setPushTriggerOption",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(R(e.PushTriggerOption,n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new qd({userId:i.userId,pushTriggerOption:n}),t.next=5,s.send(o);case 5:return u=t.sent,t.abrupt("return",u.as(Gd).pushTriggerOption);case 7:case"end":return t.stop()}}),r,this)})))}},{key:"getPushTemplate",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new jd({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,e.abrupt("return",s.as(zd).name);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setPushTemplate",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(R(e.PushTemplate,n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new Vd({userId:i.userId,templateName:n}),t.next=5,s.send(o);case 5:return u=t.sent,t.abrupt("return",u.as(Bd).name);case 7:case"end":return t.stop()}}),r,this)})))}},{key:"blockUser",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e instanceof si||L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Rd({userId:a.userId,blockedUserId:e instanceof si?e.userId:e}),t.next=5,i.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"blockUserWithUserId",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.blockUser(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"unblockUser",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e instanceof si||L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Pd({userId:a.userId,unblockedUserId:e instanceof si?e.userId:e}),t.next=5,i.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"unblockUserWithUserId",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unblockUser(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"getFriendChangeLogsByToken",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Qd({userId:a.userId,token:e}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(Kd),c=u.changelogs,t.abrupt("return",c);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getAllowFriendDiscovery",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new eh({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(th),u=o.allowFriendDiscovery,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setAllowFriendDiscovery",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("boolean",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new nh({userId:a.userId,allowFriendDiscovery:e}),t.next=5,i.send(s);case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"uploadFriendDiscoveries",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Wd({userId:a.userId,discoveries:e}),t.next=4,i.send(s);case 4:return o=t.sent,u=o.as(Yd),c=u.friendDiscoveryRequestId,t.abrupt("return",c);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriendDiscovery",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deleteFriendDiscoveries([e]));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriendDiscoveries",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Zd({userId:a.userId,discoveryKeys:e}),t.next=5,i.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"addFriends",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new Jd({userId:a.userId,userIds:e}),t.next=5,i.send(s);case 5:return o=t.sent,u=o.as(Xd),c=u.users,t.abrupt("return",c);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriend",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deleteFriends([e]));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriends",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",e)).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new $d({userId:a.userId,userIds:e}),t.next=5,i.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getAllEmoji",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new rh,e.next=4,r.send(a);case 4:return i=e.sent,s=i.as(ah),o=s.emojiContainer,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getEmojiCategory",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.requestQueue,i=new ih({categoryId:e}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(sh),u=o.emojiCategory,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"getEmoji",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.requestQueue,i=new oh({key:e}),t.next=4,a.send(i);case 4:return s=t.sent,o=s.as(uh),u=o.emoji,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"getUIKitConfiguration",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),ai(n.hasExtension("sb_uikit")).throw(M.notSupportedError),r=n.requestQueue,a=new ch,e.next=6,r.send(a);case 6:return i=e.sent,s=i.as(lh),o=s.uikitConfiguration,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e,this)})))}}],[{key:"init",value:function(e){var t=e.appId,r=e.appVersion,a=e.modules,i=void 0===a?[]:a,s=e.options,o=void 0===s?new G:s,u=e.debugMode,c=void 0!==u&&u,l=e.customApiHost,d=e.customWebSocketHost,h=e.newInstance,f=void 0!==h&&h,p=e.logLevel,v=e.localCacheEnabled,m=void 0!==v&&v,g=e.localCacheConfig,y=void 0===g?new ne:g,k=e.localCacheEncryption,E=e.useAsyncStorageStore,b=void 0===E?null:E,w=e.appStateToggleEnabled,C=void 0===w||w;if(!ud||f){var x="su-".concat(ae()),T=null!=k?k:{encrypt:function(e){return e},decrypt:function(e){return e}},S=new pl({encryption:T});c||(S=je()?b?new gl({AsyncStorage:b,encryption:T}):new pl({encryption:T}):new ml({encryption:T})),new Ei(x,{appId:t,appVersion:r,options:o,apiHost:null!=l?l:"https://api-".concat(t,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(t,".sendbird.com"),store:S,encryption:T,logLevel:p,localCacheEnabled:m,localCacheConfig:y,debugMode:c,appStateToggleEnabled:C});var I=[new Kl,new Yl],N=new n(x,o,[].concat(_(i),I));return ud||(ud=N),N}return ud}},{key:"instance",get:function(){return ud}},{key:"version",get:function(){return w}}]),n}();e.MemberState=void 0,(cd=e.MemberState||(e.MemberState={})).NONE="none",cd.JOINED="joined",cd.INVITED="invited",cd.LEFT="left";var hh,fh,ph,vh,_h,mh,gh,yh,kh=function(t){s(a,t);var n=f(a);function a(t,i){var s;return r(this,a),(s=n.call(this,t,i)).state=null,s.role=null,s.isMuted=!1,s.isBlockedByMe=!1,s.isBlockingMe=!1,s.state=R(e.MemberState,i.state)?i.state:null,s.role=R(e.Role,i.role)?i.role:null,"boolean"==typeof i.is_muted&&(s.isMuted=i.is_muted),"boolean"==typeof i.is_blocked_by_me&&(s.isBlockedByMe=i.is_blocked_by_me),"boolean"==typeof i.is_blocking_me&&(s.isBlockingMe=i.is_blocking_me),s}return i(a,null,[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(a),"payloadify",this).call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})))}}]),a}(Us),Eh=function(t){s(a,t);var n=f(a);function a(t,i){var s,o,u;return r(this,a),(s=n.call(this,t)).channelUrl=null!==(o=i.channel_url)&&void 0!==o?o:"",s.channelType=null!==(u=i.channel_type)&&void 0!==u?u:e.ChannelType.GROUP,s.reader=new si(s._iid,i.user),s.readAt=i.ts,s}return i(a)}(Ya);e.PublicChannelFilter=void 0,(hh=e.PublicChannelFilter||(e.PublicChannelFilter={})).ALL="all",hh.PUBLIC="public",hh.PRIVATE="private",e.MyMemberStateFilter=void 0,(fh=e.MyMemberStateFilter||(e.MyMemberStateFilter={})).ALL="all",fh.JOINED="joined_only",fh.INVITED="invited_only",fh.INVITED_BY_FRIEND="invited_by_friend",fh.INVITED_BY_NON_FRIEND="invited_by_non_friend",e.SuperChannelFilter=void 0,(ph=e.SuperChannelFilter||(e.SuperChannelFilter={})).ALL="all",ph.SUPER="super",ph.NON_SUPER="nonsuper",ph.BROADCAST_ONLY="broadcast_only",ph.EXCLUSIVE_ONLY="exclusive_only",e.UnreadChannelFilter=void 0,(vh=e.UnreadChannelFilter||(e.UnreadChannelFilter={})).ALL="all",vh.UNREAD_MESSAGE="unread_message",e.HiddenChannelFilter=void 0,(_h=e.HiddenChannelFilter||(e.HiddenChannelFilter={})).ALL="all",_h.UNHIDDEN="unhidden_only",_h.HIDDEN="hidden_only",_h.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",_h.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide",e.OperatorFilter=void 0,(mh=e.OperatorFilter||(e.OperatorFilter={})).ALL="all",mh.OPERATOR="operator",mh.NONOPERATOR="nonoperator",e.QueryType=void 0,(gh=e.QueryType||(e.QueryType={})).AND="AND",gh.OR="OR",e.GroupChannelSearchField=void 0,(yh=e.GroupChannelSearchField||(e.GroupChannelSearchField={})).MEMBER_NICKNAME="member_nickname",yh.CHANNEL_NAME="channel_name";var bh,wh=function(){function t(){r(this,t),this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=e.MyMemberStateFilter.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=e.SuperChannelFilter.ALL,this.publicChannelFilter=e.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=e.UnreadChannelFilter.ALL,this.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return i(t,[{key:"_isFriend",value:function(e){return!(!e||!e.friendDiscoveryKey&&!e.friendName)}},{key:"searchFilter",get:function(){return this._searchFilter}},{key:"setSearchFilter",value:function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})}},{key:"userIdsFilter",get:function(){return this._userIdsFilter}},{key:"setUserIdsFilter",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.QueryType.AND;this._userIdsFilter={userIds:t,includeMode:n,queryType:r}}},{key:"clone",value:function(){var e,n=new t;this.searchFilter&&n.setSearchFilter(this.searchFilter.fields,null!==(e=this.searchFilter.query)&&void 0!==e?e:void 0),this.userIdsFilter&&n.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var r=JSON.parse(JSON.stringify(this));return Object.keys(r).forEach((function(e){n[e]=r[e]})),n}},{key:"match",value:function(t,n){if(this._searchFilter){var r=this._searchFilter,a=r.query,i=r.fields;if(a&&i&&i.length>0&&!i.some((function(n){switch(n){case e.GroupChannelSearchField.CHANNEL_NAME:return t.name.toLowerCase().includes(a.toLowerCase());case e.GroupChannelSearchField.MEMBER_NICKNAME:return t.members.some((function(e){return e.nickname.toLowerCase().includes(a.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var s=this._userIdsFilter,o=s.userIds,u=s.includeMode,c=s.queryType,l=t.members.map((function(e){return e.userId}));if(u){if(o.length>0)switch(c){case e.QueryType.AND:if(o.some((function(e){return!l.includes(e)})))return!1;break;case e.QueryType.OR:if(o.every((function(e){return!l.includes(e)})))return!1}}else{if(o.includes(n)||o.push(n),t.members.length>o.length)return!1;if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=_(e).sort(),r=_(t).sort(),a=0;a<n.length;++a)if(n[a]!==r[a])return!1;return!0}(o,l))return!1}}if(!this.includeEmpty&&!t.lastMessage)return!1;if(!this.includeFrozen&&t.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(t.customType))return!1;if(this.channelNameContainsFilter&&!t.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var d=this.nicknameContainsFilter.toLowerCase();if(!t.members.some((function(e){return e.userId!==n&&e.nickname.toLowerCase().includes(d)})))return!1}if(this.nicknameStartsWithFilter){var h=this.nicknameStartsWithFilter.toLowerCase();if(!t.members.some((function(e){return e.userId!==n&&e.nickname.toLowerCase().startsWith(h)})))return!1}if(this.nicknameExactMatchFilter){var f=this.nicknameExactMatchFilter.toLowerCase();if(!t.members.some((function(e){return e.userId!==n&&e.nickname.toLowerCase()!=f})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(t.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case e.MyMemberStateFilter.JOINED:if("joined"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED:if("invited"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED_BY_FRIEND:if("invited"!==t.myMemberState||!this._isFriend(t.inviter))return!1;break;case e.MyMemberStateFilter.INVITED_BY_NON_FRIEND:if("invited"!==t.myMemberState||this._isFriend(t.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case e.HiddenChannelFilter.UNHIDDEN:if(t.isHidden||"unhidden"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN:if(!t.isHidden)return!1;break;case e.HiddenChannelFilter.HIDDEN_ALLOW_AUTO_UNHIDE:if(!t.isHidden||"hidden_allow_auto_unhide"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN_PREVENT_AUTO_UNHIDE:if(!t.isHidden||"hidden_prevent_auto_unhide"!==t.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===e.UnreadChannelFilter.UNREAD_MESSAGE)if(0===t.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case e.PublicChannelFilter.PUBLIC:if(!t.isPublic)return!1;break;case e.PublicChannelFilter.PRIVATE:if(t.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case e.SuperChannelFilter.SUPER:if(!t.isSuper)return!1;break;case e.SuperChannelFilter.NON_SUPER:if(t.isSuper)return!1}return!0}}]),t}(),Ch=function(n){s(o,n);var a=f(o);function o(e,t){var n,i=t.sdkState,s=t.cacheContext;return r(this,o),(n=a.call(this,e))._channels=new Map,n._sdkState=i,n._cacheContext=s,n}return i(o,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return ai(!!e).throw(M.databaseError),e.collection(Qu)}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object.assign(Object.assign({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})}},{key:"_deserialize",value:function(e){return Zf.of(this._iid).buildGroupChannelFromSerializedData(e)}},{key:"channels",get:function(){return _(this._channels.values())}},{key:"isCachedInMemory",value:function(e){return this._channels.has(e)}},{key:"filterOffsetChanged",value:function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._channels.has(e)){t.next=12;break}if(!this.localCacheEnabled){t.next=9;break}return t.next=4,this.collection.getByKey(e);case 4:if(!(r=t.sent)){t.next=9;break}return a=this._deserialize(r),this._channels.set(e,a),t.abrupt("return",a);case 9:return t.abrupt("return",void 0);case 12:return t.abrupt("return",this._channels.get(e));case 13:case"end":return t.stop()}}),n,this)})))}},{key:"fetch",value:function(n){var r=n.token,a=n.limit,i=void 0===a?100:a,s=n.backward,o=void 0!==s&&s,u=n.filter,c=void 0===u?new wh:u,l=n.order,d=void 0===l?e.GroupChannelListOrder.LATEST_LAST_MESSAGE:l,h=n.borderlineChannelUrl;return E(this,void 0,void 0,t().mark((function n(){var a,s,u,l,f,p=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=12;break}return a=$l(d),s={where:function(t){if(r)switch(d){case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:if(!o&&t.name.localeCompare(r)<0||o&&t.name.localeCompare(r)>0)return!1;if(h&&h===t.url)return!1;break;case e.GroupChannelListOrder.CHRONOLOGICAL:if(!o&&t.createdAt>r||o&&t.createdAt<r)return!1;if(h&&h===t.url)return!1;break;case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:if(!o&&t.lastMessageUpdatedAt>r||o&&t.lastMessageUpdatedAt<r)return!1;if(h&&h===t.url)return!1}return c.match(p._deserialize(t),p._sdkState.userId)},index:a,backward:o},t.next=5,this.collection.query(s);case 5:return u=t.sent,t.next=8,u.fetch({limit:i});case 8:return l=t.sent,(f=l.map((function(e){return p._deserialize(e)}))).forEach((function(e){p._channels.has(e.url)||p._channels.set(e.url,e)})),t.abrupt("return",f);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),n,this)})))}},{key:"upsert",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=[],e.forEach((function(e){if(o._channels.has(e.url)){var t=o._channels.get(e.url);t._pinnedMessagesUpdatedAt<e._pinnedMessagesUpdatedAt&&(t._pinnedMessagesUpdatedAt=e._pinnedMessagesUpdatedAt),e.cachedMetaData&&n&&(t._updateCachedMetaData(e.cachedMetaData,n),Object.assign(e,{_cachedMetaData:void 0})),t._update(e),a.push(t)}else o._channels.set(e.url,e),a.push(e)})),!this.localCacheEnabled){t.next=7;break}for(s in i=[],a)i.push(this._serialize(a[s],parseInt(s)));return t.next=7,this.collection.upsertMany(i);case 7:return t.abrupt("return",a);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=y(e),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=11;break}if(i=a.value,this._channels.delete(i),!this.localCacheEnabled){t.next=9;break}return t.next=9,this.collection.remove(i);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:case"end":return t.stop()}}),n,this,[[1,13,16,19]])})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clearMemoryCache(),!this.localCacheEnabled){e.next=4;break}return e.next=4,this.collection.clear();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearMemoryCache",value:function(){this._channels.clear()}},{key:"_setBlockStateOfAllChannels",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d,h,f,p,v,_,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=[],e!==this._sdkState.userId){t.next=38;break}s=y(this._channels.values()),t.prev=3,s.s();case 5:if((o=s.n()).done){t.next=28;break}u=o.value,c=y(u.members),t.prev=8,c.s();case 10:if((l=c.n()).done){t.next=18;break}if((d=l.value).userId!==n){t.next=16;break}return d.isBlockedByMe=r,i.push(u),t.abrupt("break",18);case 16:t.next=10;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(8),c.e(t.t0);case 23:return t.prev=23,c.f(),t.finish(23);case 26:t.next=5;break;case 28:t.next=33;break;case 30:t.prev=30,t.t1=t.catch(3),s.e(t.t1);case 33:return t.prev=33,s.f(),t.finish(33);case 36:t.next=73;break;case 38:if(n!==this._sdkState.userId){t.next=73;break}h=y(this._channels.values()),t.prev=40,h.s();case 42:if((f=h.n()).done){t.next=65;break}p=f.value,v=y(p.members),t.prev=45,v.s();case 47:if((_=v.n()).done){t.next=55;break}if((m=_.value).userId!==e){t.next=53;break}return m.isBlockingMe=r,i.push(p),t.abrupt("break",55);case 53:t.next=47;break;case 55:t.next=60;break;case 57:t.prev=57,t.t2=t.catch(45),v.e(t.t2);case 60:return t.prev=60,v.f(),t.finish(60);case 63:t.next=42;break;case 65:t.next=70;break;case 67:t.prev=67,t.t3=t.catch(40),h.e(t.t3);case 70:return t.prev=70,h.f(),t.finish(70);case 73:if(!(i.length>0)){t.next=76;break}return t.next=76,this.upsert(i);case 76:case"end":return t.stop()}}),a,this,[[3,30,33,36],[8,20,23,26],[40,67,70,73],[45,57,60,63]])})))}},{key:"block",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setBlockStateOfAllChannels(e,n,!0);case 2:case"end":return t.stop()}}),r,this)})))}},{key:"unblock",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setBlockStateOfAllChannels(e,n,!1);case 2:case"end":return t.stop()}}),r,this)})))}},{key:"markAsRead",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_(this._channels.keys());return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],i=y(n),t.prev=2,i.s();case 4:if((s=i.n()).done){t.next=12;break}return o=s.value,t.next=8,this.get(o);case 8:(null==(u=t.sent)?void 0:u._updateUnreadMemberState(this._sdkState.userId,e))&&(u._updateUnreadCount(0,0),a.push(u));case 10:t.next=4;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),i.e(t.t0);case 17:return t.prev=17,i.f(),t.finish(17);case 20:if(!(a.length>0)){t.next=23;break}return t.next=23,this.upsert(a);case 23:case"end":return t.stop()}}),r,this,[[2,14,17,20]])})))}}]),o}(Ya);!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",e[e.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"}(bh||(bh={}));var xh,Th=function(){function t(e){var n;r(this,t),this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=null!==(n=e.data)&&void 0!==n?n:{},this.ts=e.ts}return i(t,[{key:"isGroupChannelEvent",get:function(){return this.channelType===e.ChannelType.GROUP}},{key:"isOpenChannelEvent",get:function(){return this.channelType===e.ChannelType.OPEN}}]),t}(),Sh={invitedUserIds:void 0,channelUrl:void 0,coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isSuper:void 0,isBroadcast:void 0,isExclusive:void 0,isPublic:void 0,isDiscoverable:void 0,isStrict:void 0,isEphemeral:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Ih=function(e){return F("string",e.invitedUserIds,!0)&&L("string",e.channelUrl,!0)&&L("string",e.coverUrl,!0)&&(q(e.coverImage)||L("string",e.coverImage,!0))&&L("boolean",e.isDistinct,!0)&&L("boolean",e.isSuper,!0)&&L("boolean",e.isBroadcast,!0)&&L("boolean",e.isExclusive,!0)&&L("boolean",e.isPublic,!0)&&L("boolean",e.isStrict,!0)&&L("boolean",e.isDiscoverable,!0)&&L("boolean",e.isEphemeral,!0)&&L("string",e.accessCode,!0)&&L("string",e.name,!0)&&L("string",e.data,!0)&&L("string",e.customType,!0)&&F("string",e.operatorUserIds,!0)&&L("number",e.messageSurvivalSeconds,!0)},Nh={customTypes:void 0,includeEmpty:!1,includeFrozen:!0,includeChatNotification:!1},Ah=function(e){return F("string",e.customTypes,!0)&&L("boolean",e.includeEmpty)&&L("boolean",e.includeFrozen)&&L("boolean",e.includeChatNotification)},Mh={myMemberStateFilter:e.MyMemberStateFilter.ALL},Oh=function(t){return R(e.MyMemberStateFilter,t.myMemberStateFilter)};e.UnreadItemKey=void 0,(xh=e.UnreadItemKey||(e.UnreadItemKey={})).GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",xh.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",xh.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",xh.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",xh.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",xh.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",xh.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",xh.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",xh.SUPER_INVITATION_COUNT="super_group_channel_invitation_count";var Uh,Dh={keys:[]},Lh=function(t){return F(e.UnreadItemKey,t.keys)},Rh={channelCustomTypesFilter:void 0,superChannelFilter:e.SuperChannelFilter.ALL},Ph=function(t){return F("string",t.channelCustomTypesFilter,!0)&&R(e.SuperChannelFilter,t.superChannelFilter)},Fh={channelUrl:void 0,scheduledStatus:void 0,messageTypeFilter:e.MessageTypeFilter.ALL},Hh=function(t){return L("string",t.channelUrl,!0)&&F(e.ScheduledStatus,t.scheduledStatus,!0)&&R(e.MessageTypeFilter,t.messageTypeFilter)},qh=Object.assign({},e.CollectionEventSource),Gh=function(t){return t.startsWith("EVENT_")||t===e.CollectionEventSource.SYNC_CHANNEL_CHANGELOGS||t===e.CollectionEventSource.REFRESH_CHANNEL},jh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channels,s=e.source,o=e.isWebSocketEventComing,u=void 0!==o&&o,c=e.data,l=void 0===c?null:c,d=e.ts;return r(this,n),(a=t.call(this)).channels=i,a.source=s,a.isWebSocketEventComing=u,a.data=l,a.ts=d,a}return i(n)}(ue),zh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrls,s=e.source,o=e.isWebSocketEventComing,u=void 0!==o&&o;return r(this,n),(a=t.call(this)).channelUrls=i,a.source=s,a.isWebSocketEventComing=u,a}return i(n)}(ue),Vh=function(){function e(n){var a=this,i=n.groupChannelCache,s=n.messageCache,o=n.unsentMessageCache,u=n.dispatcher;r(this,e),this._observers=new Map,u.on((function(e){return E(a,void 0,void 0,t().mark((function n(){var r,a,u,c,l,d,h,f,p,v,_,m,g,k=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e instanceof jh)){n.next=27;break}r=e.channels,a=e.source,u=e.isWebSocketEventComing,c=e.data,l=r.filter((function(e){return e instanceof sv})),d=i.filterOffsetChanged(l),h=y(d),n.prev=5,h.s();case 7:if((f=h.n()).done){n.next=13;break}return p=f.value,n.next=11,s.removeUnderOffset(p.url,p.messageOffsetTimestamp);case 11:n.next=7;break;case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(5),h.e(n.t0);case 18:return n.prev=18,h.f(),n.finish(18);case 21:return n.next=23,i.upsert(l,e.ts);case 23:v=n.sent,u||this._broadcastUpdateEvent(v,a,c),n.next=39;break;case 27:if(!(e instanceof zh)){n.next=36;break}return _=e.channelUrls,m=e.source,g=e.isWebSocketEventComing,n.next=31,i.remove(_);case 31:return n.next=33,Ma((function(){return E(k,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(_),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=11;break}return a=r.value,e.next=7,s.removeMessagesOfChannel(a);case 7:return e.next=9,o.removeMessagesOfChannel(a);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))}));case 33:g||this._broadcastRemoveEvent(_,m),n.next=39;break;case 36:if(!(e instanceof dd)){n.next=39;break}return n.next=39,i.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER});case 39:case"end":return n.stop()}}),n,this,[[5,15,18,21]])})))}))}return i(e,[{key:"_broadcastUpdateEvent",value:function(e,t,n){var r,a=y(this._observers.values());try{for(a.s();!(r=a.n()).done;){var i=r.value;i.onUpdate&&i.onUpdate(e,t,n)}}catch(e){a.e(e)}finally{a.f()}}},{key:"_broadcastRemoveEvent",value:function(e,t){var n,r=y(this._observers.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.onRemove&&a.onRemove(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"subscribe",value:function(e,t){this._observers.set(e,t)}},{key:"unsubscribe",value:function(e){this._observers.delete(e)}},{key:"unsubscribeAll",value:function(){this._observers.clear()}}]),e}(),Bh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.ts,o=e.token,u=e.filter,c=e.includeChatNotification,l=void 0!==c&&c;r(this,n),a=t.call(this);var d=Object.assign(Object.assign({},Nh),u),h=d.customTypes,f=d.includeEmpty,p=d.includeFrozen;return a.method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/my_group_channels/changelogs"),a.params=ce(le({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:s||null,token:o,custom_types:h,show_empty:f,show_frozen:p,include_chat_notification:l})),a}return i(n)}(Ue),Qh=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).updatedChannels=a.updated.map((function(t){return new sv(e,Object.assign(t,{ts:a.ts}))})),i.deletedChannelUrls=a.deleted,i.hasMore=a.has_more,i.token=a.next,i.ts=a.ts,i}return i(n)}(De),Kh=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.isInternalCall;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(s?_e:ve,"/").concat(encodeURIComponent(i)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return i(n)}(Ue),Wh=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).channel=new sv(e,a),i}return i(n)}(De),Yh={includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1,channelUrlsFilter:void 0,customTypesFilter:void 0,customTypeStartsWithFilter:void 0,nicknameContainsFilter:void 0,nicknameStartsWithFilter:void 0,nicknameExactMatchFilter:void 0,channelNameContainsFilter:void 0,myMemberStateFilter:e.MyMemberStateFilter.ALL,unreadChannelFilter:e.UnreadChannelFilter.ALL,superChannelFilter:e.SuperChannelFilter.ALL,publicChannelFilter:e.PublicChannelFilter.ALL,hiddenChannelFilter:e.HiddenChannelFilter.ALL,userIdsFilter:{userIds:[],includeMode:!0,queryType:e.QueryType.AND},searchFilter:{query:void 0,fields:[]},metadataKey:void 0,metadataValues:void 0,metadataOrderKeyFilter:void 0,metadataValueStartsWith:void 0,order:e.GroupChannelListOrder.LATEST_LAST_MESSAGE},Zh=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.userId,s=e.token,o=e.limit,u=e.order,c=e.includeEmpty,l=e.myMemberStateFilter,d=e.superChannelFilter,h=e.publicChannelFilter,f=e.unreadChannelFilter,p=e.nicknameContainsFilter,v=e.nicknameStartsWithFilter,_=e.nicknameExactMatchFilter,m=e.channelNameContainsFilter,g=e.channelUrlsFilter,y=e.customTypesFilter,k=e.customTypeStartsWithFilter,E=e.hiddenChannelFilter,b=e.metadataOrderKeyFilter,w=e.metadataKey,C=e.metadataValues,x=e.metadataValueStartsWith,T=e.includeFrozen,S=e.includeMetaData,I=e.searchFilter,N=e.userIdsFilter,A=e.includeChatNotification,M=void 0!==A&&A;return(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/my_group_channels"),a.params=ce({token:s,limit:o,order:null!=u?u:Yh.order,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:null!=c?c:Yh.includeEmpty,member_state_filter:null!=l?l:Yh.myMemberStateFilter,super_mode:null!=d?d:Yh.superChannelFilter,public_mode:null!=h?h:Yh.publicChannelFilter,unread_filter:null!=f?f:Yh.unreadChannelFilter,members_nickname_contains:p,members_nickname_startswith:v,members_nickname:_,name_contains:m,channel_urls:g,custom_types:y,custom_type_startswith:k,hidden_mode:E,metadata_order_key:b,metadata_key:w,metadata_values:C,metadata_value_startswith:x,show_frozen:T,show_metadata:S,include_chat_notification:M}),I&&I.query&&I.fields&&(a.params.search_query=I.query,a.params.search_fields=I.fields),N&&N.userIds&&N.userIds.length>0&&(N.includeMode?(a.params.members_include_in=N.userIds,a.params.query_type=N.queryType.toUpperCase()):a.params.members_exactly_in=N.userIds),a}return i(n)}(Ue),Jh=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).channels=[];var s=a.next,o=a.channels,u=a.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map((function(t){return t.ts=u,new sv(e,t)}))),i.ts=null!=u?u:0,i}return i(n)}(De),Xh=function(t){s(a,t);var n=f(a);function a(t){var i,s=t.userId,o=t.filter;r(this,a),i=n.call(this);var u=o.myMemberStateFilter;return i.method=de.GET,i.path="".concat(fe,"/").concat(encodeURIComponent(s),"/group_channel_count"),i.params={state:null!=u?u:e.MyMemberStateFilter.ALL},i}return i(a)}(Ue),$h=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).groupChannelCount=a.group_channel_count,i}return i(n)}(De),ef=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.filter;r(this,n),a=t.call(this);var o=s.keys;return a.method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/unread_item_count"),a.params=ce({item_keys:o}),a}return i(n)}(Ue),tf=function(t){s(a,t);var n=f(a);function a(t,i){var s;return r(this,a),s=n.call(this,t,i),"number"==typeof i[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(s.groupChannelUnreadMentionCount=i[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof i[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(s.groupChannelUnreadMessageCount=i[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof i[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]&&(s.groupChannelInvitationCount=i[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof i[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]&&(s.superGroupChannelUnreadMentionCount=i[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof i[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]&&(s.superGroupChannelUnreadMessageCount=i[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof i[e.UnreadItemKey.SUPER_INVITATION_COUNT]&&(s.superGroupChannelInvitationCount=i[e.UnreadItemKey.SUPER_INVITATION_COUNT]),"number"==typeof i[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]&&(s.nonSuperGroupChannelUnreadMentionCount=i[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof i[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]&&(s.nonSuperGroupChannelUnreadMessageCount=i[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof i[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]&&(s.nonSuperGroupChannelInvitationCount=i[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]),s}return i(a)}(De),nf=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/unread_channel_count"),a}return i(n)}(Ue),rf=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).unreadCount=a.unread_count,i}return i(n)}(De),af=function(t){s(a,t);var n=f(a);function a(t){var i,s=t.userId,o=t.filter,u=t.includeFeedChannel,c=void 0!==u&&u;r(this,a),i=n.call(this);var l=o.channelCustomTypesFilter,d=o.superChannelFilter;return i.method=de.GET,i.path="".concat(fe,"/").concat(encodeURIComponent(s),"/unread_message_count"),i.params={super_mode:null!=d?d:e.SuperChannelFilter.ALL,custom_types:l,include_feed_channel:c},i}return i(a)}(Ue),sf=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).unreadCount=a.unread_count,i.unreadFeedCount=a.unread_feed_count,i}return i(n)}(De),of=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.scheduledStatus,o=e.messageTypeFilter;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Ce,"/count"),a.params={channel_url:i,status:cf(s)},o&&(a.params.message_type=o),a}return i(n)}(Ue),uf=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).count=a.count,i}return i(n)}(De),cf=function(t){if(!t)return[];var n=[];return t.forEach((function(t){switch(t){case e.ScheduledStatus.PENDING:n.push(Si.PENDING);break;case e.ScheduledStatus.SENT:n.push(Si.IN_QUEUE),n.push(Si.SENT);break;case e.ScheduledStatus.CANCELED:n.push(Si.CANCELED);break;case e.ScheduledStatus.FAILED:n.push(Si.FAILED)}})),n},lf=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.userId,s=e.channelUrl,o=e.coverUrl,u=e.coverImage,c=e.isDistinct,l=e.isSuper,d=e.isBroadcast,h=e.isPublic,f=e.isExclusive,p=e.isDiscoverable,v=e.isStrict,m=e.isEphemeral,g=e.accessCode,y=e.name,k=e.data,E=e.customType,b=e.messageSurvivalSeconds,w=e.invitedUserIds,C=e.operatorUserIds;return(a=t.call(this)).method=de.POST,a.path=ve,a.params=ce({user_ids:[i].concat(_(null!=w?w:[])).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:s,cover_url:o,cover_file:u,is_distinct:c,is_super:l,is_broadcast:d,is_exclusive:f,is_public:h,is_discoverable:p,strict:v,is_ephemeral:m,access_code:g,name:y,data:k,custom_type:E,operator_ids:C,message_survival_seconds:b}),a}return i(n)}(Ue),df=function(e){s(n,e);var t=f(n);function n(e,a){var i,s;return r(this,n),(i=t.call(this,e,a)).channel=new sv(e,a),i.isCreated=null===(s=a.is_created)||void 0===s||s,i}return i(n)}(De),hf=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.channelUrls;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/mark_as_read_all"),a.params={channel_urls:s},a}return i(n)}(Ue),ff=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).event=new Th(i),s}return i(n)}(Qe),pf=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.userId,o=e.accessCode;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/join"),a.params={user_id:s,access_code:o},a}return i(n)}(Ue),vf=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).channel=new sv(e,a),i}return i(n)}(De),_f=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;r(this,n),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=void 0===u?0:u,l=o.joined_member_count,d=void 0===l?0:l,h=o.users,f=void 0===h?null:h;return s.memberCount=c,s.joinedMemberCount=d,s.members=Array.isArray(f)?f.map((function(t){return new kh(e,t)})):[new kh(e,i.data)],s}return i(n)}(ff),mf=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.userId,o=e.shouldRemoveOperatorStatus;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/leave"),a.params={user_id:s,should_remove_operator_status:o},a}return i(n)}(Ue),gf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;r(this,n),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=void 0===u?0:u,l=o.joined_member_count,d=void 0===l?0:l;return s.memberCount=c,s.joinedMemberCount=d,s.member=new kh(s._iid,i.data),s}return i(n)}(ff),yf=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.userIds;return(a=t.call(this)).method=de.POST,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/invite"),a.params={user_ids:s},a}return i(n)}(Ue),kf=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).channel=new sv(e,a),i}return i(n)}(De),Ef=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;r(this,n),(s=t.call(this,e,a,i)).inviter=null;var o=i.data,u=o.member_count,c=void 0===u?0:u,l=o.joined_member_count,d=void 0===l?0:l,h=o.inviter,f=o.invitees,p=void 0===f?[]:f;return s.memberCount=c,s.joinedMemberCount=d,h&&Object.keys(h).length>0&&(s.inviter=new si(e,h)),s.invitees=p.map((function(t){return new kh(e,t)})),s}return i(n)}(ff),bf=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.userId;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/decline"),a.params={user_id:s},a}return i(n)}(Ue),wf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;r(this,n),s=t.call(this,e,a,i);var o=i.data,u=o.member_count,c=o.joined_member_count,l=o.inviter,d=o.invitee;return s.memberCount=null!=u?u:0,s.joinedMemberCount=null!=c?c:0,s.inviter=new si(e,l),s.invitee=new kh(e,d),s}return i(n)}(ff),Cf={hidePreviousMessages:!1,allowAutoUnhide:!0},xf=function(e){return L("boolean",e.hidePreviousMessages,!0)&&L("boolean",e.allowAutoUnhide,!0)},Tf=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.userId,o=e.hidePreviousMessages,u=e.allowAutoUnhide;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/hide"),a.params={user_id:s,hide_previous_messages:null!=o?o:Cf.hidePreviousMessages,allow_auto_unhide:null!=u?u:Cf.allowAutoUnhide},a}return i(n)}(Ue),Sf=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.ts_message_offset;return i.messageOffsetTimestamp=s,i}return i(n)}(De),If=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c;return r(this,n),(s=t.call(this,e,"SYEV",i)).allowAutoUnhide=null,s.hidePreviousMessages=null,s.messageOffsetTimestamp=null,i.data&&(s.allowAutoUnhide=null!==(o=i.data.allow_auto_unhide)&&void 0!==o?o:null,s.hidePreviousMessages=null!==(u=i.data.hide_previous_messages)&&void 0!==u?u:null),s.messageOffsetTimestamp=null!==(c=i.ts_message_offset)&&void 0!==c?c:null,s}return i(n)}(Qe),Nf=function(e){s(n,e);var t=f(n);function n(e){var a=e.channelUrl,i=e.time;return r(this,n),t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:a,time:i}})}return i(n)}(fa),Af=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).user=new si(e,i.data),s}return i(n)}(Qe),Mf=function(e){s(n,e);var t=f(n);function n(e){var a=e.channelUrl,i=e.time;return r(this,n),t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:a,time:i}})}return i(n)}(fa),Of=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"SYEV",i)).user=new si(e,i.data),s}return i(n)}(Qe),Uf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;r(this,n),s=t.call(this,e,a,i);var o=i.data.operators,u=void 0===o?[]:o;return s.operators=u.map((function(e){return new si(s._iid,e)})),s}return i(n)}(ff),Df=function(e){s(n,e);var t=f(n);function n(e){var a=e.channelUrl,i=e.messageId;return r(this,n),t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:a,msg_id:i}})}return i(n)}(fa),Lf=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h,f,p,v,_,m,g,y,k,E,b,w,C,x,T,S,I,N;return r(this,u),(i=a.call(this,t,n)).includeEmpty=!1,i.includeFrozen=!0,i.includeMetaData=!0,i.includeChatNotification=!1,i.channelUrlsFilter=null,i.customTypesFilter=null,i.customTypeStartsWithFilter=null,i.nicknameContainsFilter=null,i.nicknameStartsWithFilter=null,i.nicknameExactMatchFilter=null,i.channelNameContainsFilter="",i.myMemberStateFilter=e.MyMemberStateFilter.ALL,i.unreadChannelFilter=e.UnreadChannelFilter.ALL,i.superChannelFilter=e.SuperChannelFilter.ALL,i.publicChannelFilter=e.PublicChannelFilter.ALL,i.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,i.searchFilter={fields:[],query:null},i.userIdsFilter={userIds:[],includeMode:!0,queryType:e.QueryType.AND},i.metadataKey=null,i.metadataValues=null,i.metadataOrderKeyFilter=null,i.metadataValueStartsWith=null,i.order=e.GroupChannelListOrder.LATEST_LAST_MESSAGE,i.includeEmpty=null!==(s=n.includeEmpty)&&void 0!==s&&s,i.includeFrozen=null===(o=n.includeFrozen)||void 0===o||o,i.includeMetaData=null===(c=n.includeMetaData)||void 0===c||c,i.includeChatNotification=null!==(l=n.includeChatNotification)&&void 0!==l&&l,i.channelUrlsFilter=null!==(d=n.channelUrlsFilter)&&void 0!==d?d:null,i.customTypesFilter=null!==(h=n.customTypesFilter)&&void 0!==h?h:null,i.customTypeStartsWithFilter=null!==(f=n.customTypeStartsWithFilter)&&void 0!==f?f:"",i.nicknameContainsFilter=null!==(p=n.nicknameContainsFilter)&&void 0!==p?p:null,i.nicknameStartsWithFilter=null!==(v=n.nicknameStartsWithFilter)&&void 0!==v?v:null,i.nicknameExactMatchFilter=null!==(_=n.nicknameExactMatchFilter)&&void 0!==_?_:null,i.channelNameContainsFilter=null!==(m=n.channelNameContainsFilter)&&void 0!==m?m:"",i.myMemberStateFilter=null!==(g=n.myMemberStateFilter)&&void 0!==g?g:e.MyMemberStateFilter.ALL,i.unreadChannelFilter=null!==(y=n.unreadChannelFilter)&&void 0!==y?y:e.UnreadChannelFilter.ALL,i.superChannelFilter=null!==(k=n.superChannelFilter)&&void 0!==k?k:e.SuperChannelFilter.ALL,i.publicChannelFilter=null!==(E=n.publicChannelFilter)&&void 0!==E?E:e.PublicChannelFilter.ALL,i.hiddenChannelFilter=null!==(b=n.hiddenChannelFilter)&&void 0!==b?b:e.HiddenChannelFilter.UNHIDDEN,i.searchFilter=null!==(w=n.searchFilter)&&void 0!==w?w:{fields:[],query:null},i.userIdsFilter=null!==(C=n.userIdsFilter)&&void 0!==C?C:{userIds:[],includeMode:!0,queryType:e.QueryType.AND},i.metadataKey=null!==(x=n.metadataKey)&&void 0!==x?x:null,i.metadataValues=null!==(T=n.metadataValues)&&void 0!==T?T:null,i.metadataOrderKeyFilter=null!==(S=n.metadataOrderKeyFilter)&&void 0!==S?S:null,i.metadataValueStartsWith=null!==(I=n.metadataValueStartsWith)&&void 0!==I?I:null,i.order=null!==(N=n.order)&&void 0!==N?N:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,i}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)&&L("boolean",this.includeEmpty)&&L("boolean",this.includeFrozen)&&L("boolean",this.includeMetaData)&&L("string",this.channelNameContainsFilter)&&F("string",this.channelUrlsFilter,!0)&&F("string",this.customTypesFilter,!0)&&L("string",this.customTypeStartsWithFilter)&&L("string",this.nicknameContainsFilter,!0)&&L("string",this.nicknameStartsWithFilter,!0)&&L("string",this.nicknameExactMatchFilter,!0)&&R(e.MyMemberStateFilter,this.myMemberStateFilter)&&R(e.SuperChannelFilter,this.superChannelFilter)&&R(e.PublicChannelFilter,this.publicChannelFilter)&&R(e.UnreadChannelFilter,this.unreadChannelFilter)&&R(e.HiddenChannelFilter,this.hiddenChannelFilter)&&F(e.GroupChannelSearchField,this.searchFilter.fields)&&L("string",this.searchFilter.query,!0)&&F("string",this.userIdsFilter.userIds)&&L("boolean",this.userIdsFilter.includeMode)&&R(e.QueryType,this.userIdsFilter.queryType)&&R(e.GroupChannelListOrder,this.order)&&L("string",this.metadataOrderKeyFilter,!0)&&L("string",this.metadataKey,!0)&&F("string",this.metadataValues,!0)&&L("string",this.metadataValueStartsWith,!0)}},{key:"serialize",value:function(){return ni(this)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Zf.of(this._iid),e.next=7,n.getMyGroupChannels(this._token,le(Object.assign({},this)),this.limit);case 7:return r=e.sent,a=r.channels,i=r.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,e.abrupt("return",a);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(to),Rf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o;return r(this,n),(s=t.call(this,e,"SYEV",i)).pinnedMessageIds=[],s.latestPinnedMessage=null,s.ts=0,i.data&&(s.pinnedMessageIds=null!==(o=i.data.pinned_message_ids)&&void 0!==o?o:[],s.latestPinnedMessage=i.data.latest_pinned_message?$i(e,Object.assign({},i.data.latest_pinned_message)):null),s.ts=i.ts,s}return i(n)}(Qe),Pf=function(){function e(t){var n=t.top,a=void 0===n?Number.MAX_SAFE_INTEGER:n,i=t.bottom,s=void 0===i?0:i;r(this,e),this.top=a,this.bottom=s}return i(e,[{key:"includes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every((function(t){return e.top<=t&&t<=e.bottom}))}},{key:"overlap",value:function(e){return this.includes(e.top)||this.includes(e.bottom)}},{key:"intersect",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.some((function(t){return e.top<=t&&t<=e.bottom}))}},{key:"extends",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.top=Math.min.apply(Math,[this.top].concat(t)),this.bottom=Math.max.apply(Math,[this.bottom].concat(t))}}]),e}(),Ff=function(e){s(a,e);var n=f(a);function a(e,t){var i;return r(this,a),(i=n.call(this,e))._logger=t.logger,i._sdkState=t.sdkState,i._sessionManager=t.sessionManager,i._requestQueue=t.requestQueue,i._dispatcher=t.dispatcher,i._cacheContext=t.cacheContext,i._channelType=t.channelType,i}return i(a,[{key:"_messageCache",get:function(){return Ml.of(this._iid)}},{key:"_unsentMessageCache",get:function(){return Nl.of(this._iid)}},{key:"_messageBroadcast",get:function(){return Ul.of(this._iid)}},{key:"subscribeMessageEvent",value:function(e,t){this._messageBroadcast.subscribe(e,t)}},{key:"unsubscribeMessageEvent",value:function(e){this._messageBroadcast.unsubscribe(e)}},{key:"getMessageFromCache",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.get(e);case 2:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=6;break}t.t0=void 0!==n;case 6:if(!t.t0){t.next=10;break}t.t2=n,t.next=11;break;case 10:t.t2=null;case 11:return t.abrupt("return",t.t2);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"getExactlyMatchingMessagesForTokenFromCache",value:function(e,n,r){return E(this,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.fetch({channelUrl:e,token:n,filter:r,exactMatch:!0});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),a,this)})))}},{key:"getMessagesFromCache",value:function(e,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return E(this,void 0,void 0,t().mark((function o(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.fetch({channelUrl:e,token:n,limit:i,filter:a,backward:"next"===r,inclusive:s});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),o,this)})))}},{key:"getPollMessagesFromCache",value:function(e,n,r,a){return E(this,void 0,void 0,t().mark((function i(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.fetch({channelUrl:e,token:n,limit:a,filter:r,backward:!1,isPollOnly:!0});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),i,this)})))}},{key:"getCachedMessageCountBetween",value:function(e,n,r,a){return E(this,void 0,void 0,t().mark((function i(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.countBetween(e,n,new Pf({top:r,bottom:a}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),i,this)})))}},{key:"getUnsentMessagesFromCache",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._unsentMessageCache.fetch({channelUrl:e,filter:n});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"removeFailedMessageFromCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._unsentMessageCache.remove([e]);case 2:case"end":return t.stop()}}),n,this)})))}}]),a}(Ya),Hf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c,l;r(this,n),(s=t.call(this,e,"ADMM",i)).message=new ji(e,i);var d=Ei.of(e).sdkState;return s.isMentioned=Ne(s.message.mentionType,null!==(c=null!==(o=s.message.mentionedUserIds)&&void 0!==o?o:null===(u=s.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})))&&void 0!==c?c:[],d.userId),s.forceUpdateLastMessage=null!==(l=i.force_update_last_message)&&void 0!==l&&l,s}return i(n)}(Qe),qf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u,c,l,d;r(this,n),(s=t.call(this,e,"AEDI",i)).message=new ji(e,i);var h=Ei.of(e).sdkState;return s.mentionCountChange=Ae({mentionType:null===(o=i.old_values)||void 0===o?void 0:o.mention_type,mentionedUserIds:null!==(c=null===(u=i.old_values)||void 0===u?void 0:u.mentioned_user_ids)&&void 0!==c?c:[]},le({mentionType:s.message.mentionType,mentionedUserIds:null!==(l=s.message.mentionedUserIds)&&void 0!==l?l:null===(d=s.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))}),h.userId),s}return i(n)}(Qe),Gf=function(e){s(n,e);var t=f(n);function n(e){var a=e.channelUrl;return r(this,n),t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:a}})}return i(n)}(fa),jf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"READ",i)).readStatus=new Eh(e,i),s}return i(n)}(Qe),zf=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.userId;return r(this,n),a=t.call(this),(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/messages/mark_as_delivered"),a.params=ce({userId:s}),a}return i(n)}(Ue),Vf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"DLVR",i)).channelUrl=i.channel_url,s.deliveredStateUpdate=i.updated,s}return i(n)}(Qe),Bf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"MRCT",i)).channelUrl=i.channel_url,s.channelType=i.channel_type,s.event=new Ii(i),s}return i(n)}(Qe),Qf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"MTHD",i)).event=new Rl(e,i),s}return i(n)}(Qe),Kf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"MCNT",i)).groupChannelMemberCounts=i.group_channels.map((function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),s.openChannelMemberCounts=i.open_channels.map((function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),s}return i(n)}(Qe),Wf=function(e){s(n,e);var t=f(n);function n(e,a,i){var s;return r(this,n),(s=t.call(this,e,"PEDI",i)).event=new Wl(e,i),s.status=Bi(i.poll.status)||i.poll.status,s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return i(n)}(Qe),Yf={},Zf=function(n){s(o,n);var a=f(o);function o(n,i){var s,u;return r(this,o),(s=a.call(this,n,Object.assign(Object.assign({},i),{channelType:e.ChannelType.GROUP})))._leftChannels=new Map,s._disableMack=!1,s._markAsReadAllLastSentAt=0,s._disableMack=null!==(u=i.disableMack)&&void 0!==u&&u,s._groupChannelHandlers=new Map,s._groupChannelCache=new Ch(s._iid,{sdkState:i.sdkState,cacheContext:i.cacheContext}),s._groupChannelBroadcast=new Vh({dispatcher:i.dispatcher,groupChannelCache:s._groupChannelCache,messageCache:Ml.of(s._iid),unsentMessageCache:Nl.of(s._iid)}),setInterval((function(){var t,n=y(s._groupChannelCache.channels);try{var r=function(){var n=t.value;n.invalidateTypingStatus()&&(s._dispatcher.dispatch(new jh({channels:[n],source:e.CollectionEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),s._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated&&e.onTypingStatusUpdated(n)})))};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}),1e3),s._dispatcher.on((function(e){e instanceof Qe?s._handleEvent(e):e instanceof id?E(h(s),void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.message,t.next=3,this.getChannel(r.channelUrl,!0);case 3:a=t.sent,r instanceof Yi?a._autoResendUserMessage(r):r instanceof es&&a._autoResendFileMessage(r);case 5:case"end":return t.stop()}}),n,this)}))):e instanceof hd&&s.reduceDBSize()})),Yf[n]||(Yf[n]=h(s)),s}return i(o,[{key:"handlers",get:function(){return _(this._groupChannelHandlers.values())}},{key:"buildGroupChannelFromSerializedData",value:function(e){var t=ri(e);return new sv(this._iid,sv.payloadify(t))}},{key:"buildGroupChannelListQueryFromSerializedData",value:function(e){var t=ri(e);return new Lf(this._iid,t)}},{key:"buildMemberFromSerializedData",value:function(e){var t=ri(e);return new kh(this._iid,kh.payloadify(t))}},{key:"getChannelFromCache",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.get(e);case 2:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=6;break}t.t0=void 0!==n;case 6:if(!t.t0){t.next=10;break}t.t2=n,t.next=11;break;case 10:t.t2=null;case 11:return t.abrupt("return",t.t2);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"getChannelsFromCache",value:function(e,n,r,a,i){return E(this,void 0,void 0,t().mark((function s(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.fetch({token:e,filter:n,order:r,limit:a,borderlineChannelUrl:i});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),s,this)})))}},{key:"upsertChannelsToCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.upsert(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"removeChannelsFromCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.remove(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"clearChannelsFromCache",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._groupChannelCache.clear();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"reduceDBSize",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c,l,d,h,f,p,v,_,m,g;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Ml.of(this._iid),r=Ei.of(this._iid),a=r.cacheContext,i=a.localCacheConfig,s=a.nestdb,a.localCacheEnabled&&s&&s.state==_l.OPENED){e.next=5;break}return e.abrupt("return");case 5:return o=1024*i.maxSize*1024,e.next=8,s.estimateUsage();case 8:if(!((u=e.sent)<o)){e.next=11;break}return e.abrupt("return");case 11:c=[],l=this._groupChannelCache.channels,d={},h=0;case 15:if(!(h<l.length)){e.next=25;break}return e.next=18,this.getMessagesFromCache(l[h].url,0,"prev",new bl);case 18:f=e.sent,d[l[h].url]=JSON.stringify(f).length,p=new te({channel:l[h],cachedMessageCount:f.length}),c.push(p);case 22:h++,e.next=15;break;case 25:v=c.sort(i.clearOrderComparator),_=0;case 27:if(!(_<v.length)){e.next=40;break}return e.next=30,n.removeMessagesOfChannel(v[_].channel.url);case 30:return e.next=32,n._getGroupChannelPreferenceSize(v[_].channel.url);case 32:if(m=e.sent,g=d[v[_].channel.url]+m,!((u-=g)<o)){e.next=37;break}return e.abrupt("break",40);case 37:_++,e.next=27;break;case 40:case"end":return e.stop()}}),e,this)})))}},{key:"_handleEvent",value:function(n){var r;return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l,d,h,f,p,v,_,m,g,k,b,w,C,x,T,S,I,N,M,O,U,D,L,R,P,F,H,q,G,j,z,V,B,Q,K,W,Y,Z,J,X,$,ee,te,ne,re,ae,ie,se,oe,ue,ce,le,de,he,fe,pe,ve,_e,me,ge,ye,ke,Ee,be,we,Ce,xe,Te,Se,Ie,Ne,Ae,Me,Oe,Ue,De,Le,Re,Pe,Fe,He,qe,Ge,je,ze,Ve,Be,Qe,Ke,We,Ye,Ze,Je,Xe,$e,et,tt,nt,rt,at,it,st,ot,ut,ct,lt,dt,ht,ft,pt,vt,_t,mt,gt,yt,kt,Et,bt,wt,Ct,xt,Tt,St,It,Nt,At,Mt,Ot,Ut,Dt,Lt,Rt,Pt,Ft,Ht,qt,Gt,jt,zt,Vt,Bt,Qt,Kt,Wt,Yt,Zt,Jt,Xt,$t,en,tn,nn,rn,an,sn,on,un,cn,ln,dn,hn=this;return t().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,a.t0=n.code,a.next="MESG"===a.t0||"FILE"===a.t0||"ADMM"===a.t0||"BRDM"===a.t0?4:"MEDI"===a.t0||"FEDI"===a.t0||"AEDI"===a.t0?45:"DELM"===a.t0?64:"READ"===a.t0?72:"DLVR"===a.t0?81:"MRCT"===a.t0?89:"MTHD"===a.t0?100:"MCNT"===a.t0?111:"PEDI"===a.t0?135:"VOTE"===a.t0?143:"SYEV"===a.t0?151:"USEV"===a.t0?331:342;break;case 4:if(i=null,"MESG"===n.code?i=n.as($o):"FILE"===n.code?i=n.as(rs):"ADMM"!==n.code&&"BRDM"!=n.code||(i=n.as(Hf)),!i){a.next=44;break}if(o=(s=i).message,u=s.isMentioned,c=s.forceUpdateLastMessage,o.channelType!==e.ChannelType.GROUP){a.next=44;break}return this._disableMack||Ma((function(){return E(hn,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Df(o),this._requestQueue.send(n);case 2:case"end":return e.stop()}}),e,this)})))})),l=this._groupChannelCache.isCachedInMemory(o.channelUrl),d=o instanceof Fi&&o.sender.userId===this._sdkState.userId,a.next=14,this.getChannel(o.channelUrl,!0);case 14:if((h=a.sent).hiddenState===e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE&&(h.hiddenState=e.HiddenState.UNHIDDEN),!(o instanceof Fi)){a.next=38;break}f=Ei.of(this._iid),p=f.useMemberInfoInMessage,v=y(h.members),a.prev=19,v.s();case 21:if((_=v.n()).done){a.next=28;break}if((m=_.value).userId!==o.sender.userId){a.next=26;break}return p||(o.sender.nickname=m.nickname,o.sender.plainProfileUrl=m.plainProfileUrl,o.sender.metaData=m.metaData,o.sender.isBlockedByMe=m.isBlockedByMe),a.abrupt("break",28);case 26:a.next=21;break;case 28:a.next=33;break;case 30:a.prev=30,a.t1=a.catch(19),v.e(a.t1);case 33:return a.prev=33,v.f(),a.finish(33);case 36:!p&&u&&(null===(r=o.mentionedUsers)||void 0===r||r.forEach((function(e){var t,n=y(h.members);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.userId===r.userId){e.nickname=r.nickname,e.plainProfileUrl=r.plainProfileUrl,e.metaData=r.metaData;break}}}catch(e){n.e(e)}finally{n.f()}}))),d&&(g=this._sessionManager.currentUser)&&(g.nickname=o.sender.nickname,g.plainProfileUrl=o.sender.plainProfileUrl,g.metaData=o.sender.metaData);case 38:o.silent&&!d||(h.isEphemeral||l)&&((!h.lastMessage||h.lastMessage.createdAt<o.createdAt)&&(h.lastMessage=o),d||h._updateUnreadCount(h.unreadMessageCount+1,h.unreadMentionCount+(u?1:0))),c&&(!h.lastMessage||h.lastMessage.createdAt<o.createdAt)&&(h.lastMessage=o),this._dispatcher.dispatch(new jh({channels:[h],source:e.CollectionEventSource.EVENT_MESSAGE_RECEIVED})),o.silent&&!d||Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelChanged&&a.onChannelChanged(h)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),this._dispatcher.dispatch(new ms({messages:[o],source:e.CollectionEventSource.EVENT_MESSAGE_RECEIVED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onMessageReceived&&a.onMessageReceived(h,o),u&&a.onMentionReceived&&a.onMentionReceived(h,o)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 44:return a.abrupt("break",342);case 45:if(k=null,"MEDI"===n.code?k=n.as(tu):"FEDI"===n.code?k=n.as(ru):"AEDI"===n.code&&(k=n.as(qf)),!k){a.next=63;break}if(w=(b=k).message,C=b.mentionCountChange,w.channelType!==e.ChannelType.GROUP){a.next=63;break}return x=this._groupChannelCache.isCachedInMemory(w.channelUrl),a.next=53,this.getChannel(w.channelUrl,!0);case 53:T=a.sent,S=w instanceof Fi&&w.sender.userId===this._sdkState.userId,I=!1,S?(N=w.sender,(M=this._sessionManager.currentUser)&&(M.nickname=N.nickname,M.plainProfileUrl=N.plainProfileUrl,M.metaData=N.metaData)):T.isReadMessage(w)||0!==C&&!w.silent&&x&&(T._updateUnreadCount(T.unreadMessageCount,T.unreadMentionCount+C),I=!0),!T.lastMessage||T.lastMessage.createdAt<w.createdAt?(T.lastMessage=w,I=!0):T.lastMessage.isIdentical(w)&&(x?T.lastMessage.updatedAt<w.updatedAt&&(T.lastMessage=w,I=!0):I=!0),O=!1,T.lastPinnedMessage&&T.lastPinnedMessage.messageId===w.messageId&&(T.lastPinnedMessage=w,I=!0,O=!0),I&&(this._dispatcher.dispatch(new jh({channels:[T],source:O?e.CollectionEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.CollectionEventSource.EVENT_MESSAGE_UPDATED})),w.silent&&!S||Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelChanged&&a.onChannelChanged(T)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),O&&Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPinnedMessageUpdated&&a.onPinnedMessageUpdated(T)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),this._dispatcher.dispatch(new ms({messages:[w],source:e.CollectionEventSource.EVENT_MESSAGE_UPDATED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onMessageUpdated&&a.onMessageUpdated(T,w),0!==C&&a.onMentionReceived&&a.onMentionReceived(T,w)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 63:return a.abrupt("break",342);case 64:if(U=n.as(iu),D=U.channelUrl,L=U.channelType,R=U.messageId,L!==e.ChannelType.GROUP){a.next=71;break}return a.next=68,this.getChannel(D,!0);case 68:P=a.sent,this._dispatcher.dispatch(new gs({messageIds:[R],source:e.CollectionEventSource.EVENT_MESSAGE_DELETED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onMessageDeleted&&a.onMessageDeleted(P,R)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 71:return a.abrupt("break",342);case 72:if(F=n.as(jf),(H=F.readStatus).channelType!==e.ChannelType.GROUP){a.next=80;break}return q=this._groupChannelCache.isCachedInMemory(H.channelUrl),a.next=77,this.getChannel(H.channelUrl,!0);case 77:G=a.sent,q&&G._updateUnreadMemberState(H.reader.userId,H.readAt),H.reader.userId===this._sdkState.userId?q?(G.unreadMessageCount>0||G.unreadMentionCount>0)&&(G._updateUnreadCount(0,0),this._dispatcher.dispatch(new jh({channels:[G],source:e.CollectionEventSource.EVENT_CHANNEL_READ})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelChanged&&a.onChannelChanged(G)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))):0!==G.unreadMessageCount&&0!==G.unreadMentionCount||(this._dispatcher.dispatch(new jh({channels:[G],source:e.CollectionEventSource.EVENT_CHANNEL_READ})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelChanged&&a.onChannelChanged(G)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))):(this._dispatcher.dispatch(new jh({channels:[G],source:e.CollectionEventSource.EVENT_CHANNEL_READ})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onUnreadMemberStatusUpdated&&a.onUnreadMemberStatusUpdated(G)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})));case 80:return a.abrupt("break",342);case 81:return j=n.as(Vf),z=j.channelUrl,V=j.deliveredStateUpdate,B=void 0===V?{}:V,Q=this._groupChannelCache.isCachedInMemory(z),a.next=85,this.getChannel(z,!0);case 85:if(K=a.sent,Q)for(W in B)K._updateUndeliveredMemberState(W,B[W]);return Object.keys(B).some((function(e){return e!==hn._sdkState.userId}))&&(this._dispatcher.dispatch(new jh({channels:[K],source:e.CollectionEventSource.EVENT_CHANNEL_DELIVERED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onUndeliveredMemberStatusUpdated&&a.onUndeliveredMemberStatusUpdated(K)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),a.abrupt("break",342);case 89:if(Y=n.as(Bf),Z=Y.channelUrl,J=Y.channelType,X=Y.event,J!==e.ChannelType.GROUP){a.next=99;break}return a.next=93,this.getChannel(Z,!0);case 93:return $=a.sent,a.next=96,this.getMessageFromCache(X.messageId);case 96:(ee=a.sent)&&(ee.applyReactionEvent(X),this._dispatcher.dispatch(new ms({messages:[ee],source:e.CollectionEventSource.EVENT_MESSAGE_REACTION_UPDATED}))),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onReactionUpdated&&a.onReactionUpdated($,X)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 99:return a.abrupt("break",342);case 100:if(te=n.as(Qf),(ne=te.event).channelType!==e.ChannelType.GROUP){a.next=110;break}return a.next=104,this.getChannel(ne.channelUrl,!0);case 104:return re=a.sent,a.next=107,this.getMessageFromCache(ne.targetMessageId);case 107:(ae=a.sent)&&(ae.applyThreadInfoUpdateEvent(ne),this._dispatcher.dispatch(new ms({messages:[ae],source:e.CollectionEventSource.EVENT_MESSAGE_THREADINFO_UPDATED}))),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onThreadInfoUpdated&&a.onThreadInfoUpdated(re,ne)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 110:return a.abrupt("break",342);case 111:ie=n.as(Kf),se=ie.groupChannelMemberCounts,oe=[],ue=y(se),a.prev=114,ue.s();case 116:if((ce=ue.n()).done){a.next=125;break}return le=ce.value,de=le.channelUrl,he=le.memberCount,fe=le.joinedMemberCount,pe=le.updatedAt,a.next=121,this.getChannelFromCache(de);case 121:(ve=a.sent)&&ve._setLatestMemberCount(he,fe,pe)&&oe.push(ve);case 123:a.next=116;break;case 125:a.next=130;break;case 127:a.prev=127,a.t2=a.catch(114),ue.e(a.t2);case 130:return a.prev=130,ue.f(),a.finish(130);case 133:return oe.length>0&&(this._dispatcher.dispatch(new jh({channels:oe,source:e.CollectionEventSource.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelMemberCountChanged&&a.onChannelMemberCountChanged(oe)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),a.abrupt("break",342);case 135:if(_e=n.as(Wf),me=_e.event,ge=_e.status,ye=_e.channelUrl,ke=_e.channelType,!ye||ke!==e.ChannelType.GROUP){a.next=142;break}return a.next=139,this.getChannel(ye,!0);case 139:Ee=a.sent,this._dispatcher.dispatch(new Es({event:me,source:e.CollectionEventSource.EVENT_POLL_UPDATED})),Aa(ge===Vi?function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPollDeleted&&a.onPollDeleted(Ee,me.pollId)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}:function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPollUpdated&&a.onPollUpdated(Ee,me)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))});case 142:return a.abrupt("break",342);case 143:if(be=n.as(Nu),we=be.event,Ce=be.channelUrl,xe=be.channelType,!Ce||xe!==e.ChannelType.GROUP){a.next=150;break}return a.next=147,this.getChannel(Ce,!0);case 147:Te=a.sent,this._dispatcher.dispatch(new bs({event:we,source:e.CollectionEventSource.EVENT_POLL_VOTED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPollVoted&&a.onPollVoted(Te,we)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 150:return a.abrupt("break",342);case 151:if(Se=n.as(ff),!(Ie=Se.event).isGroupChannelEvent){a.next=330;break}a.t3=Ie.category,a.next=a.t3===bh.CHANNEL_JOIN?156:a.t3===bh.CHANNEL_LEAVE?165:a.t3===bh.CHANNEL_OPERATOR_UPDATE?181:a.t3===bh.CHANNEL_INVITE?192:a.t3===bh.CHANNEL_DECLINE_INVITE?202:a.t3===bh.TYPING_START||a.t3===bh.TYPING_END?210:a.t3===bh.USER_CHANNEL_MUTE||a.t3===bh.USER_CHANNEL_UNMUTE?219:a.t3===bh.USER_CHANNEL_BAN?246:a.t3===bh.USER_CHANNEL_UNBAN?261:a.t3===bh.CHANNEL_FREEZE||a.t3===bh.CHANNEL_UNFREEZE?269:a.t3===bh.CHANNEL_HIDE?277:a.t3===bh.CHANNEL_UNHIDE?287:a.t3===bh.CHANNEL_DELETED?294:a.t3===bh.CHANNEL_PROP_CHANGED?300:a.t3===bh.CHANNEL_META_DATA_CHANGED?306:a.t3===bh.CHANNEL_META_COUNTERS_CHANGED?315:a.t3===bh.PINNED_MESSAGE_CHANGED?324:330;break;case 156:return a.next=158,this.getChannel(Ie.channelUrl,!0);case 158:return Ne=a.sent,Ae=n.as(_f),Me=Ae.memberCount,Oe=Ae.joinedMemberCount,Ue=Ae.members,De=!1,Ue.forEach((function(t){Ne.isExclusive||Ne.isSuper||Ne.isBroadcast?De=De||Ne._setLatestMemberCount(Me,Oe,Ie.ts):(t.state=e.MemberState.JOINED,Ne.addMember(t,Ie.ts),hn._updateJoinedMemberCount(Ne)),t.userId===hn._sdkState.userId&&(Ne.myMemberState=e.MemberState.JOINED)})),this._dispatcher.dispatch(new jh({channels:[Ne],source:e.CollectionEventSource.EVENT_CHANNEL_JOINED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){var t,n=y(Ue);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.onUserJoined&&e.onUserJoined(Ne,r)}}catch(e){n.e(e)}finally{n.f()}Ne.isBroadcast&&De&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([Ne])}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 165:if(!(Le=this._leftChannels.get(Ie.channelUrl))){a.next=170;break}a.t4=Le.channel,a.next=173;break;case 170:return a.next=172,this.getChannel(Ie.channelUrl,!0);case 172:a.t4=a.sent;case 173:return Re=a.t4,Pe=n.as(gf),Fe=Pe.memberCount,He=Pe.joinedMemberCount,qe=Pe.member,Ge=!1,je=Ei.of(this._iid),ze=je.appInfo,Re.isExclusive||Re.isSuper||Re.isBroadcast?Ge=Re._setLatestMemberCount(Fe,He,Ie.ts):((null==ze?void 0:ze.enabledChannelMemberShipHistory)?((Ve=Re.members.find((function(e){return e.userId===Ve.userId})))&&(Ve.state=e.MemberState.LEFT),Re.memberCount=Fe):Re.removeMember(qe),this._updateJoinedMemberCount(Re)),qe.userId===this._sdkState.userId?(Re.myMemberState=e.MemberState.NONE,Re.invitedAt=0,Re.joinedAt=0,Re._updateUnreadCount(0,0),Re.isPublic?this._dispatcher.dispatch(new jh({channels:[Re],source:e.CollectionEventSource.EVENT_CHANNEL_LEFT})):(this._markAsLeave(Re),this._dispatcher.dispatch(new zh({channelUrls:[Re.url],source:e.CollectionEventSource.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new jh({channels:[Re],source:e.CollectionEventSource.EVENT_CHANNEL_LEFT})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserLeft&&e.onUserLeft(Re,qe),Re.isBroadcast&&Ge&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([Re])}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 181:return a.next=183,this.getChannel(Ie.channelUrl,!0);case 183:Be=a.sent,Qe=n.as(Uf),Ke=Qe.operators,We=Ke.map((function(e){return e.userId})),Ye=y(Be.members);try{for(Ye.s();!(Ze=Ye.n()).done;)(Je=Ze.value).role=We.includes(Je.userId)?e.Role.OPERATOR:e.Role.NONE}catch(e){Ye.e(e)}finally{Ye.f()}return Be.myRole=We.includes(this._sdkState.userId)?e.Role.OPERATOR:e.Role.NONE,this._dispatcher.dispatch(new jh({channels:[Be],source:e.CollectionEventSource.EVENT_CHANNEL_OPERATOR_UPDATED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(Be,Ke)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 192:return a.next=194,this.getChannel(Ie.channelUrl,!0);case 194:Xe=a.sent,$e=n.as(Ef),et=$e.memberCount,tt=$e.joinedMemberCount,nt=$e.inviter,(rt=$e.invitees).forEach((function(t){return t.state=e.MemberState.INVITED})),at=y(rt);try{for(at.s();!(it=at.n()).done;)st=it.value,Xe.isExclusive||Xe.isSuper||Xe.isBroadcast?Xe._setLatestMemberCount(et,tt,Ie.ts):Xe.addMember(st,Ie.ts),this._sdkState.userId===st.userId&&(Xe.hiddenState=e.HiddenState.UNHIDDEN,Xe.myMemberState!==e.MemberState.JOINED&&(Xe.myMemberState=e.MemberState.INVITED),Xe.invitedAt=Ie.ts)}catch(e){at.e(e)}finally{at.f()}return this._dispatcher.dispatch(new jh({channels:[Xe],source:e.CollectionEventSource.EVENT_CHANNEL_INVITED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation&&e.onUserReceivedInvitation(Xe,nt,rt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 202:return a.next=204,this.getChannel(Ie.channelUrl,!0);case 204:return ot=a.sent,ut=n.as(wf),ct=ut.memberCount,lt=ut.joinedMemberCount,dt=ut.inviter,ht=ut.invitee,ot.isExclusive||ot.isSuper||ot.isBroadcast?ot._setLatestMemberCount(ct,lt,Ie.ts):ot.removeMember(ht),this._sdkState.userId===ht.userId?(ot.invitedAt=0,ot.myMemberState=e.MemberState.NONE,ot.isPublic?this._dispatcher.dispatch(new jh({channels:[ot],source:e.CollectionEventSource.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new zh({channelUrls:[ot.url],source:e.CollectionEventSource.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new jh({channels:[ot],source:e.CollectionEventSource.EVENT_CHANNEL_DECLINED_INVITE})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation&&e.onUserDeclinedInvitation(ot,dt,ht)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 210:return a.next=212,this.getChannel(Ie.channelUrl,!0);case 212:return ft=a.sent,pt=Ie.category===bh.TYPING_START,vt=n.as(pt?Af:Of),_t=vt.user,ft._updateTypingStatus(_t,pt?Ie.ts:0),this._dispatcher.dispatch(new jh({channels:[ft],source:e.CollectionEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated&&e.onTypingStatusUpdated(ft)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 219:return a.next=221,this.getChannel(Ie.channelUrl,!0);case 221:mt=a.sent,gt=Ie.category===bh.USER_CHANNEL_MUTE,yt=n.as(gt?qo:jo),(kt=yt.user).userId===this._sdkState.userId&&(mt.myMutedState=gt?e.MutedState.MUTED:e.MutedState.UNMUTED,mt._myMutedRemainingTime=kt.restrictionInfo.remainingDuration),Et=y(mt.members),a.prev=226,Et.s();case 228:if((bt=Et.n()).done){a.next=235;break}if((wt=bt.value).userId!==kt.userId){a.next=233;break}return wt.isMuted=gt,a.abrupt("break",235);case 233:a.next=228;break;case 235:a.next=240;break;case 237:a.prev=237,a.t5=a.catch(226),Et.e(a.t5);case 240:return a.prev=240,Et.f(),a.finish(240);case 243:return this._dispatcher.dispatch(new jh({channels:[mt],source:gt?e.CollectionEventSource.EVENT_CHANNEL_MUTED:e.CollectionEventSource.EVENT_CHANNEL_UNMUTED,data:kt.userId})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){gt?e.onUserMuted&&e.onUserMuted(mt,kt):e.onUserUnmuted&&e.onUserUnmuted(mt,kt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 246:if(!(Ct=this._leftChannels.get(Ie.channelUrl))){a.next=251;break}a.t6=Ct.channel,a.next=254;break;case 251:return a.next=253,this.getChannel(Ie.channelUrl,!0);case 253:a.t6=a.sent;case 254:return xt=a.t6,this._markAsLeave(xt),Tt=n.as(Vo),St=Tt.user,St.userId===this._sdkState.userId&&this._dispatcher.dispatch(new zh({channelUrls:[xt.url],source:e.CollectionEventSource.EVENT_CHANNEL_BANNED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserBanned&&e.onUserBanned(xt,St)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 261:return a.next=263,this.getChannel(Ie.channelUrl,!0);case 263:return It=a.sent,Nt=n.as(Qo),At=Nt.user,At.userId===this._sdkState.userId&&this._dispatcher.dispatch(new zh({channelUrls:[It.url],source:e.CollectionEventSource.EVENT_CHANNEL_UNBANNED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned&&e.onUserUnbanned(It,At)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 269:return a.next=271,this.getChannel(Ie.channelUrl,!0);case 271:return Mt=a.sent,Ot=n.as(Wo),Ut=Ot.freeze,Mt.isFrozen=Ut,this._dispatcher.dispatch(new jh({channels:[Mt],source:Ut?e.CollectionEventSource.EVENT_CHANNEL_FROZEN:e.CollectionEventSource.EVENT_CHANNEL_UNFROZEN})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Ut?e.onChannelFrozen&&e.onChannelFrozen(Mt):e.onChannelUnfrozen&&e.onChannelUnfrozen(Mt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 277:return a.next=279,this.getChannel(Ie.channelUrl,!0);case 279:return Dt=a.sent,Lt=n.as(If),Rt=Lt.allowAutoUnhide,Pt=Lt.hidePreviousMessages,Ft=Lt.messageOffsetTimestamp,null!==Rt&&(Dt.hiddenState=Rt?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),null!==Pt&&Pt&&Dt._updateUnreadCount(0,0),null!==Ft&&(Dt.messageOffsetTimestamp=Ft),this._dispatcher.dispatch(new jh({channels:[Dt],source:e.CollectionEventSource.EVENT_CHANNEL_HIDDEN})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelHidden&&e.onChannelHidden(Dt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 287:return a.next=289,this.getChannel(Ie.channelUrl,!0);case 289:return(Ht=a.sent).hiddenState=e.HiddenState.UNHIDDEN,this._dispatcher.dispatch(new jh({channels:[Ht],source:e.CollectionEventSource.EVENT_CHANNEL_UNHIDDEN})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Ht)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 294:return a.next=296,this.getChannel(Ie.channelUrl,!0);case 296:return qt=a.sent,this._dispatcher.dispatch(new zh({channelUrls:[Ie.channelUrl],source:e.CollectionEventSource.EVENT_CHANNEL_DELETED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(qt.url,qt.channelType)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 300:return a.next=302,this.getChannelWithoutCache(Ie.channelUrl,!0);case 302:return Gt=a.sent,this._dispatcher.dispatch(new jh({channels:[Gt],source:e.CollectionEventSource.EVENT_CHANNEL_UPDATED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Gt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 306:return a.next=308,this.getChannel(Ie.channelUrl,!0);case 308:return jt=a.sent,zt=n.as(xo),Vt=zt.created,Bt=zt.updated,Qt=zt.deleted,Vt&&(jt._upsertCachedMetaData(Vt,Ie.ts),this._dispatcher.dispatch(new jh({channels:[jt],source:e.CollectionEventSource.EVENT_CHANNEL_METADATA_CREATED}))),Bt&&(jt._upsertCachedMetaData(Bt,Ie.ts),this._dispatcher.dispatch(new jh({channels:[jt],source:e.CollectionEventSource.EVENT_CHANNEL_METADATA_UPDATED}))),Qt&&(jt._removeFromCachedMetaData(Qt,Ie.ts),this._dispatcher.dispatch(new jh({channels:[jt],source:e.CollectionEventSource.EVENT_CHANNEL_METADATA_DELETED}))),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Vt&&e.onMetaDataCreated&&e.onMetaDataCreated(jt,Vt),Bt&&e.onMetaDataUpdated&&e.onMetaDataUpdated(jt,Bt),Qt&&e.onMetaDataDeleted&&e.onMetaDataDeleted(jt,Qt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 315:return a.next=317,this.getChannel(Ie.channelUrl,!0);case 317:return Kt=a.sent,Wt=n.as(Ro),Yt=Wt.created,Zt=Wt.updated,Jt=Wt.deleted,Yt&&this._dispatcher.dispatch(new jh({channels:[Kt],source:e.CollectionEventSource.EVENT_CHANNEL_METACOUNTER_CREATED})),Zt&&this._dispatcher.dispatch(new jh({channels:[Kt],source:e.CollectionEventSource.EVENT_CHANNEL_METACOUNTER_UPDATED})),Jt&&this._dispatcher.dispatch(new jh({channels:[Kt],source:e.CollectionEventSource.EVENT_CHANNEL_METACOUNTER_DELETED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Yt&&e.onMetaCounterCreated&&e.onMetaCounterCreated(Kt,Yt),Zt&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(Kt,Zt),Jt&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(Kt,Jt)}));case 1:case"end":return e.stop()}}),e,this)})))})),a.abrupt("break",330);case 324:return a.next=326,this.getChannel(Ie.channelUrl,!0);case 326:return Xt=a.sent,$t=n.as(Rf),en=$t.pinnedMessageIds,tn=$t.latestPinnedMessage,(nn=$t.ts)>Xt._pinnedMessagesUpdatedAt&&(Xt.pinnedMessageIds=en,Xt.lastPinnedMessage=tn,Xt._pinnedMessagesUpdatedAt=nn,this._dispatcher.dispatch(new jh({channels:[Xt],source:e.CollectionEventSource.EVENT_PINNED_MESSAGE_UPDATED})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelChanged&&a.onChannelChanged(Xt)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),Aa((function(){return E(hn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(Xt)}));case 1:case"end":return e.stop()}}),e,this)})))}))),a.abrupt("break",330);case 330:return a.abrupt("break",342);case 331:rn=n.as(fd),an=rn.event,a.t7=an.category,a.next=a.t7===Xl.USER_BLOCK?335:a.t7===Xl.USER_UNBLOCK?338:341;break;case 335:return sn=ld.getDataAsUserBlockEvent(this._iid,an),on=sn.blocker,un=sn.blockee,this._groupChannelCache.block(on.userId,un.userId),a.abrupt("break",341);case 338:return cn=ld.getDataAsUserBlockEvent(this._iid,an),ln=cn.blocker,dn=cn.blockee,this._groupChannelCache.unblock(ln.userId,dn.userId),a.abrupt("break",341);case 341:return a.abrupt("break",342);case 342:a.next=348;break;case 344:if(a.prev=344,a.t8=a.catch(0),!A(a.t8)){a.next=348;break}throw a.t8;case 348:case"end":return a.stop()}}),a,this,[[0,344],[19,30,33,36],[114,127,130,133],[226,237,240,243]])})))}},{key:"_markAsLeave",value:function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)}},{key:"addHandler",value:function(e,t){this._groupChannelHandlers.set(e,t)}},{key:"removeHandler",value:function(e){this._groupChannelHandlers.delete(e)}},{key:"clearHandler",value:function(){this._groupChannelHandlers.clear()}},{key:"subscribeChannelEvent",value:function(e,t){this._groupChannelBroadcast.subscribe(e,t)}},{key:"unsubscribeChannelEvent",value:function(e){this._groupChannelBroadcast.unsubscribe(e)}},{key:"_updateJoinedMemberCount",value:function(t){t.joinedMemberCount=t.members.filter((function(t){return t.state===e.MemberState.JOINED})).length}},{key:"getChannel",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),t.prev=1,t.next=4,this.getChannelFromCache(e);case 4:if(!(a=t.sent)){t.next=7;break}return t.abrupt("return",a);case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:return t.next=13,this.getChannelWithoutCache(e,n);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),r,this,[[1,9]])})))}},{key:"getChannelWithoutCache",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,t().mark((function a(){var i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",n)).throw(M.invalidParameters),i=new Kh({channelUrl:n,isInternalCall:r}),t.next=4,this._requestQueue.send(i);case 4:s=t.sent,o=s.as(Wh),u=o.channel,c=u.unreadMessageCount,l=u.unreadMentionCount,t.t0=u.myCountPreference,t.next=t.t0===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?10:t.t0===e.CountPreference.UNREAD_MENTION_COUNT_ONLY?12:t.t0===e.CountPreference.OFF?14:17;break;case 10:return l=0,t.abrupt("break",17);case 12:return c=0,t.abrupt("break",17);case 14:return c=0,l=0,t.abrupt("break",17);case 17:return u._updateUnreadCount(c,l),t.next=20,this.upsertChannelsToCache([u]);case 20:return t.abrupt("return",t.sent[0]);case 21:case"end":return t.stop()}}),a,this)})))}},{key:"refreshChannel",value:function(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.CollectionEventSource.REFRESH_CHANNEL;return E(this,void 0,void 0,t().mark((function i(){var s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s=new Kh({channelUrl:n,isInternalCall:r}),t.next=4,this._requestQueue.send(s);case 4:if(o=t.sent,u=o.as(Wh),(c=u.channel).myMemberState!==e.MemberState.NONE){t.next=10;break}this._dispatcher.dispatch(new zh({channelUrls:[c.url],source:a})),t.next=14;break;case 10:return t.next=12,this.upsertChannelsToCache([c]);case 12:l=t.sent,this._dispatcher.dispatch(new jh({channels:l,source:a}));case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),t.t0.code!==b.NON_AUTHORIZED&&t.t0.code!==b.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new zh({channelUrls:[n],source:a}));case 19:case"end":return t.stop()}}),i,this,[[0,16]])})))}},{key:"getMyGroupChannels",value:function(n,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.CollectionEventSource.REQUEST_CHANNEL;return E(this,void 0,void 0,t().mark((function e(){var s,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Zh(Object.assign(Object.assign({},r),{userId:this._sdkState.userId,token:n,limit:a})),e.next=3,this._requestQueue.send(s);case 3:return o=e.sent,u=o.as(Jh),c=u.channels,l=u.token,this._dispatcher.dispatch(new jh({channels:c,source:i})),e.abrupt("return",{channels:c,token:l});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMyGroupChannelChangeLogs",value:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.CollectionEventSource.REQUEST_CHANNEL_CHANGELOGS;return E(this,void 0,void 0,t().mark((function e(){var i,s,o,u,c,l,d,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object.assign(Object.assign({},Nh),r),ai((L("string",n)||L("number",n))&&Ah(i)).throw(M.invalidParameters),s=new Bh(le({userId:this._sdkState.userId,ts:"number"==typeof n?n:null,token:"string"==typeof n?n:null,filter:i})),e.next=5,this._requestQueue.send(s);case 5:return o=e.sent,u=o.as(Qh),c=u.updatedChannels,l=u.deletedChannelUrls,d=u.hasMore,h=u.ts,c.length>0&&this._dispatcher.dispatch(new jh({channels:c,source:a,ts:h})),l.length>0&&this._dispatcher.dispatch(new zh({channelUrls:l,source:a})),e.abrupt("return",{updatedChannels:c,deletedChannelUrls:l,hasMore:d,token:u.token});case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getGroupChannelCount",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Mh),e),ai(Oh(r)).throw(M.invalidParameters),a=new Xh({userId:this._sdkState.userId,filter:r}),t.next=5,this._requestQueue.send(a);case 5:return i=t.sent,s=i.as($h),o=s.groupChannelCount,t.abrupt("return",o);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getUnreadItemCount",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h,f,p,v,_,m,g;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Dh),e),ai(Lh(r)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new ef({userId:i.userId,filter:r}),t.next=6,s.send(o);case 6:return u=t.sent,c=u.as(tf),l=c.groupChannelUnreadMentionCount,d=c.groupChannelUnreadMessageCount,h=c.groupChannelInvitationCount,f=c.superGroupChannelUnreadMentionCount,p=c.superGroupChannelUnreadMessageCount,v=c.superGroupChannelInvitationCount,_=c.nonSuperGroupChannelUnreadMentionCount,m=c.nonSuperGroupChannelUnreadMessageCount,g=c.nonSuperGroupChannelInvitationCount,t.abrupt("return",ce({groupChannelUnreadMentionCount:l,groupChannelUnreadMessageCount:d,groupChannelInvitationCount:h,superGroupChannelUnreadMentionCount:f,superGroupChannelUnreadMessageCount:p,superGroupChannelInvitationCount:v,nonSuperGroupChannelUnreadMentionCount:_,nonSuperGroupChannelUnreadMessageCount:m,nonSuperGroupChannelInvitationCount:g}));case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalUnreadChannelCount",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new nf({userId:r.userId}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(rf),u=o.unreadCount,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getTotalUnreadMessageCount",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Rh),e),ai(Ph(r)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new af({userId:i.userId,filter:r}),t.next=6,s.send(o);case 6:return u=t.sent,c=u.as(sf),l=c.unreadCount,t.abrupt("return",l);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalScheduledMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Fh),e),ai(Hh(r)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new of(r),t.next=6,i.send(s);case 6:return o=t.sent,u=o.as(uf),c=u.count,t.abrupt("return",c);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=Ei.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=0,t=Ei.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){var t;return null!==(t=Ei.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0}},{key:"createChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Sh),e),ai(Ih(r)).throw(M.invalidParameters),r.isPublic||(r.accessCode=void 0),a=new lf(Object.assign({userId:this._sdkState.userId},r)),t.next=6,this._requestQueue.send(a);case 6:return i=t.sent,s=i.as(df),o=s.channel,t.next=10,this.upsertChannelsToCache([o]);case 10:return t.abrupt("return",o);case 11:case"end":return t.stop()}}),n,this)})))}},{key:"markAsReadAll",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),ai(n-this._markAsReadAllLastSentAt>=1e3).throw(M.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=n,r=new hf({userId:this._sdkState.userId}),e.next=6,this._requestQueue.send(r);case 6:a=this._groupChannelCache.channels,i=y(a);try{for(i.s();!(s=i.n()).done;)(o=s.value)._updateUnreadMemberState(this._sdkState.userId,n),o._updateUnreadCount(0,0)}catch(e){i.e(e)}finally{i.f()}if(!(a.length>0)){e.next=12;break}return e.next=12,this.upsertChannelsToCache(a);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"markAsReadWithChannelUrls",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),ai(F("string",e)&&r-this._markAsReadAllLastSentAt>=1e3).throw(M.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=r,a=new hf({userId:this._sdkState.userId,channelUrls:e}),t.next=6,this._requestQueue.send(a);case 6:i=this._groupChannelCache.channels,s=[],o=y(i);try{for(o.s();!(u=o.n()).done;)c=u.value,e.includes(c.url)&&(c._updateUnreadMemberState(this._sdkState.userId,r),c._updateUnreadCount(0,0),s.push(c))}catch(e){o.e(e)}finally{o.f()}if(!(s.length>0)){t.next=13;break}return t.next=13,this.upsertChannelsToCache(s);case 13:case"end":return t.stop()}}),n,this)})))}},{key:"markAsDelivered",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChannel(e);case 2:return r=t.sent,t.next=5,r.markAsDelivered();case 5:case"end":return t.stop()}}),n,this)})))}}],[{key:"of",value:function(e){return Yf[e]||(Yf[e]=new o(e,Ei.of(e))),Yf[e]}},{key:"clear",value:function(e){Yf[e]&&delete Yf[e]}}]),o}(Ff);!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(Uh||(Uh={}));var Jf=function(e){s(a,e);var n=f(a);function a(e,t){var i;return r(this,a),(i=n.call(this))._state=Uh.IDLE,i._retryCount=0,i._retryLimit=3,i.priority=0,i._worker=t,i}return i(a,[{key:"isIdle",get:function(){return this._state===Uh.IDLE}},{key:"isRunning",get:function(){return this._state===Uh.RUNNING}},{key:"isDone",get:function(){return this._state===Uh.END}},{key:"retryCount",get:function(){return this._retryCount}},{key:"retryLimit",get:function(){return this._retryLimit}},{key:"_run",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRunning){t.next=14;break}return t.prev=1,t.next=4,this._worker(e);case 4:r=t.sent,this._retryCount=0,this.dispatch("progress",r),r.hasNext?this._run(r.nextToken):this.end(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),this.dispatch("error",t.t0),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop();case 14:case"end":return t.stop()}}),n,this,[[1,10]])})))}},{key:"start",value:function(e){this.isIdle&&(this._state=Uh.RUNNING,this._run(e))}},{key:"stop",value:function(){this._state=Uh.IDLE,this.dispatch("stop")}},{key:"end",value:function(){this._state=Uh.END,this.dispatch("end")}}]),a}(se),Xf={},$f=function(){function n(a){var i=this,s=a._iid,o=a.channel,u=a.limit,c=void 0===u?100:u;r(this,n),this.ref=0,this._iid=s,this._channel=o,this._limit=c,this._prevSyncLoopCount=0,this._nextSyncLoopCount=0;var l,d,h=Ei.of(this._iid),f=h.sdkState,p=h.dispatcher,v=h.logger;this._metadataKey=(l=f.userId,d=o.url,"sendbird:".concat(l,"@groupchannel/").concat(d,"/message/sync.meta"));var m=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(f.userId,o.url);this._prevSync=new Jf(m,(function(n){return E(i,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h,f;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,t.next=4,this.loadMetadata(n);case 4:if(v.debug("message background prev sync from",null===(a=this._metadata)||void 0===a?void 0:a.range.top),null===(i=this._metadata)||void 0===i?void 0:i.previousComplete){t.next=28;break}return t.prev=6,l=Ll.of(this._iid),t.next=10,l.getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(o=null===(s=this._metadata)||void 0===s?void 0:s.range)||void 0===o?void 0:o.top)?this._metadata.range.top:n,{prevResultSize:this._limit,nextResultSize:0,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.CollectionEventSource.SYNC_MESSAGE_BACKGROUND);case 10:return(d=t.sent).length>0&&(f=d.map((function(e){return e.createdAt})),(null===(u=this._metadata)||void 0===u?void 0:(h=u.range).intersect.apply(h,_(f)))?this.extendRange(d):this._metadata={range:new Pf({top:Math.min.apply(Math,_(f)),bottom:Math.max.apply(Math,_(f))}),previousComplete:!1}),c.hasNext=d.length>=this._limit&&this._prevSyncLoopCount<1,this._metadata&&(c.nextToken=this._metadata.range.top,this._metadata.previousComplete=d.length<this._limit),v.debug("message background prev sync progress",c),t.next=17,this.saveMetadata();case 17:t.next=26;break;case 19:if(t.prev=19,t.t0=t.catch(6),v.debug("message background prev sync error",t.t0),!(t.t0 instanceof M&&t.t0.isInvalidTokenError)){t.next=25;break}return t.next=25,this.clearMetadata();case 25:throw t.t0;case 26:t.next=29;break;case 28:c.hasNext=!1;case 29:return t.abrupt("return",c);case 30:case"end":return t.stop()}}),r,this,[[6,19]])})))})),this._nextSync=new Jf(m,(function(n){return E(i,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u={hasNext:!0,nextToken:0},this._nextSyncLoopCount++,t.next=4,this.loadMetadata(n);case 4:return v.debug("message background next sync from",null===(a=this._metadata)||void 0===a?void 0:a.range.bottom),t.prev=5,c=Ll.of(this._iid),t.next=9,c.getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(s=null===(i=this._metadata)||void 0===i?void 0:i.range)||void 0===s?void 0:s.bottom)?this._metadata.range.bottom:n,{prevResultSize:0,nextResultSize:this._limit,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.CollectionEventSource.SYNC_MESSAGE_BACKGROUND);case 9:return(l=t.sent).length>0&&(h=l.map((function(e){return e.createdAt})),(null===(o=this._metadata)||void 0===o?void 0:(d=o.range).intersect.apply(d,_(h)))?this.extendRange(l):this._metadata={range:new Pf({top:Math.min.apply(Math,_(h)),bottom:Math.max.apply(Math,_(h))}),previousComplete:!1}),u.hasNext=l.length>=this._limit&&this._nextSyncLoopCount<1,this._metadata&&(u.nextToken=this._metadata.range.bottom),v.debug("message background next sync progress",u),t.next=16,this.saveMetadata();case 16:t.next=22;break;case 18:throw t.prev=18,t.t0=t.catch(5),v.debug("message background next sync error",t.t0),t.t0;case 22:return t.abrupt("return",u);case 23:case"end":return t.stop()}}),r,this,[[5,18]])})))})),this._connectionEventContext=p.on((function(e){if(e instanceof ga)if(e.stateType===da.CONNECTED)i.resume();else i.pause()}))}return i(n,[{key:"range",get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new Pf({})}},{key:"previousComplete",get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)}},{key:"isWrappingMessages",value:function(e){var t,n;return null===(n=this.range)||void 0===n?void 0:(t=n).includes.apply(t,_(e.map((function(e){return e.createdAt}))))}},{key:"extendRange",value:function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,_(e.map((function(e){return e.createdAt}))))}},{key:"loadMetadata",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._metadata){t.next=6;break}return r=Ei.of(this._iid),a=r.cacheContext,t.next=4,a.preference.get(this._metadataKey);case 4:(i=t.sent)?i.range.bottom<e?this._metadata={range:new Pf({}),previousComplete:!1}:this._metadata={range:new Pf(i.range),previousComplete:i.previousComplete}:this._metadata={range:new Pf({}),previousComplete:!1};case 6:return t.abrupt("return",this._metadata);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=void 0;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e,t,n,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),i=Ei.of(this._iid),s=i.logger;i.connectionManager.isConnected&&(s.debug("message background sync resume()"),this._prevSyncLoopCount=this._nextSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:a),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:a))}},{key:"pause",value:function(){Ei.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Xf[this._iid][this._channel.url])}}],[{key:"of",value:function(e,t){return Xf[e]||(Xf[e]={}),Xf[e][t.url]||(Xf[e][t.url]=new n({_iid:e,channel:t})),Xf[e][t.url].ref++,Xf[e][t.url]}},{key:"clear",value:function(e,t){Xf[e]&&Xf[e][t]&&(Xf[e][t].close(),delete Xf[e])}}]),n}(),ep={},tp=function(){function n(a){var i=this,s=a._iid,o=a.channel;r(this,n),this.ref=0,this._iid=s,this._channel=o;var u,c,l=Ei.of(this._iid),d=l.logger,h=l.sdkState,f=l.dispatcher;this._metadataKey=(u=h.userId,c=o.url,"sendbird:".concat(u,"@groupchannel/").concat(c,"/message/changelogs.meta"));var p=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(h.userId,this._channel.url);this._sync=new Jf(p,(function(){return E(i,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return d.debug("message changelog sync from",null===(r=this._metadata)||void 0===r?void 0:r.token),t.prev=4,i=Ll.of(this._iid),t.next=8,i.getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:e.ReplyType.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},e.CollectionEventSource.SYNC_MESSAGE_CHANGELOGS);case 8:return s=t.sent,o=s.updatedMessages,u=s.deletedMessageIds,c=s.hasMore,l=s.token,a.hasNext=c,a.nextToken=l,(o.length>0||u.length>0)&&this._metadata&&(this._metadata.token=l),d.debug("message changelog sync progress",a),t.next=19,this.saveMetadata();case 19:t.next=28;break;case 21:if(t.prev=21,t.t0=t.catch(4),d.debug("message changelog sync error",t.t0),!(t.t0 instanceof M&&t.t0.isInvalidTokenError)){t.next=27;break}return t.next=27,this.clearMetadata();case 27:throw t.t0;case 28:return t.abrupt("return",a);case 29:case"end":return t.stop()}}),n,this,[[4,21]])})))})),this._connectionEventContext=f.on((function(e){if(e instanceof ga)if(e.stateType===da.CONNECTED)i.resume();else i.pause()}))}return i(n,[{key:"loadMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=Ei.of(this._iid),r=n.cacheContext,a=n.firstConnectedAt,e.next=4,r.preference.get(this._metadataKey);case 4:i=e.sent,this._metadata={token:i?i.token:a};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=void 0;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e=Ei.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync resume()"),this._sync.start(0))}},{key:"pause",value:function(){var e=Ei.of(this._iid),t=e.logger;e.connectionManager,t.debug("message changelog sync pause()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ep[this._iid][this._channel.url])}}],[{key:"of",value:function(e,t){return ep[e]||(ep[e]={}),ep[e][t.url]||(ep[e][t.url]=new n({_iid:e,channel:t})),ep[e][t.url].ref++,ep[e][t.url]}},{key:"clear",value:function(e,t){ep[e]&&ep[e][t]&&(ep[e][t].close(),delete ep[e])}}]),n}(),np={},rp=function(){function e(n){var a=this,i=n._iid,s=n.channel,o=n.hasPollMessage;r(this,e),this.ref=0,this._iid=i,this._channel=s;var u,c,l=Ei.of(this._iid),d=l.logger,h=l.sdkState,f=l.dispatcher;this._metadataKey=(u=h.userId,c=s.url,"sendbird:".concat(u,"@groupchannel/").concat(c,"/poll/changelogs.meta"));var p=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(h.userId,this._channel.url);this._sync=new Jf(p,(function(){return E(a,void 0,void 0,t().mark((function e(){var n,r,a,i,s,u,c,l,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={hasNext:!0,nextToken:0},e.next=3,this.loadMetadata();case 3:if(d.debug("poll changelog sync from",null===(n=this._metadata)||void 0===n?void 0:n.token),e.t0=!this._metadata||!this._metadata.token,!e.t0){e.next=9;break}return e.next=8,o();case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=12;break}return a={hasNext:!1,nextToken:0},e.abrupt("return",a);case 12:return this._metadata||(i=Ei.of(this._iid),s=i.firstConnectedAt,this._metadata={token:s}),e.prev=13,u=Bu.of(this._iid),e.next=17,u.getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token);case 17:return c=e.sent,l=c.hasMore,h=c.token,r.hasNext=l,r.nextToken=h,this._metadata.token=h,d.debug("poll changelog sync progress",r),e.next=26,this.saveMetadata();case 26:e.next=35;break;case 28:if(e.prev=28,e.t1=e.catch(13),d.debug("poll changelog sync error",e.t1),!(e.t1 instanceof M&&e.t1.isInvalidTokenError)){e.next=34;break}return e.next=34,this.clearMetadata();case 34:throw e.t1;case 35:return e.abrupt("return",r);case 36:case"end":return e.stop()}}),e,this,[[13,28]])})))})),this._connectionEventContext=f.on((function(e){if(e instanceof ga)if(e.stateType===da.CONNECTED)a.resume();else a.pause()}))}return i(e,[{key:"loadMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata=a?{token:a.token}:void 0;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=4;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=void 0;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){Ei.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)}},{key:"pause",value:function(){Ei.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete np[this._iid][this._channel.url])}}],[{key:"of",value:function(t,n,r){return np[t]||(np[t]={}),np[t][n.url]||(np[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r})),np[t][n.url].ref++,np[t][n.url]}}]),e}(),ap=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channels,s=e.source,o=e.isWebSocketEventComing,u=void 0!==o&&o,c=e.data,l=void 0===c?null:c;return r(this,n),(a=t.call(this)).channels=i,a.source=s,a.isWebSocketEventComing=u,a.data=l,a}return i(n)}(ue),ip=function(e){s(n,e);var t=f(n);function n(e){var a,i,s,o,u,c,l;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(Se(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),a.params=ce({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(i=e.threshold)&&void 0!==i?i:null,reverse:!0,custom_types:null!==(s=e.customTypes)&&void 0!==s?s:["*"],message_type:null!==(o=e.messageType)&&void 0!==o?o:null,include_reactions:null===(u=e.includeReactions)||void 0===u||u,with_sorted_meta_array:null===(c=e.includeMetaArray)||void 0===c||c,show_subchannel_messages_only:null!==(l=e.showSubchannelMessagesOnly)&&void 0!==l&&l,include_poll_details:!0,checking_continuous_messages:e.checkingContinuousMessages}),a}return i(n)}(Ue),sp=function(e){s(n,e);var t=f(n);function n(e,a){var i,s,o,u,c,l,d;return r(this,n),(i=t.call(this,e,a)).isHugeGap=a.is_huge_gap,i.prevMessages=(null!==(s=a.prev_messages)&&void 0!==s?s:[]).map((function(t){return $i(e,t)})),i.prevHasMore=null!==(o=a.prev_hasmore)&&void 0!==o&&o,i.isContinuousPrevMessages=null!==(u=a.is_continuous_prev_messages)&&void 0!==u&&u,i.nextMessages=(null!==(c=a.next_messages)&&void 0!==c?c:[]).map((function(t){return $i(e,t)})),i.nextHasmore=null!==(l=a.next_hasmore)&&void 0!==l&&l,i.isContinuousNextMessages=null!==(d=a.is_continuous_next_messages)&&void 0!==d&&d,i}return i(n)}(De),op=function(e,t){return t instanceof Fi?e.findIndex((function(e){return e instanceof Fi&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},up=function(e,t){return e.findIndex((function(e){return e.messageId===t}))},cp=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,a=Math.floor((n+r)/2);n<r;){var i=e[a].createdAt-t.createdAt;if(i>0)r=a,a=Math.floor((n+r)/2);else{if(!(i<0))return a;n=a+1,a=Math.floor((n+r)/2)}}return e[a].createdAt>t.createdAt?a:a+1}return e.length},lp=i((function e(t){r(this,e),this.source=t})),dp=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n)}(lp),hp=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n)}(lp),fp=i((function e(t){r(this,e),this.source=t})),pp=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n)}(fp),vp=function(e){s(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n)}(fp),_p=6e5;e.MessageCollectionInitPolicy=void 0,(e.MessageCollectionInitPolicy||(e.MessageCollectionInitPolicy={})).CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api";var mp,gp,yp,kp=function(){function e(){r(this,e)}return i(e,[{key:"_invokeResponse",value:function(e,n,r){var a=this;Aa((function(){return E(a,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="local"===t.t0?3:"remote"===t.t0?5:7;break;case 3:return this._onCacheResult(n,r),t.abrupt("break",7);case 5:return this._onApiResult(n,r),t.abrupt("break",7);case 7:case"end":return t.stop()}}),a,this)})))}))}},{key:"onCacheResult",value:function(e){return this._onCacheResult=e,this}},{key:"onApiResult",value:function(e){return this._onApiResult=e,this}}]),e}(),Ep=function(){function n(a,i){var s=this,o=i.filter,u=i.startingPoint,c=i.limit,l=i.channel,d=i.channelManager;r(this,n),this._messages=[],this._unsentMessages=[],this._iid=a,this._key="mc-".concat(ae()),this._isDisposed=!1,this.filter=null!=o?o:new bl,this._channel=l,this._syncRange=new Pf({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof u?u:Date.now()+_p,this._limit=c||100,this._channelManager=d,this._channelManager.subscribeChannelEvent(this._key,{onUpdate:function(n,r,a){var i=n.findIndex((function(e){return e.isIdentical(s.channel)}));i>=0&&(s._replaceChannelOfCollection(n[i]),s.channel._runIfHandleableWithGroupChannel((function(n){switch(r){case e.CollectionEventSource.EVENT_CHANNEL_UPDATED:var i=!1;for(var o in s._messages){if(s._messages[o].createdAt>=n.messageOffsetTimestamp){i=!0;var u=parseInt(o);if(u>0){var c=s._messages.splice(0,u);s._removeMessagesFromView(c.map((function(e){return e.messageId})),e.CollectionEventSource.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!i&&s._messages.length>0&&s._removeMessagesFromView(s._messages.map((function(e){return e.messageId})),e.CollectionEventSource.EVENT_MESSAGE_OFFSET_UPDATED);break;case e.CollectionEventSource.EVENT_CHANNEL_UNMUTED:var l=Ei.of(s._iid).sdkState,d=a;l.userId===d&&s._clearCheckMyMutedTimer();break;case e.CollectionEventSource.EVENT_CHANNEL_MUTED:var h=Ei.of(s._iid).sdkState,f=a;h.userId===f&&-1!==n._myMutedRemainingTime&&s._startCheckMyMutedTimer(n._myMutedRemainingTime);break;case e.CollectionEventSource.EVENT_CHANNEL_LEFT:n.isPublic&&s._clearCheckMyMutedTimer()}Aa((function(){return E(s,void 0,void 0,t().mark((function e(){var n,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this._createChannelEventContext(r),Gh(r)&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelUpdated)&&this._handler.onChannelUpdated(a,this.channel);case 2:case"end":return e.stop()}}),e,this)})))}))})))},onRemove:function(e,n){e.indexOf(s.channel.url)>=0&&(s._clearCheckMyMutedTimer(),Aa((function(){return E(s,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this._createChannelEventContext(n),(null===(r=this._handler)||void 0===r?void 0:r.onChannelDeleted)&&this._handler.onChannelDeleted(a,this.channel.url);case 2:case"end":return e.stop()}}),e,this)})))})))}}),this._channelManager.subscribeMessageEvent(this._key,{onUpdate:function(t,n){var r,a=[],i=[],o=y(t);try{for(o.s();!(r=o.n()).done;){var u=r.value;u.channelUrl===s._channel.url&&(s.filter.match(u)?a.push(u):i.push(u.messageId))}}catch(e){o.e(e)}finally{o.f()}if(_s(n)){if(a.length>0)switch(n){case e.CollectionEventSource.LOCAL_MESSAGE_CANCELED:case e.CollectionEventSource.LOCAL_MESSAGE_RESEND_STARTED:case e.CollectionEventSource.EVENT_MESSAGE_SENT_FAILED:case e.CollectionEventSource.EVENT_MESSAGE_SENT_SUCCESS:case e.CollectionEventSource.EVENT_MESSAGE_UPDATED:case e.CollectionEventSource.EVENT_MESSAGE_THREADINFO_UPDATED:case e.CollectionEventSource.EVENT_MESSAGE_REACTION_UPDATED:case e.CollectionEventSource.SYNC_MESSAGE_CHANGELOGS:s._updateMessagesToView(a,n);break;case e.CollectionEventSource.EVENT_MESSAGE_SENT_PENDING:s._addMessagesToView(a,n);break;case e.CollectionEventSource.EVENT_MESSAGE_RECEIVED:s.hasNext||s._addMessagesToView(a,n);break;case e.CollectionEventSource.SYNC_MESSAGE_FILL:s._addMessagesToView(a,n)}i.length>0&&s._removeMessagesFromView(i,n)}},onRemove:function(e,t){s._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){s._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){s._updatePollsToView(e,t)},onPollUpdate:function(e,t){s._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){s._applyPollVoteEventToView(e,t)}});var h=Ei.of(this._iid),f=h.cacheContext,p=h.dispatcher,v=h.logger;this._channel._updateMessageCollectionLastAccessedAt();var m=this._createChannelUpdateEventCommand(e.CollectionEventSource.CHANNEL_LASTACCESSEDAT_UPDATED);m&&p.dispatch(m),this._shouldStartBackgroundSync()&&(this._backgroundSync=$f.of(this._iid,this._channel),this._backgroundSync.resume(this._startingPoint)),this._changelogSync=tp.of(this._iid,this._channel),this._changelogSync.resume(),this._pollChangelogSync=rp.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new Jf(this._key,(function(n){return E(s,void 0,void 0,t().mark((function r(){var a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRemoteMessages(n,{prevLimit:this._limit,source:e.CollectionEventSource.SYNC_MESSAGE_FILL,checkingContinuousMessages:f.localCacheEnabled});case 2:if(i=t.sent,s=i.messages,o=i.isContinuousMessages,!(s.length>0)){t.next=10;break}return u=Math.min.apply(Math,_(s.map((function(e){return e.createdAt})))),this._syncRange.extends(u),o&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(u)),t.abrupt("return",{hasNext:s.length>=this._limit&&this.viewTop<u,nextToken:this._syncRange.top});case 10:return t.abrupt("return",{hasNext:!1,nextToken:0});case 11:case"end":return t.stop()}}),r,this)})))})),this._nextFill=new Jf(this._key,(function(n){return E(s,void 0,void 0,t().mark((function r(){var a,i,s,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRemoteMessages(n,{nextLimit:this._limit,source:e.CollectionEventSource.SYNC_MESSAGE_FILL,checkingContinuousMessages:f.localCacheEnabled});case 2:if(i=t.sent,s=i.messages,o=i.isContinuousMessages,!(s.length>0)){t.next=10;break}return u=Math.max.apply(Math,_(s.map((function(e){return e.createdAt})))),this._syncRange.extends(u),o&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(u)),t.abrupt("return",{hasNext:!(s.length>=this._limit&&this._hasNext)||this.viewBottom>u,nextToken:this._syncRange.bottom});case 10:return t.abrupt("return",{hasNext:!1,nextToken:0});case 11:case"end":return t.stop()}}),r,this)})))})),this._connectionEventContext=p.on((function(n){if(n instanceof ga)switch(n.stateType){case da.CONNECTED:s._refreshChannel(e.CollectionEventSource.SYNC_CHANNEL_CHANGELOGS),Ma((function(){return E(s,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.getMyMutedInfo();case 2:(n=e.sent).isMuted&&-1!==n.remainingDuration&&this._startCheckMyMutedTimer(n.remainingDuration);case 4:case"end":return e.stop()}}),e,this)})))})),v.debug("check huge gap"),s._checkHugeGap();break;case da.LOGOUT:s.dispose();break;default:s._clearCheckMyMutedTimer(),s._prevFill.stop(),s._nextFill.stop()}})),Ei.of(this._iid).statLogCollector.put(new fi({type:Oe.FEATURE_LOCALCACHE,data:{use_local_cache:f.localCacheEnabled,collection_interface:{message:!0}}}))}return i(n,[{key:"channel",get:function(){return this._channel}},{key:"succeededMessages",get:function(){return _(this._messages)}},{key:"failedMessages",get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.FAILED}))}},{key:"pendingMessages",get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.PENDING}))}},{key:"hasPrevious",get:function(){return this._hasPrevious}},{key:"hasNext",get:function(){return this._hasNext}},{key:"viewTop",get:function(){return Math.min.apply(Math,_(this._messages.map((function(e){return e.createdAt}))).concat([Number.MAX_SAFE_INTEGER]))}},{key:"viewBottom",get:function(){return Math.max.apply(Math,_(this._messages.map((function(e){return e.createdAt}))).concat([0]))}},{key:"_replaceChannelOfCollection",value:function(e){this._channel.isGroupChannel()?this._channel=e:this._channel.isFeedChannel()&&(this._channel._groupChannel=e._groupChannel)}},{key:"_shouldStartBackgroundSync",value:function(){var e=Ei.of(this._iid).cacheContext;return this.channel.isGroupChannel()?e.localCacheEnabled&&!this.channel.isSuper:e.localCacheEnabled}},{key:"_createChannelEventContext",value:function(e){switch(!0){case this.channel.isGroupChannel():return new dp(e);case this.channel.isFeedChannel():return new hp(e);default:throw new M({code:b.WRONG_CHANNEL_TYPE,message:"Wrong channel type"})}}},{key:"_createMessageEventContext",value:function(e){switch(!0){case this.channel.isGroupChannel():return new pp(e);case this.channel.isFeedChannel():return new vp(e);default:throw new M({code:b.WRONG_CHANNEL_TYPE,message:"Wrong channel type"})}}},{key:"_createChannelUpdateEventCommand",value:function(e){switch(!0){case this.channel.isGroupChannel():return new jh({channels:[this._channel],source:e});case this.channel.isFeedChannel():return new ap({channels:[this._channel],source:e});default:return null}}},{key:"_setBaseMessageCollectionHandler",value:function(e){this._handler=e}},{key:"_filterUnderOffsetMessage",value:function(e){return e}},{key:"_addMessagesToView",value:function(n,r){var a,i=this,s=this._filterUnderOffsetMessage(n),o=[],u=[],c=y(s);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(r===e.CollectionEventSource.SYNC_MESSAGE_FILL){if(l.messageId>0){if(op(this._messages,l)<0){op(this._unsentMessages,l)<0&&o.push(l);var d=cp(this._messages,l);this._messages.splice(d,0,l)}}else if(l instanceof Fi){op(this._unsentMessages,l)<0&&op(this._messages,l)<0&&(this._unsentMessages.push(l),o.push(l))}}else if(l.messageId>0){var h=op(this._messages,l);if(h<0){var f=op(this._unsentMessages,l);f<0?o.push(l):(this._unsentMessages.splice(f,1),u.push(l));var p=cp(this._messages,l);this._messages.splice(p,0,l)}else u.push(l),this._messages[h]=l;if(l.updatedAt>0){var v=this._updateChildMessagesInView(l);u.push.apply(u,_(v))}}else if(l instanceof Fi){var m=op(this._unsentMessages,l);m<0?op(this._messages,l)<0&&(this._unsentMessages.push(l),o.push(l)):(u.push(l),this._unsentMessages[m]=l)}}}catch(e){c.e(e)}finally{c.f()}_s(r)&&Aa((function(){return E(i,void 0,void 0,t().mark((function e(){var n,a,i,s,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=this._createMessageEventContext(r),o.length>0&&(null===(a=null===(n=this._handler)||void 0===n?void 0:n.onMessagesAdded)||void 0===a||a.call(n,c,this.channel,o)),u.length>0&&(null===(s=null===(i=this._handler)||void 0===i?void 0:i.onMessagesUpdated)||void 0===s||s.call(i,c,this.channel,u));case 3:case"end":return e.stop()}}),e,this)})))}))}},{key:"_updateChildMessagesInView",value:function(e){var t=[];return this._messages.forEach((function(n){n.parentMessageId===e.messageId&&n.applyParentMessage(e)&&t.push(n)})),t}},{key:"_updatePollsToView",value:function(e,n){var r,a=this,i=[],s=y(e);try{for(s.s();!(r=s.n()).done;){var o=r.value,u=up(this._messages,o.messageId);if(u>=0){var c=this._messages[u];c&&c.applyPoll(o),i.push(c)}}}catch(e){s.e(e)}finally{s.f()}return i.length>0&&_s(n)&&Aa((function(){return E(a,void 0,void 0,t().mark((function e(){var r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=this._createMessageEventContext(n),i.length>0&&(null===(a=(r=this._handler).onMessagesUpdated)||void 0===a||a.call(r,s,this.channel,i));case 2:case"end":return e.stop()}}),e,this)})))})),i}},{key:"_applyPollUpdateEventToView",value:function(e,n){var r=this,a=up(this._messages,e.messageId);if(a>=0){var i=this._messages[a];i&&i.isUserMessage()&&i.poll&&i.poll.applyPollUpdateEvent(e)&&_s(n)&&Aa((function(){return E(r,void 0,void 0,t().mark((function e(){var r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=this._createMessageEventContext(n),null===(a=null===(r=this._handler)||void 0===r?void 0:r.onMessagesUpdated)||void 0===a||a.call(r,s,this.channel,[i]);case 2:case"end":return e.stop()}}),e,this)})))}))}}},{key:"_applyPollVoteEventToView",value:function(e,n){var r=this,a=up(this._messages,e.messageId);if(a>=0){var i=this._messages[a];i&&i.isUserMessage()&&i.poll&&i.poll.applyPollVoteEvent(e)&&_s(n)&&Aa((function(){return E(r,void 0,void 0,t().mark((function e(){var r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=this._createMessageEventContext(n),null===(a=null===(r=this._handler)||void 0===r?void 0:r.onMessagesUpdated)||void 0===a||a.call(r,s,this.channel,[i]);case 2:case"end":return e.stop()}}),e,this)})))}))}}},{key:"_updateMessagesToView",value:function(e,n){var r,a=this,i=[],s=[],o=[],u=y(e);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(c.messageId>0){var l=op(this._messages,c);if(l>=0)s.push(c),this._messages[l]=c;else{var d=op(this._unsentMessages,c);if(d>=0){var h=this._unsentMessages.splice(d,1);if(this.hasNext&&h.length>0)o.push(h[0]);else{s.push(c);var f=cp(this._messages,c);this._messages.splice(f,0,c)}}else{var p=this._messages.map((function(e){return e.createdAt}));(c.createdAt<Math.min.apply(Math,_(p))&&!this._hasPrevious||c.createdAt>Math.max.apply(Math,_(p))&&!this._hasNext)&&i.push(c)}}}else if(c instanceof Fi){var v=op(this._unsentMessages,c);v>=0&&(s.push(c),this._unsentMessages[v]=c)}}}catch(e){u.e(e)}finally{u.f()}return _s(n)&&Aa((function(){return E(a,void 0,void 0,t().mark((function e(){var r,a,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=this._createMessageEventContext(n),s.length>0?null===(a=null===(r=this._handler)||void 0===r?void 0:r.onMessagesUpdated)||void 0===a||a.call(r,l,this.channel,s):o.length>0?null===(c=null===(u=this._handler)||void 0===u?void 0:u.onMessagesDeleted)||void 0===c||c.call(u,l,this.channel,[],o):i.length>0&&this._addMessagesToView(i,n);case 2:case"end":return e.stop()}}),e,this)})))})),s}},{key:"_removeMessagesFromView",value:function(e,n){var r,a=this,i=[],s=[],o=y(e);try{var u=function(){var e=r.value,t=a._messages.findIndex((function(t){return t.messageId===e}));if(t>=0){var n=a._messages[t];i.push(n.messageId),s.push(n),a._messages.splice(t,1)}};for(o.s();!(r=o.n()).done;)u()}catch(e){o.e(e)}finally{o.f()}return _s(n)&&s.length>0&&Aa((function(){return E(a,void 0,void 0,t().mark((function e(){var r,a,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this._createMessageEventContext(n),null===(a=null===(r=this._handler)||void 0===r?void 0:r.onMessagesDeleted)||void 0===a||a.call(r,o,this.channel,i,s);case 2:case"end":return e.stop()}}),e,this)})))})),i}},{key:"_removeUnsentMessageFromView",value:function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)}},{key:"_getLocalMessages",value:function(e,n){var r=n.prevLimit,a=void 0===r?0:r,i=n.nextLimit,s=void 0===i?0:i,o=n.inclusive,u=void 0===o||o;return E(this,void 0,void 0,t().mark((function n(){var r,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=[],!u){t.next=5;break}return t.next=4,this._channelManager.getExactlyMatchingMessagesForTokenFromCache(this._channel.url,e,this.filter);case 4:r=t.sent;case 5:if(!(a>0)){t.next=11;break}return t.next=8,this._channelManager.getMessagesFromCache(this._channel.url,e,"prev",this.filter,a,!1);case 8:t.t0=t.sent,t.next=12;break;case 11:t.t0=[];case 12:if(i=t.t0,!(s>0)){t.next=19;break}return t.next=16,this._channelManager.getMessagesFromCache(this._channel.url,e,"next",this.filter,s,!1);case 16:t.t1=t.sent,t.next=20;break;case 19:t.t1=[];case 20:return o=t.t1,t.abrupt("return",[].concat(_(r),_(i),_(o)).sort((function(e,t){return t.createdAt-e.createdAt})));case 22:case"end":return t.stop()}}),n,this)})))}},{key:"_getRemoteMessages",value:function(n,r){var a=r.prevLimit,i=void 0===a?0:a,s=r.nextLimit,o=void 0===s?0:s,u=r.source,c=void 0===u?e.CollectionEventSource.REQUEST_MESSAGE:u,l=r.reverse,d=void 0!==l&&l,h=r.checkingContinuousMessages,f=void 0!==h&&h;return E(this,void 0,void 0,t().mark((function e(){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ll.of(this._iid),!(i>0||o>0)){e.next=7;break}return e.next=4,r._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,n,le(Object.assign(Object.assign({},this.filter),{isInclusive:!0,reverse:d,prevResultSize:i,nextResultSize:o,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0,includeParentMessageInfo:!0})),c,f);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0={messages:[],isContinuousMessages:!1};case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"_checkHugeGap",value:function(){var n;return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h,f,p,v,m,g,y,k,w,C,x,T=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(this._messages.length>0)){r.next=15;break}return a=this._syncRange.top,i=this.viewTop,s=this._syncRange.bottom,o=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,r.next=7,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,i,a);case 7:return u=r.sent,r.next=10,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,s,o);case 10:return c=r.sent,r.next=13,Na((function(){return E(T,void 0,void 0,t().mark((function n(){var r,l,d,h,f,p,v,m,g,y,k,b,w,C,x,T,S,I,N,A,M,O=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return l=Ei.of(this._iid),d=l.dispatcher,h=l.requestQueue,f=l.cacheContext,p=new ip(Object.assign({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:i,prevEnd:a,prevCount:u,nextStart:s,nextEnd:o,nextCount:c,checkingContinuousMessages:f.localCacheEnabled},this.filter)),n.next=4,h.send(p);case 4:v=n.sent,m=v.as(sp),g=m.isHugeGap,y=m.prevMessages,k=void 0===y?[]:y,b=m.prevHasMore,w=m.isContinuousPrevMessages,C=m.nextMessages,x=void 0===C?[]:C,T=m.nextHasmore,S=m.isContinuousNextMessages,g?Aa((function(){return E(O,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(null===(n=this._handler)||void 0===n?void 0:n.onHugeGapDetected)&&this._handler.onHugeGapDetected();case 1:case"end":return e.stop()}}),e,this)})))})):(I=this.viewTop,N=this.viewBottom,A=Math.min.apply(Math,[Number.MAX_SAFE_INTEGER,I].concat(_(k.map((function(e){return e.createdAt}))))),M=Math.max.apply(Math,[0,N].concat(_(x.map((function(e){return e.createdAt}))))),d.dispatch(new ms({messages:k,source:e.CollectionEventSource.SYNC_MESSAGE_FILL})),d.dispatch(new ms({messages:x,source:e.CollectionEventSource.SYNC_MESSAGE_FILL})),this._syncRange.extends(A,M),(w||S)&&(null===(r=this._backgroundSync)||void 0===r||r.range.extends(A,M)),b&&this._prevFill.start(A),T&&this._nextFill.start(M));case 7:case"end":return n.stop()}}),n,this)})))}),1);case 13:r.next=30;break;case 15:return l=Ei.of(this._iid),d=l.cacheContext,h=Math.floor(this._limit/2),f=Date.now(),r.prev=18,r.next=21,this._getRemoteMessages(f,{prevLimit:h,nextLimit:h,source:e.CollectionEventSource.SYNC_MESSAGE_FILL,checkingContinuousMessages:d.localCacheEnabled});case 21:if(p=r.sent,v=p.messages,m=p.isContinuousMessages,v.length>0){for(y=v.map((function(e){return e.createdAt})),k=0,w=0,C=0;C<y.length;C++)(x=y[C])<=f?k++:x>=f&&w++;this._hasPrevious=k>=h,this._hasNext=w>=h,(g=this._syncRange).extends.apply(g,_(y)),m&&(null===(n=this._backgroundSync)||void 0===n||n.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(v,e.CollectionEventSource.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;r.next=30;break;case 27:r.prev=27,r.t0=r.catch(18),r.t0 instanceof M&&r.t0.code===b.NOT_FOUND_IN_DATABASE&&(this._hasPrevious=!1,this._hasNext=!1);case 30:case"end":return r.stop()}}),r,this,[[18,27]])})))}},{key:"_loadUnsentMessages",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._channelManager.getUnsentMessagesFromCache(this._channel.url,this.filter);case 2:this._unsentMessages=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"_hasPollMessage",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._channelManager.getPollMessagesFromCache(this._channel.url,Date.now()+_p,this.filter,1);case 2:if(!(e.sent.length>0)){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"_refreshChannel",value:function(e){this._channelManager.refreshChannel(this.channel.url,!0,e)}},{key:"_startCheckMyMutedTimer",value:function(n){var r=this;this._clearCheckMyMutedTimer(),this._checkMyMutedStateTimer=setTimeout((function(){return E(r,void 0,void 0,t().mark((function n(){var r,a,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._checkMyMutedStateTimer=void 0,r=!0,t.prev=2,t.next=5,this._channel.getMyMutedInfo();case 5:a=t.sent,r=!a.isMuted,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),r=!0;case 12:return t.prev=12,r&&this.channel._runIfHandleableWithGroupChannel((function(t){var n,r;t.myMutedState=e.MutedState.UNMUTED;var a=i._createChannelEventContext(e.CollectionEventSource.EVENT_CHANNEL_UNMUTED);null===(r=null===(n=i._handler)||void 0===n?void 0:n.onChannelUpdated)||void 0===r||r.call(n,a,i.channel)})),t.finish(12);case 15:case"end":return t.stop()}}),n,this,[[2,9,12,15]])})))}),n+1e3)}},{key:"_clearCheckMyMutedTimer",value:function(){this._checkMyMutedStateTimer&&(clearTimeout(this._checkMyMutedStateTimer),this._checkMyMutedStateTimer=void 0)}},{key:"initialize",value:function(n){var r=this,a=new kp;this._messages=[],this._unsentMessages=[],this._syncRange=new Pf({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(e.CollectionEventSource.REFRESH_CHANNEL),Ma((function(){return E(r,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channel.getMyMutedInfo();case 2:(n=e.sent).isMuted&&-1!==n.remainingDuration&&this._startCheckMyMutedTimer(n.remainingDuration);case 4:case"end":return e.stop()}}),e,this)})))}));var i=Math.floor(this._limit/2);if(n===e.MessageCollectionInitPolicy.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:i,nextLimit:i}).then((function(n){return E(r,void 0,void 0,t().mark((function r(){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this._filterUnderOffsetMessage(n),this._addMessagesToView(i,e.CollectionEventSource.REQUEST_MESSAGE),t.next=4,this._loadUnsentMessages();case 4:a._invokeResponse("local",null,i);case 5:case"end":return t.stop()}}),r,this)})))})).catch((function(e){if(A(e))throw e;a._invokeResponse("local",e,null)})).finally((function(){var t=Ei.of(r._iid).cacheContext;r._getRemoteMessages(r._startingPoint,{prevLimit:i,nextLimit:i,reverse:!0,checkingContinuousMessages:t.localCacheEnabled}).then((function(t){var n,s=t.messages,o=t.isContinuousMessages;r._messages=[];var u=r._filterUnderOffsetMessage(s);if(u.length>0){for(var c,l=u.map((function(e){return e.createdAt})),d=0,h=0,f=0;f<l.length;f++){var p=l[f];p<r._startingPoint?d++:p>r._startingPoint&&h++}r._hasPrevious=d>=i,r._hasNext=h>=i,(c=r._syncRange).extends.apply(c,_(u.map((function(e){return e.createdAt})))),o&&(null===(n=r._backgroundSync)||void 0===n||n.range.extends(r._syncRange.top,r._syncRange.bottom)),r._addMessagesToView(u,e.CollectionEventSource.REQUEST_MESSAGE)}else r._hasPrevious=!1,r._hasNext=!1;a._invokeResponse("remote",null,u)})).catch((function(e){if(A(e))throw e;a._invokeResponse("remote",e,null)}))}));var s=Ei.of(this._iid),o=s.cacheContext;return s.statLogCollector.put(new fi({type:Oe.FEATURE_LOCALCACHE,data:{use_local_cache:o.localCacheEnabled,collection_interface:{message_init_policy:n}}})),a}},{key:"loadPrevious",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._isDisposed){n.next=2;break}throw new M({code:b.COLLECTION_DISPOSED,message:"Collection has been disposed."});case 2:if(this._hasPrevious){n.next=4;break}return n.abrupt("return",[]);case 4:return r=Math.floor(this._limit/2),a=this.viewTop,i=[],n.next=9,Ma((function(){return E(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getLocalMessages(a,{prevLimit:r,inclusive:!1});case 3:e.t1=e.sent,i=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})))}));case 9:if(!(i.length<r)&&this._backgroundSync&&this._backgroundSync.isWrappingMessages(i)){n.next=15;break}return n.next=12,Ma((function(){return E(s,void 0,void 0,t().mark((function e(){var n,s,o,u,c,l,d=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Ei.of(this._iid),u=o.cacheContext,e.next=3,this._getRemoteMessages(a,{prevLimit:r,reverse:!0,checkingContinuousMessages:u.localCacheEnabled});case 3:c=e.sent,i=(i=this._filterUnderOffsetMessage(c.messages)).filter((function(e){return op(d._messages,e)<0})),this._hasPrevious=i.length>=r,i.length>0&&((l=this._syncRange).extends.apply(l,_(i.map((function(e){return e.createdAt})))),(null===(n=this._backgroundSync)||void 0===n?void 0:n.range.overlap(this._syncRange))&&c.isContinuousMessages&&(null===(s=this._backgroundSync)||void 0===s||s.range.extends(this._syncRange.top)));case 8:case"end":return e.stop()}}),e,this)})))}));case 12:this._addMessagesToView(i,e.CollectionEventSource.REQUEST_MESSAGE),n.next=17;break;case 15:this._hasPrevious=i.length>=r,i.length>0&&this._addMessagesToView(i,e.CollectionEventSource.REQUEST_MESSAGE);case 17:return n.abrupt("return",i);case 18:case"end":return n.stop()}}),n,this)})))}},{key:"loadNext",value:function(){var n;return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._isDisposed){r.next=2;break}throw new M({code:b.COLLECTION_DISPOSED,message:"Collection has been disposed."});case 2:if(this._hasNext){r.next=4;break}return r.abrupt("return",[]);case 4:return a=Math.floor(this._limit/2),i=this.viewBottom,s=[],r.next=9,Ma((function(){return E(o,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getLocalMessages(i,{nextLimit:a,inclusive:!1});case 3:e.t1=e.sent,s=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})))}));case 9:if(!(s.length<a)&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(s))){r.next=15;break}return r.next=12,Ma((function(){return E(o,void 0,void 0,t().mark((function e(){var n,r,o,u,c,l,d=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Ei.of(this._iid),u=o.cacheContext,e.next=3,this._getRemoteMessages(i,{nextLimit:a,reverse:!0,checkingContinuousMessages:u.localCacheEnabled});case 3:c=e.sent,s=(s=this._filterUnderOffsetMessage(c.messages)).filter((function(e){return op(d._messages,e)<0})),this._hasNext=s.length>=a,s.length>0&&((l=this._syncRange).extends.apply(l,_(s.map((function(e){return e.createdAt})))),(null===(n=this._backgroundSync)||void 0===n?void 0:n.range.overlap(this._syncRange))&&c.isContinuousMessages&&(null===(r=this._backgroundSync)||void 0===r||r.range.extends(this._syncRange.bottom)));case 8:case"end":return e.stop()}}),e,this)})))}));case 12:this._addMessagesToView(s,e.CollectionEventSource.REQUEST_MESSAGE),r.next=17;break;case 15:this._hasNext=s.length>=a,s.length>0&&this._addMessagesToView(s,e.CollectionEventSource.REQUEST_MESSAGE);case 17:return r.abrupt("return",s);case 18:case"end":return r.stop()}}),r,this)})))}},{key:"removeFailedMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isDisposed){t.next=2;break}throw new M({code:b.COLLECTION_DISPOSED,message:"Collection has been disposed."});case 2:return t.next=4,this._channelManager.removeFailedMessageFromCache(e);case 4:(r=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(r,1);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"dispose",value:function(){var t,n,r;if(!this._isDisposed){this._isDisposed=!0;var a=Ei.of(this._iid),i=a.cacheContext,s=a.dispatcher;this._messages=[],this._clearCheckMyMutedTimer(),this._channel._updateMessageCollectionLastAccessedAt();var o=this._createChannelUpdateEventCommand(e.CollectionEventSource.CHANNEL_LASTACCESSEDAT_UPDATED);o&&s.dispatch(o),i.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(t=this._backgroundSync)||void 0===t||t.close(),null===(n=this._changelogSync)||void 0===n||n.close(),null===(r=this._pollChangelogSync)||void 0===r||r.close(),this._channelManager.unsubscribeChannelEvent(this._key),this._channelManager.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}}}]),n}(),bp=function(e){s(n,e);var t=f(n);function n(e,a){return r(this,n),t.call(this,e,Object.assign(Object.assign({},a),{channelManager:Zf.of(e)}))}return i(n,[{key:"setMessageCollectionHandler",value:function(e){this._setBaseMessageCollectionHandler(e)}}]),n}(Ep),wp={coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isPublic:void 0,isDiscoverable:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Cp=function(e){return L("string",e.coverUrl,!0)&&(q(e.coverImage)||L("string",e.coverImage,!0))&&L("boolean",e.isDistinct,!0)&&L("boolean",e.isPublic,!0)&&L("boolean",e.isDiscoverable,!0)&&L("string",e.accessCode,!0)&&L("string",e.name,!0)&&L("string",e.data,!0)&&L("string",e.customType,!0)&&F("string",e.operatorUserIds,!0)&&L("number",e.messageSurvivalSeconds,!0)},xp=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.token,o=e.limit,u=e.order,c=e.mutedMemberFilter,l=e.memberStateFilter,d=e.nicknameStartsWithFilter,h=e.operatorFilter;return(a=t.call(this)).method=de.GET,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/members"),a.params={token:s,limit:o,order:u,muted_member_filter:c,member_state_filter:l,nickname_startswith:d,operator_filter:h,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return i(n)}(Ue),Tp=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).members=[];var s=a.next,o=a.members;return i.token=s,o&&o.length>0&&(i.members=o.map((function(t){return new kh(e,t)}))),i}return i(n)}(De);e.MutedMemberFilter=void 0,(mp=e.MutedMemberFilter||(e.MutedMemberFilter={})).ALL="all",mp.MUTED="muted",mp.UNMUTED="unmuted",e.MemberListOrder=void 0,(gp=e.MemberListOrder||(e.MemberListOrder={})).MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",gp.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical",e.MemberStateFilter=void 0,(yp=e.MemberStateFilter||(e.MemberStateFilter={})).ALL="all",yp.JOINED="joined_only",yp.INVITED="invited_only",yp.INVITED_BY_FRIEND="invited_by_friend",yp.INVITED_BY_NON_FRIEND="invited_by_non_friend";var Sp,Ip,Np=function(n){s(u,n);var a=f(u);function u(t,n,i){var s,o,c,l,d;return r(this,u),(s=a.call(this,t,n,e.ChannelType.GROUP,i)).mutedMemberFilter=e.MutedMemberFilter.ALL,s.memberStateFilter=e.MemberStateFilter.ALL,s.nicknameStartsWithFilter=null,s.operatorFilter=e.OperatorFilter.ALL,s.order=e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,s.mutedMemberFilter=null!==(o=i.mutedMemberFilter)&&void 0!==o?o:e.MutedMemberFilter.ALL,s.memberStateFilter=null!==(c=i.memberStateFilter)&&void 0!==c?c:e.MemberStateFilter.ALL,s.nicknameStartsWithFilter=null!==(l=i.nicknameStartsWithFilter)&&void 0!==l?l:null,s.order=null!==(d=i.order)&&void 0!==d?d:e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,s}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)&&R(e.MutedMemberFilter,this.mutedMemberFilter)&&R(e.MemberStateFilter,this.memberStateFilter)&&(L("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&R(e.OperatorFilter,this.operatorFilter)&&R(e.MemberListOrder,this.order)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new xp(le(Object.assign(Object.assign({},this),{token:this._token}))),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(Tp),o=s.members,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(no),Ap=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.userId,o=e.accessCode;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/accept"),a.params={user_id:s,access_code:o},a}return i(n)}(Ue),Mp=function(t){s(a,t);var n=f(a);function a(t,i){var s;return r(this,a),(s=n.call(this,t,i)).channel=new sv(t,i),s.channel.myMemberState=e.MemberState.JOINED,s}return i(a)}(De),Op=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.isDistinct,o=e.isPublic,u=e.isDiscoverable,c=e.coverUrl,l=e.coverImage,d=e.accessCode,h=e.name,f=e.data,p=e.customType,v=e.operatorUserIds,_=e.messageSurvivalSeconds;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i)),a.params=ce({is_distinct:s,is_public:o,is_discoverable:u,name:h,data:f,custom_type:p,cover_url:c,cover_file:l,access_code:d,operator_ids:v,message_survival_seconds:_}),a}return i(n)}(Ue),Up=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).channel=new sv(e,a),i}return i(n)}(De),Dp=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl;return(a=t.call(this)).method=de.DELETE,a.path="".concat(ve,"/").concat(encodeURIComponent(i)),a}return i(n)}(Ue),Lp=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl;return(a=t.call(this)).method=de.DELETE,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/hide"),a}return i(n)}(Ue),Rp=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.channelUrl,o=e.countPreference;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/count_preference/").concat(encodeURIComponent(s)),a.params={count_preference:o},a}return i(n)}(Ue),Pp=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).countPreference=a.count_preference,i}return i(n)}(De),Fp=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl;return(a=t.call(this)).method=de.PUT,a.path="".concat(ve,"/").concat(encodeURIComponent(i),"/reset_user_history"),a}return i(n)}(Ue),Hp=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.ts_message_offset;return i.messageOffsetTimestamp=s,i}return i(n)}(De),qp=Object.assign(Object.assign({},Ys),{scheduledAt:void 0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),Gp=function(e){return Zs(e)&&L("number",e.scheduledAt,!0)&&(q(e.file)||L("string",e.fileUrl))&&L("string",e.fileName,!0)&&L("string",e.mimeType,!0)&&L("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return L("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},jp=Object.assign(Object.assign({},Js),{scheduledAt:void 0}),zp=function(e){return Xs(e)&&L("number",e.scheduledAt,!0)},Vp=function(t){s(a,t);var n=f(a);function a(t){var i,s;r(this,a),i=n.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl,l=t.scheduledMessageId;return i.method=de.PUT,i.path="".concat(Se(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),i.params=ce(le({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Z.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return Hi.payloadify(e)})):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(s=t.metaArrays)||void 0===s?void 0:s.map((function(e){return Ai.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,push_option:t.pushNotificationDeliveryOption})),i}return i(a)}(Ue),Bp=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).message=new es(e,a),i}return i(n)}(De),Qp=function(t){s(a,t);var n=f(a);function a(t){var i,s;r(this,a),i=n.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl,l=t.scheduledMessageId;return i.method=de.PUT,i.path="".concat(Se(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),i.params=ce(le({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Z.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(s=t.metaArrays)||void 0===s?void 0:s.map((function(e){return Ai.payloadify(e)})),apple_critical_alert_options:t.appleCriticalAlertOptions?Ui.payloadify(t.appleCriticalAlertOptions):null,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption})),i}return i(a)}(Ue),Kp=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n),a=t.call(this);var i=e.channelType,s=e.channelUrl,o=e.scheduledMessageId;return a.method=de.DELETE,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(o)),a}return i(n)}(Ue),Wp=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n),a=t.call(this);var i=e.channelType,s=e.channelUrl,o=e.scheduledMessageId;return a.method=de.POST,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(o),"/send_now"),a}return i(n)}(Ue),Yp=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.channelUrl,o=e.pushTriggerOption;return r(this,n),(a=t.call(this)).method=de.PUT,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference/").concat(encodeURIComponent(s)),a.params={push_trigger_option:o},a}return i(n)}(Ue),Zp=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i.enabled=a.enable,i}return i(n)}(De),Jp=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.userId,s=e.channelUrl;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(fe,"/").concat(encodeURIComponent(i),"/push_preference/").concat(encodeURIComponent(s)),a}return i(n)}(Ue),Xp=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,i.enabled=a.enable,i}return i(n)}(De),$p=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId;return r(this,n),(a=t.call(this)).method=de.POST,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/pin"),a}return i(n)}(Ue),ev=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelType,s=e.channelUrl,o=e.messageId;return r(this,n),(a=t.call(this)).method=de.DELETE,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/messages/").concat(o,"/pin"),a}return i(n)}(Ue),tv=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e)).message=$i(e,a.message),i}return i(n)}(Ya),nv=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelType,s=e.channelUrl,o=e.limit,u=e.token,c=e.includeReactions,l=e.includeMetaArray,d=e.includeParentMessageInfo,h=e.includeThreadInfo,f=e.includePollDetails;return(a=t.call(this)).method=de.GET,a.path="".concat(Se(i),"/").concat(encodeURIComponent(s),"/pinned_messages"),a.params=ce({limit:o,token:u,include_reactions:c,with_sorted_meta_array:l,include_thread_info:h,include_parent_message_info:d,include_poll_details:f}),a}return i(n)}(Ue),rv=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),i=t.call(this,e,a);var s=a.pinned_messages,o=a.has_more,u=a.next;return i.pinnedMessages=s.map((function(t){return new tv(e,t)})),i.hasMore=o,i.token=u,i}return i(n)}(De),av=function(e){s(a,e);var n=f(a);function a(e,t,i,s){var o;return r(this,a),(o=n.call(this,e,t,i,s)).includeMetaArray=s.includeMetaArray,o.includeReactions=s.includeReactions,o.includeParentMessageInfo=s.includeParentMessageInfo,o.includeThreadInfo=s.includeThreadInfo,o.includePollDetails=s.includePollDetails,o}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)&&L("boolean",this.includeMetaArray,!0)&&L("boolean",this.includeReactions,!0)&&L("boolean",this.includeParentMessageInfo,!0)&&L("boolean",this.includeThreadInfo,!0)&&L("boolean",this.includePollDetails,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new nv(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(rv),o=s.pinnedMessages,u=s.hasMore,c=s.token,this._token=c,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(no);e.CountPreference=void 0,(Sp=e.CountPreference||(e.CountPreference={})).ALL="all",Sp.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",Sp.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",Sp.OFF="off",e.HiddenState=void 0,(Ip=e.HiddenState||(e.HiddenState={})).UNHIDDEN="unhidden",Ip.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",Ip.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide";var iv,sv=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h,f,p,v,m,g,y,k,E,b,w,C,x,T,S;(r(this,u),(i=a.call(this,t,n))._unreadMemberStateMap=new Map,i._undeliveredMemberStateMap=new Map,i._typingStatus=new Map,i._lastMemberCountUpdated=0,i._typingStarted=0,i._typingEnded=0,i.isDistinct=!1,i.isSuper=!1,i.isBroadcast=!1,i.isExclusive=!1,i.isPublic=!1,i.isDiscoverable=!0,i.isChatNotification=!1,i.isAccessCodeRequired=!1,i.isPushEnabled=!1,i.unreadMessageCount=0,i.unreadMentionCount=0,i.members=[],i.memberCount=0,i.joinedMemberCount=0,i.hiddenState=e.HiddenState.UNHIDDEN,i.lastMessage=null,i.messageOffsetTimestamp=0,i.messageSurvivalSeconds=-1,i.myMemberState=e.MemberState.NONE,i.myRole=e.Role.NONE,i.myMutedState=e.MutedState.UNMUTED,i.myLastRead=0,i.myCountPreference=e.CountPreference.ALL,i.myPushTriggerOption=e.PushTriggerOption.DEFAULT,i.inviter=null,i.invitedAt=0,i.joinedAt=0,i.pinnedMessageIds=[],i.lastPinnedMessage=null,i._pinnedMessagesUpdatedAt=0,i._myMutedRemainingTime=-1,i.channelType=e.ChannelType.GROUP,i.isDistinct=null!==(s=n.is_distinct)&&void 0!==s&&s,i.isSuper=null!==(o=n.is_super)&&void 0!==o&&o,i.isBroadcast=null!==(c=n.is_broadcast)&&void 0!==c&&c,i.isExclusive=null!==(l=n.is_exclusive)&&void 0!==l&&l,i.isPublic=null!==(d=n.is_public)&&void 0!==d&&d,i.isDiscoverable=null!==(h=n.is_discoverable)&&void 0!==h?h:i.isPublic,i.isChatNotification=null!==(f=n.is_chat_notification)&&void 0!==f&&f,i.isAccessCodeRequired=null!==(p=n.is_access_code_required)&&void 0!==p&&p,i.isPushEnabled=null!==(v=n.is_push_enabled)&&void 0!==v&&v,Array.isArray(n.members))&&(S=i.members).push.apply(S,_(n.members.map((function(e){return new kh(i._iid,e)}))));return i.memberCount=null!==(m=n.member_count)&&void 0!==m?m:0,i.joinedMemberCount=null!==(g=n.joined_member_count)&&void 0!==g?g:0,i.hiddenState=R(e.HiddenState,n.hidden_state)?n.hidden_state:e.HiddenState.UNHIDDEN,i.messageOffsetTimestamp=null!==(y=n.ts_message_offset)&&void 0!==y?y:0,i.messageSurvivalSeconds=null!==(k=n.message_survival_seconds)&&void 0!==k?k:-1,i.lastMessage=n.last_message?$i(i._iid,Object.assign({channel_type:i.channelType},n.last_message)):null,n.read_receipt&&Object.keys(n.read_receipt).forEach((function(e){L("number",n.read_receipt[e])&&i._updateUnreadMemberState(e,n.read_receipt[e])})),n.delivery_receipt&&Object.keys(n.delivery_receipt).forEach((function(e){L("number",n.delivery_receipt[e])&&i._updateUndeliveredMemberState(e,n.delivery_receipt[e])})),i.myMemberState=R(e.MemberState,n.member_state)?n.member_state:e.MemberState.NONE,i.myRole=R(e.Role,n.my_role)?n.my_role:e.Role.NONE,R(e.MutedState,n.is_muted)?i.myMutedState=n.is_muted:L("boolean",n.is_muted)?i.myMutedState=n.is_muted?e.MutedState.MUTED:e.MutedState.UNMUTED:i.myMutedState=e.MutedState.UNMUTED,i.myCountPreference=R(e.CountPreference,n.count_preference)?n.count_preference:e.CountPreference.ALL,i.myPushTriggerOption=R(e.PushTriggerOption,n.push_trigger_option)?n.push_trigger_option:e.PushTriggerOption.ALL,i.myLastRead=null!==(E=n.user_last_read)&&void 0!==E?E:0,i.inviter=n.inviter?new si(i._iid,n.inviter):null,i.invitedAt=null!==(b=n.invited_at)&&void 0!==b?b:0,i.joinedAt=null!==(w=n.joined_ts)&&void 0!==w?w:0,i._updateUnreadCount(null!==(C=n.unread_message_count)&&void 0!==C?C:0,null!==(x=n.unread_mention_count)&&void 0!==x?x:0),i.pinnedMessageIds=null!==(T=n.pinned_message_ids)&&void 0!==T?T:[],i.lastPinnedMessage=n.latest_pinned_message?$i(i._iid,Object.assign({channel_type:i.channelType},n.latest_pinned_message)):null,i}return i(u,[{key:"isHidden",get:function(){return this.hiddenState!==e.HiddenState.UNHIDDEN}},{key:"isTyping",get:function(){return this._typingStatus.size>0}},{key:"cachedUnreadMemberState",get:function(){var e,t={},n=y(this._unreadMemberStateMap);try{for(n.s();!(e=n.n()).done;){var r=v(e.value,2),a=r[0],i=r[1];t[a]=i}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"cachedUndeliveredMemberState",get:function(){var e,t={},n=y(this._undeliveredMemberStateMap);try{for(n.s();!(e=n.n()).done;){var r=v(e.value,2),a=r[0],i=r[1];t[a]=i}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"_shouldUpdateLastMessageWith",value:function(e){return!(e instanceof Fi&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)}},{key:"_updateUnreadCount",value:function(t,n){if("number"==typeof t&&t>=0)if(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var r=Ei.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=r&&t>=r?r:t}else this.unreadMessageCount=t;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof n&&n>=0&&(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=n:this.unreadMentionCount=0}},{key:"_updateUnreadMemberState",value:function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),Ei.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)}},{key:"_updateUndeliveredMemberState",value:function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)}},{key:"_updateTypingStatus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime();t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)}},{key:"_clearTypingStatus",value:function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0}},{key:"_setLatestMemberCount",value:function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r}},{key:"isReadMessage",value:function(e){var t=Ei.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return!!n&&n>=e.createdAt}},{key:"serialize",value:function(){var e=this;return ni(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))}},{key:"createMessageCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new bp(this._iid,Object.assign(Object.assign({},e),{channel:this}))}},{key:"createMemberListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Np(this._iid,this.url,e)}},{key:"createPinnedMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new av(this._iid,this.url,this.channelType,e)}},{key:"addMember",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=this.members.findIndex((function(e){return e.userId===t.userId}));if(r>-1){var a=this.members[r];a.state===e.MemberState.JOINED&&(t.state=a.state),this.members.splice(r,1),this.memberCount--}this.members.push(t),this.memberCount++,this._updateUnreadMemberState(t.userId,n),this._updateUndeliveredMemberState(t.userId,n)}}},{key:"removeMember",value:function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof kh?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1}},{key:"getUnreadMemberCount",value:function(t){if(t instanceof Fi&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n,r=Ei.of(this._iid).sdkState,a=t.createdAt,i=0,s=y(this.members);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(r.userId!==o.userId&&o.state===e.MemberState.JOINED&&t.sender.userId!==o.userId)(this.cachedUnreadMemberState[o.userId]||0)<a&&i++}}catch(e){s.e(e)}finally{s.f()}return i}return 0}},{key:"getUndeliveredMemberCount",value:function(t){if(t instanceof Fi&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n,r=Ei.of(this._iid).sdkState,a=t.createdAt,i=0,s=y(this.members);try{for(s.s();!(n=s.n()).done;){var o=n.value;if(r.userId!==o.userId&&o.state===e.MemberState.JOINED&&t.sender.userId!==o.userId)(this.cachedUndeliveredMemberState[o.userId]||0)<a&&i++}}catch(e){s.e(e)}finally{s.f()}return i}return 0}},{key:"getReadMembers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ei.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var a=e instanceof Fi?e.sender:null,i=[];return this.members.forEach((function(s){if(n||s.userId!==r.userId&&s.userId!==(null==a?void 0:a.userId)){var o=t._unreadMemberStateMap.get(s.userId);o&&o>=e.createdAt&&i.push(s)}})),i}},{key:"getUnreadMembers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ei.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var a=e instanceof Fi?e.sender:null,i=[];return this.members.forEach((function(s){if(n||s.userId!==r.userId&&s.userId!==(null==a?void 0:a.userId)){var o=t._unreadMemberStateMap.get(s.userId);o&&o<e.createdAt&&i.push(s)}})),i}},{key:"getReadStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Ei.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(a){if(t||a.userId!==n.userId){var i=e._unreadMemberStateMap.get(a.userId);r[a.userId]=new Eh(e._iid,{channel_url:e.url,channel_type:e.channelType,user:kh.payloadify(a),ts:null!=i?i:0})}})),r}},{key:"getTypingUsers",value:function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e}},{key:"invalidateTypingStatus",value:function(){var e=this,t=Ei.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),r=!1;return this._typingStatus.forEach((function(a,i){var s=a.ts;n-s>=t&&(e._typingStatus.delete(i),r=!0)})),r}},{key:"refresh",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._refresh());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"_refresh",value:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Ei.of(this._iid),i=a.requestQueue,s=a.dispatcher,o=new Kh({channelUrl:this.url}),t.next=4,i.send(o);case 4:return u=t.sent,c=u.as(Wh),l=c.channel,this._update(l),n&&s.dispatch(new jh({channels:[l],source:e.CollectionEventSource.REQUEST_CHANNEL})),t.abrupt("return",this);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"freeze",value:function(){var n=this,r=Object.create(null,{freeze:{get:function(){return p(o(u.prototype),"freeze",n)}}});return E(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.freeze.call(this);case 2:a=Ei.of(this._iid),a.dispatcher.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_FROZEN,isWebSocketEventComing:!0}));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"unfreeze",value:function(){var n=this,r=Object.create(null,{unfreeze:{get:function(){return p(o(u.prototype),"unfreeze",n)}}});return E(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.unfreeze.call(this);case 2:a=Ei.of(this._iid),a.dispatcher.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_UNFROZEN,isWebSocketEventComing:!0}));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"updateChannel",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},wp),n),ai(Cp(a)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.dispatcher,o=i.requestQueue,u=new Op(Object.assign({channelUrl:this.url},a)),t.next=6,o.send(u);case 6:return c=t.sent,l=c.as(Up),d=l.channel,this._update(d),s.dispatch(new jh({channels:[d],source:e.CollectionEventSource.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),t.abrupt("return",this);case 11:case"end":return t.stop()}}),r,this)})))}},{key:"invite",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(e.every((function(e){return e instanceof si}))).throw(M.invalidParameters),t.abrupt("return",this.inviteWithUserIds(e.map((function(e){return e.userId}))));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"inviteWithUserIds",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(F("string",n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.dispatcher,s=a.requestQueue,o=new yf({channelUrl:this.url,userIds:n}),t.next=5,s.send(o);case 5:return u=t.sent,c=u.as(kf),l=c.channel,this._update(l),i.dispatch(new jh({channels:[l],source:e.CollectionEventSource.EVENT_CHANNEL_INVITED,isWebSocketEventComing:!0})),t.abrupt("return",this);case 10:case"end":return t.stop()}}),r,this)})))}},{key:"join",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",n,!0)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.dispatcher,s=a.sdkState,o=a.requestQueue,u=new pf({channelUrl:this.url,userId:s.userId,accessCode:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(vf),(d=l.channel).myMemberState=this.myMemberState=e.MemberState.JOINED,this._update(d),i.dispatch(new jh({channels:[d],source:e.CollectionEventSource.EVENT_CHANNEL_JOINED,isWebSocketEventComing:!0})),t.abrupt("return",this);case 11:case"end":return t.stop()}}),r,this)})))}},{key:"leave",value:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Ei.of(this._iid),i=a.sdkState,s=a.requestQueue,o=new mf({channelUrl:this.url,userId:i.userId,shouldRemoveOperatorStatus:n}),t.next=4,s.send(o);case 4:this.myMemberState=e.MemberState.NONE;case 5:case"end":return t.stop()}}),r,this)})))}},{key:"acceptInvitation",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",n,!0)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.dispatcher,s=a.sdkState,o=a.requestQueue,u=new Ap({channelUrl:this.url,userId:s.userId,accessCode:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Mp),(d=l.channel).myMemberState=this.myMemberState=e.MemberState.JOINED,this._update(d),i.dispatch(new jh({channels:[d],source:e.CollectionEventSource.EVENT_CHANNEL_ACCEPTED_INVITE,isWebSocketEventComing:!0})),t.abrupt("return",this);case 11:case"end":return t.stop()}}),r,this)})))}},{key:"declineInvitation",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.sdkState,i=r.requestQueue,s=new bf({channelUrl:this.url,userId:a.userId}),t.next=4,i.send(s);case 4:return this.myMemberState=e.MemberState.NONE,t.abrupt("return",this);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"sendUserMessage",value:function(t){var n=this,r=new Ls,a=Ei.of(this._iid).dispatcher,i=od.of(this._iid);return p(o(u.prototype),"sendUserMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){t&&i.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(t){n.hiddenState===e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE&&(n.hiddenState=e.HiddenState.UNHIDDEN),i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),Zf.of(n._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),a.dispatch(new jh({channels:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT})),r._trigger(t)})),r}},{key:"updateUserMessage",value:function(n,r){var a=this,i=Object.create(null,{updateUserMessage:{get:function(){return p(o(u.prototype),"updateUserMessage",a)}}});return E(this,void 0,void 0,t().mark((function a(){var s,o,u,c,l,d=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Ei.of(this._iid),o=s.dispatcher,t.next=3,i.updateUserMessage.call(this,n,r);case 3:return u=t.sent,c=!1,!u.silent&&this._shouldUpdateLastMessageWith(u)&&(this.lastMessage=u,c=!0),l=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===u.messageId&&(this.lastPinnedMessage=u,c=!0,l=!0),c&&(Zf.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(d)})),o.dispatch(new jh({channels:[this],source:l?e.CollectionEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.CollectionEventSource.EVENT_MESSAGE_UPDATED}))),l&&Zf.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(d)})),o.dispatch(new ms({messages:[u],source:e.CollectionEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",u);case 12:case"end":return t.stop()}}),a,this)})))}},{key:"_autoResendUserMessage",value:function(t){var n=this,r=new Ls,a=Ei.of(this._iid).dispatcher,i=od.of(this._iid);return p(o(u.prototype),"_autoResendUserMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){i.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(t){var s=Zf.of(n._iid);i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),s.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),a.dispatch(new jh({channels:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT})),r._trigger(t)})),r}},{key:"sendFileMessage",value:function(t){var n=this,r=new Ls,a=Ei.of(this._iid).dispatcher,i=od.of(this._iid);return p(o(u.prototype),"sendFileMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){t&&i.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(t){var s=Zf.of(n._iid);i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),s.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),a.dispatch(new jh({channels:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT})),r._trigger(t)})),r}},{key:"sendMultipleFilesMessage",value:function(t){var n=this,r=new nc,a=Ei.of(this._iid).dispatcher;return p(o(u.prototype),"sendMultipleFilesMessage",this).call(this,t).onPending((function(e){r._trigger(e)})).onFailed((function(e,t){r._triggerFailed(e,t)})).onSucceeded((function(t){var i=Zf.of(n._iid);n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),i.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),a.dispatch(new jh({channels:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT})),r._trigger(t)})).onFileUploaded((function(e,t,n,a){r._triggerOnFileUploaded(e,t,n,a)})),r}},{key:"updateFileMessage",value:function(n,r){var a=this,i=Object.create(null,{updateFileMessage:{get:function(){return p(o(u.prototype),"updateFileMessage",a)}}});return E(this,void 0,void 0,t().mark((function a(){var s,o,u,c,l,d=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Ei.of(this._iid),o=s.dispatcher,t.next=3,i.updateFileMessage.call(this,n,r);case 3:return u=t.sent,c=!1,!u.silent&&this._shouldUpdateLastMessageWith(u)&&(this.lastMessage=u,c=!0),l=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===u.messageId&&(this.lastPinnedMessage=u,c=!0,l=!0),c&&(Zf.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(d)})),o.dispatch(new jh({channels:[this],source:l?e.CollectionEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.CollectionEventSource.EVENT_MESSAGE_UPDATED}))),l&&Zf.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(d)})),o.dispatch(new ms({messages:[u],source:e.CollectionEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",u);case 12:case"end":return t.stop()}}),a,this)})))}},{key:"_autoResendFileMessage",value:function(t){var n=this,r=new Ls,a=Ei.of(this._iid).dispatcher,i=od.of(this._iid);return p(o(u.prototype),"_autoResendFileMessage",this).call(this,t).onPending((function(e){i.completeCurrentAndProcessNextAutoResend(e),r._trigger(e)})).onFailed((function(e,t){i.completeCurrentAndProcessNextAutoResend(t),r._triggerFailed(e,t)})).onSucceeded((function(t){var s=Zf.of(n._iid);i.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),s.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(n)})),a.dispatch(new jh({channels:[n],source:e.CollectionEventSource.EVENT_MESSAGE_SENT})),r._trigger(t)})),r}},{key:"deleteMessage",value:function(n){var r=this,a=Object.create(null,{deleteMessage:{get:function(){return p(o(u.prototype),"deleteMessage",r)}}});return E(this,void 0,void 0,t().mark((function r(){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.deleteMessage.call(this,n);case 2:0===n.messageId&&n instanceof Fi&&(i=Ei.of(this._iid),i.dispatcher.dispatch(new ys({reqId:n.reqId,source:e.CollectionEventSource.EVENT_MESSAGE_DELETED})));case 3:case"end":return t.stop()}}),r,this)})))}},{key:"hide",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Cf),n),ai(xf(a)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.dispatcher,o=i.sdkState,u=i.requestQueue,c=new Tf(Object.assign({channelUrl:this.url,userId:o.userId},a)),t.next=6,u.send(c);case 6:return l=t.sent,d=l.as(Sf),h=d.messageOffsetTimestamp,this.hiddenState=a.allowAutoUnhide?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,a.hidePreviousMessages&&this._updateUnreadCount(0,0),h&&(this.messageOffsetTimestamp=h),s.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_HIDDEN,isWebSocketEventComing:!0})),t.abrupt("return",this);case 13:case"end":return t.stop()}}),r,this)})))}},{key:"unhide",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.dispatcher,i=r.requestQueue,s=new Lp({channelUrl:this.url}),t.next=4,i.send(s);case 4:return this.hiddenState=e.HiddenState.UNHIDDEN,a.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_UNHIDDEN,isWebSocketEventComing:!0})),t.abrupt("return",this);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"delete",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Dp({channelUrl:this.url}),e.next=4,r.send(a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"markAsRead",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.sdkState,i=r.dispatcher,s=r.requestQueue,o=new Gf({channelUrl:this.url}),t.next=4,s.send(o);case 4:u=t.sent,c=u.as(jf),l=c.readStatus,this._updateUnreadMemberState(a.userId,l.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),Zf.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(d)}))),i.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_READ}));case 9:case"end":return t.stop()}}),n,this)})))}},{key:"markAsDelivered",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new zf({channelUrl:this.url,userId:r.userId}),e.next=4,a.send(i);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"startTyping",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ei.of(this._iid),r=n.requestQueue,a=n.typingIndicatorThrottle,(i=(new Date).getTime())-this._typingStarted>=a&&(this._typingStarted=i,this._typingEnded=0,s=new Nf({channelUrl:this.url,time:this._typingStarted}),r.send(s));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"endTyping",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ei.of(this._iid),r=n.requestQueue,a=n.typingIndicatorThrottle,(i=(new Date).getTime())-this._typingEnded>=a&&(this._typingStarted=0,this._typingEnded=i,s=new Mf({channelUrl:this.url,time:this._typingStarted}),r.send(s));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"createScheduledUserMessage",value:function(e){e=Object.assign(Object.assign({},xl),e),ai(function(e){return Gs(e)&&L("number",e.scheduledAt,!0)}(e)).throw(M.invalidParameters);var t=new Ls;return this._createScheduledUserMessage(e,t),t}},{key:"updateScheduledUserMessage",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},jp),n),ai(zp(a)).throw(M.invalidParameters),i=Ei.of(this._iid),s=i.requestQueue,o=new Qp(Object.assign({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},a)),t.next=6,s.send(o);case 6:return u=t.sent,c=u.as(fu),l=c.message,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"createScheduledFileMessage",value:function(e){var n=this;e=Object.assign(Object.assign({},Tl),e),ai(function(e){return Ps(e)&&L("number",e.scheduledAt)&&(q(e.file)||L("string",e.fileUrl))&&L("string",e.fileName,!0)&&L("string",e.mimeType,!0)&&L("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return L("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(e)).throw(M.invalidParameters);var r=Date.now(),a=this._generateRequestId(),i=new Ls;return Sa(2).then((function(){var s=n._createPendingScheduledFileMessage(e,a,r);Aa((function(){return E(n,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._trigger(s));case 1:case"end":return e.stop()}}),e)})))}))})),q(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return n._createScheduledFileMessage(e,i,a,r)})):this._createScheduledFileMessage(e,i,a,r),i}},{key:"updateScheduledFileMessage",value:function(e,n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object.assign(Object.assign({},qp),n),ai(Gp(a)).throw(M.invalidParameters),!q(a.file)){t.next=5;break}return t.next=5,this._uploadFileAndUpdateParams(a);case 5:return i=new Vp(Object.assign({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},a)),s=Ei.of(this._iid),o=s.requestQueue,t.next=9,o.send(i);case 9:return u=t.sent,c=u.as(Bp),l=c.message,t.abrupt("return",l);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"cancelScheduledMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Kp({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),a=Ei.of(this._iid),i=a.requestQueue,t.next=4,i.send(r);case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),n,this)})))}},{key:"sendScheduledMessageNow",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Wp({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),a=Ei.of(this._iid),i=a.requestQueue,t.next=4,i.send(r);case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getMyPushTriggerOption",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.sdkState,a=n.requestQueue,i=new Jp({userId:r.userId,channelUrl:this.url}),e.next=4,a.send(i);case 4:return s=e.sent,o=s.as(Xp),u=o.pushTriggerOption,this.myPushTriggerOption=u,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"setMyPushTriggerOption",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(R(e.PushTriggerOption,n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.dispatcher,s=a.sdkState,o=a.requestQueue,u=new Yp({userId:s.userId,channelUrl:this.url,pushTriggerOption:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Zp),d=l.pushTriggerOption,this.myPushTriggerOption=d,i.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),t.abrupt("return",d);case 10:case"end":return t.stop()}}),r,this)})))}},{key:"setMyCountPreference",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(R(e.CountPreference,n)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.dispatcher,s=a.sdkState,o=a.requestQueue,u=new Rp({channelUrl:this.url,userId:s.userId,countPreference:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Pp),d=l.countPreference,this.myCountPreference=d,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),i.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),t.abrupt("return",d);case 11:case"end":return t.stop()}}),r,this)})))}},{key:"resetMyHistory",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Ei.of(this._iid),a=r.dispatcher,i=r.requestQueue,s=new Fp({channelUrl:this.url}),t.next=4,i.send(s);case 4:return o=t.sent,u=o.as(Hp),c=u.messageOffsetTimestamp,this.messageOffsetTimestamp=c,this.lastMessage&&this.lastMessage.createdAt<c&&(this.lastMessage=null),a.dispatch(new jh({channels:[this],source:e.CollectionEventSource.EVENT_CHANNEL_RESET_HISTORY,isWebSocketEventComing:!0})),t.abrupt("return",this);case 10:case"end":return t.stop()}}),n,this)})))}},{key:"pinMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("number",e)&&e>0).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new $p({channelType:this.channelType,channelUrl:this.url,messageId:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"unpinMessage",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("number",e)&&e>0).throw(M.invalidParameters),r=Ei.of(this._iid),a=r.requestQueue,i=new ev({channelType:this.channelType,channelUrl:this.url,messageId:e}),t.next=5,a.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"_uploadFileAndUpdateParams",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,d,h,f,p;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!q(e.file)){t.next=11;break}return r=Ei.of(this._iid),a=r.requestQueue,i=new wi({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),t.next=5,a.send(i);case 5:s=t.sent,o=s.as(Ci),u=o.url,c=o.fileSize,l=void 0===c?e.fileSize:c,d=o.thumbnailSizes,h=void 0===d?e.thumbnailSizes:d,f=o.requireAuth,p=void 0!==f&&f,e.fileUrl=u,e.fileSize=l,e.thumbnailSizes=h,e.requireAuth=p;case 11:case"end":return t.stop()}}),n,this)})))}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},p(o(u),"payloadify",this).call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return kh.payloadify(e)})),last_message:e.lastMessage?Xi(e.lastMessage):null,inviter:e.inviter?si.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,pinned_message_ids:e.pinnedMessageIds,latest_pinned_message:e.lastPinnedMessage?Xi(e.lastPinnedMessage):null})))}}]),u}(rc),ov={},uv=function(){function n(a){var i=this,s=a._iid,o=a.limit,u=void 0===o?100:o;r(this,n),this.ref=0,this._iid=s,this._limit=u;var c,l=Ei.of(this._iid),d=l.sdkState,h=l.dispatcher,f=l.logger,p=l.cacheContext;this._metadataKey=(c=d.userId,"sendbird:".concat(c,"@groupchannel/sync.meta"));var v=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(d.userId);this._sync=new Jf(v,(function(){return E(i,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l,h,v,m,g;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={hasNext:!0,nextToken:""},t.next=3,this.loadMetadata();case 3:if(f.debug("channel background sync from",null===(r=this._metadata)||void 0===r?void 0:r.token),null===(a=this._metadata)||void 0===a?void 0:a.completed){t.next=41;break}if(t.prev=5,(u={includeEmpty:!0,order:e.GroupChannelListOrder.CHRONOLOGICAL}).order!==e.GroupChannelListOrder.LATEST_LAST_MESSAGE){t.next=18;break}return t.prev=8,t.next=11,p.preference.get(Ba(d.appId));case 11:c=t.sent,u.includeChatNotification=Boolean(c),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(8),u.includeChatNotification=!1;case 18:return l=Zf.of(this._iid),t.next=21,l.getMyGroupChannels(null!==(s=null===(i=this._metadata)||void 0===i?void 0:i.token)&&void 0!==s?s:"",u,this._limit,e.CollectionEventSource.SYNC_CHANNEL_BACKGROUND);case 21:return h=t.sent,v=h.channels,m=h.token,o.hasNext=v.length>=this._limit&&!!m,o.nextToken=m,this._metadata&&(this._metadata.token=m,(g=this._metadata.range).extends.apply(g,_(v.map((function(e){return e.createdAt})))),this._metadata.completed=!o.hasNext),f.debug("channel background sync progress",o),t.next=30,this.saveMetadata();case 30:t.next=39;break;case 32:if(t.prev=32,t.t1=t.catch(5),f.debug("channel background sync error",t.t1),!(t.t1 instanceof M&&t.t1.isInvalidTokenError)){t.next=38;break}return t.next=38,this.clearMetaData();case 38:throw t.t1;case 39:t.next=43;break;case 41:o.hasNext=!1,o.nextToken="";case 43:return t.abrupt("return",o);case 44:case"end":return t.stop()}}),n,this,[[5,32],[8,15]])})))})),this._connectionEventContext=h.on((function(e){if(e instanceof ga)if(e.stateType===da.CONNECTED)i.resume();else i.pause()}))}return i(n,[{key:"range",get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new Pf({})}},{key:"completed",get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)}},{key:"loadMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata={token:a?a.token:"",range:new Pf(a?a.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!a&&a.completed};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetaData",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=void 0;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e,t,n=Ei.of(this._iid),r=n.logger;n.connectionManager.isConnected&&(r.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:""))}},{key:"pause",value:function(){Ei.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ov[this._iid])}}],[{key:"of",value:function(e){return ov[e]||(ov[e]=new n({_iid:e})),ov[e].ref++,ov[e]}},{key:"clear",value:function(e){ov[e]&&(ov[e].close(),delete ov[e])}}]),n}(),cv={},lv=function(){function n(a){var i=this,s=a._iid;r(this,n),this.ref=0,this._iid=s;var o,u=Ei.of(this._iid),c=u.logger,l=u.sdkState,d=u.dispatcher,h=u.cacheContext;this._metadataKey=(o=l.userId,"sendbird:".concat(o,"@groupchannel/changelogs.meta"));var f=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(l.userId);this._sync=new Jf(f,(function(){return E(i,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,d,f,p,v;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return c.debug("channel changelog sync from",null===(r=this._metadata)||void 0===r?void 0:r.token),t.prev=4,o={includeEmpty:!0},t.prev=6,t.next=9,h.preference.get(Ba(l.appId));case 9:u=t.sent,o.includeChatNotification=Boolean(u),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(6),o.includeChatNotification=!1;case 16:return d=Zf.of(this._iid),t.next=19,d.getMyGroupChannelChangeLogs(null!==(i=null===(a=this._metadata)||void 0===a?void 0:a.token)&&void 0!==i?i:"",o,e.CollectionEventSource.SYNC_CHANNEL_CHANGELOGS);case 19:return f=t.sent,p=f.hasMore,v=f.token,s.hasNext=p,s.nextToken=v,this._metadata&&(this._metadata.token=v),c.debug("channel changelog sync progress",s),t.next=28,this.saveMetadata();case 28:t.next=37;break;case 30:if(t.prev=30,t.t1=t.catch(4),c.debug("channel changelog sync error",t.t1),!(t.t1 instanceof M&&t.t1.isInvalidTokenError)){t.next=36;break}return t.next=36,this.clearMetadata();case 36:throw t.t1;case 37:return t.abrupt("return",s);case 38:case"end":return t.stop()}}),n,this,[[4,30],[6,13]])})))})),this._connectionEventContext=d.on((function(e){if(e instanceof ga)if(e.stateType===da.CONNECTED)i.resume();else i.pause()}))}return i(n,[{key:"loadMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=Ei.of(this._iid),r=n.cacheContext,a=n.firstConnectedAt,e.next=4,r.preference.get(this._metadataKey);case 4:i=e.sent,this._metadata={token:i?i.token:a};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=Ei.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=void 0;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){Ei.of(this._iid).connectionManager.isConnected&&this._sync.start(0)}},{key:"pause",value:function(){this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete cv[this._iid])}}],[{key:"of",value:function(e){return cv[e]||(cv[e]=new n({_iid:e})),cv[e].ref++,cv[e]}},{key:"clear",value:function(e){cv[e]&&(cv[e].close(),delete cv[e])}}]),n}(),dv=function(t,n){var r,a,i,s;switch(n){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return null!==(a=null===(r=t.lastMessage)||void 0===r?void 0:r.createdAt)&&void 0!==a?a:t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return t.name;default:return null!==(s=null===(i=t.lastMessage)||void 0===i?void 0:i.createdAt)&&void 0!==s?s:t.createdAt}},hv=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},fv=function(e,t,n){if(e.length>0){for(var r=hv(e,t),a=0,i=e.length-1,s=Math.floor((a+i)/2);a<i;){var o=pv(e[s],t,n);if(o>0)i=s,s=Math.floor((a+i)/2);else{if(!(o<0))return{place:s,oldPosition:r};a=s+1,s=Math.floor((a+i)/2)}}return{place:pv(e[s],t,n)>=0?s:s+1,oldPosition:r}}return{place:e.length,oldPosition:-1}},pv=function(t,n,r){switch(r){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return t.lastMessage&&n.lastMessage?n.lastMessage.createdAt-t.lastMessage.createdAt:t.lastMessage?-1:n.lastMessage?1:n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:var a=t.name.localeCompare(n.name);return 0===a?t.createdAt-n.createdAt:a;default:return 0}},vv=function(){function n(a,i){var s=this,o=i.filter,u=i.order,c=i.limit;r(this,n),this.channels=[],this._iid=a,this._key="gcc-".concat(ae()),this._isDisposed=!1,this._isGetRemoteChannelsSucceeded=!0,this.filter=null!=o?o:new wh,this.order=null!=u?u:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=c?c:100;var l=Ei.of(this._iid),d=l.sdkState,h=l.cacheContext,f=l.dispatcher;h.localCacheEnabled&&(this._backgroundSync=uv.of(a),this._backgroundSync.resume()),this._changelogSync=lv.of(a),this._changelogSync.resume(),Zf.of(this._iid).subscribeChannelEvent(this._key,{onUpdate:function(e,t){if(Gh(t)){var n=e.filter((function(e){return s.filter.match(e,d.userId)})),r=e.filter((function(e){return!s.filter.match(e,d.userId)})).map((function(e){return e.url}));n.length>0&&s._addChannelsToView(n,t),r.length>0&&s._removeChannelsFromView(r,t)}},onRemove:function(e,t){s._removeChannelsFromView(e,t)}}),Ei.of(this._iid).statLogCollector.put(new fi({type:Oe.FEATURE_LOCALCACHE,data:{use_local_cache:h.localCacheEnabled,collection_interface:{group_channel:!0}}})),f.on((function(e){e instanceof ga&&(e.stateType===da.CONNECTED?s._isGetRemoteChannelsSucceeded||E(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._revokeLoadMore();case 2:case"end":return e.stop()}}),e,this)}))):e.stateType===da.LOGOUT&&s.dispose())}))}return i(n,[{key:"hasMore",get:function(){return!this._isDisposed&&this._hasMore}},{key:"setGroupChannelCollectionHandler",value:function(e){this._handler=e}},{key:"_addChannelsToView",value:function(n,r){var a,i=this,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[],u=[],c=[],l=y(n);try{for(l.s();!(a=l.n()).done;){var d=a.value,h=hv(this.channels,d);h>=0&&this.channels.splice(h,1);var f=fv(this.channels,d,this.order).place;if(h<0)f===this.channels.length?!s&&this._hasMore||(o.push(d),this.channels.push(d)):(o.push(d),this.channels.splice(f,0,d));else switch(r){case e.CollectionEventSource.EVENT_CHANNEL_UPDATED:case e.CollectionEventSource.EVENT_MESSAGE_RECEIVED:case e.CollectionEventSource.SYNC_CHANNEL_CHANGELOGS:case e.CollectionEventSource.EVENT_MESSAGE_SENT:f!==h&&this._hasMore&&f===this.channels.length?c.push(d):(this.channels.splice(f,0,d),u.push(d));break;default:this.channels.splice(f,0,d),u.push(d)}}}catch(e){l.e(e)}finally{l.f()}if(c.length>0){var p,v=y(c);try{for(v.s();!(p=v.n()).done;){var _=p.value,m=hv(this.channels,_);-1!==m&&this.channels.splice(m,1)}}catch(e){v.e(e)}finally{v.f()}}Gh(r)&&Aa((function(){return E(i,void 0,void 0,t().mark((function e(){var n,a,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new dp(r),o.length>0&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelsAdded)&&this._handler.onChannelsAdded(s,o),u.length>0&&(null===(a=this._handler)||void 0===a?void 0:a.onChannelsUpdated)&&this._handler.onChannelsUpdated(s,u),c.length>0&&(null===(i=this._handler)||void 0===i?void 0:i.onChannelsDeleted)&&this._handler.onChannelsDeleted(s,c.map((function(e){return e.url})));case 4:case"end":return e.stop()}}),e,this)})))}))}},{key:"_removeChannelsFromView",value:function(e,n){var r,a=this,i=[],s=y(e);try{var o=function(){var e=r.value,t=a.channels.findIndex((function(t){return t.url===e}));t>=0&&(i.push(a.channels[t].url),a.channels.splice(t,1))};for(s.s();!(r=s.n()).done;)o()}catch(e){s.e(e)}finally{s.f()}return Gh(n)&&i.length>0&&Aa((function(){return E(a,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new dp(n),(null===(r=this._handler)||void 0===r?void 0:r.onChannelsDeleted)&&this._handler.onChannelsDeleted(a,i);case 2:case"end":return e.stop()}}),e,this)})))})),i}},{key:"_getLocalChannels",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Zf.of(this._iid),r=this.channels.length>0?dv(this.channels[this.channels.length-1],this.order):null,e.next=4,n.getChannelsFromCache(r,this.filter,this.order,this._limit,r?this.channels[this.channels.length-1].url:void 0);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRemoteChannels",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Zf.of(this._iid),e.next=3,n.getMyGroupChannels(this._token,le(Object.assign(Object.assign({},this.filter),{order:this.order})),this._limit);case 3:return r=e.sent,a=r.channels,i=r.token,this._token=i,this._hasMore=!!i,e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"_revokeLoadMore",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isDisposed){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this._getRemoteChannels();case 5:r=t.sent,this._isGetRemoteChannelsSucceeded=!0,this._addChannelsToView(r,e.CollectionEventSource.REQUEST_CHANNEL,!0),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),this._isGetRemoteChannelsSucceeded=!1;case 13:case"end":return t.stop()}}),n,this,[[2,10]])})))}},{key:"loadMore",value:function(){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._isDisposed){n.next=2;break}throw new M({code:b.COLLECTION_DISPOSED,message:"Collection has been disposed."});case 2:if(!this._hasMore){n.next=23;break}if(r=Ei.of(this._iid),a=r.cacheContext,i=r.connectionManager,s=[],!a.localCacheEnabled||i.isConnected&&!this._backgroundSync.completed){n.next=11;break}return n.next=8,Ma((function(){return E(o,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getLocalChannels();case 2:s=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}));case 8:this._hasMore=s.length>=this._limit,n.next=21;break;case 11:return n.prev=11,n.next=14,this._getRemoteChannels();case 14:s=n.sent,this._isGetRemoteChannelsSucceeded=!0,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),this._isGetRemoteChannelsSucceeded=!1;case 21:return this._addChannelsToView(s,e.CollectionEventSource.REQUEST_CHANNEL,!0),n.abrupt("return",s);case 23:return n.abrupt("return",[]);case 24:case"end":return n.stop()}}),n,this,[[11,18]])})))}},{key:"dispose",value:function(){var e,t;this._isDisposed||(this._isDisposed=!0,this.channels.length>0&&this.channels.splice(0,this.channels.length),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),Zf.of(this._iid).unsubscribeChannelEvent(this._key))}}]),n}(),_v=function(t){s(a,t);var n=f(a);function a(t){var i;r(this,a);var s=t.token,o=t.limit,u=t.order,c=t.includeEmpty,l=t.membershipFilter,d=t.channelNameContainsFilter,h=t.channelUrlsFilter,f=t.customTypesFilter,p=t.customTypeStartsWithFilter,v=t.superChannelFilter,_=t.metadataOrderKeyFilter,m=t.metadataKey,g=t.metadataValues,y=t.metadataValueStartsWith,k=t.includeFrozen,E=t.includeMetaData;return(i=n.call(this)).method=de.GET,i.path=ve,i.params=ce(le({token:s,limit:o,order:u,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:c,public_mode:e.PublicChannelFilter.PUBLIC,public_membership_mode:l,name_contains:d,channel_urls:h,custom_types:f,custom_type_startswith:p,super_mode:v,metadata_order_key:_,metadata_key:m,metadata_values:g,metadata_value_startswith:y,show_frozen:k,show_metadata:E})),i}return i(a)}(Ue),mv=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).channels=[];var s=a.next,o=a.channels,u=a.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map((function(t){return t.ts=u,new sv(e,t)}))),i.ts="number"==typeof u?u:0,i}return i(n)}(De);e.MembershipFilter=void 0,(iv=e.MembershipFilter||(e.MembershipFilter={})).ALL="all",iv.JOINED="joined";var gv,yv=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d,h,f,p,v,_,m,g,y,k;return r(this,u),(i=a.call(this,t,n)).includeEmpty=!1,i.includeFrozen=!0,i.includeMetaData=!0,i.channelUrlsFilter=null,i.customTypesFilter=null,i.customTypeStartsWithFilter=null,i.channelNameContainsFilter=null,i.membershipFilter=e.MembershipFilter.ALL,i.superChannelFilter=e.SuperChannelFilter.ALL,i.metadataKey=null,i.metadataValues=null,i.metadataOrderKeyFilter=null,i.metadataValueStartsWith=null,i.order=e.PublicGroupChannelListOrder.CHRONOLOGICAL,i.includeEmpty=null!==(s=n.includeEmpty)&&void 0!==s&&s,i.includeFrozen=null===(o=n.includeFrozen)||void 0===o||o,i.includeMetaData=null===(c=n.includeMetaData)||void 0===c||c,i.channelUrlsFilter=null!==(l=n.channelUrlsFilter)&&void 0!==l?l:null,i.customTypesFilter=null!==(d=n.customTypesFilter)&&void 0!==d?d:null,i.customTypeStartsWithFilter=null!==(h=n.customTypeStartsWithFilter)&&void 0!==h?h:null,i.channelNameContainsFilter=null!==(f=n.channelNameContainsFilter)&&void 0!==f?f:null,i.membershipFilter=null!==(p=n.membershipFilter)&&void 0!==p?p:e.MembershipFilter.ALL,i.superChannelFilter=null!==(v=n.superChannelFilter)&&void 0!==v?v:e.SuperChannelFilter.ALL,i.metadataKey=null!==(_=n.metadataKey)&&void 0!==_?_:null,i.metadataValues=null!==(m=n.metadataValues)&&void 0!==m?m:null,i.metadataOrderKeyFilter=null!==(g=n.metadataOrderKeyFilter)&&void 0!==g?g:null,i.metadataValueStartsWith=null!==(y=n.metadataValueStartsWith)&&void 0!==y?y:null,i.order=null!==(k=n.order)&&void 0!==k?k:e.PublicGroupChannelListOrder.CHRONOLOGICAL,i}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)&&L("boolean",this.includeEmpty)&&L("boolean",this.includeFrozen)&&L("boolean",this.includeMetaData)&&L("string",this.channelNameContainsFilter,!0)&&F("string",this.channelUrlsFilter,!0)&&F("string",this.customTypesFilter,!0)&&L("string",this.customTypeStartsWithFilter,!0)&&R(e.MembershipFilter,this.membershipFilter)&&R(e.SuperChannelFilter,this.superChannelFilter)&&R(e.PublicGroupChannelListOrder,this.order)&&L("string",this.metadataOrderKeyFilter,!0)&&L("string",this.metadataKey,!0)&&F("string",this.metadataValues,!0)&&L("string",this.metadataValueStartsWith,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(n=[],!this._hasNext){e.next=15;break}return this._isLoading=!0,r=Ei.of(this._iid),a=r.requestQueue,r.dispatcher,i=new _v(le(Object.assign(Object.assign({},this),{token:this._token}))),e.next=9,a.send(i);case 9:return s=e.sent,o=s.as(mv),u=o.channels,c=o.token,this._token=c,this._hasNext=!!c,this._isLoading=!1,e.abrupt("return",u);case 15:return e.abrupt("return",n);case 18:throw M.queryInProgress;case 19:e.next=22;break;case 21:throw M.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),u}(to),kv=i((function e(){r(this,e),this.onUserMuted=Ke,this.onUserUnmuted=Ke,this.onUserBanned=Ke,this.onUserUnbanned=Ke,this.onChannelChanged=Ke,this.onChannelDeleted=Ke,this.onChannelFrozen=Ke,this.onChannelUnfrozen=Ke,this.onOperatorUpdated=Ke,this.onChannelMemberCountChanged=Ke,this.onMetaDataCreated=Ke,this.onMetaDataUpdated=Ke,this.onMetaDataDeleted=Ke,this.onMetaCounterCreated=Ke,this.onMetaCounterUpdated=Ke,this.onMetaCounterDeleted=Ke,this.onMessageReceived=Ke,this.onMessageUpdated=Ke,this.onMessageDeleted=Ke,this.onMentionReceived=Ke,this.onReactionUpdated=Ke,this.onThreadInfoUpdated=Ke})),Ev=function(e){s(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).onUserJoined=Ke,e.onUserLeft=Ke,e.onUserReceivedInvitation=Ke,e.onUserDeclinedInvitation=Ke,e.onChannelHidden=Ke,e.onUnreadMemberStatusUpdated=Ke,e.onUndeliveredMemberStatusUpdated=Ke,e.onTypingStatusUpdated=Ke,e.onPollUpdated=Ke,e.onPollVoted=Ke,e.onPollDeleted=Ke,e.onPinnedMessageUpdated=Ke,e}return i(n)}(kv),bv=function(e){s(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return i(n)}(Ev),wv=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.token,s=e.limit,o=e.order,u=e.reverse,c=e.channelUrl,l=e.messageTypeFilter,d=e.scheduledStatus;return(a=t.call(this)).method=de.GET,a.path="".concat(Ce),a.params=ce(le({token:i,limit:s,reverse:u,channel_url:c,order:o,message_type:l,status:d})),a}return i(n)}(Ue),Cv=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).scheduledMessages=[];var s=a.next,o=a.scheduled_messages;return i.token=s,i.scheduledMessages=o.map((function(t){return $i(e,t)})),i}return i(n)}(De),xv=function(n){s(u,n);var a=f(u);function u(t,n){var i,s,o,c,l,d;return r(this,u),(i=a.call(this,t,n)).channelUrl=null,i.order=null,i.reverse=!1,i.scheduledStatus=null,i.messageTypeFilter=e.MessageTypeFilter.ALL,i.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:null,i.order=null!==(o=n.order)&&void 0!==o?o:null,i.reverse=null!==(c=n.reverse)&&void 0!==c&&c,i.scheduledStatus=null!==(l=n.scheduledStatus)&&void 0!==l?l:null,i.messageTypeFilter=null!==(d=n.messageTypeFilter)&&void 0!==d?d:e.MessageTypeFilter.ALL,i}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)&&L("string",this.channelUrl,!0)&&(R(e.ScheduledMessageListOrder,this.order)||null===this.order)&&L("boolean",this.reverse)&&(F(e.ScheduledStatus,this.scheduledStatus)||null===this.scheduledStatus)&&R(e.MessageTypeFilter,this.messageTypeFilter)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new wv(le(Object.assign(Object.assign({},this),{token:this._token}))),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(Cv),o=s.scheduledMessages,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(to),Tv=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="groupChannel",e}return i(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;p(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Zf(e,{sdkState:n,cacheContext:l,dispatcher:r,sessionManager:i,requestQueue:s,logger:u})}},{key:"createGroupChannelCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new vv(this._iid,e)}},{key:"createMyGroupChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Lf(this._iid,e)}},{key:"createPublicGroupChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new yv(this._iid,e)}},{key:"createScheduledMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new xv(this._iid,e)}},{key:"addGroupChannelHandler",value:function(e,t){ai(L("string",e)&&t instanceof bv).throw(M.invalidParameters),this._manager.addHandler(e,t)}},{key:"removeGroupChannelHandler",value:function(e){ai(L("string",e)).throw(M.invalidParameters),this._manager.removeHandler(e)}},{key:"removeAllGroupChannelHandlers",value:function(){this._manager.clearHandler()}},{key:"buildGroupChannelFromSerializedData",value:function(e){return this._manager.buildGroupChannelFromSerializedData(e)}},{key:"buildGroupChannelListQueryFromSerializedData",value:function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)}},{key:"buildMemberFromSerializedData",value:function(e){return this._manager.buildMemberFromSerializedData(e)}},{key:"getChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),t.abrupt("return",this._manager.getChannel(e));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"getChannelWithoutCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),t.abrupt("return",this._manager.getChannelWithoutCache(e));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Nh),n),ai(L("string",e)&&Ah(a)).throw(M.invalidParameters),t.next=4,this._manager.getMyGroupChannelChangeLogs(e,a);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return E(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Nh),n),ai(L("number",e)&&Ah(a)).throw(M.invalidParameters),t.next=4,this._manager.getMyGroupChannelChangeLogs(e,a);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"getGroupChannelCount",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Mh),e),ai(Oh(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.getGroupChannelCount(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getUnreadItemCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getUnreadItemCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalUnreadChannelCount",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._manager.getTotalUnreadChannelCount();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getTotalUnreadMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getTotalUnreadMessageCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalScheduledMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getTotalScheduledMessageCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){return this._manager.getSubscribedTotalUnreadMessageCount()}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)}},{key:"createChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Sh),e),ai(Ih(r)).throw(M.invalidParameters),t.abrupt("return",this._manager.createChannel(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"createDistinctChannelIfNotExist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Sh),e),ai(Ih(r)).throw(M.invalidParameters),r&&(r.isDistinct=!0),t.abrupt("return",this.createChannel(r));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"createChannelWithUserIds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return E(this,void 0,void 0,t().mark((function o(){var u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=Object.assign(Object.assign({},Sh),{invitedUserIds:e,isDistinct:n,name:r,data:i,customType:s}),"string"==typeof a?u.coverUrl=a:u.coverImage=a,t.abrupt("return",this.createChannel(u));case 3:case"end":return t.stop()}}),o,this)})))}},{key:"markAsReadAll",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._manager.markAsReadAll();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"markAsReadWithChannelUrls",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:ai(F("string",e)).throw(M.invalidParameters),this._manager.markAsReadWithChannelUrls(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"markAsDelivered",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),t.next=3,this.getChannel(e);case 3:return r=t.sent,t.next=6,r.markAsDelivered();case 6:case"end":return t.stop()}}),n,this)})))}}]),a}(bi),Sv=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments))._channels=new Map,e._enteredChannelUrls=[],e}return i(a,[{key:"enteredChannels",get:function(){var e=this;return this._enteredChannelUrls.map((function(t){return e._channels.get(t)})).filter((function(e){return!!e}))}},{key:"isEnteredChannel",value:function(e){return this._enteredChannelUrls.includes(e)}},{key:"enter",value:function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)}},{key:"exit",value:function(e){var t=this._enteredChannelUrls.indexOf(e);t>=0&&this._enteredChannelUrls.splice(t,1)}},{key:"exitAll",value:function(){this._enteredChannelUrls=[]}},{key:"get",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._channels.get(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"upsert",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],e.forEach((function(e){if(a._channels.has(e.url)){var t=a._channels.get(e.url);Object.assign(t,e),r.push(t)}else a._channels.set(e.url,e),r.push(e)})),t.abrupt("return",r);case 3:case"end":return t.stop()}}),n)})))}},{key:"remove",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._channels.delete(e),this.exit(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return E(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._channels.clear(),this._enteredChannelUrls=[];case 2:case"end":return e.stop()}}),e,this)})))}}]),a}(Ya),Iv={channelUrl:void 0,name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,isEphemeral:void 0},Nv=function(e){return F("string",e.operatorUserIds,!0)&&(L("string",e.coverUrlOrImage,!0)||q(e.coverUrlOrImage,!0))&&L("string",e.name,!0)&&L("string",e.data,!0)&&L("string",e.customType,!0)&&(L("string",e.channelUrl)&&/^\w+$/.test(e.channelUrl)||null===e.channelUrl||void 0===e.channelUrl)&&L("boolean",e.isEphemeral,!0)},Av=function(e){s(n,e);var t=f(n);function n(e){var a,i=e.channelUrl,s=e.isInternalCall;return r(this,n),(a=t.call(this)).method=de.GET,a.path="".concat(s?ge:me,"/").concat(encodeURIComponent(i)),a}return i(n)}(Ue),Mv=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).channel=new Kv(e,a),i}return i(n)}(De),Ov=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,u=e.data,c=e.customType,l=e.operatorUserIds,d=e.isEphemeral;return(a=t.call(this)).method=de.POST,a.path=me,a.params=ce(le({channel_url:i,cover_url:L("string",s)?s:null,cover_file:q(s)?s:null,name:o,data:u,custom_type:c,operators:l,is_ephemeral:d})),a}return i(n)}(Ue),Uv=function(e){s(n,e);var t=f(n);function n(e){var a=e.channelUrl;return r(this,n),t.call(this,{code:"ENTR",payload:{channel_url:a},ackRequired:!0})}return i(n)}(fa),Dv=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u;return r(this,n),s=t.call(this,e,"SYEV",i),i.data&&(s.participantCount=null!==(o=i.data.participant_count)&&void 0!==o?o:0,s.user=new si(e,i.data),s.ts=null!==(u=i.data.edge_ts)&&void 0!==u?u:0),s}return i(n)}(ff),Lv=function(e){s(n,e);var t=f(n);function n(e){var a=e.channelUrl;return r(this,n),t.call(this,{code:"EXIT",payload:{channel_url:a},ackRequired:!0})}return i(n)}(fa),Rv=function(e){s(n,e);var t=f(n);function n(e,a,i){var s,o,u;return r(this,n),s=t.call(this,e,"EXIT",i),i.data&&(s.participantCount=null!==(o=i.data.participant_count)&&void 0!==o?o:0,s.user=new si(e,i.data),s.ts=null!==(u=i.data.edge_ts)&&void 0!==u?u:0),s}return i(n)}(ff),Pv={},Fv=function(n){s(o,n);var a=f(o);function o(n,i){var s;return r(this,o),(s=a.call(this,n,Object.assign(Object.assign({},i),{channelType:e.ChannelType.OPEN}))).subscribeChannelEvent=Ke,s.unsubscribeChannelEvent=Ke,s.refreshChannel=function(){return E(h(s),void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)})))},s._openChannelCache=new Sv(n),s._openChannelHandlers=new Map,s._dispatcher.on((function(e){if(e instanceof Qe)s._handleEvent(e);else if(e instanceof ga&&e.stateType===da.CONNECTED){var t,n=y(s._openChannelCache.enteredChannels);try{for(n.s();!(t=n.n()).done;){t.value.enter()}}catch(e){n.e(e)}finally{n.f()}}})),Pv[n]||(Pv[n]=h(s)),s}return i(o,[{key:"buildOpenChannelFromSerializedData",value:function(e){var t=ri(e);return new Kv(this._iid,Kv.payloadify(t))}},{key:"getChannelFromCache",value:function(e){var n;return E(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._openChannelCache.get(e);case 2:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=6;break}t.t0=void 0!==n;case 6:if(!t.t0){t.next=10;break}t.t2=n,t.next=11;break;case 10:t.t2=null;case 11:return t.abrupt("return",t.t2);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"upsertChannelsToCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._openChannelCache.upsert(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"removeChannelsFromCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=y(e),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=9;break}return i=a.value,t.next=7,this._openChannelCache.remove(i);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),r.e(t.t0);case 14:return t.prev=14,r.f(),t.finish(14);case 17:case"end":return t.stop()}}),n,this,[[1,11,14,17]])})))}},{key:"setEnteredToCache",value:function(e){this._openChannelCache.enter(e.url)}},{key:"setExitedToCache",value:function(e){this._openChannelCache.exit(e.url)}},{key:"_handleEvent",value:function(n){return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o,u,c,l,d,h,f,p,v,_,m,g,k,b,w,C,x,T,S,I,N,M,O,U,D,L,R,P,F,H,q,G,j,z,V,B,Q,K,W,Y,Z,J,X,$,ee,te,ne,re,ae,ie,se,oe,ue,ce,le,de,he,fe,pe,ve,_e,me,ge,ye,ke,Ee,be,we,Ce,xe,Te,Se,Ie,Ne,Ae,Me,Oe,Ue,De,Le,Re=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,r.t0=n.code,r.next="MESG"===r.t0||"FILE"===r.t0||"ADMM"===r.t0||"BRDM"===r.t0?4:"MEDI"===r.t0||"FEDI"===r.t0||"AEDI"===r.t0?14:"DELM"===r.t0?24:"MRCT"===r.t0?31:"MTHD"===r.t0?38:"MCNT"===r.t0?45:"PEDI"===r.t0?73:"VOTE"===r.t0?81:"SYEV"===r.t0?89:166;break;case 4:if(a=null,"MESG"===n.code?a=n.as($o):"FILE"===n.code?a=n.as(rs):"ADMM"!==n.code&&"BRDM"!=n.code||(a=n.as(Hf)),!a){r.next=13;break}if(s=(i=a).message,o=i.isMentioned,s.channelType!==e.ChannelType.OPEN){r.next=13;break}return r.next=11,this.getChannel(s.channelUrl,!0);case 11:u=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(u.url)&&(a.onMessageReceived&&a.onMessageReceived(u,s),o&&a.onMentionReceived&&a.onMentionReceived(u,s))}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 13:return r.abrupt("break",166);case 14:if(c=null,"MEDI"===n.code?c=n.as(tu):"FEDI"===n.code?c=n.as(ru):"AEDI"===n.code&&(c=n.as(qf)),!c){r.next=23;break}if(d=(l=c).message,h=l.mentionCountChange,d.channelType!==e.ChannelType.OPEN){r.next=23;break}return r.next=21,this.getChannel(d.channelUrl,!0);case 21:f=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(f.url)&&(a.onMessageUpdated&&a.onMessageUpdated(f,d),h>0&&a.onMentionReceived&&a.onMentionReceived(f,d))}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 23:return r.abrupt("break",166);case 24:if(p=n.as(iu),v=p.channelUrl,_=p.channelType,m=p.messageId,_!==e.ChannelType.OPEN){r.next=30;break}return r.next=28,this.getChannel(v,!0);case 28:g=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(g.url)&&a.onMessageDeleted&&a.onMessageDeleted(g,m)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 30:return r.abrupt("break",166);case 31:if(k=n.as(Bf),b=k.channelUrl,w=k.channelType,C=k.event,w!==e.ChannelType.OPEN){r.next=37;break}return r.next=35,this.getChannel(b,!0);case 35:x=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(x.url)&&a.onReactionUpdated&&a.onReactionUpdated(x,C)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 37:return r.abrupt("break",166);case 38:if(T=n.as(Qf),(S=T.event).channelType!==e.ChannelType.OPEN){r.next=44;break}return r.next=42,this.getChannel(S.channelUrl,!0);case 42:I=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(I.url)&&a.onThreadInfoUpdated&&a.onThreadInfoUpdated(I,S)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 44:return r.abrupt("break",166);case 45:N=n.as(Kf),M=N.openChannelMemberCounts,O=[],U=y(M),r.prev=48,U.s();case 50:if((D=U.n()).done){r.next=59;break}return L=D.value,R=L.channelUrl,P=L.participantCount,F=L.updatedAt,r.next=55,this.getChannelFromCache(R);case 55:(H=r.sent)&&H._updateParticipantCount(P,F)&&O.push(H);case 57:r.next=50;break;case 59:r.next=64;break;case 61:r.prev=61,r.t1=r.catch(48),U.e(r.t1);case 64:return r.prev=64,U.f(),r.finish(64);case 67:if(!(O.length>0)){r.next=72;break}return r.next=70,this.upsertChannelsToCache(O);case 70:q=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onChannelMemberCountChanged&&a.onChannelMemberCountChanged(q)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 72:return r.abrupt("break",166);case 73:if(G=n.as(Wf),j=G.event,z=G.status,V=G.channelUrl,B=G.channelType,!V||B!==e.ChannelType.OPEN){r.next=80;break}return r.next=77,this.getChannel(V,!0);case 77:Q=r.sent,this._dispatcher.dispatch(new Es({event:j,source:e.CollectionEventSource.EVENT_POLL_UPDATED})),Aa(z===Vi?function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPollDeleted&&a.onPollDeleted(Q,j.pollId)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}:function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPollUpdated&&a.onPollUpdated(Q,j)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))});case 80:return r.abrupt("break",166);case 81:if(K=n.as(Nu),W=K.event,Y=K.channelUrl,Z=K.channelType,!Y||Z!==e.ChannelType.OPEN){r.next=88;break}return r.next=85,this.getChannel(Y,!0);case 85:J=r.sent,this._dispatcher.dispatch(new bs({event:W,source:e.CollectionEventSource.EVENT_POLL_VOTED})),Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=y(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onPollVoted&&a.onPollVoted(J,W)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 88:return r.abrupt("break",166);case 89:if(X=n.as(ff),!($=X.event).isOpenChannelEvent){r.next=165;break}r.t2=$.category,r.next=r.t2===bh.CHANNEL_ENTER?94:r.t2===bh.CHANNEL_EXIT?101:r.t2===bh.CHANNEL_OPERATOR_UPDATE?108:r.t2===bh.USER_CHANNEL_MUTE||r.t2===bh.USER_CHANNEL_UNMUTE?116:r.t2===bh.USER_CHANNEL_BAN||r.t2===bh.USER_CHANNEL_UNBAN?123:r.t2===bh.CHANNEL_FREEZE||r.t2===bh.CHANNEL_UNFREEZE?130:r.t2===bh.CHANNEL_DELETED?138:r.t2===bh.CHANNEL_PROP_CHANGED?145:r.t2===bh.CHANNEL_META_DATA_CHANGED?150:r.t2===bh.CHANNEL_META_COUNTERS_CHANGED?159:165;break;case 94:return r.next=96,this.getChannel($.channelUrl,!0);case 96:return ee=r.sent,te=n.as(Dv),ne=te.participantCount,re=te.user,ae=ee._updateParticipantCount(ne,$.ts),Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onUserEntered&&e.onUserEntered(ee,re),ae&&e.onChannelParticipantCountChanged&&e.onChannelParticipantCountChanged(ee)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 101:return r.next=103,this.getChannel($.channelUrl,!0);case 103:return ie=r.sent,se=n.as(Rv),oe=se.participantCount,ue=se.user,ce=ie._updateParticipantCount(oe,$.ts),Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onUserExited&&e.onUserExited(ie,ue),ce&&e.onChannelParticipantCountChanged&&e.onChannelParticipantCountChanged(ie)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 108:return r.next=110,this.getChannel($.channelUrl,!0);case 110:return le=r.sent,de=n.as(Uf),he=de.operators,le.operators=he,this.upsertChannelsToCache([le]),Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(le,he)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 116:return r.next=118,this.getChannel($.channelUrl,!0);case 118:return fe=r.sent,pe=$.category===bh.USER_CHANNEL_MUTE,ve=n.as(pe?qo:jo),_e=ve.user,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){pe?e.onUserMuted&&e.onUserMuted(fe,_e):e.onUserUnmuted&&e.onUserUnmuted(fe,_e)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 123:return r.next=125,this.getChannel($.channelUrl,!0);case 125:return me=r.sent,ge=$.category===bh.USER_CHANNEL_BAN,ye=n.as(ge?Vo:Qo),ke=ye.user,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){ge?e.onUserBanned&&e.onUserBanned(me,ke):e.onUserUnbanned&&e.onUserUnbanned(me,ke)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 130:return r.next=132,this.getChannel($.channelUrl,!0);case 132:return Ee=r.sent,be=n.as(Wo),we=be.freeze,Ee.isFrozen=we,this.upsertChannelsToCache([Ee]),Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){we?e.onChannelFrozen&&e.onChannelFrozen(Ee):e.onChannelUnfrozen&&e.onChannelUnfrozen(Ee)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 138:return r.next=140,this.getChannel($.channelUrl,!0);case 140:return Ce=r.sent,r.next=143,this.removeChannelsFromCache([Ce.url]);case 143:return Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(Ce.url,Ce.channelType)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 145:return r.next=147,this.getChannelWithoutCache($.channelUrl,!0);case 147:return xe=r.sent,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(xe)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 150:return r.next=152,this.getChannel($.channelUrl,!0);case 152:return Te=r.sent,Se=n.as(xo),Ie=Se.created,Ne=Se.updated,Ae=Se.deleted,Ie&&Te._upsertCachedMetaData(Ie,$.ts),Ne&&Te._upsertCachedMetaData(Ne,$.ts),Ae&&Te._removeFromCachedMetaData(Ae,$.ts),Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){Ie&&e.onMetaDataCreated&&e.onMetaDataCreated(Te,Ie),Ne&&e.onMetaDataUpdated&&e.onMetaDataUpdated(Te,Ne),Ae&&e.onMetaDataDeleted&&e.onMetaDataDeleted(Te,Ae)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 159:return r.next=161,this.getChannel($.channelUrl,!0);case 161:return Me=r.sent,Oe=n.as(Ro),Ue=Oe.created,De=Oe.updated,Le=Oe.deleted,Aa((function(){return E(Re,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){Ue&&e.onMetaCounterCreated&&e.onMetaCounterCreated(Me,Ue),De&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(Me,De),Le&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(Me,Le)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",165);case 165:return r.abrupt("break",166);case 166:r.next=172;break;case 168:if(r.prev=168,r.t3=r.catch(0),!A(r.t3)){r.next=172;break}throw r.t3;case 172:case"end":return r.stop()}}),r,this,[[0,168],[48,61,64,67]])})))}},{key:"addHandler",value:function(e,t){this._openChannelHandlers.set(e,t)}},{key:"removeHandler",value:function(e){this._openChannelHandlers.delete(e)}},{key:"clearHandler",value:function(){this._openChannelHandlers.clear()}},{key:"getChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),t.prev=1,t.next=4,this.getChannelFromCache(e);case 4:if(!(r=t.sent)){t.next=7;break}return t.abrupt("return",r);case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:return t.next=13,this.getChannelWithoutCache(e);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),n,this,[[1,9]])})))}},{key:"getChannelWithoutCache",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E(this,void 0,void 0,t().mark((function r(){var a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ai(L("string",e)).throw(M.invalidParameters),a=new Av({channelUrl:e,isInternalCall:n}),t.next=4,this._requestQueue.send(a);case 4:return i=t.sent,s=i.as(Mv),o=s.channel,t.next=8,this.upsertChannelsToCache([o]);case 8:return t.abrupt("return",t.sent[0]);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"createChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Iv),e),ai(Nv(r)).throw(M.invalidParameters),a=new Ov(r),t.next=5,this._requestQueue.send(a);case 5:return i=t.sent,s=i.as(Mv),o=s.channel,this.upsertChannelsToCache([o]),t.abrupt("return",o);case 9:case"end":return t.stop()}}),n,this)})))}}],[{key:"of",value:function(e){return Pv[e]}}]),o}(Ff),Hv={name:void 0,coverUrlOrImage:void 0,data:void 0,customType:void 0,operatorUserIds:void 0},qv=function(e){return F("string",e.operatorUserIds,!0)&&(L("string",e.coverUrlOrImage)||q(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&L("string",e.name,!0)&&L("string",e.data,!0)&&L("string",e.customType,!0)},Gv=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.token,o=e.limit;return(a=t.call(this)).method=de.GET,a.path="".concat(me,"/").concat(encodeURIComponent(i),"/participants"),a.params={token:s,limit:o},a}return i(n)}(Ue),jv=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).participants=[];var s=a.next,o=a.participants;return i.token=s,i.participants=o.map((function(t){return new Ds(e,t)})),i}return i(n)}(De),zv=function(n){s(u,n);var a=f(u);function u(t,n,i){return r(this,u),a.call(this,t,n,e.ChannelType.OPEN,i)}return i(u,[{key:"_validate",value:function(){return p(o(u.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new Gv(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(jv),o=s.participants,u=s.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw M.queryInProgress;case 18:e.next=21;break;case 20:throw M.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(no),Vv=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl,s=e.coverUrlOrImage,o=e.name,u=e.data,c=e.customType,l=e.operatorUserIds;return(a=t.call(this)).method=de.PUT,a.path="".concat(me,"/").concat(encodeURIComponent(i)),a.params=ce(le({cover_url:L("string",s)?s:null,cover_file:q(s)?s:null,name:o,data:u,custom_type:c,operators:l})),a}return i(n)}(Ue),Bv=function(e){s(n,e);var t=f(n);function n(e,a){var i;return r(this,n),(i=t.call(this,e,a)).channel=new Kv(e,a),i}return i(n)}(De),Qv=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.channelUrl;return(a=t.call(this)).method=de.DELETE,a.path="".concat(me,"/").concat(encodeURIComponent(i)),a}return i(n)}(Ue),Kv=function(n){s(u,n);var a=f(u);function u(t,n){var i,s;return r(this,u),(i=a.call(this,t,n))._lastParticipantCountUpdated=0,i.participantCount=0,i.operators=[],i.channelType=e.ChannelType.OPEN,i.participantCount=null!==(s=n.participant_count)&&void 0!==s?s:0,i.operators=Array.isArray(n.operators)?n.operators.map((function(e){return new si(t,e)})):[],i}return i(u,[{key:"serialize",value:function(){return ni(this)}},{key:"isOperator",value:function(e){return e instanceof si?this.isOperator(e.userId):this.operators.some((function(t){return t.userId===e}))}},{key:"_updateParticipantCount",value:function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)}},{key:"createParticipantListQuery",value:function(e){return new zv(this._iid,this.url,e)}},{key:"refresh",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Fv.of(this._iid),e.next=3,n.getChannelWithoutCache(this.url);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"enter",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Uv({channelUrl:this.url}),e.next=4,r.send(a);case 4:i=e.sent,s=i.as(Dv),o=s.participantCount,u=s.ts,this._updateParticipantCount(o,u),Fv.of(this._iid).setEnteredToCache(this);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"exit",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Lv({channelUrl:this.url}),e.next=4,r.send(a);case 4:i=e.sent,s=i.as(Rv),o=s.participantCount,u=s.ts,this._updateParticipantCount(o,u),Fv.of(this._iid).setExitedToCache(this),Ll.of(this._iid).fileMessageQueue.cancel(this);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"updateChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){var r,a,i,s,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Hv),e),ai(qv(r)).throw(M.invalidParameters),a=Ei.of(this._iid),i=a.requestQueue,s=new Vv(Object.assign({channelUrl:this.url},r)),t.next=6,i.send(s);case 6:return o=t.sent,u=o.as(Bv),c=u.channel,this._update(c),l=Fv.of(this._iid),t.next=12,l.upsertChannelsToCache([c]);case 12:return t.abrupt("return",this);case 13:case"end":return t.stop()}}),n,this)})))}},{key:"updateChannelWithOperatorUserIds",value:function(e,n,r,a,i){return E(this,void 0,void 0,t().mark((function s(){var o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Object.assign(Object.assign({},Hv),{name:e,coverUrlOrImage:n,data:r,operatorUserIds:a,customType:i}),t.abrupt("return",this.updateChannel(o));case 2:case"end":return t.stop()}}),s,this)})))}},{key:"delete",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ei.of(this._iid),r=n.requestQueue,a=new Qv({channelUrl:this.url}),e.next=4,r.send(a);case 4:return i=Fv.of(this._iid),e.next=7,i.removeChannelsFromCache([this.url]);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"sendUserMessage",value:function(e){return ai(!e.isPinnedMessage).throw(M.notSupportedError),p(o(u.prototype),"sendUserMessage",this).call(this,e)}},{key:"sendFileMessage",value:function(e){return ai(!e.isPinnedMessage).throw(M.notSupportedError),p(o(u.prototype),"sendFileMessage",this).call(this,e)}}],[{key:"payloadify",value:function(e){return ce(le(Object.assign(Object.assign({},rc.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((function(e){return si.payloadify(e)}))})))}}]),u}(rc),Wv=function(e){s(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).onUserEntered=Ke,e.onUserExited=Ke,e.onChannelParticipantCountChanged=Ke,e.onPollUpdated=Ke,e.onPollVoted=Ke,e.onPollDeleted=Ke,e}return i(n)}(kv),Yv=function(e){s(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return i(n)}(Wv),Zv=function(e){s(n,e);var t=f(n);function n(e){var a;r(this,n);var i=e.token,s=e.limit,o=e.nameKeyword,u=e.urlKeyword,c=e.customTypes,l=e.includeFrozen,d=e.includeMetaData;return(a=t.call(this)).method=de.GET,a.path=me,a.params=ce({token:i,limit:s,name_contains:o,url_contains:u,custom_types:c,show_frozen:l,show_metadata:d}),a}return i(n)}(Ue),Jv=function(e){s(n,e);var t=f(n);function n(e,a){var i;r(this,n),(i=t.call(this,e,a)).channels=[];var s=a.next,o=a.channels,u=a.ts;return i.token=s,o&&o.length>0&&(i.channels=o.map((function(t){return new Kv(e,t)}))),i.ts="number"==typeof u?u:null,i}return i(n)}(De),Xv=function(e){s(a,e);var n=f(a);function a(e,t){var i,s,o,u,c,l;return r(this,a),(i=n.call(this,e,t)).includeFrozen=!0,i.includeMetaData=!0,i.nameKeyword=null,i.urlKeyword=null,i.customTypes=null,i.includeFrozen=null===(s=t.includeFrozen)||void 0===s||s,i.includeMetaData=null===(o=t.includeMetaData)||void 0===o||o,i.nameKeyword=null!==(u=t.nameKeyword)&&void 0!==u?u:null,i.urlKeyword=null!==(c=t.urlKeyword)&&void 0!==c?c:null,i.customTypes=null!==(l=t.customTypes)&&void 0!==l?l:null,i}return i(a,[{key:"_validate",value:function(){return p(o(a.prototype),"_validate",this).call(this)&&L("boolean",this.includeFrozen)&&L("boolean",this.includeMetaData)&&L("string",this.nameKeyword,!0)&&L("string",this.urlKeyword,!0)&&F("string",this.customTypes,!0)}},{key:"next",value:function(){return E(this,void 0,void 0,t().mark((function e(){var n,r,a,i,s,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=23;break}if(this._isLoading){e.next=20;break}if(!this._hasNext){e.next=17;break}return this._isLoading=!0,n=Ei.of(this._iid),r=n.requestQueue,a=new Zv(le(Object.assign(Object.assign({},this),{token:this._token}))),e.next=8,r.send(a);case 8:return i=e.sent,s=i.as(Jv),o=s.channels,u=s.token,this._token=u,this._hasNext=!!u,c=Fv.of(this._iid),e.next=15,c.upsertChannelsToCache(o);case 15:return this._isLoading=!1,e.abrupt("return",o);case 17:return e.abrupt("return",[]);case 20:throw M.queryInProgress;case 21:e.next=24;break;case 23:throw M.invalidParameters;case 24:case"end":return e.stop()}}),e,this)})))}}]),a}(to),$v=function(e){s(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="openChannel",e}return i(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;p(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:i,requestQueue:s,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Fv(e,{sdkState:n,dispatcher:r,requestQueue:s,logger:u,cacheContext:l,sessionManager:i})}},{key:"createOpenChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Xv(this._iid,e)}},{key:"addOpenChannelHandler",value:function(e,t){this._manager.addHandler(e,t)}},{key:"removeOpenChannelHandler",value:function(e){this._manager.removeHandler(e)}},{key:"removeAllOpenChannelHandlers",value:function(){this._manager.clearHandler()}},{key:"buildOpenChannelFromSerializedData",value:function(e){return this._manager.buildOpenChannelFromSerializedData(e)}},{key:"getChannel",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.getChannel(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"getChannelWithoutCache",value:function(e){return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.getChannelWithoutCache(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"createChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return E(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.createChannel(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"createChannelWithOperatorUserIds",value:function(e,n,r,a,i){return E(this,void 0,void 0,t().mark((function s(){var o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(o=Object.assign({},Iv)).name=e,o.coverUrlOrImage=n,o.data=r,o.operatorUserIds=a,o.customType=i,t.abrupt("return",this._manager.createChannel(o));case 7:case"end":return t.stop()}}),s,this)})))}}]),a}(bi);gv=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=a(e);if(t){var o=a(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}(this,r)}}function u(){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},u.apply(this,arguments)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return r(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],r=0,a=n.length;r<a;r++)if(n[r].callback===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var n=this.listeners[e.type].slice(),r=function(){s=n[a];try{s.callback.call(t,e)}catch(e){Promise.resolve().then((function(){throw e}))}s.options&&s.options.once&&t.removeEventListener(e.type,s.callback)},a=0,i=n.length;a<i;a++){var s;r()}return!e.defaultPrevented}}}]),t}(),l=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(l,t);var n=o(l);function l(){var t;return e(this,l),(t=n.call(this)).listeners||c.call(s(t)),Object.defineProperty(s(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(t),"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(s(t),"reason",{value:void 0,writable:!0,configurable:!0}),t}return r(l,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),u(a(l.prototype),"dispatchEvent",this).call(this,e)}}]),l}(c),d=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new l,writable:!0,configurable:!0})}return r(t,[{key:"abort",value:function(e){var t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event")).initEvent("abort",!1,!1):(t=document.createEventObject()).type="abort":t={type:"abort",bubbles:!1,cancelable:!1}}var n=e;if(void 0===n)if("undefined"==typeof document)(n=new Error("This operation was aborted")).name="AbortError";else try{n=new DOMException("signal is aborted without reason")}catch(e){(n=new Error("This operation was aborted")).name="AbortError"}this.signal.reason=n,this.signal.dispatchEvent(t)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();function h(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(d.prototype[Symbol.toStringTag]="AbortController",l.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(h(e))if(e.fetch){var t=function(e){"function"==typeof e&&(e={fetch:e});var t=e,n=t.fetch,r=t.Request,a=void 0===r?n.Request:r,i=t.AbortController,s=t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,o=void 0!==s&&s;if(!h({fetch:n,Request:a,AbortController:i,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:o}))return{fetch:n,Request:u};var u=a;(u&&!u.prototype.hasOwnProperty("signal")||o)&&((u=function(e,t){var n;t&&t.signal&&(n=t.signal,delete t.signal);var r=new a(e,t);return n&&Object.defineProperty(r,"signal",{writable:!1,enumerable:!1,configurable:!0,value:n}),r}).prototype=a.prototype);var c=n;return{fetch:function(e,t){var n=u&&u.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(n){var r;try{r=new DOMException("Aborted","AbortError")}catch(e){(r=new Error("Aborted")).name="AbortError"}if(n.aborted)return Promise.reject(r);var a=new Promise((function(e,t){n.addEventListener("abort",(function(){return t(r)}),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,c(e,t)])}return c(e,t)},Request:u}}(e),n=t.fetch,r=t.Request;e.fetch=n,e.Request=r,Object.defineProperty(e,"AbortController",{writable:!0,enumerable:!1,configurable:!0,value:d}),Object.defineProperty(e,"AbortSignal",{writable:!0,enumerable:!1,configurable:!0,value:l})}else console.warn("fetch() is not available, cannot install abortcontroller-polyfill")}("undefined"!=typeof self?self:global)},"function"==typeof define&&define.amd?define(gv):gv();var e_=Object.freeze({__proto__:null}),t_="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==t_&&t_,n_={searchParams:"URLSearchParams"in t_,iterable:"Symbol"in t_&&"iterator"in Symbol,blob:"FileReader"in t_&&"Blob"in t_&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in t_,arrayBuffer:"ArrayBuffer"in t_};if(n_.arrayBuffer)var r_=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a_=ArrayBuffer.isView||function(e){return e&&r_.indexOf(Object.prototype.toString.call(e))>-1};function i_(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function s_(e){return"string"!=typeof e&&(e=String(e)),e}function o_(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n_.iterable&&(t[Symbol.iterator]=function(){return t}),t}function u_(e){this.map={},e instanceof u_?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function c_(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l_(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function d_(e){var t=new FileReader,n=l_(t);return t.readAsArrayBuffer(e),n}function h_(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f_(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n_.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n_.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n_.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():n_.arrayBuffer&&n_.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=h_(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n_.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||a_(e))?this._bodyArrayBuffer=h_(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n_.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n_.blob&&(this.blob=function(){var e=c_(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=c_(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(d_)}),this.text=function(){var e,t,n,r=c_(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=l_(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n_.formData&&(this.formData=function(){return this.text().then(__)}),this.json=function(){return this.text().then(JSON.parse)},this}u_.prototype.append=function(e,t){e=i_(e),t=s_(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},u_.prototype.delete=function(e){delete this.map[i_(e)]},u_.prototype.get=function(e){return e=i_(e),this.has(e)?this.map[e]:null},u_.prototype.has=function(e){return this.map.hasOwnProperty(i_(e))},u_.prototype.set=function(e,t){this.map[i_(e)]=s_(t)},u_.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},u_.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),o_(e)},u_.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),o_(e)},u_.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),o_(e)},n_.iterable&&(u_.prototype[Symbol.iterator]=u_.prototype.entries);var p_=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v_(e,t){if(!(this instanceof v_))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,r,a=(t=t||{}).body;if(e instanceof v_){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u_(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,a||null==e._bodyInit||(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new u_(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),p_.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(a),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function __(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),a=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(a))}})),t}function m_(e,t){if(!(this instanceof m_))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new u_(t.headers),this.url=t.url||"",this._initBody(e)}v_.prototype.clone=function(){return new v_(this,{body:this._bodyInit})},f_.call(v_.prototype),f_.call(m_.prototype),m_.prototype.clone=function(){return new m_(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u_(this.headers),url:this.url})},m_.error=function(){var e=new m_(null,{status:0,statusText:""});return e.type="error",e};var g_=[301,302,303,307,308];m_.redirect=function(e,t){if(-1===g_.indexOf(t))throw new RangeError("Invalid status code");return new m_(null,{status:t,headers:{location:e}})};var y_=t_.DOMException;try{new y_}catch(hn){(y_=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),y_.prototype.constructor=y_}function k_(e,t){return new Promise((function(r,a){var i=new v_(e,t);if(i.signal&&i.signal.aborted)return a(new y_("Aborted","AbortError"));var s=new XMLHttpRequest;function o(){s.abort()}s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new u_,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var a=n.join(":").trim();t.append(r,a)}})),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var a="response"in s?s.response:s.responseText;setTimeout((function(){r(new m_(a,n))}),0)},s.onerror=function(){setTimeout((function(){a(new TypeError("Network request failed"))}),0)},s.ontimeout=function(){setTimeout((function(){a(new TypeError("Network request failed"))}),0)},s.onabort=function(){setTimeout((function(){a(new y_("Aborted","AbortError"))}),0)},s.open(i.method,function(e){try{return""===e&&t_.location.href?t_.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?s.withCredentials=!0:"omit"===i.credentials&&(s.withCredentials=!1),"responseType"in s&&(n_.blob?s.responseType="blob":n_.arrayBuffer&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(s.responseType="arraybuffer")),!t||"object"!==n(t.headers)||t.headers instanceof u_?i.headers.forEach((function(e,t){s.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){s.setRequestHeader(e,s_(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",o),s.onreadystatechange=function(){4===s.readyState&&i.signal.removeEventListener("abort",o)}),s.send(void 0===i._bodyInit?null:i._bodyInit)}))}k_.polyfill=!0,t_.fetch||(t_.fetch=k_,t_.Headers=u_,t_.Request=v_,t_.Response=m_);var E_=Object.freeze({__proto__:null});return e.AdminMessage=ji,e.AppleCriticalAlertOptions=Ui,e.ApplicationUserListQuery=hc,e.BannedUserListQuery=fo,e.BaseChannel=rc,e.BaseMessage=Pi,e.BlockedUserListQuery=vc,e.CachedChannelInfo=te,e.ConnectionHandler=oc,e.Emoji=ac,e.EmojiCategory=ic,e.EmojiContainer=sc,e.FileMessage=es,e.FriendListQuery=gc,e.GroupChannel=sv,e.GroupChannelCollection=vv,e.GroupChannelEventContext=dp,e.GroupChannelEventSource=qh,e.GroupChannelFilter=wh,e.GroupChannelHandler=bv,e.GroupChannelListQuery=Lf,e.GroupChannelModule=Tv,e.LocalCacheConfig=ne,e.Member=kh,e.MemberListQuery=Np,e.MemoryStore=pl,e.MessageCollection=bp,e.MessageCollectionInitHandler=kp,e.MessageEventContext=pp,e.MessageEventSource=vs,e.MessageFilter=bl,e.MessageMetaArray=Ai,e.MessageModule=Kl,e.MessageRequestHandler=Ls,e.MessageSearchQuery=Vl,e.MultipleFilesMessage=Ji,e.MultipleFilesMessageRequestHandler=nc,e.MutedUserListQuery=co,e.NotificationInfo=Va,e.OGImage=Mi,e.OGMetaData=Oi,e.OpenChannel=Kv,e.OpenChannelHandler=Yv,e.OpenChannelListQuery=Xv,e.OpenChannelModule=$v,e.OperatorListQuery=io,e.Participant=Ds,e.ParticipantListQuery=zv,e.PinnedMessage=tv,e.PinnedMessageListQuery=av,e.Plugin=zi,e.PreviousMessageListQuery=so,e.PublicGroupChannelListQuery=yv,e.Reaction=Ni,e.ReactionEvent=Ii,e.ReadStatus=Eh,e.RestrictedUser=Us,e.RestrictionInfo=Os,e.ScheduledMessageListQuery=xv,e.SendbirdChat=dh,e.SendbirdChatOptions=G,e.SendbirdError=M,e.Sender=Di,e.SessionHandler=uc,e.ThreadInfo=xi,e.ThreadInfoUpdateEvent=Rl,e.Thumbnail=Hi,e.UIKitConfigInfo=Qa,e.UploadedFileInfo=Zi,e.User=si,e.UserEventHandler=cc,e.UserMessage=Yi,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
