var Sendbird=function(e){"use strict";function t(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t=function(){return e};var e={},n=Object.prototype,r=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof d?t:d,s=Object.create(a.prototype),i=new x(r||[]);return s._invoke=function(e,t,n){var r="suspendedStart";return function(a,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw s;return T()}for(n.method=a,n.arg=s;;){var i=n.delegate;if(i){var o=E(i,n);if(o){if(o===h)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,i),s}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h={};function d(){}function p(){}function f(){}var v={};u(v,s,(function(){return this}));var _=Object.getPrototypeOf,m=_&&_(_(C([])));m&&m!==n&&r.call(m,s)&&(v=m);var g=f.prototype=d.prototype=Object.create(v);function y(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,s,i,o){var u=l(e[a],e,s);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,i,o)}),(function(e){n("throw",e,i,o)})):t.resolve(h).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,o)}))}o(u.arg)}var a;this._invoke=function(e,r){function s(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(s,s):s()}}function E(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function C(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=f,u(g,"constructor",f),u(f,"constructor",p),p.displayName=u(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(k.prototype),u(k.prototype,i,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,a,s){void 0===s&&(s=Promise);var i=new k(c(t,n,r,a),s);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},y(g),u(g,o,"Generator"),u(g,s,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],i=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var o=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(o&&u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;w(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function l(e,t,n){return l=c()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&u(a,n.prototype),a},l.apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return l(e,arguments,o(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)},h(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}function f(e){var t=c();return function(){var n,r=o(e);if(t){var a=o(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return p(this,n)}}function v(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}function _(){return _="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=v(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},_.apply(this,arguments)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,s=[],i=!0,o=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(o)throw a}}return s}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function b(e,t,n,r){return new(n||(n=Promise))((function(a,s){function i(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))}var w,x="4.4.0",C=function(){function e(){r(this,e)}return s(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}},{key:"SDK_VERSION",get:function(){return x}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",get:function(){return 100}},{key:"INTERNAL_CALL",get:function(){return"ic"}}]),e}();!function(e){e[e.NON_AUTHORIZED=400108]="NON_AUTHORIZED",e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(w||(w={}));var T,I=function(e){return!(e instanceof S&&!e.shouldThrowOutside)},S=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.code,i=void 0===s?0:s,o=e.message;return r(this,n),(a=t.call(this,o)).shouldThrowOutside=!1,a.name="SendbirdError",a.code=i,Object.setPrototypeOf(d(a),n.prototype),a}return s(n,[{key:"isInvalidTokenError",get:function(){return this.code===w.INVALID_TOKEN}},{key:"isSessionTokenExpiredError",get:function(){return this.code===w.SESSION_TOKEN_EXPIRED}},{key:"isSessionKeyExpiredError",get:function(){return this.code===w.SESSION_KEY_EXPIRED}},{key:"throwOutside",value:function(){throw this.shouldThrowOutside=!0,this}}],[{key:"debugModeRequired",get:function(){return new n({code:w.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})}},{key:"lostInstance",get:function(){return new n({code:w.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})}},{key:"connectionRenew",get:function(){return new n({code:w.CONNECTION_RENEW,message:"Connection restarts."})}},{key:"invalidConnectionStateTransition",get:function(){return new n({code:w.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})}},{key:"connectionRequired",get:function(){return new n({code:w.CONNECTION_REQUIRED,message:"Connection is required."})}},{key:"connectionCanceled",get:function(){return new n({code:w.CONNECTION_CANCELED,message:"Connection is canceled."})}},{key:"invalidParameters",get:function(){return new n({code:w.INVALID_PARAMETER,message:"Invalid parameters."})}},{key:"notSupportedError",get:function(){return new n({code:w.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})}},{key:"networkError",get:function(){return new n({code:w.NETWORK_ERROR,message:"There was a network error."})}},{key:"markAsReadAllRateLimitExceeded",get:function(){return new n({code:w.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})}},{key:"queryInProgress",get:function(){return new n({code:w.QUERY_IN_PROGRESS,message:"Query in progress."})}},{key:"noAckTimeout",get:function(){return new n({code:w.ACK_TIMEOUT,message:"Command received no ack."})}},{key:"loginTimeout",get:function(){return new n({code:w.LOGIN_TIMEOUT,message:"Connection timeout."})}},{key:"connectionClosed",get:function(){return new n({code:w.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})}},{key:"requestFailed",get:function(){return new n({code:w.REQUEST_FAILED,message:"Request failed."})}},{key:"fileUploadCanceled",get:function(){return new n({code:w.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})}},{key:"requestCanceled",get:function(){return new n({code:w.REQUEST_CANCELED,message:"Request has been canceled."})}},{key:"sessionTokenRefreshFailed",get:function(){return new n({code:w.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})}},{key:"sessionTokenRequestFailed",get:function(){return new n({code:w.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})}}]),n}(h(Error)),N=[w.CONNECTION_REQUIRED,w.NETWORK_ERROR,w.ACK_TIMEOUT,w.WEBSOCKET_CONNECTION_CLOSED,w.WEBSOCKET_CONNECTION_FAILED,w.FILE_UPLOAD_CANCEL_FAILED,w.REQUEST_CANCELED,w.INTERNAL_SERVER_ERROR,w.RATE_LIMIT_EXCEEDED,w.UNKNOWN_SERVER_ERROR],M=[w.WEBSOCKET_CONNECTION_CLOSED,w.WEBSOCKET_CONNECTION_FAILED,w.CONNECTION_REQUIRED],A=function(e,t){if(e!==t){var n=Object.assign({},e),r=Object.assign({},t);return(!n.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||n.messageId===r.messageId)&&((!n.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||n.reqId===r.reqId)&&(n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(n)===JSON.stringify(r)))}return!0},U=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!r||null!=t)||("string"!=typeof e?"object"===n(e)?O(e,t):R(e,t):n(t)===e)},O=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!n||null!=t)||Object.values(e).includes(t)},R=function(e,t){return t instanceof e},D=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return U(e,t)}))},L=function(e){return e>0&&M.indexOf(e)>=0},P=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&null===e)return!0;var n=U("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},F=1e4,G=1e3,q=1e4,H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.useMemberInfoInMessage,a=void 0===n||n,s=t.typingIndicatorInvalidateTime,i=void 0===s?F:s,o=t.typingIndicatorThrottle,u=void 0===o?G:o,c=t.websocketResponseTimeout,l=void 0===c?q:c,h=t.sessionTokenRefreshTimeout,d=void 0===h?60:h;r(this,e),this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=F,this._typingIndicatorThrottle=G,this._websocketResponseTimeout=q,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=a,this._typingIndicatorInvalidateTime=i,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=d}return s(e,[{key:"useMemberInfoInMessage",get:function(){return this._useMemberInfoInMessage},set:function(e){U("boolean",e)&&(this._useMemberInfoInMessage=e)}},{key:"typingIndicatorInvalidateTime",get:function(){return this._typingIndicatorInvalidateTime},set:function(e){U("number",e)&&(this._typingIndicatorInvalidateTime=e)}},{key:"typingIndicatorThrottle",get:function(){return this._typingIndicatorThrottle},set:function(e){U("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)}},{key:"websocketResponseTimeout",get:function(){return this._websocketResponseTimeout},set:function(e){U("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)}},{key:"sessionTokenRefreshTimeout",get:function(){return this._sessionTokenRefreshTimeout},set:function(e){U("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)}}]),e}(),j={encrypt:function(e){return e},decrypt:function(e){return e}},V=function(){function e(t){var n=t.store;r(this,e),this._preference=new Map,this._store=n}return s(e,[{key:"_savePreferenceKeys",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.set({key:this._keysAddress,value:g(this._preference.keys()),generation:1});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){var n;return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._keysAddress=e,t.next=3,this._store.get(e);case 3:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=7;break}t.t0=void 0!==n;case 7:if(!t.t0){t.next=11;break}t.t2=n,t.next=12;break;case 11:t.t2=[];case 12:a=t.t2,s=E(a),t.prev=14,s.s();case 16:if((i=s.n()).done){t.next=24;break}return o=i.value,t.next=20,this._store.get(o);case 20:(u=t.sent)&&this._preference.set(o,u);case 22:t.next=16;break;case 24:t.next=29;break;case 26:t.prev=26,t.t3=t.catch(14),s.e(t.t3);case 29:return t.prev=29,s.f(),t.finish(29);case 32:case"end":return t.stop()}}),r,this,[[14,26,29,32]])})))}},{key:"get",value:function(e){var n;return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null!==(n=this._preference.get(e))&&void 0!==n?n:null);case 1:case"end":return t.stop()}}),r,this)})))}},{key:"set",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=!this._preference.has(e),t.next=3,this._store.set({key:e,value:n,generation:1});case 3:if(this._preference.set(e,n),!a){t.next=7;break}return t.next=7,this._savePreferenceKeys();case 7:case"end":return t.stop()}}),r,this)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._store.remove(e);case 2:return this._preference.delete(e),t.next=5,this._savePreferenceKeys();case 5:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.removeMany(g(this._preference.keys()));case 2:return this._preference.clear(),e.next=5,this._savePreferenceKeys();case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),Q=s((function e(t){var n=t.encryption,a=void 0===n?null:n,s=t.store,i=void 0===s?null:s,o=t.localCacheEnabled,u=void 0===o||o;r(this,e),this.nestdb=null,this.store=i,this.preference=new V({store:i}),this.encryption=null!=a?a:j,this.localCacheEnabled=u})),B=function(){function e(){r(this,e),this.sessionKey=null,this.authToken=null}return s(e,[{key:"hasSession",get:function(){return!!this.sessionKey}},{key:"clear",value:function(){this.authToken=null,this.sessionKey=null}}]),e}(),K=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},z=function(){function e(t){var n=t.container;r(this,e),this._container={},this._container=n,this.key=K()}return s(e,[{key:"_register",value:function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this}},{key:"on",value:function(e,t){return this._register(e,-1,t)}},{key:"once",value:function(e,t){return this._register(e,1,t)}},{key:"close",value:function(){for(var e in this._container)this._container[e].delete(this.key)}}]),e}(),W=function(){function e(){r(this,e),this._container={}}return s(e,[{key:"on",value:function(e,t){return new z({container:this._container}).on(e,t)}},{key:"once",value:function(e,t){return new z({container:this._container}).once(e,t)}},{key:"dispatch",value:function(e,t){var n=this._container[e];if(n){var r,a=[],s=E(n.keys());try{for(s.s();!(r=s.n()).done;){var i=r.value,o=n.get(i);o.handler(t),o.occurence>0&&(o.occurence--,0===o.occurence&&a.push(i))}}catch(e){s.e(e)}finally{s.f()}a.forEach((function(e){return n.delete(e)}))}}}]),e}(),Y=function(){function e(){r(this,e),this._dispatcher=new W}return s(e,[{key:"on",value:function(e){return this._dispatcher.on("event",e)}},{key:"once",value:function(e){return this._dispatcher.once("event",e)}},{key:"dispatch",value:function(e){this._dispatcher.dispatch("event",e)}}]),e}(),J=s((function e(){r(this,e)})),X=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(T||(T={}));var Z,$=function(e){i(a,e);var t=f(a);function a(){var e;return r(this,a),(e=t.apply(this,arguments)).params={},e.requireAuth=!0,e.headers={},e.requestId=K(),e}return s(a,[{key:"stringifyParams",value:function(e){return"object"!==n(e)||Array.isArray(e)?String(e):e?JSON.stringify(e):""}},{key:"encodeParams",value:function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"===n(e)?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))}},{key:"query",get:function(){var e=this,t=X(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))}},{key:"payload",get:function(){var e=this,t=X(this.params);if(Object.keys(t).some((function(e){return P(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var a,s=t[r];if(P(s)){var i=s;n.append(r,i,null!==(a=i.name)&&void 0!==a?a:"filename")}else n.append(r,e.stringifyParams(s))})),n}return JSON.stringify(t)}}]),a}(J),ee=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this))._iid=e,s._payload=a,s}return s(n,[{key:"payload",get:function(){return Object.assign({},this._payload)}},{key:"as",value:function(e){return new e(this._iid,this.payload)}}]),n}(J),te=function(e){i(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).requestId=e,a}return s(n)}(J),ne=function(e){i(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return s(n)}(J),re=function(e){i(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).statLog=e,a}return s(n)}(J);!function(e){e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result"}(Z||(Z={}));var ae,se=function(){function e(t){var n=t.type,a=t.data,s=t.ts,i=void 0===s?Date.now():s;r(this,e),this.type=n,this.createdAt=i,this.data=a}return s(e,null,[{key:"payloadify",value:function(e){return X({stat_type:e.type,ts:e.createdAt,data:X(e.data)})}}]),e}(),ie=function(){function e(t,n){var a=this,s=n.auth,i=n.sdkState,o=n.dispatcher,u=n.logger;r(this,e),this._abortControl=new Map,this._iid=t,this._auth=s,this._sdkState=i,this._dispatcher=o,this._dispatcher.on((function(e){e instanceof te&&a.cancel(e.requestId)})),this._logger=u}return s(e,[{key:"_userAgentWithExtension",get:function(){var e=this._sdkState.extensions,t="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",a=e["device-os-platform"]?"o".concat(e["device-os-platform"]):"";return"".concat(t,"/c").concat(C.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(a)}},{key:"_createHeader",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._sdkState,r=n.appId,a=n.appVersion,s=Object.assign(Object.assign({},e.headers),{SendBird:"JS,".concat(C.OS_VERSION,",").concat(C.SDK_VERSION,",").concat(r).concat(a?",".concat(a):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(s["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(s["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(s["App-Id"]=r,s["Access-Token"]=this._auth.authToken),s}},{key:"_statLogApiResult",value:function(e,t,n){this._dispatcher.dispatch(new re(new se({type:Z.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})))}},{key:"send",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d,p,f,v,_,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.path,a=e.method,s=![T.GET,T.DELETE].includes(a),i=this._sdkState.api,o="".concat(i.host).concat(r).concat(s?"":e.query),u=s?e.payload:null,c=this._createHeader(e,u instanceof FormData?u:null),l=new AbortController,h=l.signal,this._abortControl.set(e.requestId,l),d=Date.now(),t.prev=10,t.next=13,fetch(o,{method:a,body:u,headers:c,signal:h});case 13:return p=t.sent,t.next=16,p.json();case 16:if(f=t.sent,!p.ok&&!p.redirected){t.next=23;break}return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,d,null),t.abrupt("return",new ee(this._iid,f));case 23:if(!f){t.next=30;break}throw v=new S(f),!e.requireAuth&&v.isSessionKeyExpiredError&&this._dispatcher.dispatch(new ne),this._statLogApiResult(e,d,v),v;case 30:throw _=S.requestFailed,this._statLogApiResult(e,d,_),_;case 33:t.next=50;break;case 35:if(t.prev=35,t.t0=t.catch(10),this._statLogApiResult(e,d,t.t0),!(t.t0 instanceof S)){t.next=43;break}throw this._logger.debug("fail api request",t.t0),t.t0;case 43:if("AbortError"!==t.t0.name){t.next=47;break}throw S.requestCanceled;case 47:throw m=S.networkError,this._logger.debug("fail api request",m),m;case 50:case"end":return t.stop()}}),n,this,[[10,35]])})))}},{key:"cancel",value:function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))}},{key:"cancelAll",value:function(){var e,t=E(this._abortControl.values());try{for(t.s();!(e=t.n()).done;){e.value.abort()}}catch(e){t.e(e)}finally{t.f()}this._abortControl.clear()}}]),e}(),oe=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return r(this,n),(i=t.call(this))._iid=e,i.code=a,i.payload=s,i.requestId=s?s.req_id:o,i}return s(n,[{key:"convertToMessage",value:function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")}},{key:"as",value:function(e){return new e(this._iid,this.code,this.payload)}}],[{key:"createFromRawMessage",value:function(e,t){var r=t.substring(0,4),a=null;try{a=JSON.parse(t.substring(4))}catch(e){r="NOOP"}finally{return new n(e,r,a)}}}]),n}(J),ue=function(){};e.ConnectionState=void 0,(ae=e.ConnectionState||(e.ConnectionState={})).CONNECTING="CONNECTING",ae.OPEN="OPEN",ae.CLOSED="CLOSED";var ce,le=function(t){i(a,t);var n=f(a);function a(e,t){var s,i=t.sdkState,o=t.dispatcher,u=t.logger;return r(this,a),(s=n.call(this)).lastActive=0,s._iid=e,s._sdkState=i,s._dispatcher=o,s._logger=u,s}return s(a,[{key:"isOpen",get:function(){return this.connectionState===e.ConnectionState.OPEN}},{key:"connectionState",get:function(){if(this._ws)switch(this._ws.readyState){case 0:return e.ConnectionState.CONNECTING;case 1:return e.ConnectionState.OPEN}return e.ConnectionState.CLOSED}},{key:"connect",value:function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach((function(e){if(e&&U("string",e)){var n=oe.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?t.dispatch("message",n):"PONG"===n.code?t.dispatch("pong"):"EXPR"===n.code?n.payload&&n.payload.expires_in>=0&&t._dispatcher.dispatch(new ne):"NOOP"===n.code||t.dispatch("message",n)}}))},this._ws.onerror=function(){t._logger.debug("websocket error"),t.dispatch("error",S.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t.dispatch("close")},this.lastActive=Date.now()}},{key:"disconnect",value:function(){var t=this;return new Promise((function(n){t._logger.debug("websocket disconnect"),t._ws&&t.connectionState!==e.ConnectionState.CLOSED?(t._ws.onopen=ue,t._ws.onmessage=ue,t._ws.onerror=ue,t._ws.onclose=function(){t.dispatch("close"),n()},t._ws.close(),t._ws=null):n()}))}},{key:"send",value:function(e){if(!this._ws)throw S.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())}},{key:"error",value:function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)}}]),a}(W),he=function(e){i(n,e);var t=f(n);function n(e){var a,s,i=e.code,o=e.ackRequired,u=e.payload,c=void 0===u?null:u;return r(this,n),(a=t.call(this)).code=i,a.payload=c,a.requestId=null!==(s=a.payload.req_id)&&void 0!==s?s:K(),a.ackRequired=o,a.payload.req_id=a.requestId,a}return s(n,[{key:"convertToMessage",value:function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")}}]),n}(J),de=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.all,i=e.custom_types,o=e.ts;return r(this,n),(a=t.call(this)).all=s,a.customTypes=i,a.ts=o,a}return s(n)}(J),pe=s((function e(){var t=this;r(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),fe=function(){function e(t,n){var a=this,s=n.auth,i=n.sdkState,o=n.dispatcher,u=n.logger;r(this,e),this._ackStateMap=new Map,this._sdkState=i,this._dispatcher=o,this._logger=u,this.apiClient=new ie(t,{auth:s,sdkState:i,dispatcher:o,logger:u}),this.websocketClient=new le(t,{sdkState:i,dispatcher:o,logger:u}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new de(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new S({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(S.connectionClosed)})),a._ackStateMap.clear()}))}return s(e,[{key:"_sendApiRequest",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.apiClient.send(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"_sendWebsocketRequest",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new pe,e.ackRequired){a=null,s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),a&&(clearTimeout(a),a=null),t?(i._logger.debug("fail websocket request",t),r.reject(t)):(i._logger.debug("receive websocket ack",e.requestId),r.resolve(n)))};try{a=setTimeout((function(){return s(S.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return s(null,e)},reject:function(e){return s(e)}}),this.websocketClient.send(e)}catch(e){s(e)}}else try{this.websocketClient.send(e),r.resolve(null)}catch(e){r.reject(e)}return t.abrupt("return",r.promise);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"send",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof $)){t.next=6;break}return t.next=3,this._sendApiRequest(e);case 3:case 9:return t.abrupt("return",t.sent);case 6:if(!(e instanceof he)){t.next=10;break}return t.next=9,this._sendWebsocketRequest(e);case 10:throw S.invalidParameters;case 11:case"end":return t.stop()}}),n,this)})))}},{key:"cancel",value:function(e){this.apiClient.cancel(e)}},{key:"cancelAll",value:function(){this.apiClient.cancelAll()}}]),e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",e[e.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",e[e.LOGOUT=7]="LOGOUT"}(ce||(ce={}));var ve,_e=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.stateType;return r(this,n),(a=t.call(this)).stateType=s,a}return s(n)}(J),me=function(){function e(n,a){var s=this,i=a.auth,o=a.sdkState,u=a.dispatcher,c=a.logger;r(this,e),this._currentConnectionStateType=ce.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new fe(n,{auth:i,sdkState:o,dispatcher:u,logger:c}),this._auth=i,this._logger=c,this._dispatcher=u,this._dispatcher.on((function(e){if(e instanceof _e){var n=e.stateType;switch(s._currentConnectionStateType=n,n){case ce.CONNECTED:var r=s._lazyCallQueue;s._lazyCallQueue=[],r.forEach((function(e){return b(s,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.command,a=e.deferred,s=e.timeout,clearTimeout(s),t.prev=2,t.next=5,this.send(r);case 5:i=t.sent,a.resolve(i),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),a.reject(t.t0);case 12:case"end":return t.stop()}}),n,this,[[2,9]])})))}));break;case ce.INITIALIZED:case ce.INTERNAL_DISCONNECTED:case ce.EXTERNAL_DISCONNECTED:case ce.LOGOUT:var a=s._lazyCallQueue;s._lazyCallQueue=[],a.forEach((function(e){return b(s,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.deferred,a=e.timeout,clearTimeout(a),this._auth&&this._auth.hasSession?r.reject(S.connectionClosed):r.reject(S.connectionRequired);case 3:case"end":return t.stop()}}),n,this)})))}))}}}))}return s(e,[{key:"isReady",get:function(){return this._currentConnectionStateType===ce.CONNECTED}},{key:"isLazyCallActivated",get:function(){return this._currentConnectionStateType===ce.CONNECTING||this._currentConnectionStateType===ce.RECONNECTING}},{key:"send",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof he)){t.next=19;break}if(!this.isReady){t.next=8;break}return this._logger.debug("send websocket request",e),t.next=5,this.commandRouter.send(e);case 5:case 24:return t.abrupt("return",t.sent);case 8:if(!this.isLazyCallActivated){t.next=15;break}return this._logger.debug("wait websocket request",e),r=new pe,this._lazyCallQueue.push({command:e,deferred:r,timeout:setTimeout((function(){return i.timeout(e.requestId)}),1e4)}),t.abrupt("return",r.promise);case 15:throw this._logger.debug("fail websocket request"),S.connectionRequired;case 17:t.next=37;break;case 19:if(!(e instanceof $)){t.next=37;break}if(!this._auth.hasSession){t.next=27;break}return this._logger.debug("send api request",e),t.next=24,this.commandRouter.send(e);case 27:if(!this.isLazyCallActivated){t.next=34;break}return this._logger.debug("wait api request",e),a=new pe,this._lazyCallQueue.push({command:e,deferred:a,timeout:setTimeout((function(){return i.timeout(e.requestId)}),1e4)}),t.abrupt("return",a.promise);case 34:throw s=S.connectionRequired,this._logger.debug("fail api request",s),s;case 37:case"end":return t.stop()}}),n,this)})))}},{key:"forceSend",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._logger.debug("send forced request",e),t.next=3,this.commandRouter.send(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"timeout",value:function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(S.connectionRequired),this._lazyCallQueue.splice(t,1))}},{key:"cancel",value:function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)}},{key:"cancelAll",value:function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()}}]),e}(),ge="sendbird@devicetokens",ye=function(){function e(t){var n=t.type,a=t.token;r(this,e),this.type=n,this.token=a}return s(e,null,[{key:"payloadify",value:function(e){return{type:e.type,token:e.token}}}]),e}(),ke="v3",Ee="/".concat(ke,"/users"),be="/".concat(ke,"/storage/file"),we="/".concat(ke,"/group_channels"),xe="/".concat(ke,"/sdk/group_channels"),Ce="/".concat(ke,"/open_channels"),Te="/".concat(ke,"/sdk/open_channels"),Ie="/".concat(ke,"/search"),Se="/".concat(ke,"/report"),Ne="/".concat(ke,"/emojis"),Me="/".concat(ke,"/emoji_categories"),Ae="/".concat(ke,"/polls"),Ue="/".concat(ke,"/scheduled_messages"),Oe="/".concat(ke,"/sdk/statistics"),Re=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.authToken,o=e.expiringSession,u=void 0===o||o;return r(this,n),(a=t.call(this)).path="".concat(Ee,"/").concat(s,"/session_key"),a.method=T.POST,a.params={token:i,expiring_session:!!u},a.requireAuth=!1,a}return s(n)}($),De=function(e){i(n,e);var t=f(n);function n(e){var a=e.authToken,s=e.expiringSession,i=void 0===s||s,o=e.requestId,u=void 0===o?null:o;return r(this,n),t.call(this,{code:"LOGI",payload:{token:a,expiring_session:i?1:0,req_id:u},ackRequired:!0})}return s(n)}(he),Le=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),s=t.call(this,e,a);var i=a.key;return s.key=i,s}return s(n)}(ee),Pe=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"LOGI",s)).error=null,i.newKey=s.new_key,i.error=s.error?new S(s.error):null,i}return s(n)}(oe),Fe=function(e){i(n,e);var t=f(n);function n(){return r(this,n),t.apply(this,arguments)}return s(n)}(J),Ge=function(e){return b(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){return setTimeout(t,e)})));case 1:case"end":return t.stop()}}),n)})))},qe=function(){function e(){r(this,e)}return s(e,[{key:"calcTimeout",value:function(){return 0}}]),e}(),He=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new qe;return b(void 0,void 0,void 0,t().mark((function a(){var s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=0,i=null,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return i=null!=e?e:new Error("Halted")},u=function(){s=0};case 4:if(!(-1===n||s<n)){t.next=29;break}return t.prev=5,t.next=8,e(o,u);case 8:if(c=t.sent,i){t.next=13;break}return t.abrupt("return",c);case 13:throw i;case 14:t.next=27;break;case 16:if(t.prev=16,t.t0=t.catch(5),i){t.next=26;break}if(++s!==n){t.next=22;break}throw t.t0;case 22:return t.next=24,Ge(r.calcTimeout(s));case 24:t.next=27;break;case 26:throw i;case 27:t.next=4;break;case 29:case"end":return t.stop()}}),a,null,[[5,16]])})))},je=function(e){return b(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=12;break;case 5:if(t.prev=5,t.t0=t.catch(0),!(t.t0 instanceof S)){t.next=11;break}t.t0.throwOutside(),t.next=12;break;case 11:throw t.t0;case 12:case"end":return t.stop()}}),n,null,[[0,5]])})))},Ve=function(e){return b(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:t.next=7;break;case 5:t.prev=5,t.t0=t.catch(0);case 7:case"end":return t.stop()}}),n,null,[[0,5]])})))},Qe=new WeakMap,Be=function(e){i(a,e);var n=f(a);function a(e){var t,s=e.auth,i=e.cacheContext,o=e.sdkState,u=e.dispatcher,c=e.requestQueue,l=e.logger;return r(this,a),(t=n.call(this))._currentConnectionStateType=ce.INITIALIZED,t._deviceTokenCacheEnabled=!1,t._isRefreshingAuthToken=!1,t._isRefreshingSessionKey=!1,t.auth=s,t._cacheContext=i,t._sdkState=o,t._dispatcher=u,t._requestQueue=c,t._logger=l,t._deviceTokens=[],t._dispatcher.on((function(e){if(e instanceof _e){var n=e.stateType;t._currentConnectionStateType=n}else e instanceof ne&&t.handler&&(t._logger.debug("session expired"),t.handler.onSessionExpired(),t.refresh())})),t}return s(a,[{key:"ekey",get:function(){return Qe.get(this)}},{key:"deviceTokens",get:function(){return this._deviceTokens}},{key:"deviceTokenLastDeletedAt",get:function(){return this._deviceTokenLastDeletedAt}},{key:"indexOfDeviceToken",value:function(e,t){return this._deviceTokens.findIndex((function(n){return n.type===e&&n.token===t}))}},{key:"hasDeviceToken",value:function(e,t){return!1}},{key:"createRefreshWebsocketCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new De({authToken:e,expiringSession:!0,requestId:t})}},{key:"_refreshSessionKeyByWebSocket",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.createRefreshWebsocketCommand(e),t.next=3,this._requestQueue.forceSend(r);case 3:if(a=t.sent,s=a.as(Pe),i=s.newKey,!(o=s.error)){t.next=7;break}throw o;case 7:this.auth.sessionKey=null!=i?i:this.auth.sessionKey;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"_refreshSessionKeyByApi",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=new Re({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),n.next=3,He((function(e){return b(a,void 0,void 0,t().mark((function n(){var a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._requestQueue.forceSend(r);case 3:a=t.sent,s=a.as(Le),i=s.key,this.auth.sessionKey=i,t.next=15;break;case 8:if(t.prev=8,t.t0=t.catch(0),!this._isSessionRelatedError(t.t0)){t.next=14;break}e(t.t0),t.next=15;break;case 14:throw t.t0;case 15:case"end":return t.stop()}}),n,this,[[0,8]])})))}),3);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"_refreshSessionKey",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._currentConnectionStateType!==ce.CONNECTED){t.next=25;break}return t.prev=1,t.next=4,this._refreshSessionKeyByWebSocket(e);case 4:return this.complete(),t.abrupt("return");case 8:if(t.prev=8,t.t0=t.catch(1),!this._isSessionRelatedError(t.t0)){t.next=25;break}if(!n){t.next=25;break}return t.next=14,this._receiveNewAuthToken();case 14:if(this.auth.authToken=t.sent,!this.auth.authToken){t.next=21;break}return t.next=18,this._refreshSessionKey(this.auth.authToken,!1);case 18:this.complete(),t.next=24;break;case 21:return t.next=23,this.clear();case 23:this.close();case 24:return t.abrupt("return");case 25:return t.prev=25,t.next=28,this._refreshSessionKeyByApi(e);case 28:this.complete(),t.next=53;break;case 31:if(t.prev=31,t.t1=t.catch(25),!this._isSessionRelatedError(t.t1)){t.next=52;break}if(!n){t.next=49;break}return t.next=37,this._receiveNewAuthToken();case 37:if(this.auth.authToken=t.sent,!this.auth.authToken){t.next=44;break}return t.next=41,this._refreshSessionKeyByApi(this.auth.authToken);case 41:this.complete(),t.next=47;break;case 44:return t.next=46,this.clear();case 46:this.close();case 47:t.next=50;break;case 49:throw t.t1;case 50:t.next=53;break;case 52:throw t.t1;case 53:case"end":return t.stop()}}),r,this,[[1,8],[25,31]])})))}},{key:"_receiveNewAuthToken",value:function(){var e=this,n=new pe;return je((function(){return b(e,void 0,void 0,t().mark((function e(){var r,a,s=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._isRefreshingAuthToken=!0,this.auth.clear(),r=null,a=function(){r&&(clearTimeout(r),r=null)},r=setTimeout((function(){s._isRefreshingAuthToken=!1,n.reject()}),1e3*this._sdkState.sessionTokenRefreshTimeout),this.handler.onSessionTokenRequired((function(e){a(),s._isRefreshingAuthToken&&(s._isRefreshingAuthToken=!1,s.dispatch("refresh-authtoken"),n.resolve(e))}),(function(e){a(),s._isRefreshingAuthToken=!1,n.reject(e)}));case 6:case"end":return e.stop()}}),e,this)})))})),n.promise}},{key:"_isSessionRelatedError",value:function(e){return e instanceof S&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError)}},{key:"isSessionKeyRefreshing",get:function(){return this._isRefreshingSessionKey}},{key:"isRefreshingAuthToken",get:function(){return this._isRefreshingAuthToken}},{key:"login",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.auth.sessionKey=e.key,Qe.set(this,e.ekey),r=this._cacheContext.preference,!this._deviceTokenCacheEnabled){t.next=16;break}return t.next=6,r.get(ge);case 6:if((a=t.sent)&&!(a.lastDeletedAt<e.deviceTokenLastDeletedAt)){t.next=14;break}return this._deviceTokens=[],this._deviceTokenLastDeletedAt=e.deviceTokenLastDeletedAt,t.next=12,this.saveDeviceToken();case 12:t.next=16;break;case 14:this._deviceTokens=a.tokens.map((function(e){return new ye(ye.payloadify(e))})),this._deviceTokenLastDeletedAt=a.lastDeletedAt;case 16:case"end":return t.stop()}}),n,this)})))}},{key:"complete",value:function(){var e=this;this.dispatch("refresh"),je((function(){return b(e,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.debug("session refreshed"),this.handler.onSessionRefreshed();case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"error",value:function(e){var n=this;je((function(){return b(n,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.handler.onSessionError(e);case 1:case"end":return t.stop()}}),n,this)})))}))}},{key:"close",value:function(){var e=this;this.dispatch("close"),je((function(){return b(e,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._logger.debug("session closed"),this.handler.onSessionClosed();case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"refresh",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.handler){e.next=40;break}if(this._isRefreshingSessionKey){e.next=40;break}if(this._isRefreshingSessionKey=!0,this.auth.authToken){e.next=27;break}return e.prev=4,e.next=7,this._receiveNewAuthToken();case 7:if(!(n=e.sent)){e.next=13;break}this._logger.debug("session refreshing.."),this.auth.authToken=n,e.next=18;break;case 13:return e.next=15,this.clear();case 15:return this.close(),this._isRefreshingSessionKey=!1,e.abrupt("return");case 18:e.next=27;break;case 20:throw e.prev=20,e.t0=e.catch(4),r=S.sessionTokenRequestFailed,this._dispatcher.dispatch(new Fe),this.error(r),this._isRefreshingSessionKey=!1,r;case 27:return e.prev=27,e.next=30,this._refreshSessionKey(this.auth.authToken);case 30:this._isRefreshingSessionKey=!1,e.next=40;break;case 33:throw e.prev=33,e.t1=e.catch(27),a=S.sessionTokenRefreshFailed,this._dispatcher.dispatch(new Fe),this.error(a),this._isRefreshingSessionKey=!1,a;case 40:case"end":return e.stop()}}),e,this,[[4,20],[27,33]])})))}},{key:"setDeviceToken",value:function(e,t){return this.indexOfDeviceToken(e,t)<0&&(this._deviceTokens.push(new ye({type:e,token:t})),!0)}},{key:"unsetDeviceToken",value:function(e,t){var n=this.indexOfDeviceToken(e,t);n>=0&&this._deviceTokens.splice(n,1)}},{key:"unsetDeviceTokens",value:function(e){this._deviceTokens=this._deviceTokens.filter((function(t){return t.type!==e}))}},{key:"setDeviceTokenDeletedAt",value:function(e){e>0&&(this._deviceTokenLastDeletedAt=e)}},{key:"saveDeviceToken",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._deviceTokenCacheEnabled){e.next=4;break}return n=this._cacheContext.preference,e.next=4,n.set(ge,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentUser=null,this.auth.clear(),Qe.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,e.next=7,this.saveDeviceToken();case 7:case"end":return e.stop()}}),e,this)})))}}]),a}(W),Ke=function(){function e(){r(this,e),this.type=ce.NONE,this.name="none"}return s(e,[{key:"run",value:function(e){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onConnect",value:function(e,n){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onReconnect",value:function(e,n){return n.resetReconnectCount,b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onDisconnect",value:function(e,n){return n.error,n.autoReconnect,b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onDisconnectWebSocket",value:function(e){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}},{key:"onLogout",value:function(e){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}}]),e}(),ze=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=ce.LOGOUT,e.name="logout",e}return s(a,[{key:"run",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),a=e.sdkState.userId,n.next=4,e.logout();case 4:return n.next=6,e.changeState(new $e,r);case 6:je((function(){return b(s,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.connectionHandlers.forEach((function(e){e.onDisconnected(a)}));case 1:case"end":return t.stop()}}),n)})))}));case 7:case"end":return n.stop()}}),n)})))}}]),a}(Ke),We=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.call(this)).type=ce.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return s(a,[{key:"run",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.disconnect();case 2:case"end":return t.stop()}}),n)})))}},{key:"onConnect",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new Ze({authToken:n}),a);case 5:case"end":return t.stop()}}),r)})))}},{key:"onReconnect",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new Je,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onLogout",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new ze,r);case 3:case"end":return t.stop()}}),n)})))}}]),a}(Ke),Ye=function(e){i(a,e);var n=f(a);function a(e){var t,s=e.autoReconnect;return r(this,a),(t=n.call(this)).type=ce.INTERNAL_DISCONNECTED,t.name="internaldisconnected",t._autoReconnect=!1,t._autoReconnect=s,t}return s(a,[{key:"run",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.disconnect();case 3:if(!this._autoReconnect){t.next=6;break}return t.next=6,e.changeState(new Je,r);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"onConnect",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new Ze({authToken:n}),a);case 5:case"end":return t.stop()}}),r)})))}},{key:"onReconnect",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new Je,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onDisconnectWebSocket",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new We,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onLogout",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new ze,r);case 3:case"end":return t.stop()}}),n)})))}}]),a}(Ke),Je=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=ce.RECONNECTING,e.name="reconnecting",e._haltConnect=null,e._resetConnect=null,e._callbacks=[],e}return s(a,[{key:"_halt",value:function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=null)}},{key:"_flushCallbacks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._haltConnect=null,this._resetConnect=null,this._callbacks.forEach((function(t){return t(e)}))}},{key:"run",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),a=new pe,this._callbacks.push((function(e){return e?a.reject(e):a.resolve()})),je((function(){return b(u,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.connectionHandlers.forEach((function(e){e.onReconnectStarted()}));case 1:case"end":return t.stop()}}),n)})))})),n.prev=4,s=e.sdkState.websocket,i=s.reconnectMaxRetry,o=s.reconnectRetryStrategy,n.next=8,He((function(n,r){return b(u,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._haltConnect=n,this._resetConnect=r,t.prev=2,t.next=5,e.connect();case 5:t.next=17;break;case 7:if(t.prev=7,t.t0=t.catch(2),e.clearLoginTimer(),!(t.t0 instanceof S)){t.next=16;break}t.t1=t.t0.code,t.next=t.t1===w.CONNECTION_CANCELED?14:16;break;case 14:return n(t.t0),t.abrupt("return");case 16:throw t.t0;case 17:case"end":return t.stop()}}),a,this,[[2,7]])})))}),i,o);case 8:return n.next=10,e.changeState(new Xe,r);case 10:je((function(){return b(u,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(null),e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded()}));case 2:case"end":return t.stop()}}),n,this)})))})),n.next=24;break;case 13:if(n.prev=13,n.t0=n.catch(4),I(n.t0)){n.next=23;break}if(!(n.t0 instanceof S)){n.next=20;break}if(n.t0.code===w.CONNECTION_CANCELED){n.next=20;break}return n.next=20,e.changeState(new Ye({autoReconnect:!1}),r);case 20:je((function(){return b(u,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(n.t0),e.connectionHandlers.forEach((function(e){e.onReconnectFailed()}));case 2:case"end":return t.stop()}}),r,this)})))})),n.next=24;break;case 23:throw n.t0;case 24:return n.abrupt("return",a.promise);case 25:case"end":return n.stop()}}),n,this,[[4,13]])})))}},{key:"onConnect",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new pe,this._halt(S.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var t=Date.now();e.changeState(new Ze({authToken:n}),t).then((function(){a.resolve()})).catch((function(e){a.reject(e)}))})),t.abrupt("return",a.promise);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"onReconnect",value:function(e,n){var r=n.resetReconnectCount,a=void 0!==r&&r;return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe,this._resetConnect&&a&&this._resetConnect(),this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),e.abrupt("return",n.promise);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"onDisconnect",value:function(e,n){n.error;var r=n.autoReconnect,a=void 0===r||r;return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(S.connectionCanceled),t.next=4,e.changeState(new Ye({autoReconnect:a}),r);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"onDisconnectWebSocket",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(S.connectionCanceled),t.next=4,e.changeState(new We,r);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"onLogout",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(S.connectionCanceled),t.next=4,e.changeState(new ze,r);case 4:case"end":return t.stop()}}),n,this)})))}}]),a}(Ke),Xe=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=ce.CONNECTED,e.name="connected",e}return s(a,[{key:"onReconnect",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.disconnect();case 3:return t.next=5,e.changeState(new Je,r);case 5:case"end":return t.stop()}}),n)})))}},{key:"onDisconnect",value:function(e,n){var r=n.autoReconnect;return b(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.changeState(new Ye({autoReconnect:r}),a);case 3:case"end":return t.stop()}}),n)})))}},{key:"onDisconnectWebSocket",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new We,r);case 3:case"end":return t.stop()}}),n)})))}},{key:"onLogout",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),t.next=3,e.changeState(new ze,r);case 3:case"end":return t.stop()}}),n)})))}}]),a}(Ke),Ze=function(e){i(a,e);var n=f(a);function a(e){var t,s=e.authToken;return r(this,a),(t=n.call(this)).type=ce.CONNECTING,t.name="connecting",t._authToken="",t._haltConnect=null,t._callbacks=[],t._authToken=s,t}return s(a,[{key:"_halt",value:function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=null)}},{key:"_flushCallbacks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._haltConnect=null,this._callbacks.forEach((function(t){return t(e)}))}},{key:"run",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Date.now(),a=new pe,this._callbacks.push((function(e){return e?a.reject(e):a.resolve()})),n.prev=3,n.next=6,He((function(n){return b(s,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._haltConnect=n,t.prev=1,t.next=4,e.connect(this._authToken);case 4:t.next=16;break;case 6:if(t.prev=6,t.t0=t.catch(1),e.clearLoginTimer(),!(t.t0 instanceof S)){t.next=15;break}t.t1=t.t0.code,t.next=t.t1===w.CONNECTION_CANCELED?13:15;break;case 13:return n(t.t0),t.abrupt("return");case 15:throw t.t0;case 16:case"end":return t.stop()}}),r,this,[[1,6]])})))}),e.sdkState.websocket.connectMaxRetry);case 6:return n.next=8,e.changeState(new Xe,r);case 8:je((function(){return b(s,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._flushCallbacks(null),e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId)}));case 2:case"end":return t.stop()}}),n,this)})))})),n.next=24;break;case 11:if(n.prev=11,n.t0=n.catch(3),I(n.t0)){n.next=23;break}return n.next=16,e.disconnect();case 16:if(!(n.t0 instanceof S)){n.next=20;break}if(n.t0.code===w.CONNECTION_CANCELED){n.next=20;break}return n.next=20,e.changeState(new $e,r);case 20:je((function(){return b(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._flushCallbacks(n.t0);case 1:case"end":return e.stop()}}),e,this)})))})),n.next=24;break;case 23:throw n.t0;case 24:return n.abrupt("return",a.promise);case 25:case"end":return n.stop()}}),n,this,[[3,11]])})))}},{key:"onConnect",value:function(e){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new pe,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),e.abrupt("return",n.promise);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"onDisconnect",value:function(e,n){var r=n.error,a=void 0===r?null:r,s=n.autoReconnect;return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Date.now(),this._halt(null!=a?a:S.connectionCanceled),!e.hasSession){t.next=7;break}return t.next=5,e.changeState(new Ye({autoReconnect:s}),r);case 5:t.next=9;break;case 7:return t.next=9,e.changeState(new ze,r);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"onDisconnectWebSocket",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Date.now(),this._halt(S.connectionCanceled),!e.hasSession){t.next=7;break}return t.next=5,e.changeState(new We,r);case 5:t.next=9;break;case 7:return t.next=9,e.changeState(new ze,r);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"onLogout",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),this._halt(S.connectionCanceled),t.next=4,e.changeState(new ze,r);case 4:case"end":return t.stop()}}),n,this)})))}}]),a}(Ke),$e=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).type=ce.INITIALIZED,e.name="initialized",e}return s(a,[{key:"onConnect",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Date.now(),t.next=3,e.changeState(new Ze({authToken:n}),a);case 3:case"end":return t.stop()}}),r)})))}}]),a}(Ke),et=function(e){i(n,e);var t=f(n);function n(){return r(this,n),t.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})}return s(n)}(he),tt=function(){function e(t){var n=t.pingDelegate,a=t.sdkState,s=t.logger;r(this,e),this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=n,this.sdkState=a,this._logger=s}return s(e,[{key:"isWaiting",get:function(){return!!this._pingTimeoutTimer}},{key:"ping",value:function(){var e,t=this,n=new et;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null),this.pingDelegate.error(null)}return n}},{key:"pong",value:function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)}},{key:"refreshTimer",value:function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)}},{key:"start",value:function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()}},{key:"stop",value:function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)}}]),e}(),nt=1048576,rt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.emojiHash=t.emoji_hash||"",this.uploadSizeLimit=t.file_upload_size_limit?t.file_upload_size_limit*nt:Number.MAX_SAFE_INTEGER,this.useReaction=!!t.use_reaction,this.applicationAttributes=t.application_attributes||[],this.premiumFeatureList=t.premium_feature_list||[],this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history")}return s(e,null,[{key:"payloadify",value:function(e){return{emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/nt,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction}}}]),e}(),at=function(){function e(t){r(this,e),this._iid="",this._iid=t}return s(e,null,[{key:"payloadify",value:function(e){return e?{}:null}}]),e}(),st=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.metadata;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Ee,"/").concat(s,"/metadata"),a.params={metadata:i},a}return s(n)}($),it=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).metaData=a,s}return s(n)}(ee),ot=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.metadata,o=e.upsert;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(s,"/metadata"),a.params={metadata:i,upsert:o},a}return s(n)}($),ut=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).metadata=a,s}return s(n)}(ee),ct=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.metadataKey;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(s,"/metadata/").concat(i),a}return s(n)}($),lt=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(s,"/metadata"),a}return s(n)}($),ht=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},dt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=JSON.parse(JSON.stringify(e));return t&&t(n),n},pt=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};e.UserOnlineState=void 0,(ve=e.UserOnlineState||(e.UserOnlineState={})).ONLINE="online",ve.OFFLINE="offline",ve.NON_AVAILABLE="nonavailable";var ft,vt=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h,d,p,f,v,_,m,y;return r(this,u),(s=a.call(this,t)).userId=null!==(o=null!==(i=n.guest_id)&&void 0!==i?i:n.user_id)&&void 0!==o?o:"",s.nickname=null!==(l=null!==(c=n.nickname)&&void 0!==c?c:n.name)&&void 0!==l?l:"",s.plainProfileUrl=null!==(d=null!==(h=n.profile_url)&&void 0!==h?h:n.image)&&void 0!==d?d:"",s.requireAuth=null!==(p=n.require_auth_for_profile_image)&&void 0!==p&&p,s.metaData=null!==(f=n.metadata)&&void 0!==f?f:{},s.connectionStatus=e.UserOnlineState.NON_AVAILABLE,O(e.UserOnlineState,n.is_online)?s.connectionStatus=n.is_online:U("boolean",n.is_online)&&(s.connectionStatus=n.is_online?e.UserOnlineState.ONLINE:e.UserOnlineState.OFFLINE),s.isActive=null===(v=n.is_active)||void 0===v||v,s.lastSeenAt=null!==(_=n.last_seen_at)&&void 0!==_?_:null,s.preferredLanguages=n.preferred_languages?g(n.preferred_languages):null,s.friendDiscoveryKey=null!==(m=n.friend_discovery_key)&&void 0!==m?m:null,s.friendName=null!==(y=n.friend_name)&&void 0!==y?y:null,s}return s(u,[{key:"profileUrl",get:function(){var e=At.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl}},{key:"serialize",value:function(){return ht(this)}},{key:"_isValidMetaData",value:function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return U("string",e)}))}},{key:"_applyMetaData",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e).forEach((function(r){n?delete t.metaData[r]:t.metaData[r]=e[r]}))}},{key:"createMetaData",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(this._isValidMetaData(e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new st({userId:a.userId,metadata:e}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(it),c=u.metaData,this._applyMetaData(c),t.abrupt("return",this.metaData);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"updateMetaData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(this._isValidMetaData(e)).throw(S.invalidParameters),a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new ot({userId:s.userId,metadata:e,upsert:n}),t.next=5,i.send(o);case 5:return u=t.sent,c=u.as(ut),l=c.metadata,this._applyMetaData(l),t.abrupt("return",this.metaData);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"deleteMetaData",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new ct({userId:a.userId,metadataKey:e}),t.next=5,s.send(i);case 5:return this._applyMetaData((u=!0,(o=e)in(n={})?Object.defineProperty(n,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[o]=u,n),!0),t.abrupt("return",this.metaData);case 7:case"end":return t.stop()}var n,o,u}),n,this)})))}},{key:"deleteAllMetaData",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new lt({userId:r.userId}),e.next=4,a.send(s);case 4:this.metaData={};case 5:case"end":return e.stop()}}),e,this)})))}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(u),"payloadify",this).call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})):null}}]),u}(at),_t=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userProfile;return r(this,n),(a=t.call(this)).userProfile=s,a}return s(n)}(J),mt=function(){function e(t,n){var a,s,i,o,u,c,l,h,d,p,f,v,_,m;r(this,e),this._iid=t,this.appInfo=new rt(n),this.user=new vt(t,n),this.connectedAt=null!==(a=n.login_ts)&&void 0!==a?a:0,this.firstConnectedAt=0,this.pingInterval=null!==(s=n.ping_interval)&&void 0!==s?s:15e3,this.pongTimeout=null!==(i=n.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(u=null===(o=n.reconnect)||void 0===o?void 0:o.interval)&&void 0!==u?u:3e3,this.reconnectMaxInterval=null!==(l=null===(c=n.reconnect)||void 0===c?void 0:c.max_interval)&&void 0!==l?l:6e4,this.reconnectRetryCount=null!==(d=null===(h=n.reconnect)||void 0===h?void 0:h.retry_cnt)&&void 0!==d?d:5,this.reconnectIntervalMultiple=null!==(f=null===(p=n.reconnect)||void 0===p?void 0:p.mul)&&void 0!==f?f:2,this.maxUnreadCountOnSuperGroup=null!==(v=n.max_unread_cnt_on_super_group)&&void 0!==v?v:100,this.profileImageEncryption=!!n.profile_image_encryption,this.concurrentCallLimit=null!==(_=n.concurrent_call_limit)&&void 0!==_?_:5,this.backOffDelay=null!==(m=n.back_off_delay)&&void 0!==m?m:100}return s(e,[{key:"apply",value:function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=At.of(this._iid);r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}},r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new _t({userProfile:this}))}}],[{key:"payloadify",value:function(e){return Object.assign(Object.assign(Object.assign({},vt.payloadify(e.user)),rt.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})}}]),e}(),gt=function(e){i(a,e);var n=f(a);function a(e,t,s){var i,o;return r(this,a),(i=n.call(this,e,t,s)).error=null,i.userProfile=new mt(e,s),i.deviceTokenLastDeletedAt=s.device_token_last_deleted_at,i.key=s.key,i.ekey=null!==(o=s.ekey)&&void 0!==o?o:"",i.error=s.error?new S(s):null,i}return s(a,[{key:"applyTo",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.error){t.next=12;break}if(!(r=At.of(e))){t.next=9;break}return a=r.sessionManager,t.next=6,a.login(this);case 6:this.userProfile.apply(),t.next=10;break;case 9:throw S.lostInstance;case 10:t.next=13;break;case 12:throw this.error;case 13:case"end":return t.stop()}}),n,this)})))}}],[{key:"asError",value:function(e){return new a(null,"LOGI",Object.assign({user_id:null,error:!0},e))}}]),a}(oe),yt=function(e){i(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).enabled=e,a}return s(n)}(J),kt=function(e){i(a,e);var n=f(a);function a(e,t){var s,i=t.sdkState,o=t.cacheContext,u=t.connectionHandlers,c=t.sessionManager,l=t.websocketClient,h=t.dispatcher,d=t.logger,p=t.entryState,f=void 0===p?new $e:p;return r(this,a),(s=n.call(this))._currentState=null,s._loginTimer=null,s._unresolvedLogi=null,s._stateUpdatedAt=0,s._connectingAt=0,s._connectionRequestQueue=[],s._iid=e,s.sdkState=i,s.cacheContext=o,s.connectionHandlers=u,s._sessionManager=c,s._websocketClient=l,s._dispatcher=h,s._logger=d,s._currentState=f,s.sdkState.websocket.pingerDisabled||(s._pinger=new tt({pingDelegate:{send:function(e){return s._websocketClient.send(e)},error:function(e){return s._websocketClient.error(e)}},sdkState:s.sdkState,logger:d})),s._websocketClient.on("open",(function(){s._tryResolveConnectionRequest()})).on("message",(function(e){if("LOGI"===e.code)s.clearLoginTimer(),s._dispatcher.dispatch(e.as(gt))})).on("ping-refresh",(function(){var e;return null===(e=s._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=s._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=s._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){return s._rejectConnectionRequest(S.networkError)})),s._dispatcher.on((function(e){e instanceof gt&&(s._unresolvedLogi=e,s._tryResolveConnectionRequest())})),s}return s(a,[{key:"currentState",get:function(){return this._currentState}},{key:"hasSession",get:function(){return this._sessionManager.auth.hasSession}},{key:"changeState",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n>=this._stateUpdatedAt)){t.next=8;break}return this._currentState=e,this._stateUpdatedAt=n,this._dispatcher.dispatch(new _e({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),t.next=7,this._currentState.run(this);case 7:return t.abrupt("return",!0);case 8:return t.abrupt("return",!1);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"_tryResolveConnectionRequest",value:function(){var e;return b(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this._unresolvedLogi,!this._websocketClient.isOpen||!r){t.next=18;break}if(this._unresolvedLogi=null,r.error){t.next=15;break}return t.next=6,r.applyTo(this._iid);case 6:a=r.userProfile,this._enableStatLog(a.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish")),this._statLogConnection(null),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground",t.next=18;break;case 15:this._sessionManager.auth.authToken=null,(r.error.isSessionKeyExpiredError||r.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new ne),this._rejectConnectionRequest(r.error);case 18:case"end":return t.stop()}}),n,this)})))}},{key:"_rejectConnectionRequest",value:function(e){var t;null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0&&(this._connectionRequestQueue.forEach((function(t){return t.reject(e)})),this._connectionRequestQueue=[],this._statLogConnection(e))}},{key:"_url",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.sdkState,n=t.appId,r=t.appVersion,a=t.userId,s=t.extensions,i=this.cacheContext.localCacheEnabled,o=this._sessionManager.auth,u=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"],c=["gcm","huawei","apns"],l=s.sb_syncmanager?"s".concat(s.sb_syncmanager):"",h=s.sb_uikit?"u".concat(s.sb_uikit):"",d="JS/c".concat(C.SDK_VERSION,"/").concat(l,"/").concat(h);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(C.OS_VERSION),"&sv=").concat(encodeURIComponent(C.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(o.hasSession?"&key=".concat(encodeURIComponent(o.sessionKey)):"&user_id=".concat(encodeURIComponent(a),"&access_token=").concat(encodeURIComponent(e)),"&active=1&device_token_types=").concat(encodeURIComponent(c.join(",")),"&SB-User-Agent=").concat(d,"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(u))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(i?1:0,"&include_poll_details=1")}},{key:"_enableStatLog",value:function(e){this._dispatcher.dispatch(new yt(e))}},{key:"_statLogConnection",value:function(e){this._dispatcher.dispatch(new re(new se({type:Z.WEBSOCKET_CONNECT,data:{host_url:this.sdkState.websocket.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))}},{key:"connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return b(this,void 0,void 0,t().mark((function n(){var r,a,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._url(e),a=new pe,this._connectionRequestQueue.push(a),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){s._loginTimer=null,s._dispatcher.dispatch(gt.asError(S.loginTimeout))}),this.sdkState.websocket.responseTimeout),this._sessionManager.auth.authToken=e,this._websocketClient.connect(r)),t.abrupt("return",a.promise);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"cancelConnectForRetry",value:function(){this._dispatcher.dispatch(gt.asError(S.connectionRenew))}},{key:"disconnect",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._websocketClient.disconnect();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"logout",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sdkState.userId=null,this._unresolvedLogi=null,e.next=4,this._sessionManager.clear();case 4:return e.next=6,this.disconnect();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearLoginTimer",value:function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=null)}}]),a}(W),Et=function(){function e(t,n){var a=n.sdkState,s=n.cacheContext,i=n.connectionHandlers,o=n.sessionManager,u=n.websocketClient,c=n.dispatcher,l=n.logger,h=n.disableWebSocketCloseEventHandling,d=void 0!==h&&h;r(this,e),this._context=null,this._disableWebSocketCloseEventHandling=!1,this._logger=l,this._disableWebSocketCloseEventHandling=d,this._context=new kt(t,{sdkState:a,cacheContext:s,connectionHandlers:i,sessionManager:o,websocketClient:u,dispatcher:c,logger:l}),this._sdkState=a,this._sessionManager=o,this._websocketClient=u}return s(e,[{key:"_registerEventDispatcher",value:function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",(function(){e.isConnected||(e._logger.debug("try reconnect by session token refresh"),e.reconnect())})).on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),e.reconnect())})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"===e._sdkState.appState&&(e._sessionManager.isRefreshingAuthToken||(e._logger.debug("try reconnect by websocket connection closed"),e.reconnect()))})))}},{key:"_clearEventDispatcher",value:function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=null),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=null)}},{key:"isConnected",get:function(){return this._context.currentState.type===ce.CONNECTED}},{key:"isConnecting",get:function(){var e=this._context.currentState;return e.type===ce.CONNECTING||e.type===ce.RECONNECTING}},{key:"connect",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._context.currentState,t.next=3,r.onConnect(this._context,e);case 3:this._registerEventDispatcher();case 4:case"end":return t.stop()}}),n,this)})))}},{key:"reconnect",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,e.next=3,n.onReconnect(this._context,{});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"resetAndReconnect",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,e.next=3,n.onReconnect(this._context,{resetReconnectCount:!0});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"background",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,e.next=3,n.onDisconnect(this._context,{autoReconnect:!1});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._context.currentState,t.next=3,r.onDisconnect(this._context,{error:e,autoReconnect:!0});case 3:case"end":return t.stop()}}),n,this)})))}},{key:"disconnectWebSocket",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,e.next=3,n.onDisconnectWebSocket(this._context);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"logout",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.currentState,this._clearEventDispatcher(),e.next=4,n.onLogout(this._context);case 4:case"end":return e.stop()}}),e,this)})))}}]),e}(),bt=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.deviceId,i=e.statLogs;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Oe),a.params={device_id:s,log_entries:i.map((function(e){return se.payloadify(e)}))},a}return s(n)}($);!function(e){e[e.PENDING=0]="PENDING",e[e.ENABLED=1]="ENABLED",e[e.DISABLED=2]="DISABLED"}(ft||(ft={}));var wt,xt=function(){function e(t){var n=t.cacheContext,a=t.requestQueue,s=t.dispatcher,i=t.baseLimit,o=void 0===i?100:i,u=t.maxLimit,c=void 0===u?1e3:u,l=t.minLimit,h=void 0===l?10:l;r(this,e),this.queue=[],this.enabledstate=ft.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this.deviceId=K(),this.cacheContext=n,this.requestQueue=a,this.dispatcher=s,this.baseLimit=o,this.limit=o,this.maxLimit=c,this.minLimit=h}return s(e,[{key:"isEnabled",get:function(){return this.enabledstate===ft.ENABLED}},{key:"_save",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cacheContext.localCacheEnabled){e.next=3;break}return e.next=3,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return se.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"_flush",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=22;break}if(this.isFlushing){e.next=22;break}if(this.isFlushing=!0,e.prev=3,!((n=this.queue.slice(0,Math.min(this.limit,this.maxLimit))).length>0)){e.next=12;break}return r=new bt({deviceId:this.deviceId,statLogs:n}),e.next=9,this.requestQueue.send(r);case 9:return this.queue=this.queue.slice(n.length),e.next=12,this._save();case 12:this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),this.limit=this.limit+20;case 19:return e.prev=19,this.isFlushing=!1,e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[3,16,19,22]])})))}},{key:"init",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.key=e,!this.cacheContext.localCacheEnabled){t.next=16;break}return t.next=4,this.cacheContext.preference.get(this.key);case 4:if(!(r=t.sent)){t.next=16;break}if(this.deviceId=r.deviceId,this.queue=r.statLogs.map((function(e){return new se({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=r.generation,this.lastFlushedAt=r.lastFlushedAt,!(Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit)){t.next=16;break}return a=Math.min(Math.floor(18e4*Math.random()),100),t.next=14,Ge(a);case 14:return t.next=16,this._flush();case 16:this.dispatcher.on((function(e){if(e instanceof re){var t=e.statLog;s.put(t)}else e instanceof yt&&(s.enabledstate=e.enabled?ft.ENABLED:ft.DISABLED,s.isEnabled?s.queue.length>=s.limit&&s._flush():s.clear())}));case 17:case"end":return t.stop()}}),n,this)})))}},{key:"put",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabledstate===ft.DISABLED){t.next=7;break}return this.queue.push(e),t.next=4,this._save();case 4:if(!(this.queue.length>=this.limit)){t.next=7;break}return t.next=7,this._flush();case 7:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.queue=[],this.generation=1,e.next=4,this._save();case 4:case"end":return e.stop()}}),e,this)})))}}]),e}();e.LogLevel=void 0,(wt=e.LogLevel||(e.LogLevel={}))[wt.NONE=0]="NONE",wt[wt.VERBOSE=1]="VERBOSE",wt[wt.DEBUG=2]="DEBUG",wt[wt.INFO=3]="INFO",wt[wt.WARN=4]="WARN",wt[wt.ERROR=5]="ERROR";var Ct,Tt,It,St,Nt=function(){function t(){r(this,t),this.level=e.LogLevel.WARN}return s(t,[{key:"verbose",value:function(){if(this.level<=e.LogLevel.VERBOSE){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[verbose]"].concat(r))}}},{key:"debug",value:function(){if(this.level<=e.LogLevel.DEBUG){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[debug]"].concat(r))}}},{key:"info",value:function(){if(this.level<=e.LogLevel.INFO){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).log.apply(t,["[info]"].concat(r))}}},{key:"warn",value:function(){if(this.level<=e.LogLevel.WARN){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).warn.apply(t,["[warn]"].concat(r))}}},{key:"error",value:function(){if(this.level<=e.LogLevel.ERROR){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];(t=console).error.apply(t,["[error]"].concat(r))}}}]),t}(),Mt={},At=function(){function t(n,a){var s,i,o,u,c,l,h,d,p;if(r(this,t),this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Mt[n]){Mt[n]=this;var f=null!==(s=a.options)&&void 0!==s?s:new H,v=this.sdkState={appId:a.appId,appVersion:null!==(i=a.appVersion)&&void 0!==i?i:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(o=a.apiHost)&&void 0!==o?o:"https://api-".concat(a.appId,".sendbird.com")},websocket:{host:null!==(u=a.websocketHost)&&void 0!==u?u:"wss://ws-".concat(a.appId,".sendbird.com"),pingerDisabled:!!a.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new qe,responseTimeout:f.websocketResponseTimeout},sessionTokenRefreshTimeout:f.sessionTokenRefreshTimeout};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var _=this.logger=new Nt;this.logger.level=null!==(c=a.logLevel)&&void 0!==c?c:e.LogLevel.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var m=this.cacheContext=new Q({encryption:a.encryption,store:a.store,localCacheEnabled:null!==(l=a.localCacheEnabled)&&void 0!==l&&l});this.debugMode=null!==(h=a.debugMode)&&void 0!==h&&h,this.maxSuperGroupChannelUnreadCount=C.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=f.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=f.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=f.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var g=this.dispatcher=new Y,y=new B;this.requestQueue=new me(n,{auth:y,sdkState:v,dispatcher:g,logger:_}),this.sessionManager=new Be({auth:y,cacheContext:m,sdkState:v,dispatcher:g,requestQueue:this.requestQueue,logger:_}),this.connectionManager=new Et(n,{sdkState:v,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:g,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(d=a.disableWebSocketCloseEventHandling)&&void 0!==d&&d,logger:_}),this.statLogCollector=new xt({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:g}),this.appStateToggleEnabled=null===(p=a.appStateToggleEnabled)||void 0===p||p}return Mt[n]}return s(t,null,[{key:"of",value:function(e){if(Mt[e])return Mt[e];throw S.lostInstance}},{key:"clear",value:function(e){Mt[e]&&delete Mt[e]}}]),t}();e.PushTokenRegistrationState=void 0,(Ct=e.PushTokenRegistrationState||(e.PushTokenRegistrationState={})).SUCCESS="success",Ct.PENDING="pending",Ct.ERROR="error",e.PushTriggerOption=void 0,(Tt=e.PushTriggerOption||(e.PushTriggerOption={})).DEFAULT="default",Tt.ALL="all",Tt.MENTION_ONLY="mention_only",Tt.OFF="off",e.PushTokenType=void 0,(It=e.PushTokenType||(e.PushTokenType={})).FCM="gcm",It.APNS="apns",It.UNKNOWN="unknown",e.PushTemplate=void 0,(St=e.PushTemplate||(e.PushTemplate={})).ALTERNATIVE="alternative",St.DEFAULT="default";var Ut,Ot,Rt,Dt,Lt,Pt,Ft,Gt=function(){function e(){r(this,e)}return s(e,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,a=t.sessionManager,s=t.requestQueue,i=t.logger;t.onlineDetector;var o=t.cacheContext,u=void 0===o?null:o;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=a,this._requestQueue=s,this._logger=i}}]),e}(),qt=function(e){i(n,e);var t=f(n);function n(e){var a;if(r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(be),a.params=X({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var s=0;s<e.thumbnailSizes.length;s++){var i=e.thumbnailSizes[s],o=i.maxWidth,u=i.maxHeight;a.params["thumbnail".concat(s+1)]="".concat(o,",").concat(u)}return a.requestId=e.requestId,a}return s(n)}($),Ht=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o,u;return r(this,n),(s=t.call(this,e,a)).url=a.url,s.fileSize=null!==(i=a.file_size)&&void 0!==i?i:0,s.thumbnailSizes=null!==(o=a.thumbnails)&&void 0!==o?o:[],s.requireAuth=null!==(u=a.require_auth)&&void 0!==u&&u,s}return s(n)}(ee);e.MessageType=void 0,(Ut=e.MessageType||(e.MessageType={})).BASE="base",Ut.USER="user",Ut.FILE="file",Ut.ADMIN="admin",e.MessageTypeFilter=void 0,(Ot=e.MessageTypeFilter||(e.MessageTypeFilter={})).ALL="",Ot.USER="MESG",Ot.FILE="FILE",Ot.ADMIN="ADMM",function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}(Rt||(Rt={})),e.MentionType=void 0,(Dt=e.MentionType||(e.MentionType={})).USERS="users",Dt.CHANNEL="channel",e.ReplyType=void 0,(Lt=e.ReplyType||(e.ReplyType={})).ALL="all",Lt.NONE="none",Lt.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",e.PushNotificationDeliveryOption=void 0,(Pt=e.PushNotificationDeliveryOption||(e.PushNotificationDeliveryOption={})).DEFAULT="default",Pt.SUPPRESS="suppress",e.SendingStatus=void 0,(Ft=e.SendingStatus||(e.SendingStatus={})).PENDING="pending",Ft.SCHEDULED="scheduled",Ft.SUCCEEDED="succeeded",Ft.FAILED="failed",Ft.CANCELED="canceled";var jt,Vt=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o,u;return r(this,n),(s=t.call(this,e)).replyCount=0,s.mostRepliedUsers=null,s.lastRepliedAt=0,s.updatedAt=0,s.replyCount=null!==(i=a.reply_count)&&void 0!==i?i:0,s.mostRepliedUsers=a.hasOwnProperty("most_replies")&&D("object",a.most_replies)?a.most_replies.map((function(e){return new vt(s._iid,e)})):[],s.lastRepliedAt=null!==(o=a.last_replied_at)&&void 0!==o?o:0,s.updatedAt=null!==(u=a.updated_at)&&void 0!==u?u:0,s}return s(n,null,[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(n),"payloadify",this).call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((function(e){return vt.payloadify(e)})):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})):null}}]),n}(at);e.ReactionEventOperation=void 0,(jt=e.ReactionEventOperation||(e.ReactionEventOperation={})).ADD="add",jt.DELETE="delete";var Qt,Bt,Kt,zt,Wt=s((function t(n){r(this,t),this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var a=U("string",n.msg_id)?parseInt(n.msg_id):n.msg_id,s=n.user_id,i=n.operation?n.operation.toLowerCase():null,o=n.reaction,u=n.updated_at;a&&U("string",s)&&U("string",i)&&O(e.ReactionEventOperation,i)&&U("string",o)&&o&&U("number",u)&&(this.messageId=a,this.userId=s,this.key=o,this.operation=i,this.updatedAt=u)})),Yt=function(){function t(e){var n;r(this,t);var a=e.key,s=null!==(n=g(e.user_ids))&&void 0!==n?n:[],i=e.updated_at;U("string",a)&&a&&D("string",s)&&s.length>0&&U("number",i)&&(this.key=a,this.userIds=s,this.updatedAt=i);var o,u={},c=E(this.userIds);try{for(c.s();!(o=c.n()).done;){u[o.value]=this.updatedAt}}catch(e){c.e(e)}finally{c.f()}this._version=u}return s(t,[{key:"isEmpty",get:function(){return 0===this.userIds.length}},{key:"applyEvent",value:function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var n=this.userIds.indexOf(t.userId);switch(t.operation){case e.ReactionEventOperation.ADD:n<0&&this.userIds.push(t.userId);break;case e.ReactionEventOperation.DELETE:n>=0&&this.userIds.splice(n,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}}}],[{key:"payloadify",value:function(e){return e?X({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null}}]),t}(),Jt=function(){function e(t){r(this,e),this.key=t.key,this.value=D("string",t.value)?g(t.value):[]}return s(e,null,[{key:"payloadify",value:function(e){var t;return e?X({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null}}]),e}(),Xt=function(){function e(t){r(this,e),this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=t.url,t.hasOwnProperty("secure_url")&&(this.secureUrl=t.secure_url),t.hasOwnProperty("type")&&(this.type=t.type),t.hasOwnProperty("width")&&(this.width=t.width),t.hasOwnProperty("height")&&(this.height=t.height),t.hasOwnProperty("alt")&&(this.alt=t.alt)}return s(e,null,[{key:"payloadify",value:function(e){var t,n;return e?X({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null}}]),e}(),Zt=function(){function e(t){r(this,e),this.title=null,this.url=null,this.description=null,this.defaultImage=null,t.hasOwnProperty("og:title")&&(this.title=t["og:title"]),t.hasOwnProperty("og:url")&&(this.url=t["og:url"]),t.hasOwnProperty("og:description")&&(this.description=t["og:description"]),t.hasOwnProperty("og:image")&&(this.defaultImage=new Xt(t["og:image"]))}return s(e,null,[{key:"payloadify",value:function(e){return e?X({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Xt.payloadify(e.defaultImage):null}):null}}]),e}(),$t=function(){function e(t){var n,a;r(this,e),this.name=null,this.volume=0,this.name=null!==(n=t.name)&&void 0!==n?n:"default",this.volume=null!==(a=t.volume)&&void 0!==a?a:1}return s(e,[{key:"serialize",value:function(){return{name:this.name,volume:this.volume}}}],[{key:"payloadify",value:function(e){return e?X({name:e.name,volume:e.volume}):null}}]),e}();e.ChannelType=void 0,(Qt=e.ChannelType||(e.ChannelType={})).BASE="base",Qt.GROUP="group",Qt.OPEN="open",e.Role=void 0,(Bt=e.Role||(e.Role={})).OPERATOR="operator",Bt.NONE="none",e.ScheduledStatus=void 0,(Kt=e.ScheduledStatus||(e.ScheduledStatus={})).PENDING="pending",Kt.SENT="sent",Kt.FAILED="failed",Kt.CANCELED="canceled",function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed"}(zt||(zt={}));var en,tn=function(t){switch(t){case e.MessageType.BASE:return"";case e.MessageType.USER:return"MESG";case e.MessageType.FILE:return"FILE";case e.MessageType.ADMIN:return"ADMM"}},nn=function(t){i(a,t);var n=f(a);function a(t,s){var i,o,u,c,l,h,d,p,f,v,_,m,g,y,k;r(this,a),(i=n.call(this,t)).channelUrl=null,i.channelType=e.ChannelType.BASE,i.messageId=0,i.parentMessageId=null,i.parentMessage=null,i.silent=!1,i.isOperatorMessage=!1,i.messageType=e.MessageType.BASE,i.data=null,i.customType=null,i.mentionType=null,i.mentionedUsers=[],i.mentionedUserIds=[],i.mentionedMessageTemplate=null,i.threadInfo=null,i.reactions=[],i.metaArrays=[],i.ogMetaData=null,i.appleCriticalAlertOptions=null,i.createdAt=0,i.updatedAt=0,i.scheduledInfo=null,i.extendedMessage={},i._scheduledStatus=null,i.messageId=null!==(u=null!==(o=s.msg_id)&&void 0!==o?o:s.message_id)&&void 0!==u?u:0,i.channelUrl=s.channel_url,i.channelType=O(e.ChannelType,s.channel_type)?s.channel_type:e.ChannelType.GROUP,s.channel&&(s.channel.channel_url&&(i.channelUrl=s.channel.channel_url),s.channel.channel_type&&(i.channelType=s.channel.channel_type)),i.parentMessageId=null!==(c="string"==typeof s.parent_message_id?parseInt(s.parent_message_id):s.parent_message_id)&&void 0!==c?c:0,i.data=null!==(l=s.data)&&void 0!==l?l:"",i.customType=null!==(h=s.custom_type)&&void 0!==h?h:"",i.mentionType=O(e.MentionType,s.mention_type)?s.mention_type:null;var E=s.mentioned_users;i.mentionedUsers=E?E.map((function(e){return new vt(i._iid,e)})):null;var b=s.mentioned_user_ids;i.mentionedUserIds=null!=b?b:null,i.mentionedUsers&&!i.mentionedUserIds&&(i.mentionedUserIds=i.mentionedUsers.map((function(e){return e.userId}))),i.mentionedMessageTemplate=null!==(d=s.mentioned_message_template)&&void 0!==d?d:"",i.threadInfo=s.thread_info?new Vt(i._iid,s.thread_info):null,i.reactions=s.reactions?s.reactions.map((function(e){return new Yt(e)})):[];for(var w=null!==(p=s.metaarray)&&void 0!==p?p:{},x=null!==(f=s.metaarray_key_order)&&void 0!==f?f:Object.keys(w).sort((function(e,t){return e.localeCompare(t)})),C=0;C<x.length;C++){var T=x[C];i.metaArrays.push(new Jt({key:T,value:w[T]||[]}))}return s.sorted_metaarray&&(i.metaArrays=s.sorted_metaarray.map((function(e){return new Jt(e)}))),i.ogMetaData=s.og_tag?new Zt(s.og_tag):null,i.silent=null!==(v=s.silent)&&void 0!==v&&v,i.isOperatorMessage=null!==(_=s.is_op_msg)&&void 0!==_&&_,i.appleCriticalAlertOptions=s.apple_critical_alert_options?new $t(s.apple_critical_alert_options):null,i.createdAt=null!==(g=null!==(m=s.created_at)&&void 0!==m?m:s.ts)&&void 0!==g?g:0,i.updatedAt=null!==(y=s.updated_at)&&void 0!==y?y:0,"number"==typeof s.scheduled_message_id&&"number"==typeof s.scheduled_at&&s.scheduled_status&&(i.scheduledInfo={scheduledMessageId:s.scheduled_message_id,scheduledAt:s.scheduled_at},i._scheduledStatus=s.scheduled_status),i.extendedMessage=null!==(k=s.extended_message)&&void 0!==k?k:{},i}return s(a,[{key:"isIdentical",value:function(e){return this.messageId===e.messageId}},{key:"isEqual",value:function(e){return A(this,e)}},{key:"isUserMessage",value:function(){return this.messageType===e.MessageType.USER}},{key:"isFileMessage",value:function(){return this.messageType===e.MessageType.FILE}},{key:"isAdminMessage",value:function(){return this.messageType===e.MessageType.ADMIN}},{key:"serialize",value:function(){return ht(this)}},{key:"getMetaArraysByKeys",value:function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))}},{key:"applyThreadInfoUpdateEvent",value:function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1}},{key:"applyReactionEvent",value:function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Yt(Yt.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}}},{key:"applyParentMessage",value:function(e){if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return!1}}],[{key:"payloadify",value:function(e){var t,n,r,s;return e?X(Object.assign(Object.assign({},_(o(a),"payloadify",this).call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:tn(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(t=e.mentionedUsers)||void 0===t?void 0:t.map((function(e){return vt.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?Vt.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return Yt.payloadify(e)})),sorted_metaarray:null===(n=e.metaArrays)||void 0===n?void 0:n.map((function(e){return Jt.payloadify(e)})),og_tag:Zt.payloadify(e.ogMetaData),silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:$t.payloadify(e.appleCriticalAlertOptions),created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(r=e.scheduledInfo)||void 0===r?void 0:r.scheduledMessageId,scheduled_at:null===(s=e.scheduledInfo)||void 0===s?void 0:s.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})):null}}]),a}(at),rn=function(t){i(a,t);var n=f(a);function a(t,s){var i;return r(this,a),(i=n.call(this,t,s)).role=null,i.isBlockedByMe=!1,i.role=O(e.Role,s.role)?s.role:e.Role.NONE,s.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=s.is_blocked_by_me),i}return s(a,null,[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(a),"payloadify",this).call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})):null}}]),a}(vt),an=function(t){i(a,t);var n=f(a);function a(t,s){var i,o,u,c,l;if(r(this,a),(i=n.call(this,t,s)).sender=null,i.reqId="",i.replyToChannel=!1,i.sendingStatus=null,i.errorCode=0,i.sender=s.user?new rn(i._iid,s.user):s.sender_id,i.reqId=null!==(u=null!==(o=s.req_id)&&void 0!==o?o:s.request_id)&&void 0!==u?u:"",i.replyToChannel=null!==(c=s.is_reply_to_channel)&&void 0!==c&&c,s.request_state&&O(e.SendingStatus,s.request_state)&&(i.sendingStatus=s.request_state),!i.sendingStatus)if(i.messageId>0)i.sendingStatus=e.SendingStatus.SUCCEEDED;else if(i.scheduledInfo)switch(i._scheduledStatus=s.scheduled_status,s.scheduled_status){case zt.SENT:case zt.IN_QUEUE:i.sendingStatus=e.SendingStatus.SUCCEEDED;break;case zt.PENDING:i.sendingStatus=e.SendingStatus.SCHEDULED;break;case zt.FAILED:case zt.REMOVED:i.sendingStatus=e.SendingStatus.FAILED;break;case zt.CANCELED:i.sendingStatus=e.SendingStatus.CANCELED}else i.sendingStatus=e.SendingStatus.PENDING;return i.errorCode=null!==(l=s.error_code)&&void 0!==l?l:0,i}return s(a,[{key:"isResendable",get:function(){return this.sendingStatus===e.SendingStatus.FAILED&&((t=this.errorCode)>0&&N.indexOf(t)>=0);var t}},{key:"isIdentical",value:function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(a),"payloadify",this).call(this,e)),{user:rn.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})):null}}]),a}(nn),sn=function(){function e(t){var n,a;r(this,e),this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=t.url,this.width=t.width,this.height=t.height,this.realWidth=null!==(n=t.real_width)&&void 0!==n?n:t.width,this.realHeight=null!==(a=t.real_height)&&void 0!==a?a:t.height}return s(e,[{key:"plainUrl",get:function(){return this.url.split("?auth=")[0]}}],[{key:"payloadify",value:function(e){return e?X({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null}}]),e}(),on={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:null,senderUserIdsFilter:null,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},un=function(t){return U("number",t.prevResultSize)&&U("number",t.nextResultSize)&&U("boolean",t.isInclusive)&&U("boolean",t.reverse)&&U("string",t.messageTypeFilter)&&O(e.MessageTypeFilter,t.messageTypeFilter)&&D("string",t.customTypesFilter,!0)&&D("string",t.senderUserIdsFilter,!0)&&U("boolean",t.includeMetaArray)&&U("boolean",t.includeReactions)&&U("boolean",t.includeParentMessageInfo)},cn=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l;if(r(this,u),(s=a.call(this,t,n)).message=null,s.translations={},s.message=null!==(i=n.message)&&void 0!==i?i:"",s.messageType=e.MessageType.ADMIN,s.translations=null!==(o=n.translations)&&void 0!==o?o:{},n.parent_message_info){var h=n.parent_message_info,d=Object.assign(Object.assign({},h),{message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:h.file,url:null===(c=h.file)||void 0===c?void 0:c.url,require_auth:null===(l=h.file)||void 0===l?void 0:l.require_auth});s.parentMessage=gn(t,d)}return s}return s(u,[{key:"getThreadedMessagesByTimestamp",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},on),n),pt(this.messageId>0&&U("number",e)&&un(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(u),"payloadify",this).call(this,e)),{message:e.message,translations:e.translations,parent_message_info:mn(e.parentMessage)})):null}}]),u}(nn),ln=function(){function e(t){var n,a;r(this,e),this.type=null,this.vendor=null,this.detail={},this.type=null!==(n=t.type)&&void 0!==n?n:"",this.vendor=null!==(a=t.vendor)&&void 0!==a?a:"",t.hasOwnProperty("detail")&&U("object",t.detail)&&!Array.isArray(t.detail)&&(this.detail=t.detail)}return s(e,null,[{key:"payloadify",value:function(e){return e?X({type:e.type,vendor:e.vendor,detail:e.detail}):null}}]),e}();!function(e){e.OPEN="open",e.CLOSED="closed"}(en||(en={}));var hn,dn=function(e){switch(e){case en.OPEN:return en.OPEN;case en.CLOSED:return en.CLOSED}},pn=function(e){return!e||e.text&&U("string",e.text)},fn=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o,u,c,l,h,d;return r(this,n),(s=t.call(this,e)).pollId=0,s.id=0,s.text=null,s.voteCount=0,s.createdBy=null,s.createdAt=0,s.updatedAt=0,s._lastVotedAt=0,s.pollId=null!==(i=a.poll_id)&&void 0!==i?i:0,s.id=null!==(o=a.id)&&void 0!==o?o:0,s.text=null!==(u=a.text)&&void 0!==u?u:null,s.voteCount=null!==(c=a.vote_count)&&void 0!==c?c:0,s.createdBy=null!==(l=a.created_by)&&void 0!==l?l:null,s.createdAt=null!==(h=a.created_at)&&void 0!==h?h:0,s.updatedAt=null!==(d=a.updated_at)&&void 0!==d?d:0,s}return s(n,null,[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(n),"payloadify",this).call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})):null}}]),n}(at),vn=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o,u,c,l,h,d,p,f,v,_,m,g;return r(this,n),(s=t.call(this,e)).id=0,s.title=null,s.createdAt=0,s.updatedAt=0,s.closeAt=-1,s.status=en.CLOSED,s.messageId=0,s.data=null,s.voterCount=-1,s.options=[],s.createdBy=null,s.allowUserSuggestion=!1,s.allowMultipleVotes=!1,s.votedPollOptionIds=[],s.id=null!==(i=a.id)&&void 0!==i?i:0,s.title=null!==(o=a.title)&&void 0!==o?o:null,s.createdAt=null!==(u=a.created_at)&&void 0!==u?u:0,s.updatedAt=null!==(c=a.updated_at)&&void 0!==c?c:0,s.closeAt=null!==(l=a.close_at)&&void 0!==l?l:-1,s.status=null!==(h=dn(a.status))&&void 0!==h?h:en.CLOSED,s.messageId=null!==(d=a.message_id)&&void 0!==d?d:0,s.data=null!==(p=a.data)&&void 0!==p?p:null,s.voterCount=null!==(f=a.voter_count)&&void 0!==f?f:-1,s.options=a.options?a.options.map((function(e){return new fn(s._iid,e)})):[],s.createdBy=null!==(v=a.created_by)&&void 0!==v?v:null,s.allowUserSuggestion=null!==(_=a.allow_user_suggestion)&&void 0!==_&&_,s.allowMultipleVotes=null!==(m=a.allow_multiple_votes)&&void 0!==m&&m,s.votedPollOptionIds=null!==(g=a.voted_option_ids)&&void 0!==g?g:[],s}return s(n,[{key:"_applyPollUpdatePayload",value:function(e){var t,n,r,a,s,i,o,u,c=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(a=dn(e.status))&&void 0!==a?a:this.status,this.data=null!==(s=e.data)&&void 0!==s?s:this.data,this.voterCount=null!==(i=e.voter_count)&&void 0!==i?i:this.voterCount,e.options&&(this.options=e.options.map((function(e){return new fn(c._iid,e)})),this.votedPollOptionIds=e.options.filter((function(e){return e.vote_count>0})).map((function(e){return e.id}))),this.allowUserSuggestion=null!==(o=e.allow_user_suggestion)&&void 0!==o?o:this.allowUserSuggestion,this.allowMultipleVotes=null!==(u=e.allow_multiple_votes)&&void 0!==u?u:this.allowMultipleVotes}},{key:"applyPollUpdateEvent",value:function(e){var t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)}},{key:"applyPollVoteEvent",value:function(e){if(this.id!==e.pollId)return!1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,a=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var s=t[r];a>s._lastVotedAt&&(s.voteCount=e.vote_count,s._lastVotedAt=a)}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),!0}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(n),"payloadify",this).call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map((function(e){return fn.payloadify(e)})),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})):null}}]),n}(at),_n=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h;if(r(this,u),(s=a.call(this,t,n)).message="",s.messageParams=null,s.translations={},s.translationTargetLanguages=[],s.messageSurvivalSeconds=-1,s.plugins=[],s._poll=null,s.message=n.message,s.messageType=e.MessageType.USER,s.translations=null!==(i=n.translations)&&void 0!==i?i:{},s.translationTargetLanguages=null!==(o=n.target_langs)&&void 0!==o?o:[],0===Object.keys(s.translations).length&&s.translationTargetLanguages.length>0){var d,p=E(s.translationTargetLanguages);try{for(p.s();!(d=p.n()).done;){var f=d.value;s.translations[f]=""}}catch(e){p.e(e)}finally{p.f()}}if(s.messageSurvivalSeconds=null!==(c=n.message_survival_seconds)&&void 0!==c?c:-1,s.plugins=n.plugins?n.plugins.map((function(e){return new ln(e)})):[],s._poll=n.poll?new vn(s._iid,n.poll):null,n.parent_message_info){var v=n.parent_message_info,_=Object.assign(Object.assign({},v),{created_at:v.ts,message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:v.file,url:null===(l=v.file)||void 0===l?void 0:l.url,require_auth:null===(h=v.file)||void 0===h?void 0:h.require_auth});s.parentMessage=gn(t,X(_))}return s}return s(u,[{key:"getThreadedMessagesByTimestamp",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},on),n),pt(this.messageId>0&&U("number",e)&&un(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"applyPoll",value:function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)}},{key:"poll",get:function(){return this._poll}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(u),"payloadify",this).call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return ln.payloadify(e)})),poll:vn.payloadify(e._poll),parent_message_info:mn(e.parentMessage)})):null}}]),u}(an),mn=function(t){if(t)switch(t.messageType){case e.MessageType.USER:return _n.payloadify(t);case e.MessageType.FILE:return yn.payloadify(t);case e.MessageType.ADMIN:return cn.payloadify(t)}return null},gn=function(e,t){switch(t.type){case"MESG":return new _n(e,t);case"FILE":return new yn(e,t);case"ADMM":case"BRDM":return new cn(e,t)}return null},yn=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h,d,p,f,v,_,m,g,y,k,E;r(this,u),(s=a.call(this,t,n)).messageParams=null,s.plainUrl="",s.requireAuth=!1,s.name=null,s.size=0,s.type=null,s.thumbnails=[],s.messageSurvivalSeconds=-1,s.messageType=e.MessageType.FILE;var b=null!==(i=n.file)&&void 0!==i?i:null;s.plainUrl=(null!==(c=null!==(o=null==b?void 0:b.url)&&void 0!==o?o:n.url)&&void 0!==c?c:"").split("?auth=")[0],s.name=null!==(h=null!==(l=null==b?void 0:b.name)&&void 0!==l?l:n.name)&&void 0!==h?h:"File",s.size=null!==(p=null!==(d=null==b?void 0:b.size)&&void 0!==d?d:n.size)&&void 0!==p?p:0,s.data=null!==(v=null!==(f=null==b?void 0:b.data)&&void 0!==f?f:n.custom)&&void 0!==v?v:"",s.type=b?null!==(_=b.type)&&void 0!==_?_:"":null!==(m=n.type)&&void 0!==m?m:"";var w=At.of(s._iid).sessionManager;if(s.requireAuth=null!==(g=n.require_auth)&&void 0!==g&&g,s.thumbnails=n.thumbnails?n.thumbnails.map((function(e){return new sn(Object.assign(Object.assign({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(s.requireAuth?"?auth=".concat(w.ekey):"")}))})):[],s.messageSurvivalSeconds=null!==(y=n.message_survival_seconds)&&void 0!==y?y:-1,n.parent_message_info){var x=n.parent_message_info,C=Object.assign(Object.assign({},x),{message_id:s.parentMessageId,channel_url:s.channelUrl,channel_type:s.channelType,file:x.file,url:null===(k=x.file)||void 0===k?void 0:k.url,require_auth:null===(E=x.file)||void 0===E?void 0:E.require_auth});s.parentMessage=gn(t,C)}return s}return s(u,[{key:"url",get:function(){var e=At.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl}},{key:"getThreadedMessagesByTimestamp",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},on),n),pt(this.messageId>0&&U("number",e)&&un(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getThreadedMessagesByTimestamp(this,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(u),"payloadify",this).call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:e.thumbnails.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:mn(e.parentMessage)})):null}}]),u}(an),kn=function(t){switch(t){case e.ChannelType.GROUP:return we;case e.ChannelType.OPEN:return Ce;default:return null}},En=function(t){switch(t){case e.ChannelType.GROUP:return"".concat(Se,"/group_channels");case e.ChannelType.OPEN:return"".concat(Se,"/open_channels");default:return null}},bn=function(t,n,r){switch(t){case e.MentionType.CHANNEL:return!0;case e.MentionType.USERS:if(n){var a,s=E(n);try{for(s.s();!(a=s.n()).done;){if(a.value===r)return!0}}catch(e){s.e(e)}finally{s.f()}}}return!1},wn=function(e,t,n){var r=bn(e.mentionType,e.mentionedUserIds,n),a=bn(t.mentionType,t.mentionedUserIds,n);return!r&&a?1:r&&!a?-1:0},xn=function(t){i(a,t);var n=f(a);function a(t){var s,i,o;r(this,a);var u=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?u=t.mentionedUserIds:t.mentionedUsers&&(u=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"FILE",ackRequired:!0,payload:X({channel_url:t.channelUrl,url:t.url,name:null!==(s=t.fileName)&&void 0!==s?s:"",type:null!==(i=t.mimeType)&&void 0!==i?i:"",size:null!==(o=t.fileSize)&&void 0!==o?o:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:u,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId,pin_message:t.isPinnedMessage})})}return s(a)}(he),Cn=function(t){i(a,t);var n=f(a);function a(t){var s,i;r(this,a),s=n.call(this);var o=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId})))),s.method=T.POST,s.path="".concat(kn(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),s.params=X({message_type:e.MessageType.FILE,user_id:t.userId,url:t.fileUrl,mention_type:t.mentionType,mentioned_user_ids:o,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes.map((function(e){return sn.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return Jt.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,apple_critical_alert_options:$t.payloadify(t.appleCriticalAlertOptions),reply_to_channel:t.isReplyToChannel,req_id:t.reqId,pin_message:t.isPinnedMessage}),s}return s(a)}($),Tn=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u,c;r(this,n),(i=t.call(this,e,"FILE",s)).message=new yn(e,s);var l=At.of(e).sdkState;return i.isMentioned=bn(i.message.mentionType,null!==(o=i.message.mentionedUserIds)&&void 0!==o?o:null===(u=i.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),l.userId),i.forceUpdateLastMessage=null!==(c=s.force_update_last_message)&&void 0!==c&&c,i}return s(n)}(oe),In=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o;r(this,n),(s=t.call(this,e,a)).message=new yn(e,a);var u=At.of(e).sdkState;return s.isMentioned=bn(s.message.mentionType,null!==(i=s.message.mentionedUserIds)&&void 0!==i?i:s.message.mentionedUsers.map((function(e){return e.userId})),u.userId),s.forceUpdateLastMessage=null!==(o=a.force_update_last_message)&&void 0!==o&&o,s}return s(n)}(ee);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(hn||(hn={}));var Sn,Nn=function(){function e(t,n){var a=this,s=n.sdkState,i=n.dispatcher,o=n.requestQueue,u=n.onlineDetector,c=n.cacheContext;r(this,e),this._queueMap=new Map,this._connectionState=null,this._onlineDetector=null,this._iid=t,this._sdkState=s,this._requestQueue=o,this._cacheContext=c,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof _e&&(a._connectionState=e.stateType)})),this._onlineDetector=u}return s(e,[{key:"_shouldSendThroughWebSocket",get:function(){return this._connectionState===ce.CONNECTED||this._connectionState===ce.CONNECTING||this._connectionState===ce.RECONNECTING}},{key:"_sendFileMessage",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._shouldSendThroughWebSocket){t.next=9;break}return a=new xn(Object.assign(Object.assign({},n.params),{channelUrl:e.url,channelType:e.channelType,url:n.params.fileUrl,requireAuth:n.requireAuth,reqId:n.requestId})),t.next=4,this._requestQueue.send(a);case 4:return s=t.sent,i=s.as(Tn),o=i.message,t.abrupt("return",o);case 9:return u=new Cn(Object.assign(Object.assign({},n.params),{channelUrl:e.url,channelType:e.channelType,url:n.params.fileUrl,userId:this._sdkState.userId,requireAuth:n.requireAuth,reqId:n.requestId})),t.next=12,this._requestQueue.send(u);case 12:return c=t.sent,l=c.as(In),h=l.message,t.abrupt("return",h);case 15:case"end":return t.stop()}}),r,this)})))}},{key:"_resolveMessageQueue",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=this._queueMap.get(e.url))){t.next=57;break}if(r.isResolving){t.next=56;break}r.isResolving=!0,a=[],s=!0,i=E(r.messageQueue),t.prev=7,i.s();case 9:if((o=i.n()).done){t.next=39;break}u=o.value,t.t0=u.state,t.next=t.t0===hn.PENDING||t.t0===hn.UPLOADING?14:t.t0===hn.UPLOADED?17:t.t0===hn.FAILED?35:37;break;case 14:return s=!1,a.push(u),t.abrupt("break",37);case 17:if(!s){t.next=33;break}return t.prev=18,u.state=hn.SENDING,t.next=22,this._sendFileMessage(e,u);case 22:return c=t.sent,u.deferred.resolve(c),t.next=26,Ge(100);case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(18),u.deferred.reject(t.t1);case 31:t.next=34;break;case 33:a.push(u);case 34:return t.abrupt("break",37);case 35:return u.deferred.reject(u.error.code===w.REQUEST_CANCELED?S.fileUploadCanceled:u.error),t.abrupt("break",37);case 37:t.next=9;break;case 39:t.next=44;break;case 41:t.prev=41,t.t2=t.catch(7),i.e(t.t2);case 44:return t.prev=44,i.f(),t.finish(44);case 47:if(l=r.isResolveRequestPending,r.messageQueue=a,r.isResolving=!1,r.isResolveRequestPending=!1,!l){t.next=54;break}return t.next=54,this._resolveMessageQueue(e);case 54:t.next=57;break;case 56:r.isResolveRequestPending=!0;case 57:case"end":return t.stop()}}),n,this,[[7,41,44,47],[18,28]])})))}},{key:"_uploadNextPendingItem",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d,p,f,v,_;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this._queueMap.get(e.url),!(a=r.messageQueue.find((function(e){return e.state===hn.PENDING})))){t.next=49;break}if(!P(a.params.file)){t.next=45;break}if(!(r.uploadQueue.length<6)){t.next=43;break}return a.state=hn.UPLOADING,r.uploadQueue.push(a),t.next=9,this._onlineDetector.isOnline();case 9:if(!t.sent){t.next=37;break}return t.prev=11,s=new qt({file:a.params.file,channelUrl:e.url,thumbnailSizes:a.params.thumbnailSizes,requestId:a.requestId}),t.next=15,this._requestQueue.send(s);case 15:i=t.sent,o=i.as(Ht),u=o.url,c=o.fileSize,l=void 0===c?a.params.fileSize:c,h=o.thumbnailSizes,d=void 0===h?a.params.thumbnailSizes:h,p=o.requireAuth,f=void 0!==p&&p,a.params.fileUrl=u,a.params.fileSize=l,a.params.thumbnailSizes=d,a.params.requireAuth=f,a.requireAuth=f,a.state=hn.UPLOADED,t.next=29;break;case 25:t.prev=25,t.t0=t.catch(11),t.t0.code===w.REQUEST_FAILED?a.error=new S({code:w.NETWORK_ERROR,message:"Failed to upload a file."}):a.error=t.t0,a.state=hn.FAILED;case 29:return t.prev=29,(v=r.uploadQueue.findIndex((function(e){return e.requestId===a.requestId})))>=0&&(r.uploadQueue.splice(v,1),this._uploadNextPendingItem(e)),t.next=34,this._resolveMessageQueue(e);case 34:return t.finish(29);case 35:t.next=43;break;case 37:return a.state=hn.FAILED,a.error=S.connectionRequired,(_=r.uploadQueue.findIndex((function(e){return e.requestId===a.requestId})))>=0&&(r.uploadQueue.splice(_,1),this._uploadNextPendingItem(e)),t.next=43,this._resolveMessageQueue(e);case 43:t.next=49;break;case 45:return a.params.thumbnailSizes=[],a.state=hn.UPLOADED,t.next=49,this._resolveMessageQueue(e);case 49:case"end":return t.stop()}}),n,this,[[11,25,29,35]])})))}},{key:"request",value:function(e,n,r){var a,s,i;return b(this,void 0,void 0,t().mark((function o(){var u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=new pe,P(r.file)&&(r.fileName=null!==(a=r.fileName)&&void 0!==a?a:r.file.name,r.mimeType=null!==(s=r.mimeType)&&void 0!==s?s:r.file.type,r.fileSize=null!==(i=r.fileSize)&&void 0!==i?i:r.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:n,params:r,state:hn.PENDING,deferred:u,requireAuth:r.requireAuth}),this._uploadNextPendingItem(e),t.abrupt("return",u.promise);case 7:case"end":return t.stop()}}),o,this)})))}},{key:"cancel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._queueMap.get(e.url);if(n){var r,a=t?[n.messageQueue.find((function(e){return e.requestId===t}))]:g(n.messageQueue),s=E(a);try{for(s.s();!(r=s.n()).done;){var i=r.value;if(i)switch(i.state){case hn.PENDING:i.state=hn.FAILED,i.error=S.requestCanceled,this._resolveMessageQueue(e);break;case hn.UPLOADING:this._requestQueue.cancel(i.requestId)}}}catch(e){s.e(e)}finally{s.f()}}}}]),e}(),Mn={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:e.MessageTypeFilter.ALL,customTypesFilter:null,senderUserIdsFilter:null,replyType:e.ReplyType.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},An=function(t){return U("number",t.prevResultSize)&&U("number",t.nextResultSize)&&U("boolean",t.isInclusive)&&U("boolean",t.reverse)&&U("string",t.messageTypeFilter)&&O(e.MessageTypeFilter,t.messageTypeFilter)&&D("string",t.customTypesFilter,!0)&&D("string",t.senderUserIdsFilter,!0)&&O(e.ReplyType,t.replyType)&&U("boolean",t.includeMetaArray)&&U("boolean",t.includeReactions)&&U("boolean",t.includeParentMessageInfo)&&U("boolean",t.includeThreadInfo)&&U("boolean",t.showSubchannelMessagesOnly)},Un={replyType:e.ReplyType.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},On=function(t){return O(e.ReplyType,t.replyType)&&U("boolean",t.includeReactions)&&U("boolean",t.includeMetaArray)&&U("boolean",t.includeParentMessageInfo)&&U("boolean",t.includeThreadInfo)};e.MessageEventSource=void 0,(Sn=e.MessageEventSource||(e.MessageEventSource={})).UNKNOWN="UNKNOWN",Sn.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",Sn.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",Sn.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",Sn.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",Sn.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",Sn.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",Sn.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",Sn.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",Sn.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",Sn.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",Sn.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",Sn.REQUEST_MESSAGE="REQUEST_MESSAGE",Sn.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",Sn.EVENT_POLL_VOTED="EVENT_POLL_VOTED",Sn.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",Sn.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",Sn.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",Sn.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",Sn.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",Sn.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",Sn.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",Sn.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",Sn.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",Sn.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",Sn.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";var Rn,Dn=function(t){return t.startsWith("EVENT_")||t===e.MessageEventSource.SYNC_MESSAGE_FILL||t===e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS||t===e.MessageEventSource.SYNC_POLL_CHANGELOGS},Ln=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.messages,i=e.source;return r(this,n),(a=t.call(this)).messages=s,a.source=i,a}return s(n)}(J),Pn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.messageIds,i=e.source;return r(this,n),(a=t.call(this)).messageIds=s,a.source=i,a}return s(n)}(J),Fn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.reqId,i=e.source;return r(this,n),(a=t.call(this)).reqId=s,a.source=i,a}return s(n)}(J),Gn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.polls,i=e.source;return r(this,n),(a=t.call(this)).polls=s,a.source=i,a}return s(n)}(J),qn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.event,i=e.source;return r(this,n),(a=t.call(this)).event=s,a.source=i,a}return s(n)}(J),Hn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.event,i=e.source;return r(this,n),(a=t.call(this)).event=null,a.source=null,a.event=s,a.source=i,a}return s(n)}(J),jn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.messageId,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,h=e.includeParentMessageInfo;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(o)),a.params={is_sdk:!0,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_parent_message_info:h,include_poll_details:!0},a}return s(n)}($),Vn=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).message=a?gn(e,Object.assign({},a)):null,s}return s(n)}(ee),Qn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.timestamp,u=void 0===o?null:o,c=e.token,l=void 0===c?null:c,h=e.prevResultSize,d=e.nextResultSize,p=e.isInclusive,f=e.reverse,v=e.messageTypeFilter,_=e.customTypesFilter,m=e.senderUserIdsFilter,g=e.replyType,y=e.includeMetaArray,k=e.includeReactions,E=e.parentMessageId,b=e.includeThreadInfo,w=e.includeParentMessageInfo,x=e.showSubchannelMessagesOnly;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages"),a.params=X({is_sdk:!0,prev_limit:h,next_limit:d,include:p,reverse:f,message_ts:u,message_id:l,message_type:null!=v?v:null,custom_types:_,sender_ids:m,include_reply_type:g,with_sorted_meta_array:y,include_reactions:k,parent_message_id:E,include_thread_info:b,include_parent_message_info:w,show_subchannel_message_only:x,include_poll_details:!0}),a}return s(n)}($),Bn=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).messages=a.messages.map((function(t){return gn(e,t)})),s}return s(n)}(ee),Kn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.timestamp,u=e.token,c=e.replyType,l=e.includeMetaArray,h=e.includeReactions,d=e.includeThreadInfo,p=e.includeParentMessageInfo;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/changelogs"),a.params={change_ts:o,token:u,with_sorted_meta_array:l,include_reactions:h,include_thread_info:d,include_reply_type:c,include_parent_message_info:p,include_poll_details:!0},a}return s(n)}($),zn=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).updatedMessages=a.updated.map((function(t){return gn(e,t)})),s.deletedMessagesInfo=a.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),s.hasMore=a.has_more,s.nextToken=a.next,s}return s(n)}(ee),Wn=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.scheduledMessageId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(i)),a.params={},a}return s(n)}($),Yn=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).message=a?gn(e,Object.assign({},a)):null,s}return s(n)}(ee),Jn={},Xn=function(){function n(e,t){var a=t.sdkState,s=t.dispatcher,i=t.requestQueue,o=t.onlineDetector,u=t.cacheContext;r(this,n),this._iid=e,this._sdkState=a,this._requestQueue=i,this._dispatcher=s,this._cacheContext=u,this.fileMessageQueue=new Nn(e,{sdkState:a,dispatcher:s,requestQueue:i,onlineDetector:o,cacheContext:u}),Jn[e]=this}return s(n,[{key:"buildMessageFromSerializedData",value:function(t){var n=dt(t);switch(n.messageType){case e.MessageType.USER:return new _n(this._iid,_n.payloadify(n));case e.MessageType.FILE:return new yn(this._iid,yn.payloadify(n));case e.MessageType.ADMIN:return new cn(this._iid,cn.payloadify(n))}return null}},{key:"buildUserMessageCreateParamsFromSerializedData",value:function(e,t){return X({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId})}},{key:"buildFileMessageCreateParamsFromSerializedData",value:function(e,t){return X({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:t.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth})}},{key:"buildScheduledUserMessageCreateParamsFromSerializedData",value:function(e,t){return Object.assign(Object.assign({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}},{key:"buildScheduledFileMessageCreateParamsFromSerializedData",value:function(e,t){return Object.assign(Object.assign({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})}},{key:"buildSenderFromSerializedData",value:function(e){var t=dt(e);return new rn(this._iid,rn.payloadify(t))}},{key:"getMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new jn(e),t.next=3,this._requestQueue.send(r);case 3:return a=t.sent,s=a.as(Vn),i=s.message,t.abrupt("return",i);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"getScheduledMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Wn(e),t.next=3,this._requestQueue.send(r);case 3:return a=t.sent,s=a.as(Yn),i=s.message,t.abrupt("return",i);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"getMessagesByMessageId",value:function(n,r,a,s){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.MessageEventSource.REQUEST_MESSAGE;return b(this,void 0,void 0,t().mark((function e(){var o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Qn(Object.assign(Object.assign({channelType:r,channelUrl:n,token:String(a)},Mn),s)),e.next=3,this._requestQueue.send(o);case 3:return u=e.sent,c=u.as(Bn),l=c.messages,this._dispatcher.dispatch(new Ln({messages:l,source:i})),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMessagesByTimestamp",value:function(n,r,a,s){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.MessageEventSource.REQUEST_MESSAGE;return b(this,void 0,void 0,t().mark((function e(){var o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Qn(Object.assign(Object.assign({channelType:r,channelUrl:n,timestamp:a},Mn),s)),e.next=3,this._requestQueue.send(o);case 3:return u=e.sent,c=u.as(Bn),l=c.messages,this._dispatcher.dispatch(new Ln({messages:l,source:i})),e.abrupt("return",l);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getThreadedMessagesByTimestamp",value:function(n,r,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.MessageEventSource.REQUEST_THREADED_MESSAGE;return b(this,void 0,void 0,t().mark((function i(){var o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new Qn(Object.assign(Object.assign(Object.assign({channelUrl:n.channelUrl,channelType:n.channelType,timestamp:r},on),a),{replyType:e.ReplyType.ALL,parentMessageId:n.messageId,includeThreadInfo:!0})),t.next=3,this._requestQueue.send(o);case 3:return u=t.sent,c=u.as(Bn),l=c.messages,(h=l.slice(1)).forEach((function(e){e.parentMessage=n})),this._dispatcher.dispatch(new Ln({messages:h,source:s})),t.abrupt("return",{parentMessage:l[0],threadedMessages:h});case 9:case"end":return t.stop()}}),i,this)})))}},{key:"getMessageChangelogs",value:function(n,r,a,s){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.MessageEventSource.REQUEST_MESSAGE_CHANGELOGS;return b(this,void 0,void 0,t().mark((function e(){var o,u,c,l,h,d,p,f;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Kn(X(Object.assign(Object.assign({channelType:r,channelUrl:n,timestamp:"number"==typeof a?a:null,token:"string"==typeof a?a:null},Un),s))),e.next=3,this._requestQueue.send(o);case 3:return u=e.sent,c=u.as(zn),l=c.updatedMessages,h=c.deletedMessagesInfo,d=c.hasMore,p=c.nextToken,f=h.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new Ln({messages:l,source:i})),f.length>0&&this._dispatcher.dispatch(new Pn({messageIds:f,source:i})),e.abrupt("return",{updatedMessages:l,deletedMessageIds:f,hasMore:d,token:p});case 9:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Jn[e]}}]),n}(),Zn=function(){function t(){r(this,t),this._onPending=ue,this._onFailed=ue,this._onSucceeded=ue}return s(t,[{key:"_trigger",value:function(t,n){switch(n.sendingStatus){case e.SendingStatus.PENDING:0===n.errorCode&&this._onPending(n);break;case e.SendingStatus.FAILED:case e.SendingStatus.CANCELED:this._onFailed(t,n.scheduledInfo?null:n);break;case e.SendingStatus.SCHEDULED:case e.SendingStatus.SUCCEEDED:this._onSucceeded(n)}}},{key:"onPending",value:function(e){return this._onPending=e,this}},{key:"onFailed",value:function(e){return this._onFailed=e,this}},{key:"onSucceeded",value:function(e){return this._onSucceeded=e,this}}]),t}(),$n=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e)).threadInfo=null,s.targetMessageId=0,s.channelUrl=null,s.channelType=null;var i=a.thread_info,o=a.parent_message_id,u=a.channel_url,c=a.channel_type;return i&&U("object",i)&&U("number",o)&&U("string",u)&&U("string",c)&&(s.threadInfo=new Vt(e,i),s.targetMessageId=o,s.channelUrl=u,s.channelType=c),s}return s(n)}(at),er={channelUrl:null,channelType:null,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},tr=function(t){return U("string",t.channelUrl)&&U("string",t.channelType)&&O(e.ChannelType,t.channelType)&&U("number",t.messageId)&&U("boolean",t.includeMetaArray)&&U("boolean",t.includeParentMessageInfo)&&U("boolean",t.includeThreadInfo)},nr=function(){function e(t,n){var a;r(this,e),this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=t,this.limit=null!==(a=n.limit)&&void 0!==a?a:20}return s(e,[{key:"hasNext",get:function(){return this._hasNext}},{key:"isLoading",get:function(){return this._isLoading}},{key:"_validate",value:function(){return U("number",this.limit)&&this.limit>0}}]),e}(),rr=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelCustomType,i=e.keyword,o=e.limit,u=e.reverse,c=e.exactMatch,l=e.channelUrl,h=e.order,d=e.messageTimestampFrom,p=e.messageTimestampTo,f=e.advancedQuery,v=e.targetFields,_=e.nextToken;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ie,"/messages"),a.params={custom_type:s,query:i,limit:o,reverse:u,exact_match:c,channel_url:l,message_ts_from:d,message_ts_to:p,sort_field:h,advanced_query:f,target_fields:v,after:_},a}return s(n)}($),ar=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).messages=a.results.map((function(t){return gn(e,t)})),s.hasNext=a.has_next,s.nextToken=a.end_cursor,s.totalCount=a.total_count,s}return s(n)}(ee);e.MessageSearchOrder=void 0,(Rn=e.MessageSearchOrder||(e.MessageSearchOrder={})).SCORE="score",Rn.TIMESTAMP="ts";var sr,ir,or,ur=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h,d,p,f,v;return r(this,u),(s=a.call(this,t,n)).keyword="",s.reverse=!1,s.exactMatch=!1,s.channelUrl="",s.channelCustomType="",s.messageTimestampFrom=null,s.messageTimestampTo=null,s.order=e.MessageSearchOrder.SCORE,s.advancedQuery=!1,s.targetFields=null,s._nextToken="",s.totalCount=-1,s.keyword=n.keyword,s.reverse=null!==(i=n.reverse)&&void 0!==i&&i,s.exactMatch=null!==(o=n.exactMatch)&&void 0!==o&&o,s.channelUrl=null!==(c=n.channelUrl)&&void 0!==c?c:"",s.channelCustomType=null!==(l=n.channelCustomType)&&void 0!==l?l:"",s.messageTimestampFrom=null!==(h=n.messageTimestampFrom)&&void 0!==h?h:null,s.messageTimestampTo=null!==(d=n.messageTimestampTo)&&void 0!==d?d:null,s.order=null!==(p=n.order)&&void 0!==p?p:e.MessageSearchOrder.SCORE,s.advancedQuery=null!==(f=n.advancedQuery)&&void 0!==f&&f,s.targetFields=null!==(v=n.targetFields)&&void 0!==v?v:null,s}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)&&U("string",this.keyword)&&this.keyword.length>0&&U("boolean",this.reverse)&&U("boolean",this.exactMatch)&&U("string",this.channelUrl)&&U("string",this.channelCustomType)&&(U("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(U("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&O(e.MessageSearchOrder,this.order)&&U("boolean",this.advancedQuery)&&D("string",this.targetFields,!0)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(!this._hasNext){e.next=15;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new rr(Object.assign(Object.assign({},this),{nextToken:this._nextToken?this._nextToken:null})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(ar),o=i.messages,u=i.hasNext,c=i.nextToken,l=i.totalCount,this._nextToken=c,this._hasNext=u,this._isLoading=!1,this.totalCount=l,e.abrupt("return",o);case 15:return e.abrupt("return",[]);case 18:throw S.queryInProgress;case 19:e.next=22;break;case 21:throw S.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),u}(nr),cr=function(t){i(a,t);var n=f(a);function a(e,t,s,i){var o;return r(this,a),(o=n.call(this,e,i)).channelUrl=t,o.channelType=s,o}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)&&U("string",this.channelUrl)&&O(e.ChannelType,this.channelType)}}]),a}(nr),lr=function(n){i(u,n);var a=f(u);function u(t,n,s,i){var o,c,l,h,d,p,f,v,_,m,g;return r(this,u),(o=a.call(this,t,n,s,i)).reverse=!1,o.messageTypeFilter=e.MessageTypeFilter.ALL,o.customTypesFilter=null,o.senderUserIdsFilter=null,o.replyType=e.ReplyType.NONE,o.includeMetaArray=!1,o.includeReactions=!1,o.includeParentMessageInfo=!1,o.includeThreadInfo=!1,o.showSubchannelMessagesOnly=!1,o._edge=Number.MAX_SAFE_INTEGER,o.reverse=null!==(c=i.reverse)&&void 0!==c&&c,o.messageTypeFilter=null!==(l=i.messageTypeFilter)&&void 0!==l?l:e.MessageTypeFilter.ALL,o.customTypesFilter=null!==(h=i.customTypesFilter)&&void 0!==h?h:null,o.senderUserIdsFilter=null!==(d=i.senderUserIdsFilter)&&void 0!==d?d:null,o.replyType=null!==(p=i.replyType)&&void 0!==p?p:e.ReplyType.NONE,o.includeMetaArray=null!==(f=i.includeMetaArray)&&void 0!==f&&f,o.includeReactions=null!==(v=i.includeReactions)&&void 0!==v&&v,o.includeParentMessageInfo=null!==(_=i.includeParentMessageInfo)&&void 0!==_&&_,o.includeThreadInfo=null!==(m=i.includeThreadInfo)&&void 0!==m&&m,o.showSubchannelMessagesOnly=null!==(g=i.showSubchannelMessagesOnly)&&void 0!==g&&g,o}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)&&U("boolean",this.reverse)&&O(e.MessageTypeFilter,this.messageTypeFilter)&&O(e.ReplyType,this.replyType)&&D("string",this.customTypesFilter,!0)&&D("string",this.senderUserIdsFilter,!0)&&U("boolean",this.includeMetaArray)&&U("boolean",this.includeReactions)&&U("boolean",this.includeParentMessageInfo)&&U("boolean",this.includeThreadInfo)&&U("boolean",this.showSubchannelMessagesOnly)}},{key:"load",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=18;break}if(this._isLoading){e.next=15;break}if(!this._hasNext){e.next=12;break}return this._isLoading=!0,n=Xn.of(this._iid),e.next=7,n.getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly});case 7:return r=e.sent,this._edge=Math.min.apply(Math,[Number.MAX_SAFE_INTEGER].concat(g(r.map((function(e){return e.createdAt}))))),this._hasNext=r.length>=this.limit,this._isLoading=!1,e.abrupt("return",r);case 12:return e.abrupt("return",[]);case 15:throw S.queryInProgress;case 16:e.next=19;break;case 18:throw S.invalidParameters;case 19:case"end":return e.stop()}}),e,this)})))}}]),u}(cr),hr={channelUrl:null,scheduledMessageId:0},dr=function(e){return U("string",e.channelUrl)&&U("number",e.scheduledMessageId)},pr=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="message",e}return s(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;_(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Xn(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:c,cacheContext:l})}},{key:"buildMessageFromSerializedData",value:function(e){return this._manager.buildMessageFromSerializedData(e)}},{key:"buildSenderFromSerializedData",value:function(e){return this._manager.buildSenderFromSerializedData(e)}},{key:"getMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},er),e),pt(tr(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.getMessage(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getScheduledMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},hr),e),pt(dr(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.getScheduledMessage(r));case 3:case"end":return t.stop()}}),n,this)})))}}]),a}(Gt),fr=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.title,i=e.optionTexts,o=e.data,u=e.allowUserSuggestion,c=e.allowMultipleVotes,l=e.closeAt;return r(this,n),(a=t.call(this)).method=T.POST,a.path=Ae,a.params={title:s,options:i,data:o,allow_user_suggestion:u,allow_multiple_votes:c,close_at:l},a}return s(n)}($),vr=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).poll=new vn(e,a),s}return s(n)}(ee),_r=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.channelType,o=e.pollId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ae,"/").concat(encodeURIComponent(o)),a.params={channel_url:s,channel_type:i},a}return s(n)}($),mr=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).poll=new vn(e,a),s}return s(n)}(ee),gr=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.channelType,o=e.pollId,u=e.pollOptionId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ae,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(u)),a.params={channel_url:s,channel_type:i},a}return s(n)}($),yr=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).pollOption=new fn(e,a),s}return s(n)}(ee),kr=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.timestamp,u=e.token;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/polls/changelogs"),a.params=X({change_ts:o,token:u}),a}return s(n)}($),Er=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).updatedPolls=a.updated.map((function(t){return function(e,t){return t?new vn(e,t):null}(e,t)})),s.deletedPollIds=a.deleted.map((function(e){return e})),s.hasMore=a.has_more,s.nextToken=a.next,s}return s(n)}(ee),br={title:null,optionTexts:null,data:null,allowUserSuggestion:null,allowMultipleVotes:null,closeAt:-1},wr=function(e){return U("string",e.title)&&(t=e.optionTexts,D("string",t)&&t.every((function(e){return""!==e.trim()})))&&pn(e.data)&&U("boolean",e.allowUserSuggestion,!0)&&U("boolean",e.allowMultipleVotes,!0)&&U("number",e.closeAt,!0);var t},xr={channelUrl:null,channelType:null,pollId:null,pollOptionId:null},Cr=function(t){return U("string",t.channelUrl)&&O(e.ChannelType,t.channelType)&&U("number",t.pollId)&&U("number",t.pollOptionId)},Tr={channelUrl:null,channelType:null,pollId:null},Ir=function(t){return U("string",t.channelUrl)&&""!==t.channelUrl&&O(e.ChannelType,t.channelType)&&U("number",t.pollId)},Sr={},Nr=function(){function n(e,t){var a=t.sdkState,s=t.dispatcher,i=t.sessionManager,o=t.requestQueue,u=t.logger;r(this,n),this._iid=e,this._sdkState=a,this._sessionManager=i,this._requestQueue=o,this._dispatcher=s,this._logger=u,Sr[e]=this}return s(n,[{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(Ir(e)).throw(S.invalidParameters),r=new _r(Object.assign({},e)),t.next=4,this._requestQueue.send(r);case 4:return a=t.sent,s=a.as(mr),i=s.poll,t.abrupt("return",i);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"create",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(wr(e)).throw(S.invalidParameters),r=e.data,a=new fr(Object.assign(Object.assign({},e),{data:r})),t.next=5,this._requestQueue.send(a);case 5:return s=t.sent,i=s.as(vr),o=i.poll,t.abrupt("return",o);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getOption",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(Cr(e)).throw(S.invalidParameters),r=new gr(Object.assign({},e)),t.next=4,this._requestQueue.send(r);case 4:return a=t.sent,s=a.as(yr),i=s.pollOption,t.abrupt("return",i);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"getPollChangeLogs",value:function(n,r,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.MessageEventSource.SYNC_POLL_CHANGELOGS;return b(this,void 0,void 0,t().mark((function e(){var i,o,u,c,l,h,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new kr(X({channelType:r,channelUrl:n,timestamp:"number"==typeof a?a:null,token:"string"==typeof a?a:null})),e.next=3,this._requestQueue.send(i);case 3:return o=e.sent,u=o.as(Er),c=u.updatedPolls,l=u.deletedPollIds,h=u.hasMore,d=u.nextToken,c.length>0&&this._dispatcher.dispatch(new Gn({polls:c,source:s})),e.abrupt("return",{updatedPolls:c,deletedPollIds:l,hasMore:h,token:d});case 7:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Sr[e]}}]),n}(),Mr=s((function e(t,n){r(this,e),this.pollId=0,this.messageId=0,this.pollId=n.poll.id,this.messageId=n.poll.message_id,this._iid=t,this._payload=n})),Ar=s((function e(t){r(this,e),this.pollId=0,this.messageId=0,this.pollId=t.poll_id,this.messageId=t.message_id,this._payload=t})),Ur=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.channelType,o=e.token,u=e.limit;return r(this,n),(a=t.call(this)).method=T.GET,a.path=Ae,a.params={channel_url:s,channel_type:i,token:o,limit:u},a}return s(n)}($),Or=function(e){i(n,e);var t=f(n);function n(e,a){var s,i;return r(this,n),(s=t.call(this,e,a)).polls=(null!==(i=a.polls)&&void 0!==i?i:[]).map((function(t){return new vn(e,t)})),s.token=a.next,s}return s(n)}(ee),Rr=function(e){i(a,e);var n=f(a);function a(e,t){return r(this,a),n.call(this,e,t.channelUrl,t.channelType,t)}return s(a,[{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new Ur(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(Or),o=i.polls,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(cr),Dr=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.channelType,o=e.pollId,u=e.pollOptionId,c=e.token,l=e.limit;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ae,"/").concat(encodeURIComponent(o),"/options/").concat(encodeURIComponent(u),"/voters"),a.params={channel_url:s,channel_type:i,token:c,limit:l},a}return s(n)}($),Lr=function(e){i(n,e);var t=f(n);function n(e,a){var s,i;return r(this,n),(s=t.call(this,e,a)).voters=(null!==(i=a.voters)&&void 0!==i?i:[]).map((function(t){return new vt(e,t)})),s.token=a.next,s}return s(n)}(ee),Pr=function(e){i(a,e);var n=f(a);function a(e,t){var s;return r(this,a),(s=n.call(this,e,t.channelUrl,t.channelType,t)).pollId=t.pollId,s.pollOptionId=t.pollOptionId,s}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)&&U("number",this.pollId)&&U("number",this.pollOptionId)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new Dr(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(Lr),o=i.voters,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(cr),Fr=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="poll",e}return s(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;_(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Nr(e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:u,onlineDetector:c,cacheContext:l})}},{key:"create",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},br),e),pt(wr(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.create(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Tr),e),pt(Ir(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.get(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getOption",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},xr),e),pt(Cr(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.getOption(r));case 3:case"end":return t.stop()}}),n,this)})))}}]),a}(Gt),Gr={profileImage:null,profileUrl:null,nickname:null},qr=function(e){return P(e.profileImage,!0)&&U("string",e.profileUrl,!0)&&U("string",e.nickname,!0)},Hr=function(e){i(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return s(n)}(s((function e(){r(this,e),this.onSessionExpired=ue,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=ue,this.onSessionRefreshed=ue,this.onSessionClosed=ue}))),jr=function(e){i(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return s(n)}(s((function e(){r(this,e),this.onConnected=ue,this.onReconnectStarted=ue,this.onReconnectSucceeded=ue,this.onReconnectFailed=ue,this.onDisconnected=ue}))),Vr=function(e){i(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return s(n)}(s((function e(){r(this,e),this.onFriendsDiscovered=ue,this.onTotalUnreadMessageCountUpdated=ue}))),Qr="GroupChannel",Br=100,Kr="Message";e.GroupChannelListOrder=void 0,(sr=e.GroupChannelListOrder||(e.GroupChannelListOrder={})).LATEST_LAST_MESSAGE="latest_last_message",sr.CHRONOLOGICAL="chronological",sr.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",sr.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.PublicGroupChannelListOrder=void 0,(ir=e.PublicGroupChannelListOrder||(e.PublicGroupChannelListOrder={})).CHRONOLOGICAL="chronological",ir.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",ir.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical",e.ScheduledMessageListOrder=void 0,(or=e.ScheduledMessageListOrder||(e.ScheduledMessageListOrder={})).CREATED_AT="created_at",or.SCHEDULED_AT="scheduled_at";var zr,Wr=function(t){switch(t){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case e.GroupChannelListOrder.CHRONOLOGICAL:return["-createdAt","syncIndex"];case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return["name"]}},Yr=function(){function t(){r(this,t),this.messageTypeFilter=e.MessageTypeFilter.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=e.ReplyType.NONE}return s(t,[{key:"clone",value:function(){var e=new t,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e}},{key:"match",value:function(t){switch(this.messageTypeFilter){case e.MessageTypeFilter.USER:if(t.messageType!==e.MessageType.USER)return!1;break;case e.MessageTypeFilter.FILE:if(t.messageType!==e.MessageType.FILE)return!1;break;case e.MessageTypeFilter.ADMIN:if(t.messageType!==e.MessageType.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(t instanceof an))return!1;if(!this.senderUserIdsFilter.includes(t.sender.userId))return!1}switch(this.replyType){case e.ReplyType.NONE:if(t.parentMessageId>0)return!1;break;case e.ReplyType.ONLY_REPLY_TO_CHANNEL:if(t instanceof an&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0}}]),t}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message"}(zr||(zr={}));var Jr,Xr=function(e){switch(e){case zr.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case zr.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},Zr={data:null,customType:null,mentionType:e.MentionType.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,parentMessageId:null,isReplyToChannel:!1,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null,isPinnedMessage:!1},$r=function(t){return U("string",t.data,!0)&&U("string",t.customType,!0)&&O(e.MentionType,t.mentionType)&&D("string",t.mentionedUserIds,!0)&&D(vt,t.mentionedUsers,!0)&&U("string",t.mentionedMessageTemplate,!0)&&D(Jt,t.metaArrays,!0)&&U("number",t.parentMessageId,!0)&&U("boolean",t.isReplyToChannel)&&O(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&U($t,t.appleCriticalAlertOptions,!0)&&U("boolean",t.isPinnedMessage,!0)},ea=function(e){return e?{isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}:null},ta=Object.assign(Object.assign({},Zr),{message:null,translationTargetLanguages:null,pollId:null}),na=function(e){var t;return X({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)})},ra=function(e){return $r(e)&&U("string",e.message)&&D("string",e.translationTargetLanguages,!0)&&U("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(Jr||(Jr={}));var aa=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},sa=function(e){return e===Jr.BLOB||e===Jr.FILE},ia=function(e){return e?{file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}:null},oa=Object.assign(Object.assign({},Zr),{file:null,fileKey:null,fileUrl:null,fileName:null,fileType:null,fileSize:null,mimeType:null,thumbnailSizes:null,requireAuth:!1}),ua=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.messageParams?(!e.url&&P(n)&&(e.messageParams.file=n),e.messageParams):X({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:null!=n?n:null===(t=e.messageParams)||void 0===t?void 0:t.file,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}}))})},ca=function(e){return $r(e)&&(P(e.file)||U("string",e.fileUrl))&&U("string",e.fileName,!0)&&U("string",e.mimeType,!0)&&U("number",e.fileSize,!0)&&(null===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return U("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},la="undefined"!=typeof document&&"undefined"!=typeof navigator;la&&navigator.userAgent&&navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/");var ha=la&&navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/");la&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!navigator.userAgent.includes("Chrome/")&&navigator.userAgent.includes("Chromium/"),la&&navigator.userAgent&&(navigator.userAgent.includes("OPR/")||navigator.userAgent.includes("Opera/")),la&&navigator.userAgent&&navigator.userAgent.includes("Trident/7.0");var da,pa,fa=la&&navigator.userAgent&&navigator.userAgent.includes("Edge/"),va=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE"}(da||(da={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock"}(pa||(pa={}));var _a,ma={},ga=function(){function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(this,e),this._state=da.PROCESSING,this._hostId=null,this._queue=[],this._currentItem=null,this._activationTimeout=null,this._activationQueue=[],ma[t]&&!a.forceCreate||(this.nodeId=va(),this.key=t,la&&(a.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost()})),window.addEventListener("message",(function(e){var t=e.data,r=t.nodeId,a=t.requestId,s=t.key,i=t.op,o=t.data;if(r!==n.nodeId&&s===n.key)switch(i){case pa.NEWNODE:n._sendSync();break;case pa.CLAIM_HOST:n._sendSync(),n._hostId=r;break;case pa.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var u,c=o.currentItemRequestId,l=E(o.queue);try{var h=function(){var e=u.value,t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:pa.REQUEST_LOCK,ts:e.ts})};for(l.s();!(u=l.n()).done;)h()}catch(e){l.e(e)}finally{l.f()}n._currentItem=n._queue.find((function(e){return e.requestId===c})),n._completeSync()}break;case pa.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==t.nodeId})),n._currentItem&&n._currentItem.nodeId===t.nodeId&&(n._currentItem=null,n._acquire(n._queue[0]));break;case pa.REQUEST_LOCK:n._requestLock(t);break;case pa.ACQUIRE_LOCK:var d=n._queue.find((function(e){return e.requestId===a}));n._acquire(d);break;case pa.RELEASE_LOCK:n._release(a)}})),window.addEventListener("beforeunload",(function(){n._send(pa.REMOVENODE)}))),ma[t]=this),ma[t]}return s(e,[{key:"locked",get:function(){return!!this._currentItem}},{key:"isHost",get:function(){return this._hostId===this.nodeId}},{key:"isInSync",get:function(){return this._state==da.DONE}},{key:"_send",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={nodeId:this.nodeId,requestId:null!==(t=null==r?void 0:r.requestId)&&void 0!==t?t:va(),key:this.key,op:e,data:null!==(n=r.data)&&void 0!==n?n:null,ts:Date.now()};return la&&window.postMessage(a,"*"),a}},{key:"_acquire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(this._currentItem=e,this._currentItem.onAcquired(e.requestId)):this._currentItem=null}},{key:"_release",value:function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=null,t.nodeId===this.nodeId&&this._send(pa.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased(e)}}},{key:"_requestLock",value:function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(pa.ACQUIRE_LOCK,{requestId:e}),n()},onReleased:function(){t._acquire(t._queue[0])}},a=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),a=!0;break}a||t._queue.push(r),t._currentItem||t._acquire(t._queue[0])}))}},{key:"_sendSync",value:function(){var e;this.isHost&&this._send(pa.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}})}},{key:"_waitUntilSyncCompleted",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHost||this.isInSync){e.next=2;break}return e.abrupt("return",new Promise((function(e){n._activationQueue.push(e)})));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"_waitSync",value:function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync()}),8))}},{key:"_completeSync",value:function(){this.isInSync||(this._state=da.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[])}},{key:"registerNode",value:function(){this._send(pa.NEWNODE),this._waitSync()}},{key:"claimHost",value:function(){this._hostId=this.nodeId,this._send(pa.CLAIM_HOST),this._waitSync()}},{key:"lock",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._waitUntilSyncCompleted();case 2:return n=this._send(pa.REQUEST_LOCK),e.next=5,this._requestLock(n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"unlock",value:function(){var e;this._release(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)}}]),e}(),ya=Object.assign(Object.assign({},ta),{scheduledAt:null}),ka=Object.assign(Object.assign({},Zr),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),Ea="UnsentMessage",ba={},wa=function(e){i(a,e);var n=f(a);function a(e,t){var s,i=t.sdkState,o=t.cacheContext;return r(this,a),(s=n.call(this,e))._sdkState=i,s._cacheContext=o,ba[e]=d(s),s._mutex=new ga("unsendmessagecache.lock"),s}return s(a,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return e&&e.collection(Ea)}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){if(e.messageId>0)throw S.invalidParameters;var t,n=Object.assign({},e.serialize());return e instanceof _n?(e.messageParams&&(n.messageParams=ea(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,Object.assign(Object.assign({},ea(t)),{scheduledAt:t.scheduledAt})))):e instanceof yn&&(e.messageParams&&(n.messageParams=ia(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n.scheduledInfo.scheduledMessageParams=function(e){return Object.assign(Object.assign({},ia(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))),n}},{key:"_deserialize",value:function(e){return e?(e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)}),Xn.of(this._iid).buildMessageFromSerializedData(e)):null}},{key:"_deserializeWithMessageCreateParams",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Xn.of(this._iid),a=this._deserialize(e),!e.messageParams){t.next=15;break}if(!(a instanceof _n)){t.next=8;break}s=e.messageParams,a.messageParams=r.buildUserMessageCreateParamsFromSerializedData(s,a),t.next=15;break;case 8:if(!(a instanceof yn)){t.next=15;break}if(!(i=e.messageParams).fileKey||"string"!=typeof i.fileKey||!sa(i.fileType)){t.next=14;break}return t.next=13,this.collection.getBlob(i.fileKey);case 13:i.file=t.sent;case 14:a.messageParams=r.buildFileMessageCreateParamsFromSerializedData(i,a);case 15:if(!(a.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams)){t.next=28;break}if(!(a instanceof _n)){t.next=21;break}o=e.scheduledInfo.scheduledMessageParams,a.scheduledInfo.scheduledMessageParams=r.buildScheduledUserMessageCreateParamsFromSerializedData(o,a),t.next=28;break;case 21:if(!(a instanceof yn)){t.next=28;break}if(!(u=e.scheduledInfo.scheduledMessageParams).fileKey||"string"!=typeof u.fileKey||!sa(u.fileType)){t.next=27;break}return t.next=26,this.collection.getBlob(u.fileKey);case 26:u.file=t.sent;case 27:a.scheduledInfo.scheduledMessageParams=r.buildScheduledFileMessageCreateParamsFromSerializedData(u,a);case 28:return t.abrupt("return",a);case 29:case"end":return t.stop()}}),n,this)})))}},{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return t.next=3,this.collection.getByKey("".concat(e));case 3:if(!(r=t.sent)){t.next=6;break}return t.abrupt("return",this._deserializeWithMessageCreateParams(r));case 6:return t.abrupt("return",null);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"fetch",value:function(e){var n=e.channelUrl,r=void 0===n?null:n,a=e.filter,s=void 0===a?new Yr:a,i=e.order,o=void 0===i?zr.CHANNEL_LATEST:i,u=e.sendingStatus,c=void 0===u?null:u,l=e.backward,h=void 0!==l&&l,d=e.parentMessageId,p=void 0===d?null:d;return b(this,void 0,void 0,t().mark((function e(){var n,a,i,u,l,d=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=13;break}return n=Xr(o),a={"/where":function(e){return!!(o!==zr.NEWEST_CHILD_MESSAGE||p&&0!==e.parentMessageId&&e.parentMessageId===p)&&s.match(d._deserialize(e))}},r&&(a.channelUrl=r),c&&(a.sendingStatus=c),i={where:a,index:n,backward:h},e.next=8,this.collection.query(i);case 8:return u=e.sent,e.next=11,u.fetch({});case 11:return l=e.sent,e.abrupt("return",Promise.all(l.map((function(e){return b(d,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._deserializeWithMessageCreateParams(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}))));case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,this)})))}},{key:"getAllChildMessages",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yr;return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch({filter:n,order:zr.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"upsert",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,Promise.all(e.map((function(e){return b(r,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof yn)){t.next=7;break}return t.next=3,this._mutex.lock();case 3:return t.next=5,this.saveBlob(e);case 5:return t.next=7,this._mutex.unlock();case 7:return r=this._serialize(e),t.next=10,this.collection.upsertOne(r);case 10:case"end":return t.stop()}}),n,this)})))})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"upsertChildMessages",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,Promise.all(e.map((function(e){return b(r,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=[],!((null===(r=e.threadInfo)||void 0===r?void 0:r.replyCount)>0)){t.next=5;break}return t.next=4,this.getAllChildMessages(e);case 4:a=t.sent;case 5:if(!(a.length>0)){t.next=9;break}return a.forEach((function(t){return t.applyParentMessage(e)})),t.next=9,this.upsert(a);case 9:case"end":return t.stop()}}),n,this)})))})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=18;break}r=E(e),t.prev=2,r.s();case 4:if((a=r.n()).done){t.next=10;break}return s=a.value,t.next=8,this.collection.remove(s);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),n,this,[[2,12,15,18]])})))}},{key:"removeMessagesOfChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e}});case 3:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=3;break}return e.next=3,this.collection.clear();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"saveBlob",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof yn)){t.next=17;break}if(!e.messageParams){t.next=9;break}if(!(r=e.messageParams).file||!aa(r.file)){t.next=9;break}return t.next=6,this.collection.saveBlob(r.file,e.reqId);case 6:a=t.sent,r.fileKey=a,r.fileType=Jr.BLOB;case 9:if(!e.scheduledInfo||!e.scheduledInfo.scheduledMessageParams){t.next=17;break}if(!(s=e.scheduledInfo.scheduledMessageParams).file||!aa(s.file)){t.next=17;break}return t.next=14,this.collection.saveBlob(s.file,e.reqId);case 14:i=t.sent,s.fileKey=i,s.fileType=Jr.BLOB;case 17:case"end":return t.stop()}}),n,this)})))}}],[{key:"of",value:function(e){return ba[e]}}]),a}(at),xa=function(n,r){return function(a,s){if(1===a)n.clear().then((function(){r.clear().then((function(){(function(n){return b(void 0,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n.commitSchema([{collectionName:Qr,keyName:"url",index:[Wr(e.GroupChannelListOrder.LATEST_LAST_MESSAGE),Wr(e.GroupChannelListOrder.CHRONOLOGICAL),Wr(e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:Kr,keyName:"messageId",index:[Xr(zr.CHANNEL_LATEST),Xr(zr.NEWEST_CHILD_MESSAGE)]},{collectionName:Ea,keyName:"reqId",index:[Xr(zr.CHANNEL_LATEST),Xr(zr.NEWEST_CHILD_MESSAGE)]},{collectionName:"Poll",keyName:"pollId"}]));case 1:case"end":return t.stop()}}),r)})))})(n).then((function(){return s()})).catch((function(e){return s(e)}))})).catch((function(e){return s(e)}))})).catch((function(e){return s(e)}));else s()}},Ca={},Ta=function(e){i(a,e);var n=f(a);function a(e,t){var s,i=t.sdkState,o=t.cacheContext,u=t.unsentMessageCache;return r(this,a),(s=n.call(this,e))._sdkState=i,s._cacheContext=o,s._unsentMessageCache=u,Ca[e]=d(s),s}return s(a,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return e?e.collection(Kr):null}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){return Object.assign(Object.assign({},e.serialize()),{messageId:"".concat(e.messageId)})}},{key:"_deserialize",value:function(e){return e=Object.assign(Object.assign({},e),{messageId:parseInt(e.messageId)}),Xn.of(this._iid).buildMessageFromSerializedData(e)}},{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return t.next=3,this.collection.getByKey("".concat(e));case 3:if(!(r=t.sent)){t.next=6;break}return t.abrupt("return",this._deserialize(r));case 6:return t.abrupt("return",null);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"fetch",value:function(e){var n=e.channelUrl,r=e.token,a=e.limit,s=void 0===a?Br:a,i=e.filter,o=void 0===i?new Yr:i,u=e.order,c=void 0===u?zr.CHANNEL_LATEST:u,l=e.backward,h=void 0!==l&&l,d=e.parentMessageId,p=void 0===d?null:d,f=e.isPollOnly,v=void 0!==f&&f;return b(this,void 0,void 0,t().mark((function e(){var a,i,u,l,d=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=10;break}return a=Xr(c),i={where:{channelUrl:n,"/where":function(e){if(r)switch(c){case zr.CHANNEL_LATEST:if(!h&&e.createdAt>r||h&&e.createdAt<r)return!1;break;case zr.NEWEST_CHILD_MESSAGE:if(!p||0===e.parentMessageId||e.parentMessageId!==p)return!1}return!(v&&!e._poll)&&o.match(d._deserialize(e))}},index:a,backward:h},e.next=5,this.collection.query(i);case 5:return u=e.sent,e.next=8,u.fetch({limit:s});case 8:return l=e.sent,e.abrupt("return",Promise.all(l.map((function(e){return b(d,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._deserialize(e));case 1:case"end":return t.stop()}}),n,this)})))}))));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getAllChildMessages",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yr;return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:n,order:zr.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"upsert",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=10;break}return t.next=3,this.saveBlobs(e);case 3:return r=e.map((function(e){return a._serialize(e)})),t.next=6,this.collection.upsertMany(r);case 6:return t.next=8,this.upsertChildMessages(e);case 8:return t.next=10,this._unsentMessageCache.upsertChildMessages(e);case 10:case"end":return t.stop()}}),n,this)})))}},{key:"upsertChildMessages",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.localCacheEnabled){n.next=3;break}return n.next=3,Promise.all(e.map((function(e){return b(r,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=[],!((null===(r=e.threadInfo)||void 0===r?void 0:r.replyCount)>0)){t.next=5;break}return t.next=4,this.getAllChildMessages(e);case 4:a=t.sent;case 5:if(!(a.length>0)){t.next=9;break}return a.forEach((function(t){return t.applyParentMessage(e)})),t.next=9,this.upsert(a);case 9:case"end":return t.stop()}}),n,this)})))})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=18;break}r=E(e),t.prev=2,r.s();case 4:if((a=r.n()).done){t.next=10;break}return s=a.value,t.next=8,this.collection.remove("".concat(s));case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),r.e(t.t0);case 15:return t.prev=15,r.f(),t.finish(15);case 18:case"end":return t.stop()}}),n,this,[[2,12,15,18]])})))}},{key:"removeMessagesOfChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=12;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e},index:Xr(zr.CHANNEL_LATEST)});case 3:return r=this._cacheContext.preference,t.next=6,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"));case 6:return t.next=8,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"));case 8:return t.next=10,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"));case 10:return t.next=12,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"));case 12:case"end":return t.stop()}}),n,this)})))}},{key:"removeUnderOffset",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=3;break}return t.next=3,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":n}},index:Xr(zr.CHANNEL_LATEST)});case 3:case"end":return t.stop()}}),r,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.localCacheEnabled){e.next=3;break}return e.next=3,this.collection.clear();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"countBetween",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=6;break}return s=Xr(zr.CHANNEL_LATEST),i=this.collection.query({where:{channelUrl:e,"/where":function(e){var t=o._deserialize(e);return r.includes(t.createdAt)&&n.match(t)}},index:s}),t.next=5,i.count();case 5:return t.abrupt("return",t.sent);case 6:return t.abrupt("return",0);case 7:case"end":return t.stop()}}),a,this)})))}},{key:"saveBlobs",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all(e.map((function(e){return b(r,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof yn&&e.messageParams)){t.next=7;break}if(!(r=e.messageParams).file||!aa(r.file)){t.next=7;break}return t.next=5,this.collection.saveBlob(r.file,e.reqId);case 5:a=t.sent,r.fileKey=a;case 7:case"end":return t.stop()}}),n,this)})))})));case 2:case"end":return n.stop()}}),n)})))}}],[{key:"of",value:function(e){return Ca[e]}}]),a}(at),Ia=function(e){i(n,e);var t=f(n);function n(){var e,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return r(this,n),(e=t.call(this))._pauseDelayTimer=null,e._currentState="visible",e._isEnabled=a,e._toggleState=e._toggleState.bind(d(e)),e}return s(n,[{key:"isAvailable",get:function(){return"undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener}},{key:"_toggleState",value:function(){var e=this;"hidden"!==document.visibilityState?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=null),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=null,e.dispatch("pause")}),3e4)),this._currentState=document.visibilityState}},{key:"start",value:function(){this._isEnabled&&this.isAvailable&&window.addEventListener("visibilitychange",this._toggleState,{capture:!0})}},{key:"stop",value:function(){this._isEnabled&&this.isAvailable&&window.removeEventListener("visibilitychange",this._toggleState,{capture:!0})}}]),n}(W),Sa=function(){function e(t){var n=this,a=t.logger,s=t.connectionDelegate,i=void 0===s?null:s;r(this,e),this._onlineWorker=function(){var e;return null===(e=n.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=n.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(n.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(n.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=a,i&&(this.connectionDelegate=i)}return s(e,[{key:"isAvailableOnWeb",get:function(){return"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine}},{key:"setOnlineListener",value:function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e)}},{key:"setOfflineListener",value:function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e)}},{key:"start",value:function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]}},{key:"stop",value:function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t()}catch(t){e.logger.warn(t.message)}})),this.unsubscribes=[]}},{key:"isOnline",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAvailableOnWeb){e.next=4;break}return e.abrupt("return",navigator.onLine);case 4:return e.abrupt("return",new Promise((function(e){fetch("https://www.google.com",{method:T.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}))})));case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),Na=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.message;return r(this,n),(a=t.call(this)).message=s,a}return s(n)}(J),Ma={},Aa=function(){function n(e,t){var a=this,s=t.localCacheEnabled,i=t.dispatcher,o=t.sdkState,u=t.logger;r(this,n),Ma[e]=this,this._iid=e,Ma[e]=this,this._localCacheEnabled=s,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=i,this._logger=u,this._sdkState=o,this._localCacheEnabled&&i.on((function(e){if(e instanceof _e)switch(e.stateType){case ce.CONNECTED:a._isProcessingAutoResend||a.processAutoResendRegisteredPendingMessages().then((function(){return a._processNextAutoResend()}));break;case ce.INTERNAL_DISCONNECTED:case ce.EXTERNAL_DISCONNECTED:a._isProcessingAutoResend=!1}}))}return s(n,[{key:"processNonAutoResendRegisteredPendingMessages",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchAllCachedPendingMessages();case 2:r=t.sent,a=E(r);try{for(a.s();!(s=a.n()).done;)0===(i=s.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=e.SendingStatus.FAILED,i.errorCode=w.ACK_TIMEOUT,this._dispatcher.dispatch(new Ln({messages:[i],source:e.MessageEventSource.LOCAL_MESSAGE_FAILED})))}catch(e){a.e(e)}finally{a.f()}case 5:case"end":return t.stop()}}),n,this)})))}},{key:"processAutoResendRegisteredPendingMessages",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchAllCachedPendingMessages();case 2:r=t.sent,a=E(r);try{for(a.s();!(s=a.n()).done;)(i=s.value).errorCode&&L(i.errorCode)&&(o=(new Date).getTime(),u=i.createdAt+2592e5,o<=u?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(u).toLocaleString()),i.sendingStatus=e.SendingStatus.FAILED,this._dispatcher.dispatch(new Ln({messages:[i],source:e.MessageEventSource.LOCAL_MESSAGE_FAILED}))))}catch(e){a.e(e)}finally{a.f()}case 5:case"end":return t.stop()}}),n,this)})))}},{key:"completeCurrentAndProcessNextAutoResend",value:function(t){if(this._localCacheEnabled&&(t.sendingStatus===e.SendingStatus.SUCCEEDED||t.sendingStatus===e.SendingStatus.FAILED&&!L(t.errorCode))){var n=this.indexOf(t);n>=0&&this._autoResendQueue.splice(n,1),0===n&&this._processNextAutoResend()}}},{key:"_fetchAllCachedPendingMessages",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=wa.of(this._iid))){t.next=7;break}return t.next=4,r.fetch({sendingStatus:e.SendingStatus.PENDING,backward:!0});case 4:t.t0=t.sent,t.next=8;break;case 7:t.t0=[];case 8:return t.abrupt("return",t.t0);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"indexOf",value:function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1}},{key:"_isNotInQueue",value:function(e){return-1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)}},{key:"_processNextAutoResend",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),n=this._autoResendQueue[0],this._dispatcher.dispatch(new Na({message:n})),this._logger.debug("processing auto-resend for message request id: ",n.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1}case 1:case"end":return e.stop()}}),e,this)})))}}],[{key:"of",value:function(e){return Ma[e]}}]),n}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"}(_a||(_a={}));var Ua,Oa=function(){function e(t){r(this,e),this.category=t.cat,this.data=t.data}return s(e,null,[{key:"getDataAsUserBlockEvent",value:function(e,t){var n=t.data,r=n.blocker,a=n.blockee;return{blocker:new vt(e,r),blockee:new vt(e,a)}}},{key:"getDataAsFriendDiscoveredEvent",value:function(e,t){var n=t.data.friend_discoveries;return{friendDiscoveries:Array.isArray(n)?n.map((function(t){return new vt(e,t)})):[]}}}]),e}(),Ra=function(e){i(n,e);var t=f(n);function n(e,a){var s,i=a.userId;return r(this,n),(s=t.call(this))._iid=e,s.userId=i,s}return s(n)}(J),Da=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"USEV",s)).event=new Oa(s),i}return s(n)}(oe),La=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.nickname,o=void 0===i?null:i,u=e.profileUrl,c=void 0===u?null:u,l=e.profileImage,h=void 0===l?null:l,d=e.preferredLanguages,p=void 0===d?null:d;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s)),a.params=X({nickname:o,profile_url:c,profile_file:h,preferred_languages:p}),a}return s(n)}($),Pa=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).user=null,s.user=new vt(e,Object.assign({},a)),s}return s(n)}(ee),Fa=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.token;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/apns"),a.params={apns_device_token:i,always_push:!0},a}return s(n)}($),Ga=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.token;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/gcm"),a.params={gcm_reg_token:i,always_push:!0},a}return s(n)}($),qa=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.token;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/apns/").concat(encodeURIComponent(i)),a}return s(n)}($),Ha=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.token;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/gcm/").concat(encodeURIComponent(i)),a}return s(n)}($),ja=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/apns"),a}return s(n)}($),Va=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/gcm"),a}return s(n)}($),Qa=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.type,o=e.token,u=e.ts;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/").concat(encodeURIComponent(i),"/device_tokens"),a.params={created_ts:u,token:o},a}return s(n)}($),Ba=function(t){i(a,t);var n=f(a);function a(t,s){var i;return r(this,a),(i=n.call(this,t,s)).pushTokens={type:s.type?e.PushTokenType[s.type.toLowerCase()]:e.PushTokenType.UNKNOWN,deviceTokens:s.device_tokens,hasMore:s.has_more,token:s.token},i}return s(a)}(ee),Ka=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/channel_invitation_preference"),a}return s(n)}($),za=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).autoAccept=a.auto_accept,s}return s(n)}(ee),Wa=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.willAutoAccept;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/channel_invitation_preference"),a.params={auto_accept:i},a}return s(n)}($),Ya=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).autoAccept=a.auto_accept,s}return s(n)}(ee),Ja=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference"),a}return s(n)}($),Xa=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).preference={doNotDisturbOn:a.do_not_disturb,startHour:a.start_hour,startMin:a.start_min,endHour:a.end_hour,endMin:a.end_min,timezone:a.timezone},s}return s(n)}(ee),Za=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.doNotDisturbOn,o=e.startHour,u=e.startMin,c=e.endHour,l=e.endMin,h=e.timezone;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference"),a.params={do_not_disturb:i,start_hour:o,start_min:u,end_hour:c,end_min:l,timezone:h},a}return s(n)}($),$a=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).preference={doNotDisturbOn:a.do_not_disturb,startHour:a.start_hour,startMin:a.start_min,endHour:a.end_hour,endMin:a.end_min,timezone:a.timezone},s}return s(n)}(ee),es=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference"),a}return s(n)}($),ts=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).snoozePeriod={isSnoozeOn:a.snooze_enabled},"number"==typeof a.snooze_start_ts&&(s.snoozePeriod.startTs=a.snooze_start_ts),"number"==typeof a.snooze_end_ts&&(s.snoozePeriod.endTs=a.snooze_end_ts),s}return s(n)}(ee),ns=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.snoozeOn,o=e.startTs,u=e.endTs;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference"),a.params={snooze_enabled:i,snooze_start_ts:o,snooze_end_ts:u},a}return s(n)}($),rs=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).snoozePeriod={isSnoozeOn:a.snooze_enabled},"number"==typeof a.snooze_start_ts&&(s.snoozePeriod.startTs=a.snooze_start_ts),"number"==typeof a.snooze_end_ts&&(s.snoozePeriod.endTs=a.snooze_end_ts),s}return s(n)}(ee),as=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.blockedUserId;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/block"),a.params={target_id:i},a}return s(n)}($),ss=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.unblockedUserId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/block/").concat(encodeURIComponent(i)),a}return s(n)}($),is=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference"),a}return s(n)}($),os=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,s}return s(n)}(ee),us=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.pushTriggerOption;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference"),a.params={push_trigger_option:i},a}return s(n)}($),cs=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,s}return s(n)}(ee),ls=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/template"),a}return s(n)}($),hs=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).name=a.name,s}return s(n)}(ee),ds=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.templateName;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push/template"),a.params={name:i},a}return s(n)}($),ps=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).name=a.name,s}return s(n)}(ee),fs=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.token;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/friends/changelogs"),a.params={token:i},a}return s(n)}($),vs=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).changelogs={addedUsers:a.added.map((function(t){return new vt(e,t)})),updatedUsers:a.updated.map((function(t){return new vt(e,t)})),deletedUserIds:a.deleted,hasMore:a.has_more,token:a.next},s}return s(n)}(ee),_s=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.discoveries;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/friend_discoveries"),a.params={friend_discoveries:i.map((function(e){return{friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},a}return s(n)}($),ms=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).friendDiscoveryRequestId=a.friend_discovery_request_id,s}return s(n)}(ee),gs=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.discoveryKeys;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/friend_discoveries"),a.params={friend_discovery_keys:i},a}return s(n)}($),ys=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.userIds;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/friends"),a.params={user_ids:i},a}return s(n)}($),ks=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).users=a.users.map((function(t){return new vt(e,t)})),s}return s(n)}(ee),Es=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.userIds;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/friends"),a.params={user_ids:i},a}return s(n)}($),bs=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(s,"/allow_friend_discovery"),a.params={},a}return s(n)}($),ws=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).allowFriendDiscovery=a.allow_friend_discovery,s}return s(n)}(ee),xs=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.allowFriendDiscovery;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(s,"/allow_friend_discovery"),a.params={allow_friend_discovery:i},a}return s(n)}($),Cs=s((function e(t){r(this,e),this.key=null,this.url=null,this.key=t.key,this.url=t.url})),Ts=s((function e(t){var n,a,s;r(this,e),this.id=0,this.name=null,this.url=null,this.emojis=[],this.id=null!==(n=t.id)&&void 0!==n?n:0,this.name=null!==(a=t.name)&&void 0!==a?a:"",this.url=null!==(s=t.url)&&void 0!==s?s:"",this.emojis=t.emojis?t.emojis.map((function(e){return new Cs(e)})):[]})),Is=s((function e(t){r(this,e),this.emojiHash=null,this.emojiCategories=[],this.emojiHash=t.emoji_hash||"",this.emojiCategories=t.emoji_categories?t.emoji_categories.map((function(e){return new Ts(e)})):[]})),Ss=function(e){i(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.call(this)).method=T.GET,e.path=Me,e}return s(n)}($),Ns=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).emojiContainer=new Is(a),s}return s(n)}(ee),Ms=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.categoryId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Me,"/").concat(s),a}return s(n)}($),As=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).emojiCategory=new Ts(a),s}return s(n)}(ee),Us=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.key;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ne,"/").concat(s),a}return s(n)}($),Os=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).emoji=new Cs(a),s}return s(n)}(ee),Rs=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.limit,i=e.token,o=e.userIdsFilter,u=e.metaDataKeyFilter,c=e.metaDataValuesFilter,l=e.nicknameStartsWithFilter;return r(this,n),(a=t.call(this)).method=T.GET,a.path=Ee,a.params=X({limit:s,token:i,user_ids:o,metadatakey:u,metadatavalues_in:c,nickname_startswith:l}),a}return s(n)}($),Ds=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).users=a.users.map((function(t){return new vt(e,t)})),s.next=a.next,s}return s(n)}(ee),Ls=function(e){i(a,e);var n=f(a);function a(e,t){var s,i,o,u;return r(this,a),(s=n.call(this,e,t)).userIdsFilter=null,s.metaDataKeyFilter=null,s.metaDataValuesFilter=null,s.nicknameStartsWithFilter=null,s.userIdsFilter=null!==(i=t.userIdsFilter)&&void 0!==i?i:null,s.metaDataKeyFilter=null!==(o=t.metaDataKeyFilter)&&void 0!==o?o:null,s.metaDataValuesFilter=null!==(u=t.metaDataValuesFilter)&&void 0!==u?u:null,s.nicknameStartsWithFilter=t.nicknameStartsWithFilter||null,s}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)&&D("string",this.userIdsFilter,!0)&&U("string",this.metaDataKeyFilter,!0)&&D("string",this.metaDataValuesFilter,!0)&&U("string",this.metaDataKeyFilter,!0)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new Rs(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(Ds),o=i.users,u=i.next,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(nr),Ps=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.limit,o=e.token,u=e.userIdsFilter;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(s,"/block"),a.params=X({limit:i,token:o,user_ids:u}),a}return s(n)}($),Fs=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).users=a.users.map((function(t){return new vt(e,t)})),s.next=a.next,s}return s(n)}(ee),Gs=function(e){i(a,e);var n=f(a);function a(e,t){var s,i;return r(this,a),(s=n.call(this,e,t)).userIdsFilter=null,s.userIdsFilter=null!==(i=t.userIdsFilter)&&void 0!==i?i:null,s}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)&&D("string",this.userIdsFilter,!0)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new Ps(Object.assign(Object.assign({},this),{userId:r.userId,token:this._token})),e.next=8,a.send(s);case 8:return i=e.sent,o=i.as(Fs),u=o.users,c=o.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,e.abrupt("return",u);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(nr),qs=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.limit,o=e.token;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/friends"),a.params={limit:i,token:o},a}return s(n)}($),Hs=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).hasMore=a.has_more,s.users=a.users.map((function(t){return new vt(e,t)})),s.next=a.next,s}return s(n)}(ee),js=function(e){i(a,e);var n=f(a);function a(){return r(this,a),n.apply(this,arguments)}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new qs(Object.assign(Object.assign({},this),{userId:r.userId,token:this._token})),e.next=8,a.send(s);case 8:return i=e.sent,o=i.as(Hs),u=o.users,c=o.hasMore,l=o.next,this._token=l,this._hasNext=c,this._isLoading=!1,e.abrupt("return",u);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(nr),Vs={},Qs=function(){function e(t){var n=t.dbname,a=t.itemSizeLimit,s=void 0===a?1048576:a,i=t.cacheLimit,o=void 0===i?256:i,u=t.blockHashBase,c=void 0===u?2:u,l=t.blockHashMultiplier,h=void 0===l?10:l,d=t.blockHashConstant,p=void 0===d?11:d,f=t.transactionApplyDelay,v=void 0===f?200:f,_=t.disableLogger,m=void 0!==_&&_;return r(this,e),Vs[n]||(this.itemSizeLimit=s,this.cacheLimit=o,this.blockHashBase=c,this.blockHashMultiplier=h,this.blockHashConstant=p,this.transactionApplyDelay=v,this.disableLogger=m,Vs[n]=this),Vs[n]}return s(e,null,[{key:"get",value:function(e){return Vs[e]}}]),e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"}(Ua||(Ua={}));var Bs,Ks=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.code,i=void 0===s?Ua.UNKNOWN_ERROR:s,o=e.message,u=void 0===o?"Unknown error occurred.":o;return r(this,n),(a=t.call(this,u)).code=i,Object.setPrototypeOf(d(a),n.prototype),a}return s(n,null,[{key:"storeNotDefined",get:function(){return new n({code:Ua.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})}},{key:"storeNotAvailable",get:function(){return new n({code:Ua.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})}},{key:"storeNotAvailableInPrivateBrowsing",get:function(){return new n({code:Ua.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})}},{key:"storeIsFull",get:function(){return new n({code:Ua.STORE_IS_FULL,message:"Store is full."})}},{key:"storeKeyTypeIsInvalid",get:function(){return new n({code:Ua.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})}},{key:"storeBrokenIntegrity",get:function(){return new n({code:Ua.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})}},{key:"storeBrokenBlob",get:function(){return new n({code:Ua.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})}},{key:"storeEncryptionInvalid",get:function(){return new n({code:Ua.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})}},{key:"storeItemSizeExceeded",get:function(){return new n({code:Ua.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})}},{key:"storeReadFailed",get:function(){return new n({code:Ua.STORE_READ_FAILED,message:"Failed to read from store."})}},{key:"storeWriteFailed",get:function(){return new n({code:Ua.STORE_WRITE_FAILED,message:"Failed to write to store."})}},{key:"databaseSchemaNotOnUpgrade",get:function(){return new n({code:Ua.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})}},{key:"collectionNotReady",get:function(){return new n({code:Ua.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})}},{key:"collectionKeyNotMatch",get:function(){return new n({code:Ua.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})}},{key:"collectionQueryNotValid",get:function(){return new n({code:Ua.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})}},{key:"collectionInsertDuplicate",get:function(){return new n({code:Ua.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})}},{key:"collectionKeyNotFound",get:function(){return new n({code:Ua.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})}},{key:"collectionKeyNotGiven",get:function(){return new n({code:Ua.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})}},{key:"collectionWriteFailed",get:function(){return new n({code:Ua.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})}},{key:"collectionItemSizeExceeded",get:function(){return new n({code:Ua.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})}},{key:"indexTableIsRequired",get:function(){return new n({code:Ua.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})}},{key:"indexTypesNotMatch",get:function(){return new n({code:Ua.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})}},{key:"compareTypesNotMatch",get:function(){return new n({code:Ua.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})}},{key:"circularReferenceFound",get:function(){return new n({code:Ua.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})}}]),n}(h(Error));!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed"}(Bs||(Bs={}));var zs,Ws=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WeakMap;if("object"===n(t)&&null!==t){if(r.has(t))throw Ks.circularReferenceFound;r.set(t,!0);var a=null;if(Array.isArray(t))a=t.map((function(t){return e(t,r)}));else if(t instanceof RegExp)a=t;else if(t instanceof Date)a=t;else for(var s in a={},t)a[s]=e(t[s],r);return r.delete(t),a}return t},Ys=function(e,t){if(null==t)return 1;if(null==e)return-1;if(n(e)!==n(t))throw Ks.compareTypesNotMatch;var r=0;switch(n(e)){case"boolean":case"number":r=e-t;break;case"string":r=e.localeCompare(t)}return r},Js=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return(n>>>0)%t},Xs=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))},Zs=function e(t,r){if(!r)return!1;if("function"!=typeof t){for(var a in t){if(["/and","&&"].includes(a)){if(t[a].some((function(t){return!e(t,r)})))return!1}else if(["/or","||"].includes(a)){if(t[a].every((function(t){return!e(t,r)})))return!1}else if("/where"===a){if(!(0,t[a])(r))return!1}else{var s=a;if("object"===n(t[s])){var i=t[s];for(var o in i)switch(o){case"/eq":case"=":if(r[s]!==i[o])return!1;break;case"/neq":case"!=":if(r[s]===i[o])return!1;break;case"/gt":case">":var u=r[s],c=i[o];if(!(Ys(u,c)>0))return!1;break;case"/gte":case">=":var l=r[s],h=i[o];if(!(Ys(l,h)>=0))return!1;break;case"/lt":case"<":var d=r[s],p=i[o];if(!(Ys(d,p)<0))return!1;break;case"/lte":case"<=":var f=r[s],v=i[o];if(!(Ys(f,v)<=0))return!1;break;case"/in":var _=r[s];if(!i[o].includes(_))return!1;break;case"/nin":var m=r[s];if(i[o].includes(m))return!1;break;case"/contain":var g=r[s],y=i[o];if(!g.includes(y))return!1;break;case"/regex":var k=r[s];if(!i[o].test(k))return!1;break;case"/where":var E=r[s];if(!(0,i[o])(E))return!1}}else if("function"==typeof t[s]){if(!t[s](r[s]))return!1}else if(t[s]!==r[s])return!1}}return!0}return t(r)},$s=function(){},ei=function(){return Promise.resolve()},ti=function(e){return e},ni=function(e,t){t(null)};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD"}(zs||(zs={}));var ri,ai,si,ii=function(){function e(t){var n=t.initialPrevValue,a=void 0===n?null:n,s=t.initialNextValue,i=void 0===s?null:s,o=t.iterator,u=t.map,c=void 0===u?ti:u,l=t.backward,h=void 0===l?ei:l,d=t.forward,p=void 0===d?ei:d,f=t.complete,v=void 0===f?$s:f;r(this,e),this._prevValue=a,this._nextValue=i,this._error=null,this._map=c,this._backward=h,this._forward=p,this._iterator=o,this._complete=v}return s(e,[{key:"prevValue",get:function(){return this._map(this._prevValue)}},{key:"nextValue",get:function(){return this._map(this._nextValue)}},{key:"error",get:function(){return this._error}},{key:"hasPrevious",get:function(){return!!this._prevValue}},{key:"hasNext",get:function(){return!!this._nextValue}},{key:"prev",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasPrevious){e.next=20;break}return e.prev=1,n=this._prevValue,e.next=5,this._backward();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=null;case 8:this._prevValue=e.t0,this._nextValue=n,e.next=15;break;case 12:e.prev=12,e.t1=e.catch(1),this._error=e.t1;case 15:return e.next=17,this._iterator(this);case 17:return e.abrupt("return",e.sent);case 20:this._complete();case 21:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasNext){e.next=20;break}return e.prev=1,n=this._nextValue,e.next=5,this._forward();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=null;case 8:this._nextValue=e.t0,this._prevValue=n,e.next=15;break;case 12:e.prev=12,e.t1=e.catch(1),this._error=e.t1;case 15:return e.next=17,this._iterator(this);case 17:return e.abrupt("return",e.sent);case 20:this._complete();case 21:case"end":return e.stop()}}),e,this,[[1,12]])})))}},{key:"stop",value:function(){this._prevValue=null,this._nextValue=null,this._complete()}}]),e}(),oi=function(){function e(t){var n=t.condition,a=void 0===n?{}:n,s=t.backward,i=void 0!==s&&s,o=t.blockManager,u=t.indexer;r(this,e),this.condition=a,this.backward=i,this._blockManager=o,this._indexer=u}return s(e,[{key:"findOptimizedStartPosition",value:function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var a=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var s in this._indexer.fields){var i=this._indexer.fields[s],o=1;if("-"===i[0]&&(i=i.slice(1),o=-1),this.condition[i])if("object"===n(this.condition[i])){var u=o>0?r:t;for(var c in this.condition[i])if(u.includes(c))for(var l=a;l>=0;l--)if(o*Ys(this._indexer.origin[l].columnValues[s],this.condition[i][c])<=0){a=l;break}}else for(var h=a;h>=0;h--)if(o*Ys(this._indexer.origin[h].columnValues[s],this.condition[i])<=0){a=h;break}}return Math.min(a+1,this._indexer.origin.length-1)}var d=function(){var a=0;if("function"!=typeof e.condition)for(var s=function(s){var i=e._indexer.fields[s],o=1;if("-"===i[0]&&(i=i.slice(1),o=-1),e.condition[i])if("object"===n(e.condition[i]))Object.keys(e.condition[i]).forEach((function(n){if((o>0?t:r).includes(n))for(var u=a;u<e._indexer.origin.length;u++)if(o*Ys(e._indexer.origin[u].columnValues[s],e.condition[i][n])>=0){a=u;break}}));else for(var u=a;u<e._indexer.origin.length;u++)if(o*Ys(e._indexer.origin[u].columnValues[s],e.condition[i])>=0){a=u;break}},i=0;i<e._indexer.fields.length;i++)s(i);return{v:Math.max(a-1,0)}}();if("object"===n(d))return d.v}},{key:"each",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.findOptimizedStartPosition(),a=0,this.backward&&this._indexer.origin[r]&&(a=this._indexer.origin[r].keys.length-1),s=function(){if(l._indexer.origin[r]){if(!l._indexer.origin[r].keys[++a]){if(!l._indexer.origin[++r])return!1;a=0}return!0}return!1},i=function(){if(l._indexer.origin[r]){if(!l._indexer.origin[r].keys[--a]){if(!l._indexer.origin[--r])return!1;a=l._indexer.origin[r].keys.length-1}return!0}return!1},o=null,!this._indexer.origin[r]){n.next=15;break}u=this.backward?i:s;case 8:return n.next=10,this._blockManager.getFromBlock(this._indexer.origin[r].keys[a]);case 10:if(c=n.sent,!Zs(this.condition,c)){n.next=14;break}return o=c,n.abrupt("break",15);case 14:if(u()){n.next=8;break}case 15:return n.next=17,new Promise((function(n){var u=new ii({initialNextValue:Ws(o),iterator:e,forward:function(){return b(l,void 0,void 0,t().mark((function e(){var n,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.backward?i:s;case 1:if(!n()){e.next=9;break}return e.next=4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[a]);case 4:if(o=e.sent,!Zs(this.condition,o)){e.next=7;break}return e.abrupt("return",Ws(o));case 7:e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))},backward:function(){return b(l,void 0,void 0,t().mark((function e(){var n,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.backward?s:i;case 1:if(!n()){e.next=9;break}return e.next=4,this._blockManager.getFromBlock(this._indexer.origin[r].keys[a]);case 4:if(o=e.sent,!Zs(this.condition,o)){e.next=7;break}return e.abrupt("return",Ws(o));case 7:e.next=1;break;case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})))},complete:n});e(u)}));case 17:return n.abrupt("return",n.sent);case 18:case"end":return n.stop()}}),n,this)})))}}]),e}(),ui=function(){function e(t){var n=t.condition,a=void 0===n?{}:n,s=t.backward,i=void 0!==s&&s,o=t.mutex,u=t.blockManager,c=t.indexer;r(this,e),this._mutex=o,this._iterator=new oi({condition:a,backward:i,blockManager:u,indexer:c})}return s(e,[{key:"fetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Math.max(e.offset||0,0),0!==(a="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER)){n.next=6;break}return n.abrupt("return",[]);case 6:if(!(a<0)){n.next=8;break}throw Ks.collectionQueryNotValid;case 8:return n.prev=8,s=[],n.next=12,this._mutex.lock();case 12:return n.next=14,this._iterator.each((function(e){return b(i,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.error?e.stop():e.hasNext?0===r?(s.push(e.nextValue),0<a&&a<=s.length?e.stop():e.next()):(r--,e.next()):e.stop();case 1:case"end":return t.stop()}}),n)})))}));case 14:return this._mutex.unlock(),n.abrupt("return",s);case 18:throw n.prev=18,n.t0=n.catch(8),this._mutex.unlock(),n.t0;case 22:case"end":return n.stop()}}),n,this,[[8,18]])})))}},{key:"count",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=0,e.next=4,this._mutex.lock();case 4:return e.next=6,this._iterator.each((function(e){return b(r,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.error?e.stop():e.hasNext?(n++,e.next()):e.stop();case 1:case"end":return t.stop()}}),r)})))}));case 6:return this._mutex.unlock(),e.abrupt("return",n);case 10:throw e.prev=10,e.t0=e.catch(0),this._mutex.unlock(),e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,10]])})))}}]),e}(),ci=function(e){return"".concat("nest","@").concat(e)},li=function(e,t){return"".concat(ci(e),"/").concat(t)},hi=function(e,t){return"".concat(li(e,t),".metadata")},di=function(e,t){return"".concat(li(e,t),"/block.")},pi=function(e,t,n,r){return"".concat(di(e,t)).concat(n,".").concat(r)},fi=function(e,t){return"".concat(li(e,t),"/blob.")},vi=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return"".concat(fi(e,t)).concat(n,".").concat(r)},_i=function(){function e(t){var n=t.dbname,a=t.collectionName,s=t.store;r(this,e),this.dbname=n,this.collectionName=a,this.store=s}return s(e,[{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.get(e);case 2:if(!(r=t.sent)){t.next=19;break}if(a=r.data,s=r.type,"undefined"==typeof fetch){t.next=14;break}return t.next=8,fetch(a);case 8:return i=t.sent,t.next=11,i.blob();case 11:return t.abrupt("return",t.sent);case 14:for(512,o=[],u=atob(a.split(",")[1]),c=0;c<u.length;c+=512){for(l=u.slice(c,c+512),h=new Array(l.length),d=0;d<l.length;d++)h[d]=l.charCodeAt(d);o.push(new Uint8Array(h))}return t.abrupt("return",new Blob(o,{type:s}));case 19:return t.abrupt("return",null);case 20:case"end":return t.stop()}}),n,this)})))}},{key:"save",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"".concat(Date.now());return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){var r=vi(u.dbname,u.collectionName,n),a=new FileReader;a.onload=function(){t({blobId:r,data:a.result,type:e.type})},a.readAsDataURL(e)}));case 2:return a=t.sent,s=a.blobId,i=a.data,o=a.type,t.next=8,this.store.set({key:s,value:{data:i,type:o},generation:1});case 8:return t.abrupt("return",s);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.remove(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=fi(this.dbname,this.collectionName),e.next=3,this.store.getAllKeys();case 3:return r=e.sent,e.next=6,Promise.all(r.filter((function(e){return e.startsWith(n)})).map((function(e){return b(a,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.remove(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))})));case 6:case"end":return e.stop()}}),e,this)})))}}]),e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR"}(ri||(ri={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile"}(ai||(ai={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT"}(si||(si={}));var mi,gi=[ai.PENDING,ai.VOLATILE],yi={},ki=function(){function e(t){var n=t.dbname,a=t.limit,s=void 0===a?256:a;return r(this,e),yi[n]||(this.dbname=n,this._items=[],this._limit=s,yi[n]=this),yi[n]}return s(e,[{key:"items",get:function(){return this._items}},{key:"find",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:si.DEFAULT;return b(this,void 0,void 0,t().mark((function a(){var s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=this.get(n)){t.next=8;break}return t.next=4,e.get(n);case 4:(i=t.sent)&&(s={key:n,value:i,generation:1,state:r===si.PERSISTENT?ai.PERSISTENT:ai.VOLATILE},this.put(s)),t.next=9;break;case 8:r===si.PERSISTENT&&(s.state=ai.PERSISTENT);case 9:return t.abrupt("return",s);case 10:case"end":return t.stop()}}),a,this)})))}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:si.DEFAULT,n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===si.PERSISTENT&&(r.state=ai.PERSISTENT),t!==si.NO_CACHE&&this.put(r),r}return null}},{key:"put",value:function(e){if(this._limit>0){var t=this._items.map((function(e){return e.key})).indexOf(e.key);if(t>-1)gi.includes(this._items[t].state)&&gi.includes(e.state)?(this._items.splice(t,1),this._items.push(e)):(this._items[t].state=e.state,this._items[t].generation=e.generation,this._items[t].value=e.value);else{this._items.push(e);var n=this._items.filter((function(e){return e.state===ai.VOLATILE})),r=n.length-this._limit;if(r>0){var a,s=[],i=E(this._items);try{for(i.s();!(a=i.n()).done;){var o=a.value;o.state===ai.VOLATILE&&r>0?r--:s.push(o)}}catch(e){i.e(e)}finally{i.f()}this._items=s}}}}},{key:"remove",value:function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1)}},{key:"clearByCondition",value:function(e){this._items=this._items.filter((function(t){return!e(t)}))}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._items=e?[]:this._items.filter((function(e){return e.state!==ai.VOLATILE}))}}],[{key:"get",value:function(e){return yi[e]}}]),e}(),Ei=function(){function e(t){var n=t.dbname,a=t.collectionName,s=t.store;r(this,e),this._metadata=null,this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=n,this.collectionName=a,this.metadataKey=function(e,t){return"".concat(li(e,t),"/trans.metadata")}(n,a),this.recordsetKey=function(e,t){return"".concat(li(e,t),"/trans.recordset")}(n,a),this._store=s}return s(e,[{key:"generation",get:function(){return this._metadata?this._metadata.generation:0}},{key:"requestCount",get:function(){return this._requests.length}},{key:"_getReducedRecordset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._store.get(this.recordsetKey);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:return(r=t.t0).push.apply(r,g(e)),t.abrupt("return",this._reduceRecordSet(r));case 8:case"end":return t.stop()}}),n,this)})))}},{key:"_reduceRecordSet",value:function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var a=e[r],s=[],i=a.requests.length-1;i>=0;i--){var o=a.requests[i],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0)}s.length>0&&(a.requests=s,t.unshift(a))}return t}},{key:"_applyRecord",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=ki.get(this.dbname),s=n.generation,i=n.requests,o=null,t.prev=3,t.next=6,this._store.setMany(i.map((function(e){return Object.assign(Object.assign({},e.data),{generation:s})})));case 6:for(u=t.sent,c=0;c<i.length;c++)u[c]instanceof Error&&(o||(o=u[c]),l=i[c].data,a.put(Object.assign(Object.assign({},l),{generation:s,state:ai.PERSISTENT})));t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),o=t.t0;case 13:if(o){t.next=20;break}return h=e.filter((function(e){return e.generation!==s})),t.next=17,this._store.set({key:this.recordsetKey,value:h,generation:s});case 17:this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})))})),t.next=21;break;case 20:this._onError.forEach((function(e){return e(o)}));case 21:case"end":return t.stop()}}),r,this,[[3,10]])})))}},{key:"init",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._store.get(this.metadataKey);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={generation:1};case 5:return this._metadata=e.t0,e.next=8,this._getReducedRecordset();case 8:n=e.sent,r=E(n),e.prev=10,r.s();case 12:if((a=r.n()).done){e.next=18;break}return s=a.value,e.next=16,this._applyRecord(n,s);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(10),r.e(e.t1);case 23:return e.prev=23,r.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[10,20,23,26]])})))}},{key:"on",value:function(e,t,n){switch(e){case ri.COMMIT:this._onCommit.set(t,n);break;case ri.WRITE:this._onWrite.set(t,n);break;case ri.ERROR:this._onError.set(t,n)}}},{key:"requestWrite",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._requests.push({data:e,options:t});var n=ki.get(this.dbname);n.put(Object.assign({state:ai.PENDING,generation:this.generation},e))}},{key:"requestMultipleWrite",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=ki.get(this.dbname),a=E(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;this._requests.push({data:s,options:n}),r.put(Object.assign({state:ai.PENDING,generation:this.generation},s))}}catch(e){a.e(e)}finally{a.f()}}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ki.get(this.dbname).clearByCondition((function(e){return e.state===ai.PENDING})),this._requests=[];case 3:case"end":return e.stop()}}),e,this)})))}},{key:"commit",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c,l,h,d,p,f,v,_=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=this._requests).length>0)){e.next=20;break}for(r=[],a={},s=n.length-1;s>=0;s--)i=n[s],o=i.data,a[o.key]||(a[o.key]=!0,r.unshift(i));return u={generation:this.generation,requests:r},e.next=8,this._getReducedRecordset([u]);case 8:return c=e.sent,e.next=11,this._store.set({key:this.recordsetKey,value:c,generation:this.generation});case 11:return this._metadata.generation++,e.next=14,this._store.set({key:this.metadataKey,value:this._metadata,generation:1});case 14:for(l=ki.get(this.dbname),h=0;h<r.length;h++)d=r[h],p=d.data,f=d.options,l.put(Object.assign(Object.assign({},p),{generation:u.generation,state:f&&f.persistent?ai.PERSISTENT:ai.VOLATILE}));this._requests=[],this._onCommit.forEach((function(e){e(n.map((function(e){return e.data})))})),v=Qs.get(this.dbname),setTimeout((function(){try{_._applyRecord(c,u)}catch(e){_._onError.forEach((function(t){return t(e)}))}}),v.transactionApplyDelay);case 20:case"end":return e.stop()}}),e,this)})))}}]),e}(),bi=function(){function e(t){var n=t.blockId,a=t.keyName,s=t.items,i=void 0===s?[]:s,o=t.limit;r(this,e),this.blockId=n,this.keyName=a,this.limit=o,this._items=g(i)}return s(e,[{key:"isEmpty",get:function(){return 0===this._items.length}},{key:"items",get:function(){return this._items}},{key:"serialize",value:function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}}},{key:"getItemByKey",value:function(e){var t=this;return this._items.find((function(n){var r=n[t.keyName];return e===r}))}},{key:"has",value:function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)}},{key:"add",value:function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)}},{key:"remove",value:function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return!1}},{key:"clear",value:function(){this._items=[]}}],[{key:"createFromCacheItem",value:function(t){return t?new e(t.value):null}}]),e}(),wi=function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return(n.hashFunction||Js)(e,r)},xi=function(){function e(t){var n=t.dbname,a=t.collectionName,s=t.metadata,i=t.hashFunction,o=void 0===i?Js:i,u=t.transaction,c=t.store;r(this,e),this.dbname=n,this.collectionName=a,this.hashFunction=o,this.metadata=s,this._transaction=u,this._store=c}return s(e,[{key:"keyName",get:function(){return this.metadata.keyName}},{key:"createBlockId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.metadata.blockLevel;return pi(this.dbname,this.collectionName,t,"".concat(wi(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})))}},{key:"_findBlock",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=ki.get(this.dbname),a=this.metadata.blockLevel;case 2:if(!(a>0)){t.next=15;break}return s=this.createBlockId(e,a),t.next=6,r.find(this._store,s);case 6:if(!(i=t.sent)){t.next=12;break}if(o=bi.createFromCacheItem(i),!o.getItemByKey(e)){t.next=12;break}return t.abrupt("return",o);case 12:a--,t.next=2;break;case 15:return t.abrupt("return",null);case 16:case"end":return t.stop()}}),n,this)})))}},{key:"getFromBlock",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._findBlock(e);case 2:return r=t.sent,t.abrupt("return",r?r.getItemByKey(e):null);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"putToBlock",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Qs.get(this.dbname),s=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/a.itemSizeLimit),o=ki.get(this.dbname),t.next=6,o.find(this._store,s);case 6:if(u=t.sent,!(c=u?bi.createFromCacheItem(u):new bi({blockId:s,keyName:this.keyName,items:[],limit:i})).add(n)){t.next=11;break}return this._transaction.requestWrite({key:c.blockId,value:c.serialize()}),t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"removeFromBlock",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._findBlock(e);case 2:if(!(r=t.sent)){t.next=7;break}if(!r.remove(e)){t.next=7;break}return this._transaction.requestWrite({key:r.blockId,value:r.serialize()}),t.abrupt("return",!0);case 7:return t.abrupt("return",!1);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"clearAllBlocks",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=di(this.dbname,this.collectionName),e.next=3,this._store.getAllKeys();case 3:return r=e.sent,a=r.filter((function(e){return e.startsWith(n)})),e.next=7,this._store.removeMany(a);case 7:return e.next=9,this._transaction.clear();case 9:ki.get(this.dbname).clearByCondition((function(e){return e.key.startsWith(n)}));case 11:case"end":return e.stop()}}),e,this)})))}}]),e}(),Ci={},Ti=function(){function e(t){var n=this,a=t.dbname,s=t.collectionName,i=t.keyName,o=t.fields,u=t.transaction,c=t.store;r(this,e),this._origin=[],this._table=[];var l=function(e,t,n){return"".concat(li(e,t),"/index.").concat(n)}(a,s,o.join(">"));return Ci[l]||(this.dbname=a,this.collectionName=s,this.keyName=i,this.fields=o,this.indexerKey=l,this._transaction=u,this._store=c,this._transaction.on(ri.COMMIT,this.indexerKey,(function(){return n.commit()})),this._transaction.on(ri.ERROR,this.indexerKey,(function(){return n.abort()}))),Ci[l]}return s(e,[{key:"_addItem",value:function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=m(this.indexOf(n),2),a=r[0];return r[1]?!this._table[a].keys.includes(t)&&(this._table[a].keys.push(t),!0):(this._table.splice(a,0,{columnValues:n,keys:[t]}),!0)}},{key:"_removeItem",value:function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=m(this.indexOf(n),2),a=r[0];if(r[1]){var s=this._table[a].keys.indexOf(t);if(s>-1)return this._table[a].keys.splice(s,1),0===this._table[a].keys.length&&this._table.splice(a,1),!0}return!1}},{key:"origin",get:function(){return this._origin}},{key:"table",get:function(){return this._table}},{key:"getColumnValues",value:function(e){var t,r,a,s=[],i=E(this.fields);try{for(i.s();!(t=i.n()).done;){var o=t.value;if("-"===o[0]&&(o=o.slice(1)),r=e[o],a=void 0,a=n(r),null!==r&&"undefined"!==a&&"boolean"!==a&&"number"!==a&&"string"!==a)throw Ks.indexTypesNotMatch;s.push(e[o])}}catch(e){i.e(e)}finally{i.f()}return s}},{key:"diff",value:function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,a=Ys(e[n],t[n]);if(0!==a)return r*a}return 0}},{key:"indexOf",value:function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),a=this.diff(e,this._table[r].columnValues);if(a>0)t=r+1;else{if(!(a<0))return[r,!0];n=r-1}}return[t,!1]}return[0,!1]}},{key:"ensure",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c,l,h,d,p;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ki.get(this.dbname),e.next=3,n.find(this._store,this.indexerKey,si.PERSISTENT);case 3:if(r=e.sent){e.next=34;break}return a=di(this.dbname,this.collectionName),e.next=8,this._store.getAllKeys();case 8:s=e.sent,i=E(s),e.prev=10,i.s();case 12:if((o=i.n()).done){e.next=23;break}if(!(u=o.value).startsWith(a)){e.next=21;break}return e.next=17,n.find(this._store,u,si.NO_CACHE);case 17:c=e.sent,l=bi.createFromCacheItem(c),h=E(l.items);try{for(h.s();!(d=h.n()).done;)p=d.value,this._addItem(p)}catch(e){h.e(e)}finally{h.f()}case 21:e.next=12;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(10),i.e(e.t0);case 28:return e.prev=28,i.f(),e.finish(28);case 31:this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),e.next=36;break;case 34:this._origin=r.value,this._table=Ws(this._origin);case 36:Ci[this.indexerKey]=this;case 37:case"end":return e.stop()}}),e,this,[[10,25,28,31]])})))}},{key:"drop",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki.get(this.dbname).remove(this.indexerKey),e.next=4,this._store.remove(this.indexerKey);case 4:delete Ci[this.indexerKey];case 5:case"end":return e.stop()}}),e,this)})))}},{key:"addItem",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 1:case"end":return t.stop()}}),n,this)})))}},{key:"removeItem",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 1:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0});case 2:case"end":return e.stop()}}),e,this)})))}},{key:"commit",value:function(){this._origin=this._table,this._table=Ws(this._origin)}},{key:"abort",value:function(){this._table=Ws(this._origin)}}],[{key:"createKey",value:function(e){return e.join(">")}},{key:"parseKey",value:function(e){return e.split(">")}},{key:"clearIndexerMap",value:function(){for(var e in Ci)delete Ci[e]}}]),e}(),Ii=function(){function e(t){var n=this,a=t.dbname,s=t.collectionName,i=t.keyName,o=t.keyHash,u=t.indexes,c=t.store;r(this,e),this._state=Bs.INIT,this._metadata=null,this._indexers=[],this.dbname=a,this.name=s,this.keyName=i,this.indexes=[[i]].concat(g(u.filter((function(e){return Ti.createKey(e)!==n.keyName})))),this._keyHash=o,this._store=c,this._mutex=new ga(function(e,t){return"".concat(li(e,t),".lock")}(a,s)),this._blobContainer=new _i({dbname:a,collectionName:s,store:c}),this._transaction=new Ei({dbname:a,collectionName:s,store:c})}return s(e,[{key:"state",get:function(){return this._state}},{key:"isReady",get:function(){return this._state===Bs.READY}},{key:"init",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d,p,f=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._mutex.lock();case 2:return t.prev=2,r=Qs.get(this.dbname),t.next=6,e.metadataOf(this.dbname,this.name,this._store);case 6:return a=t.sent,this._metadata=a||{keyName:this.keyName,blockLevel:1,blockHashBase:r.blockHashBase,blockHashMultiplier:r.blockHashMultiplier,blockHashConstant:r.blockHashConstant,indexes:this.indexes},t.next=10,this._transaction.init();case 10:this._blockManager=new xi({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),s=g(this.indexes),i=[],o=s.map((function(e){return Ti.createKey(e)})),u=a?a.indexes.map((function(e){return Ti.createKey(e)})):[],c=E(u);try{for(c.s();!(l=c.n()).done;)h=l.value,o.includes(h)||i.push(Ti.parseKey(h))}catch(e){c.e(e)}finally{c.f()}return(d=[]).push.apply(d,g(s.map((function(e){var t=new Ti({dbname:f.dbname,collectionName:f.name,keyName:f.keyName,fields:e,transaction:f._transaction,store:f._store});return f._indexers.push(t),t.ensure()})))),d.push.apply(d,g(i.map((function(e){return new Ti({dbname:f.dbname,collectionName:f.name,keyName:f.keyName,fields:e,transaction:f._transaction,store:f._store}).drop()})))),t.next=22,Promise.all(d);case 22:return t.next=24,this._transaction.commit();case 24:if(o.sort().join(",")===u.sort().join(",")){t.next=29;break}return p=hi(this.dbname,this.name),this._metadata.indexes=s,t.next=29,this._store.set({key:p,value:this._metadata,generation:1});case 29:this._state=Bs.READY,this._mutex.unlock(),t.next=37;break;case 33:throw t.prev=33,t.t0=t.catch(2),this._mutex.unlock(),t.t0;case 37:case"end":return t.stop()}}),n,this,[[2,33]])})))}},{key:"close",value:function(){this._state=Bs.CLOSED}},{key:"_hasPropertyOfKeyName",value:function(e){var t=e[this.keyName];return"string"==typeof t&&!!t}},{key:"_getIndexerBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e||(e=[this.keyName]);var t,n=Ti.createKey(e),r=E(this._indexers);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(n===Ti.createKey(a.fields))return a}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"_upgradeBlockLevel",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=hi(this.dbname,this.name),this._metadata.blockLevel++,e.next=4,this._store.set({key:n,value:this._metadata,generation:1});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_requestInsert",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[this.keyName],t.next=3,this._blockManager.getFromBlock(r);case 3:if(t.sent){t.next=32;break}return t.next=7,this._blockManager.putToBlock(r,e);case 7:if(t.sent){t.next=13;break}return t.next=11,this._upgradeBlockLevel();case 11:return t.next=13,this._blockManager.putToBlock(r,e);case 13:a=E(this._indexers),t.prev=14,a.s();case 16:if((s=a.n()).done){t.next=22;break}return i=s.value,t.next=20,i.addItem(e);case 20:t.next=16;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(14),a.e(t.t0);case 27:return t.prev=27,a.f(),t.finish(27);case 30:t.next=33;break;case 32:throw Ks.collectionInsertDuplicate;case 33:case"end":return t.stop()}}),n,this,[[14,24,27,30]])})))}},{key:"_requestUpsert",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[this.keyName],t.next=3,this._blockManager.getFromBlock(r);case 3:if(a=t.sent){t.next=32;break}return t.next=7,this._blockManager.putToBlock(r,e);case 7:if(t.sent){t.next=13;break}return t.next=11,this._upgradeBlockLevel();case 11:return t.next=13,this._blockManager.putToBlock(r,e);case 13:s=E(this._indexers),t.prev=14,s.s();case 16:if((i=s.n()).done){t.next=22;break}return o=i.value,t.next=20,o.addItem(e);case 20:t.next=16;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(14),s.e(t.t0);case 27:return t.prev=27,s.f(),t.finish(27);case 30:t.next=54;break;case 32:return t.next=34,this._blockManager.putToBlock(r,e);case 34:u=E(this._indexers),t.prev=35,u.s();case 37:if((c=u.n()).done){t.next=46;break}if(0===(l=c.value).diff(l.getColumnValues(a),l.getColumnValues(e))){t.next=44;break}return t.next=42,l.removeItem(a);case 42:return t.next=44,l.addItem(e);case 44:t.next=37;break;case 46:t.next=51;break;case 48:t.prev=48,t.t1=t.catch(35),u.e(t.t1);case 51:return t.prev=51,u.f(),t.finish(51);case 54:case"end":return t.stop()}}),n,this,[[14,24,27,30],[35,48,51,54]])})))}},{key:"_requestUpdate",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[this.keyName],t.next=3,this._blockManager.getFromBlock(r);case 3:if(!(a=t.sent)){t.next=27;break}return t.next=7,this._blockManager.putToBlock(r,e);case 7:s=E(this._indexers),t.prev=8,s.s();case 10:if((i=s.n()).done){t.next=19;break}if(0===(o=i.value).diff(o.getColumnValues(a),o.getColumnValues(e))){t.next=17;break}return t.next=15,o.removeItem(a);case 15:return t.next=17,o.addItem(e);case 17:t.next=10;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(8),s.e(t.t0);case 24:return t.prev=24,s.f(),t.finish(24);case 27:case"end":return t.stop()}}),n,this,[[8,21,24,27]])})))}},{key:"_requestRemove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blockManager.getFromBlock(e);case 2:if(!(r=t.sent)){t.next=23;break}return t.next=6,this._blockManager.removeFromBlock(e);case 6:a=E(this._indexers),t.prev=7,a.s();case 9:if((s=a.n()).done){t.next=15;break}return i=s.value,t.next=13,i.removeItem(r);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),a.e(t.t0);case 20:return t.prev=20,a.f(),t.finish(20);case 23:case"end":return t.stop()}}),n,this,[[7,17,20,23]])})))}},{key:"_requestClear",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blockManager.clearAllBlocks();case 2:n=E(this._indexers),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=11;break}return a=r.value,e.next=9,a.clear();case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})))}},{key:"getByKey",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=17;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,t.next=6,this._blockManager.getFromBlock(e);case 6:return r=t.sent,this._mutex.unlock(),t.abrupt("return",Ws(r));case 11:throw t.prev=11,t.t0=t.catch(3),this._mutex.unlock(),t.t0;case 15:t.next=18;break;case 17:throw Ks.collectionNotReady;case 18:case"end":return t.stop()}}),n,this,[[3,11]])})))}},{key:"query",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.isReady?new ui({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward}):null}},{key:"insertOne",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw Ks.collectionKeyNotGiven;case 6:return t.next=8,this._requestInsert(Ws(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw Ks.collectionNotReady;case 23:case"end":return t.stop()}}),n,this,[[3,14]])})))}},{key:"insertMany",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=37;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,!e.some((function(e){return!i._hasPropertyOfKeyName(e)}))){t.next=6;break}throw Ks.collectionKeyNotGiven;case 6:r=E(e),t.prev=7,r.s();case 9:if((a=r.n()).done){t.next=15;break}return s=a.value,t.next=13,this._requestInsert(Ws(s));case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),r.e(t.t0);case 20:return t.prev=20,r.f(),t.finish(20);case 23:return t.next=25,this._transaction.commit();case 25:return this._mutex.unlock(),t.abrupt("return",e);case 29:return t.prev=29,t.t1=t.catch(3),t.next=33,this._transaction.clear();case 33:throw this._mutex.unlock(),t.t1;case 35:t.next=38;break;case 37:throw Ks.collectionNotReady;case 38:case"end":return t.stop()}}),n,this,[[3,29],[7,17,20,23]])})))}},{key:"upsertOne",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw Ks.collectionKeyNotGiven;case 6:return t.next=8,this._requestUpsert(Ws(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw Ks.collectionNotReady;case 23:case"end":return t.stop()}}),n,this,[[3,14]])})))}},{key:"upsertMany",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=37;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,!e.some((function(e){return!i._hasPropertyOfKeyName(e)}))){t.next=6;break}throw Ks.collectionKeyNotGiven;case 6:r=E(e),t.prev=7,r.s();case 9:if((a=r.n()).done){t.next=15;break}return s=a.value,t.next=13,this._requestUpsert(Ws(s));case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),r.e(t.t0);case 20:return t.prev=20,r.f(),t.finish(20);case 23:return t.next=25,this._transaction.commit();case 25:return this._mutex.unlock(),t.abrupt("return",e);case 29:return t.prev=29,t.t1=t.catch(3),t.next=33,this._transaction.clear();case 33:throw this._mutex.unlock(),t.t1;case 35:t.next=38;break;case 37:throw Ks.collectionNotReady;case 38:case"end":return t.stop()}}),n,this,[[3,29],[7,17,20,23]])})))}},{key:"update",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=22;break}return t.next=3,this._mutex.lock();case 3:if(t.prev=3,this._hasPropertyOfKeyName(e)){t.next=6;break}throw Ks.collectionKeyNotGiven;case 6:return t.next=8,this._requestUpdate(Ws(e));case 8:return t.next=10,this._transaction.commit();case 10:return this._mutex.unlock(),t.abrupt("return",e);case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,this._transaction.clear();case 18:throw this._mutex.unlock(),t.t0;case 20:t.next=23;break;case 22:throw Ks.collectionNotReady;case 23:case"end":return t.stop()}}),n,this,[[3,14]])})))}},{key:"updateIf",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h,d,p,f,v=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.isReady){r.next=31;break}return r.next=3,this._mutex.lock();case 3:return r.prev=3,a=e.where,s=void 0===a?{}:a,i=e.index,o=void 0===i?null:i,u=e.backward,c=void 0!==u&&u,l=[],h=new oi({condition:s,blockManager:this._blockManager,backward:c,indexer:this._getIndexerBy(o)}),r.next=9,h.each((function(e){return b(v,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.error){t.next=4;break}if(e.hasNext){if(a=e.nextValue,Zs(s,a)&&n.set){if("function"!=typeof n.set)for(i in n.set)a[i]=n.set[i];else n.set(a);l.push(a)}e.next()}else e.stop();t.next=6;break;case 4:throw e.stop(),e.error;case 6:case"end":return t.stop()}}),r)})))}));case 9:d=0,p=l;case 10:if(!(d<p.length)){r.next=17;break}return f=p[d],r.next=14,this._requestUpdate(Ws(f));case 14:d++,r.next=10;break;case 17:return r.next=19,this._transaction.commit();case 19:return this._mutex.unlock(),r.abrupt("return",l);case 23:return r.prev=23,r.t0=r.catch(3),r.next=27,this._transaction.clear();case 27:throw this._mutex.unlock(),r.t0;case 29:r.next=33;break;case 31:throw this._transaction.clear(),Ks.collectionNotReady;case 33:case"end":return r.stop()}}),r,this,[[3,23]])})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isReady){t.next=19;break}return t.next=3,this._mutex.lock();case 3:return t.prev=3,t.next=6,this._requestRemove(e);case 6:return t.next=8,this._transaction.commit();case 8:this._mutex.unlock(),t.next=17;break;case 11:return t.prev=11,t.t0=t.catch(3),t.next=15,this._transaction.clear();case 15:throw this._mutex.unlock(),t.t0;case 17:t.next=20;break;case 19:throw Ks.collectionNotReady;case 20:case"end":return t.stop()}}),n,this,[[3,11]])})))}},{key:"removeIf",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d,p,f=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isReady){n.next=29;break}return n.next=3,this._mutex.lock();case 3:return n.prev=3,r=e.where,a=void 0===r?{}:r,s=e.index,i=void 0===s?null:s,o=e.backward,u=void 0!==o&&o,c=[],l=new oi({condition:a,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(i)}),n.next=9,l.each((function(e){return b(f,void 0,void 0,t().mark((function n(){var r,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.error){t.next=4;break}e.hasNext?(r=e.nextValue,Zs(a,r)&&(s=r[this.keyName],c.push(s)),e.next()):e.stop(),t.next=6;break;case 4:throw e.stop(),e.error;case 6:case"end":return t.stop()}}),n,this)})))}));case 9:h=0,d=c;case 10:if(!(h<d.length)){n.next=17;break}return p=d[h],n.next=14,this._requestRemove(p);case 14:h++,n.next=10;break;case 17:return n.next=19,this._transaction.commit();case 19:return this._mutex.unlock(),n.abrupt("return",c);case 23:throw n.prev=23,n.t0=n.catch(3),this._mutex.unlock(),n.t0;case 27:n.next=31;break;case 29:throw this._transaction.clear(),Ks.collectionNotReady;case 31:case"end":return n.stop()}}),n,this,[[3,23]])})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isReady){e.next=19;break}return e.next=3,this._mutex.lock();case 3:return e.prev=3,e.next=6,this._requestClear();case 6:return e.next=8,this._transaction.commit();case 8:this._mutex.unlock(),e.next=17;break;case 11:return e.prev=11,e.t0=e.catch(3),e.next=15,this._transaction.clear();case 15:throw this._mutex.unlock(),e.t0;case 17:e.next=20;break;case 19:throw Ks.collectionNotReady;case 20:case"end":return e.stop()}}),e,this,[[3,11]])})))}},{key:"getBlob",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"saveBlob",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.save(e,n);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"removeBlob",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._blobContainer.remove(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"removeAllBlobs",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._blobContainer.clear();case 2:case"end":return e.stop()}}),e,this)})))}}],[{key:"metadataOf",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=hi(e,n),t.next=3,r.get(s);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),a)})))}}]),e}(),Si=function(){function e(t){var n,a,s;r(this,e),this.encryption=null!==(n=t.encryption)&&void 0!==n?n:j,this.itemSizeLimit=null!==(a=t.itemSizeLimit)&&void 0!==a?a:4194304,this.metadataBuffer=null!==(s=t.metadataBuffer)&&void 0!==s?s:256}return s(e,[{key:"_getRawKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e).concat(t)}},{key:"_generateShardPostfixArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return g(Array(e).keys())}},{key:"_shardify",value:function(e){var t=this,n=e.key,r=e.value,a=JSON.stringify(this.encryption.encrypt(r)),s=Math.ceil(a.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(s).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:a.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:s}),r}))}},{key:"adjustedItemSizeLimit",get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)}},{key:"usage",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,e.next=3,this._getAllRawKeys();case 3:r=e.sent,a=E(r),e.prev=5,a.s();case 7:if((s=a.n()).done){e.next=15;break}return i=s.value,e.next=11,this._getRaw(i);case 11:(o=e.sent)&&(n+=JSON.stringify(o).length);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),a.e(e.t0);case 20:return e.prev=20,a.f(),e.finish(20);case 23:return e.abrupt("return",n);case 24:case"end":return e.stop()}}),e,this,[[5,17,20,23]])})))}},{key:"getAllKeys",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getAllRawKeys();case 2:return n=e.sent,e.abrupt("return",n.filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=this._getRawKey(e,".0"),n.next=3,this._getRaw(r);case 3:if(!(a=n.sent)){n.next=21;break}if(n.prev=5,s=a.data,!((null==(i=a.metadata)?void 0:i.shards)>1)){n.next=13;break}return n.next=10,Promise.all(this._generateShardPostfixArray(null==i?void 0:i.shards).map((function(n){return b(u,void 0,void 0,t().mark((function r(){var a,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n>0)){t.next=10;break}return a=this._getRawKey(e,".".concat(n)),t.next=4,this._getRaw(a);case 4:if(i=t.sent){t.next=7;break}throw Ks.storeBrokenIntegrity;case 7:return t.abrupt("return",i.data);case 10:return t.abrupt("return",s);case 11:case"end":return t.stop()}}),r,this)})))})));case 10:n.t0=n.sent,n.next=14;break;case 13:n.t0=[s];case 14:return o=n.t0,n.abrupt("return",this.encryption.decrypt(JSON.parse(o.join(""))));case 18:return n.prev=18,n.t1=n.catch(5),n.abrupt("return",null);case 21:return n.abrupt("return",null);case 22:case"end":return n.stop()}}),n,this,[[5,18]])})))}},{key:"set",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._shardify(e),t.next=3,this._setRaw(r);case 3:return t.abrupt("return",Object.assign({},e.value));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"setMany",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setRaw((r=[]).concat.apply(r,g(e.map((function(e){return a._shardify(e)})))));case 2:return t.abrupt("return",e.map((function(e){return e.value})));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getRawKey(e,".0"),t.next=3,this._getRaw(r);case 3:if(!(a=t.sent)){t.next=9;break}return s=a.metadata,t.next=8,this._removeRaw(this._generateShardPostfixArray(null==s?void 0:s.shards).map((function(t){return i._getRawKey(e,".".concat(t))})));case 8:return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),n,this)})))}},{key:"removeMany",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=[],a=E(e),n.prev=2,i=t().mark((function e(){var n,a,i,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.value,a=o._getRawKey(n,".0"),e.next=4,o._getRaw(a);case 4:(i=e.sent)&&(u=i.metadata,r.push.apply(r,g(o._generateShardPostfixArray(null==u?void 0:u.shards).map((function(e){return o._getRawKey(n,".".concat(e))})))));case 6:case"end":return e.stop()}}),e)})),a.s();case 5:if((s=a.n()).done){n.next=9;break}return n.delegateYield(i(),"t0",7);case 7:n.next=5;break;case 9:n.next=14;break;case 11:n.prev=11,n.t1=n.catch(2),a.e(n.t1);case 14:return n.prev=14,a.f(),n.finish(14);case 17:if(!(r.length>0)){n.next=20;break}return n.next=20,this._removeRaw(r);case 20:return n.abrupt("return",e);case 21:case"end":return n.stop()}}),n,this,[[2,11,14,17]])})))}}]),e}(),Ni=4194304,Mi={},Ai=function(e){i(a,e);var n=f(a);function a(){var e,t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,a),e=n.call(this,Object.assign(Object.assign({},s),{itemSizeLimit:null!==(t=s.itemSizeLimit)&&void 0!==t?t:Ni}));var i=s.delay,o=void 0===i?1:i;return e.delay=o,e.observer={},e}return s(a,[{key:"rawData",get:function(){return Mi[this.dbname]},set:function(e){Mi[this.dbname]=e}},{key:"_getAllRawKeys",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Mi[this.dbname]){e.next=4;break}return e.abrupt("return",Object.keys(Mi[this.dbname]));case 4:throw Ks.storeNotAvailable;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Mi[this.dbname]){t.next=6;break}return t.next=3,Xs(this.delay);case 3:return t.abrupt("return",Mi[this.dbname][e]?Object.assign({key:e},Mi[this.dbname][e]):null);case 6:throw Ks.storeNotAvailable;case 7:case"end":return t.stop()}}),n,this)})))}},{key:"_setRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Mi[this.dbname]){t.next=7;break}return t.next=3,Xs(this.delay);case 3:r=E(e);try{for(r.s();!(a=r.n()).done;)s=a.value,i=s.key,o=s.data,u=s.metadata,Mi[this.dbname][i]=Object.freeze({data:o,metadata:u})}catch(e){r.e(e)}finally{r.f()}t.next=8;break;case 7:throw Ks.storeNotAvailable;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"_removeRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Mi[this.dbname]){t.next=7;break}return t.next=3,Xs(this.delay);case 3:r=E(e);try{for(r.s();!(a=r.n()).done;)s=a.value,Mi[this.dbname][s]&&delete Mi[this.dbname][s]}catch(e){r.e(e)}finally{r.f()}t.next=8;break;case 7:throw Ks.storeNotAvailable;case 8:case"end":return t.stop()}}),n,this)})))}},{key:"observe",value:function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}))}},{key:"isAvailable",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})))}},{key:"init",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.dbname=e,Mi[this.dbname]={};case 2:case"end":return t.stop()}}),n,this)})))}},{key:"set",value:function(e){var n=this,r=Object.create(null,{set:{get:function(){return _(o(a.prototype),"set",n)}}});return b(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.observer[e.key]||"function"!=typeof this.observer[e.key].set){t.next=4;break}if(!(a=this.observer[e.key].set())){t.next=4;break}throw a;case 4:return t.abrupt("return",r.set.call(this,e));case 5:case"end":return t.stop()}}),n,this)})))}},{key:"setMany",value:function(e){var n=this,r=Object.create(null,{setMany:{get:function(){return _(o(a.prototype),"setMany",n)}}});return b(this,void 0,void 0,t().mark((function n(){var a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=E(e),t.prev=1,a.s();case 3:if((s=a.n()).done){t.next=11;break}if(i=s.value,!this.observer[i.key]||"function"!=typeof this.observer[i.key].set){t.next=9;break}if(!(o=this.observer[i.key].set())){t.next=9;break}throw o;case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),a.e(t.t0);case 16:return t.prev=16,a.f(),t.finish(16);case 19:return t.abrupt("return",r.setMany.call(this,e));case 20:case"end":return t.stop()}}),n,this,[[1,13,16,19]])})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xs(this.delay);case 2:Mi[this.dbname]={};case 3:case"end":return e.stop()}}),e,this)})))}}]),a}(Si),Ui=104857600,Oi="NestDBStore",Ri=function(e){i(a,e);var n=f(a);function a(){var e,t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,a),(e=n.call(this,Object.assign(Object.assign({},s),{itemSizeLimit:null!==(t=s.itemSizeLimit)&&void 0!==t?t:Ui})))._storeName=Oi,e._window="undefined"!=typeof window?window:null,e._indexedDb=e._window?e._window.indexedDB||e._window.mozIndexedDB||e._window.webkitIndexedDB||e._window.msIndexedDB:null,e}return s(a,[{key:"_getObjectStore",value:function(e){return this._database.transaction(this._storeName,e).objectStore(this._storeName)}},{key:"_getAllRawKeys",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){var r=n._getObjectStore("readonly").getAllKeys();r.addEventListener("success",(function(t){e(t.target.result)})),r.addEventListener("error",(function(e){return t(e.target.error)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}},{key:"_getRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,n){var a=r._getObjectStore("readonly").get(e);a.addEventListener("success",(function(e){var n;t(null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.result)})),a.addEventListener("error",(function(e){return n(e.target.error)}))}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n)})))}},{key:"_setRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getObjectStore("readwrite"),t.next=3,Promise.all(e.map((function(e){return new Promise((function(t,n){var a=r.put(e);a.addEventListener("success",(function(e){t(e.target.result)})),a.addEventListener("error",(function(){n("Failed to write.")}))}))})));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"_removeRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getObjectStore("readwrite"),t.next=3,Promise.all(e.map((function(e){return new Promise((function(t,n){var a=r.delete(e);a.addEventListener("success",(function(){return t(e)})),a.addEventListener("error",(function(e){return n(e.target.error)}))}))})));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"isAvailable",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null==(n="undefined"!=typeof window?window:null)?void 0:n.indexedDB)||(null==n?void 0:n.mozIndexedDB)||(null==n?void 0:n.webkitIndexedDB)||(null==n?void 0:n.msIndexedDB))){e.next=15;break}return e.prev=2,this._indexedDb=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB,r="undefined"!=typeof document&&"undefined"!=typeof navigator,a=navigator.userAgent&&navigator.userAgent.includes("Firefox/")&&!navigator.userAgent.includes("Seamonkey/"),s=navigator.userAgent&&navigator.userAgent.includes("Edge/"),e.next=9,new Promise((function(e,t){if(r)if(a){var o=i._indexedDb.open("_testMozilla");o.onerror=function(){return t("Private browsing mode.")},o.onsuccess=function(){return e()}}else s?(n.PointerEvent||n.MSPointerEvent)&&t("Private browsing mode."):e()}));case 9:return e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(2),e.abrupt("return",!1);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this,[[2,12]])})))}},{key:"init",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.dbname=e,r=new Promise((function(e,t){if(a._window&&la)if(ha){var n=a._indexedDb.open("_testMozilla");n.onerror=function(){return t(Ks.storeNotAvailableInPrivateBrowsing)},n.onsuccess=function(){return e()}}else fa?a._window.indexedDB||!a._window.PointerEvent&&!a._window.MSPointerEvent||t(Ks.storeNotAvailableInPrivateBrowsing):e();else t(Ks.storeNotAvailable)})),t.next=4,r;case 4:return t.next=6,new Promise((function(t,n){var r=a._indexedDb.open(e);r.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(Oi,{keyPath:"key"})})),r.addEventListener("success",(function(e){return t(e.target.result)})),r.addEventListener("error",(function(e){return n(e.target.error)}))}));case 6:this._database=t.sent;case 7:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){var r=n._getObjectStore("readwrite").clear();r.addEventListener("success",(function(){return e()})),r.addEventListener("error",(function(e){return t(e.target.error)}))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}}]),a}(Si),Di=function(e){i(a,e);var n=f(a);function a(e){var t;r(this,a);var s=e.AsyncStorage,i=e.itemSizeLimit,o=void 0===i?6291456:i,u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["AsyncStorage","itemSizeLimit"]);return(t=n.call(this,Object.assign(Object.assign({},u),{itemSizeLimit:o})))._asyncStorage=s,t}return s(a,[{key:"_isBelonging",value:function(e){return e.startsWith("".concat(this.dbname,"/"))}},{key:"_getActualKey",value:function(e){return"".concat(this.dbname,"/").concat(e)}},{key:"_getAllRawKeys",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._asyncStorage.getAllKeys();case 2:return n=e.sent,r=n.filter((function(e){return a._isBelonging(e)})),e.abrupt("return",r.map((function(e){return e.substring("".concat(a.dbname,"/").length)})));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._asyncStorage.getItem(this._getActualKey(e));case 2:return r=t.sent,t.abrupt("return",r?JSON.parse(r):null);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"_setRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],a=E(e);try{for(a.s();!(s=a.n()).done;)i=s.value,o=i.key,i.data.length<=this.adjustedItemSizeLimit&&r.push([this._getActualKey(o),JSON.stringify(i)])}catch(e){a.e(e)}finally{a.f()}return t.next=5,this._asyncStorage.multiSet(r);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"_removeRaw",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._asyncStorage.multiRemove(e.map((function(e){return r._getActualKey(e)})));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"isAvailable",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this._asyncStorage);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.dbname=e;case 1:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllKeys();case 2:return n=e.sent,e.next=5,this.removeMany(n);case 5:case"end":return e.stop()}}),e,this)})))}}]),a}(Si),Li=function(e){return b(void 0,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.usage();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n)})))},Pi="[NESTDB]",Fi=!0,Gi=function(){function e(){r(this,e)}return s(e,null,[{key:"off",value:function(){Fi=!1}},{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];Fi&&(e=console).log.apply(e,["".concat(Pi,"[LOG]")].concat(n))}},{key:"warning",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];Fi&&(e=console).warn.apply(e,["".concat(Pi,"[WARNING]")].concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];Fi&&(e=console).error.apply(e,["".concat(Pi,"[ERROR]")].concat(n))}}]),e}();!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED"}(mi||(mi={}));var qi,Hi=function(){function e(t){var n=t.name,a=t.version,s=t.store,i=t.config;r(this,e),this.name=n,this._version=a,this._state=mi.INIT,this._config=i||new Qs({dbname:n}),this._store=s,this._event={success:$s,error:$s,upgrade:ni},this._collections=new Map,this._globalMutex=new ga("".concat(this.name,".lock")),this._config.disableLogger&&Gi.off(),new ki({dbname:n,limit:this._config.cacheLimit})}return s(e,[{key:"version",get:function(){return this._version}},{key:"state",get:function(){return this._state}},{key:"estimateUsage",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Li(this._store);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"commitSchema",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._state!==mi.OPENING){n.next=5;break}return n.next=3,Promise.all(e.map((function(e){return b(r,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.collectionName,a=e.keyName,s=e.index,i=void 0===s?[]:s,this._collections.has(r)||this._collections.set(r,new Ii({dbname:this.name,collectionName:r,keyName:a,indexes:i,store:this._store})),t.next=4,this._collections.get(r).init();case 4:case"end":return t.stop()}}),n,this)})))})));case 3:n.next=6;break;case 5:throw Ks.databaseSchemaNotOnUpgrade;case 6:case"end":return n.stop()}}),n,this)})))}},{key:"open",value:function(){var e;return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._globalMutex.lock();case 2:if(this._state===mi.OPENED){n.next=55;break}return this._state=mi.OPENING,n.prev=4,n.next=7,this._store.init(this.name);case 7:return o=this.name,r="".concat(ci(o),".metadata"),a={version:0,collectionNames:[]},n.next=11,this._store.get(r);case 11:if(n.t1=e=n.sent,n.t0=null!==n.t1,!n.t0){n.next=15;break}n.t0=void 0!==e;case 15:if(!n.t0){n.next=19;break}n.t2=e,n.next=20;break;case 19:n.t2=a;case 20:return s=n.t2,n.abrupt("return",new Promise((function(e,n){var a=function(e){s.version<i._version?i._event.upgrade(s.version,(function(n){return b(i,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=14;break}return s.version++,s.collectionNames=Array.from(this._collections.keys()),t.prev=3,t.next=6,this._store.set({key:r,value:s,generation:this._version});case 6:e({continued:!0}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),e({continued:!1,err:t.t0});case 12:t.next=15;break;case 14:e({continued:!1,err:n});case 15:case"end":return t.stop()}}),a,this,[[3,9]])})))})):e({continued:!1})};a((function r(o){var u=o.continued,c=void 0!==u&&u,l=o.err,h=void 0===l?null:l;if(c)setTimeout((function(){return a(r)}),10);else if(h)Gi.error(h.message),i._globalMutex.unlock(),i._event.error(h),n(h);else{var d=[];s.collectionNames.forEach((function(e){i._collections.has(e)||d.push(b(i,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ii.metadataOf(this.name,e,this._store);case 2:if(!(r=t.sent)){t.next=8;break}return a=new Ii({dbname:this.name,collectionName:e,keyName:r.keyName,indexes:r.indexes,store:this._store}),this._collections.set(e,a),t.next=8,a.init();case 8:case"end":return t.stop()}}),n,this)}))))})),Promise.all(d).then((function(){i._state=mi.OPENED,i._globalMutex.unlock(),i._event.success(),e()})).catch((function(e){Gi.error(e.message),i._globalMutex.unlock(),i._event.error(e),n(e)}))}}))})));case 24:n.prev=24,n.t3=n.catch(4),n.t4=n.t3.code,n.next=n.t4===Ua.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING?29:n.t4===Ua.STORE_NOT_AVAILABLE?36:n.t4===Ua.STORE_ENCRYPTION_INVALID?43:51;break;case 29:return Gi.warning("Access to the local storage is not allowed in private browsing. Switched to MemoryStore automatically."),this._store=new Ai({}),this._globalMutex.unlock(),this._event.error(n.t3),n.next=35,this.open();case 35:return n.abrupt("break",55);case 36:return Gi.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Ai({}),this._globalMutex.unlock(),this._event.error(n.t3),n.next=42,this.open();case 42:return n.abrupt("break",55);case 43:return Gi.warning("Encryption algorithm has changed. Stored data would be cleared."),n.next=46,this._store.clear();case 46:return this._globalMutex.unlock(),this._event.error(n.t3),n.next=50,this.open();case 50:return n.abrupt("break",55);case 51:throw Gi.error(n.t3.message),this._globalMutex.unlock(),this._event.error(n.t3),n.t3;case 55:case"end":return n.stop()}var o}),n,this,[[4,24]])})))}},{key:"close",value:function(){this._collections.forEach((function(e){return e.close()})),this._state=mi.CLOSED}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"reset",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r=this;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.close(),(n=ki.get(this.name))&&n.clearByCondition((function(e){return e.key.startsWith(ci(r.name))})),e.next=5,this._store.clear();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"on",value:function(e,t){this._event[e]=t}},{key:"off",value:function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=ni;else this._event[e]=$s}},{key:"collection",value:function(e){return this._collections.get(e)||null}}]),e}();e.RestrictionType=void 0,(qi=e.RestrictionType||(e.RestrictionType={})).MUTED="muted",qi.BANNED="banned";var ji,Vi=function(){function t(n){var a,s,i;r(this,t),this.restrictionType=null,this.description=null,this.endAt=-1,O(e.RestrictionType,n.restriction_type)&&(this.restrictionType=n.restriction_type),this.description=null!==(a=n.description)&&void 0!==a?a:null,this.endAt=null!==(i=null!==(s=n.end_at)&&void 0!==s?s:n.muted_end_at)&&void 0!==i?i:-1}return s(t,null,[{key:"payloadify",value:function(e){return e?X({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt}):null}}]),t}(),Qi=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).restrictionInfo=null,s.restrictionInfo=new Vi(a),s}return s(n,null,[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(n),"payloadify",this).call(this,e)),Vi.payloadify(e.restrictionInfo))):null}}]),n}(vt),Bi={data:null,customType:null,mentionType:e.MentionType.USERS,mentionedUserIds:null,mentionedUsers:null,mentionedMessageTemplate:null,metaArrays:null,pushNotificationDeliveryOption:null,appleCriticalAlertOptions:null},Ki=function(t){return U("string",t.data,!0)&&U("string",t.customType,!0)&&O(e.MentionType,t.mentionType)&&D("string",t.mentionedUserIds,!0)&&D(vt,t.mentionedUsers,!0)&&U("string",t.mentionedMessageTemplate,!0)&&D(Jt,t.metaArrays,!0)&&O(e.PushNotificationDeliveryOption,t.pushNotificationDeliveryOption,!0)&&U($t,t.appleCriticalAlertOptions,!0)},zi=Object.assign(Object.assign({},Bi),{message:null,translationTargetLanguages:null,pollId:null}),Wi=function(e){return Ki(e)&&U("string",e.message,!0)&&D("string",e.translationTargetLanguages,!0)&&U("number",e.pollId,!0)},Yi=Object.assign({},Bi),Ji=function(e){return Ki(e)},Xi=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.channelType,o=e.token,u=e.limit;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/operators"),a.params={token:o,limit:u},a}return s(n)}($),Zi=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).operators=a.operators.map((function(t){return new vt(e,t)})),s.token=a.next,s}return s(n)}(ee),$i=function(e){i(a,e);var n=f(a);function a(e,t,s,i){return r(this,a),n.call(this,e,t,s,i)}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=21;break}if(this._isLoading){e.next=18;break}if(n=[],!this._hasNext){e.next=15;break}return this._isLoading=!0,r=At.of(this._iid),a=r.requestQueue,s=new Xi(Object.assign(Object.assign({},this),{channelUrl:this.channelUrl,token:this._token})),e.next=9,a.send(s);case 9:return i=e.sent,o=i.as(Zi),u=o.operators,c=o.token,this._token=c,this._hasNext=!!c,this._isLoading=!1,e.abrupt("return",u);case 15:return e.abrupt("return",n);case 18:throw S.queryInProgress;case 19:e.next=22;break;case 21:throw S.invalidParameters;case 22:case"end":return e.stop()}}),e,this)})))}}]),a}(cr),eo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.limit,u=e.token;return(a=t.call(this)).method=T.GET,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/mute"),a.params={limit:o,token:u},a}return s(n)}($),to=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.mutedUsers=[];var i=a.next,o=a.muted_list;return s.token=i,o&&o.length>0&&(s.mutedUsers=o.map((function(t){return new Qi(e,t)}))),s}return s(n)}(ee),no=function(e){i(a,e);var n=f(a);function a(e,t,s,i){return r(this,a),n.call(this,e,t,s,i)}return s(a,[{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new eo(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(to),o=i.mutedUsers,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(cr),ro=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.limit,u=e.token;return(a=t.call(this)).method=T.GET,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/ban"),a.params=X({limit:o,token:u}),a}return s(n)}($),ao=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.bannedUsers=[];var i=a.next,o=a.banned_list;return s.token=i,o&&o.length>0&&(s.bannedUsers=o.map((function(t){return new Qi(e,t.user)}))),s}return s(n)}(ee),so=function(e){i(a,e);var n=f(a);function a(e,t,s,i){return r(this,a),n.call(this,e,t,s,i)}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new ro(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(ao),o=i.bannedUsers,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),a}(cr);e.ReportCategory=void 0,(ji=e.ReportCategory||(e.ReportCategory={})).SPAM="spam",ji.HARASSING="harassing",ji.SUSPICIOUS="suspicious",ji.INAPPROPRIATE="inappropriate";var io,oo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.operatorUserIds;return(a=t.call(this)).method=T.POST,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/operators"),a.params={operator_ids:o},a}return s(n)}($),uo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.operatorUserIds;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/operators"),a.params={operator_ids:o},a}return s(n)}($),co=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.userId;return(a=t.call(this)).method=T.GET,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/mute/").concat(o),a}return s(n)}($),lo=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).isMuted=!1,s.startAt=null,s.endAt=null,s.remainingDuration=null,s.description=null;var i=a.is_muted,o=a.start_at,u=a.end_at,c=a.remaining_duration,l=a.description;return s.isMuted=i,s.startAt=o,s.endAt=u,s.remainingDuration=c,s.description=l,s}return s(n)}(ee),ho=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.keys;return(a=t.call(this)).method=T.GET,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metadata"),a.params={keys:o,include_ts:!0},a}return s(n)}($),po=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).ts=null;var i=a.metadata,o=a.ts;return s.metadata=i,s.ts=null!=o?o:null,s}return s(n)}(ee),fo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.metadata;return(a=t.call(this)).method=T.POST,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metadata"),a.params={metadata:o,include_ts:!0},a}return s(n)}($),vo=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o;return r(this,n),(s=t.call(this,e,a)).metaData=null!==(i=a.metadata)&&void 0!==i?i:{},s.ts=null!==(o=a.ts)&&void 0!==o?o:null,s}return s(n)}(ee),_o=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.metadata,u=e.upsert;return(a=t.call(this)).method=T.PUT,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metadata"),a.params={metadata:o,include_ts:!0,upsert:null!=u&&u},a}return s(n)}($),mo=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).ts=null;var i=a.metadata,o=a.ts;return s.metadata=i,s.ts=null!=o?o:null,s}return s(n)}(ee),go=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).created=null,i.updated=null,i.deleted=null,s.data&&(i.created=s.data.created,i.updated=s.data.updated,i.deleted=s.data.deleted),i}return s(n)}(oe),yo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.key;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metadata/").concat(o),a.params={include_ts:!0},a}return s(n)}($),ko=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).ts=null;var i=a.ts;return s.ts=null!=i?i:null,s}return s(n)}(ee),Eo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metadata"),a.params={include_ts:!0},a}return s(n)}($),bo=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).ts=null;var i=a.ts;return s.ts=null!=i?i:null,s}return s(n)}(ee),wo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.keys;return(a=t.call(this)).method=T.GET,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metacounter"),a.params={keys:o},a}return s(n)}($),xo=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).metaCounter=a,s}return s(n)}(ee),Co=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.metaCounter;return(a=t.call(this)).method=T.POST,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metacounter"),a.params={metacounter:o},a}return s(n)}($),To=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).metaCounter=a,s}return s(n)}(ee),Io=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.metaCounter,u=e.upsert,c=void 0!==u&&u,l=e.mode,h=void 0===l?"set":l;return(a=t.call(this)).method=T.PUT,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metacounter"),a.params={metacounter:o,upsert:c,mode:h},a}return s(n)}($),So=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).metaCounter=a,s}return s(n)}(ee),No=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).created=null,i.updated=null,i.deleted=null,s.data&&(i.created=s.data.created,i.updated=s.data.updated,i.deleted=s.data.deleted),i}return s(n)}(oe),Mo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.key;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metacounter/").concat(o),a.params=null,a}return s(n)}($),Ao=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/metacounter"),a.params=null,a}return s(n)}($),Uo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(a=t.call(this)).method=T.POST,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/mute"),a.params={user_id:o,seconds:u,description:c},a}return s(n)}($),Oo=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).user=new Qi(e,s.data),i}return s(n)}(oe),Ro=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.userId;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/mute/").concat(encodeURIComponent(o)),a}return s(n)}($),Do=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).user=new Qi(e,s.data),i}return s(n)}(oe),Lo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.userId,u=e.seconds,c=e.description;return(a=t.call(this)).method=T.POST,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/ban"),a.params=X({user_id:o,seconds:u,description:c}),a}return s(n)}($),Po=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).memberCount=null,i.joinedMemberCount=null,i.user=new Qi(e,s.data),s.data.member_count&&(i.memberCount=s.data.member_count),s.data.joined_member_count&&(i.joinedMemberCount=s.data.joined_member_count),i}return s(n)}(oe),Fo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.userId;return(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/ban/").concat(encodeURIComponent(o)),a}return s(n)}($),Go=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).user=new Qi(e,s.data),i}return s(n)}(oe),qo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.freezing;return(a=t.call(this)).method=T.PUT,a.path="".concat(kn(i),"/").concat(encodeURIComponent(s),"/freeze"),a.params={freeze:o},a}return s(n)}($),Ho=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).freeze=s.data.freeze,i}return s(n)}(oe),jo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.category,u=e.userId,c=e.description;return(a=t.call(this)).method=T.POST,a.path="".concat(En(i),"/").concat(encodeURIComponent(s)),a.params={report_category:o,reporting_user_id:u,report_description:c},a}return s(n)}($),Vo=function(t){i(a,t);var n=f(a);function a(t){var s;r(this,a);var i=t.channelUrl,o=t.channelType,u=t.category,c=t.userId,l=t.offendingUserId,h=t.description;return(s=n.call(this)).method=T.POST,s.path="".concat(Se,"/users/").concat(l),s.params={channel_url:i,channel_type:o===e.ChannelType.OPEN?"open_channels":"group_channels",report_category:u,reporting_user_id:c,report_description:h},s}return s(a)}($),Qo=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.channelType,o=e.category,u=e.userId,c=e.offendingUserId,l=e.messageId,h=e.description;return(a=t.call(this)).method=T.POST,a.path="".concat(En(i),"/").concat(encodeURIComponent(s),"/messages/").concat(l),a.params={report_category:o,reporting_user_id:u,report_description:h,offending_user_id:c},a}return s(n)}($),Bo=function(t){i(a,t);var n=f(a);function a(t){r(this,a);var s=[];return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"MESG",ackRequired:!0,payload:X({channel_url:t.channelUrl,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:s,mentioned_message_template:t.mentionedMessageTemplate,target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==e.PushNotificationDeliveryOption.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId,poll_id:t.pollId,pin_message:t.isPinnedMessage})})}return s(a)}(he),Ko=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u,c;r(this,n),(i=t.call(this,e,"MESG",s)).message=new _n(e,s);var l=At.of(e).sdkState;return i.isMentioned=bn(i.message.mentionType,null!==(o=i.message.mentionedUserIds)&&void 0!==o?o:null===(u=i.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),l.userId),i.forceUpdateLastMessage=null!==(c=s.force_update_last_message)&&void 0!==c&&c,i}return s(n)}(oe),zo=function(t){i(a,t);var n=f(a);function a(t){var s;r(this,a);var i=null;return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?i=t.mentionedUserIds:t.mentionedUsers&&(i=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"MEDI",ackRequired:!0,payload:X({channel_url:t.channelUrl,msg_id:t.messageId,message:t.message,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:i,mentioned_message_template:t.mentionedMessageTemplate,apple_critical_alert_options:null===(s=t.appleCriticalAlertOptions)||void 0===s?void 0:s.serialize(),poll_id:t.pollId})})}return s(a)}(he),Wo=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u,c,l,h,d;r(this,n),(i=t.call(this,e,"MEDI",s)).message=new _n(e,s);var p=At.of(e).sdkState;return i.mentionCountChange=wn({mentionType:null!==(u=null===(o=s.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==u?u:null,mentionedUserIds:null!==(l=null===(c=s.old_values)||void 0===c?void 0:c.mentioned_user_ids)&&void 0!==l?l:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!==(h=i.message.mentionedUserIds)&&void 0!==h?h:null===(d=i.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))},p.userId),i}return s(n)}(oe),Yo=function(t){i(a,t);var n=f(a);function a(t){r(this,a);var s=null;return t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?s=t.mentionedUserIds:t.mentionedUsers&&(s=t.mentionedUsers.map((function(e){return e.userId})))),n.call(this,{code:"FEDI",ackRequired:!0,payload:X({channel_url:t.channelUrl,msg_id:t.messageId,data:t.data,custom_type:t.customType,metaarray:t.metaArrayParams,mention_type:t.mentionType,mentioned_user_ids:s,apple_critical_alert_options:t.appleCriticalAlertOptions})})}return s(a)}(he),Jo=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u,c,l,h,d;r(this,n),(i=t.call(this,e,"FEDI",s)).message=new yn(e,s);var p=At.of(e).sdkState;return i.mentionCountChange=wn({mentionType:null!==(u=null===(o=s.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==u?u:null,mentionedUserIds:null!==(l=null===(c=s.old_values)||void 0===c?void 0:c.mentioned_user_ids)&&void 0!==l?l:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!==(h=i.message.mentionedUserIds)&&void 0!==h?h:null===(d=i.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))},p.userId),i}return s(n)}(oe),Xo=function(e){i(n,e);var t=f(n);function n(e){var a;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),a}return s(n)}($),Zo=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"DELM",s)).channelUrl=s.channel_url,i.channelType=s.channel_type,i.messageId=Number(s.msg_id),i}return s(n)}(oe),$o=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.messageId,u=e.reactionKey;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/").concat(o,"/reactions"),a.params={reaction:u},a}return s(n)}($),eu=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).reactionEvent=new Wt(a),s}return s(n)}(ee),tu=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.messageId,u=e.reactionKey;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/").concat(o,"/reactions"),a.params={reaction:u},a}return s(n)}($),nu=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).reactionEvent=new Wt(Object.assign({},a)),s}return s(n)}(ee),ru=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.messageId,u=e.translationTargetLanguages;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(o),"/translation"),a.params={target_langs:u},a}return s(n)}($),au=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).message=new _n(e,a),s}return s(n)}(ee),su=function(t){i(a,t);var n=f(a);function a(t){var s,i;r(this,a),s=n.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl;return s.method=T.POST,s.path="".concat(kn(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),s.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Rt.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return Jt.payloadify(e)})),apple_critical_alert_options:$t.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption},s}return s(a)}($),iu=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).message=new _n(e,a),s}return s(n)}(ee),ou=function(t){i(a,t);var n=f(a);function a(t){var s,i;r(this,a),s=n.call(this);var o=[];t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl;return s.method=T.POST,s.path="".concat(kn(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),s.params={req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Rt.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return sn.payloadify(e)})):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return Jt.payloadify(e)})),apple_critical_alert_options:$t.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption},s}return s(a)}($),uu=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).message=new yn(e,a),s}return s(n)}(ee),cu=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l;return r(this,u),(s=a.call(this,t)).url="",s.channelType=e.ChannelType.BASE,s.name="",s.coverUrl="",s.customType="",s.data="",s.isFrozen=!1,s.isEphemeral=!1,s.creator=null,s.createdAt=0,s.url=n.channel_url,s.name=null!==(i=n.name)&&void 0!==i?i:"",s.coverUrl=null!==(o=n.cover_url)&&void 0!==o?o:"",s.customType=null!==(c=n.custom_type)&&void 0!==c?c:"",s.data=null!==(l=n.data)&&void 0!==l?l:"",s.isFrozen=!!U("boolean",n.freeze)&&n.freeze,s.isEphemeral=!!U("boolean",n.is_ephemeral)&&n.is_ephemeral,s.creator=n.created_by?new vt(s._iid,n.created_by):null,s.createdAt=1e3*n.created_at,s._cachedMetaData=new Map,n.metadata&&n.ts&&Object.keys(n.metadata).forEach((function(e){s._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts})})),s}return s(u,[{key:"isGroupChannel",value:function(){return this.channelType===e.ChannelType.GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===e.ChannelType.OPEN}},{key:"cachedMetaData",get:function(){var e={};return this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value)})),e}},{key:"_upsertCachedMetaData",value:function(e,t){var n=this;Object.keys(e).forEach((function(r){var a=n._cachedMetaData.get(r);(!a||a.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t})}))}},{key:"_removeFromCachedMetaData",value:function(e,t){var n=this;e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!1,r.updatedAt=t)}))}},{key:"_generateRequestId",value:function(){return"rq-".concat(K())}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return A(this,e)}},{key:"createOperatorListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new $i(this._iid,this.url,this.channelType,e)}},{key:"createMutedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new no(this._iid,this.url,this.channelType,e)}},{key:"createBannedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new so(this._iid,this.url,this.channelType,e)}},{key:"createPreviousMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new lr(this._iid,this.url,this.channelType,e)}},{key:"addOperators",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new oo({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"removeOperators",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new uo({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getMyMutedInfo",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c,l,h,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new co({channelUrl:this.url,channelType:this.channelType,userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(lo),u=o.isMuted,c=o.startAt,l=o.endAt,h=o.remainingDuration,d=o.description,e.abrupt("return",{isMuted:u,startAt:c,endAt:l,remainingDuration:h,description:d});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMetaData",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new ho({channelUrl:this.url,channelType:this.channelType,keys:e}),t.next=5,a.send(s);case 5:return i=t.sent,o=i.as(po),u=o.metadata,c=o.ts,this._upsertCachedMetaData(u,c),t.abrupt("return",u);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getAllMetaData",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new ho({channelUrl:this.url,channelType:this.channelType,keys:[]}),e.next=4,r.send(a);case 4:return s=e.sent,i=s.as(po),o=i.metadata,u=i.ts,this._upsertCachedMetaData(o,u),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"createMetaData",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=new fo({channelUrl:this.url,channelType:this.channelType,metadata:e}),t.next=4,a.send(s);case 4:return i=t.sent,o=i.as(vo),u=o.metaData,this._upsertCachedMetaData(u,0),t.abrupt("return",u);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"updateMetaData",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=At.of(this._iid),s=a.requestQueue,i=new _o({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:n}),t.next=4,s.send(i);case 4:return o=t.sent,u=o.as(mo),c=u.metadata,l=u.ts,this._upsertCachedMetaData(c,l),t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"deleteMetaData",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new yo({channelUrl:this.url,channelType:this.channelType,key:e}),t.next=5,a.send(s);case 5:i=t.sent,o=i.as(ko),u=o.ts,this._removeFromCachedMetaData([e],u);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"deleteAllMetaData",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Eo({channelUrl:this.url,channelType:this.channelType}),e.next=4,r.send(a);case 4:s=e.sent,i=s.as(bo),o=i.ts,this._removeFromCachedMetaData(g(this._cachedMetaData.keys()),o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMetaCounters",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new wo({channelUrl:this.url,channelType:this.channelType,keys:e}),t.next=5,a.send(s);case 5:return i=t.sent,o=i.as(xo),u=o.metaCounter,t.abrupt("return",u);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getAllMetaCounters",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new wo({channelUrl:this.url,channelType:this.channelType,keys:[]}),e.next=4,r.send(a);case 4:return s=e.sent,i=s.as(xo),o=i.metaCounter,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"createMetaCounters",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=new Co({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),t.next=4,a.send(s);case 4:return i=t.sent,o=i.as(To),u=o.metaCounter,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"updateMetaCounters",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=At.of(this._iid),s=a.requestQueue,i=new Io({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:n}),t.next=4,s.send(i);case 4:return o=t.sent,u=o.as(So),c=u.metaCounter,t.abrupt("return",c);case 7:case"end":return t.stop()}}),r,this)})))}},{key:"increaseMetaCounters",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=new Io({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),t.next=4,a.send(s);case 4:return i=t.sent,o=i.as(So),u=o.metaCounter,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"decreaseMetaCounters",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=new Io({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),t.next=4,a.send(s);case 4:return i=t.sent,o=i.as(So),u=o.metaCounter,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"deleteMetaCounter",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new Mo({channelUrl:this.url,channelType:this.channelType,key:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"deleteAllMetaCounters",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Ao({channelUrl:this.url,channelType:this.channelType}),e.next=4,r.send(a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"muteUser",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.muteUserWithUserId(e.userId,n,r));case 1:case"end":return t.stop()}}),a,this)})))}},{key:"muteUserWithUserId",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)&&U("number",n,!0)&&U("string",r,!0)).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new Uo({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:n,description:r}),t.next=5,i.send(o);case 5:case"end":return t.stop()}}),a,this)})))}},{key:"unmuteUser",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unmuteUserWithUserId(e.userId));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"unmuteUserWithUserId",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new Ro({channelUrl:this.url,channelType:this.channelType,userId:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"banUser",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.banUserWithUserId(e.userId,n,r));case 1:case"end":return t.stop()}}),a,this)})))}},{key:"banUserWithUserId",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)&&U("number",n,!0)&&U("string",r,!0)).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new Lo({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:n,description:r}),t.next=5,i.send(o);case 5:case"end":return t.stop()}}),a,this)})))}},{key:"unbanUser",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unbanUserWithUserId(e.userId));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"unbanUserWithUserId",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new Fo({channelUrl:this.url,channelType:this.channelType,userId:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"freeze",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new qo({channelUrl:this.url,channelType:this.channelType,freezing:!0}),e.next=4,r.send(a);case 4:this.isFrozen=!0;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"unfreeze",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new qo({channelUrl:this.url,channelType:this.channelType,freezing:!1}),e.next=4,r.send(a);case 4:this.isFrozen=!1;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getMessagesByMessageId",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Mn),n),pt(U("number",e)&&An(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getMessagesByMessageId(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"getMessagesByTimestamp",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Mn),n),pt(U("number",e)&&An(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getMessagesByTimestamp(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"getMessageChangeLogsSinceTimestamp",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Un),n),pt(U("number",e)&&On(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getMessageChangelogs(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"getMessageChangeLogsSinceToken",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Un),n),pt(U("string",e)&&On(a)).throw(S.invalidParameters),s=Xn.of(this._iid),t.next=5,s.getMessageChangelogs(this.url,this.channelType,e,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"_createPendingSendableMessagePayload",value:function(t,n,r){var a=At.of(this._iid).sessionManager;return X({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,sorted_metaarray:t.metaArrays?t.metaArrays.map((function(e){return Jt.payloadify(e)})):null,apple_critical_alert_options:t.appleCriticalAlertOptions?$t.payloadify(t.appleCriticalAlertOptions):null,created_at:r,user:rn.payloadify(a.currentUser),req_id:n,request_state:e.SendingStatus.PENDING,mentioned_user_ids:t.mentionedUserIds,mentioned_users:t.mentionedUsers})}},{key:"_createPendingUserMessage",value:function(t,n,r){var a={};if(t.translationTargetLanguages){var s,i=E(t.translationTargetLanguages);try{for(i.s();!(s=i.n()).done;){a[s.value]=""}}catch(e){i.e(e)}finally{i.f()}}var o=X(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.USER,message:t.message,translations:a})),u=new _n(this._iid,o);return u.messageParams=t,u}},{key:"_createPendingScheduledUserMessage",value:function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r}},{key:"_createPendingFileMessage",value:function(t,n,r){var a=X(Object.assign(Object.assign({},this._createPendingSendableMessagePayload(t,n,r)),{type:e.MessageType.FILE,url:t.fileUrl,file:{name:t.fileName,size:t.fileSize,type:t.mimeType,data:t.data},thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),s=new yn(this._iid,a);return s.messageParams=t,s}},{key:"_createPendingScheduledFileMessage",value:function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r}},{key:"_markMessageAsFailed",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.errorCode=n.code,n.code===w.REQUEST_CANCELED?t.sendingStatus=e.SendingStatus.CANCELED:r||(t.sendingStatus=e.SendingStatus.FAILED)}},{key:"sendUserMessage",value:function(e){var t=Object.assign(Object.assign({},ta),e);return pt(ra(t)).throw(S.invalidParameters),this._sendUserMessage(t)}},{key:"_sendUserMessage",value:function(n){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=At.of(this._iid),i=s.dispatcher,o=s.requestQueue,u=a,c=Date.now(),l=new Zn;if(!u){u=this._generateRequestId();var h=At.of(this._iid),d=h.dispatcher;Ge(2).then((function(){var a=r._createPendingUserMessage(n,u,c);d.dispatch(new Ln({messages:[a],source:e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING})),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(null,a));case 1:case"end":return e.stop()}}),e)})))}))}))}var p=new Bo(Object.assign(Object.assign({},n),{channelUrl:this.url,channelType:this.channelType,reqId:u}));return o.send(p).then((function(n){var a=n.as(Ko).message;i.dispatch(new Ln({messages:[a],source:e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS})),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(null,a));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(a){if(I(a))throw a;Ge(2).then((function(){var s=r._createPendingUserMessage(n,u,c),o=At.of(r._iid).cacheContext.localCacheEnabled&&L(a.code);r._markMessageAsFailed(s,a,o),i.dispatch(new Ln({messages:[s],source:s.sendingStatus===e.SendingStatus.PENDING?e.MessageEventSource.REQUEST_RESEND_MESSAGE:e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED})),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l._trigger(a,s));case 1:case"end":return e.stop()}}),e)})))}))}))})),l}},{key:"_autoResendUserMessage",value:function(e){return pt(e instanceof _n).throw(S.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)}},{key:"resendUserMessage",value:function(e){var n;return b(this,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof _n&&!e.scheduledInfo).throw(S.invalidParameters),a=new pe,s=null!==(n=e.messageParams)&&void 0!==n?n:na(e),this._sendUserMessage(s,e.reqId).onFailed((function(e){return a.reject(e)})).onSucceeded((function(e){return a.resolve(e)})),t.abrupt("return",a.promise);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"updateUserMessage",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},zi),n),pt(U("number",e)&&Wi(a)).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new zo(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},a)),t.next=6,i.send(o);case 6:return u=t.sent,c=u.as(Wo),l=c.message,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"copyUserMessage",value:function(n,r){var a,s,i;return b(this,void 0,void 0,t().mark((function o(){var c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(n instanceof u&&r instanceof _n&&r.sendingStatus===e.SendingStatus.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(S.invalidParameters),pt(!r.poll).throw(S.notSupportedError),c=new pe,l=null!==(a=r.messageParams)&&void 0!==a?a:Object.assign(Object.assign({},r),{mentionType:r.mentionType,mentionedUserIds:null!==(s=r.mentionedUserIds)&&void 0!==s?s:null===(i=r.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(r.translations),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}),n._sendUserMessage(l).onSucceeded((function(e){c.resolve(e)})).onFailed((function(e){return c.reject(e)})),t.abrupt("return",c.promise);case 6:case"end":return t.stop()}}),o,this)})))}},{key:"translateUserMessage",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof _n&&e.messageId>0&&D("string",n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new ru({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:n}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(au),c=u.message,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"_createScheduledUserMessage",value:function(e,n){var r=this,a=At.of(this._iid).requestQueue,s=Date.now(),i=this._generateRequestId();Ge(2).then((function(){var a=r._createPendingScheduledUserMessage(e,i,s);je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(null,a));case 1:case"end":return e.stop()}}),e)})))}))}));var o=new su(Object.assign({reqId:i,channelType:this.channelType,channelUrl:this.url},e));a.send(o).then((function(e){var a=e.as(iu).message;je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(null,a));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(a){if(I(a))throw a;Ge(2).then((function(){var o=r._createPendingScheduledUserMessage(e,i,s);r._markMessageAsFailed(o,a),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(a,o));case 1:case"end":return e.stop()}}),e)})))}))}))}))}},{key:"sendFileMessage",value:function(e){var t=Object.assign(Object.assign({},oa),e);return pt(ca(t)).throw(S.invalidParameters),this._sendFileMessage(t)}},{key:"_sendFileMessage",value:function(n){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=At.of(this._iid),i=s.dispatcher,o=Xn.of(this._iid),u=o.fileMessageQueue,c=a,l=Date.now(),h=new Zn;return c||(c=this._generateRequestId(),Ge(2).then((function(){var a=r._createPendingFileMessage(n,c,l);i.dispatch(new Ln({messages:[a],source:e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING})),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h._trigger(null,a));case 1:case"end":return e.stop()}}),e)})))}))}))),u.request(this,c,n).then((function(n){i.dispatch(new Ln({messages:[n],source:e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS})),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h._trigger(null,n));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(a){if(I(a))throw a;Ge(2).then((function(){var s=r._createPendingFileMessage(n,c,l),o=At.of(r._iid).cacheContext.localCacheEnabled&&L(a.code);r._markMessageAsFailed(s,a,o),i.dispatch(new Ln({messages:[s],source:s.sendingStatus===e.SendingStatus.PENDING?e.MessageEventSource.REQUEST_RESEND_MESSAGE:e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED})),je((function(){return b(r,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h._trigger(a,s));case 1:case"end":return e.stop()}}),e)})))}))}))})),h}},{key:"_autoResendFileMessage",value:function(e){pt(e instanceof yn).throw(S.invalidParameters);var t=At.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e)})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e)}))}},{key:"_createScheduledFileMessage",value:function(e,n,r,a){var s=this,i=At.of(this._iid).requestQueue,o=new ou(Object.assign(Object.assign({reqId:r,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));i.send(o).then((function(e){var r=e.as(uu).message;je((function(){return b(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(null,r));case 1:case"end":return e.stop()}}),e)})))}))})).catch((function(i){if(I(i))throw i;Ge(2).then((function(){var o=s._createPendingScheduledFileMessage(e,r,a);s._markMessageAsFailed(o,i),je((function(){return b(s,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._trigger(i,o));case 1:case"end":return e.stop()}}),e)})))}))}))}))}},{key:"sendFileMessages",value:function(e){pt(e.every((function(e){return ca(Object.assign(Object.assign({},oa),e))}))).throw(S.invalidParameters);var t,n=new Zn,r=E(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this.sendFileMessage(a).onPending((function(e){return n._trigger(null,e)})).onFailed((function(e,t){return n._trigger(e,t)})).onSucceeded((function(e){return n._trigger(null,e)}))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"resendFileMessage",value:function(e,n){var r;return b(this,void 0,void 0,t().mark((function a(){var s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=Boolean(e.url)||P(n)||P(null===(r=e.messageParams)||void 0===r?void 0:r.file),pt(e instanceof yn&&s&&!e.scheduledInfo).throw(S.invalidParameters),i=new pe,o=ua(e,n),this._sendFileMessage(o,e.reqId).onFailed((function(e){return i.reject(e)})).onSucceeded((function(e){return i.resolve(e)})),t.abrupt("return",i.promise);case 6:case"end":return t.stop()}}),a,this)})))}},{key:"updateFileMessage",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Yi),n),pt(U("number",e)&&Ji(a)).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new Yo(Object.assign({channelType:this.channelType,channelUrl:this.url,messageId:e},a)),t.next=6,i.send(o);case 6:return u=t.sent,c=u.as(Jo),l=c.message,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"cancelUploadingFileMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=Xn.of(this._iid),r.fileMessageQueue.cancel(this,e),t.abrupt("return",!0);case 4:case"end":return t.stop()}}),n,this)})))}},{key:"copyFileMessage",value:function(n,r){var a,s;return b(this,void 0,void 0,t().mark((function i(){var o,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(n instanceof u&&r instanceof yn&&r.sendingStatus===e.SendingStatus.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(S.invalidParameters),o=new pe,c=Object.assign(Object.assign({},r),{fileUrl:r.url,fileName:r.name,fileSize:r.size,mimeType:r.type,mentionType:r.mentionType,mentionedUserIds:null!==(a=r.mentionedUserIds)&&void 0!==a?a:null===(s=r.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),pushNotificationDeliveryOption:e.PushNotificationDeliveryOption.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:r.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),requireAuth:r.requireAuth,isPinnedMessage:!1}),n._sendFileMessage(c).onSucceeded((function(e){return o.resolve(e)})).onFailed((function(e){return o.reject(e)})),t.abrupt("return",o.promise);case 5:case"end":return t.stop()}}),i,this)})))}},{key:"deleteMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(pt(e instanceof nn).throw(S.invalidParameters),!(e.messageId>0)){t.next=6;break}return r=At.of(this._iid),a=r.requestQueue,s=new Xo({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),t.next=6,a.send(s);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"addReaction",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof nn&&e.messageId>0&&U("string",n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new $o({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:n}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(eu),c=u.reactionEvent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"deleteReaction",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof nn&&e.messageId>0&&U("string",n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new tu({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:n}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(nu),c=u.reactionEvent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"_updateMessageMetaArray",value:function(n,r,a,s){return b(this,void 0,void 0,t().mark((function i(){var o,u,c,l,h,d,p;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=At.of(this._iid),u=o.dispatcher,c=o.requestQueue,l=new zo({channelType:this.channelType,channelUrl:this.url,messageId:n,metaArrayParams:{array:r,mode:a,upsert:s}}),t.next=4,c.send(l);case 4:return h=t.sent,d=h.as(Wo),p=d.message,u.dispatch(new Ln({messages:[p],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",p);case 8:case"end":return t.stop()}}),i,this)})))}},{key:"createMessageMetaArrayKeys",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof nn&&e.messageId>0&&D("string",n)).throw(S.invalidParameters),a=n.map((function(e){return new Jt({key:e})})),t.abrupt("return",this._updateMessageMetaArray(e.messageId,a,"add",!0));case 3:case"end":return t.stop()}}),r,this)})))}},{key:"deleteMessageMetaArrayKeys",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof nn&&e.messageId>0&&D("string",n)).throw(S.invalidParameters),a=n.map((function(e){return new Jt({key:e})})),t.abrupt("return",this._updateMessageMetaArray(e.messageId,a,"remove",!0));case 3:case"end":return t.stop()}}),r,this)})))}},{key:"addMessageMetaArrayValues",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof nn&&e.messageId>0&&n.every((function(e){return e instanceof Jt}))).throw(S.invalidParameters),t.abrupt("return",this._updateMessageMetaArray(e.messageId,n,"add",!0));case 2:case"end":return t.stop()}}),r,this)})))}},{key:"removeMessageMetaArrayValues",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof nn&&e.messageId>0&&n.every((function(e){return e instanceof Jt}))).throw(S.invalidParameters),t.abrupt("return",this._updateMessageMetaArray(e.messageId,n,"remove",!0));case 2:case"end":return t.stop()}}),r,this)})))}},{key:"report",value:function(n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(O(e.ReportCategory,n)&&U("string",r)).throw(S.invalidParameters),s=At.of(this._iid),i=s.sdkState,o=s.requestQueue,u=new jo({channelUrl:this.url,channelType:this.channelType,userId:i.userId,category:n,description:r}),t.next=5,o.send(u);case 5:case"end":return t.stop()}}),a,this)})))}},{key:"reportUser",value:function(n,r,a){return b(this,void 0,void 0,t().mark((function s(){var i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(n instanceof vt&&O(e.ReportCategory,r)&&U("string",a)).throw(S.invalidParameters),i=At.of(this._iid),o=i.sdkState,u=i.requestQueue,c=new Vo({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:n.userId,category:r,description:a}),t.next=5,u.send(c);case 5:case"end":return t.stop()}}),s,this)})))}},{key:"reportMessage",value:function(n,r,a){return b(this,void 0,void 0,t().mark((function s(){var i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(n instanceof an&&O(e.ReportCategory,r)&&U("string",a)).throw(S.invalidParameters),i=At.of(this._iid),o=i.sdkState,u=i.requestQueue,c=new Qo({channelUrl:this.url,channelType:this.channelType,userId:o.userId,offendingUserId:n.sender.userId,messageId:n.messageId,category:r,description:a}),t.next=5,u.send(c);case 5:case"end":return t.stop()}}),s,this)})))}}],[{key:"payloadify",value:function(e){return X(Object.assign(Object.assign({},_(o(u),"payloadify",this).call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:vt.payloadify(e.creator),created_at:e.createdAt/1e3}))}}]),u}(at),lu=function(e){i(n,e);var t=f(n);function n(e,a){var s,i;return r(this,n),(s=t.call(this,e,a)).isMuted=!1,s.isMuted=null!==(i=a.is_muted)&&void 0!==i&&i,s}return s(n)}(vt),hu=null,du=function(){function n(e,a,s){var i=this;r(this,n),this._fcmPushToken=null,this._apnsPushToken=null,this._iid=e,this.options=a;var o=At.of(e),u=o.sdkState,c=o.cacheContext,l=o.dispatcher,h=o.sessionManager,d=o.requestQueue,p=o.logger,f=o.userEventHandlers,v=o.appStateToggleEnabled;this._onlineDetector=new Sa({logger:p,connectionDelegate:{reconnect:function(){var t=At.of(e),n=t.sdkState,r=t.connectionManager,a=t.sessionManager;a.auth.hasSession?"foreground"===n.appState&&r.resetAndReconnect():r.connect(a.auth.authToken)},disconnect:function(){At.of(e).connectionManager.disconnect()}}});var _=new Aa(e,{localCacheEnabled:c.localCacheEnabled,dispatcher:l,sdkState:u,logger:p});s.forEach((function(t){t.init(e,{sdkState:u,cacheContext:c,dispatcher:l,sessionManager:h,requestQueue:d,logger:p,onlineDetector:i._onlineDetector}),i[t.name]=t})),this._appStateChangeDetector=new Ia(v),this._appStateChangeDetector.on("resume",(function(){p.debug("the page resumes from freeze"),i.setForegroundState()})).on("pause",(function(){p.debug("the page freezes"),i.setBackgroundState()})),l.on((function(n){if(n instanceof _e){if(n.stateType===ce.CONNECTED)_.processNonAutoResendRegisteredPendingMessages()}else if(n instanceof oe){if("USEV"===n.code){var r=n.as(Da).event;if(r.category===_a.FRIEND_DISCOVERED){var a=Oa.getDataAsFriendDiscoveredEvent(e,r).friendDiscoveries;je((function(){return b(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.forEach((function(e){e.onFriendsDiscovered(a)})));case 1:case"end":return e.stop()}}),e)})))}))}}}else if(n instanceof de){var s=At.of(i._iid).subscribedUnreadMessageCount,o=!1,l=n.ts;if("number"==typeof l&&l>s.ts){if(s.all!==n.all&&(o=!0),s.all=n.all>=0?n.all:0,n.customTypes)for(var h in n.customTypes)s.customTypes[h]!==n.customTypes[h]&&(o=!0),s.customTypes[h]=n.customTypes[h];o=o&&s.ts>0,s.ts=l}o&&je((function(){return b(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.forEach((function(e){e.onTotalUnreadMessageCountUpdated(s.all,s.customTypes)})));case 1:case"end":return e.stop()}}),e)})))}))}else n instanceof _t&&c.localCacheEnabled&&c.preference.set(i._getUserProfileCacheKey(u.userId),mt.payloadify(n.userProfile))}))}return s(n,[{key:"appId",get:function(){return At.of(this._iid).sdkState.appId}},{key:"appInfo",get:function(){return At.of(this._iid).appInfo}},{key:"appVersion",get:function(){var e;return null!==(e=At.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""}},{key:"debugMode",get:function(){return At.of(this._iid).debugMode}},{key:"logLevel",get:function(){return At.of(this._iid).logger.level},set:function(e){At.of(this._iid).logger.level=e}},{key:"isCacheEnabled",get:function(){return At.of(this._iid).cacheContext.localCacheEnabled}},{key:"ekey",get:function(){return At.of(this._iid).sessionManager.ekey}},{key:"currentUser",get:function(){var e;return null!==(e=At.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null}},{key:"connectionState",get:function(){var t=At.of(this._iid).connectionManager;return t.isConnected?e.ConnectionState.OPEN:t.isConnecting?e.ConnectionState.CONNECTING:e.ConnectionState.CLOSED}},{key:"lastConnectedAt",get:function(){var e=At.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0}},{key:"fcmPushToken",get:function(){return this._fcmPushToken}},{key:"apnsPushToken",get:function(){return this._apnsPushToken}},{key:"_getPreferenceCacheKey",value:function(e){return"sendbird@".concat(this.appId,"/").concat(e,".pref")}},{key:"_getUserProfileCacheKey",value:function(e){return"sendbird@".concat(this.appId,"/").concat(e,".profile")}},{key:"getMemoryStoreForDebugging",value:function(){var e=At.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof Ai?n.store:null;throw S.debugModeRequired}},{key:"addExtension",value:function(e,t){var n=At.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&(n.extensions[e]=t)}},{key:"setOnlineListener",value:function(e){this._onlineDetector.setOnlineListener(e)}},{key:"setOfflineListener",value:function(e){this._onlineDetector.setOfflineListener(e)}},{key:"initializeCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=At.of(this._iid),a=r.sdkState,s=r.cacheContext,i=r.connectionManager,o=r.dispatcher,a.userId&&a.userId===e){t.next=23;break}return t.next=4,i.logout();case 4:if(a.userId=e,u="sendbird@".concat(a.appId,"/").concat(e,".db"),!s.localCacheEnabled){t.next=15;break}if(s.nestdb&&s.nestdb.state!==mi.CLOSED&&s.nestdb.name===u){t.next=13;break}return(c=s.nestdb=new Hi({name:"sendbird@".concat(a.appId,"/").concat(e,".db"),version:2,store:s.store})).on("upgrade",xa(c,s.store)),t.next=12,c.open();case 12:o.dispatch(new Ra(this._iid,{userId:e}));case 13:t.next=17;break;case 15:return t.next=17,s.store.init(u);case 17:return t.next=19,s.preference.init(this._getPreferenceCacheKey(e));case 19:return t.next=21,s.preference.get(this._getUserProfileCacheKey(e));case 21:(l=t.sent)&&new mt(this._iid,l).apply();case 23:case"end":return t.stop()}}),n,this)})))}},{key:"clearCachedData",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=At.of(this._iid),!(r=n.cacheContext).localCacheEnabled){e.next=5;break}if(!r.nestdb){e.next=5;break}return e.next=5,r.nestdb.clear();case 5:return e.next=7,r.preference.clear();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"clearCachedMessages",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(pt(D("string",e)).throw(S.invalidParameters),r=Ta.of(this._iid),a=wa.of(this._iid),!r||!a){n.next=6;break}return n.next=6,Promise.all(e.map((function(e){return b(s,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.removeMessagesOfChannel(e);case 2:return t.next=4,a.removeMessagesOfChannel(e);case 4:case"end":return t.stop()}}),n)})))})));case 6:case"end":return n.stop()}}),n,this)})))}},{key:"connect",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)&&U("string",n,!0)).throw(S.invalidParameters),a=At.of(this._iid),s=a.sdkState,i=a.cacheContext,o=a.connectionManager,u=a.statLogCollector,t.prev=2,t.next=5,this.initializeCache(e);case 5:t.next=12;break;case 7:t.prev=7,t.t0=t.catch(2),c=At.of(this._iid),l=c.logger,i.localCacheEnabled=!1,l.warn("Cache initialization failed - cache is not available.");case 12:return t.next=14,u.init("sendbird@".concat(s.appId,"/").concat(e,".statlog"));case 14:return this._onlineDetector.start(),this._appStateChangeDetector.start(),t.next=18,o.connect(n);case 18:return t.abrupt("return",this.currentUser);case 19:case"end":return t.stop()}}),r,this,[[2,7]])})))}},{key:"reconnect",value:function(){var e=At.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),t.resetAndReconnect().then((function(){n.appState="foreground"})).catch((function(){}))),r}},{key:"disconnect",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.connectionManager,a=n.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),a.cancelAll(),e.next=6,r.logout();case 6:return e.next=8,this.clearCachedData();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"disconnectWebSocket",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.connectionManager,a=n.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),a.cancelAll(),e.next=6,r.disconnectWebSocket();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setBackgroundState",value:function(){var e=At.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background())}},{key:"setForegroundState",value:function(){var e=At.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect())}},{key:"setSessionHandler",value:function(e){pt(e instanceof Hr).throw(S.invalidParameters),At.of(this._iid).sessionManager.handler=e}},{key:"addUserEventHandler",value:function(e,t){pt(U("string",e)&&t instanceof Vr).throw(S.invalidParameters),At.of(this._iid).userEventHandlers.set(e,t)}},{key:"removeUserEventHandler",value:function(e){At.of(this._iid).userEventHandlers.delete(e)}},{key:"removeAllUserEventHandler",value:function(){At.of(this._iid).userEventHandlers.clear()}},{key:"addConnectionHandler",value:function(e,t){pt(U("string",e)&&t instanceof jr).throw(S.invalidParameters),At.of(this._iid).connectionHandlers.set(e,t)}},{key:"removeConnectionHandler",value:function(e){At.of(this._iid).connectionHandlers.delete(e)}},{key:"removeAllConnectionHandler",value:function(){At.of(this._iid).connectionHandlers.clear()}},{key:"createApplicationUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ls(this._iid,e)}},{key:"createBlockedUserListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Gs(this._iid,e)}},{key:"createFriendListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new js(this._iid,e)}},{key:"createMessageSearchQuery",value:function(e){return new ur(this._iid,e)}},{key:"createPollListQuery",value:function(e){return new Rr(this._iid,Object.assign({},e))}},{key:"createPollVoterListQuery",value:function(e){return new Pr(this._iid,Object.assign({},e))}},{key:"buildUserFromSerializedData",value:function(e){var t=dt(e);return new vt(this._iid,vt.payloadify(t))}},{key:"updateCurrentUserInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object.assign(Object.assign({},Gr),e),pt(qr(r)).throw(S.invalidParameters),!this.currentUser){t.next=13;break}return a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new La(Object.assign({userId:s.userId},r)),t.next=7,i.send(o);case 7:return u=t.sent,c=u.as(Pa),l=c.user,this.currentUser&&(r.nickname&&(this.currentUser.nickname=l.nickname),(r.profileUrl||r.profileImage)&&(this.currentUser.plainProfileUrl=l.profileUrl)),t.abrupt("return",l);case 13:throw S.connectionRequired;case 14:case"end":return t.stop()}}),n,this)})))}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(pt(D("string",e)).throw(S.invalidParameters),!this.currentUser){t.next=12;break}return r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new La({userId:a.userId,preferredLanguages:e}),t.next=6,s.send(i);case 6:return o=t.sent,u=o.as(Pa),c=u.user,this.currentUser&&(this.currentUser.preferredLanguages=c.preferredLanguages),t.abrupt("return",c);case 12:throw S.connectionRequired;case 13:case"end":return t.stop()}}),n,this)})))}},{key:"registerFCMPushTokenForCurrentUser",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(pt(U("string",n)).throw(S.invalidParameters),!this.currentUser){r.next=20;break}if(r.prev=2,a=At.of(this._iid),s=a.sessionManager,i=a.sdkState,o=a.requestQueue,!s.hasDeviceToken(e.PushTokenType.FCM,n)){r.next=6;break}return r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 6:return u=new Ga({userId:i.userId,token:n}),r.next=9,o.send(u);case 9:return r.next=11,Ve((function(){return b(c,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.setDeviceToken(e.PushTokenType.FCM,n),t.next=3,s.saveDeviceToken();case 3:case"end":return t.stop()}}),r)})))}));case 11:return this._fcmPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._fcmPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterFCMPushTokenForCurrentUser",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(pt(U("string",n)).throw(S.invalidParameters),!this.currentUser){r.next=20;break}return r.prev=2,a=At.of(this._iid),s=a.sessionManager,i=a.sdkState,o=a.requestQueue,u=new Ha({userId:i.userId,token:n}),r.next=7,o.send(u);case 7:return c=r.sent,l=c.lastDeletedAt,r.next=11,Ve((function(){return b(h,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.unsetDeviceToken(e.PushTokenType.FCM,n),s.setDeviceTokenDeletedAt(l),t.next=4,s.saveDeviceToken();case 4:case"end":return t.stop()}}),r)})))}));case 11:return this._fcmPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._fcmPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterFCMPushTokenAllForCurrentUser",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.currentUser){n.next=9;break}return r=At.of(this._iid),a=r.sessionManager,s=r.sdkState,i=r.requestQueue,o=new Va({userId:s.userId}),n.next=5,i.send(o);case 5:return u=n.sent,c=u.lastDeletedAt,n.next=9,Ve((function(){return b(l,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.unsetDeviceTokens(e.PushTokenType.FCM),a.setDeviceTokenDeletedAt(c),t.next=4,a.saveDeviceToken();case 4:case"end":return t.stop()}}),n)})))}));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"registerAPNSPushTokenForCurrentUser",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(pt(U("string",n)).throw(S.invalidParameters),!this.currentUser){r.next=20;break}if(r.prev=2,a=At.of(this._iid),s=a.sessionManager,i=a.sdkState,o=a.requestQueue,!s.hasDeviceToken(e.PushTokenType.APNS,n)){r.next=6;break}return r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 6:return u=new Fa({userId:i.userId,token:n}),r.next=9,o.send(u);case 9:return r.next=11,Ve((function(){return b(c,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.setDeviceToken(e.PushTokenType.APNS,n),t.next=3,s.saveDeviceToken();case 3:case"end":return t.stop()}}),r)})))}));case 11:return this._apnsPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._apnsPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(pt(U("string",n)).throw(S.invalidParameters),!this.currentUser){r.next=20;break}return r.prev=2,a=At.of(this._iid),s=a.sessionManager,i=a.sdkState,o=a.requestQueue,u=new qa({userId:i.userId,token:n}),r.next=7,o.send(u);case 7:return c=r.sent,l=c.lastDeletedAt,r.next=11,Ve((function(){return b(h,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.unsetDeviceToken(e.PushTokenType.APNS,n),s.setDeviceTokenDeletedAt(l),t.next=4,s.saveDeviceToken();case 4:case"end":return t.stop()}}),r)})))}));case 11:return this._apnsPushToken="",r.abrupt("return",e.PushTokenRegistrationState.SUCCESS);case 15:return r.prev=15,r.t0=r.catch(2),r.abrupt("return",e.PushTokenRegistrationState.ERROR);case 18:r.next=22;break;case 20:return this._apnsPushToken=n,r.abrupt("return",e.PushTokenRegistrationState.PENDING);case 22:case"end":return r.stop()}}),r,this,[[2,15]])})))}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.currentUser){n.next=9;break}return r=At.of(this._iid),a=r.sessionManager,s=r.sdkState,i=r.requestQueue,o=new ja({userId:s.userId}),n.next=5,i.send(o);case 5:return u=n.sent,c=u.lastDeletedAt,n.next=9,Ve((function(){return b(l,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.unsetDeviceTokens(e.PushTokenType.APNS),a.setDeviceTokenDeletedAt(c),t.next=4,a.saveDeviceToken();case 4:case"end":return t.stop()}}),n)})))}));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"getChannelInvitationPreference",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new Ka({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(za),u=o.autoAccept,e.abrupt("return",{autoAccept:u});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setChannelInvitationPreference",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("boolean",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new Wa({userId:a.userId,willAutoAccept:e}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(Ya),c=u.autoAccept,t.abrupt("return",{autoAccept:c});case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getDoNotDisturb",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new Ja({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(Xa),u=o.preference,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setDoNotDisturb",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return b(this,void 0,void 0,t().mark((function o(){var u,c,l,h,d,p,f;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("boolean",e)&&U("number",n)&&U("number",r)&&U("number",a)&&U("number",s)&&U("string",i)).throw(S.invalidParameters),u=At.of(this._iid),c=u.sdkState,l=u.requestQueue,h=new Za({userId:c.userId,doNotDisturbOn:e,startHour:n,startMin:r,endHour:a,endMin:s,timezone:i}),t.next=5,l.send(h);case 5:return d=t.sent,p=d.as($a),f=p.preference,t.abrupt("return",f);case 8:case"end":return t.stop()}}),o,this)})))}},{key:"getSnoozePeriod",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new es({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(ts),u=o.snoozePeriod,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setSnoozePeriod",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("boolean",e)&&U("number",n)&&U("number",r)).throw(S.invalidParameters),s=At.of(this._iid),i=s.sdkState,o=s.requestQueue,u=new ns({userId:i.userId,snoozeOn:e,startTs:n,endTs:r}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(rs),h=l.snoozePeriod,t.abrupt("return",h);case 8:case"end":return t.stop()}}),a,this)})))}},{key:"getMyPushTokensByToken",value:function(n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u,c,l,h,d,p,f,v;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",n)&&O(e.PushTokenType,r)).throw(S.invalidParameters),s=At.of(this._iid),i=s.sdkState,o=s.requestQueue,u=s.sessionManager,c=new Qa({userId:i.userId,type:r,token:n}),t.next=5,o.send(c);case 5:l=t.sent,h=l.as(Ba),d=h.pushTokens,p=E(d.deviceTokens);try{for(p.s();!(f=p.n()).done;)v=f.value,u.setDeviceToken(d.type,v)}catch(e){p.e(e)}finally{p.f()}return t.next=11,u.saveDeviceToken();case 11:return t.abrupt("return",d);case 12:case"end":return t.stop()}}),a,this)})))}},{key:"getPushTriggerOption",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new is({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,e.abrupt("return",i.as(os).pushTriggerOption);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setPushTriggerOption",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(O(e.PushTriggerOption,n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new us({userId:s.userId,pushTriggerOption:n}),t.next=5,i.send(o);case 5:return u=t.sent,t.abrupt("return",u.as(cs).pushTriggerOption);case 7:case"end":return t.stop()}}),r,this)})))}},{key:"getPushTemplate",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new ls({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,e.abrupt("return",i.as(hs).name);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"setPushTemplate",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(O(e.PushTemplate,n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new ds({userId:s.userId,templateName:n}),t.next=5,i.send(o);case 5:return u=t.sent,t.abrupt("return",u.as(ps).name);case 7:case"end":return t.stop()}}),r,this)})))}},{key:"blockUser",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof vt||U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new as({userId:a.userId,blockedUserId:e instanceof vt?e.userId:e}),t.next=5,s.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"blockUserWithUserId",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.blockUser(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"unblockUser",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e instanceof vt||U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new ss({userId:a.userId,unblockedUserId:e instanceof vt?e.userId:e}),t.next=5,s.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"unblockUserWithUserId",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.unblockUser(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"getFriendChangeLogsByToken",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new fs({userId:a.userId,token:e}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(vs),c=u.changelogs,t.abrupt("return",c);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getAllowFriendDiscovery",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new bs({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(ws),u=o.allowFriendDiscovery,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"setAllowFriendDiscovery",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("boolean",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new xs({userId:a.userId,allowFriendDiscovery:e}),t.next=5,s.send(i);case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"uploadFriendDiscoveries",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new _s({userId:a.userId,discoveries:e}),t.next=4,s.send(i);case 4:return o=t.sent,u=o.as(ms),c=u.friendDiscoveryRequestId,t.abrupt("return",c);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriendDiscovery",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deleteFriendDiscoveries([e]));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriendDiscoveries",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new gs({userId:a.userId,discoveryKeys:e}),t.next=5,s.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"addFriends",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new ys({userId:a.userId,userIds:e}),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(ks),c=u.users,t.abrupt("return",c);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriend",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.deleteFriends([e]));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"deleteFriends",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",e)).throw(S.invalidParameters),r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new Es({userId:a.userId,userIds:e}),t.next=5,s.send(i);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getAllEmoji",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Ss,e.next=4,r.send(a);case 4:return s=e.sent,i=s.as(Ns),o=i.emojiContainer,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getEmojiCategory",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=new Ms({categoryId:e}),t.next=4,a.send(s);case 4:return i=t.sent,o=i.as(As),u=o.emojiCategory,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"getEmoji",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=new Us({key:e}),t.next=4,a.send(s);case 4:return i=t.sent,o=i.as(Os),u=o.emoji,t.abrupt("return",u);case 7:case"end":return t.stop()}}),n,this)})))}}],[{key:"init",value:function(e){var t=e.appId,r=e.appVersion,a=void 0===r?null:r,s=e.modules,i=void 0===s?[]:s,o=e.options,u=void 0===o?new H:o,c=e.debugMode,l=void 0!==c&&c,h=e.customApiHost,d=e.customWebSocketHost,p=e.newInstance,f=void 0!==p&&p,v=e.logLevel,_=e.localCacheEnabled,m=void 0!==_&&_,y=e.localCacheEncryption,k=e.useAsyncStorageStore,E=void 0===k?null:k,b=e.appStateToggleEnabled,w=void 0===b||b;if(!hu||f){var x="su-".concat(K()),C=null!=y?y:{encrypt:function(e){return e},decrypt:function(e){return e}},T=new Ai({encryption:C});l||(T=E?new Di({AsyncStorage:E,encryption:C}):new Ri({encryption:C})),new At(x,{appId:t,appVersion:a,options:u,apiHost:null!=h?h:"https://api-".concat(t,".sendbird.com"),websocketHost:null!=d?d:"wss://ws-".concat(t,".sendbird.com"),store:T,encryption:C,logLevel:v,localCacheEnabled:m,debugMode:l,appStateToggleEnabled:w});var I=[new pr,new Fr],S=new n(x,u,[].concat(g(i),I));return hu||(hu=S),S}return hu}},{key:"instance",get:function(){return hu}},{key:"version",get:function(){return x}}]),n}();e.MemberState=void 0,(io=e.MemberState||(e.MemberState={})).NONE="none",io.JOINED="joined",io.INVITED="invited",io.LEFT="left";var pu,fu,vu,_u,mu,gu,yu,ku,Eu=function(t){i(a,t);var n=f(a);function a(t,s){var i;return r(this,a),(i=n.call(this,t,s)).state=null,i.role=null,i.isMuted=!1,i.isBlockedByMe=!1,i.isBlockingMe=!1,i.state=O(e.MemberState,s.state)?s.state:null,i.role=O(e.Role,s.role)?s.role:null,s.hasOwnProperty("is_muted")&&(i.isMuted=s.is_muted),s.hasOwnProperty("is_blocked_by_me")&&(i.isBlockedByMe=s.is_blocked_by_me),s.hasOwnProperty("is_blocking_me")&&(i.isBlockingMe=s.is_blocking_me),i}return s(a,null,[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(a),"payloadify",this).call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})):null}}]),a}(Qi),bu=function(t){i(a,t);var n=f(a);function a(t,s){var i,o,u;return r(this,a),(i=n.call(this,t)).channelUrl=null!==(o=s.channel_url)&&void 0!==o?o:"",i.channelType=null!==(u=s.channel_type)&&void 0!==u?u:e.ChannelType.GROUP,i.reader=new vt(i._iid,s.user),i.readAt=s.ts,i}return s(a)}(at);e.PublicChannelFilter=void 0,(pu=e.PublicChannelFilter||(e.PublicChannelFilter={})).ALL="all",pu.PUBLIC="public",pu.PRIVATE="private",e.MyMemberStateFilter=void 0,(fu=e.MyMemberStateFilter||(e.MyMemberStateFilter={})).ALL="all",fu.JOINED="joined_only",fu.INVITED="invited_only",fu.INVITED_BY_FRIEND="invited_by_friend",fu.INVITED_BY_NON_FRIEND="invited_by_non_friend",e.SuperChannelFilter=void 0,(vu=e.SuperChannelFilter||(e.SuperChannelFilter={})).ALL="all",vu.SUPER="super",vu.NON_SUPER="nonsuper",vu.BROADCAST_ONLY="broadcast_only",vu.EXCLUSIVE_ONLY="exclusive_only",e.UnreadChannelFilter=void 0,(_u=e.UnreadChannelFilter||(e.UnreadChannelFilter={})).ALL="all",_u.UNREAD_MESSAGE="unread_message",e.HiddenChannelFilter=void 0,(mu=e.HiddenChannelFilter||(e.HiddenChannelFilter={})).ALL="all",mu.UNHIDDEN="unhidden_only",mu.HIDDEN="hidden_only",mu.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",mu.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide",e.OperatorFilter=void 0,(gu=e.OperatorFilter||(e.OperatorFilter={})).ALL="all",gu.OPERATOR="operator",gu.NONOPERATOR="nonoperator",e.QueryType=void 0,(yu=e.QueryType||(e.QueryType={})).AND="AND",yu.OR="OR",e.GroupChannelSearchField=void 0,(ku=e.GroupChannelSearchField||(e.GroupChannelSearchField={})).MEMBER_NICKNAME="member_nickname",ku.CHANNEL_NAME="channel_name";var wu,xu=function(){function t(){r(this,t),this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=e.MyMemberStateFilter.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=e.SuperChannelFilter.ALL,this.publicChannelFilter=e.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=e.UnreadChannelFilter.ALL,this.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return s(t,[{key:"_isFriend",value:function(e){return!!e.friendDiscoveryKey||!!e.friendName}},{key:"searchFilter",get:function(){return this._searchFilter}},{key:"setSearchFilter",value:function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})}},{key:"userIdsFilter",get:function(){return this._userIdsFilter}},{key:"setUserIdsFilter",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.QueryType.AND;this._userIdsFilter={userIds:t,includeMode:n,queryType:r}}},{key:"clone",value:function(){var e=new t;this.searchFilter&&e.setSearchFilter(this.searchFilter.fields,this.searchFilter.query),this.userIdsFilter&&e.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(t){e[t]=n[t]})),e}},{key:"match",value:function(t,n){if(this._searchFilter){var r=this._searchFilter,a=r.query,s=r.fields;if(a&&s&&s.length>0&&!s.some((function(n){switch(n){case e.GroupChannelSearchField.CHANNEL_NAME:return t.name.toLowerCase().includes(a.toLowerCase());case e.GroupChannelSearchField.MEMBER_NICKNAME:return t.members.some((function(e){return e.nickname.toLowerCase().includes(a.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var i=this._userIdsFilter,o=i.userIds,u=i.includeMode,c=i.queryType,l=t.members.map((function(e){return e.userId}));if(u){if(o.length>0)switch(c){case e.QueryType.AND:if(o.some((function(e){return!l.includes(e)})))return!1;break;case e.QueryType.OR:if(o.every((function(e){return!l.includes(e)})))return!1}}else{if(o.includes(n)||o.push(n),t.members.length>o.length)return!1;if(!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=g(e).sort(),r=g(t).sort(),a=0;a<n.length;++a)if(n[a]!==r[a])return!1;return!0}(o,l))return!1}}if(!this.includeEmpty&&!t.lastMessage)return!1;if(!this.includeFrozen&&t.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(t.customType))return!1;if(this.channelNameContainsFilter&&!t.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var h=this.nicknameContainsFilter.toLowerCase();if(t.members.every((function(e){return!e.nickname.toLowerCase().includes(h)})))return!1}if(this.nicknameStartsWithFilter){var d=this.nicknameStartsWithFilter.toLowerCase();if(t.members.every((function(e){return!e.nickname.toLowerCase().startsWith(d)})))return!1}if(this.nicknameExactMatchFilter){var p=this.nicknameExactMatchFilter.toLowerCase();if(t.members.every((function(e){return e.nickname.toLowerCase()!=p})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(t.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case e.MyMemberStateFilter.JOINED:if("joined"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED:if("invited"!==t.myMemberState)return!1;break;case e.MyMemberStateFilter.INVITED_BY_FRIEND:if("invited"!==t.myMemberState||!this._isFriend(t.inviter))return!1;break;case e.MyMemberStateFilter.INVITED_BY_NON_FRIEND:if("invited"!==t.myMemberState||this._isFriend(t.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case e.HiddenChannelFilter.UNHIDDEN:if(t.isHidden||"unhidden"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN:if(!t.isHidden)return!1;break;case e.HiddenChannelFilter.HIDDEN_ALLOW_AUTO_UNHIDE:if(!t.isHidden||"hidden_allow_auto_unhide"!==t.hiddenState)return!1;break;case e.HiddenChannelFilter.HIDDEN_PREVENT_AUTO_UNHIDE:if(!t.isHidden||"hidden_prevent_auto_unhide"!==t.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===e.UnreadChannelFilter.UNREAD_MESSAGE)if(0===t.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case e.PublicChannelFilter.PUBLIC:if(!t.isPublic)return!1;break;case e.PublicChannelFilter.PRIVATE:if(t.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case e.SuperChannelFilter.SUPER:if(!t.isSuper)return!1;break;case e.SuperChannelFilter.NON_SUPER:if(t.isSuper)return!1}return!0}}]),t}(),Cu=function(n){i(o,n);var a=f(o);function o(e,t){var n,s=t.sdkState,i=t.cacheContext;return r(this,o),(n=a.call(this,e))._channels=new Map,n._sdkState=s,n._cacheContext=i,n}return s(o,[{key:"collection",get:function(){var e=this._cacheContext.nestdb;return e?e.collection(Qr):null}},{key:"localCacheEnabled",get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection}},{key:"_serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object.assign(Object.assign({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})}},{key:"_deserialize",value:function(e){return Wc.of(this._iid).buildGroupChannelFromSerializedData(e)}},{key:"channels",get:function(){return g(this._channels.values())}},{key:"isCachedInMemory",value:function(e){return this._channels.has(e)}},{key:"filterOffsetChanged",value:function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))}},{key:"get",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._channels.has(e)){t.next=12;break}if(!this.localCacheEnabled){t.next=9;break}return t.next=4,this.collection.getByKey(e);case 4:if(!(r=t.sent)){t.next=9;break}return a=this._deserialize(r),this._channels.set(e,a),t.abrupt("return",a);case 9:return t.abrupt("return",null);case 12:return t.abrupt("return",this._channels.get(e));case 13:case"end":return t.stop()}}),n,this)})))}},{key:"fetch",value:function(n){var r=n.token,a=n.limit,s=void 0===a?100:a,i=n.backward,o=void 0!==i&&i,u=n.filter,c=void 0===u?new xu:u,l=n.order,h=void 0===l?e.GroupChannelListOrder.LATEST_LAST_MESSAGE:l;return b(this,void 0,void 0,t().mark((function n(){var a,i,u,l,d,p=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.localCacheEnabled){t.next=12;break}return a=Wr(h),i={where:function(t){if(r)switch(h){case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:if(!o&&t.name.localeCompare(r)<0||o&&t.name.localeCompare(r)>0)return!1;break;case e.GroupChannelListOrder.CHRONOLOGICAL:if(!o&&t.createdAt>r||o&&t.createdAt<r)return!1;break;case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:if(!o&&t.lastMessageUpdatedAt>r||o&&t.lastMessageUpdatedAt<r)return!1}return c.match(p._deserialize(t),p._sdkState.userId)},index:a,backward:o},t.next=5,this.collection.query(i);case 5:return u=t.sent,t.next=8,u.fetch({limit:s});case 8:return l=t.sent,(d=l.map((function(e){return p._deserialize(e)}))).forEach((function(e){p._channels.has(e.url)||p._channels.set(e.url,e)})),t.abrupt("return",d);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),n,this)})))}},{key:"upsert",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.forEach((function(e){if(s._channels.has(e.url)){var t=s._channels.get(e.url);e._pinnedMessagesUpdatedAt<t._pinnedMessagesUpdatedAt&&(e._pinnedMessagesUpdatedAt=t._pinnedMessagesUpdatedAt),Object.assign(t,e,{_iid:s._iid})}else s._channels.set(e.url,e)})),!this.localCacheEnabled){t.next=6;break}for(a in r=[],e)r.push(this._serialize(e[a],parseInt(a)));return t.next=6,this.collection.upsertMany(r);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=E(e),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=11;break}if(s=a.value,this._channels.delete(s),!this.localCacheEnabled){t.next=9;break}return t.next=9,this.collection.remove(s);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:case"end":return t.stop()}}),n,this,[[1,13,16,19]])})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clearMemoryCache(),!this.localCacheEnabled){e.next=4;break}return e.next=4,this.collection.clear();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearMemoryCache",value:function(){this._channels.clear()}},{key:"_setBlockStateOfAllChannels",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u,c,l,h,d,p,f,v,_,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=[],e!==this._sdkState.userId){t.next=38;break}i=E(this._channels.values()),t.prev=3,i.s();case 5:if((o=i.n()).done){t.next=28;break}u=o.value,c=E(u.members),t.prev=8,c.s();case 10:if((l=c.n()).done){t.next=18;break}if((h=l.value).userId!==n){t.next=16;break}return h.isBlockedByMe=r,s.push(u),t.abrupt("break",18);case 16:t.next=10;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(8),c.e(t.t0);case 23:return t.prev=23,c.f(),t.finish(23);case 26:t.next=5;break;case 28:t.next=33;break;case 30:t.prev=30,t.t1=t.catch(3),i.e(t.t1);case 33:return t.prev=33,i.f(),t.finish(33);case 36:t.next=73;break;case 38:if(n!==this._sdkState.userId){t.next=73;break}d=E(this._channels.values()),t.prev=40,d.s();case 42:if((p=d.n()).done){t.next=65;break}f=p.value,v=E(f.members),t.prev=45,v.s();case 47:if((_=v.n()).done){t.next=55;break}if((m=_.value).userId!==e){t.next=53;break}return m.isBlockingMe=r,s.push(f),t.abrupt("break",55);case 53:t.next=47;break;case 55:t.next=60;break;case 57:t.prev=57,t.t2=t.catch(45),v.e(t.t2);case 60:return t.prev=60,v.f(),t.finish(60);case 63:t.next=42;break;case 65:t.next=70;break;case 67:t.prev=67,t.t3=t.catch(40),d.e(t.t3);case 70:return t.prev=70,d.f(),t.finish(70);case 73:if(!(s.length>0)){t.next=76;break}return t.next=76,this.upsert(s);case 76:case"end":return t.stop()}}),a,this,[[3,30,33,36],[8,20,23,26],[40,67,70,73],[45,57,60,63]])})))}},{key:"block",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setBlockStateOfAllChannels(e,n,!0);case 2:case"end":return t.stop()}}),r,this)})))}},{key:"unblock",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setBlockStateOfAllChannels(e,n,!1);case 2:case"end":return t.stop()}}),r,this)})))}},{key:"markAsRead",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g(this._channels.keys());return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],s=E(n),t.prev=2,s.s();case 4:if((i=s.n()).done){t.next=12;break}return o=i.value,t.next=8,this.get(o);case 8:(u=t.sent)._updateUnreadMemberState(this._sdkState.userId,e)&&(u._updateUnreadCount(0,0),a.push(u));case 10:t.next=4;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),s.e(t.t0);case 17:return t.prev=17,s.f(),t.finish(17);case 20:if(!(a.length>0)){t.next=23;break}return t.next=23,this.upsert(a);case 23:case"end":return t.stop()}}),r,this,[[2,14,17,20]])})))}}]),o}(at);!function(e){e[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",e[e.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"}(wu||(wu={}));var Tu,Iu=function(){function t(e){r(this,t),this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=e.data,this.ts=e.ts}return s(t,[{key:"isGroupChannelEvent",get:function(){return this.channelType===e.ChannelType.GROUP}},{key:"isOpenChannelEvent",get:function(){return this.channelType===e.ChannelType.OPEN}}]),t}(),Su={invitedUserIds:null,channelUrl:null,coverUrl:null,coverImage:null,isDistinct:null,isSuper:null,isBroadcast:null,isExclusive:null,isPublic:null,isDiscoverable:null,isStrict:null,isEphemeral:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},Nu=function(e){return D("string",e.invitedUserIds,!0)&&U("string",e.channelUrl,!0)&&U("string",e.coverUrl,!0)&&(P(e.coverImage)||U("string",e.coverImage)||null===e.coverImage)&&U("boolean",e.isDistinct,!0)&&U("boolean",e.isSuper,!0)&&U("boolean",e.isBroadcast,!0)&&U("boolean",e.isExclusive,!0)&&U("boolean",e.isPublic,!0)&&U("boolean",e.isStrict,!0)&&U("boolean",e.isDiscoverable,!0)&&U("boolean",e.isEphemeral,!0)&&U("string",e.accessCode,!0)&&U("string",e.name,!0)&&U("string",e.data,!0)&&U("string",e.customType,!0)&&D("string",e.operatorUserIds,!0)&&U("number",e.messageSurvivalSeconds,!0)},Mu={customTypes:null,includeEmpty:!1,includeFrozen:!0},Au=function(e){return D("string",e.customTypes,!0)&&U("boolean",e.includeEmpty)&&U("boolean",e.includeFrozen)},Uu={myMemberStateFilter:e.MyMemberStateFilter.ALL},Ou=function(t){return O(e.MyMemberStateFilter,t.myMemberStateFilter)};e.UnreadItemKey=void 0,(Tu=e.UnreadItemKey||(e.UnreadItemKey={})).GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",Tu.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",Tu.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",Tu.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",Tu.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",Tu.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",Tu.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",Tu.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",Tu.SUPER_INVITATION_COUNT="super_group_channel_invitation_count";var Ru,Du={keys:[]},Lu=function(t){return D(e.UnreadItemKey,t.keys)},Pu={channelCustomTypesFilter:null,superChannelFilter:e.SuperChannelFilter.ALL},Fu=function(t){return D("string",t.channelCustomTypesFilter,!0)&&O(e.SuperChannelFilter,t.superChannelFilter)},Gu={channelUrl:null,scheduledStatus:null,messageTypeFilter:e.MessageTypeFilter.ALL},qu=function(t){return U("string",t.channelUrl,!0)&&D(e.ScheduledStatus,t.scheduledStatus,!0)&&O(e.MessageTypeFilter,t.messageTypeFilter)};e.GroupChannelEventSource=void 0,(Ru=e.GroupChannelEventSource||(e.GroupChannelEventSource={})).UNKNOWN="UNKNOWN",Ru.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",Ru.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",Ru.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",Ru.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",Ru.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",Ru.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",Ru.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",Ru.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",Ru.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",Ru.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",Ru.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",Ru.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",Ru.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",Ru.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",Ru.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",Ru.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",Ru.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",Ru.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",Ru.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",Ru.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",Ru.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",Ru.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",Ru.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",Ru.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",Ru.REQUEST_CHANNEL="REQUEST_CHANNEL",Ru.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",Ru.REFRESH_CHANNEL="REFRESH_CHANNEL",Ru.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",Ru.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS";var Hu,ju=function(t){return t.startsWith("EVENT_")||t===e.GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND||t===e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS},Vu=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channels,i=e.source;return r(this,n),(a=t.call(this)).channels=s,a.source=i,a}return s(n)}(J),Qu=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrls,i=e.source;return r(this,n),(a=t.call(this)).channelUrls=s,a.source=i,a}return s(n)}(J),Bu=function(){function e(n){var a=this,s=n.groupChannelCache,i=n.messageCache,o=n.unsentMessageCache,u=n.dispatcher;r(this,e),this._observers=new Map,u.on((function(e){return b(a,void 0,void 0,t().mark((function n(){var r,a,u,c,l,h,d,p,f,v=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e instanceof Vu)){n.next=26;break}r=e.channels,a=e.source,u=r.filter((function(e){return e instanceof ph})),c=s.filterOffsetChanged(u),l=E(c),n.prev=5,l.s();case 7:if((h=l.n()).done){n.next=13;break}return d=h.value,n.next=11,i.removeUnderOffset(d.url,d.messageOffsetTimestamp);case 11:n.next=7;break;case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(5),l.e(n.t0);case 18:return n.prev=18,l.f(),n.finish(18);case 21:return n.next=23,s.upsert(u);case 23:this._broadcastUpdateEvent(u,a),n.next=38;break;case 26:if(!(e instanceof Qu)){n.next=35;break}return p=e.channelUrls,f=e.source,n.next=30,s.remove(p);case 30:return n.next=32,Ve((function(){return b(v,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(p),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=11;break}return a=r.value,e.next=7,i.removeMessagesOfChannel(a);case 7:return e.next=9,o.removeMessagesOfChannel(a);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))}));case 32:this._broadcastRemoveEvent(p,f),n.next=38;break;case 35:if(!(e instanceof Ra)){n.next=38;break}return n.next=38,s.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER});case 38:case"end":return n.stop()}}),n,this,[[5,15,18,21]])})))}))}return s(e,[{key:"_broadcastUpdateEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onRemove(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"subscribe",value:function(e,t){this._observers.set(e,t)}},{key:"unsubscribe",value:function(e){this._observers.delete(e)}},{key:"unsubscribeAll",value:function(){this._observers.clear()}}]),e}(),Ku=function(){function e(n){var a=this,s=n.cacheContext,i=n.messageCache,o=n.unsentMessageCache,u=n.dispatcher,c=n.logger;r(this,e),this._cacheContext=null,this._observers=new Map,this._logger=null,this._cacheContext=s,this._logger=c,u.on((function(e){return b(a,void 0,void 0,t().mark((function n(){var r,a,s,u,c,l,h,d,p,f,v,_,m,g,y,k,E,w,x=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e instanceof Ln)){n.next=14;break}if(r=e.messages,a=e.source,s=r.filter((function(e){return e.messageId>0})),u=r.filter((function(e){return 0===e.messageId})),!(s.length>0)){n.next=8;break}return n.next=7,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert(s);case 2:return e.next=4,o.remove(s.map((function(e){return e instanceof an?e.reqId:null})).filter((function(e){return null!==e})));case 4:case"end":return e.stop()}}),e)})))}));case 7:this._broadcastUpdateEvent(s,a);case 8:if(!(u.length>0)){n.next=12;break}return n.next=11,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.upsert(u);case 2:case"end":return e.stop()}}),e)})))}));case 11:this._broadcastUpdateEvent(u,a);case 12:n.next=61;break;case 14:if(!(e instanceof Pn)){n.next=21;break}return c=e.messageIds,l=e.source,n.next=18,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.remove(c);case 2:case"end":return e.stop()}}),e)})))}));case 18:this._broadcastRemoveEvent(c,l),n.next=61;break;case 21:if(!(e instanceof Fn)){n.next=28;break}return h=e.reqId,d=e.source,n.next=25,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.remove([h]);case 2:case"end":return e.stop()}}),e)})))}));case 25:this._broadcastRemoveUnsentEvent(h,d),n.next=61;break;case 28:if(!(e instanceof Gn)){n.next=41;break}if(p=e.polls,f=e.source,!this._cacheContext.localCacheEnabled){n.next=38;break}return v=p.map((function(e){return e.messageId})),n.next=34,Promise.all(v.map((function(e){return i.get(e)})));case 34:return _=n.sent.filter((function(e){return e})),_.length>0&&p.forEach((function(e){var t=_.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e)})),n.next=38,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert(_);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}));case 38:this._broadcastPollChangeLogEvent(p,f),n.next=61;break;case 41:if(!(e instanceof qn)){n.next=52;break}return m=e.event,g=e.source,n.next=45,i.get(m.messageId);case 45:if(!((y=n.sent)&&y.isUserMessage()&&y.poll&&y.poll.applyPollUpdateEvent(m))){n.next=49;break}return n.next=49,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert([y]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}));case 49:this._broadcastPollUpdateEvent(m,g),n.next=61;break;case 52:if(!(e instanceof Hn)){n.next=61;break}return k=e.event,E=e.source,n.next=56,i.get(k.messageId);case 56:if(!((w=n.sent)&&w.isUserMessage()&&w.poll&&w.poll.applyPollVoteEvent(k))){n.next=60;break}return n.next=60,Ve((function(){return b(x,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.upsert([w]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}));case 60:this._broadcastPollVoteEvent(k,E);case 61:case"end":return n.stop()}}),n,this)})))}))}return s(e,[{key:"_broadcastUpdateEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollChangeLogEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onPollChangeLogUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollUpdateEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onPollUpdate(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastPollVoteEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onPollVote(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onRemove(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"_broadcastRemoveUnsentEvent",value:function(e,t){var n,r=E(this._observers.values());try{for(r.s();!(n=r.n()).done;){n.value.onRemoveUnsent(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"subscribe",value:function(e,t){this._observers.set(e,t)}},{key:"unsubscribe",value:function(e){this._observers.delete(e)}},{key:"unsubscribeAll",value:function(){this._observers.clear()}}]),e}(),zu=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.ts,o=e.token,u=e.filter;r(this,n),a=t.call(this);var c=Object.assign(Object.assign({},Mu),u),l=c.customTypes,h=c.includeEmpty,d=c.includeFrozen;return a.method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/my_group_channels/changelogs"),a.params=X({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:i>0?i:null,token:o,custom_types:l,show_empty:h,show_frozen:d}),a}return s(n)}($),Wu=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).updatedChannels=a.updated.map((function(t){return new ph(e,t)})),s.deletedChannelUrls=a.deleted,s.hasMore=a.has_more,s.token=a.next,s}return s(n)}(ee),Yu=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.isInternalCall;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(i?xe:we,"/").concat(encodeURIComponent(s)),a.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return s(n)}($),Ju=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=null,s.channel=new ph(e,a),s}return s(n)}(ee),Xu=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.userId,i=e.token,o=e.limit,u=e.order,c=e.includeEmpty,l=e.myMemberStateFilter,h=e.superChannelFilter,d=e.publicChannelFilter,p=e.unreadChannelFilter,f=e.nicknameContainsFilter,v=e.nicknameStartsWithFilter,_=e.nicknameExactMatchFilter,m=e.channelNameContainsFilter,g=e.channelUrlsFilter,y=e.customTypesFilter,k=e.customTypeStartsWithFilter,E=e.hiddenChannelFilter,b=e.metadataOrderKeyFilter,w=e.metadataKey,x=e.metadataValues,C=e.metadataValueStartsWith,I=e.includeFrozen,S=e.includeMetaData,N=e.searchFilter,M=e.userIdsFilter;return(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/my_group_channels"),a.params=X({token:i,limit:o,order:u,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:c,member_state_filter:l,super_mode:h,public_mode:d,unread_filter:p,members_nickname_contains:f,members_nickname_startswith:v,members_nickname:_,name_contains:m,channel_urls:g,custom_types:y,custom_type_startswith:k,hidden_mode:E,metadata_order_key:b,metadata_key:w,metadata_values:x,metadata_value_startswith:C,show_frozen:I,show_metadata:S}),N&&N.query&&N.fields&&(a.params.search_query=N.query,a.params.search_fields=N.fields),M&&M.userIds&&M.userIds.length>0&&(M.includeMode?(a.params.members_include_in=M.userIds,a.params.query_type=M.queryType.toUpperCase()):a.params.members_exactly_in=M.userIds),a}return s(n)}($),Zu=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.channels=[],s.ts=null;var i=a.next,o=a.channels,u=a.ts;return s.token=i,o&&o.length>0&&(s.channels=o.map((function(t){return t.ts=u,new ph(e,t)}))),s.ts=null!=u?u:null,s}return s(n)}(ee),$u=function(t){i(a,t);var n=f(a);function a(t){var s,i=t.userId,o=t.filter;r(this,a),s=n.call(this);var u=o.myMemberStateFilter;return s.method=T.GET,s.path="".concat(Ee,"/").concat(encodeURIComponent(i),"/group_channel_count"),s.params={state:null!=u?u:e.MyMemberStateFilter.ALL},s}return s(a)}($),ec=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).groupChannelCount=a.group_channel_count,s}return s(n)}(ee),tc=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.filter;r(this,n),a=t.call(this);var o=i.keys;return a.method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/unread_item_count"),a.params={item_keys:o},a}return s(n)}($),nc=function(t){i(a,t);var n=f(a);function a(t,s){var i;return r(this,a),i=n.call(this,t,s),"number"==typeof s[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(i.groupChannelUnreadMentionCount=s[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof s[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(i.groupChannelUnreadMessageCount=s[e.UnreadItemKey.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof s[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]&&(i.groupChannelInvitationCount=s[e.UnreadItemKey.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof s[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]&&(i.superGroupChannelUnreadMentionCount=s[e.UnreadItemKey.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof s[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]&&(i.superGroupChannelUnreadMessageCount=s[e.UnreadItemKey.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof s[e.UnreadItemKey.SUPER_INVITATION_COUNT]&&(i.superGroupChannelInvitationCount=s[e.UnreadItemKey.SUPER_INVITATION_COUNT]),"number"==typeof s[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]&&(i.nonSuperGroupChannelUnreadMentionCount=s[e.UnreadItemKey.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof s[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]&&(i.nonSuperGroupChannelUnreadMessageCount=s[e.UnreadItemKey.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof s[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]&&(i.nonSuperGroupChannelInvitationCount=s[e.UnreadItemKey.NONSUPER_INVITATION_COUNT]),i}return s(a)}(ee),rc=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/unread_channel_count"),a}return s(n)}($),ac=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).unreadCount=a.unread_count,s}return s(n)}(ee),sc=function(t){i(a,t);var n=f(a);function a(t){var s,i=t.userId,o=t.filter;r(this,a),s=n.call(this);var u=o.channelCustomTypesFilter,c=o.superChannelFilter;return s.method=T.GET,s.path="".concat(Ee,"/").concat(encodeURIComponent(i),"/unread_message_count"),s.params={super_mode:null!=c?c:e.SuperChannelFilter.ALL,custom_types:u},s}return s(a)}($),ic=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).unreadCount=a.unread_count,s}return s(n)}(ee),oc=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.scheduledStatus,o=e.messageTypeFilter;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ue,"/count"),a.params={channel_url:s,status:cc(i)},o&&(a.params.message_type=o),a}return s(n)}($),uc=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).count=a.count,s}return s(n)}(ee),cc=function(t){if(t){var n=[];return t.forEach((function(t){switch(t){case e.ScheduledStatus.PENDING:n.push(zt.PENDING);break;case e.ScheduledStatus.SENT:n.push(zt.IN_QUEUE),n.push(zt.SENT);break;case e.ScheduledStatus.CANCELED:n.push(zt.CANCELED);break;case e.ScheduledStatus.FAILED:n.push(zt.FAILED)}})),n}},lc=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.userId,i=e.channelUrl,o=e.coverUrl,u=e.coverImage,c=e.isDistinct,l=e.isSuper,h=e.isBroadcast,d=e.isPublic,p=e.isExclusive,f=e.isDiscoverable,v=e.isStrict,_=e.isEphemeral,m=e.accessCode,y=e.name,k=e.data,E=e.customType,b=e.messageSurvivalSeconds,w=e.invitedUserIds,x=e.operatorUserIds;return(a=t.call(this)).method=T.POST,a.path=we,a.params=X({user_ids:[s].concat(g(null!=w?w:[])).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:i,cover_url:o,cover_file:u,is_distinct:c,is_super:l,is_broadcast:h,is_exclusive:p,is_public:d,is_discoverable:f,strict:v,is_ephemeral:_,access_code:m,name:y,data:k,custom_type:E,operator_ids:x,message_survival_seconds:b}),a}return s(n)}($),hc=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=new ph(e,a),s.isCreated=a.is_created,s}return s(n)}(ee),dc=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.channelUrls;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/mark_as_read_all"),a.params={channel_urls:i},a}return s(n)}($),pc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).event=new Iu(s),i}return s(n)}(oe),fc=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.userId,o=e.accessCode;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/join"),a.params={user_id:i,access_code:o},a}return s(n)}($),vc=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=new ph(e,a),s}return s(n)}(ee),_c=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;r(this,n),i=t.call(this,e,a,s);var o=s.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l,d=o.users,p=void 0===d?null:d;return i.memberCount=c,i.joinedMemberCount=h,i.members=Array.isArray(p)?p.map((function(t){return new Eu(e,t)})):[new Eu(e,s.data)],i}return s(n)}(pc),mc=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.userId,o=e.shouldRemoveOperatorStatus;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/leave"),a.params={user_id:i,should_remove_operator_status:o},a}return s(n)}($),gc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;r(this,n),i=t.call(this,e,a,s);var o=s.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l;return i.memberCount=c,i.joinedMemberCount=h,i.member=new Eu(i._iid,s.data),i}return s(n)}(pc),yc=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.userIds;return(a=t.call(this)).method=T.POST,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/invite"),a.params={user_ids:i},a}return s(n)}($),kc=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=new ph(e,a),s}return s(n)}(ee),Ec=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;r(this,n),i=t.call(this,e,a,s);var o=s.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l,d=o.inviter,p=void 0===d?null:d,f=o.invitees,v=void 0===f?[]:f;return i.memberCount=c,i.joinedMemberCount=h,i.inviter=p?new vt(e,p):null,i.invitees=v.map((function(t){return new Eu(e,t)})),i}return s(n)}(pc),bc=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.userId;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/decline"),a.params={user_id:i},a}return s(n)}($),wc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;r(this,n),i=t.call(this,e,a,s);var o=s.data,u=o.member_count,c=void 0===u?null:u,l=o.joined_member_count,h=void 0===l?null:l,d=o.inviter,p=void 0===d?null:d,f=o.invitee,v=void 0===f?null:f;return i.memberCount=c,i.joinedMemberCount=h,i.inviter=p?new vt(e,p):null,i.invitee=v?new Eu(e,v):null,i}return s(n)}(pc),xc=function(e){i(n,e);var t=f(n);function n(e){var a=e.channelUrl;return r(this,n),t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:a}})}return s(n)}(he),Cc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"READ",s)).readStatus=new bu(e,s),i}return s(n)}(oe),Tc=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.userId;return r(this,n),a=t.call(this),(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/messages/mark_as_delivered"),a.params=X({userId:i}),a}return s(n)}($),Ic=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"DLVR",s)).channelUrl=s.channel_url,i.deliveredStateUpdate=s.updated,i}return s(n)}(oe),Sc=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.userId,o=e.hidePreviousMessages,u=e.allowAutoUnhide;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/hide"),a.params={user_id:i,hide_previous_messages:o,allow_auto_unhide:u},a}return s(n)}($),Nc=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).messageOffsetTimestamp=null;var i=a.ts_message_offset;return s.messageOffsetTimestamp=null!=i?i:null,s}return s(n)}(ee),Mc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).allowAutoUnhide=null,i.hidePreviousMessages=null,i.messageOffsetTimestamp=null,s.data&&(i.allowAutoUnhide=s.data.allow_auto_unhide,i.hidePreviousMessages=s.data.hide_previous_messages),i.messageOffsetTimestamp=s.ts_message_offset,i}return s(n)}(oe),Ac=function(e){i(n,e);var t=f(n);function n(e){var a=e.channelUrl,s=e.time;return r(this,n),t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:a,time:s}})}return s(n)}(he),Uc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).user=new vt(e,s.data),i}return s(n)}(oe),Oc=function(e){i(n,e);var t=f(n);function n(e){var a=e.channelUrl,s=e.time;return r(this,n),t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:a,time:s}})}return s(n)}(he),Rc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"SYEV",s)).user=new vt(e,s.data),i}return s(n)}(oe),Dc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;r(this,n),i=t.call(this,e,a,s);var o=s.data.operators,u=void 0===o?[]:o;return i.operators=u.map((function(e){return new vt(i._iid,e)})),i}return s(n)}(pc),Lc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"MCNT",s)).groupChannelMemberCounts=s.group_channels.map((function(e){return{channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}})),i.openChannelMemberCounts=s.open_channels.map((function(e){return{channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts}})),i}return s(n)}(oe),Pc=function(e){i(n,e);var t=f(n);function n(e){var a=e.channelUrl,s=e.messageId;return r(this,n),t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:a,msg_id:s}})}return s(n)}(he),Fc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u,c;r(this,n),(i=t.call(this,e,"ADMM",s)).message=new cn(e,s);var l=At.of(e).sdkState;return i.isMentioned=bn(i.message.mentionType,null!==(o=i.message.mentionedUserIds)&&void 0!==o?o:null===(u=i.message.mentionedUsers)||void 0===u?void 0:u.map((function(e){return e.userId})),l.userId),i.forceUpdateLastMessage=null!==(c=s.force_update_last_message)&&void 0!==c&&c,i}return s(n)}(oe),Gc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u,c,l,h,d;r(this,n),(i=t.call(this,e,"AEDI",s)).message=new cn(e,s);var p=At.of(e).sdkState;return i.mentionCountChange=wn({mentionType:null!==(u=null===(o=s.old_values)||void 0===o?void 0:o.mention_type)&&void 0!==u?u:null,mentionedUserIds:null!==(l=null===(c=s.old_values)||void 0===c?void 0:c.mentioned_user_ids)&&void 0!==l?l:[]},{mentionType:i.message.mentionType,mentionedUserIds:null!==(h=i.message.mentionedUserIds)&&void 0!==h?h:null===(d=i.message.mentionedUsers)||void 0===d?void 0:d.map((function(e){return e.userId}))},p.userId),i}return s(n)}(oe),qc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"MRCT",s)).channelUrl=s.channel_url,i.channelType=s.channel_type,i.event=new Wt(s),i}return s(n)}(oe),Hc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"MTHD",s)).event=new $n(e,s),i}return s(n)}(oe),jc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"PEDI",s)).event=null,i.status=null,i.channelUrl=null,i.channelType=null,i.event=new Mr(e,s),i.status=dn(s.poll.status)||s.poll.status,i.channelUrl=s.channel_url,i.channelType=s.channel_type,i}return s(n)}(oe),Vc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i;return r(this,n),(i=t.call(this,e,"VOTE",s)).event=null,i.channelUrl=null,i.channelType=null,i.event=new Ar(s),i.channelUrl=s.channel_url,i.channelType=s.channel_type,i}return s(n)}(oe),Qc=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h,d,p,f,v,_,m,g,y,k,E,b,w,x,C,T,I,S;return r(this,u),(s=a.call(this,t,n)).includeEmpty=!1,s.includeFrozen=!0,s.includeMetaData=!0,s.channelUrlsFilter=null,s.customTypesFilter=null,s.customTypeStartsWithFilter=null,s.nicknameContainsFilter=null,s.nicknameStartsWithFilter=null,s.nicknameExactMatchFilter=null,s.channelNameContainsFilter="",s.myMemberStateFilter=e.MyMemberStateFilter.ALL,s.unreadChannelFilter=e.UnreadChannelFilter.ALL,s.superChannelFilter=e.SuperChannelFilter.ALL,s.publicChannelFilter=e.PublicChannelFilter.ALL,s.hiddenChannelFilter=e.HiddenChannelFilter.UNHIDDEN,s.searchFilter={fields:[],query:null},s.userIdsFilter={userIds:[],includeMode:!0,queryType:e.QueryType.AND},s.metadataKey=null,s.metadataValues=null,s.metadataOrderKeyFilter=null,s.metadataValueStartsWith=null,s.order=e.GroupChannelListOrder.LATEST_LAST_MESSAGE,s.includeEmpty=null!==(i=n.includeEmpty)&&void 0!==i&&i,s.includeFrozen=null===(o=n.includeFrozen)||void 0===o||o,s.includeMetaData=null===(c=n.includeMetaData)||void 0===c||c,s.channelUrlsFilter=null!==(l=n.channelUrlsFilter)&&void 0!==l?l:null,s.customTypesFilter=null!==(h=n.customTypesFilter)&&void 0!==h?h:null,s.customTypeStartsWithFilter=null!==(d=n.customTypeStartsWithFilter)&&void 0!==d?d:"",s.nicknameContainsFilter=null!==(p=n.nicknameContainsFilter)&&void 0!==p?p:null,s.nicknameStartsWithFilter=null!==(f=n.nicknameStartsWithFilter)&&void 0!==f?f:null,s.nicknameExactMatchFilter=null!==(v=n.nicknameExactMatchFilter)&&void 0!==v?v:null,s.channelNameContainsFilter=null!==(_=n.channelNameContainsFilter)&&void 0!==_?_:"",s.myMemberStateFilter=null!==(m=n.myMemberStateFilter)&&void 0!==m?m:e.MyMemberStateFilter.ALL,s.unreadChannelFilter=null!==(g=n.unreadChannelFilter)&&void 0!==g?g:e.UnreadChannelFilter.ALL,s.superChannelFilter=null!==(y=n.superChannelFilter)&&void 0!==y?y:e.SuperChannelFilter.ALL,s.publicChannelFilter=null!==(k=n.publicChannelFilter)&&void 0!==k?k:e.PublicChannelFilter.ALL,s.hiddenChannelFilter=null!==(E=n.hiddenChannelFilter)&&void 0!==E?E:e.HiddenChannelFilter.UNHIDDEN,s.searchFilter=null!==(b=n.searchFilter)&&void 0!==b?b:{fields:[],query:null},s.userIdsFilter=null!==(w=n.userIdsFilter)&&void 0!==w?w:{userIds:[],includeMode:!0,queryType:e.QueryType.AND},s.metadataKey=null!==(x=n.metadataKey)&&void 0!==x?x:null,s.metadataValues=null!==(C=n.metadataValues)&&void 0!==C?C:null,s.metadataOrderKeyFilter=null!==(T=n.metadataOrderKeyFilter)&&void 0!==T?T:null,s.metadataValueStartsWith=null!==(I=n.metadataValueStartsWith)&&void 0!==I?I:null,s.order=null!==(S=n.order)&&void 0!==S?S:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,s}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)&&U("boolean",this.includeEmpty)&&U("boolean",this.includeFrozen)&&U("boolean",this.includeMetaData)&&U("string",this.channelNameContainsFilter)&&D("string",this.channelUrlsFilter,!0)&&D("string",this.customTypesFilter,!0)&&U("string",this.customTypeStartsWithFilter)&&U("string",this.nicknameContainsFilter,!0)&&U("string",this.nicknameStartsWithFilter,!0)&&U("string",this.nicknameExactMatchFilter,!0)&&O(e.MyMemberStateFilter,this.myMemberStateFilter)&&O(e.SuperChannelFilter,this.superChannelFilter)&&O(e.PublicChannelFilter,this.publicChannelFilter)&&O(e.UnreadChannelFilter,this.unreadChannelFilter)&&O(e.HiddenChannelFilter,this.hiddenChannelFilter)&&D(e.GroupChannelSearchField,this.searchFilter.fields)&&U("string",this.searchFilter.query,!0)&&D("string",this.userIdsFilter.userIds)&&U("boolean",this.userIdsFilter.includeMode)&&O(e.QueryType,this.userIdsFilter.queryType)&&O(e.GroupChannelListOrder,this.order)&&U("string",this.metadataOrderKeyFilter,!0)&&U("string",this.metadataKey,!0)&&D("string",this.metadataValues,!0)&&U("string",this.metadataValueStartsWith,!0)}},{key:"serialize",value:function(){return ht(this)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=Wc.of(this._iid),e.next=7,n.getMyGroupChannels(this._token,this,this.limit);case 7:return r=e.sent,a=r.channels,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,e.abrupt("return",a);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(nr),Bc=function(){function e(t){var n=t.top,a=void 0===n?Number.MAX_SAFE_INTEGER:n,s=t.bottom,i=void 0===s?0:s;r(this,e),this.top=a,this.bottom=i}return s(e,[{key:"includes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every((function(t){return e.top<=t&&t<=e.bottom}))}},{key:"overlap",value:function(e){return this.includes(e.top)||this.includes(e.bottom)}},{key:"extends",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.top=Math.min.apply(Math,[this.top].concat(t)),this.bottom=Math.max.apply(Math,[this.bottom].concat(t))}}]),e}(),Kc=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o;return r(this,n),(i=t.call(this,e,"SYEV",s)).pinnedMessageIds=[],i.latestPinnedMessage=null,i.ts=0,s.data&&(i.pinnedMessageIds=null!==(o=s.data.pinned_message_ids)&&void 0!==o?o:[],i.latestPinnedMessage=s.data.latest_pinned_message?gn(e,Object.assign({},s.data.latest_pinned_message)):null),i.ts=s.ts,i}return s(n)}(oe),zc={},Wc=function(){function n(a,s){var i=this,o=s.sdkState,u=s.cacheContext,c=s.dispatcher,l=s.sessionManager,h=s.requestQueue,d=s.logger,p=s.disableMack,f=void 0!==p&&p;return r(this,n),this._leftChannels=new Map,this._disableMack=!1,this._markAsReadAllLastSentAt=0,zc[a]||(this._iid=a,this._sdkState=o,this._sessionManager=l,this._requestQueue=h,this._dispatcher=c,this._logger=d,this._disableMack=f,this._groupChannelHandlers=new Map,this._groupChannelCache=new Cu(this._iid,{sdkState:o,cacheContext:u}),this._unsentMessageCache=new wa(this._iid,{sdkState:o,cacheContext:u}),this._messageCache=new Ta(this._iid,{sdkState:o,cacheContext:u,unsentMessageCache:this._unsentMessageCache}),this._groupChannelBroadcast=new Bu({groupChannelCache:this._groupChannelCache,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:c}),this._messageBroadcast=new Ku({cacheContext:u,messageCache:this._messageCache,unsentMessageCache:this._unsentMessageCache,dispatcher:c,logger:d}),setInterval((function(){var t,n=E(i._groupChannelCache.channels);try{var r=function(){var n=t.value;n.invalidateTypingStatus()&&(i._dispatcher.dispatch(new Vu({channels:[n],source:e.GroupChannelEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),i._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(n)})))};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}),1e3),this._dispatcher.on((function(e){e instanceof oe?i._handleEvent(e):e instanceof Na&&b(i,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.message,t.next=3,this.getChannel(r.channelUrl,!0);case 3:a=t.sent,r instanceof _n?a._autoResendUserMessage(r):r instanceof yn&&a._autoResendFileMessage(r);case 5:case"end":return t.stop()}}),n,this)})))})),zc[a]=this),zc[a]}return s(n,[{key:"handlers",get:function(){return g(this._groupChannelHandlers.values())}},{key:"buildGroupChannelFromSerializedData",value:function(e){var t=dt(e);return new ph(this._iid,ph.payloadify(t))}},{key:"buildGroupChannelListQueryFromSerializedData",value:function(e){var t=dt(e);return new Qc(this._iid,t)}},{key:"buildMemberFromSerializedData",value:function(e){var t=dt(e);return new Eu(this._iid,Eu.payloadify(t))}},{key:"getChannelFromCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getChannelsFromCache",value:function(e,n,r,a){return b(this,void 0,void 0,t().mark((function s(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.fetch({token:e,filter:n,order:r,limit:a});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),s,this)})))}},{key:"upsertChannelsToCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.upsert(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"removeChannelsFromCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._groupChannelCache.remove(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"clearChannelsFromCache",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._groupChannelCache.clear();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"_handleEvent",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h,d,p,f,v,_,m,g,y,k,w,x,C,T,S,N,M,A,U,O,R,D,L,P,F,G,q,H,j,V,Q,B,K,z,W,Y,J,X,Z,$,ee,te,ne,re,ae,se,ie,oe,ue,ce,le,he,de,pe,fe,ve,_e,me,ge,ye,ke,Ee,be,we,xe,Ce,Te,Ie,Se,Ne,Me,Ae,Ue,Oe,Re,De,Le,Pe,Fe,Ge,qe,He,Qe,Be,Ke,ze,We,Ye,Je,Xe,Ze,$e,et,tt,nt,rt,at,st,it,ot,ut,ct,lt,ht,dt,pt,ft,vt,_t,mt,gt,yt,kt,Et,bt,wt,xt,Ct,Tt,It,St,Nt,Mt,Ut,Ot,Rt,Dt,Lt,Pt,Ft,Gt,qt,Ht,jt,Vt,Qt,Bt,Kt,zt,Wt,Yt,Jt,Xt,Zt,$t,en,tn,nn,rn,sn,on,un,cn,ln,hn,dn,pn=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,r.t0=n.code,r.next="MESG"===r.t0||"FILE"===r.t0||"ADMM"===r.t0||"BRDM"===r.t0?4:"MEDI"===r.t0||"FEDI"===r.t0||"AEDI"===r.t0?45:"DELM"===r.t0?64:"READ"===r.t0?72:"DLVR"===r.t0?81:"MRCT"===r.t0?89:"MTHD"===r.t0?100:"MCNT"===r.t0?111:"PEDI"===r.t0?135:"VOTE"===r.t0?144:"SYEV"===r.t0?153:"USEV"===r.t0?326:337;break;case 4:if(a=null,"MESG"===n.code?a=n.as(Ko):"FILE"===n.code?a=n.as(Tn):"ADMM"!==n.code&&"BRDM"!=n.code||(a=n.as(Fc)),!a){r.next=44;break}if(i=(s=a).message,o=s.isMentioned,u=s.forceUpdateLastMessage,i.channelType!==e.ChannelType.GROUP){r.next=44;break}return this._disableMack||Ve((function(){return b(pn,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Pc(i),this._requestQueue.send(n);case 2:case"end":return e.stop()}}),e,this)})))})),c=this._groupChannelCache.isCachedInMemory(i.channelUrl),l=i instanceof an&&i.sender.userId===this._sdkState.userId,r.next=14,this.getChannel(i.channelUrl,!0);case 14:if((h=r.sent).hiddenState===e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE&&(h.hiddenState=e.HiddenState.UNHIDDEN),!(i instanceof an)){r.next=38;break}d=At.of(this._iid),p=d.useMemberInfoInMessage,f=E(h.members),r.prev=19,f.s();case 21:if((v=f.n()).done){r.next=28;break}if((_=v.value).userId!==i.sender.userId){r.next=26;break}return p||(i.sender.nickname=_.nickname,i.sender.plainProfileUrl=_.plainProfileUrl,i.sender.metaData=_.metaData,i.sender.isBlockedByMe=_.isBlockedByMe),r.abrupt("break",28);case 26:r.next=21;break;case 28:r.next=33;break;case 30:r.prev=30,r.t1=r.catch(19),f.e(r.t1);case 33:return r.prev=33,f.f(),r.finish(33);case 36:!p&&o&&i.mentionedUsers.forEach((function(e){var t,n=E(h.members);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(e.userId===r.userId){e.nickname=r.nickname,e.plainProfileUrl=r.plainProfileUrl,e.metaData=r.metaData;break}}}catch(e){n.e(e)}finally{n.f()}})),l&&(m=this._sessionManager.currentUser)&&(m.nickname=i.sender.nickname,m.plainProfileUrl=i.sender.plainProfileUrl,m.metaData=i.sender.metaData);case 38:i.silent&&!l||(h.isEphemeral||c)&&((!h.lastMessage||h.lastMessage.createdAt<i.createdAt)&&(h.lastMessage=i),l||h._updateUnreadCount(h.unreadMessageCount+1,h.unreadMentionCount+(o?1:0))),u&&(!h.lastMessage||h.lastMessage.createdAt<i.createdAt)&&(h.lastMessage=i),this._dispatcher.dispatch(new Vu({channels:[h],source:e.GroupChannelEventSource.EVENT_MESSAGE_RECEIVED})),i.silent&&!l||je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelChanged(h)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),this._dispatcher.dispatch(new Ln({messages:[i],source:e.MessageEventSource.EVENT_MESSAGE_RECEIVED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onMessageReceived(h,i),o&&a.onMentionReceived(h,i)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 44:return r.abrupt("break",337);case 45:if(g=null,"MEDI"===n.code?g=n.as(Wo):"FEDI"===n.code?g=n.as(Jo):"AEDI"===n.code&&(g=n.as(Gc)),!g){r.next=63;break}if(k=(y=g).message,w=y.mentionCountChange,k.channelType!==e.ChannelType.GROUP){r.next=63;break}return x=this._groupChannelCache.isCachedInMemory(k.channelUrl),r.next=53,this.getChannel(k.channelUrl,!0);case 53:C=r.sent,T=k instanceof an&&k.sender.userId===this._sdkState.userId,S=!1,T?(N=this._sessionManager.currentUser)&&(N.nickname=k.sender.nickname,N.plainProfileUrl=k.sender.plainProfileUrl,N.metaData=k.sender.metaData):C.isReadMessage(k)||0!==w&&!k.silent&&x&&(C._updateUnreadCount(C.unreadMessageCount,C.unreadMentionCount+w),S=!0),!C.lastMessage||C.lastMessage.createdAt<k.createdAt?(C.lastMessage=k,S=!0):C.lastMessage.isIdentical(k)&&(x?C.lastMessage.updatedAt<k.updatedAt&&(C.lastMessage=k,S=!0):S=!0),M=!1,C.lastPinnedMessage&&C.lastPinnedMessage.messageId===k.messageId&&(C.lastPinnedMessage=k,S=!0,M=!0),S&&(this._dispatcher.dispatch(new Vu({channels:[C],source:M?e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED})),k.silent&&!T||je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelChanged(C)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),M&&je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onPinnedMessageUpdated(C)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),this._dispatcher.dispatch(new Ln({messages:[k],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)(a=r.value).onMessageUpdated(C,k),0!==w&&a.onMentionReceived(C,k)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 63:return r.abrupt("break",337);case 64:if(A=n.as(Zo),U=A.channelUrl,O=A.channelType,R=A.messageId,O!==e.ChannelType.GROUP){r.next=71;break}return r.next=68,this.getChannel(U,!0);case 68:D=r.sent,this._dispatcher.dispatch(new Pn({messageIds:[R],source:e.MessageEventSource.EVENT_MESSAGE_DELETED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onMessageDeleted(D,R)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 71:return r.abrupt("break",337);case 72:if(L=n.as(Cc),(P=L.readStatus).channelType!==e.ChannelType.GROUP){r.next=80;break}return F=this._groupChannelCache.isCachedInMemory(P.channelUrl),r.next=77,this.getChannel(P.channelUrl,!0);case 77:G=r.sent,F&&G._updateUnreadMemberState(P.reader.userId,P.readAt),P.reader.userId===this._sdkState.userId?F?(G.unreadMessageCount>0||G.unreadMentionCount>0)&&(G._updateUnreadCount(0,0),this._dispatcher.dispatch(new Vu({channels:[G],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelChanged(G)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))):0!==G.unreadMessageCount&&0!==G.unreadMentionCount||(this._dispatcher.dispatch(new Vu({channels:[G],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelChanged(G)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))):(this._dispatcher.dispatch(new Vu({channels:[G],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onUnreadMemberStatusUpdated(G)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})));case 80:return r.abrupt("break",337);case 81:return q=n.as(Ic),H=q.channelUrl,j=q.deliveredStateUpdate,V=void 0===j?{}:j,Q=this._groupChannelCache.isCachedInMemory(H),r.next=85,this.getChannel(H,!0);case 85:if(B=r.sent,Q)for(K in V)B._updateUndeliveredMemberState(K,V[K]);return Object.keys(V).some((function(e){return e!==pn._sdkState.userId}))&&(this._dispatcher.dispatch(new Vu({channels:[B],source:e.GroupChannelEventSource.EVENT_CHANNEL_DELIVERED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onUndeliveredMemberStatusUpdated(B)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),r.abrupt("break",337);case 89:if(z=n.as(qc),W=z.channelUrl,Y=z.channelType,J=z.event,Y!==e.ChannelType.GROUP){r.next=99;break}return r.next=93,this.getChannel(W,!0);case 93:return X=r.sent,r.next=96,this.getMessageFromCache(J.messageId);case 96:(Z=r.sent)&&(Z.applyReactionEvent(J),this._dispatcher.dispatch(new Ln({messages:[Z],source:e.MessageEventSource.EVENT_MESSAGE_REACTION_UPDATED}))),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onReactionUpdated(X,J)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 99:return r.abrupt("break",337);case 100:if($=n.as(Hc),(ee=$.event).channelType!==e.ChannelType.GROUP){r.next=110;break}return r.next=104,this.getChannel(ee.channelUrl,!0);case 104:return te=r.sent,r.next=107,this.getMessageFromCache(ee.targetMessageId);case 107:(ne=r.sent)&&(ne.applyThreadInfoUpdateEvent(ee),this._dispatcher.dispatch(new Ln({messages:[ne],source:e.MessageEventSource.EVENT_MESSAGE_THREADINFO_UPDATED}))),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onThreadInfoUpdated(te,ee)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 110:return r.abrupt("break",337);case 111:re=n.as(Lc),ae=re.groupChannelMemberCounts,se=[],ie=E(ae),r.prev=114,ie.s();case 116:if((oe=ie.n()).done){r.next=125;break}return ue=oe.value,ce=ue.channelUrl,le=ue.memberCount,he=ue.joinedMemberCount,de=ue.updatedAt,r.next=121,this.getChannelFromCache(ce);case 121:(pe=r.sent)&&pe._setLatestMemberCount(le,he,de)&&se.push(pe);case 123:r.next=116;break;case 125:r.next=130;break;case 127:r.prev=127,r.t2=r.catch(114),ie.e(r.t2);case 130:return r.prev=130,ie.f(),r.finish(130);case 133:return se.length>0&&(this._dispatcher.dispatch(new Vu({channels:se,source:e.GroupChannelEventSource.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelMemberCountChanged(se)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}))),r.abrupt("break",337);case 135:if(fe=n.as(jc),ve=fe.event,_e=fe.status,me=fe.channelUrl,ge=fe.channelType,me&&ge){r.next=138;break}return r.abrupt("break",337);case 138:return r.next=140,this.getChannel(me,!0);case 140:return ye=r.sent,this._dispatcher.dispatch(new qn({event:ve,source:e.MessageEventSource.EVENT_POLL_UPDATED})),je("removed"===_e?function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onPollDeleted(ye,ve.pollId)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}:function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onPollUpdated(ye,ve)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}),r.abrupt("break",337);case 144:if(ke=n.as(Vc),Ee=ke.event,be=ke.channelUrl,we=ke.channelType,be&&we){r.next=147;break}return r.abrupt("break",337);case 147:return r.next=149,this.getChannel(be,!0);case 149:return xe=r.sent,this._dispatcher.dispatch(new Hn({event:Ee,source:e.MessageEventSource.EVENT_POLL_VOTED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onPollVoted(xe,Ee)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",337);case 153:if(Ce=n.as(pc),!(Te=Ce.event).isGroupChannelEvent){r.next=325;break}r.t3=Te.category,r.next=r.t3===wu.CHANNEL_JOIN?158:r.t3===wu.CHANNEL_LEAVE?167:r.t3===wu.CHANNEL_OPERATOR_UPDATE?183:r.t3===wu.CHANNEL_INVITE?194:r.t3===wu.CHANNEL_DECLINE_INVITE?204:r.t3===wu.TYPING_START||r.t3===wu.TYPING_END?212:r.t3===wu.USER_CHANNEL_MUTE||r.t3===wu.USER_CHANNEL_UNMUTE?221:r.t3===wu.USER_CHANNEL_BAN?248:r.t3===wu.USER_CHANNEL_UNBAN?261:r.t3===wu.CHANNEL_FREEZE||r.t3===wu.CHANNEL_UNFREEZE?267:r.t3===wu.CHANNEL_HIDE?275:r.t3===wu.CHANNEL_UNHIDE?285:r.t3===wu.CHANNEL_DELETED?292:r.t3===wu.CHANNEL_PROP_CHANGED?298:r.t3===wu.CHANNEL_META_DATA_CHANGED?304:r.t3===wu.CHANNEL_META_COUNTERS_CHANGED?313:r.t3===wu.PINNED_MESSAGE_CHANGED?319:325;break;case 158:return r.next=160,this.getChannel(Te.channelUrl,!0);case 160:return Ie=r.sent,Se=n.as(_c),Ne=Se.memberCount,Me=Se.joinedMemberCount,Ae=Se.members,Ue=!1,Ae.forEach((function(t){Ie.isExclusive||Ie.isSuper||Ie.isBroadcast?Ue=Ue||Ie._setLatestMemberCount(Ne,Me,Te.ts):(t.state=e.MemberState.JOINED,Ie.addMember(t,Te.ts),pn._updateJoinedMemberCount(Ie)),t.userId===pn._sdkState.userId&&(Ie.myMemberState=e.MemberState.JOINED)})),this._dispatcher.dispatch(new Vu({channels:[Ie],source:e.GroupChannelEventSource.EVENT_CHANNEL_JOINED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){var t,n=E(Ae);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.onUserJoined(Ie,r)}}catch(e){n.e(e)}finally{n.f()}Ie.isBroadcast&&Ue&&e.onChannelMemberCountChanged([Ie])}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 167:if(!(Oe=this._leftChannels.get(Te.channelUrl))){r.next=172;break}r.t4=Oe.channel,r.next=175;break;case 172:return r.next=174,this.getChannel(Te.channelUrl,!0);case 174:r.t4=r.sent;case 175:return Re=r.t4,De=n.as(gc),Le=De.memberCount,Pe=De.joinedMemberCount,Fe=De.member,Ge=!1,qe=At.of(this._iid),He=qe.appInfo,Re.isExclusive||Re.isSuper||Re.isBroadcast?Ge=Re._setLatestMemberCount(Le,Pe,Te.ts):(He.enabledChannelMemberShipHistory?(Re.members.find((function(e){return e.userId===Fe.userId})).state=e.MemberState.LEFT,Re.memberCount=Le):Re.removeMember(Fe),this._updateJoinedMemberCount(Re)),Fe.userId===this._sdkState.userId?(Re.myMemberState=e.MemberState.NONE,Re.invitedAt=0,Re.joinedAt=0,Re._updateUnreadCount(0,0),Re.isPublic?this._dispatcher.dispatch(new Vu({channels:[Re],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})):(this._markAsLeave(Re),this._dispatcher.dispatch(new Qu({channelUrls:[Re.url],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new Vu({channels:[Re],source:e.GroupChannelEventSource.EVENT_CHANNEL_LEFT})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserLeft(Re,Fe),Re.isBroadcast&&Ge&&e.onChannelMemberCountChanged([Re])}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 183:return r.next=185,this.getChannel(Te.channelUrl,!0);case 185:Qe=r.sent,Be=n.as(Dc),Ke=Be.operators,ze=Ke.map((function(e){return e.userId})),We=E(Qe.members);try{for(We.s();!(Ye=We.n()).done;)(Je=Ye.value).role=ze.includes(Je.userId)?e.Role.OPERATOR:e.Role.NONE}catch(e){We.e(e)}finally{We.f()}return Qe.myRole=ze.includes(this._sdkState.userId)?e.Role.OPERATOR:e.Role.NONE,this._dispatcher.dispatch(new Vu({channels:[Qe],source:e.GroupChannelEventSource.EVENT_CHANNEL_OPERATOR_UPDATED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated(Qe,Ke)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 194:return r.next=196,this.getChannel(Te.channelUrl,!0);case 196:Xe=r.sent,Ze=n.as(Ec),$e=Ze.memberCount,et=Ze.joinedMemberCount,tt=Ze.inviter,(nt=Ze.invitees).forEach((function(t){return t.state=e.MemberState.INVITED})),rt=E(nt);try{for(rt.s();!(at=rt.n()).done;)st=at.value,Xe.isExclusive||Xe.isSuper||Xe.isBroadcast?Xe._setLatestMemberCount($e,et,Te.ts):Xe.addMember(st,Te.ts),this._sdkState.userId===st.userId&&(Xe.hiddenState=e.HiddenState.UNHIDDEN,Xe.myMemberState!==e.MemberState.JOINED&&(Xe.myMemberState=e.MemberState.INVITED),Xe.invitedAt=Te.ts)}catch(e){rt.e(e)}finally{rt.f()}return this._dispatcher.dispatch(new Vu({channels:[Xe],source:e.GroupChannelEventSource.EVENT_CHANNEL_INVITED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation(Xe,tt,nt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 204:return r.next=206,this.getChannel(Te.channelUrl,!0);case 206:return it=r.sent,ot=n.as(wc),ut=ot.memberCount,ct=ot.joinedMemberCount,lt=ot.inviter,ht=ot.invitee,it.isExclusive||it.isSuper||it.isBroadcast?it._setLatestMemberCount(ut,ct,Te.ts):it.removeMember(ht),this._sdkState.userId===ht.userId?(it.invitedAt=0,it.myMemberState=e.MemberState.NONE,it.isPublic?this._dispatcher.dispatch(new Vu({channels:[it],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new Qu({channelUrls:[it.url],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new Vu({channels:[it],source:e.GroupChannelEventSource.EVENT_CHANNEL_DECLINED_INVITE})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation(it,lt,ht)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 212:return r.next=214,this.getChannel(Te.channelUrl,!0);case 214:return dt=r.sent,pt=Te.category===wu.TYPING_START,ft=n.as(pt?Uc:Rc),vt=ft.user,dt._updateTypingStatus(vt,pt?Te.ts:0),this._dispatcher.dispatch(new Vu({channels:[dt],source:e.GroupChannelEventSource.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated(dt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 221:return r.next=223,this.getChannel(Te.channelUrl,!0);case 223:_t=r.sent,mt=Te.category===wu.USER_CHANNEL_MUTE,gt=n.as(mt?Oo:Do),(yt=gt.user).userId===this._sdkState.userId&&(_t.myMutedState=mt?e.MutedState.MUTED:e.MutedState.UNMUTED),kt=E(_t.members),r.prev=228,kt.s();case 230:if((Et=kt.n()).done){r.next=237;break}if((bt=Et.value).userId!==yt.userId){r.next=235;break}return bt.isMuted=mt,r.abrupt("break",237);case 235:r.next=230;break;case 237:r.next=242;break;case 239:r.prev=239,r.t5=r.catch(228),kt.e(r.t5);case 242:return r.prev=242,kt.f(),r.finish(242);case 245:return this._dispatcher.dispatch(new Vu({channels:[_t],source:mt?e.GroupChannelEventSource.EVENT_CHANNEL_MUTED:e.GroupChannelEventSource.EVENT_CHANNEL_UNMUTED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){mt?e.onUserMuted(_t,yt):e.onUserUnmuted(_t,yt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 248:if(!(wt=this._leftChannels.get(Te.channelUrl))){r.next=253;break}r.t6=wt.channel,r.next=256;break;case 253:return r.next=255,this.getChannel(Te.channelUrl,!0);case 255:r.t6=r.sent;case 256:return xt=r.t6,this._markAsLeave(xt),Ct=n.as(Po),Tt=Ct.user,je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserBanned(xt,Tt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 261:return r.next=263,this.getChannel(Te.channelUrl,!0);case 263:return It=r.sent,St=n.as(Go),Nt=St.user,je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned(It,Nt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 267:return r.next=269,this.getChannel(Te.channelUrl,!0);case 269:return Mt=r.sent,Ut=n.as(Ho),Ot=Ut.freeze,Mt.isFrozen=Ot,this._dispatcher.dispatch(new Vu({channels:[Mt],source:Ot?e.GroupChannelEventSource.EVENT_CHANNEL_FROZEN:e.GroupChannelEventSource.EVENT_CHANNEL_UNFROZEN})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Ot?e.onChannelFrozen(Mt):e.onChannelUnfrozen(Mt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 275:return r.next=277,this.getChannel(Te.channelUrl,!0);case 277:return Rt=r.sent,Dt=n.as(Mc),Lt=Dt.allowAutoUnhide,Pt=Dt.hidePreviousMessages,Ft=Dt.messageOffsetTimestamp,null!==Lt&&(Rt.hiddenState=Lt?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),null!==Pt&&Pt&&Rt._updateUnreadCount(0,0),null!==Ft&&(Rt.messageOffsetTimestamp=Ft),this._dispatcher.dispatch(new Vu({channels:[Rt],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelHidden(Rt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 285:return r.next=287,this.getChannel(Te.channelUrl,!0);case 287:return(Gt=r.sent).hiddenState=e.HiddenState.UNHIDDEN,this._dispatcher.dispatch(new Vu({channels:[Gt],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Gt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 292:return r.next=294,this.getChannel(Te.channelUrl,!0);case 294:return qt=r.sent,this._dispatcher.dispatch(new Qu({channelUrls:[Te.channelUrl],source:e.GroupChannelEventSource.EVENT_CHANNEL_DELETED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted(qt.url,qt.channelType)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 298:return r.next=300,this.getChannelWithoutCache(Te.channelUrl,!0);case 300:return Ht=r.sent,this._dispatcher.dispatch(new Vu({channels:[Ht],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onChannelChanged(Ht)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 304:return r.next=306,this.getChannel(Te.channelUrl,!0);case 306:return jt=r.sent,Vt=n.as(go),Qt=Vt.created,Bt=Vt.updated,Kt=Vt.deleted,Qt&&jt._upsertCachedMetaData(Qt,Te.ts),Bt&&jt._upsertCachedMetaData(Bt,Te.ts),Kt&&jt._removeFromCachedMetaData(Kt,Te.ts),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Qt&&e.onMetaDataCreated(jt,Qt),Bt&&e.onMetaDataUpdated(jt,Bt),Kt&&e.onMetaDataDeleted(jt,Kt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 313:return r.next=315,this.getChannel(Te.channelUrl,!0);case 315:return zt=r.sent,Wt=n.as(No),Yt=Wt.created,Jt=Wt.updated,Xt=Wt.deleted,je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){Yt&&e.onMetaCounterCreated(zt,Yt),Jt&&e.onMetaCounterUpdated(zt,Jt),Xt&&e.onMetaCounterDeleted(zt,Xt)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",325);case 319:return r.next=321,this.getChannel(Te.channelUrl,!0);case 321:return Zt=r.sent,$t=n.as(Kc),en=$t.pinnedMessageIds,tn=$t.latestPinnedMessage,(nn=$t.ts)>Zt._pinnedMessagesUpdatedAt&&(Zt.pinnedMessageIds=en,Zt.lastPinnedMessage=tn,Zt._pinnedMessagesUpdatedAt=nn,this._dispatcher.dispatch(new Vu({channels:[Zt],source:e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._groupChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelChanged(Zt)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))})),je((function(){return b(pn,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated(Zt)}));case 1:case"end":return e.stop()}}),e,this)})))}))),r.abrupt("break",325);case 325:return r.abrupt("break",337);case 326:rn=n.as(Da),sn=rn.event,r.t7=sn.category,r.next=r.t7===_a.USER_BLOCK?330:r.t7===_a.USER_UNBLOCK?333:336;break;case 330:return on=Oa.getDataAsUserBlockEvent(this._iid,sn),un=on.blocker,cn=on.blockee,this._groupChannelCache.block(un.userId,cn.userId),r.abrupt("break",336);case 333:return ln=Oa.getDataAsUserBlockEvent(this._iid,sn),hn=ln.blocker,dn=ln.blockee,this._groupChannelCache.unblock(hn.userId,dn.userId),r.abrupt("break",336);case 336:return r.abrupt("break",337);case 337:r.next=343;break;case 339:if(r.prev=339,r.t8=r.catch(0),!I(r.t8)){r.next=343;break}throw r.t8;case 343:case"end":return r.stop()}}),r,this,[[0,339],[19,30,33,36],[114,127,130,133],[228,239,242,245]])})))}},{key:"_markAsLeave",value:function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)}},{key:"addHandler",value:function(e,t){this._groupChannelHandlers.set(e,t)}},{key:"removeHandler",value:function(e){this._groupChannelHandlers.delete(e)}},{key:"clearHandler",value:function(){this._groupChannelHandlers.clear()}},{key:"subscribeGroupChannelEvent",value:function(e,t){this._groupChannelBroadcast.subscribe(e,t)}},{key:"unsubscribeGroupChannelEvent",value:function(e){this._groupChannelBroadcast.unsubscribe(e)}},{key:"subscribeMessageEvent",value:function(e,t){this._messageBroadcast.subscribe(e,t)}},{key:"unsubscribeMessageEvent",value:function(e){this._messageBroadcast.unsubscribe(e)}},{key:"_updateJoinedMemberCount",value:function(t){t.joinedMemberCount=t.members.filter((function(t){return t.state===e.MemberState.JOINED})).length}},{key:"getChannel",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),t.prev=1,t.next=4,this.getChannelFromCache(e);case 4:if(!(a=t.sent)){t.next=7;break}return t.abrupt("return",a);case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:return t.next=13,this.getChannelWithoutCache(e,n);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),r,this,[[1,9]])})))}},{key:"getChannelWithoutCache",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",n)).throw(S.invalidParameters),s=new Yu({channelUrl:n,isInternalCall:r}),t.next=4,this._requestQueue.send(s);case 4:i=t.sent,o=i.as(Ju),u=o.channel,c=u.unreadMessageCount,l=u.unreadMentionCount,t.t0=u.myCountPreference,t.next=t.t0===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?10:t.t0===e.CountPreference.UNREAD_MENTION_COUNT_ONLY?12:t.t0===e.CountPreference.OFF?14:17;break;case 10:return l=0,t.abrupt("break",17);case 12:return c=0,t.abrupt("break",17);case 14:return c=0,l=0,t.abrupt("break",17);case 17:return u._updateUnreadCount(c,l),t.next=20,this.upsertChannelsToCache([u]);case 20:return t.abrupt("return",u);case 21:case"end":return t.stop()}}),a,this)})))}},{key:"refreshChannel",value:function(n){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.GroupChannelEventSource.REFRESH_CHANNEL;return b(this,void 0,void 0,t().mark((function s(){var i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=new Yu({channelUrl:n,isInternalCall:r}),t.next=4,this._requestQueue.send(i);case 4:o=t.sent,u=o.as(Ju),(c=u.channel).myMemberState===e.MemberState.NONE?this._dispatcher.dispatch(new Qu({channelUrls:[c.url],source:a})):this._dispatcher.dispatch(new Vu({channels:[c],source:a})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),t.t0.code!==w.NON_AUTHORIZED&&t.t0.code!==w.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new Qu({channelUrls:[n],source:a}));case 12:case"end":return t.stop()}}),s,this,[[0,9]])})))}},{key:"getMyGroupChannels",value:function(n,r,a){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.GroupChannelEventSource.REQUEST_CHANNEL;return b(this,void 0,void 0,t().mark((function e(){var i,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Xu(Object.assign(Object.assign({},r),{userId:this._sdkState.userId,token:n,limit:a})),e.next=3,this._requestQueue.send(i);case 3:return o=e.sent,u=o.as(Zu),c=u.channels,l=u.token,this._dispatcher.dispatch(new Vu({channels:c,source:s})),e.abrupt("return",{channels:c,token:l});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getMessageFromCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getMessagesFromCache",value:function(e,n,r,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Br;return b(this,void 0,void 0,t().mark((function i(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.fetch({channelUrl:e,token:n,limit:s,filter:a,backward:"next"===r});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),i,this)})))}},{key:"getPollMessagesFromCache",value:function(e,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Br;return b(this,void 0,void 0,t().mark((function s(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.fetch({channelUrl:e,token:n,limit:a,filter:r,backward:!1,isPollOnly:!0});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),s,this)})))}},{key:"getUnsentMessagesFromCache",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._unsentMessageCache.fetch({channelUrl:e,filter:n});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),r,this)})))}},{key:"removeFailedMessageFromCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._unsentMessageCache.remove([e]);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"getCachedMessageCountBetween",value:function(e,n,r,a){return b(this,void 0,void 0,t().mark((function s(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._messageCache.countBetween(e,n,new Bc({top:r,bottom:a}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),s,this)})))}},{key:"getMyGroupChannelChangeLogs",value:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.GroupChannelEventSource.REQUEST_CHANNEL_CHANGELOGS;return b(this,void 0,void 0,t().mark((function e(){var s,i,o,u,c,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object.assign(Object.assign({},Mu),r),pt((U("string",n)||U("number",n))&&Au(s)).throw(S.invalidParameters),i=new zu(X({userId:this._sdkState.userId,ts:"number"==typeof n?n:null,token:"string"==typeof n?n:null,filter:s})),e.next=5,this._requestQueue.send(i);case 5:return o=e.sent,u=o.as(Wu),c=u.updatedChannels,l=u.deletedChannelUrls,c.length>0&&this._dispatcher.dispatch(new Vu({channels:c,source:a})),l.length>0&&this._dispatcher.dispatch(new Qu({channelUrls:l,source:a})),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"getGroupChannelCount",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Uu),e),pt(Ou(r)).throw(S.invalidParameters),a=new $u({userId:this._sdkState.userId,filter:r}),t.next=5,this._requestQueue.send(a);case 5:return s=t.sent,i=s.as(ec),o=i.groupChannelCount,t.abrupt("return",o);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getUnreadItemCount",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Du),e),pt(Lu(r)).throw(S.invalidParameters),a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new tc({userId:s.userId,filter:r}),t.next=6,i.send(o);case 6:return u=t.sent,t.abrupt("return",u.as(nc));case 8:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalUnreadChannelCount",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new rc({userId:r.userId}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(ac),u=o.unreadCount,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getTotalUnreadMessageCount",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Pu),e),pt(Fu(r)).throw(S.invalidParameters),a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new sc({userId:s.userId,filter:r}),t.next=6,i.send(o);case 6:return u=t.sent,c=u.as(ic),l=c.unreadCount,t.abrupt("return",l);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalScheduledMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Gu),e),pt(qu(r)).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new oc(r),t.next=6,s.send(i);case 6:return o=t.sent,u=o.as(uc),c=u.count,t.abrupt("return",c);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=At.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=0,t=At.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){var t;return null!==(t=At.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0}},{key:"createChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Su),e),pt(Nu(r)).throw(S.invalidParameters),r.isPublic||(r.accessCode=null),a=new lc(Object.assign({userId:this._sdkState.userId},r)),t.next=6,this._requestQueue.send(a);case 6:return s=t.sent,i=s.as(hc),o=i.channel,t.next=10,this.upsertChannelsToCache([o]);case 10:return t.abrupt("return",o);case 11:case"end":return t.stop()}}),n,this)})))}},{key:"markAsReadAll",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),pt(n-this._markAsReadAllLastSentAt>=1e3).throw(S.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=n,r=new dc({userId:this._sdkState.userId}),e.next=6,this._requestQueue.send(r);case 6:a=this._groupChannelCache.channels,s=E(a);try{for(s.s();!(i=s.n()).done;)(o=i.value)._updateUnreadMemberState(this._sdkState.userId,n),o._updateUnreadCount(0,0)}catch(e){s.e(e)}finally{s.f()}if(!(a.length>0)){e.next=12;break}return e.next=12,this.upsertChannelsToCache(a);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"markAsReadWithChannelUrls",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Date.now(),pt(D("string",e)&&r-this._markAsReadAllLastSentAt>=1e3).throw(S.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=r,a=new dc({userId:this._sdkState.userId,channelUrls:e}),t.next=6,this._requestQueue.send(a);case 6:s=this._groupChannelCache.channels,i=[],o=E(s);try{for(o.s();!(u=o.n()).done;)c=u.value,e.includes(c.url)&&(c._updateUnreadMemberState(this._sdkState.userId,r),c._updateUnreadCount(0,0),i.push(c))}catch(e){o.e(e)}finally{o.f()}if(!(i.length>0)){t.next=13;break}return t.next=13,this.upsertChannelsToCache(i);case 13:case"end":return t.stop()}}),n,this)})))}},{key:"markAsDelivered",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChannel(e);case 2:return r=t.sent,t.next=5,r.markAsDelivered();case 5:case"end":return t.stop()}}),n,this)})))}}],[{key:"of",value:function(e){return zc[e]}},{key:"clear",value:function(e){zc[e]&&delete zc[e]}}]),n}();!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}(Hu||(Hu={}));var Yc=function(e){i(a,e);var n=f(a);function a(e,t){var s;return r(this,a),(s=n.call(this))._worker=null,s._state=Hu.IDLE,s._semaphore=null,s._retryCount=0,s._retryLimit=3,s.priority=0,s._worker=t,s}return s(a,[{key:"isIdle",get:function(){return this._state===Hu.IDLE}},{key:"isRunning",get:function(){return this._state===Hu.RUNNING}},{key:"isDone",get:function(){return this._state===Hu.END}},{key:"retryCount",get:function(){return this._retryCount}},{key:"retryLimit",get:function(){return this._retryLimit}},{key:"_run",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRunning){t.next=14;break}return t.prev=1,t.next=4,this._worker(e);case 4:r=t.sent,this._retryCount=0,this.dispatch("progress",r),r.hasNext?this._run(r.nextToken):this.end(),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),this.dispatch("error",t.t0),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop();case 14:case"end":return t.stop()}}),n,this,[[1,10]])})))}},{key:"start",value:function(e){this.isIdle&&(this._state=Hu.RUNNING,this._run(e))}},{key:"stop",value:function(){this._state=Hu.IDLE,this.dispatch("stop")}},{key:"end",value:function(){this._state=Hu.END,this.dispatch("end")}}]),a}(W),Jc=s((function e(t){r(this,e),this.source=t})),Xc=s((function e(t){r(this,e),this.source=t})),Zc={},$c=function(){function n(a){var s=this,i=a._iid,o=a.channel,u=a.limit,c=void 0===u?100:u;r(this,n),this._prevSync=null,this._nextSync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=i,this._channel=o,this._limit=c;var l,h,d=At.of(this._iid),p=d.sdkState,f=d.dispatcher,v=d.logger;this._metadataKey=(l=p.userId,h=o.url,"sendbird:".concat(l,"@groupchannel/").concat(h,"/message/sync.meta"));var _=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(p.userId,o.url);this._prevSync=new Yc(_,(function(n){return b(s,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:if(v.debug("message background prev sync from",null===(a=this._metadata)||void 0===a?void 0:a.range.top),this._metadata.previousComplete){t.next=28;break}return t.prev=5,u=Xn.of(this._iid),t.next=9,u.getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(i=null===(s=this._metadata.range)||void 0===s?void 0:s.top)&&void 0!==i?i:n,{prevResultSize:this._limit,nextResultSize:0,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.MessageEventSource.SYNC_MESSAGE_BACKGROUND);case 9:return c=t.sent,this.extendRange(c),o.hasNext=c.length>=this._limit,o.nextToken=this._metadata.range.top,this._metadata.previousComplete=!o.hasNext,v.debug("message background prev sync progress",o),t.next=17,this.saveMetadata();case 17:t.next=26;break;case 19:if(t.prev=19,t.t0=t.catch(5),v.debug("message background prev sync error",t.t0),!(t.t0 instanceof S&&t.t0.isInvalidTokenError)){t.next=25;break}return t.next=25,this.clearMetadata();case 25:throw t.t0;case 26:t.next=29;break;case 28:o.hasNext=!1;case 29:return t.abrupt("return",o);case 30:case"end":return t.stop()}}),r,this,[[5,19]])})))})),this._nextSync=new Yc(_,(function(n){return b(s,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return v.debug("message background next sync from",null===(a=this._metadata)||void 0===a?void 0:a.range.bottom),t.prev=4,u=Xn.of(this._iid),t.next=8,u.getMessagesByTimestamp(this._channel.url,this._channel.channelType,null!==(i=null===(s=this._metadata.range)||void 0===s?void 0:s.bottom)&&void 0!==i?i:n,{prevResultSize:0,nextResultSize:this._limit,replyType:e.ReplyType.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},e.MessageEventSource.SYNC_MESSAGE_BACKGROUND);case 8:return c=t.sent,this.extendRange(c),o.hasNext=c.length>=this._limit,o.nextToken=this._metadata.range.bottom,v.debug("message background next sync progress",o),t.next=15,this.saveMetadata();case 15:t.next=21;break;case 17:throw t.prev=17,t.t0=t.catch(4),v.debug("message background next sync error",t.t0),t.t0;case 21:return t.abrupt("return",o);case 22:case"end":return t.stop()}}),r,this,[[4,17]])})))})),this._connectionEventContext=f.on((function(e){if(e instanceof _e)if(e.stateType===ce.CONNECTED)s.resume();else s.pause()}))}return s(n,[{key:"range",get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range}},{key:"previousComplete",get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)}},{key:"isWrappingMessages",value:function(e){var t,n;return null===(n=this.range)||void 0===n?void 0:(t=n).includes.apply(t,g(e.map((function(e){return e.createdAt}))))}},{key:"extendRange",value:function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,g(e.map((function(e){return e.createdAt}))))}},{key:"loadMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata={range:new Bc(a?a.range:{top:Number.MAX_SAFE_INTEGER,bottom:Number.MAX_SAFE_INTEGER}),previousComplete:!!a&&a.previousComplete};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e,t,n,r,a=At.of(this._iid),s=a.logger;a.connectionManager.isConnected&&(s.debug("message background sync resume()"),this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range.top)&&void 0!==t?t:Date.now()),this._nextSync.start(null!==(r=null===(n=this._metadata)||void 0===n?void 0:n.range.bottom)&&void 0!==r?r:Date.now()))}},{key:"pause",value:function(){At.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Zc[this._iid][this._channel.url])}}],[{key:"of",value:function(e,t){return Zc[e]||(Zc[e]={}),Zc[e][t.url]||(Zc[e][t.url]=new n({_iid:e,channel:t})),Zc[e][t.url].ref++,Zc[e][t.url]}},{key:"clear",value:function(e,t){Zc[e]&&Zc[e][t]&&(Zc[e][t].close(),delete Zc[e])}}]),n}(),el={},tl=function(){function n(a){var s=this,i=a._iid,o=a.channel;r(this,n),this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=i,this._channel=o;var u,c,l=At.of(this._iid),h=l.logger,d=l.sdkState,p=l.dispatcher;this._metadataKey=(u=d.userId,c=o.url,"sendbird:".concat(u,"@groupchannel/").concat(c,"/message/changelogs.meta"));var f=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(d.userId,this._channel.url);this._sync=new Yc(f,(function(){return b(s,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return h.debug("message changelog sync from",null===(r=this._metadata)||void 0===r?void 0:r.token),t.prev=4,s=Xn.of(this._iid),t.next=8,s.getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:e.ReplyType.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS);case 8:return i=t.sent,o=i.updatedMessages,u=i.deletedMessageIds,c=i.hasMore,l=i.token,a.hasNext=c,a.nextToken=l,(o.length>0||u.length>0)&&(this._metadata.token=l),h.debug("message changelog sync progress",a),t.next=19,this.saveMetadata();case 19:t.next=28;break;case 21:if(t.prev=21,t.t0=t.catch(4),h.debug("message changelog sync error",t.t0),!(t.t0 instanceof S&&t.t0.isInvalidTokenError)){t.next=27;break}return t.next=27,this.clearMetadata();case 27:throw t.t0;case 28:return t.abrupt("return",a);case 29:case"end":return t.stop()}}),n,this,[[4,21]])})))})),this._connectionEventContext=p.on((function(e){if(e instanceof _e)if(e.stateType===ce.CONNECTED)s.resume();else s.pause()}))}return s(n,[{key:"loadMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=At.of(this._iid),r=n.cacheContext,a=n.firstConnectedAt,e.next=4,r.preference.get(this._metadataKey);case 4:s=e.sent,this._metadata={token:s?s.token:a};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e=At.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync resume()"),this._sync.start(0))}},{key:"pause",value:function(){var e=At.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync pause()"),this._sync.stop())}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete el[this._iid][this._channel.url])}}],[{key:"of",value:function(e,t){return el[e]||(el[e]={}),el[e][t.url]||(el[e][t.url]=new n({_iid:e,channel:t})),el[e][t.url].ref++,el[e][t.url]}},{key:"clear",value:function(e,t){el[e]&&el[e][t]&&(el[e][t].close(),delete el[e])}}]),n}(),nl=function(e){i(n,e);var t=f(n);function n(e){var a,s,i,o,u,c,l;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(kn(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),a.params=X({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(s=e.threshold)&&void 0!==s?s:null,reverse:!0,custom_types:null!==(i=e.customTypes)&&void 0!==i?i:["*"],message_type:null!==(o=e.messageType)&&void 0!==o?o:null,include_reactions:null===(u=e.includeReactions)||void 0===u||u,with_sorted_meta_array:null===(c=e.includeMetaArray)||void 0===c||c,show_subchannel_messages_only:null!==(l=e.showSubchannelMessagesOnly)&&void 0!==l&&l,include_poll_details:!0}),a}return s(n)}($),rl=function(e){i(n,e);var t=f(n);function n(e,a){var s,i,o,u,c;return r(this,n),(s=t.call(this,e,a)).isHugeGap=a.is_huge_gap,s.prevMessages=(null!==(i=a.prev_messages)&&void 0!==i?i:[]).map((function(t){return gn(e,t)})),s.prevHasMore=null!==(o=a.prev_hasmore)&&void 0!==o&&o,s.nextMessages=(null!==(u=a.next_messages)&&void 0!==u?u:[]).map((function(t){return gn(e,t)})),s.nextHasmore=null!==(c=a.next_hasmore)&&void 0!==c&&c,s}return s(n)}(ee),al=function(t,n){var r,a;switch(n){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return null!==(a=null===(r=t.lastMessage)||void 0===r?void 0:r.createdAt)&&void 0!==a?a:t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return t.name}return null},sl=function(e,t){return e.findIndex((function(e){return e.isIdentical(t)}))},il=function(e,t,n){if(e.length>0){var r=sl(e,t);if(r<0){for(var a=0,s=e.length-1,i=Math.floor((a+s)/2);a<s;){var o=ol(e[i],t,n);if(o>0)s=i,i=Math.floor((a+s)/2);else{if(!(o<0))return{place:i,contains:e[i].isIdentical(t)};a=i+1,i=Math.floor((a+s)/2)}}return{place:ol(e[i],t,n)>0?i:i+1,contains:!1}}return{place:r,contains:!0}}return{place:e.length,contains:!1}},ol=function(t,n,r){switch(r){case e.GroupChannelListOrder.LATEST_LAST_MESSAGE:return t.lastMessage&&n.lastMessage?n.lastMessage.createdAt-t.lastMessage.createdAt:t.lastMessage?-1:n.lastMessage?1:n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHRONOLOGICAL:return n.createdAt-t.createdAt;case e.GroupChannelListOrder.CHANNEL_NAME_ALPHABETICAL:return t.name.localeCompare(n.name)}},ul=function(e,t){return t instanceof an?e.findIndex((function(e){return e instanceof an&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},cl=function(e,t){return e.findIndex((function(e){return e.messageId===t}))},ll=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,a=Math.floor((n+r)/2);n<r;){var s=e[a].createdAt-t.createdAt;if(s>0)r=a,a=Math.floor((n+r)/2);else{if(!(s<0))return a;n=a+1,a=Math.floor((n+r)/2)}}return e[a].createdAt>t.createdAt?a:a+1}return e.length},hl={},dl=function(){function e(n){var a=this,s=n._iid,i=n.channel,o=n.hasPollMessage;r(this,e),this._sync=null,this.ref=0,this._metadata=null,this._iid=s,this._channel=i;var u,c,l=At.of(this._iid),h=l.logger,d=l.sdkState,p=l.dispatcher;this._metadataKey=(u=d.userId,c=i.url,"sendbird:".concat(u,"@groupchannel/").concat(c,"/poll/changelogs.meta"));var f=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(d.userId,this._channel.url);this._sync=new Yc(f,(function(){return b(a,void 0,void 0,t().mark((function e(){var n,r,a,s,i,u,c,l,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={hasNext:!0,nextToken:0},e.next=3,this.loadMetadata();case 3:if(h.debug("poll changelog sync from",null===(n=this._metadata)||void 0===n?void 0:n.token),e.t0=!this._metadata||!this._metadata.token,!e.t0){e.next=9;break}return e.next=8,o();case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=12;break}return a={hasNext:!1,nextToken:0},e.abrupt("return",a);case 12:return this._metadata||(s=At.of(this._iid),i=s.firstConnectedAt,this._metadata={token:i}),e.prev=13,u=Nr.of(this._iid),e.next=17,u.getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token);case 17:return c=e.sent,l=c.hasMore,d=c.token,r.hasNext=l,r.nextToken=d,this._metadata.token=d,h.debug("poll changelog sync progress",r),e.next=26,this.saveMetadata();case 26:e.next=35;break;case 28:if(e.prev=28,e.t1=e.catch(13),h.debug("poll changelog sync error",e.t1),!(e.t1 instanceof S&&e.t1.isInvalidTokenError)){e.next=34;break}return e.next=34,this.clearMetadata();case 34:throw e.t1;case 35:return e.abrupt("return",r);case 36:case"end":return e.stop()}}),e,this,[[13,28]])})))})),this._connectionEventContext=p.on((function(e){if(e instanceof _e)if(e.stateType===ce.CONNECTED)a.resume();else a.pause()}))}return s(e,[{key:"loadMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata=a?{token:a.token}:null;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=4;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){At.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)}},{key:"pause",value:function(){At.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete hl[this._iid][this._channel.url])}}],[{key:"of",value:function(t,n,r){return hl[t]||(hl[t]={}),hl[t][n.url]||(hl[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r})),hl[t][n.url].ref++,hl[t][n.url]}}]),e}(),pl=6e5;e.MessageCollectionInitPolicy=void 0,(e.MessageCollectionInitPolicy||(e.MessageCollectionInitPolicy={})).CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api";var fl,vl,_l,ml=function(){function e(){r(this,e)}return s(e,[{key:"_invokeResponse",value:function(e,n,r){var a=this;je((function(){return b(a,void 0,void 0,t().mark((function a(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="local"===t.t0?3:"remote"===t.t0?5:7;break;case 3:return this._onCacheResult(n,r),t.abrupt("break",7);case 5:return this._onApiResult(n,r),t.abrupt("break",7);case 7:case"end":return t.stop()}}),a,this)})))}))}},{key:"onCacheResult",value:function(e){return this._onCacheResult=e,this}},{key:"onApiResult",value:function(e){return this._onApiResult=e,this}}]),e}(),gl=function(){function n(a,s){var i=this,o=s.channel,u=s.filter,c=s.startingPoint,l=s.limit;r(this,n),this._channel=null,this._messages=[],this._unsentMessages=[],this._backgroundSync=null,this._changelogSync=null,this._pollChangelogSync=null,this._iid=a,this._key="mc-".concat(K()),this.filter=null!=u?u:new Yr,this._channel=o,this._syncRange=new Bc({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof c?c:Date.now()+pl,this._limit=l||Br;var h=Wc.of(this._iid);h.subscribeGroupChannelEvent(this._key,{onUpdate:function(n,r){var a=sl(n,i._channel);if(a>=0&&(je((function(){return b(i,void 0,void 0,t().mark((function e(){var s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new Jc(r),this._channel=n[a],(null===(s=this._handler)||void 0===s?void 0:s.onChannelUpdated)&&this._handler.onChannelUpdated(i,this.channel);case 3:case"end":return e.stop()}}),e,this)})))})),r===e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED)){var s=!1;for(var o in i._messages){if(i._messages[o].createdAt>=i._channel.messageOffsetTimestamp){s=!0;var u=parseInt(o);if(u>0){var c=i._messages.splice(0,u);i._removeMessagesFromView(c.map((function(e){return e.messageId})),e.MessageEventSource.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!s&&i._messages.length>0&&i._removeMessagesFromView(i._messages.map((function(e){return e.messageId})),e.MessageEventSource.EVENT_MESSAGE_OFFSET_UPDATED)}},onRemove:function(e,n){e.indexOf(i.channel.url)>=0&&je((function(){return b(i,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Jc(n),(null===(r=this._handler)||void 0===r?void 0:r.onChannelDeleted)&&this._handler.onChannelDeleted(a,this.channel.url);case 2:case"end":return e.stop()}}),e,this)})))}))}}),h.subscribeMessageEvent(this._key,{onUpdate:function(t,n){var r,a=[],s=[],o=E(t);try{for(o.s();!(r=o.n()).done;){var u=r.value;u.channelUrl===i._channel.url&&(i.filter.match(u)?a.push(u):s.push(u.messageId))}}catch(e){o.e(e)}finally{o.f()}if(Dn(n)){if(a.length>0)switch(n){case e.MessageEventSource.EVENT_MESSAGE_SENT_FAILED:case e.MessageEventSource.EVENT_MESSAGE_SENT_SUCCESS:case e.MessageEventSource.EVENT_MESSAGE_UPDATED:case e.MessageEventSource.EVENT_MESSAGE_THREADINFO_UPDATED:case e.MessageEventSource.EVENT_MESSAGE_REACTION_UPDATED:case e.MessageEventSource.SYNC_MESSAGE_CHANGELOGS:i._updateMessagesToView(a,n);break;case e.MessageEventSource.EVENT_MESSAGE_SENT_PENDING:i._addMessagesToView(a,n);break;case e.MessageEventSource.EVENT_MESSAGE_RECEIVED:i.hasNext||i._addMessagesToView(a,n);break;case e.MessageEventSource.SYNC_MESSAGE_FILL:i._addMessagesToView(a,n)}s.length>0&&i._removeMessagesFromView(s,n)}},onRemove:function(e,t){i._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){i._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){i._updatePollsToView(e,t)},onPollUpdate:function(e,t){i._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){i._applyPollVoteEventToView(e,t)}});var d=At.of(this._iid).cacheContext;!this._channel.isSuper&&d.localCacheEnabled&&(this._backgroundSync=$c.of(this._iid,this._channel),this._backgroundSync.resume()),this._changelogSync=tl.of(this._iid,this._channel),this._changelogSync.resume(),this._pollChangelogSync=dl.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new Yc(this._key,(function(n){return b(i,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRemoteMessages(n,{prevLimit:this._limit,source:e.MessageEventSource.SYNC_MESSAGE_FILL});case 2:if(!((a=t.sent).length>0)){t.next=7;break}return s=Math.min.apply(Math,g(a.map((function(e){return e.createdAt})))),this._syncRange.extends(s),t.abrupt("return",{hasNext:a.length>=this._limit&&this.viewTop<s,nextToken:this._syncRange.top});case 7:return t.abrupt("return",{hasNext:!1,nextToken:0});case 8:case"end":return t.stop()}}),r,this)})))})),this._nextFill=new Yc(this._key,(function(n){return b(i,void 0,void 0,t().mark((function r(){var a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getRemoteMessages(n,{nextLimit:this._limit,source:e.MessageEventSource.SYNC_MESSAGE_FILL});case 2:if(!((a=t.sent).length>0)){t.next=7;break}return s=Math.max.apply(Math,g(a.map((function(e){return e.createdAt})))),this._syncRange.extends(s),t.abrupt("return",{hasNext:!(a.length>=this._limit&&this._hasNext)||this.viewBottom>s,nextToken:this._syncRange.bottom});case 7:return t.abrupt("return",{hasNext:!1,nextToken:0});case 8:case"end":return t.stop()}}),r,this)})))}));var p=At.of(this._iid),f=p.dispatcher,v=p.logger;this._connectionEventContext=f.on((function(t){if(t instanceof _e)if(t.stateType===ce.CONNECTED)i._refreshChannel(e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS),v.debug("check huge gap"),i._checkHugeGap();else i._prevFill.stop(),i._nextFill.stop()}))}return s(n,[{key:"channel",get:function(){return this._channel}},{key:"succeededMessages",get:function(){return g(this._messages)}},{key:"failedMessages",get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.FAILED}))}},{key:"pendingMessages",get:function(){return this._unsentMessages.filter((function(t){return t.sendingStatus===e.SendingStatus.PENDING}))}},{key:"hasPrevious",get:function(){return this._hasPrevious}},{key:"hasNext",get:function(){return this._hasNext}},{key:"viewTop",get:function(){return Math.min.apply(Math,g(this._messages.map((function(e){return e.createdAt}))).concat([Number.MAX_SAFE_INTEGER]))}},{key:"viewBottom",get:function(){return Math.max.apply(Math,g(this._messages.map((function(e){return e.createdAt}))).concat([0]))}},{key:"setMessageCollectionHandler",value:function(e){this._handler=e}},{key:"_filterUnderOffsetMessage",value:function(e){return e}},{key:"_addMessagesToView",value:function(n,r){var a,s=this,i=this._filterUnderOffsetMessage(n),o=[],u=[],c=E(i);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(r===e.MessageEventSource.SYNC_MESSAGE_FILL){if(l.messageId>0){if(ul(this._messages,l)<0){ul(this._unsentMessages,l)<0&&o.push(l);var h=ll(this._messages,l);this._messages.splice(h,0,l)}}else if(l instanceof an){ul(this._unsentMessages,l)<0&&ul(this._messages,l)<0&&(this._unsentMessages.push(l),o.push(l))}}else if(l.messageId>0){var d=ul(this._messages,l);if(d<0){var p=ul(this._unsentMessages,l);p<0?o.push(l):(this._unsentMessages.splice(p,1),u.push(l));var f=ll(this._messages,l);this._messages.splice(f,0,l)}else u.push(l),this._messages[d]=l;if(l.updatedAt>0){var v=this._updateChildMessagesInView(l);u.push.apply(u,g(v))}}else if(l instanceof an){var _=ul(this._unsentMessages,l);_<0?ul(this._messages,l)<0&&(this._unsentMessages.push(l),o.push(l)):(u.push(l),this._unsentMessages[_]=l)}}}catch(e){c.e(e)}finally{c.f()}Dn(r)&&je((function(){return b(s,void 0,void 0,t().mark((function e(){var n,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new Xc(r),o.length>0&&(null===(n=this._handler)||void 0===n||n.onMessagesAdded(s,this.channel,o)),u.length>0&&(null===(a=this._handler)||void 0===a||a.onMessagesUpdated(s,this.channel,u));case 3:case"end":return e.stop()}}),e,this)})))}))}},{key:"_updateChildMessagesInView",value:function(e){var t=[];return this._messages.forEach((function(n){n.applyParentMessage(e)&&t.push(n)})),t}},{key:"_updatePollsToView",value:function(e,n){var r,a=this,s=[],i=E(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,u=cl(this._messages,o.messageId);if(u>=0){var c=this._messages[u];c&&c.applyPoll(o),s.push(c)}}}catch(e){i.e(e)}finally{i.f()}return s.length>0&&Dn(n)&&je((function(){return b(a,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Xc(n),s.length>0&&(null===(r=this._handler)||void 0===r||r.onMessagesUpdated(a,this.channel,s));case 2:case"end":return e.stop()}}),e,this)})))})),s}},{key:"_applyPollUpdateEventToView",value:function(e,n){var r=this,a=cl(this._messages,e.messageId);if(a>=0){var s=this._messages[a];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollUpdateEvent(e)&&Dn(n)&&je((function(){return b(r,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Xc(n),null===(r=this._handler)||void 0===r||r.onMessagesUpdated(a,this.channel,[s]);case 2:case"end":return e.stop()}}),e,this)})))}))}}},{key:"_applyPollVoteEventToView",value:function(e,n){var r=this,a=cl(this._messages,e.messageId);if(a>=0){var s=this._messages[a];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollVoteEvent(e)&&Dn(n)&&je((function(){return b(r,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Xc(n),null===(r=this._handler)||void 0===r||r.onMessagesUpdated(a,this.channel,[s]);case 2:case"end":return e.stop()}}),e,this)})))}))}}},{key:"_updateMessagesToView",value:function(e,n){var r,a=this,s=[],i=[],o=E(e);try{for(o.s();!(r=o.n()).done;){var u=r.value;if(u.messageId>0){var c=ul(this._messages,u);if(c>=0)s.push(u),this._messages[c]=u;else{var l=ul(this._unsentMessages,u);if(l>=0){var h=this._unsentMessages.splice(l,1);if(this.hasNext&&h.length>0)i.push(h[0]);else{s.push(u);var d=ll(this._messages,u);this._messages.splice(d,0,u)}}}}else if(u instanceof an){var p=ul(this._unsentMessages,u);p>=0&&(s.push(u),this._unsentMessages[p]=u)}}}catch(e){o.e(e)}finally{o.f()}return Dn(n)&&je((function(){return b(a,void 0,void 0,t().mark((function e(){var r,a,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=new Xc(n),s.length>0?null===(r=this._handler)||void 0===r||r.onMessagesUpdated(o,this.channel,s):i.length>0&&(null===(a=this._handler)||void 0===a||a.onMessagesDeleted(o,this.channel,[],i));case 2:case"end":return e.stop()}}),e,this)})))})),s}},{key:"_removeMessagesFromView",value:function(e,n){var r,a=this,s=[],i=[],o=E(e);try{var u=function(){var e=r.value,t=a._messages.findIndex((function(t){return t.messageId===e}));if(t>=0){var n=a._messages[t];s.push(n.messageId),i.push(n),a._messages.splice(t,1)}};for(o.s();!(r=o.n()).done;)u()}catch(e){o.e(e)}finally{o.f()}return Dn(n)&&i.length>0&&je((function(){return b(a,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Xc(n),null===(r=this._handler)||void 0===r||r.onMessagesDeleted(a,this.channel,s,i);case 2:case"end":return e.stop()}}),e,this)})))})),s}},{key:"_removeUnsentMessageFromView",value:function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)}},{key:"_getLocalMessages",value:function(e,n){var r=n.prevLimit,a=void 0===r?0:r,s=n.nextLimit,i=void 0===s?0:s;return b(this,void 0,void 0,t().mark((function n(){var r,s,o,u,c;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Wc.of(this._iid),!(a>0)){n.next=7;break}return n.next=4,r.getMessagesFromCache(this._channel.url,e,"prev",this.filter,a);case 4:n.t0=n.sent,n.next=8;break;case 7:n.t0=[];case 8:if(s=n.t0,!(i>0)){n.next=15;break}return n.next=12,r.getMessagesFromCache(this._channel.url,e,"next",this.filter,i);case 12:n.t1=n.sent,n.next=16;break;case 15:n.t1=[];case 16:if(o=n.t1,!(s.length>0&&o.length>0)){n.next=27;break}u=s.map((function(e){return e.messageId})),n.t2=t().keys(o);case 20:if((n.t3=n.t2()).done){n.next=27;break}if(c=n.t3.value,!u.includes(o[c].messageId)){n.next=25;break}return o.splice(parseInt(c),1),n.abrupt("break",27);case 25:n.next=20;break;case 27:return n.abrupt("return",[].concat(g(s),g(o)).sort((function(e,t){return t.createdAt-e.createdAt})));case 28:case"end":return n.stop()}}),n,this)})))}},{key:"_getRemoteMessages",value:function(n,r){var a=r.prevLimit,s=void 0===a?0:a,i=r.nextLimit,o=void 0===i?0:i,u=r.source,c=void 0===u?e.MessageEventSource.REQUEST_MESSAGE:u,l=r.reverse,h=void 0!==l&&l;return b(this,void 0,void 0,t().mark((function e(){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Xn.of(this._iid),!(s>0||o>0)){e.next=7;break}return e.next=4,r.getMessagesByTimestamp(this._channel.url,this._channel.channelType,n,Object.assign(Object.assign({},this.filter),{isInclusive:!0,reverse:h,prevResultSize:s,nextResultSize:o,includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0}),c);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=[];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"_checkHugeGap",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d,p,f,v,_,m,y,k=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(this._messages.length>0)){n.next=16;break}return r=this.viewTop,a=this._syncRange.top,s=this._syncRange.bottom,i=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,o=Wc.of(this._iid),n.next=8,o.getCachedMessageCountBetween(this._channel.url,this.filter,r,a);case 8:return u=n.sent,n.next=11,o.getCachedMessageCountBetween(this._channel.url,this.filter,s,i);case 11:return c=n.sent,n.next=14,He((function(){return b(k,void 0,void 0,t().mark((function n(){var o,l,h,d,p,f,v,_,m,y,k,E,w,x,C,T,I,S=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=At.of(this._iid),l=o.dispatcher,h=o.requestQueue,d=new nl(Object.assign({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:r,prevEnd:a,prevCount:u,nextStart:s,nextEnd:i,nextCount:c},this.filter)),n.next=4,h.send(d);case 4:p=n.sent,f=p.as(rl),v=f.isHugeGap,_=f.prevMessages,m=void 0===_?[]:_,y=f.prevHasMore,k=f.nextMessages,E=void 0===k?[]:k,w=f.nextHasmore,v?je((function(){return b(S,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(n=this._handler)||void 0===n||n.onHugeGapDetected();case 1:case"end":return e.stop()}}),e,this)})))})):(this._hasPrevious=y,this._hasNext=w,x=this.viewTop,C=this.viewBottom,T=Math.min.apply(Math,[Number.MAX_SAFE_INTEGER,x].concat(g(m.map((function(e){return e.createdAt}))))),I=Math.max.apply(Math,[0,C].concat(g(E.map((function(e){return e.createdAt}))))),l.dispatch(new Ln({messages:m,source:e.MessageEventSource.SYNC_MESSAGE_FILL})),l.dispatch(new Ln({messages:E,source:e.MessageEventSource.SYNC_MESSAGE_FILL})),this._syncRange.extends(T,I),x<T&&this._prevFill.start(T),C>I&&this._nextFill.start(I));case 7:case"end":return n.stop()}}),n,this)})))}),1);case 14:n.next=22;break;case 16:return l=Math.floor(this._limit/2),h=Date.now(),n.next=20,this._getRemoteMessages(h,{prevLimit:l,nextLimit:l,source:e.MessageEventSource.SYNC_MESSAGE_FILL});case 20:if((d=n.sent).length>0){for(f=d.map((function(e){return e.createdAt})),v=0,_=0,m=0;m<f.length;m++)(y=f[m])<=h?v++:y>=h&&_++;this._hasPrevious=v>=l,this._hasNext=_>=l,(p=this._syncRange).extends.apply(p,g(d.map((function(e){return e.createdAt})))),this._addMessagesToView(d,e.MessageEventSource.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;case 22:case"end":return n.stop()}}),n,this)})))}},{key:"_loadUnsentMessages",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wc.of(this._iid),e.next=3,n.getUnsentMessagesFromCache(this._channel.url,this.filter);case 3:this._unsentMessages=e.sent;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_hasPollMessage",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wc.of(this._iid),e.next=3,n.getPollMessagesFromCache(this._channel.url,Date.now()+pl,this.filter,1);case 3:if(!(e.sent.length>0)){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"_refreshChannel",value:function(e){Wc.of(this._iid).refreshChannel(this.channel.url,!0,e)}},{key:"initialize",value:function(n){var r=this,a=new ml;this._messages=[],this._unsentMessages=[],this._syncRange=new Bc({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(e.GroupChannelEventSource.REFRESH_CHANNEL);var s=Math.floor(this._limit/2);if(n===e.MessageCollectionInitPolicy.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:s,nextLimit:s}).then((function(n){return b(r,void 0,void 0,t().mark((function r(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=this._filterUnderOffsetMessage(n),this._addMessagesToView(s,e.MessageEventSource.REQUEST_MESSAGE),t.next=4,this._loadUnsentMessages();case 4:a._invokeResponse("local",null,s);case 5:case"end":return t.stop()}}),r,this)})))})).catch((function(e){if(I(e))throw e;a._invokeResponse("local",e,null)})).finally((function(){r._getRemoteMessages(r._startingPoint,{prevLimit:s,nextLimit:s,reverse:!0}).then((function(t){r._messages=[];var n=r._filterUnderOffsetMessage(t);if(n.length>0){for(var i,o=n.map((function(e){return e.createdAt})),u=0,c=0,l=0;l<o.length;l++){var h=o[l];h<=r._startingPoint?u++:h>=r._startingPoint&&c++}r._hasPrevious=u>=s,r._hasNext=c>=s,(i=r._syncRange).extends.apply(i,g(n.map((function(e){return e.createdAt})))),r._addMessagesToView(n,e.MessageEventSource.REQUEST_MESSAGE)}else r._hasPrevious=!1,r._hasNext=!1;a._invokeResponse("remote",null,n)})).catch((function(e){if(I(e))throw e;a._invokeResponse("remote",e,null)}))}));return a}},{key:"loadPrevious",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._hasPrevious){n.next=14;break}return r=this.viewTop,a=[],n.next=5,Ve((function(){return b(i,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getLocalMessages(r,{prevLimit:this._limit});case 3:e.t1=e.sent,a=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})))}));case 5:if(0!==a.length&&this._backgroundSync&&this._backgroundSync.isWrappingMessages(a)){n.next=11;break}return n.next=8,Ve((function(){return b(i,void 0,void 0,t().mark((function e(){var n,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getRemoteMessages(r,{prevLimit:this._limit});case 3:e.t1=e.sent,a=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1),this._hasPrevious=a.length>=this._limit,a.length>0&&((i=this._syncRange).extends.apply(i,g(a.map((function(e){return e.createdAt})))),(null===(n=this._backgroundSync)||void 0===n?void 0:n.range.overlap(this._syncRange))&&(null===(s=this._backgroundSync)||void 0===s||s.range.extends(this._syncRange.top)));case 7:case"end":return e.stop()}}),e,this)})))}));case 8:this._addMessagesToView(a,e.MessageEventSource.REQUEST_MESSAGE),n.next=13;break;case 11:this._hasPrevious=a.length>=this._limit,a.length>0&&((s=this._syncRange).extends.apply(s,g(a.map((function(e){return e.createdAt})))),this._addMessagesToView(a,e.MessageEventSource.REQUEST_MESSAGE));case 13:return n.abrupt("return",a);case 14:return n.abrupt("return",[]);case 15:case"end":return n.stop()}}),n,this)})))}},{key:"loadNext",value:function(){var n;return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this._hasNext){r.next=2;break}return r.abrupt("return",[]);case 2:return a=this.viewBottom,s=[],r.next=6,Ve((function(){return b(o,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getLocalMessages(a,{nextLimit:this._limit});case 3:e.t1=e.sent,s=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})))}));case 6:if(0!==s.length&&(null===(n=this._backgroundSync)||void 0===n?void 0:n.isWrappingMessages(s))){r.next=12;break}return r.next=9,Ve((function(){return b(o,void 0,void 0,t().mark((function e(){var n,r,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._getRemoteMessages(a,{nextLimit:this._limit});case 3:e.t1=e.sent,s=e.t0._filterUnderOffsetMessage.call(e.t0,e.t1),this._hasNext=s.length>=this._limit,s.length>0&&((i=this._syncRange).extends.apply(i,g(s.map((function(e){return e.createdAt})))),(null===(n=this._backgroundSync)||void 0===n?void 0:n.range.overlap(this._syncRange))&&(null===(r=this._backgroundSync)||void 0===r||r.range.extends(this._syncRange.bottom)));case 7:case"end":return e.stop()}}),e,this)})))}));case 9:this._addMessagesToView(s,e.MessageEventSource.REQUEST_MESSAGE),r.next=14;break;case 12:this._hasNext=s.length>=this._limit,s.length>0&&((i=this._syncRange).extends.apply(i,g(s.map((function(e){return e.createdAt})))),this._addMessagesToView(s,e.MessageEventSource.REQUEST_MESSAGE));case 14:return r.abrupt("return",s);case 15:case"end":return r.stop()}}),r,this)})))}},{key:"removeFailedMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Wc.of(this._iid),t.next=3,r.removeFailedMessageFromCache(e);case 3:(a=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(a,1);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"dispose",value:function(){var e,t,n;At.of(this._iid).cacheContext.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close();var r=Wc.of(this._iid);r.unsubscribeGroupChannelEvent(this._key),r.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}}]),n}(),yl={coverUrl:null,coverImage:null,isDistinct:null,isPublic:null,isDiscoverable:null,accessCode:null,name:null,data:null,customType:null,operatorUserIds:null,messageSurvivalSeconds:null},kl=function(e){return U("string",e.coverUrl,!0)&&(P(e.coverImage)||U("string",e.coverImage)||null===e.coverImage)&&U("boolean",e.isDistinct,!0)&&U("boolean",e.isPublic,!0)&&U("boolean",e.isDiscoverable,!0)&&U("string",e.accessCode,!0)&&U("string",e.name,!0)&&U("string",e.data,!0)&&U("string",e.customType,!0)&&D("string",e.operatorUserIds,!0)&&U("number",e.messageSurvivalSeconds,!0)},El={hidePreviousMessages:!1,allowAutoUnhide:!0},bl=function(e){return U("boolean",e.hidePreviousMessages)&&U("boolean",e.allowAutoUnhide)},wl=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.token,o=e.limit,u=e.order,c=e.mutedMemberFilter,l=e.memberStateFilter,h=e.nicknameStartsWithFilter,d=e.operatorFilter;return(a=t.call(this)).method=T.GET,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/members"),a.params={token:i,limit:o,order:u,muted_member_filter:c,member_state_filter:l,nickname_startswith:h,operator_filter:d,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},a}return s(n)}($),xl=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.members=[];var i=a.next,o=a.members;return s.token=i,o&&o.length>0&&(s.members=o.map((function(t){return new Eu(e,t)}))),s}return s(n)}(ee);e.MutedMemberFilter=void 0,(fl=e.MutedMemberFilter||(e.MutedMemberFilter={})).ALL="all",fl.MUTED="muted",fl.UNMUTED="unmuted",e.MemberListOrder=void 0,(vl=e.MemberListOrder||(e.MemberListOrder={})).MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",vl.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical",e.MemberStateFilter=void 0,(_l=e.MemberStateFilter||(e.MemberStateFilter={})).ALL="all",_l.JOINED="joined_only",_l.INVITED="invited_only",_l.INVITED_BY_FRIEND="invited_by_friend",_l.INVITED_BY_NON_FRIEND="invited_by_non_friend";var Cl,Tl,Il,Sl=function(n){i(u,n);var a=f(u);function u(t,n,s){var i,o,c,l,h;return r(this,u),(i=a.call(this,t,n,e.ChannelType.GROUP,s)).mutedMemberFilter=e.MutedMemberFilter.ALL,i.memberStateFilter=e.MemberStateFilter.ALL,i.nicknameStartsWithFilter=null,i.operatorFilter=e.OperatorFilter.ALL,i.order=e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,i.mutedMemberFilter=null!==(o=s.mutedMemberFilter)&&void 0!==o?o:e.MutedMemberFilter.ALL,i.memberStateFilter=null!==(c=s.memberStateFilter)&&void 0!==c?c:e.MemberStateFilter.ALL,i.nicknameStartsWithFilter=null!==(l=s.nicknameStartsWithFilter)&&void 0!==l?l:null,i.order=null!==(h=s.order)&&void 0!==h?h:e.MemberListOrder.MEMBER_NICKNAME_ALPHABETICAL,i}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)&&O(e.MutedMemberFilter,this.mutedMemberFilter)&&O(e.MemberStateFilter,this.memberStateFilter)&&(U("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&O(e.OperatorFilter,this.operatorFilter)&&O(e.MemberListOrder,this.order)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new wl(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(xl),o=i.members,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(cr),Nl=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.userId,o=e.accessCode;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/accept"),a.params={user_id:i,access_code:o},a}return s(n)}($),Ml=function(t){i(a,t);var n=f(a);function a(t,s){var i;return r(this,a),(i=n.call(this,t,s)).channel=new ph(t,s),i.channel.myMemberState=e.MemberState.JOINED,i}return s(a)}(ee),Al=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.isDistinct,o=e.isPublic,u=e.isDiscoverable,c=e.coverUrl,l=e.coverImage,h=e.accessCode,d=e.name,p=e.data,f=e.customType,v=e.operatorUserIds,_=e.messageSurvivalSeconds;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s)),a.params=X({is_distinct:i,is_public:o,is_discoverable:u,name:d,data:p,custom_type:f,cover_url:c,cover_file:l,access_code:h,operator_ids:v,message_survival_seconds:_}),a}return s(n)}($),Ul=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=new ph(e,a),s}return s(n)}(ee),Ol=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl;return(a=t.call(this)).method=T.DELETE,a.path="".concat(we,"/").concat(encodeURIComponent(s)),a}return s(n)}($),Rl=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl;return(a=t.call(this)).method=T.DELETE,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/hide"),a}return s(n)}($),Dl=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.channelUrl,o=e.countPreference;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/count_preference/").concat(encodeURIComponent(i)),a.params={count_preference:o},a}return s(n)}($),Ll=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).countPreference=a.count_preference,s}return s(n)}(ee),Pl=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl;return(a=t.call(this)).method=T.PUT,a.path="".concat(we,"/").concat(encodeURIComponent(s),"/reset_user_history"),a}return s(n)}($),Fl=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).messageOffsetTimestamp=null;var i=a.ts_message_offset;return s.messageOffsetTimestamp=null!=i?i:null,s}return s(n)}(ee),Gl=Object.assign(Object.assign({},Bi),{scheduledAt:null,file:null,fileUrl:null,fileName:null,mimeType:null,fileSize:null,thumbnailSizes:null,requireAuth:!1}),ql=function(e){return Ki(e)&&U("number",e.scheduledAt,!0)&&(P(e.file)||U("string",e.fileUrl))&&U("string",e.fileName,!0)&&U("string",e.mimeType,!0)&&U("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return U("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Hl=Object.assign(Object.assign({},zi),{scheduledAt:null}),jl=function(e){return Wi(e)&&U("number",e.scheduledAt,!0)},Vl=function(t){i(a,t);var n=f(a);function a(t){var s,i;r(this,a),s=n.call(this);var o=null;t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl,l=t.scheduledMessageId;return s.method=T.PUT,s.path="".concat(kn(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),s.params=X({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Rt.FILE,url:t.fileUrl,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,thumbnails:t.thumbnailSizes?t.thumbnailSizes.map((function(e){return sn.payloadify(e)})):[],custom_type:t.customType,data:t.data,require_auth:t.requireAuth,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return Jt.payloadify(e)})),apple_critical_alert_options:$t.payloadify(t.appleCriticalAlertOptions),push_option:t.pushNotificationDeliveryOption}),s}return s(a)}($),Ql=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).message=new yn(e,a),s}return s(n)}(ee),Bl=function(t){i(a,t);var n=f(a);function a(t){var s,i;r(this,a),s=n.call(this);var o=null;t.mentionType===e.MentionType.USERS&&(t.mentionedUserIds?o=t.mentionedUserIds:t.mentionedUsers&&(o=t.mentionedUsers.map((function(e){return e.userId}))));var u=t.channelType,c=t.channelUrl,l=t.scheduledMessageId;return s.method=T.PUT,s.path="".concat(kn(u),"/").concat(encodeURIComponent(c),"/scheduled_messages/").concat(encodeURIComponent(l)),s.params=X({req_id:t.reqId,scheduled_at:t.scheduledAt,message_type:Rt.USER,message:t.message,custom_type:t.customType,data:t.data,mention_type:t.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=t.metaArrays)||void 0===i?void 0:i.map((function(e){return Jt.payloadify(e)})),apple_critical_alert_options:$t.payloadify(t.appleCriticalAlertOptions),target_langs:t.translationTargetLanguages,push_option:t.pushNotificationDeliveryOption}),s}return s(a)}($),Kl=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n),a=t.call(this);var s=e.channelType,i=e.channelUrl,o=e.scheduledMessageId;return a.method=T.DELETE,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(o)),a}return s(n)}($),zl=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n),a=t.call(this);var s=e.channelType,i=e.channelUrl,o=e.scheduledMessageId;return a.method=T.POST,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/scheduled_messages/").concat(encodeURIComponent(o),"/send_now"),a}return s(n)}($),Wl=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.channelUrl,o=e.pushTriggerOption;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference/").concat(encodeURIComponent(i)),a.params={push_trigger_option:o},a}return s(n)}($),Yl=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,s.enabled=a.enable,s}return s(n)}(ee),Jl=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.userId,i=e.channelUrl;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(Ee,"/").concat(encodeURIComponent(s),"/push_preference/").concat(encodeURIComponent(i)),a}return s(n)}($),Xl=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).pushTriggerOption=a.push_trigger_option,s.enabled=a.enable,s}return s(n)}(ee),Zl=function(e){return U("string",e.title,!0)&&pn(e.data)&&U("boolean",e.allowUserSuggestion,!0)&&U("boolean",e.allowMultipleVotes,!0)&&U("number",e.closeAt,!0)},$l=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.pollId,i=e.title,o=e.data,u=e.allowUserSuggestion,c=e.allowMultipleVotes,l=e.closeAt;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ae,"/").concat(encodeURIComponent(s)),a.params={title:i,data:o,allow_user_suggestion:u,allow_multiple_votes:c,close_at:l},a}return s(n)}($),eh=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).poll=new vn(e,a),s}return s(n)}(ee),th=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.pollId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ae,"/").concat(encodeURIComponent(s)),a}return s(n)}($),nh=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.pollId;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ae,"/").concat(encodeURIComponent(s),"/close"),a}return s(n)}($),rh=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).poll=new vn(e,a),s}return s(n)}(ee),ah=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.channelType,o=e.pollId,u=e.optionText;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(Ae,"/").concat(encodeURIComponent(o),"/options"),a.params={channel_url:s,channel_type:i,text:u},a}return s(n)}($),sh=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).poll=new vn(e,a),s}return s(n)}(ee),ih=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.pollId,i=e.pollOptionId,o=e.optionText;return r(this,n),(a=t.call(this)).method=T.PUT,a.path="".concat(Ae,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(i)),a.params={text:o},a}return s(n)}($),oh=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).poll=new vn(e,a),s}return s(n)}(ee),uh=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.pollId,i=e.pollOptionId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(Ae,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(i)),a}return s(n)}($),ch=function(t){i(a,t);var n=f(a);function a(t){var s=t.reqId,i=t.channelType,o=t.channelUrl,u=t.pollId,c=t.pollOptionIds;return r(this,a),n.call(this,{code:"VOTE",ackRequired:!0,payload:X({req_id:s,channel_type:i===e.ChannelType.OPEN?"open_channels":"group_channels",channel_url:o,poll_id:u,option_ids:c})})}return s(a)}(he),lh=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.messageId;return r(this,n),(a=t.call(this)).method=T.POST,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/").concat(o,"/pin"),a}return s(n)}($),hh=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelType,i=e.channelUrl,o=e.messageId;return r(this,n),(a=t.call(this)).method=T.DELETE,a.path="".concat(kn(s),"/").concat(encodeURIComponent(i),"/messages/").concat(o,"/pin"),a}return s(n)}($);e.CountPreference=void 0,(Cl=e.CountPreference||(e.CountPreference={})).ALL="all",Cl.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",Cl.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",Cl.OFF="off",e.MutedState=void 0,(Tl=e.MutedState||(e.MutedState={})).MUTED="muted",Tl.UNMUTED="unmuted",e.HiddenState=void 0,(Il=e.HiddenState||(e.HiddenState={})).UNHIDDEN="unhidden",Il.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",Il.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide";var dh,ph=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h,d,p,f,v,_,m,y,k,E,b,w,x,C,T;(r(this,u),(s=a.call(this,t,n))._unreadMemberStateMap=new Map,s._undeliveredMemberStateMap=new Map,s._typingStatus=new Map,s._lastMemberCountUpdated=0,s._typingStarted=0,s._typingEnded=0,s.isDistinct=!1,s.isSuper=!1,s.isBroadcast=!1,s.isExclusive=!1,s.isPublic=!1,s.isDiscoverable=!0,s.isAccessCodeRequired=!1,s.isPushEnabled=!1,s.unreadMessageCount=0,s.unreadMentionCount=0,s.members=[],s.memberCount=0,s.joinedMemberCount=0,s.hiddenState=e.HiddenState.UNHIDDEN,s.lastMessage=null,s.messageOffsetTimestamp=0,s.messageSurvivalSeconds=-1,s.myMemberState=e.MemberState.NONE,s.myRole=e.Role.NONE,s.myMutedState=e.MutedState.UNMUTED,s.myLastRead=0,s.myCountPreference=e.CountPreference.ALL,s.myPushTriggerOption=e.PushTriggerOption.DEFAULT,s.inviter=null,s.invitedAt=0,s.joinedAt=0,s.pinnedMessageIds=[],s.lastPinnedMessage=null,s._pinnedMessagesUpdatedAt=0,s.channelType=e.ChannelType.GROUP,s.isDistinct=null!==(i=n.is_distinct)&&void 0!==i&&i,s.isSuper=null!==(o=n.is_super)&&void 0!==o&&o,s.isBroadcast=null!==(c=n.is_broadcast)&&void 0!==c&&c,s.isExclusive=null!==(l=n.is_exclusive)&&void 0!==l&&l,s.isPublic=null!==(h=n.is_public)&&void 0!==h&&h,s.isDiscoverable=null!==(d=n.is_discoverable)&&void 0!==d?d:s.isPublic,s.isAccessCodeRequired=null!==(p=n.is_access_code_required)&&void 0!==p&&p,s.isPushEnabled=null!==(f=n.is_push_enabled)&&void 0!==f&&f,Array.isArray(n.members))&&(T=s.members).push.apply(T,g(n.members.map((function(e){return new Eu(s._iid,e)}))));return s.memberCount=null!==(v=n.member_count)&&void 0!==v?v:0,s.joinedMemberCount=null!==(_=n.joined_member_count)&&void 0!==_?_:0,s.hiddenState=O(e.HiddenState,n.hidden_state)?n.hidden_state:e.HiddenState.UNHIDDEN,s.messageOffsetTimestamp=null!==(m=n.ts_message_offset)&&void 0!==m?m:0,s.messageSurvivalSeconds=null!==(y=n.message_survival_seconds)&&void 0!==y?y:-1,s.lastMessage=n.last_message?gn(s._iid,Object.assign({channel_type:s.channelType},n.last_message)):null,n.read_receipt&&Object.keys(n.read_receipt).forEach((function(e){U("number",n.read_receipt[e])&&s._updateUnreadMemberState(e,n.read_receipt[e])})),n.delivery_receipt&&Object.keys(n.delivery_receipt).forEach((function(e){U("number",n.delivery_receipt[e])&&s._updateUndeliveredMemberState(e,n.delivery_receipt[e])})),s.myMemberState=O(e.MemberState,n.member_state)?n.member_state:e.MemberState.NONE,s.myRole=O(e.Role,n.my_role)?n.my_role:e.Role.NONE,O(e.MutedState,n.is_muted)?s.myMutedState=n.is_muted:U("boolean",n.is_muted)?s.myMutedState=n.is_muted?e.MutedState.MUTED:e.MutedState.UNMUTED:s.myMutedState=e.MutedState.UNMUTED,s.myCountPreference=O(e.CountPreference,n.count_preference)?n.count_preference:e.CountPreference.ALL,s.myPushTriggerOption=O(e.PushTriggerOption,n.push_trigger_option)?n.push_trigger_option:e.PushTriggerOption.ALL,s.myLastRead=null!==(k=n.user_last_read)&&void 0!==k?k:0,s.inviter=n.inviter?new vt(s._iid,n.inviter):null,s.invitedAt=null!==(E=n.invited_at)&&void 0!==E?E:0,s.joinedAt=null!==(b=n.joined_ts)&&void 0!==b?b:0,s._updateUnreadCount(null!==(w=n.unread_message_count)&&void 0!==w?w:0,null!==(x=n.unread_mention_count)&&void 0!==x?x:0),s.pinnedMessageIds=null!==(C=n.pinned_message_ids)&&void 0!==C?C:[],s.lastPinnedMessage=n.latest_pinned_message?gn(s._iid,Object.assign({channel_type:s.channelType},n.latest_pinned_message)):null,s}return s(u,[{key:"isHidden",get:function(){return this.hiddenState!==e.HiddenState.UNHIDDEN}},{key:"isTyping",get:function(){return this._typingStatus.size>0}},{key:"cachedUnreadMemberState",get:function(){var e,t={},n=E(this._unreadMemberStateMap);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,2),a=r[0],s=r[1];t[a]=s}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"cachedUndeliveredMemberState",get:function(){var e,t={},n=E(this._undeliveredMemberStateMap);try{for(n.s();!(e=n.n()).done;){var r=m(e.value,2),a=r[0],s=r[1];t[a]=s}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"_shouldUpdateLastMessageWith",value:function(e){return!(e instanceof an&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)}},{key:"_updateUnreadCount",value:function(t,n){if("number"==typeof t&&t>=0)if(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var r=At.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=r&&t>=r?r:t}else this.unreadMessageCount=t;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof n&&n>=0&&(this.myCountPreference===e.CountPreference.ALL||this.myCountPreference===e.CountPreference.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=n:this.unreadMentionCount=0}},{key:"_updateUnreadMemberState",value:function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),At.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)}},{key:"_updateUndeliveredMemberState",value:function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)}},{key:"_updateTypingStatus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime();t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)}},{key:"_clearTypingStatus",value:function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0}},{key:"_setLatestMemberCount",value:function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r}},{key:"isReadMessage",value:function(e){var t=At.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return n&&n>=e.createdAt}},{key:"serialize",value:function(){var e=this;return ht(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))}},{key:"createMessageCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new gl(this._iid,Object.assign({channel:this},e))}},{key:"createMemberListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Sl(this._iid,this.url,e)}},{key:"addMember",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=this.members.findIndex((function(e){return e.userId===t.userId}));if(r>-1){var a=this.members[r];a.state===e.MemberState.JOINED&&(t.state=a.state),this.members.splice(r,1),this.memberCount--}this.members.push(t),this.memberCount++,this._updateUnreadMemberState(t.userId,n),this._updateUndeliveredMemberState(t.userId,n)}}},{key:"removeMember",value:function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof Eu?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1}},{key:"getUnreadMemberCount",value:function(t){if(t instanceof an&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n,r=At.of(this._iid).sdkState,a=t.createdAt,s=0,i=E(this.members);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(r.userId!==o.userId&&o.state===e.MemberState.JOINED&&t.sender.userId!==o.userId)(this.cachedUnreadMemberState[o.userId]||0)<a&&s++}}catch(e){i.e(e)}finally{i.f()}return s}return 0}},{key:"getUndeliveredMemberCount",value:function(t){if(t instanceof an&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n,r=At.of(this._iid).sdkState,a=t.createdAt,s=0,i=E(this.members);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(r.userId!==o.userId&&o.state===e.MemberState.JOINED&&t.sender.userId!==o.userId)(this.cachedUndeliveredMemberState[o.userId]||0)<a&&s++}}catch(e){i.e(e)}finally{i.f()}return s}return 0}},{key:"getReadMembers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=At.of(this._iid),a=r.sdkState;if(!a.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=e instanceof an?e.sender:null,i=[];return this.members.forEach((function(r){(n||r.userId!==a.userId&&r.userId!==(null==s?void 0:s.userId))&&(t._unreadMemberStateMap.get(r.userId)>=e.createdAt&&i.push(r))})),i}},{key:"getUnreadMembers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=At.of(this._iid),a=r.sdkState;if(!a.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=e instanceof an?e.sender:null,i=[];return this.members.forEach((function(r){(n||r.userId!==a.userId&&r.userId!==(null==s?void 0:s.userId))&&(t._unreadMemberStateMap.get(r.userId)<e.createdAt&&i.push(r))})),i}},{key:"getReadStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=At.of(this._iid),r=n.sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var a={};return this.members.forEach((function(n){if(t||n.userId!==r.userId){var s=e._unreadMemberStateMap.get(n.userId);a[n.userId]=new bu(e._iid,{channel_url:e.url,channel_type:e.channelType,user:Eu.payloadify(n),ts:s})}})),a}},{key:"getTypingUsers",value:function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e}},{key:"invalidateTypingStatus",value:function(){var e=this,t=At.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),r=!1;return this._typingStatus.forEach((function(a,s){var i=a.ts;n-i>=t&&(e._typingStatus.delete(s),r=!0)})),r}},{key:"refresh",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.requestQueue,s=r.dispatcher,i=new Yu({channelUrl:this.url}),t.next=4,a.send(i);case 4:return o=t.sent,u=o.as(Ju),c=u.channel,s.dispatch(new Vu({channels:[c],source:e.GroupChannelEventSource.REQUEST_CHANNEL})),t.abrupt("return",c);case 8:case"end":return t.stop()}}),n,this)})))}},{key:"freeze",value:function(){var n=this,r=Object.create(null,{freeze:{get:function(){return _(o(u.prototype),"freeze",n)}}});return b(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.freeze.call(this);case 2:a=At.of(this._iid),a.dispatcher.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN}));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"unfreeze",value:function(){var n=this,r=Object.create(null,{unfreeze:{get:function(){return _(o(u.prototype),"unfreeze",n)}}});return b(this,void 0,void 0,t().mark((function n(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.unfreeze.call(this);case 2:a=At.of(this._iid),a.dispatcher.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN}));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"updateChannel",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},yl),n),pt(kl(a)).throw(S.invalidParameters),s=At.of(this._iid),i=s.dispatcher,o=s.requestQueue,u=new Al(Object.assign({channelUrl:this.url},a)),t.next=6,o.send(u);case 6:return c=t.sent,l=c.as(Ul),h=l.channel,i.dispatch(new Vu({channels:[h],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),t.abrupt("return",h);case 10:case"end":return t.stop()}}),r,this)})))}},{key:"invite",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(e.every((function(e){return e instanceof vt}))).throw(S.invalidParameters),t.abrupt("return",this.inviteWithUserIds(e.map((function(e){return e.userId}))));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"inviteWithUserIds",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(D("string",n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.dispatcher,i=a.requestQueue,o=new yc({channelUrl:this.url,userIds:n}),t.next=5,i.send(o);case 5:return u=t.sent,c=u.as(kc),l=c.channel,s.dispatch(new Vu({channels:[l],source:e.GroupChannelEventSource.EVENT_CHANNEL_INVITED})),t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"join",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",n)||null===n).throw(S.invalidParameters),a=At.of(this._iid),s=a.dispatcher,i=a.sdkState,o=a.requestQueue,u=new fc({channelUrl:this.url,userId:i.userId,accessCode:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(vc),(h=l.channel).myMemberState=this.myMemberState=e.MemberState.JOINED,s.dispatch(new Vu({channels:[h],source:e.GroupChannelEventSource.EVENT_CHANNEL_JOINED})),t.abrupt("return",this);case 10:case"end":return t.stop()}}),r,this)})))}},{key:"leave",value:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=At.of(this._iid),s=a.sdkState,i=a.requestQueue,o=new mc({channelUrl:this.url,userId:s.userId,shouldRemoveOperatorStatus:n}),t.next=4,i.send(o);case 4:this.myMemberState=e.MemberState.NONE;case 5:case"end":return t.stop()}}),r,this)})))}},{key:"acceptInvitation",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",n)||null===n).throw(S.invalidParameters),a=At.of(this._iid),s=a.dispatcher,i=a.sdkState,o=a.requestQueue,u=new Nl({channelUrl:this.url,userId:i.userId,accessCode:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Ml),(h=l.channel).myMemberState=this.myMemberState=e.MemberState.JOINED,s.dispatch(new Vu({channels:[h],source:e.GroupChannelEventSource.EVENT_CHANNEL_ACCEPTED_INVITE})),t.abrupt("return",this);case 10:case"end":return t.stop()}}),r,this)})))}},{key:"declineInvitation",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.sdkState,s=r.requestQueue,i=new bc({channelUrl:this.url,userId:a.userId}),t.next=4,s.send(i);case 4:return this.myMemberState=e.MemberState.NONE,t.abrupt("return",this);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"sendUserMessage",value:function(t){var n=this,r=new Zn,a=At.of(this._iid).dispatcher,s=Aa.of(this._iid);return _(o(u.prototype),"sendUserMessage",this).call(this,t).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){t&&s.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){n.hiddenState===e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE&&(n.hiddenState=e.HiddenState.UNHIDDEN),s.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),Wc.of(n._iid).handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new Vu({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"updateUserMessage",value:function(n,r){var a=this,s=Object.create(null,{updateUserMessage:{get:function(){return _(o(u.prototype),"updateUserMessage",a)}}});return b(this,void 0,void 0,t().mark((function a(){var i,o,u,c,l,h=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=At.of(this._iid),o=i.dispatcher,t.next=3,s.updateUserMessage.call(this,n,r);case 3:return u=t.sent,c=!1,!u.silent&&this._shouldUpdateLastMessageWith(u)&&(this.lastMessage=u,c=!0),l=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===u.messageId&&(this.lastPinnedMessage=u,c=!0,l=!0),c&&(Wc.of(this._iid).handlers.map((function(e){return e.onChannelChanged(h)})),o.dispatch(new Vu({channels:[this],source:l?e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED}))),l&&Wc.of(this._iid).handlers.map((function(e){return e.onPinnedMessageUpdated(h)})),o.dispatch(new Ln({messages:[u],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",u);case 12:case"end":return t.stop()}}),a,this)})))}},{key:"_autoResendUserMessage",value:function(t){var n=this,r=new Zn,a=At.of(this._iid).dispatcher,s=Aa.of(this._iid);return _(o(u.prototype),"_autoResendUserMessage",this).call(this,t).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){s.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){var i=Wc.of(n._iid);s.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),i.handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new Vu({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"sendFileMessage",value:function(t){var n=this,r=new Zn,a=At.of(this._iid).dispatcher,s=Aa.of(this._iid);return _(o(u.prototype),"sendFileMessage",this).call(this,t).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){t&&s.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){var i=Wc.of(n._iid);s.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),i.handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new Vu({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"updateFileMessage",value:function(n,r){var a=this,s=Object.create(null,{updateFileMessage:{get:function(){return _(o(u.prototype),"updateFileMessage",a)}}});return b(this,void 0,void 0,t().mark((function a(){var i,o,u,c,l,h=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=At.of(this._iid),o=i.dispatcher,t.next=3,s.updateFileMessage.call(this,n,r);case 3:return u=t.sent,c=!1,!u.silent&&this._shouldUpdateLastMessageWith(u)&&(this.lastMessage=u,c=!0),l=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===u.messageId&&(this.lastPinnedMessage=u,c=!0,l=!0),c&&(Wc.of(this._iid).handlers.map((function(e){return e.onChannelChanged(h)})),o.dispatch(new Vu({channels:[this],source:l?e.GroupChannelEventSource.EVENT_PINNED_MESSAGE_UPDATED:e.GroupChannelEventSource.EVENT_MESSAGE_UPDATED}))),l&&Wc.of(this._iid).handlers.map((function(e){return e.onPinnedMessageUpdated(h)})),o.dispatch(new Ln({messages:[u],source:e.MessageEventSource.EVENT_MESSAGE_UPDATED})),t.abrupt("return",u);case 12:case"end":return t.stop()}}),a,this)})))}},{key:"_autoResendFileMessage",value:function(t){var n=this,r=new Zn,a=At.of(this._iid).dispatcher,s=Aa.of(this._iid);return _(o(u.prototype),"_autoResendFileMessage",this).call(this,t).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),r._trigger(null,e)})).onFailed((function(e,t){s.completeCurrentAndProcessNextAutoResend(t),r._trigger(e,t)})).onSucceeded((function(t){var i=Wc.of(n._iid);s.completeCurrentAndProcessNextAutoResend(t),n._shouldUpdateLastMessageWith(t)&&(n.lastMessage=t),i.handlers.map((function(e){return e.onChannelChanged(n)})),a.dispatch(new Vu({channels:[n],source:e.GroupChannelEventSource.EVENT_MESSAGE_SENT})),r._trigger(null,t)})),r}},{key:"deleteMessage",value:function(n){var r=this,a=Object.create(null,{deleteMessage:{get:function(){return _(o(u.prototype),"deleteMessage",r)}}});return b(this,void 0,void 0,t().mark((function r(){var s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.deleteMessage.call(this,n);case 2:0===n.messageId&&n instanceof an&&(s=At.of(this._iid),s.dispatcher.dispatch(new Fn({reqId:n.reqId,source:e.MessageEventSource.EVENT_MESSAGE_DELETED})));case 3:case"end":return t.stop()}}),r,this)})))}},{key:"hide",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},El),n),pt(bl(a)).throw(S.invalidParameters),s=At.of(this._iid),i=s.dispatcher,o=s.sdkState,u=s.requestQueue,c=new Sc(Object.assign({channelUrl:this.url,userId:o.userId},a)),t.next=6,u.send(c);case 6:return l=t.sent,h=l.as(Nc),d=h.messageOffsetTimestamp,this.hiddenState=a.allowAutoUnhide?e.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:e.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,a.hidePreviousMessages&&this._updateUnreadCount(0,0),d&&(this.messageOffsetTimestamp=d),i.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_HIDDEN})),t.abrupt("return",this);case 13:case"end":return t.stop()}}),r,this)})))}},{key:"unhide",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.dispatcher,s=r.requestQueue,i=new Rl({channelUrl:this.url}),t.next=4,s.send(i);case 4:return this.hiddenState=e.HiddenState.UNHIDDEN,a.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UNHIDDEN})),t.abrupt("return",this);case 7:case"end":return t.stop()}}),n,this)})))}},{key:"delete",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Ol({channelUrl:this.url}),e.next=4,r.send(a);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"markAsRead",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.sdkState,s=r.dispatcher,i=r.requestQueue,o=new xc({channelUrl:this.url}),t.next=4,i.send(o);case 4:u=t.sent,c=u.as(Cc),l=c.readStatus,this._updateUnreadMemberState(a.userId,l.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),Wc.of(this._iid).handlers.map((function(e){return e.onChannelChanged(h)}))),s.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_READ}));case 9:case"end":return t.stop()}}),n,this)})))}},{key:"markAsDelivered",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new Tc({channelUrl:this.url,userId:r.userId}),e.next=4,a.send(s);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"startTyping",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=At.of(this._iid),r=n.requestQueue,a=n.typingIndicatorThrottle,(s=(new Date).getTime())-this._typingStarted>=a&&(this._typingStarted=s,this._typingEnded=0,i=new Ac({channelUrl:this.url,time:this._typingStarted}),r.send(i));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"endTyping",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=At.of(this._iid),r=n.requestQueue,a=n.typingIndicatorThrottle,(s=(new Date).getTime())-this._typingEnded>=a&&(this._typingStarted=0,this._typingEnded=s,i=new Oc({channelUrl:this.url,time:this._typingStarted}),r.send(i));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"createScheduledUserMessage",value:function(e){e=Object.assign(Object.assign({},ya),e),pt(function(e){return ra(e)&&U("number",e.scheduledAt,!0)}(e)).throw(S.invalidParameters);var t=new Zn;return this._createScheduledUserMessage(e,t),t}},{key:"updateScheduledUserMessage",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Hl),n),pt(jl(a)).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new Bl(Object.assign({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},a)),t.next=6,i.send(o);case 6:return u=t.sent,c=u.as(iu),l=c.message,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"createScheduledFileMessage",value:function(e){var n=this;e=Object.assign(Object.assign({},ka),e),pt(function(e){return $r(e)&&U("number",e.scheduledAt)&&(P(e.file)||U("string",e.fileUrl))&&U("string",e.fileName,!0)&&U("string",e.mimeType,!0)&&U("number",e.fileSize,!0)&&(null===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return U("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(e)).throw(S.invalidParameters);var r=Date.now(),a=this._generateRequestId(),s=new Zn;return Ge(2).then((function(){var i=n._createPendingScheduledFileMessage(e,a,r);je((function(){return b(n,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s._trigger(null,i));case 1:case"end":return e.stop()}}),e)})))}))})),P(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return n._createScheduledFileMessage(e,s,a,r)})):this._createScheduledFileMessage(e,s,a,r),s}},{key:"updateScheduledFileMessage",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=Object.assign(Object.assign({},Gl),n),pt(ql(a)).throw(S.invalidParameters),!P(a.file)){t.next=5;break}return t.next=5,this._uploadFileAndUpdateParams(a);case 5:return s=new Vl(Object.assign({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},a)),i=At.of(this._iid),o=i.requestQueue,t.next=9,o.send(s);case 9:return u=t.sent,c=u.as(Ql),l=c.message,t.abrupt("return",l);case 12:case"end":return t.stop()}}),r,this)})))}},{key:"cancelScheduledMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Kl({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),a=At.of(this._iid),s=a.requestQueue,t.next=4,s.send(r);case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),n,this)})))}},{key:"sendScheduledMessageNow",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new zl({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),a=At.of(this._iid),s=a.requestQueue,t.next=4,s.send(r);case 4:return t.abrupt("return");case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getMyPushTriggerOption",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.sdkState,a=n.requestQueue,s=new Jl({userId:r.userId,channelUrl:this.url}),e.next=4,a.send(s);case 4:return i=e.sent,o=i.as(Xl),u=o.pushTriggerOption,this.myPushTriggerOption=u,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"setMyPushTriggerOption",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(O(e.PushTriggerOption,n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.dispatcher,i=a.sdkState,o=a.requestQueue,u=new Wl({userId:i.userId,channelUrl:this.url,pushTriggerOption:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Yl),h=l.pushTriggerOption,this.myPushTriggerOption=h,s.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),t.abrupt("return",h);case 10:case"end":return t.stop()}}),r,this)})))}},{key:"setMyCountPreference",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(O(e.CountPreference,n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.dispatcher,i=a.sdkState,o=a.requestQueue,u=new Dl({channelUrl:this.url,userId:i.userId,countPreference:n}),t.next=5,o.send(u);case 5:return c=t.sent,l=c.as(Ll),h=l.countPreference,this.myCountPreference=h,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),s.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED})),t.abrupt("return",h);case 11:case"end":return t.stop()}}),r,this)})))}},{key:"resetMyHistory",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=At.of(this._iid),a=r.dispatcher,s=r.requestQueue,i=new Pl({channelUrl:this.url}),t.next=4,s.send(i);case 4:return o=t.sent,u=o.as(Fl),c=u.messageOffsetTimestamp,this.messageOffsetTimestamp=c,a.dispatch(new Vu({channels:[this],source:e.GroupChannelEventSource.EVENT_CHANNEL_RESET_HISTORY})),t.abrupt("return",this);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"updatePoll",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("number",e)&&Zl(n)).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new $l(Object.assign({pollId:e},n)),t.next=5,s.send(i);case 5:return o=t.sent,u=o.as(eh),c=u.poll,t.abrupt("return",c);case 8:case"end":return t.stop()}}),r,this)})))}},{key:"deletePoll",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=U("number",e),pt(r).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new th({pollId:e}),t.next=6,s.send(i);case 6:case"end":return t.stop()}}),n,this)})))}},{key:"closePoll",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=U("number",e),pt(r).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new nh({pollId:e}),t.next=6,s.send(i);case 6:return o=t.sent,u=o.as(rh),c=u.poll,t.abrupt("return",c);case 9:case"end":return t.stop()}}),n,this)})))}},{key:"addPollOption",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=U("number",e)&&U("string",n)&&""!==n.trim(),pt(a).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new ah({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:n}),t.next=6,i.send(o);case 6:return u=t.sent,c=u.as(sh),l=c.poll,t.abrupt("return",l);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"updatePollOption",value:function(e,n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=U("number",e)&&U("number",n)&&U("string",r)&&""!==r.trim(),pt(s).throw(S.invalidParameters),i=At.of(this._iid),o=i.requestQueue,u=new ih({pollId:e,pollOptionId:n,optionText:r}),t.next=6,o.send(u);case 6:return c=t.sent,l=c.as(oh),h=l.poll,t.abrupt("return",h);case 9:case"end":return t.stop()}}),a,this)})))}},{key:"deletePollOption",value:function(e,n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=U("number",e)&&U("number",n),pt(a).throw(S.invalidParameters),s=At.of(this._iid),i=s.requestQueue,o=new uh({pollId:e,pollOptionId:n}),t.next=6,i.send(o);case 6:case"end":return t.stop()}}),r,this)})))}},{key:"votePoll",value:function(n,r){return b(this,void 0,void 0,t().mark((function a(){var s,i,o,u,c,l,h,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=U("number",n)&&D("number",r),pt(s).throw(S.invalidParameters),i=At.of(this._iid),o=i.requestQueue,u=i.dispatcher,c=new ch({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:n,pollOptionIds:r}),t.next=6,o.send(c);case 6:return l=t.sent,h=l.as(Vc),d=h.event,u.dispatch(new Hn({event:d,source:e.MessageEventSource.EVENT_POLL_VOTED})),t.abrupt("return",d);case 10:case"end":return t.stop()}}),a,this)})))}},{key:"getPollChangeLogsSinceTimestamp",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("number",e)).throw(S.invalidParameters),r=Nr.of(this._iid),t.next=4,r.getPollChangeLogs(this.url,this.channelType,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"getPollChangeLogsSinceToken",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e,!0)),r=Nr.of(this._iid),t.next=4,r.getPollChangeLogs(this.url,this.channelType,e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"createPollListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new Rr(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})}},{key:"createPollVoterListQuery",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20;return new Pr(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})}},{key:"pinMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("number",e)&&e>0).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new lh({channelType:this.channelType,channelUrl:this.url,messageId:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"unpinMessage",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("number",e)&&e>0).throw(S.invalidParameters),r=At.of(this._iid),a=r.requestQueue,s=new hh({channelType:this.channelType,channelUrl:this.url,messageId:e}),t.next=5,a.send(s);case 5:case"end":return t.stop()}}),n,this)})))}},{key:"_uploadFileAndUpdateParams",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h,d,p,f;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!P(e.file)){t.next=11;break}return r=At.of(this._iid),a=r.requestQueue,s=new qt({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),t.next=5,a.send(s);case 5:i=t.sent,o=i.as(Ht),u=o.url,c=o.fileSize,l=void 0===c?e.fileSize:c,h=o.thumbnailSizes,d=void 0===h?e.thumbnailSizes:h,p=o.requireAuth,f=void 0!==p&&p,e.fileUrl=u,e.fileSize=l,e.thumbnailSizes=d,e.requireAuth=f;case 11:case"end":return t.stop()}}),n,this)})))}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},_(o(u),"payloadify",this).call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return Eu.payloadify(e)})),last_message:mn(e.lastMessage),inviter:e.inviter?vt.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,pinned_message_ids:e.pinnedMessageIds,latest_pinned_message:mn(e.lastPinnedMessage)})):null}}]),u}(cu),fh={},vh=function(){function n(a){var s=this,i=a._iid,o=a.limit,u=void 0===o?100:o;r(this,n),this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadata=null,this._iid=i,this._limit=u;var c,l=At.of(this._iid),h=l.sdkState,d=l.dispatcher,p=l.logger;this._metadataKey=(c=h.userId,"sendbird:".concat(c,"@groupchannel/sync.meta"));var f=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(h.userId);this._sync=new Yc(f,(function(){return b(s,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={hasNext:!0,nextToken:""},t.next=3,this.loadMetadata();case 3:if(p.debug("channel background sync from",this._metadata.token),this._metadata.completed){t.next=31;break}return t.prev=5,s=Wc.of(this._iid),t.next=9,s.getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:e.GroupChannelListOrder.CHRONOLOGICAL},this._limit,e.GroupChannelEventSource.SYNC_CHANNEL_BACKGROUND);case 9:return i=t.sent,o=i.channels,u=i.token,r.hasNext=o.length>=this._limit&&!!u,r.nextToken=u,this._metadata.token=u,(a=this._metadata.range).extends.apply(a,g(o.map((function(e){return e.createdAt})))),this._metadata.completed=!r.hasNext,p.debug("channel background sync progress",r),t.next=20,this.saveMetadata();case 20:t.next=29;break;case 22:if(t.prev=22,t.t0=t.catch(5),p.debug("channel background sync error",t.t0),!(t.t0 instanceof S&&t.t0.isInvalidTokenError)){t.next=28;break}return t.next=28,this.clearMetaData();case 28:throw t.t0;case 29:t.next=33;break;case 31:r.hasNext=!1,r.nextToken="";case 33:return t.abrupt("return",r);case 34:case"end":return t.stop()}}),n,this,[[5,22]])})))})),this._connectionEventContext=d.on((function(e){if(e instanceof _e)if(e.stateType===ce.CONNECTED)s.resume();else s.pause()}))}return s(n,[{key:"range",get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range}},{key:"completed",get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)}},{key:"loadMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.get(this._metadataKey);case 4:a=e.sent,this._metadata={token:a?a.token:"",range:new Bc(a?a.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!a&&a.completed};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetaData",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){var e,t,n=At.of(this._iid),r=n.logger;n.connectionManager.isConnected&&(r.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:""))}},{key:"pause",value:function(){At.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete fh[this._iid])}}],[{key:"of",value:function(e){return fh[e]||(fh[e]=new n({_iid:e})),fh[e].ref++,fh[e]}},{key:"clear",value:function(e){fh[e]&&(fh[e].close(),delete fh[e])}}]),n}(),_h={},mh=function(){function n(a){var s=this,i=a._iid;r(this,n),this._sync=null,this._connectionEventContext=null,this.ref=0,this._metadataKey=null,this._metadata=null,this._iid=i;var o,u=At.of(this._iid),c=u.logger,l=u.sdkState,h=u.dispatcher;this._metadataKey=(o=l.userId,"sendbird:".concat(o,"@groupchannel/changelogs.meta"));var d=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(l.userId);this._sync=new Yc(d,(function(){return b(s,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={hasNext:!0,nextToken:0},t.next=3,this.loadMetadata();case 3:return c.debug("channel changelog sync from",this._metadata.token),t.prev=4,a=Wc.of(this._iid),t.next=8,a.getMyGroupChannelChangeLogs(this._metadata.token,{},e.GroupChannelEventSource.SYNC_CHANNEL_CHANGELOGS);case 8:return s=t.sent,i=s.hasMore,o=s.token,r.hasNext=i,r.nextToken=o,this._metadata.token=o,c.debug("channel changelog sync progress",r),t.next=17,this.saveMetadata();case 17:t.next=26;break;case 19:if(t.prev=19,t.t0=t.catch(4),c.debug("channel changelog sync error",t.t0),!(t.t0 instanceof S&&t.t0.isInvalidTokenError)){t.next=25;break}return t.next=25,this.clearMetadata();case 25:throw t.t0;case 26:return t.abrupt("return",r);case 27:case"end":return t.stop()}}),n,this,[[4,19]])})))})),this._connectionEventContext=h.on((function(e){if(e instanceof _e)if(e.stateType===ce.CONNECTED)s.resume();else s.pause()}))}return s(n,[{key:"loadMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._metadata){e.next=6;break}return n=At.of(this._iid),r=n.cacheContext,a=n.firstConnectedAt,e.next=4,r.preference.get(this._metadataKey);case 4:s=e.sent,this._metadata={token:s?s.token:a};case 6:return e.abrupt("return",this._metadata);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"saveMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._metadata){e.next=5;break}return n=At.of(this._iid),r=n.cacheContext,e.next=4,r.preference.set(this._metadataKey,this._metadata);case 4:return e.abrupt("return",!0);case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"clearMetadata",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.cacheContext,e.next=3,r.preference.remove(this._metadataKey);case 3:this._metadata=null;case 4:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){At.of(this._iid).connectionManager.isConnected&&this._sync.start(0)}},{key:"pause",value:function(){this._sync.stop()}},{key:"close",value:function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete _h[this._iid])}}],[{key:"of",value:function(e){return _h[e]||(_h[e]=new n({_iid:e})),_h[e].ref++,_h[e]}},{key:"clear",value:function(e){_h[e]&&(_h[e].close(),delete _h[e])}}]),n}(),gh=function(){function n(t,a){var s=this,i=a.filter,o=a.order,u=a.limit;r(this,n),this.channels=[],this._backgroundSync=null,this._changelogSync=null,this._iid=t,this._key="gcc-".concat(K()),this.filter=null!=i?i:new xu,this.order=null!=o?o:e.GroupChannelListOrder.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=u?u:100;var c=At.of(this._iid),l=c.sdkState;c.cacheContext.localCacheEnabled&&(this._backgroundSync=vh.of(t),this._backgroundSync.resume()),this._changelogSync=mh.of(t),this._changelogSync.resume(),Wc.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter((function(e){return s.filter.match(e,l.userId)})),r=e.filter((function(e){return!s.filter.match(e,l.userId)})).map((function(e){return e.url}));n.length>0&&s._addChannelsToView(n,t),r.length>0&&s._removeChannelsFromView(r,t)},onRemove:function(e,t){s._removeChannelsFromView(e,t)}})}return s(n,[{key:"hasMore",get:function(){return this._hasMore}},{key:"setGroupChannelCollectionHandler",value:function(e){this._handler=e}},{key:"_addChannelsToView",value:function(n,r){var a,s=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[],u=[],c=E(n);try{for(c.s();!(a=c.n()).done;){var l=a.value,h=il(this.channels,l,this.order),d=h.place,p=h.contains;if(p)switch(u.push(l),r){case e.GroupChannelEventSource.EVENT_CHANNEL_UPDATED:case e.GroupChannelEventSource.EVENT_MESSAGE_RECEIVED:this.channels.splice(d,1);var f=il(this.channels,l,this.order),v=f.place;this.channels.splice(v,0,l);break;default:this.channels[d]=l}else d===this.channels.length?(i||!this._backgroundSync||this._backgroundSync.completed)&&(o.push(l),this.channels.push(l)):(o.push(l),this.channels.splice(d,0,l))}}catch(e){c.e(e)}finally{c.f()}ju(r)&&je((function(){return b(s,void 0,void 0,t().mark((function e(){var n,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new Jc(r),o.length>0&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelsAdded)&&this._handler.onChannelsAdded(s,o),u.length>0&&(null===(a=this._handler)||void 0===a?void 0:a.onChannelsUpdated)&&this._handler.onChannelsUpdated(s,u);case 3:case"end":return e.stop()}}),e,this)})))}))}},{key:"_removeChannelsFromView",value:function(e,n){var r,a=this,s=[],i=E(e);try{var o=function(){var e=r.value,t=a.channels.findIndex((function(t){return t.url===e}));t>=0&&(s.push(a.channels[t].url),a.channels.splice(t,1))};for(i.s();!(r=i.n()).done;)o()}catch(e){i.e(e)}finally{i.f()}return ju(n)&&s.length>0&&je((function(){return b(a,void 0,void 0,t().mark((function e(){var r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Jc(n),(null===(r=this._handler)||void 0===r?void 0:r.onChannelsDeleted)&&this._handler.onChannelsDeleted(a,s);case 2:case"end":return e.stop()}}),e,this)})))})),s}},{key:"_getLocalChannels",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wc.of(this._iid),r=this.channels.length>0?al(this.channels[this.channels.length-1],this.order):null,e.next=4,n.getChannelsFromCache(r,this.filter,this.order,this._limit);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"_getRemoteChannels",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Wc.of(this._iid),e.next=3,n.getMyGroupChannels(this._token,Object.assign(Object.assign({},this.filter),{order:this.order}),this._limit);case 3:return r=e.sent,a=r.channels,s=r.token,this._token=s,this._hasMore=!!s,e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"loadMore",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a=this;return t().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._hasMore){n.next=8;break}return r=[],n.next=4,Ve((function(){return b(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getLocalChannels();case 2:r=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}));case 4:return n.next=6,Ve((function(){return b(a,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRemoteChannels();case 2:r=e.sent;case 3:case"end":return e.stop()}}),e,this)})))}));case 6:return this._addChannelsToView(r,e.GroupChannelEventSource.REQUEST_CHANNEL,!0),n.abrupt("return",r);case 8:return n.abrupt("return",[]);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"dispose",value:function(){var e,t;null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),Wc.of(this._iid).unsubscribeGroupChannelEvent(this._key)}}]),n}(),yh=function(t){i(a,t);var n=f(a);function a(t){var s;r(this,a);var i=t.token,o=t.limit,u=t.order,c=t.includeEmpty,l=t.membershipFilter,h=t.channelNameContainsFilter,d=t.channelUrlsFilter,p=t.customTypesFilter,f=t.customTypeStartsWithFilter,v=t.superChannelFilter,_=t.metadataOrderKeyFilter,m=t.metadataKey,g=t.metadataValues,y=t.metadataValueStartsWith,k=t.includeFrozen,E=t.includeMetaData;return(s=n.call(this)).method=T.GET,s.path=we,s.params=X({token:i,limit:o,order:u,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:c,public_mode:e.PublicChannelFilter.PUBLIC,public_membership_mode:l,name_contains:h,channel_urls:d,custom_types:p,custom_type_startswith:f,super_mode:v,metadata_order_key:_,metadata_key:m,metadata_values:g,metadata_value_startswith:y,show_frozen:k,show_metadata:E}),s}return s(a)}($),kh=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.channels=[],s.ts=null;var i=a.next,o=a.channels,u=a.ts;return s.token=i,o&&o.length>0&&(s.channels=o.map((function(t){return t.ts=u,new ph(e,t)}))),s.ts="number"==typeof u?u:null,s}return s(n)}(ee);e.MembershipFilter=void 0,(dh=e.MembershipFilter||(e.MembershipFilter={})).ALL="all",dh.JOINED="joined";var Eh=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h,d,p,f,v,_,m,g,y,k;return r(this,u),(s=a.call(this,t,n)).includeEmpty=!1,s.includeFrozen=!0,s.includeMetaData=!0,s.channelUrlsFilter=null,s.customTypesFilter=null,s.customTypeStartsWithFilter=null,s.channelNameContainsFilter=null,s.membershipFilter=e.MembershipFilter.ALL,s.superChannelFilter=e.SuperChannelFilter.ALL,s.metadataKey=null,s.metadataValues=null,s.metadataOrderKeyFilter=null,s.metadataValueStartsWith=null,s.order=e.PublicGroupChannelListOrder.CHRONOLOGICAL,s.includeEmpty=null!==(i=n.includeEmpty)&&void 0!==i&&i,s.includeFrozen=null===(o=n.includeFrozen)||void 0===o||o,s.includeMetaData=null===(c=n.includeMetaData)||void 0===c||c,s.channelUrlsFilter=null!==(l=n.channelUrlsFilter)&&void 0!==l?l:null,s.customTypesFilter=null!==(h=n.customTypesFilter)&&void 0!==h?h:null,s.customTypeStartsWithFilter=null!==(d=n.customTypeStartsWithFilter)&&void 0!==d?d:null,s.channelNameContainsFilter=null!==(p=n.channelNameContainsFilter)&&void 0!==p?p:null,s.membershipFilter=null!==(f=n.membershipFilter)&&void 0!==f?f:e.MembershipFilter.ALL,s.superChannelFilter=null!==(v=n.superChannelFilter)&&void 0!==v?v:e.SuperChannelFilter.ALL,s.metadataKey=null!==(_=n.metadataKey)&&void 0!==_?_:null,s.metadataValues=null!==(m=n.metadataValues)&&void 0!==m?m:null,s.metadataOrderKeyFilter=null!==(g=n.metadataOrderKeyFilter)&&void 0!==g?g:null,s.metadataValueStartsWith=null!==(y=n.metadataValueStartsWith)&&void 0!==y?y:null,s.order=null!==(k=n.order)&&void 0!==k?k:e.PublicGroupChannelListOrder.CHRONOLOGICAL,s}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)&&U("boolean",this.includeEmpty)&&U("boolean",this.includeFrozen)&&U("boolean",this.includeMetaData)&&U("string",this.channelNameContainsFilter,!0)&&D("string",this.channelUrlsFilter,!0)&&D("string",this.customTypesFilter,!0)&&U("string",this.customTypeStartsWithFilter,!0)&&O(e.MembershipFilter,this.membershipFilter)&&O(e.SuperChannelFilter,this.superChannelFilter)&&O(e.PublicGroupChannelListOrder,this.order)&&U("string",this.metadataOrderKeyFilter,!0)&&U("string",this.metadataKey,!0)&&D("string",this.metadataValues,!0)&&U("string",this.metadataValueStartsWith,!0)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l,h;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._validate()){t.next=22;break}if(this._isLoading){t.next=19;break}if(r=[],!this._hasNext){t.next=16;break}return this._isLoading=!0,a=At.of(this._iid),s=a.requestQueue,i=a.dispatcher,o=new yh(Object.assign(Object.assign({},this),{token:this._token})),t.next=9,s.send(o);case 9:return u=t.sent,c=u.as(kh),l=c.channels,h=c.token,this._token=h,this._hasNext=!!h,i.dispatch(new Vu({channels:l,source:e.GroupChannelEventSource.REQUEST_CHANNEL})),this._isLoading=!1,t.abrupt("return",l);case 16:return t.abrupt("return",r);case 19:throw S.queryInProgress;case 20:t.next=23;break;case 22:throw S.invalidParameters;case 23:case"end":return t.stop()}}),n,this)})))}}]),u}(nr),bh=s((function e(){r(this,e),this.onUserMuted=ue,this.onUserUnmuted=ue,this.onUserBanned=ue,this.onUserUnbanned=ue,this.onChannelChanged=ue,this.onChannelDeleted=ue,this.onChannelFrozen=ue,this.onChannelUnfrozen=ue,this.onOperatorUpdated=ue,this.onChannelMemberCountChanged=ue,this.onMetaDataCreated=ue,this.onMetaDataUpdated=ue,this.onMetaDataDeleted=ue,this.onMetaCounterCreated=ue,this.onMetaCounterUpdated=ue,this.onMetaCounterDeleted=ue,this.onMessageReceived=ue,this.onMessageUpdated=ue,this.onMessageDeleted=ue,this.onMentionReceived=ue,this.onReactionUpdated=ue,this.onThreadInfoUpdated=ue})),wh=function(e){i(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).onUserJoined=ue,e.onUserLeft=ue,e.onUserReceivedInvitation=ue,e.onUserDeclinedInvitation=ue,e.onChannelHidden=ue,e.onUnreadMemberStatusUpdated=ue,e.onUndeliveredMemberStatusUpdated=ue,e.onTypingStatusUpdated=ue,e.onPollUpdated=ue,e.onPollVoted=ue,e.onPollDeleted=ue,e.onPinnedMessageUpdated=ue,e}return s(n)}(bh),xh=function(e){i(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return s(n)}(wh),Ch=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.token,i=e.limit,o=e.order,u=e.reverse,c=e.channelUrl,l=e.messageTypeFilter,h=e.scheduledStatus;return(a=t.call(this)).method=T.GET,a.path="".concat(Ue),a.params=X({limit:i,reverse:u,channel_url:c,order:o,status:h}),s&&(a.params.token=s),l&&(a.params.message_type=l),a}return s(n)}($),Th=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.scheduledMessages=[];var i=a.next,o=a.scheduled_messages;return s.token=i,s.scheduledMessages=o.map((function(t){return gn(e,t)})),s}return s(n)}(ee),Ih=function(n){i(u,n);var a=f(u);function u(t,n){var s,i,o,c,l,h;return r(this,u),(s=a.call(this,t,n)).channelUrl=null,s.order=null,s.reverse=!1,s.scheduledStatus=null,s.messageTypeFilter=e.MessageTypeFilter.ALL,s.channelUrl=null!==(i=n.channelUrl)&&void 0!==i?i:null,s.order=null!==(o=n.order)&&void 0!==o?o:null,s.reverse=null!==(c=n.reverse)&&void 0!==c&&c,s.scheduledStatus=null!==(l=n.scheduledStatus)&&void 0!==l?l:null,s.messageTypeFilter=null!==(h=n.messageTypeFilter)&&void 0!==h?h:e.MessageTypeFilter.ALL,s}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)&&U("string",this.channelUrl,!0)&&(O(e.ScheduledMessageListOrder,this.order)||null===this.order)&&U("boolean",this.reverse)&&(D(e.ScheduledStatus,this.scheduledStatus)||null===this.scheduledStatus)&&O(e.MessageTypeFilter,this.messageTypeFilter)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new Ch(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(Th),o=i.scheduledMessages,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(nr),Sh=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="groupChannel",e}return s(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;_(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Wc(e,{sdkState:n,cacheContext:l,dispatcher:r,sessionManager:s,requestQueue:i,logger:u})}},{key:"createGroupChannelCollection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new gh(this._iid,e)}},{key:"createMyGroupChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Qc(this._iid,e)}},{key:"createPublicGroupChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Eh(this._iid,e)}},{key:"createScheduledMessageListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ih(this._iid,e)}},{key:"addGroupChannelHandler",value:function(e,t){pt(U("string",e)&&t instanceof xh).throw(S.invalidParameters),this._manager.addHandler(e,t)}},{key:"removeGroupChannelHandler",value:function(e){pt(U("string",e)).throw(S.invalidParameters),this._manager.removeHandler(e)}},{key:"removeAllGroupChannelHandlers",value:function(){this._manager.clearHandler()}},{key:"buildGroupChannelFromSerializedData",value:function(e){return this._manager.buildGroupChannelFromSerializedData(e)}},{key:"buildGroupChannelListQueryFromSerializedData",value:function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)}},{key:"buildMemberFromSerializedData",value:function(e){return this._manager.buildMemberFromSerializedData(e)}},{key:"getChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),t.abrupt("return",this._manager.getChannel(e));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"getChannelWithoutCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),t.abrupt("return",this._manager.getChannelWithoutCache(e));case 2:case"end":return t.stop()}}),n,this)})))}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Mu),n),pt(U("string",e)&&Au(a)).throw(S.invalidParameters),t.next=4,this._manager.getMyGroupChannelChangeLogs(e,a);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(this,void 0,void 0,t().mark((function r(){var a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=Object.assign(Object.assign({},Mu),n),pt(U("number",e)&&Au(a)).throw(S.invalidParameters),t.next=4,this._manager.getMyGroupChannelChangeLogs(e,a);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),r,this)})))}},{key:"getGroupChannelCount",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Uu),e),pt(Ou(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.getGroupChannelCount(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getUnreadItemCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getUnreadItemCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalUnreadChannelCount",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._manager.getTotalUnreadChannelCount();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getTotalUnreadMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getTotalUnreadMessageCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getTotalScheduledMessageCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._manager.getTotalScheduledMessageCount(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){return this._manager.getSubscribedTotalUnreadMessageCount()}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)}},{key:"createChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Su),e),pt(Nu(r)).throw(S.invalidParameters),t.abrupt("return",this._manager.createChannel(r));case 3:case"end":return t.stop()}}),n,this)})))}},{key:"createDistinctChannelIfNotExist",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Su),e),pt(Nu(r)).throw(S.invalidParameters),r&&(r.isDistinct=!0),t.abrupt("return",this.createChannel(r));case 4:case"end":return t.stop()}}),n,this)})))}},{key:"createChannelWithUserIds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return b(this,void 0,void 0,t().mark((function o(){var u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=Object.assign(Object.assign({},Su),{invitedUserIds:e,isDistinct:n,name:r,data:s,customType:i}),"string"==typeof a?u.coverUrl=a:u.coverImage=a,t.abrupt("return",this.createChannel(u));case 3:case"end":return t.stop()}}),o,this)})))}},{key:"markAsReadAll",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._manager.markAsReadAll();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"markAsReadWithChannelUrls",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:pt(D("string",e)).throw(S.invalidParameters),this._manager.markAsReadWithChannelUrls(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"markAsDelivered",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),t.next=3,this.getChannel(e);case 3:return r=t.sent,t.next=6,r.markAsDelivered();case 6:case"end":return t.stop()}}),n,this)})))}}]),a}(Gt),Nh=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments))._channels=new Map,e._enteredChannelUrls=[],e}return s(a,[{key:"enteredChannels",get:function(){var e=this;return this._enteredChannelUrls.map((function(t){return e._channels.get(t)})).filter((function(e){return null!==e}))}},{key:"isEnteredChannel",value:function(e){return this._enteredChannelUrls.includes(e)}},{key:"enter",value:function(e){this._enteredChannelUrls.indexOf(e)<0&&this._enteredChannelUrls.push(e)}},{key:"exit",value:function(e){var t=this._enteredChannelUrls.indexOf(e);t>=0&&this._enteredChannelUrls.splice(t,1)}},{key:"exitAll",value:function(){this._enteredChannelUrls=[]}},{key:"get",value:function(e){var n;return b(this,void 0,void 0,t().mark((function r(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",null!==(n=this._channels.get(e))&&void 0!==n?n:null);case 1:case"end":return t.stop()}}),r,this)})))}},{key:"upsert",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r=this;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.forEach((function(e){if(r._channels.has(e.url)){var t=r._channels.get(e.url);Object.assign(t,e)}else r._channels.set(e.url,e)}));case 1:case"end":return t.stop()}}),n)})))}},{key:"remove",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._channels.delete(e),this.exit(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"clear",value:function(){return b(this,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._channels.clear(),this._enteredChannelUrls=[];case 2:case"end":return e.stop()}}),e,this)})))}}]),a}(at),Mh={channelUrl:null,name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},Ah=function(e){return D("string",e.operatorUserIds,!0)&&(U("string",e.coverUrlOrImage)||P(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&U("string",e.name,!0)&&U("string",e.data,!0)&&U("string",e.customType,!0)&&(U("string",e.channelUrl)&&/^\w+$/.test(e.channelUrl)||null===e.channelUrl)},Uh=function(e){i(n,e);var t=f(n);function n(e){var a,s=e.channelUrl,i=e.isInternalCall;return r(this,n),(a=t.call(this)).method=T.GET,a.path="".concat(i?Te:Ce,"/").concat(encodeURIComponent(s)),a}return s(n)}($),Oh=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=null,s.channel=new Yh(e,a),s}return s(n)}(ee),Rh=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.coverUrlOrImage,o=e.name,u=e.data,c=e.customType,l=e.operatorUserIds;return(a=t.call(this)).method=T.POST,a.path=Ce,a.params=X({channel_url:s,cover_url:U("string",i)?i:null,cover_file:P(i)?i:null,name:o,data:u,custom_type:c,operators:l}),a}return s(n)}($),Dh=function(e){i(n,e);var t=f(n);function n(e){var a=e.channelUrl;return r(this,n),t.call(this,{code:"ENTR",payload:{channel_url:a},ackRequired:!0})}return s(n)}(he),Lh=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u;return r(this,n),i=t.call(this,e,"SYEV",s),s.data&&(i.participantCount=null!==(o=s.data.participant_count)&&void 0!==o?o:0,i.user=new vt(e,s.data),i.ts=null!==(u=s.data.edge_ts)&&void 0!==u?u:0),i}return s(n)}(pc),Ph=function(e){i(n,e);var t=f(n);function n(e){var a=e.channelUrl;return r(this,n),t.call(this,{code:"EXIT",payload:{channel_url:a},ackRequired:!0})}return s(n)}(he),Fh=function(e){i(n,e);var t=f(n);function n(e,a,s){var i,o,u;return r(this,n),i=t.call(this,e,"EXIT",s),s.data&&(i.participantCount=null!==(o=s.data.participant_count)&&void 0!==o?o:0,i.user=new vt(e,s.data),i.ts=null!==(u=s.data.edge_ts)&&void 0!==u?u:0),i}return s(n)}(pc),Gh={},qh=function(){function n(e,t){var a=this,s=t.sdkState,i=t.dispatcher,o=t.requestQueue;return r(this,n),Gh[e]||(this._iid=e,this._sdkState=s,this._requestQueue=o,this._dispatcher=i,this._openChannelCache=new Nh(e),this._openChannelHandlers=new Map,this._dispatcher.on((function(e){if(e instanceof oe)a._handleEvent(e);else if(e instanceof _e&&e.stateType===ce.CONNECTED){var t,n=E(a._openChannelCache.enteredChannels);try{for(n.s();!(t=n.n()).done;){t.value.enter()}}catch(e){n.e(e)}finally{n.f()}}})),Gh[e]=this),Gh[e]}return s(n,[{key:"buildOpenChannelFromSerializedData",value:function(e){var t=dt(e);return new Yh(this._iid,Yh.payloadify(t))}},{key:"getChannelFromCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._openChannelCache.get(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),n,this)})))}},{key:"upsertChannelsToCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._openChannelCache.upsert(e);case 2:case"end":return t.stop()}}),n,this)})))}},{key:"removeChannelsFromCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=E(e),t.prev=1,r.s();case 3:if((a=r.n()).done){t.next=9;break}return s=a.value,t.next=7,this._openChannelCache.remove(s);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),r.e(t.t0);case 14:return t.prev=14,r.f(),t.finish(14);case 17:case"end":return t.stop()}}),n,this,[[1,11,14,17]])})))}},{key:"setEnteredToCache",value:function(e){this._openChannelCache.enter(e.url)}},{key:"setExitedToCache",value:function(e){this._openChannelCache.exit(e.url)}},{key:"_handleEvent",value:function(n){return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o,u,c,l,h,d,p,f,v,_,m,g,y,k,w,x,C,T,S,N,M,A,U,O,R,D,L,P,F,G,q,H,j,V,Q,B,K,z,W,Y,J,X,Z,$,ee,te,ne,re,ae,se,ie,oe,ue,ce,le,he,de,pe,fe,ve,_e,me,ge,ye,ke,Ee,be,we,xe=this;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,r.t0=n.code,r.next="MESG"===r.t0||"FILE"===r.t0||"ADMM"===r.t0||"BRDM"===r.t0?4:"MEDI"===r.t0||"FEDI"===r.t0||"AEDI"===r.t0?14:"DELM"===r.t0?24:"MRCT"===r.t0?31:"MTHD"===r.t0?38:"MCNT"===r.t0?45:"SYEV"===r.t0?72:149;break;case 4:if(a=null,"MESG"===n.code?a=n.as(Ko):"FILE"===n.code?a=n.as(Tn):"ADMM"!==n.code&&"BRDM"!=n.code||(a=n.as(Fc)),!a){r.next=13;break}if(i=(s=a).message,o=s.isMentioned,i.channelType!==e.ChannelType.OPEN){r.next=13;break}return r.next=11,this.getChannel(i.channelUrl,!0);case 11:u=r.sent,je((function(){return b(xe,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(u.url)&&(a.onMessageReceived(u,i),o&&a.onMentionReceived(u,i))}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 13:return r.abrupt("break",149);case 14:if(c=null,"MEDI"===n.code?c=n.as(Wo):"FEDI"===n.code?c=n.as(Jo):"AEDI"===n.code&&(c=n.as(Gc)),!c){r.next=23;break}if(h=(l=c).message,d=l.mentionCountChange,h.channelType!==e.ChannelType.OPEN){r.next=23;break}return r.next=21,this.getChannel(h.channelUrl,!0);case 21:p=r.sent,je((function(){return b(xe,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(p.url)&&(a.onMessageUpdated(p,h),d>0&&a.onMentionReceived(p,h))}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 23:return r.abrupt("break",149);case 24:if(f=n.as(Zo),v=f.channelUrl,_=f.channelType,m=f.messageId,_!==e.ChannelType.OPEN){r.next=30;break}return r.next=28,this.getChannel(v,!0);case 28:g=r.sent,je((function(){return b(xe,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(g.url)&&a.onMessageDeleted(g,m)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 30:return r.abrupt("break",149);case 31:if(y=n.as(qc),k=y.channelUrl,w=y.channelType,x=y.event,w!==e.ChannelType.OPEN){r.next=37;break}return r.next=35,this.getChannel(k,!0);case 35:C=r.sent,je((function(){return b(xe,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(C.url)&&a.onReactionUpdated(C,x)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 37:return r.abrupt("break",149);case 38:if(T=n.as(Hc),(S=T.event).channelType!==e.ChannelType.OPEN){r.next=44;break}return r.next=42,this.getChannel(S.channelUrl,!0);case 42:N=r.sent,je((function(){return b(xe,void 0,void 0,t().mark((function e(){var n,r,a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)a=r.value,this._openChannelCache.isEnteredChannel(N.url)&&a.onThreadInfoUpdated(N,S)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 44:return r.abrupt("break",149);case 45:M=n.as(Lc),A=M.openChannelMemberCounts,U=[],O=E(A),r.prev=48,O.s();case 50:if((R=O.n()).done){r.next=59;break}return D=R.value,L=D.channelUrl,P=D.participantCount,F=D.updatedAt,r.next=55,this.getChannelFromCache(L);case 55:(G=r.sent)&&G._updateParticipantCount(P,F)&&U.push(G);case 57:r.next=50;break;case 59:r.next=64;break;case 61:r.prev=61,r.t1=r.catch(48),O.e(r.t1);case 64:return r.prev=64,O.f(),r.finish(64);case 67:if(!(U.length>0)){r.next=71;break}return r.next=70,this.upsertChannelsToCache(U);case 70:je((function(){return b(xe,void 0,void 0,t().mark((function e(){var n,r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E(this._openChannelHandlers.values());try{for(n.s();!(r=n.n()).done;)r.value.onChannelMemberCountChanged(U)}catch(e){n.e(e)}finally{n.f()}case 2:case"end":return e.stop()}}),e,this)})))}));case 71:return r.abrupt("break",149);case 72:if(q=n.as(pc),!(H=q.event).isOpenChannelEvent){r.next=148;break}r.t2=H.category,r.next=r.t2===wu.CHANNEL_ENTER?77:r.t2===wu.CHANNEL_EXIT?84:r.t2===wu.CHANNEL_OPERATOR_UPDATE?91:r.t2===wu.USER_CHANNEL_MUTE||r.t2===wu.USER_CHANNEL_UNMUTE?99:r.t2===wu.USER_CHANNEL_BAN||r.t2===wu.USER_CHANNEL_UNBAN?106:r.t2===wu.CHANNEL_FREEZE||r.t2===wu.CHANNEL_UNFREEZE?113:r.t2===wu.CHANNEL_DELETED?121:r.t2===wu.CHANNEL_PROP_CHANGED?128:r.t2===wu.CHANNEL_META_DATA_CHANGED?133:r.t2===wu.CHANNEL_META_COUNTERS_CHANGED?142:148;break;case 77:return r.next=79,this.getChannel(H.channelUrl,!0);case 79:return j=r.sent,V=n.as(Lh),Q=V.participantCount,B=V.user,K=j._updateParticipantCount(Q,H.ts),je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onUserEntered(j,B),K&&e.onChannelParticipantCountChanged(j)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 84:return r.next=86,this.getChannel(H.channelUrl,!0);case 86:return z=r.sent,W=n.as(Fh),Y=W.participantCount,J=W.user,X=z._updateParticipantCount(Y,H.ts),je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onUserExited(z,J),X&&e.onChannelParticipantCountChanged(z)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 91:return r.next=93,this.getChannel(H.channelUrl,!0);case 93:return Z=r.sent,$=n.as(Dc),ee=$.operators,Z.operators=ee,this.upsertChannelsToCache([Z]),je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onOperatorUpdated(Z,ee)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 99:return r.next=101,this.getChannel(H.channelUrl,!0);case 101:return te=r.sent,ne=H.category===wu.USER_CHANNEL_MUTE,re=n.as(ne?Oo:Do),ae=re.user,je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){ne?e.onUserMuted(te,ae):e.onUserUnmuted(te,ae)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 106:return r.next=108,this.getChannel(H.channelUrl,!0);case 108:return se=r.sent,ie=H.category===wu.USER_CHANNEL_BAN,oe=n.as(ie?Po:Go),ue=oe.user,je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){ie?e.onUserBanned(se,ue):e.onUserUnbanned(se,ue)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 113:return r.next=115,this.getChannel(H.channelUrl,!0);case 115:return ce=r.sent,le=n.as(Ho),he=le.freeze,ce.isFrozen=he,this.upsertChannelsToCache([ce]),je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){he?e.onChannelFrozen(ce):e.onChannelUnfrozen(ce)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 121:return r.next=123,this.getChannel(H.channelUrl,!0);case 123:return de=r.sent,r.next=126,this.removeChannelsFromCache([de.url]);case 126:return je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onChannelDeleted(de.url,de.channelType)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 128:return r.next=130,this.getChannelWithoutCache(H.channelUrl,!0);case 130:return pe=r.sent,je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){e.onChannelChanged(pe)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 133:return r.next=135,this.getChannel(H.channelUrl,!0);case 135:return fe=r.sent,ve=n.as(go),_e=ve.created,me=ve.updated,ge=ve.deleted,_e&&fe._upsertCachedMetaData(_e,H.ts),me&&fe._upsertCachedMetaData(me,H.ts),ge&&fe._removeFromCachedMetaData(ge,H.ts),je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){_e&&e.onMetaDataCreated(fe,_e),me&&e.onMetaDataUpdated(fe,me),ge&&e.onMetaDataDeleted(fe,ge)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 142:return r.next=144,this.getChannel(H.channelUrl,!0);case 144:return ye=r.sent,ke=n.as(No),Ee=ke.created,be=ke.updated,we=ke.deleted,je((function(){return b(xe,void 0,void 0,t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._openChannelHandlers.forEach((function(e){Ee&&e.onMetaCounterCreated(ye,Ee),be&&e.onMetaCounterUpdated(ye,be),we&&e.onMetaCounterDeleted(ye,we)}));case 1:case"end":return e.stop()}}),e,this)})))})),r.abrupt("break",148);case 148:return r.abrupt("break",149);case 149:r.next=155;break;case 151:if(r.prev=151,r.t3=r.catch(0),!I(r.t3)){r.next=155;break}throw r.t3;case 155:case"end":return r.stop()}}),r,this,[[0,151],[48,61,64,67]])})))}},{key:"addHandler",value:function(e,t){this._openChannelHandlers.set(e,t)}},{key:"removeHandler",value:function(e){this._openChannelHandlers.delete(e)}},{key:"clearHandler",value:function(){this._openChannelHandlers.clear()}},{key:"getChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),t.prev=1,t.next=4,this.getChannelFromCache(e);case 4:if(!(r=t.sent)){t.next=7;break}return t.abrupt("return",r);case 7:t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:return t.next=13,this.getChannelWithoutCache(e);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),n,this,[[1,9]])})))}},{key:"getChannelWithoutCache",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return b(this,void 0,void 0,t().mark((function r(){var a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return pt(U("string",e)).throw(S.invalidParameters),a=new Uh({channelUrl:e,isInternalCall:n}),t.next=4,this._requestQueue.send(a);case 4:return s=t.sent,i=s.as(Oh),o=i.channel,t.next=8,this.upsertChannelsToCache([o]);case 8:return t.abrupt("return",o);case 9:case"end":return t.stop()}}),r,this)})))}},{key:"createChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Mh),e),pt(Ah(r)).throw(S.invalidParameters),a=new Rh(r),t.next=5,this._requestQueue.send(a);case 5:return s=t.sent,i=s.as(Oh),o=i.channel,this.upsertChannelsToCache([o]),t.abrupt("return",o);case 9:case"end":return t.stop()}}),n,this)})))}}],[{key:"of",value:function(e){return Gh[e]}}]),n}(),Hh={name:null,coverUrlOrImage:null,data:null,customType:null,operatorUserIds:null},jh=function(e){return D("string",e.operatorUserIds,!0)&&(U("string",e.coverUrlOrImage)||P(e.coverUrlOrImage)||null===e.coverUrlOrImage)&&U("string",e.name,!0)&&U("string",e.data,!0)&&U("string",e.customType,!0)},Vh=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.token,o=e.limit;return(a=t.call(this)).method=T.GET,a.path="".concat(Ce,"/").concat(encodeURIComponent(s),"/participants"),a.params={token:i,limit:o},a}return s(n)}($),Qh=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.participants=[];var i=a.next,o=a.participants;return s.token=i,s.participants=o.map((function(t){return new lu(e,t)})),s}return s(n)}(ee),Bh=function(n){i(u,n);var a=f(u);function u(t,n,s){return r(this,u),a.call(this,t,n,e.ChannelType.OPEN,s)}return s(u,[{key:"_validate",value:function(){return _(o(u.prototype),"_validate",this).call(this)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=20;break}if(this._isLoading){e.next=17;break}if(!this._hasNext){e.next=14;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new Vh(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as(Qh),o=i.participants,u=i.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,e.abrupt("return",o);case 14:return e.abrupt("return",[]);case 17:throw S.queryInProgress;case 18:e.next=21;break;case 20:throw S.invalidParameters;case 21:case"end":return e.stop()}}),e,this)})))}}]),u}(cr),Kh=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl,i=e.coverUrlOrImage,o=e.name,u=e.data,c=e.customType,l=e.operatorUserIds;return(a=t.call(this)).method=T.PUT,a.path="".concat(Ce,"/").concat(encodeURIComponent(s)),a.params=X({cover_url:U("string",i)?i:null,cover_file:P(i)?i:null,name:o,data:u,custom_type:c,operators:l}),a}return s(n)}($),zh=function(e){i(n,e);var t=f(n);function n(e,a){var s;return r(this,n),(s=t.call(this,e,a)).channel=new Yh(e,a),s}return s(n)}(ee),Wh=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.channelUrl;return(a=t.call(this)).method=T.DELETE,a.path="".concat(Ce,"/").concat(encodeURIComponent(s)),a}return s(n)}($),Yh=function(n){i(u,n);var a=f(u);function u(t,n){var s,i;return r(this,u),(s=a.call(this,t,n))._lastParticipantCountUpdated=0,s.participantCount=0,s.operators=[],s.channelType=e.ChannelType.OPEN,s.participantCount=null!==(i=n.participant_count)&&void 0!==i?i:0,s.operators=Array.isArray(n.operators)?n.operators.map((function(e){return new vt(t,e)})):[],s}return s(u,[{key:"serialize",value:function(){return ht(this)}},{key:"isOperator",value:function(e){return e instanceof vt?this.isOperator(e.userId):this.operators.some((function(t){return t.userId===e}))}},{key:"_updateParticipantCount",value:function(e,t){return t>this._lastParticipantCountUpdated&&(this.participantCount=e,this._lastParticipantCountUpdated=t,!0)}},{key:"createParticipantListQuery",value:function(e){return new Bh(this._iid,this.url,e)}},{key:"refresh",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qh.of(this._iid),e.next=3,n.getChannelWithoutCache(this.url);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"enter",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Dh({channelUrl:this.url}),e.next=4,r.send(a);case 4:s=e.sent,i=s.as(Lh),o=i.participantCount,u=i.ts,this._updateParticipantCount(o,u),qh.of(this._iid).setEnteredToCache(this);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"exit",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Ph({channelUrl:this.url}),e.next=4,r.send(a);case 4:s=e.sent,i=s.as(Fh),o=i.participantCount,u=i.ts,this._updateParticipantCount(o,u),qh.of(this._iid).setExitedToCache(this),Xn.of(this._iid).fileMessageQueue.cancel(this);case 11:case"end":return e.stop()}}),e,this)})))}},{key:"updateChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){var r,a,s,i,o,u,c,l;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object.assign(Object.assign({},Hh),e),pt(jh(r)).throw(S.invalidParameters),a=At.of(this._iid),s=a.requestQueue,i=new Kh(Object.assign({channelUrl:this.url},r)),t.next=6,s.send(i);case 6:return o=t.sent,u=o.as(zh),c=u.channel,l=qh.of(this._iid),t.next=11,l.upsertChannelsToCache([c]);case 11:return t.abrupt("return",c);case 12:case"end":return t.stop()}}),n,this)})))}},{key:"updateChannelWithOperatorUserIds",value:function(e,n,r,a,s){return b(this,void 0,void 0,t().mark((function i(){var o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Object.assign(Object.assign({},Hh),{name:e,coverUrlOrImage:n,data:r,operatorUserIds:a,customType:s}),t.abrupt("return",this.updateChannel(o));case 2:case"end":return t.stop()}}),i,this)})))}},{key:"delete",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=At.of(this._iid),r=n.requestQueue,a=new Wh({channelUrl:this.url}),e.next=4,r.send(a);case 4:return s=qh.of(this._iid),e.next=7,s.removeChannelsFromCache([this.url]);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"sendUserMessage",value:function(e){return pt(!e.isPinnedMessage).throw(S.notSupportedError),_(o(u.prototype),"sendUserMessage",this).call(this,e)}},{key:"sendFileMessage",value:function(e){return pt(!e.isPinnedMessage).throw(S.notSupportedError),_(o(u.prototype),"sendFileMessage",this).call(this,e)}}],[{key:"payloadify",value:function(e){return e?X(Object.assign(Object.assign({},cu.payloadify(e)),{participant_count:e.participantCount,operators:e.operators.map((function(e){return vt.payloadify(e)}))})):null}}]),u}(cu),Jh=function(e){i(n,e);var t=f(n);function n(){var e;return r(this,n),(e=t.apply(this,arguments)).onUserEntered=ue,e.onUserExited=ue,e.onChannelParticipantCountChanged=ue,e}return s(n)}(bh),Xh=function(e){i(n,e);var t=f(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,n),e=t.call(this),Object.keys(a).forEach((function(t){e.hasOwnProperty(t)&&(e[t]=a[t])})),e}return s(n)}(Jh),Zh=function(e){i(n,e);var t=f(n);function n(e){var a;r(this,n);var s=e.token,i=e.limit,o=e.nameKeyword,u=e.urlKeyword,c=e.customTypes,l=e.includeFrozen,h=e.includeMetaData;return(a=t.call(this)).method=T.GET,a.path=Ce,a.params=X({token:s,limit:i,name_contains:o,url_contains:u,custom_types:c,show_frozen:l,show_metadata:h}),a}return s(n)}($),$h=function(e){i(n,e);var t=f(n);function n(e,a){var s;r(this,n),(s=t.call(this,e,a)).token=null,s.channels=[],s.ts=null;var i=a.next,o=a.channels,u=a.ts;return s.token=i,o&&o.length>0&&(s.channels=o.map((function(t){return new Yh(e,t)}))),s.ts="number"==typeof u?u:null,s}return s(n)}(ee),ed=function(e){i(a,e);var n=f(a);function a(e,t){var s,i,o,u,c,l;return r(this,a),(s=n.call(this,e,t)).includeFrozen=!0,s.includeMetaData=!0,s.nameKeyword=null,s.urlKeyword=null,s.customTypes=null,s.includeFrozen=null===(i=t.includeFrozen)||void 0===i||i,s.includeMetaData=null===(o=t.includeMetaData)||void 0===o||o,s.nameKeyword=null!==(u=t.nameKeyword)&&void 0!==u?u:null,s.urlKeyword=null!==(c=t.urlKeyword)&&void 0!==c?c:null,s.customTypes=null!==(l=t.customTypes)&&void 0!==l?l:null,s}return s(a,[{key:"_validate",value:function(){return _(o(a.prototype),"_validate",this).call(this)&&U("boolean",this.includeFrozen)&&U("boolean",this.includeMetaData)&&U("string",this.nameKeyword,!0)&&U("string",this.urlKeyword,!0)&&D("string",this.customTypes,!0)}},{key:"next",value:function(){return b(this,void 0,void 0,t().mark((function e(){var n,r,a,s,i,o,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._validate()){e.next=23;break}if(this._isLoading){e.next=20;break}if(!this._hasNext){e.next=17;break}return this._isLoading=!0,n=At.of(this._iid),r=n.requestQueue,a=new Zh(Object.assign(Object.assign({},this),{token:this._token})),e.next=8,r.send(a);case 8:return s=e.sent,i=s.as($h),o=i.channels,u=i.token,this._token=u,this._hasNext=!!u,c=qh.of(this._iid),e.next=15,c.upsertChannelsToCache(o);case 15:return this._isLoading=!1,e.abrupt("return",o);case 17:return e.abrupt("return",[]);case 20:throw S.queryInProgress;case 21:e.next=24;break;case 23:throw S.invalidParameters;case 24:case"end":return e.stop()}}),e,this)})))}}]),a}(nr),td=function(e){i(a,e);var n=f(a);function a(){var e;return r(this,a),(e=n.apply(this,arguments)).name="openChannel",e}return s(a,[{key:"init",value:function(e,t){var n=t.sdkState,r=t.dispatcher,s=t.sessionManager,i=t.requestQueue,u=t.logger,c=t.onlineDetector,l=t.cacheContext;_(o(a.prototype),"init",this).call(this,e,{sdkState:n,dispatcher:r,sessionManager:s,requestQueue:i,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new qh(e,{sdkState:n,dispatcher:r,requestQueue:i})}},{key:"createOpenChannelListQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ed(this._iid,e)}},{key:"addOpenChannelHandler",value:function(e,t){this._manager.addHandler(e,t)}},{key:"removeOpenChannelHandler",value:function(e){this._manager.removeHandler(e)}},{key:"removeAllOpenChannelHandlers",value:function(){this._manager.clearHandler()}},{key:"buildOpenChannelFromSerializedData",value:function(e){return this._manager.buildOpenChannelFromSerializedData(e)}},{key:"getChannel",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.getChannel(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"getChannelWithoutCache",value:function(e){return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.getChannelWithoutCache(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"createChannel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return b(this,void 0,void 0,t().mark((function n(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._manager.createChannel(e));case 1:case"end":return t.stop()}}),n,this)})))}},{key:"createChannelWithOperatorUserIds",value:function(e,n,r,a,s){return b(this,void 0,void 0,t().mark((function i(){var o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(o=Object.assign({},Mh)).name=e,o.coverUrlOrImage=n,o.data=r,o.operatorUserIds=a,o.customType=s,t.abrupt("return",this._manager.createChannel(o));case 7:case"end":return t.stop()}}),i,this)})))}}]),a}(Gt);return e.AdminMessage=cn,e.AppleCriticalAlertOptions=$t,e.ApplicationUserListQuery=Ls,e.BannedUserListQuery=so,e.BaseChannel=cu,e.BaseMessage=nn,e.BlockedUserListQuery=Gs,e.ConnectionHandler=jr,e.Emoji=Cs,e.EmojiCategory=Ts,e.EmojiContainer=Is,e.FileMessage=yn,e.FriendListQuery=js,e.GroupChannel=ph,e.GroupChannelCollection=gh,e.GroupChannelEventContext=Jc,e.GroupChannelFilter=xu,e.GroupChannelHandler=xh,e.GroupChannelListQuery=Qc,e.GroupChannelModule=Sh,e.Member=Eu,e.MemberListQuery=Sl,e.MemoryStore=Ai,e.MessageCollection=gl,e.MessageCollectionInitHandler=ml,e.MessageEventContext=Xc,e.MessageFilter=Yr,e.MessageMetaArray=Jt,e.MessageModule=pr,e.MessageRequestHandler=Zn,e.MessageSearchQuery=ur,e.MutedUserListQuery=no,e.OGImage=Xt,e.OGMetaData=Zt,e.OpenChannel=Yh,e.OpenChannelHandler=Xh,e.OpenChannelListQuery=ed,e.OpenChannelModule=td,e.OperatorListQuery=$i,e.Participant=lu,e.ParticipantListQuery=Bh,e.Plugin=ln,e.PreviousMessageListQuery=lr,e.PublicGroupChannelListQuery=Eh,e.Reaction=Yt,e.ReactionEvent=Wt,e.ReadStatus=bu,e.RestrictedUser=Qi,e.RestrictionInfo=Vi,e.ScheduledMessageListQuery=Ih,e.SendbirdChat=du,e.SendbirdChatOptions=H,e.SendbirdError=S,e.Sender=rn,e.SessionHandler=Hr,e.ThreadInfo=Vt,e.ThreadInfoUpdateEvent=$n,e.Thumbnail=sn,e.User=vt,e.UserEventHandler=Vr,e.UserMessage=_n,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
