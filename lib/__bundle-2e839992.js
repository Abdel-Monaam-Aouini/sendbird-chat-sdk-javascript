import{_ as e,e as t,u as n,g as r,O as s,a0 as a,X as i,U as o,a7 as u,a$ as c,s as l,q as h,o as d,p as _,b as p,c as f,r as v,K as m,a as g,i as E,ae as C,T as y,aV as M,N as b,A as N,d as U,f as S,h as T,b0 as A,ao as I,aY as w,W as D,ah as L,b1 as P,aa as R,aE as F,V as k,x as O,Y as x,aA as H,B as G,a_ as V,aC as B,aH as q,az as W,aK as j,ak as z,b2 as Q,E as Y,y as K,z as J,an as X,aD as Z,ai as $,b3 as ee,aW as te,aX as ne,m as re,ac as se,ap as ae,b4 as ie,aq as oe,ab as ue,au as ce,al as le,Q as he,aJ as de}from"./__bundle-fdefc164.js";import{w as _e,N as pe,D as fe,G as ve,H as me,E as ge,p as Ee,q as Ce,J as ye,K as Me,z as be,r as Ne,L as Ue,Q as Se,T as Te,V as Ae,W as Ie,X as we,Y as De,Z as Le,_ as Pe,$ as Re,a0 as Fe,a1 as ke,a2 as Oe,a3 as xe,a4 as He,a5 as Ge,a6 as Ve,a7 as Be,a8 as qe,a9 as We,aa as je,ab as ze,ac as Qe,ad as Ye,ae as Ke,af as Je,ag as Xe,ah as Ze,ai as $e,aj as et,ak as tt,al as nt,t as rt,am as st,an as at,ao as it,ap as ot,aq as ut,ar as ct,as as lt,at as ht}from"./__bundle-bd25634c.js";import{G as dt,g as _t,D as pt,c as ft,R as vt,U as mt,a as gt,b as Et,A as Ct}from"./__bundle-8934878d.js";import{C as yt,a as Mt,b as bt,O as Nt,P as Ut,M as St,c as Tt,R as At,U as It,A as wt,T as Dt}from"./__bundle-6f8fc428.js";var Lt;!function(e){e.NONE="none",e.JOINED="joined",e.INVITED="invited",e.LEFT="left"}(Lt||(Lt={}));var Pt,Rt,Ft,kt,Ot,xt,Ht,Gt,Vt=function(i){function o(e,t){var n=i.call(this,e,t)||this;return n.state=null,n.role=null,n.isMuted=!1,n.isBlockedByMe=!1,n.isBlockingMe=!1,n.state=s(Lt,t.state)?t.state:null,n.role=s(a,t.role)?t.role:null,"boolean"==typeof t.is_muted&&(n.isMuted=t.is_muted),"boolean"==typeof t.is_blocked_by_me&&(n.isBlockedByMe=t.is_blocked_by_me),"boolean"==typeof t.is_blocking_me&&(n.isBlockingMe=t.is_blocking_me),n}return e(o,i),o.payloadify=function(e){return t(n(r(r({},i.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})))},o}(_e),Bt=function(t){function n(e,n){var r,s,a=this;return(a=t.call(this,e)||this).channelUrl=null!==(r=n.channel_url)&&void 0!==r?r:"",a.channelType=null!==(s=n.channel_type)&&void 0!==s?s:i.GROUP,a.reader=new o(a._iid,n.user),a.readAt=n.ts,a}return e(n,t),n}(u);!function(e){e.ALL="all",e.PUBLIC="public",e.PRIVATE="private"}(Pt||(Pt={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Rt||(Rt={})),function(e){e.ALL="all",e.SUPER="super",e.NON_SUPER="nonsuper",e.BROADCAST_ONLY="broadcast_only",e.EXCLUSIVE_ONLY="exclusive_only"}(Ft||(Ft={})),function(e){e.ALL="all",e.UNREAD_MESSAGE="unread_message"}(kt||(kt={})),function(e){e.ALL="all",e.UNHIDDEN="unhidden_only",e.HIDDEN="hidden_only",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Ot||(Ot={})),function(e){e.ALL="all",e.OPERATOR="operator",e.NONOPERATOR="nonoperator"}(xt||(xt={})),function(e){e.AND="AND",e.OR="OR"}(Ht||(Ht={})),function(e){e.MEMBER_NICKNAME="member_nickname",e.CHANNEL_NAME="channel_name"}(Gt||(Gt={}));var qt,Wt=function(){function e(){this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=!1,this.nicknameContainsFilter=null,this.nicknameStartsWithFilter=null,this.nicknameExactMatchFilter=null,this.channelNameContainsFilter="",this.myMemberStateFilter=Rt.ALL,this.customTypesFilter=null,this.channelUrlsFilter=null,this.superChannelFilter=Ft.ALL,this.publicChannelFilter=Pt.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=kt.ALL,this.hiddenChannelFilter=Ot.UNHIDDEN,this.includeFrozen=!0}return e.prototype._isFriend=function(e){return!(!e||!e.friendDiscoveryKey&&!e.friendName)},Object.defineProperty(e.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),e.prototype.setSearchFilter=function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={query:t,fields:e})},Object.defineProperty(e.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),e.prototype.setUserIdsFilter=function(e,t,n){void 0===n&&(n=Ht.AND),this._userIdsFilter={userIds:e,includeMode:t,queryType:n}},e.prototype.clone=function(){var t,n=new e;this.searchFilter&&n.setSearchFilter(this.searchFilter.fields,null!==(t=this.searchFilter.query)&&void 0!==t?t:void 0),this.userIdsFilter&&n.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var r=JSON.parse(JSON.stringify(this));return Object.keys(r).forEach((function(e){n[e]=r[e]})),n},e.prototype.match=function(e,t){if(this._searchFilter){var n=this._searchFilter,r=n.query,s=n.fields;if(r&&s&&s.length>0&&!s.some((function(t){switch(t){case Gt.CHANNEL_NAME:return e.name.toLowerCase().includes(r.toLowerCase());case Gt.MEMBER_NICKNAME:return e.members.some((function(e){return e.nickname.toLowerCase().includes(r.toLowerCase())}));default:return!0}})))return!1}if(this._userIdsFilter){var a=this._userIdsFilter,i=a.userIds,o=a.includeMode,u=a.queryType,l=e.members.map((function(e){return e.userId}));if(o){if(i.length>0)switch(u){case Ht.AND:if(i.some((function(e){return!l.includes(e)})))return!1;break;case Ht.OR:if(i.every((function(e){return!l.includes(e)})))return!1}}else{if(i.includes(t)||i.push(t),e.members.length>i.length)return!1;if(!c(i,l))return!1}}if(!this.includeEmpty&&!e.lastMessage)return!1;if(!this.includeFrozen&&e.isFrozen)return!1;if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return!1;if(this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(e.customType))return!1;if(this.channelNameContainsFilter&&!e.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var h=this.nicknameContainsFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().includes(h)})))return!1}if(this.nicknameStartsWithFilter){var d=this.nicknameStartsWithFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase().startsWith(d)})))return!1}if(this.nicknameExactMatchFilter){var _=this.nicknameExactMatchFilter.toLowerCase();if(!e.members.some((function(e){return e.userId!==t&&e.nickname.toLowerCase()!=_})))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(e.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case Rt.JOINED:if("joined"!==e.myMemberState)return!1;break;case Rt.INVITED:if("invited"!==e.myMemberState)return!1;break;case Rt.INVITED_BY_FRIEND:if("invited"!==e.myMemberState||!this._isFriend(e.inviter))return!1;break;case Rt.INVITED_BY_NON_FRIEND:if("invited"!==e.myMemberState||this._isFriend(e.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case Ot.UNHIDDEN:if(e.isHidden||"unhidden"!==e.hiddenState)return!1;break;case Ot.HIDDEN:if(!e.isHidden)return!1;break;case Ot.HIDDEN_ALLOW_AUTO_UNHIDE:if(!e.isHidden||"hidden_allow_auto_unhide"!==e.hiddenState)return!1;break;case Ot.HIDDEN_PREVENT_AUTO_UNHIDE:if(!e.isHidden||"hidden_prevent_auto_unhide"!==e.hiddenState)return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===kt.UNREAD_MESSAGE)if(0===e.unreadMessageCount)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case Pt.PUBLIC:if(!e.isPublic)return!1;break;case Pt.PRIVATE:if(e.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case Ft.SUPER:if(!e.isSuper)return!1;break;case Ft.NON_SUPER:if(e.isSuper)return!1}return!(this.createdAfter&&e.createdAt<this.createdAfter)&&!(this.createdBefore&&e.createdAt>this.createdBefore)},e}(),jt=function(t){function n(e,n){var r=n.sdkState,s=n.cacheContext,a=t.call(this,e)||this;return a._channels=new Map,a._sdkState=r,a._cacheContext=s,a}return e(n,t),Object.defineProperty(n.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return l(!!e).throw(h.databaseError),e.collection(pe)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n.prototype._serialize=function(e,t){return void 0===t&&(t=0),r(r({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:t})},n.prototype._deserialize=function(e){return nr.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(n.prototype,"channels",{get:function(){return d([],_(this._channels.values()),!1)},enumerable:!1,configurable:!0}),n.prototype.isCachedInMemory=function(e){return this._channels.has(e)},n.prototype.filterOffsetChanged=function(e){var t=this;return e.filter((function(e){if(t._channels.has(e.url))return t._channels.get(e.url).messageOffsetTimestamp<e.messageOffsetTimestamp}))},n.prototype.get=function(e){return p(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(t=r.sent())return n=this._deserialize(t),this._channels.set(e,n),[2,n];r.label=2;case 2:return[2,void 0];case 3:return[2,this._channels.get(e)]}}))}))},n.prototype.fetch=function(e){var t=e.token,n=e.limit,r=void 0===n?fe:n,s=e.backward,a=void 0!==s&&s,i=e.filter,o=void 0===i?new Wt:i,u=e.order,c=void 0===u?dt.LATEST_LAST_MESSAGE:u,l=e.borderlineChannelUrl;return p(this,void 0,void 0,(function(){var e,n,s,i,u=this;return f(this,(function(h){switch(h.label){case 0:return this.localCacheEnabled?(e=_t(c),n={where:function(e){if(t)switch(c){case dt.CHANNEL_NAME_ALPHABETICAL:if(!a&&e.name.localeCompare(t)<0||a&&e.name.localeCompare(t)>0)return!1;if(l&&l===e.url)return!1;break;case dt.CHRONOLOGICAL:if(!a&&e.createdAt>t||a&&e.createdAt<t)return!1;if(l&&l===e.url)return!1;break;case dt.LATEST_LAST_MESSAGE:if(!a&&e.lastMessageUpdatedAt>t||a&&e.lastMessageUpdatedAt<t)return!1;if(l&&l===e.url)return!1}return o.match(u._deserialize(e),u._sdkState.userId)},index:e,backward:a},[4,this.collection.query(n)]):[3,3];case 1:return[4,h.sent().fetch({limit:r})];case 2:return s=h.sent(),(i=s.map((function(e){return u._deserialize(e)}))).forEach((function(e){u._channels.has(e.url)||u._channels.set(e.url,e)})),[2,i];case 3:return[2,[]]}}))}))},n.prototype.upsert=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s,a=this;return f(this,(function(i){switch(i.label){case 0:if(n=[],e.forEach((function(e){if(a._channels.has(e.url)){var r=a._channels.get(e.url);r._pinnedMessagesUpdatedAt<e._pinnedMessagesUpdatedAt&&(r._pinnedMessagesUpdatedAt=e._pinnedMessagesUpdatedAt),e.cachedMetaData&&t&&(r._updateCachedMetaData(e.cachedMetaData,t),Object.assign(e,{_cachedMetaData:void 0})),r._update(e),n.push(r)}else a._channels.set(e.url,e),n.push(e)})),!this.localCacheEnabled)return[3,2];for(s in r=[],n)r.push(this._serialize(n[s],parseInt(s)));return[4,this.collection.upsertMany(r)];case 1:i.sent(),i.label=2;case 2:return[2,n]}}))}))},n.prototype.remove=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,a,i;return f(this,(function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),t=v(e),n=t.next(),o.label=1;case 1:return n.done?[3,4]:(r=n.value,this._channels.delete(r),this.localCacheEnabled?[4,this.collection.remove(r)]:[3,3]);case 2:o.sent(),o.label=3;case 3:return n=t.next(),[3,1];case 4:return[3,7];case 5:return s=o.sent(),a={error:s},[3,7];case 6:try{n&&!n.done&&(i=t.return)&&i.call(t)}finally{if(a)throw a.error}return[7];case 7:return[2]}}))}))},n.prototype.clear=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.clearMemoryCache=function(){this._channels.clear()},n.prototype._setBlockStateOfAllChannels=function(e,t,n){return p(this,void 0,void 0,(function(){var r,s,a,i,o,u,c,l,h,d,_,p,m,g,E,C,y,M,b;return f(this,(function(f){switch(f.label){case 0:if(r=[],e===this._sdkState.userId)try{for(s=v(this._channels.values()),a=s.next();!a.done;a=s.next()){l=a.value;try{for(g=void 0,i=v(l.members),o=i.next();!o.done;o=i.next())if((_=o.value).userId===t){_.isBlockedByMe=n,r.push(l);break}}catch(e){g={error:e}}finally{try{o&&!o.done&&(E=i.return)&&E.call(i)}finally{if(g)throw g.error}}}}catch(e){p={error:e}}finally{try{a&&!a.done&&(m=s.return)&&m.call(s)}finally{if(p)throw p.error}}else if(t===this._sdkState.userId)try{for(u=v(this._channels.values()),c=u.next();!c.done;c=u.next()){l=c.value;try{for(M=void 0,h=v(l.members),d=h.next();!d.done;d=h.next())if((_=d.value).userId===e){_.isBlockingMe=n,r.push(l);break}}catch(e){M={error:e}}finally{try{d&&!d.done&&(b=h.return)&&b.call(h)}finally{if(M)throw M.error}}}}catch(e){C={error:e}}finally{try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(C)throw C.error}}return r.length>0?[4,this.upsert(r)]:[3,2];case 1:f.sent(),f.label=2;case 2:return[2]}}))}))},n.prototype.block=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!0)];case 1:return n.sent(),[2]}}))}))},n.prototype.unblock=function(e,t){return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._setBlockStateOfAllChannels(e,t,!1)];case 1:return n.sent(),[2]}}))}))},n.prototype.markAsRead=function(e,t){return void 0===t&&(t=d([],_(this._channels.keys()),!1)),p(this,void 0,void 0,(function(){var n,r,s,a,i,o,u,c;return f(this,(function(l){switch(l.label){case 0:n=[],l.label=1;case 1:l.trys.push([1,6,7,8]),r=v(t),s=r.next(),l.label=2;case 2:return s.done?[3,5]:(a=s.value,[4,this.get(a)]);case 3:(null==(i=l.sent())?void 0:i._updateUnreadMemberState(this._sdkState.userId,e))&&(i._updateUnreadCount(0,0),n.push(i)),l.label=4;case 4:return s=r.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),u={error:o},[3,8];case 7:try{s&&!s.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 8:return n.length>0?[4,this.upsert(n)]:[3,10];case 9:l.sent(),l.label=10;case 10:return[2]}}))}))},n}(u),zt={invitedUserIds:void 0,channelUrl:void 0,coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isSuper:void 0,isBroadcast:void 0,isExclusive:void 0,isPublic:void 0,isDiscoverable:void 0,isStrict:void 0,isEphemeral:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Qt=function(e){return m("string",e.invitedUserIds,!0)&&g("string",e.channelUrl,!0)&&g("string",e.coverUrl,!0)&&(E(e.coverImage)||g("string",e.coverImage,!0))&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isSuper,!0)&&g("boolean",e.isBroadcast,!0)&&g("boolean",e.isExclusive,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isStrict,!0)&&g("boolean",e.isDiscoverable,!0)&&g("boolean",e.isEphemeral,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&m("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)},Yt={customTypes:void 0,includeEmpty:!1,includeFrozen:!0,includeChatNotification:!1},Kt=function(e){return m("string",e.customTypes,!0)&&g("boolean",e.includeEmpty)&&g("boolean",e.includeFrozen)&&g("boolean",e.includeChatNotification)},Jt={myMemberStateFilter:Rt.ALL},Xt=function(e){return s(Rt,e.myMemberStateFilter)};!function(e){e.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",e.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",e.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",e.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",e.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",e.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",e.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",e.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",e.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"}(qt||(qt={}));var Zt={keys:[]},$t={channelCustomTypesFilter:void 0,superChannelFilter:Ft.ALL},en=function(e){return m("string",e.channelCustomTypesFilter,!0)&&s(Ft,e.superChannelFilter)},tn={channelUrl:void 0,scheduledStatus:void 0,messageTypeFilter:C.ALL},nn=r({},y),rn=function(e){return e.startsWith("EVENT_")||e===y.SYNC_CHANNEL_CHANGELOGS||e===y.REFRESH_CHANNEL},sn=function(t){function n(e){var n=e.channels,r=e.source,s=e.isWebSocketEventComing,a=void 0!==s&&s,i=e.data,o=void 0===i?null:i,u=e.ts,c=t.call(this)||this;return c.channels=n,c.source=r,c.isWebSocketEventComing=a,c.data=o,c.ts=u,c}return e(n,t),n}(M),an=function(t){function n(e){var n=e.channelUrls,r=e.source,s=e.isWebSocketEventComing,a=void 0!==s&&s,i=t.call(this)||this;return i.channelUrls=n,i.source=r,i.isWebSocketEventComing=a,i}return e(n,t),n}(M),on=function(){function e(e){var t=e.groupChannelCache,n=e.messageCache,r=e.unsentMessageCache,s=e.dispatcher,a=this;this._observers=new Map,s.on((function(e){return p(a,void 0,void 0,(function(){var s,a,i,o,u,c,l,h,d,_,m,g,E,C,y=this;return f(this,(function(M){switch(M.label){case 0:if(!(e instanceof sn))return[3,10];s=e.channels,m=e.source,g=e.isWebSocketEventComing,a=e.data,i=s.filter((function(e){return e instanceof hs})),o=t.filterOffsetChanged(i),M.label=1;case 1:M.trys.push([1,6,7,8]),u=v(o),c=u.next(),M.label=2;case 2:return c.done?[3,5]:(l=c.value,[4,n.removeUnderOffset(l.url,l.messageOffsetTimestamp)]);case 3:M.sent(),M.label=4;case 4:return c=u.next(),[3,2];case 5:return[3,8];case 6:return h=M.sent(),E={error:h},[3,8];case 7:try{c&&!c.done&&(C=u.return)&&C.call(u)}finally{if(E)throw E.error}return[7];case 8:return[4,t.upsert(i,e.ts)];case 9:return d=M.sent(),g||this._broadcastUpdateEvent(d,m,a),[3,15];case 10:return e instanceof an?(_=e.channelUrls,m=e.source,g=e.isWebSocketEventComing,[4,t.remove(_)]):[3,13];case 11:return M.sent(),[4,b((function(){return p(y,void 0,void 0,(function(){var e,t,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:u.trys.push([0,6,7,8]),e=v(_),t=e.next(),u.label=1;case 1:return t.done?[3,5]:(s=t.value,[4,n.removeMessagesOfChannel(s)]);case 2:return u.sent(),[4,r.removeMessagesOfChannel(s)];case 3:u.sent(),u.label=4;case 4:return t=e.next(),[3,1];case 5:return[3,8];case 6:return a=u.sent(),i={error:a},[3,8];case 7:try{t&&!t.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}return[7];case 8:return[2]}}))}))}))];case 12:return M.sent(),g||this._broadcastRemoveEvent(_,m),[3,15];case 13:return e instanceof pt?[4,t.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,15];case 14:M.sent(),M.label=15;case 15:return[2]}}))}))}))}return e.prototype._broadcastUpdateEvent=function(e,t,n){var r,s;try{for(var a=v(this._observers.values()),i=a.next();!i.done;i=a.next()){var o=i.value;o.onUpdate&&o.onUpdate(e,t,n)}}catch(e){r={error:e}}finally{try{i&&!i.done&&(s=a.return)&&s.call(a)}finally{if(r)throw r.error}}},e.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var s=v(this._observers.values()),a=s.next();!a.done;a=s.next()){var i=a.value;i.onRemove&&i.onRemove(e,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},e.prototype.subscribe=function(e,t){this._observers.set(e,t)},e.prototype.unsubscribe=function(e){this._observers.delete(e)},e.prototype.unsubscribeAll=function(){this._observers.clear()},e}(),un=function(s){function a(e){var a=e.userId,i=e.ts,o=e.token,u=e.filter,c=e.includeChatNotification,l=void 0!==c&&c,h=s.call(this)||this,d=r(r({},Yt),u),_=d.customTypes,p=d.includeEmpty,f=d.includeFrozen;return h.method=N.GET,h.path="".concat(U,"/").concat(encodeURIComponent(a),"/my_group_channels/changelogs"),h.params=t(n({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:i||null,token:o,custom_types:_,show_empty:p,show_frozen:f,include_chat_notification:l})),h}return e(a,s),a}(S),cn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.updatedChannels=n.updated.map((function(t){return new hs(e,Object.assign(t,{ts:n.ts}))})),r.deletedChannelUrls=n.deleted,r.hasMore=n.has_more,r.token=n.next,r.ts=n.ts,r}return e(n,t),n}(T),ln=function(t){function n(e){var n=e.channelUrl,r=e.isInternalCall,s=t.call(this)||this;return s.method=N.GET,s.path="".concat(r?A:I,"/").concat(encodeURIComponent(n)),s.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},s}return e(n,t),n}(S),hn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new hs(e,n),r}return e(n,t),n}(T),dn={includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1,channelUrlsFilter:void 0,customTypesFilter:void 0,customTypeStartsWithFilter:void 0,nicknameContainsFilter:void 0,nicknameStartsWithFilter:void 0,nicknameExactMatchFilter:void 0,channelNameContainsFilter:void 0,myMemberStateFilter:Rt.ALL,unreadChannelFilter:kt.ALL,superChannelFilter:Ft.ALL,publicChannelFilter:Pt.ALL,hiddenChannelFilter:Ot.ALL,userIdsFilter:{userIds:[],includeMode:!0,queryType:Ht.AND},searchFilter:{query:void 0,fields:[]},metadataKey:void 0,metadataValues:void 0,metadataOrderKeyFilter:void 0,metadataValueStartsWith:void 0,order:dt.LATEST_LAST_MESSAGE,createdAfter:void 0,createdBefore:void 0},_n=function(n){function r(e){var r=this,s=e.userId,a=e.token,i=e.limit,o=e.order,u=e.includeEmpty,c=e.myMemberStateFilter,l=e.superChannelFilter,h=e.publicChannelFilter,d=e.unreadChannelFilter,_=e.nicknameContainsFilter,p=e.nicknameStartsWithFilter,f=e.nicknameExactMatchFilter,v=e.channelNameContainsFilter,m=e.channelUrlsFilter,g=e.customTypesFilter,E=e.customTypeStartsWithFilter,C=e.hiddenChannelFilter,y=e.metadataOrderKeyFilter,M=e.metadataKey,b=e.metadataValues,S=e.metadataValueStartsWith,T=e.includeFrozen,A=e.includeMetaData,I=e.searchFilter,w=e.userIdsFilter,D=e.includeChatNotification,L=void 0!==D&&D,P=e.createdAfter,R=e.createdBefore;return(r=n.call(this)||this).method=N.GET,r.path="".concat(U,"/").concat(encodeURIComponent(s),"/my_group_channels"),r.params=t({token:a,limit:i,order:null!=o?o:dn.order,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:null!=u?u:dn.includeEmpty,member_state_filter:null!=c?c:dn.myMemberStateFilter,super_mode:null!=l?l:dn.superChannelFilter,public_mode:null!=h?h:dn.publicChannelFilter,unread_filter:null!=d?d:dn.unreadChannelFilter,members_nickname_contains:_,members_nickname_startswith:p,members_nickname:f,name_contains:v,channel_urls:m,custom_types:g,custom_type_startswith:E,hidden_mode:C,metadata_order_key:y,metadata_key:M,metadata_values:b,metadata_value_startswith:S,show_frozen:T,show_metadata:A,include_chat_notification:L,created_after:P,created_before:R}),I&&I.query&&I.fields&&(r.params.search_query=I.query,r.params.search_fields=I.fields),w&&w.userIds&&w.userIds.length>0&&(w.includeMode?(r.params.members_include_in=w.userIds,r.params.query_type=w.queryType.toUpperCase()):r.params.members_exactly_in=w.userIds),r}return e(r,n),r}(S),pn=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.channels=[];var s=n.next,a=n.channels,i=n.ts;return r.token=s,a&&a.length>0&&(r.channels=a.map((function(t){return t.ts=i,new hs(e,t)}))),r.ts=null!=i?i:0,r}return e(n,t),n}(T),fn=function(t){function n(e){var n=e.userId,r=e.filter,s=t.call(this)||this,a=r.myMemberStateFilter;return s.method=N.GET,s.path="".concat(U,"/").concat(encodeURIComponent(n),"/group_channel_count"),s.params={state:null!=a?a:Rt.ALL},s}return e(n,t),n}(S),vn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.groupChannelCount=n.group_channel_count,r}return e(n,t),n}(T),mn=function(n){function r(e){var r=e.userId,s=e.filter,a=n.call(this)||this,i=s.keys;return a.method=N.GET,a.path="".concat(U,"/").concat(encodeURIComponent(r),"/unread_item_count"),a.params=t({item_keys:i}),a}return e(r,n),r}(S),gn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return"number"==typeof n[qt.GROUP_CHANNEL_UNREAD_MENTION_COUNT]&&(r.groupChannelUnreadMentionCount=n[qt.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),"number"==typeof n[qt.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]&&(r.groupChannelUnreadMessageCount=n[qt.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),"number"==typeof n[qt.GROUP_CHANNEL_INVITATION_COUNT]&&(r.groupChannelInvitationCount=n[qt.GROUP_CHANNEL_INVITATION_COUNT]),"number"==typeof n[qt.SUPER_UNREAD_MENTION_COUNT]&&(r.superGroupChannelUnreadMentionCount=n[qt.SUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[qt.SUPER_UNREAD_MESSAGE_COUNT]&&(r.superGroupChannelUnreadMessageCount=n[qt.SUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[qt.SUPER_INVITATION_COUNT]&&(r.superGroupChannelInvitationCount=n[qt.SUPER_INVITATION_COUNT]),"number"==typeof n[qt.NONSUPER_UNREAD_MENTION_COUNT]&&(r.nonSuperGroupChannelUnreadMentionCount=n[qt.NONSUPER_UNREAD_MENTION_COUNT]),"number"==typeof n[qt.NONSUPER_UNREAD_MESSAGE_COUNT]&&(r.nonSuperGroupChannelUnreadMessageCount=n[qt.NONSUPER_UNREAD_MESSAGE_COUNT]),"number"==typeof n[qt.NONSUPER_INVITATION_COUNT]&&(r.nonSuperGroupChannelInvitationCount=n[qt.NONSUPER_INVITATION_COUNT]),r}return e(n,t),n}(T),En=function(t){function n(e){var n=e.userId,r=t.call(this)||this;return r.method=N.GET,r.path="".concat(U,"/").concat(encodeURIComponent(n),"/unread_channel_count"),r}return e(n,t),n}(S),Cn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.unreadCount=n.unread_count,r}return e(n,t),n}(T),yn=function(t){function n(e){var n=e.userId,r=e.filter,s=e.includeFeedChannel,a=void 0!==s&&s,i=t.call(this)||this,o=r.channelCustomTypesFilter,u=r.superChannelFilter;return i.method=N.GET,i.path="".concat(U,"/").concat(encodeURIComponent(n),"/unread_message_count"),i.params={super_mode:null!=u?u:Ft.ALL,custom_types:o,include_feed_channel:a},i}return e(n,t),n}(S),Mn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.unreadCount=n.unread_count,r.unreadFeedCount=n.unread_feed_count,r}return e(n,t),n}(T),bn=function(t){function n(e){var n=e.channelUrl,r=e.scheduledStatus,s=e.messageTypeFilter,a=t.call(this)||this;return a.method=N.GET,a.path="".concat(w,"/count"),a.params={channel_url:n,status:Un(r)},s&&(a.params.message_type=s),a}return e(n,t),n}(S),Nn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.count=n.count,r}return e(n,t),n}(T),Un=function(e){if(!e)return[];var t=[];return e.forEach((function(e){switch(e){case ve.PENDING:t.push(me.PENDING);break;case ve.SENT:t.push(me.IN_QUEUE),t.push(me.SENT);break;case ve.CANCELED:t.push(me.CANCELED);break;case ve.FAILED:t.push(me.FAILED)}})),t},Sn=function(n){function r(e){var r=this,s=e.userId,a=e.channelUrl,i=e.coverUrl,o=e.coverImage,u=e.isDistinct,c=e.isSuper,l=e.isBroadcast,h=e.isPublic,p=e.isExclusive,f=e.isDiscoverable,v=e.isStrict,m=e.isEphemeral,g=e.accessCode,E=e.name,C=e.data,y=e.customType,M=e.messageSurvivalSeconds,b=e.invitedUserIds,U=e.operatorUserIds;return(r=n.call(this)||this).method=N.POST,r.path=I,r.params=t({user_ids:d([s],_(null!=b?b:[]),!1).filter((function(e,t,n){return t===n.indexOf(e)})),channel_url:a,cover_url:i,cover_file:o,is_distinct:u,is_super:c,is_broadcast:l,is_exclusive:p,is_public:h,is_discoverable:f,strict:v,is_ephemeral:m,access_code:g,name:E,data:C,custom_type:y,operator_ids:U,message_survival_seconds:M}),r}return e(r,n),r}(S),Tn=function(t){function n(e,n){var r,s=this;return(s=t.call(this,e,n)||this).channel=new hs(e,n),s.isCreated=null===(r=n.is_created)||void 0===r||r,s}return e(n,t),n}(T),An=function(t){function n(e){var n=e.userId,r=e.channelUrls,s=t.call(this)||this;return s.method=N.PUT,s.path="".concat(U,"/").concat(encodeURIComponent(n),"/mark_as_read_all"),s.params={channel_urls:r},s}return e(n,t),n}(S);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(T);var In=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,a=e.accessCode;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/join"),n.params={user_id:s,access_code:a},n}return e(n,t),n}(S),wn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new hs(e,n),r}return e(n,t),n}(T),Dn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,a=r.data,i=a.member_count,o=void 0===i?0:i,u=a.joined_member_count,c=void 0===u?0:u,l=a.users,h=void 0===l?null:l;return s.memberCount=o,s.joinedMemberCount=c,s.members=Array.isArray(h)?h.map((function(t){return new Vt(e,t)})):[new Vt(e,r.data)],s}return e(n,t),n}(yt),Ln=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,a=e.shouldRemoveOperatorStatus;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/leave"),n.params={user_id:s,should_remove_operator_status:a},n}return e(n,t),n}(S);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(T);var Pn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,a=r.data,i=a.member_count,o=void 0===i?0:i,u=a.joined_member_count,c=void 0===u?0:u;return s.memberCount=o,s.joinedMemberCount=c,s.member=new Vt(s._iid,r.data),s}return e(n,t),n}(yt),Rn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userIds;return(n=t.call(this)||this).method=N.POST,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/invite"),n.params={user_ids:s},n}return e(n,t),n}(S),Fn=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new hs(e,n),r}return e(n,t),n}(T),kn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this;s.inviter=null;var a=r.data,i=a.member_count,u=void 0===i?0:i,c=a.joined_member_count,l=void 0===c?0:c,h=a.inviter,d=a.invitees,_=void 0===d?[]:d;return s.memberCount=u,s.joinedMemberCount=l,h&&Object.keys(h).length>0&&(s.inviter=new o(e,h)),s.invitees=_.map((function(t){return new Vt(e,t)})),s}return e(n,t),n}(yt),On=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/decline"),n.params={user_id:s},n}return e(n,t),n}(S);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new hs(e,n),r.channel.myMemberState=Lt.NONE,r}e(n,t)}(T);var xn=function(t){function n(e,n,r){var s=t.call(this,e,n,r)||this,a=r.data,i=a.member_count,u=a.joined_member_count,c=a.inviter,l=a.invitee;return s.memberCount=null!=i?i:0,s.joinedMemberCount=null!=u?u:0,s.inviter=new o(e,c),s.invitee=new Vt(e,l),s}return e(n,t),n}(yt),Hn={hidePreviousMessages:!1,allowAutoUnhide:!0},Gn=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,a=e.hidePreviousMessages,i=e.allowAutoUnhide;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/hide"),n.params={user_id:s,hide_previous_messages:null!=a?a:Hn.hidePreviousMessages,allow_auto_unhide:null!=i?i:Hn.allowAutoUnhide},n}return e(n,t),n}(S),Vn=function(t){function n(e,n){var r=t.call(this,e,n)||this,s=n.ts_message_offset;return r.messageOffsetTimestamp=s,r}return e(n,t),n}(T),Bn=function(t){function n(e,n,r){var s,a,i,o=this;return(o=t.call(this,e,"SYEV",r)||this).allowAutoUnhide=null,o.hidePreviousMessages=null,o.messageOffsetTimestamp=null,r.data&&(o.allowAutoUnhide=null!==(s=r.data.allow_auto_unhide)&&void 0!==s?s:null,o.hidePreviousMessages=null!==(a=r.data.hide_previous_messages)&&void 0!==a?a:null),o.messageOffsetTimestamp=null!==(i=r.ts_message_offset)&&void 0!==i?i:null,o}return e(n,t),n}(D),qn=function(t){function n(e){var n=e.channelUrl,r=e.time;return t.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return e(n,t),n}(L),Wn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.user=new o(e,r.data),s}return e(n,t),n}(D),jn=function(t){function n(e){var n=e.channelUrl,r=e.time;return t.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:n,time:r}})||this}return e(n,t),n}(L),zn=function(t){function n(e,n,r){var s=t.call(this,e,"SYEV",r)||this;return s.user=new o(e,r.data),s}return e(n,t),n}(D),Qn=function(t){function n(e){var n=e.channelUrl,r=e.messageId;return t.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:n,msg_id:r}})||this}return e(n,t),n}(L),Yn=function(t){function a(e,n){var r,s,a,i,o,u,c,l,h,d,_,p,f,v,m,g,E,C,y,M,b,N,U,S=this;return(S=t.call(this,e,n)||this).includeEmpty=!1,S.includeFrozen=!0,S.includeMetaData=!0,S.includeChatNotification=!1,S.channelUrlsFilter=null,S.customTypesFilter=null,S.customTypeStartsWithFilter=null,S.nicknameContainsFilter=null,S.nicknameStartsWithFilter=null,S.nicknameExactMatchFilter=null,S.channelNameContainsFilter="",S.myMemberStateFilter=Rt.ALL,S.unreadChannelFilter=kt.ALL,S.superChannelFilter=Ft.ALL,S.publicChannelFilter=Pt.ALL,S.hiddenChannelFilter=Ot.UNHIDDEN,S.searchFilter={fields:[],query:null},S.userIdsFilter={userIds:[],includeMode:!0,queryType:Ht.AND},S.metadataKey=null,S.metadataValues=null,S.metadataOrderKeyFilter=null,S.metadataValueStartsWith=null,S.order=dt.LATEST_LAST_MESSAGE,S.includeEmpty=null!==(r=n.includeEmpty)&&void 0!==r&&r,S.includeFrozen=null===(s=n.includeFrozen)||void 0===s||s,S.includeMetaData=null===(a=n.includeMetaData)||void 0===a||a,S.includeChatNotification=null!==(i=n.includeChatNotification)&&void 0!==i&&i,S.channelUrlsFilter=null!==(o=n.channelUrlsFilter)&&void 0!==o?o:null,S.customTypesFilter=null!==(u=n.customTypesFilter)&&void 0!==u?u:null,S.customTypeStartsWithFilter=null!==(c=n.customTypeStartsWithFilter)&&void 0!==c?c:"",S.nicknameContainsFilter=null!==(l=n.nicknameContainsFilter)&&void 0!==l?l:null,S.nicknameStartsWithFilter=null!==(h=n.nicknameStartsWithFilter)&&void 0!==h?h:null,S.nicknameExactMatchFilter=null!==(d=n.nicknameExactMatchFilter)&&void 0!==d?d:null,S.channelNameContainsFilter=null!==(_=n.channelNameContainsFilter)&&void 0!==_?_:"",S.myMemberStateFilter=null!==(p=n.myMemberStateFilter)&&void 0!==p?p:Rt.ALL,S.unreadChannelFilter=null!==(f=n.unreadChannelFilter)&&void 0!==f?f:kt.ALL,S.superChannelFilter=null!==(v=n.superChannelFilter)&&void 0!==v?v:Ft.ALL,S.publicChannelFilter=null!==(m=n.publicChannelFilter)&&void 0!==m?m:Pt.ALL,S.hiddenChannelFilter=null!==(g=n.hiddenChannelFilter)&&void 0!==g?g:Ot.UNHIDDEN,S.searchFilter=null!==(E=n.searchFilter)&&void 0!==E?E:{fields:[],query:null},S.userIdsFilter=null!==(C=n.userIdsFilter)&&void 0!==C?C:{userIds:[],includeMode:!0,queryType:Ht.AND},S.metadataKey=null!==(y=n.metadataKey)&&void 0!==y?y:null,S.metadataValues=null!==(M=n.metadataValues)&&void 0!==M?M:null,S.metadataOrderKeyFilter=null!==(b=n.metadataOrderKeyFilter)&&void 0!==b?b:null,S.metadataValueStartsWith=null!==(N=n.metadataValueStartsWith)&&void 0!==N?N:null,S.order=null!==(U=n.order)&&void 0!==U?U:dt.LATEST_LAST_MESSAGE,n.createdAfter&&(S.createdAfter=n.createdAfter),n.createdBefore&&(S.createdBefore=n.createdBefore),S}return e(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.includeEmpty)&&g("boolean",this.includeFrozen)&&g("boolean",this.includeMetaData)&&g("string",this.channelNameContainsFilter)&&m("string",this.channelUrlsFilter,!0)&&m("string",this.customTypesFilter,!0)&&g("string",this.customTypeStartsWithFilter)&&g("string",this.nicknameContainsFilter,!0)&&g("string",this.nicknameStartsWithFilter,!0)&&g("string",this.nicknameExactMatchFilter,!0)&&s(Rt,this.myMemberStateFilter)&&s(Ft,this.superChannelFilter)&&s(Pt,this.publicChannelFilter)&&s(kt,this.unreadChannelFilter)&&s(Ot,this.hiddenChannelFilter)&&m(Gt,this.searchFilter.fields)&&g("string",this.searchFilter.query,!0)&&m("string",this.userIdsFilter.userIds)&&g("boolean",this.userIdsFilter.includeMode)&&s(Ht,this.userIdsFilter.queryType)&&s(dt,this.order)&&g("string",this.metadataOrderKeyFilter,!0)&&g("string",this.metadataKey,!0)&&m("string",this.metadataValues,!0)&&g("string",this.metadataValueStartsWith,!0)&&P(this.createdAfter,!0)&&P(this.createdBefore,!0)},a.prototype.serialize=function(){return R(this)},a.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,s;return f(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,nr.of(this._iid).getMyGroupChannels(this._token,n(r({},this)),this.limit)]):[3,2]:[3,5];case 1:return e=a.sent(),t=e.channels,s=e.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,t];case 2:return[2,[]];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},a}(F),Kn=function(t){function n(e,n,s){var a,i=this;return(i=t.call(this,e,"SYEV",s)||this).pinnedMessageIds=[],i.latestPinnedMessage=null,i.ts=0,s.data&&(i.pinnedMessageIds=null!==(a=s.data.pinned_message_ids)&&void 0!==a?a:[],i.latestPinnedMessage=s.data.latest_pinned_message?ge(e,r({},s.data.latest_pinned_message)):null),i.ts=s.ts,i}return e(n,t),n}(D),Jn=function(t){function n(e){var n=e.channelUrl;return t.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:n}})||this}return e(n,t),n}(L),Xn=function(t){function n(e,n,r){var s=t.call(this,e,"READ",r)||this;return s.readStatus=new Bt(e,r),s}return e(n,t),n}(D),Zn=function(n){function r(e){var r=e.channelUrl,s=e.userId,a=n.call(this)||this;return(a=n.call(this)||this).method=N.PUT,a.path="".concat(I,"/").concat(encodeURIComponent(r),"/messages/mark_as_delivered"),a.params=t({userId:s}),a}return e(r,n),r}(S);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(T);var $n,er=function(t){function n(e,n,r){var s=t.call(this,e,"DLVR",r)||this;return s.channelUrl=r.channel_url,s.deliveredStateUpdate=r.updated,s}return e(n,t),n}(D),tr={},nr=function(o){function u(e,t){var n,s=this;return(s=o.call(this,e,r(r({},t),{channelType:i.GROUP}))||this)._leftChannels=new Map,s._disableMack=!1,s._markAsReadAllLastSentAt=0,s._disableMack=null!==(n=t.disableMack)&&void 0!==n&&n,s._groupChannelHandlers=new Map,s._groupChannelCache=new jt(s._iid,{sdkState:t.sdkState,cacheContext:t.cacheContext}),s._groupChannelBroadcast=new on({dispatcher:t.dispatcher,groupChannelCache:s._groupChannelCache,messageCache:Ee.of(s._iid),unsentMessageCache:Ce.of(s._iid)}),setInterval((function(){var e,t,n=function(e){e.invalidateTypingStatus()&&(s._dispatcher.dispatch(new sn({channels:[e],source:y.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),s._groupChannelHandlers.forEach((function(t){t.onTypingStatusUpdated&&t.onTypingStatusUpdated(e)})))};try{for(var r=v(s._groupChannelCache.channels),a=r.next();!a.done;a=r.next()){n(a.value)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}),1e3),s._dispatcher.on((function(e){e instanceof D?s._handleEvent(e):e instanceof ft?p(s,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return t=e.message,[4,this.getChannel(t.channelUrl,!0)];case 1:return n=r.sent(),t instanceof ye?n._autoResendUserMessage(t):t instanceof Me&&n._autoResendFileMessage(t),[2]}}))})):e instanceof vt&&s.reduceDBSize()})),tr[e]||(tr[e]=s),s}return e(u,o),u.of=function(e){return tr[e]||(tr[e]=new u(e,k.of(e))),tr[e]},u.clear=function(e){tr[e]&&delete tr[e]},Object.defineProperty(u.prototype,"handlers",{get:function(){return d([],_(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),u.prototype.buildGroupChannelFromSerializedData=function(e){var t=O(e);return new hs(this._iid,hs.payloadify(t))},u.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var t=O(e);return new Yn(this._iid,t)},u.prototype.buildMemberFromSerializedData=function(e){var t=O(e);return new Vt(this._iid,Vt.payloadify(t))},u.prototype.getChannelFromCache=function(e){var t;return p(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,null!==(t=n.sent())&&void 0!==t?t:null]}}))}))},u.prototype.getChannelsFromCache=function(e,t,n,r,s){return p(this,void 0,void 0,(function(){return f(this,(function(a){switch(a.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:t,order:n,limit:r,borderlineChannelUrl:s})];case 1:return[2,a.sent()]}}))}))},u.prototype.upsertChannelsToCache=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.upsert(e)];case 1:return[2,t.sent()]}}))}))},u.prototype.removeChannelsFromCache=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._groupChannelCache.remove(e)];case 1:return t.sent(),[2]}}))}))},u.prototype.clearChannelsFromCache=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._groupChannelCache.clear()];case 1:return e.sent(),[2]}}))}))},u.prototype.reduceDBSize=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,a,i,o,u,c,l,h,d,_,p;return f(this,(function(f){switch(f.label){case 0:return e=Ee.of(this._iid),t=k.of(this._iid).cacheContext,n=t.localCacheConfig,r=t.nestdb,t.localCacheEnabled&&r&&r.state==Ne.OPENED?(s=1024*n.maxSize*1024,[4,r.estimateUsage()]):[2];case 1:if((a=f.sent())<s)return[2];i=[],o=this._groupChannelCache.channels,u={},d=0,f.label=2;case 2:return d<o.length?[4,this.getMessagesFromCache(o[d].url,0,"prev",new be)]:[3,5];case 3:c=f.sent(),u[o[d].url]=JSON.stringify(c).length,l=new x({channel:o[d],cachedMessageCount:c.length}),i.push(l),f.label=4;case 4:return d++,[3,2];case 5:h=i.sort(n.clearOrderComparator),d=0,f.label=6;case 6:return d<h.length?[4,e.removeMessagesOfChannel(h[d].channel.url)]:[3,10];case 7:return f.sent(),[4,e._getGroupChannelPreferenceSize(h[d].channel.url)];case 8:if(_=f.sent(),p=u[h[d].channel.url]+_,(a-=p)<s)return[3,10];f.label=9;case 9:return d++,[3,6];case 10:return[2]}}))}))},u.prototype._handleEvent=function(e){var t;return p(this,void 0,void 0,(function(){var n,r,s,o,u,c,l,h,d,_,m,g,E,C,M,N,U,S,T,A,I,w,D,L,P,R,F,O,x,z,Y,K,J,X,Z,$,ee,te,ne,re,se,ae,ie,oe,ue,ce,le,he,de,_e,pe,fe,ve,me,ge,Ee,Ce,ye,Me,be,Ne,He,Ge,Ve,Be,qe,We,je,ze,Qe,Ye,Ke,Je,Xe,Ze,$e,et,tt,nt,rt,st,at,it,ot,ut,ct,lt,ht,dt,_t,pt,ft,vt,Ct,Mt,Dt,Pt,Rt,Ft,kt,Ot,xt,Ht,Gt,Vt,Bt,qt,Wt,jt,zt,Qt,Yt,Kt,Jt,Xt,Zt,$t,en,tn,nn,rn,on,un,cn,ln,hn,dn,_n,pn,fn,vn,mn,gn,En,Cn,yn,Mn,bn,Nn=this;return f(this,(function(Un){switch(Un.label){case 0:switch(Un.trys.push([0,80,,81]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,35];case"SYEV":return[3,38];case"USEV":return[3,78]}return[3,79];case 1:return h=null,"MESG"===e.code?h=e.as(Oe):"FILE"===e.code?h=e.as(xe):"ADMM"!==e.code&&"BRDM"!=e.code||(h=e.as(wt)),h?(n=h.message,r=h.isMentioned,s=h.forceUpdateLastMessage,n.channelType!==i.GROUP?[3,3]:(this._disableMack||b((function(){return p(Nn,void 0,void 0,(function(){var e;return f(this,(function(t){return e=new Qn(n),this._requestQueue.send(e),[2]}))}))})),P=this._groupChannelCache.isCachedInMemory(n.channelUrl),g=n instanceof Re&&n.sender.userId===this._sdkState.userId,[4,this.getChannel(n.channelUrl,!0)])):[3,3];case 2:if((o=Un.sent()).hiddenState===is.HIDDEN_ALLOW_AUTO_UNHIDE&&(o.hiddenState=is.UNHIDDEN),n instanceof Re){u=k.of(this._iid).useMemberInfoInMessage;try{for(c=v(o.members),l=c.next();!l.done;l=c.next())if((pt=l.value).userId===n.sender.userId){u||(n.sender.nickname=pt.nickname,n.sender.plainProfileUrl=pt.plainProfileUrl,n.sender.metaData=pt.metaData,n.sender.isBlockedByMe=pt.isBlockedByMe);break}}catch(e){pn={error:e}}finally{try{l&&!l.done&&(fn=c.return)&&fn.call(c)}finally{if(pn)throw pn.error}}!u&&r&&(null===(t=n.mentionedUsers)||void 0===t||t.forEach((function(e){var t,n;try{for(var r=v(o.members),s=r.next();!s.done;s=r.next()){var a=s.value;if(e.userId===a.userId){e.nickname=a.nickname,e.plainProfileUrl=a.plainProfileUrl,e.metaData=a.metaData;break}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}))),g&&(M=this._sessionManager.currentUser)&&(M.nickname=n.sender.nickname,M.plainProfileUrl=n.sender.plainProfileUrl,M.metaData=n.sender.metaData)}n.silent&&!g||(o.isEphemeral||P)&&((!o.lastMessage||o.lastMessage.createdAt<n.createdAt)&&(o.lastMessage=n),g||o._updateUnreadCount(o.unreadMessageCount+1,o.unreadMentionCount+(r?1:0))),s&&(!o.lastMessage||o.lastMessage.createdAt<n.createdAt)&&(o.lastMessage=n),this._dispatcher.dispatch(new sn({channels:[o],source:y.EVENT_MESSAGE_RECEIVED})),n.silent&&!g||G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(o)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),this._dispatcher.dispatch(new W({messages:[n],source:y.EVENT_MESSAGE_RECEIVED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,s,a,i;return f(this,(function(u){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(s=t.value).onMessageReceived&&s.onMessageReceived(o,n),r&&s.onMentionReceived&&s.onMentionReceived(o,n)}catch(e){a={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(a)throw a.error}}return[2]}))}))})),Un.label=3;case 3:return[3,79];case 4:return h=null,"MEDI"===e.code?h=e.as(Fe):"FEDI"===e.code?h=e.as(ke):"AEDI"===e.code&&(h=e.as(It)),h?(d=h.message,_=h.mentionCountChange,d.channelType!==i.GROUP?[3,6]:(P=this._groupChannelCache.isCachedInMemory(d.channelUrl),[4,this.getChannel(d.channelUrl,!0)])):[3,6];case 5:m=Un.sent(),g=d instanceof Re&&d.sender.userId===this._sdkState.userId,E=!1,g?(C=d.sender,(M=this._sessionManager.currentUser)&&(M.nickname=C.nickname,M.plainProfileUrl=C.plainProfileUrl,M.metaData=C.metaData)):m.isReadMessage(d)||0!==_&&!d.silent&&P&&(m._updateUnreadCount(m.unreadMessageCount,m.unreadMentionCount+_),E=!0),!m.lastMessage||m.lastMessage.createdAt<d.createdAt?(m.lastMessage=d,E=!0):m.lastMessage.isIdentical(d)&&(P?m.lastMessage.updatedAt<d.updatedAt&&(m.lastMessage=d,E=!0):E=!0),N=!1,m.lastPinnedMessage&&m.lastPinnedMessage.messageId===d.messageId&&(m.lastPinnedMessage=d,E=!0,N=!0),E&&(this._dispatcher.dispatch(new sn({channels:[m],source:N?y.EVENT_PINNED_MESSAGE_UPDATED:y.EVENT_MESSAGE_UPDATED})),d.silent&&!g||G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(m)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),N&&G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPinnedMessageUpdated&&n.onPinnedMessageUpdated(m)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),this._dispatcher.dispatch(new W({messages:[d],source:y.EVENT_MESSAGE_UPDATED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageUpdated&&n.onMessageUpdated(m,d),0!==_&&n.onMentionReceived&&n.onMentionReceived(m,d)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Un.label=6;case 6:return[3,79];case 7:return U=e.as(Pe),he=U.channelUrl,de=U.channelType,S=U.messageId,de!==i.GROUP?[3,9]:[4,this.getChannel(he,!0)];case 8:T=Un.sent(),this._dispatcher.dispatch(new j({messageIds:[S],source:y.EVENT_MESSAGE_DELETED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onMessageDeleted&&n.onMessageDeleted(T,S)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Un.label=9;case 9:return[3,79];case 10:return(A=e.as(Xn).readStatus).channelType!==i.GROUP?[3,12]:(P=this._groupChannelCache.isCachedInMemory(A.channelUrl),[4,this.getChannel(A.channelUrl,!0)]);case 11:I=Un.sent(),P&&I._updateUnreadMemberState(A.reader.userId,A.readAt),A.reader.userId===this._sdkState.userId?P?(I.unreadMessageCount>0||I.unreadMentionCount>0)&&(I._updateUnreadCount(0,0),this._dispatcher.dispatch(new sn({channels:[I],source:y.EVENT_CHANNEL_READ})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(I)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))):0!==I.unreadMessageCount&&0!==I.unreadMentionCount||(this._dispatcher.dispatch(new sn({channels:[I],source:y.EVENT_CHANNEL_READ})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(I)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))):(this._dispatcher.dispatch(new sn({channels:[I],source:y.EVENT_CHANNEL_READ})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUnreadMemberStatusUpdated&&n.onUnreadMemberStatusUpdated(I)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),Un.label=12;case 12:return[3,79];case 13:return w=e.as(er),he=w.channelUrl,D=w.deliveredStateUpdate,L=void 0===D?{}:D,P=this._groupChannelCache.isCachedInMemory(he),[4,this.getChannel(he,!0)];case 14:if(R=Un.sent(),P)for(F in L)R._updateUndeliveredMemberState(F,L[F]);return Object.keys(L).some((function(e){return e!==Nn._sdkState.userId}))&&(this._dispatcher.dispatch(new sn({channels:[R],source:y.EVENT_CHANNEL_DELIVERED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onUndeliveredMemberStatusUpdated&&n.onUndeliveredMemberStatusUpdated(R)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),[3,79];case 15:return O=e.as(At),he=O.channelUrl,de=O.channelType,x=O.event,de!==i.GROUP?[3,18]:[4,this.getChannel(he,!0)];case 16:return z=Un.sent(),[4,this.getMessageFromCache(x.messageId)];case 17:(J=Un.sent())&&(J.applyReactionEvent(x),this._dispatcher.dispatch(new W({messages:[J],source:y.EVENT_MESSAGE_REACTION_UPDATED}))),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onReactionUpdated&&n.onReactionUpdated(z,x)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Un.label=18;case 18:return[3,79];case 19:return(Y=e.as(Tt).event).channelType!==i.GROUP?[3,22]:[4,this.getChannel(Y.channelUrl,!0)];case 20:return K=Un.sent(),[4,this.getMessageFromCache(Y.targetMessageId)];case 21:(J=Un.sent())&&(J.applyThreadInfoUpdateEvent(Y),this._dispatcher.dispatch(new W({messages:[J],source:y.EVENT_MESSAGE_THREADINFO_UPDATED}))),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onThreadInfoUpdated&&n.onThreadInfoUpdated(K,Y)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Un.label=22;case 22:return[3,79];case 23:X=e.as(St).groupChannelMemberCounts,Z=[],Un.label=24;case 24:Un.trys.push([24,29,30,31]),$=v(X),ee=$.next(),Un.label=25;case 25:return ee.done?[3,28]:(te=ee.value,he=te.channelUrl,nt=te.memberCount,rt=te.joinedMemberCount,ne=te.updatedAt,[4,this.getChannelFromCache(he)]);case 26:(re=Un.sent())&&re._setLatestMemberCount(nt,rt,ne)&&Z.push(re),Un.label=27;case 27:return ee=$.next(),[3,25];case 28:return[3,31];case 29:return se=Un.sent(),vn={error:se},[3,31];case 30:try{ee&&!ee.done&&(mn=$.return)&&mn.call($)}finally{if(vn)throw vn.error}return[7];case 31:return Z.length>0&&(this._dispatcher.dispatch(new sn({channels:Z,source:y.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelMemberCountChanged&&n.onChannelMemberCountChanged(Z)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}))),[3,79];case 32:return ae=e.as(Ut),ie=ae.event,oe=ae.status,he=ae.channelUrl,de=ae.channelType,he&&de===i.GROUP?[4,this.getChannel(he,!0)]:[3,34];case 33:ue=Un.sent(),this._dispatcher.dispatch(new q({event:ie,source:y.EVENT_POLL_UPDATED})),G(oe===Q?function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollDeleted&&n.onPollDeleted(ue,ie.pollId)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}:function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollUpdated&&n.onPollUpdated(ue,ie)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))}),Un.label=34;case 34:return[3,79];case 35:return ce=e.as(Le),le=ce.event,he=ce.channelUrl,de=ce.channelType,he&&de===i.GROUP?[4,this.getChannel(he,!0)]:[3,37];case 36:_e=Un.sent(),this._dispatcher.dispatch(new B({event:le,source:y.EVENT_POLL_VOTED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onPollVoted&&n.onPollVoted(_e,le)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),Un.label=37;case 37:return[3,79];case 38:if(!(pe=e.as(yt).event).isGroupChannelEvent)return[3,77];switch(pe.category){case bt.CHANNEL_JOIN:return[3,39];case bt.CHANNEL_LEAVE:return[3,41];case bt.CHANNEL_OPERATOR_UPDATE:return[3,45];case bt.CHANNEL_INVITE:return[3,47];case bt.CHANNEL_DECLINE_INVITE:return[3,49];case bt.TYPING_START:case bt.TYPING_END:return[3,51];case bt.USER_CHANNEL_MUTE:case bt.USER_CHANNEL_UNMUTE:return[3,53];case bt.USER_CHANNEL_BAN:return[3,55];case bt.USER_CHANNEL_UNBAN:return[3,59];case bt.CHANNEL_FREEZE:case bt.CHANNEL_UNFREEZE:return[3,61];case bt.CHANNEL_HIDE:return[3,63];case bt.CHANNEL_UNHIDE:return[3,65];case bt.CHANNEL_DELETED:return[3,67];case bt.CHANNEL_PROP_CHANGED:return[3,69];case bt.CHANNEL_META_DATA_CHANGED:return[3,71];case bt.CHANNEL_META_COUNTERS_CHANGED:return[3,73];case bt.PINNED_MESSAGE_CHANGED:return[3,75]}return[3,77];case 39:return[4,this.getChannel(pe.channelUrl,!0)];case 40:return fe=Un.sent(),ve=e.as(Dn),me=ve.memberCount,ge=ve.joinedMemberCount,Ee=ve.members,Ce=!1,Ee.forEach((function(e){fe.isExclusive||fe.isSuper||fe.isBroadcast?Ce=Ce||fe._setLatestMemberCount(me,ge,pe.ts):(e.state=Lt.JOINED,fe.addMember(e,pe.ts),Nn._updateJoinedMemberCount(fe)),e.userId===Nn._sdkState.userId&&(fe.myMemberState=Lt.JOINED)})),this._dispatcher.dispatch(new sn({channels:[fe],source:y.EVENT_CHANNEL_JOINED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){var t,n;try{for(var r=v(Ee),s=r.next();!s.done;s=r.next()){var a=s.value;e.onUserJoined&&e.onUserJoined(fe,a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}fe.isBroadcast&&Ce&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([fe])})),[2]}))}))})),[3,77];case 41:return(ft=this._leftChannels.get(pe.channelUrl))?(Me=ft.channel,[3,44]):[3,42];case 42:return[4,this.getChannel(pe.channelUrl,!0)];case 43:Me=Un.sent(),Un.label=44;case 44:return ye=Me,be=e.as(Pn),nt=be.memberCount,rt=be.joinedMemberCount,Ne=be.member,He=!1,Ge=k.of(this._iid).appInfo,ye.isExclusive||ye.isSuper||ye.isBroadcast?He=ye._setLatestMemberCount(nt,rt,pe.ts):((null==Ge?void 0:Ge.enabledChannelMemberShipHistory)?((Ve=ye.members.find((function(e){return e.userId===Ve.userId})))&&(Ve.state=Lt.LEFT),ye.memberCount=nt):ye.removeMember(Ne),this._updateJoinedMemberCount(ye)),Ne.userId===this._sdkState.userId?(ye.myMemberState=Lt.NONE,ye.invitedAt=0,ye.joinedAt=0,ye._updateUnreadCount(0,0),ye.isPublic?this._dispatcher.dispatch(new sn({channels:[ye],source:y.EVENT_CHANNEL_LEFT})):(this._markAsLeave(ye),this._dispatcher.dispatch(new an({channelUrls:[ye.url],source:y.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new sn({channels:[ye],source:y.EVENT_CHANNEL_LEFT})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserLeft&&e.onUserLeft(ye,Ne),ye.isBroadcast&&He&&e.onChannelMemberCountChanged&&e.onChannelMemberCountChanged([ye])})),[2]}))}))})),[3,77];case 45:return[4,this.getChannel(pe.channelUrl,!0)];case 46:Be=Un.sent(),qe=e.as(Nt).operators,We=qe.map((function(e){return e.userId}));try{for(je=v(Be.members),ze=je.next();!ze.done;ze=je.next())(pt=ze.value).role=We.includes(pt.userId)?a.OPERATOR:a.NONE}catch(e){gn={error:e}}finally{try{ze&&!ze.done&&(En=je.return)&&En.call(je)}finally{if(gn)throw gn.error}}return Be.myRole=We.includes(this._sdkState.userId)?a.OPERATOR:a.NONE,this._dispatcher.dispatch(new sn({channels:[Be],source:y.EVENT_CHANNEL_OPERATOR_UPDATED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onOperatorUpdated&&e.onOperatorUpdated(Be,qe)})),[2]}))}))})),[3,77];case 47:return[4,this.getChannel(pe.channelUrl,!0)];case 48:Qe=Un.sent(),Ye=e.as(kn),nt=Ye.memberCount,rt=Ye.joinedMemberCount,Ke=Ye.inviter,(Je=Ye.invitees).forEach((function(e){return e.state=Lt.INVITED}));try{for(Xe=v(Je),Ze=Xe.next();!Ze.done;Ze=Xe.next())$e=Ze.value,Qe.isExclusive||Qe.isSuper||Qe.isBroadcast?Qe._setLatestMemberCount(nt,rt,pe.ts):Qe.addMember($e,pe.ts),this._sdkState.userId===$e.userId&&(Qe.hiddenState=is.UNHIDDEN,Qe.myMemberState!==Lt.JOINED&&(Qe.myMemberState=Lt.INVITED),Qe.invitedAt=pe.ts)}catch(e){Cn={error:e}}finally{try{Ze&&!Ze.done&&(yn=Xe.return)&&yn.call(Xe)}finally{if(Cn)throw Cn.error}}return this._dispatcher.dispatch(new sn({channels:[Qe],source:y.EVENT_CHANNEL_INVITED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserReceivedInvitation&&e.onUserReceivedInvitation(Qe,Ke,Je)})),[2]}))}))})),[3,77];case 49:return[4,this.getChannel(pe.channelUrl,!0)];case 50:return et=Un.sent(),tt=e.as(xn),nt=tt.memberCount,rt=tt.joinedMemberCount,st=tt.inviter,at=tt.invitee,et.isExclusive||et.isSuper||et.isBroadcast?et._setLatestMemberCount(nt,rt,pe.ts):et.removeMember(at),this._sdkState.userId===at.userId?(et.invitedAt=0,et.myMemberState=Lt.NONE,et.isPublic?this._dispatcher.dispatch(new sn({channels:[et],source:y.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new an({channelUrls:[et.url],source:y.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new sn({channels:[et],source:y.EVENT_CHANNEL_DECLINED_INVITE})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserDeclinedInvitation&&e.onUserDeclinedInvitation(et,st,at)})),[2]}))}))})),[3,77];case 51:return[4,this.getChannel(pe.channelUrl,!0)];case 52:return it=Un.sent(),ot=pe.category===bt.TYPING_START,ut=e.as(ot?Wn:zn).user,it._updateTypingStatus(ut,ot?pe.ts:0),this._dispatcher.dispatch(new sn({channels:[it],source:y.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onTypingStatusUpdated&&e.onTypingStatusUpdated(it)})),[2]}))}))})),[3,77];case 53:return[4,this.getChannel(pe.channelUrl,!0)];case 54:ct=Un.sent(),lt=pe.category===bt.USER_CHANNEL_MUTE,(ht=e.as(lt?we:De).user).userId===this._sdkState.userId&&(ct.myMutedState=lt?V.MUTED:V.UNMUTED,ct._myMutedRemainingTime=ht.restrictionInfo.remainingDuration);try{for(dt=v(ct.members),_t=dt.next();!_t.done;_t=dt.next())if((pt=_t.value).userId===ht.userId){pt.isMuted=lt;break}}catch(e){Mn={error:e}}finally{try{_t&&!_t.done&&(bn=dt.return)&&bn.call(dt)}finally{if(Mn)throw Mn.error}}return this._dispatcher.dispatch(new sn({channels:[ct],source:lt?y.EVENT_CHANNEL_MUTED:y.EVENT_CHANNEL_UNMUTED,data:ht.userId})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){lt?e.onUserMuted&&e.onUserMuted(ct,ht):e.onUserUnmuted&&e.onUserUnmuted(ct,ht)})),[2]}))}))})),[3,77];case 55:return(ft=this._leftChannels.get(pe.channelUrl))?(Ct=ft.channel,[3,58]):[3,56];case 56:return[4,this.getChannel(pe.channelUrl,!0)];case 57:Ct=Un.sent(),Un.label=58;case 58:return vt=Ct,this._markAsLeave(vt),Mt=e.as(Ie).user,Mt.userId===this._sdkState.userId&&this._dispatcher.dispatch(new an({channelUrls:[vt.url],source:y.EVENT_CHANNEL_BANNED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserBanned&&e.onUserBanned(vt,Mt)})),[2]}))}))})),[3,77];case 59:return[4,this.getChannel(pe.channelUrl,!0)];case 60:return Dt=Un.sent(),Pt=e.as(Ae).user,Pt.userId===this._sdkState.userId&&this._dispatcher.dispatch(new an({channelUrls:[Dt.url],source:y.EVENT_CHANNEL_UNBANNED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onUserUnbanned&&e.onUserUnbanned(Dt,Pt)})),[2]}))}))})),[3,77];case 61:return[4,this.getChannel(pe.channelUrl,!0)];case 62:return Rt=Un.sent(),Ft=e.as(Te).freeze,Rt.isFrozen=Ft,this._dispatcher.dispatch(new sn({channels:[Rt],source:Ft?y.EVENT_CHANNEL_FROZEN:y.EVENT_CHANNEL_UNFROZEN})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Ft?e.onChannelFrozen&&e.onChannelFrozen(Rt):e.onChannelUnfrozen&&e.onChannelUnfrozen(Rt)})),[2]}))}))})),[3,77];case 63:return[4,this.getChannel(pe.channelUrl,!0)];case 64:return kt=Un.sent(),Ot=e.as(Bn),xt=Ot.allowAutoUnhide,Ht=Ot.hidePreviousMessages,Gt=Ot.messageOffsetTimestamp,null!==xt&&(kt.hiddenState=xt?is.HIDDEN_ALLOW_AUTO_UNHIDE:is.HIDDEN_PREVENT_AUTO_UNHIDE),null!==Ht&&Ht&&kt._updateUnreadCount(0,0),null!==Gt&&(kt.messageOffsetTimestamp=Gt),this._dispatcher.dispatch(new sn({channels:[kt],source:y.EVENT_CHANNEL_HIDDEN})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelHidden&&e.onChannelHidden(kt)})),[2]}))}))})),[3,77];case 65:return[4,this.getChannel(pe.channelUrl,!0)];case 66:return(Vt=Un.sent()).hiddenState=is.UNHIDDEN,this._dispatcher.dispatch(new sn({channels:[Vt],source:y.EVENT_CHANNEL_UNHIDDEN})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(Vt)})),[2]}))}))})),[3,77];case 67:return[4,this.getChannel(pe.channelUrl,!0)];case 68:return Bt=Un.sent(),this._dispatcher.dispatch(new an({channelUrls:[pe.channelUrl],source:y.EVENT_CHANNEL_DELETED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelDeleted&&e.onChannelDeleted(Bt.url,Bt.channelType)})),[2]}))}))})),[3,77];case 69:return[4,this.getChannelWithoutCache(pe.channelUrl,!0)];case 70:return qt=Un.sent(),this._dispatcher.dispatch(new sn({channels:[qt],source:y.EVENT_CHANNEL_UPDATED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onChannelChanged&&e.onChannelChanged(qt)})),[2]}))}))})),[3,77];case 71:return[4,this.getChannel(pe.channelUrl,!0)];case 72:return Wt=Un.sent(),jt=e.as(Se),zt=jt.created,Qt=jt.updated,Yt=jt.deleted,zt&&(Wt._upsertCachedMetaData(zt,pe.ts),this._dispatcher.dispatch(new sn({channels:[Wt],source:y.EVENT_CHANNEL_METADATA_CREATED}))),Qt&&(Wt._upsertCachedMetaData(Qt,pe.ts),this._dispatcher.dispatch(new sn({channels:[Wt],source:y.EVENT_CHANNEL_METADATA_UPDATED}))),Yt&&(Wt._removeFromCachedMetaData(Yt,pe.ts),this._dispatcher.dispatch(new sn({channels:[Wt],source:y.EVENT_CHANNEL_METADATA_DELETED}))),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){zt&&e.onMetaDataCreated&&e.onMetaDataCreated(Wt,zt),Qt&&e.onMetaDataUpdated&&e.onMetaDataUpdated(Wt,Qt),Yt&&e.onMetaDataDeleted&&e.onMetaDataDeleted(Wt,Yt)})),[2]}))}))})),[3,77];case 73:return[4,this.getChannel(pe.channelUrl,!0)];case 74:return Kt=Un.sent(),Jt=e.as(Ue),Xt=Jt.created,Zt=Jt.updated,$t=Jt.deleted,Xt&&this._dispatcher.dispatch(new sn({channels:[Kt],source:y.EVENT_CHANNEL_METACOUNTER_CREATED})),Zt&&this._dispatcher.dispatch(new sn({channels:[Kt],source:y.EVENT_CHANNEL_METACOUNTER_UPDATED})),$t&&this._dispatcher.dispatch(new sn({channels:[Kt],source:y.EVENT_CHANNEL_METACOUNTER_DELETED})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){Xt&&e.onMetaCounterCreated&&e.onMetaCounterCreated(Kt,Xt),Zt&&e.onMetaCounterUpdated&&e.onMetaCounterUpdated(Kt,Zt),$t&&e.onMetaCounterDeleted&&e.onMetaCounterDeleted(Kt,$t)})),[2]}))}))})),[3,77];case 75:return[4,this.getChannel(pe.channelUrl,!0)];case 76:return en=Un.sent(),tn=e.as(Kn),nn=tn.pinnedMessageIds,rn=tn.latestPinnedMessage,(on=tn.ts)>en._pinnedMessagesUpdatedAt&&(en.pinnedMessageIds=nn,en.lastPinnedMessage=rn,en._pinnedMessagesUpdatedAt=on,this._dispatcher.dispatch(new sn({channels:[en],source:y.EVENT_PINNED_MESSAGE_UPDATED})),G((function(){return p(Nn,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){try{for(e=v(this._groupChannelHandlers.values()),t=e.next();!t.done;t=e.next())(n=t.value).onChannelChanged&&n.onChannelChanged(en)}catch(e){r={error:e}}finally{try{t&&!t.done&&(s=e.return)&&s.call(e)}finally{if(r)throw r.error}}return[2]}))}))})),G((function(){return p(Nn,void 0,void 0,(function(){return f(this,(function(e){return this._groupChannelHandlers.forEach((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(en)})),[2]}))}))}))),[3,77];case 77:return[3,79];case 78:switch((un=e.as(mt).event).category){case gt.USER_BLOCK:cn=Et.getDataAsUserBlockEvent(this._iid,un),hn=cn.blocker,dn=cn.blockee,this._groupChannelCache.block(hn.userId,dn.userId);break;case gt.USER_UNBLOCK:ln=Et.getDataAsUserBlockEvent(this._iid,un),hn=ln.blocker,dn=ln.blockee,this._groupChannelCache.unblock(hn.userId,dn.userId)}return[3,79];case 79:return[3,81];case 80:if(_n=Un.sent(),H(_n))throw _n;return[3,81];case 81:return[2]}}))}))},u.prototype._markAsLeave=function(e){var t,n=this,r=null!==(t=this._leftChannels.get(e.url))&&void 0!==t?t:{channel:e,ref:0};r.ref++,this._leftChannels.set(e.url,r),setTimeout((function(){r.ref--,0===r.ref&&n._leftChannels.delete(e.url)}),1e4)},u.prototype.addHandler=function(e,t){this._groupChannelHandlers.set(e,t)},u.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},u.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},u.prototype.subscribeChannelEvent=function(e,t){this._groupChannelBroadcast.subscribe(e,t)},u.prototype.unsubscribeChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},u.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter((function(e){return e.state===Lt.JOINED})).length},u.prototype.getChannel=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n;return f(this,(function(r){switch(r.label){case 0:l(g("string",e)).throw(h.invalidParameters),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(n=r.sent())?[2,n]:[3,4];case 3:return r.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,t)];case 5:return[2,r.sent()]}}))}))},u.prototype.getChannelWithoutCache=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n,r,s,a,i;return f(this,(function(o){switch(o.label){case 0:return l(g("string",e)).throw(h.invalidParameters),n=new ln({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(n)];case 1:switch(r=o.sent(),s=r.as(hn).channel,a=s.unreadMessageCount,i=s.unreadMentionCount,s.myCountPreference){case as.UNREAD_MESSAGE_COUNT_ONLY:i=0;break;case as.UNREAD_MENTION_COUNT_ONLY:a=0;break;case as.OFF:a=0,i=0}return s._updateUnreadCount(a,i),[4,this.upsertChannelsToCache([s])];case 2:return[2,o.sent()[0]]}}))}))},u.prototype.refreshChannel=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=y.REFRESH_CHANNEL),p(this,void 0,void 0,(function(){var r,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),r=new ln({channelUrl:e,isInternalCall:t}),[4,this._requestQueue.send(r)];case 1:return s=u.sent(),(a=s.as(hn).channel).myMemberState!==Lt.NONE?[3,2]:(this._dispatcher.dispatch(new an({channelUrls:[a.url],source:n})),[3,4]);case 2:return[4,this.upsertChannelsToCache([a])];case 3:i=u.sent(),this._dispatcher.dispatch(new sn({channels:i,source:n})),u.label=4;case 4:return[3,6];case 5:return(o=u.sent()).code!==z.NON_AUTHORIZED&&o.code!==z.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new an({channelUrls:[e],source:n})),[3,6];case 6:return[2]}}))}))},u.prototype.getMyGroupChannels=function(e,t,n,s){return void 0===s&&(s=y.REQUEST_CHANNEL),p(this,void 0,void 0,(function(){var a,i,o,u,c;return f(this,(function(l){switch(l.label){case 0:return t.createdAfter&&(t.createdAfter=Math.floor(t.createdAfter/1e3)),t.createdBefore&&(t.createdBefore=Math.floor(t.createdBefore/1e3)),a=new _n(r(r({},t),{userId:this._sdkState.userId,token:e,limit:n})),[4,this._requestQueue.send(a)];case 1:return i=l.sent(),o=i.as(pn),u=o.channels,c=o.token,this._dispatcher.dispatch(new sn({channels:u,source:s})),[2,{channels:u,token:c}]}}))}))},u.prototype.getMyGroupChannelChangeLogs=function(e,t,s){return void 0===s&&(s=y.REQUEST_CHANNEL_CHANGELOGS),p(this,void 0,void 0,(function(){var a,i,o,u,c,d,_,p;return f(this,(function(f){switch(f.label){case 0:return a=r(r({},Yt),t),l((g("string",e)||g("number",e))&&Kt(a)).throw(h.invalidParameters),i=new un(n({userId:this._sdkState.userId,ts:"number"==typeof e?e:null,token:"string"==typeof e?e:null,filter:a})),[4,this._requestQueue.send(i)];case 1:return o=f.sent(),u=o.as(cn),c=u.updatedChannels,d=u.deletedChannelUrls,_=u.hasMore,p=u.ts,c.length>0&&this._dispatcher.dispatch(new sn({channels:c,source:s,ts:p})),d.length>0&&this._dispatcher.dispatch(new an({channelUrls:d,source:s})),[2,{updatedChannels:c,deletedChannelUrls:d,hasMore:_,token:u.token}]}}))}))},u.prototype.getGroupChannelCount=function(e){return p(this,void 0,void 0,(function(){var t,n,s;return f(this,(function(a){switch(a.label){case 0:return t=r(r({},Jt),e),l(Xt(t)).throw(h.invalidParameters),n=new fn({userId:this._sdkState.userId,filter:t}),[4,this._requestQueue.send(n)];case 1:return s=a.sent(),[2,s.as(vn).groupChannelCount]}}))}))},u.prototype.getUnreadItemCount=function(e){return p(this,void 0,void 0,(function(){var n,s,a,i,o,u,c,d,_,p,v,g,E,C,y,M;return f(this,(function(f){switch(f.label){case 0:return n=r(r({},Zt),e),l(function(e){return m(qt,e.keys)}(n)).throw(h.invalidParameters),s=k.of(this._iid),a=s.sdkState,i=s.requestQueue,o=new mn({userId:a.userId,filter:n}),[4,i.send(o)];case 1:return u=f.sent(),c=u.as(gn),d=c.groupChannelUnreadMentionCount,_=c.groupChannelUnreadMessageCount,p=c.groupChannelInvitationCount,v=c.superGroupChannelUnreadMentionCount,g=c.superGroupChannelUnreadMessageCount,E=c.superGroupChannelInvitationCount,C=c.nonSuperGroupChannelUnreadMentionCount,y=c.nonSuperGroupChannelUnreadMessageCount,M=c.nonSuperGroupChannelInvitationCount,[2,t({groupChannelUnreadMentionCount:d,groupChannelUnreadMessageCount:_,groupChannelInvitationCount:p,superGroupChannelUnreadMentionCount:v,superGroupChannelUnreadMessageCount:g,superGroupChannelInvitationCount:E,nonSuperGroupChannelUnreadMentionCount:C,nonSuperGroupChannelUnreadMessageCount:y,nonSuperGroupChannelInvitationCount:M})]}}))}))},u.prototype.getTotalUnreadChannelCount=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){switch(a.label){case 0:return e=k.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new En({userId:t.userId}),[4,n.send(r)];case 1:return s=a.sent(),[2,s.as(Cn).unreadCount]}}))}))},u.prototype.getTotalUnreadMessageCount=function(e){return p(this,void 0,void 0,(function(){var t,n,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return t=r(r({},$t),e),l(en(t)).throw(h.invalidParameters),n=k.of(this._iid),s=n.sdkState,a=n.requestQueue,i=new yn({userId:s.userId,filter:t}),[4,a.send(i)];case 1:return o=u.sent(),[2,o.as(Mn).unreadCount]}}))}))},u.prototype.getTotalScheduledMessageCount=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){var t,n,a,i;return f(this,(function(o){switch(o.label){case 0:return t=r(r({},tn),e),l(function(e){return g("string",e.channelUrl,!0)&&m(ve,e.scheduledStatus,!0)&&s(C,e.messageTypeFilter)}(t)).throw(h.invalidParameters),n=k.of(this._iid).requestQueue,a=new bn(t),[4,n.send(a)];case 1:return i=o.sent(),[2,i.as(Nn).count]}}))}))},u.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=k.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},u.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,t=k.of(this._iid).subscribedUnreadMessageCount;for(var n in t.customTypes)e+=t.customTypes[n];return e},u.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var t;return null!==(t=k.of(this._iid).subscribedUnreadMessageCount.customTypes[e])&&void 0!==t?t:0},u.prototype.createChannel=function(e){return p(this,void 0,void 0,(function(){var t,n,s,a;return f(this,(function(i){switch(i.label){case 0:return t=r(r({},zt),e),l(Qt(t)).throw(h.invalidParameters),t.isPublic||(t.accessCode=void 0),n=new Sn(r({userId:this._sdkState.userId},t)),[4,this._requestQueue.send(n)];case 1:return s=i.sent(),a=s.as(Tn).channel,[4,this.upsertChannelsToCache([a])];case 2:return i.sent(),[2,a]}}))}))},u.prototype.markAsReadAll=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return e=Date.now(),l(e-this._markAsReadAllLastSentAt>=1e3).throw(h.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,t=new An({userId:this._sdkState.userId}),[4,this._requestQueue.send(t)];case 1:u.sent(),n=this._groupChannelCache.channels;try{for(r=v(n),s=r.next();!s.done;s=r.next())(a=s.value)._updateUnreadMemberState(this._sdkState.userId,e),a._updateUnreadCount(0,0)}catch(e){i={error:e}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}return n.length>0?[4,this.upsertChannelsToCache(n)]:[3,3];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},u.prototype.markAsReadWithChannelUrls=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,a,i,o,u,c;return f(this,(function(d){switch(d.label){case 0:return t=Date.now(),l(m("string",e)&&t-this._markAsReadAllLastSentAt>=1e3).throw(h.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=t,n=new An({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(n)];case 1:d.sent(),r=this._groupChannelCache.channels,s=[];try{for(a=v(r),i=a.next();!i.done;i=a.next())o=i.value,e.includes(o.url)&&(o._updateUnreadMemberState(this._sdkState.userId,t),o._updateUnreadCount(0,0),s.push(o))}catch(e){u={error:e}}finally{try{i&&!i.done&&(c=a.return)&&c.call(a)}finally{if(u)throw u.error}}return s.length>0?[4,this.upsertChannelsToCache(s)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}}))}))},u.prototype.markAsDelivered=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.getChannel(e)];case 1:return[4,t.sent().markAsDelivered()];case 2:return t.sent(),[2]}}))}))},u}(Mt);!function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.END=2]="END"}($n||($n={}));var rr,sr=function(t){function n(e,n,r,s){var a=t.call(this)||this;return a._state=$n.IDLE,a._retryCount=0,a._retryLimit=3,a.priority=0,a._worker=n,a}return e(n,t),Object.defineProperty(n.prototype,"isIdle",{get:function(){return this._state===$n.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRunning",{get:function(){return this._state===$n.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDone",{get:function(){return this._state===$n.END},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),n.prototype._run=function(e){return p(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:if(!this.isRunning)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return t=r.sent(),this._retryCount=0,this.dispatch("progress",t),t.hasNext?this._run(t.nextToken):this.end(),[3,4];case 3:return n=r.sent(),this.dispatch("error",n),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}}))}))},n.prototype.start=function(e){this.isIdle&&(this._state=$n.RUNNING,this._run(e))},n.prototype.stop=function(){this._state=$n.IDLE,this.dispatch("stop")},n.prototype.end=function(){this._state=$n.END,this.dispatch("end")},n}(Y),ar={},ir=function(){function e(e){var t=e._iid,n=e.channel,r=e.limit,s=void 0===r?100:r,a=this;this.ref=0,this._iid=t,this._channel=n,this._limit=s,this._prevSyncLoopCount=0,this._nextSyncLoopCount=0;var i,o,u=k.of(this._iid),c=u.sdkState,l=u.dispatcher,v=u.logger;this._metadataKey=(i=c.userId,o=n.url,"sendbird:".concat(i,"@groupchannel/").concat(o,"/message/sync.meta"));var m=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/sync")}(c.userId,n.url);this._prevSync=new sr(m,(function(e){return p(a,void 0,void 0,(function(){var t,n,r,s,a,i,o,u,c,l;return f(this,(function(p){switch(p.label){case 0:return t={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,[4,this.loadMetadata(e)];case 1:if(p.sent(),v.debug("message background prev sync from",null===(i=this._metadata)||void 0===i?void 0:i.range.top),null===(o=this._metadata)||void 0===o?void 0:o.previousComplete)return[3,9];p.label=2;case 2:return p.trys.push([2,5,,8]),[4,He.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(c=null===(u=this._metadata)||void 0===u?void 0:u.range)||void 0===c?void 0:c.top)?this._metadata.range.top:e,{prevResultSize:this._limit,nextResultSize:0,replyType:X.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},y.SYNC_MESSAGE_BACKGROUND)];case 3:return(n=p.sent()).length>0&&(r=n.map((function(e){return e.createdAt})),(null===(l=this._metadata)||void 0===l?void 0:(a=l.range).intersect.apply(a,d([],_(r),!1)))?this.extendRange(n):this._metadata={range:new Dt({top:Math.min.apply(Math,d([],_(r),!1)),bottom:Math.max.apply(Math,d([],_(r),!1))}),previousComplete:!1}),t.hasNext=n.length>=this._limit&&this._prevSyncLoopCount<1,this._metadata&&(t.nextToken=this._metadata.range.top,this._metadata.previousComplete=n.length<this._limit),v.debug("message background prev sync progress",t),[4,this.saveMetadata()];case 4:return p.sent(),[3,8];case 5:return s=p.sent(),v.debug("message background prev sync error",s),s instanceof h&&s.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:p.sent(),p.label=7;case 7:throw s;case 8:return[3,10];case 9:t.hasNext=!1,p.label=10;case 10:return[2,t]}}))}))})),this._nextSync=new sr(m,(function(e){return p(a,void 0,void 0,(function(){var t,n,r,s,a,i,o,u,c;return f(this,(function(l){switch(l.label){case 0:return t={hasNext:!0,nextToken:0},this._nextSyncLoopCount++,[4,this.loadMetadata(e)];case 1:l.sent(),v.debug("message background next sync from",null===(i=this._metadata)||void 0===i?void 0:i.range.bottom),l.label=2;case 2:return l.trys.push([2,5,,6]),[4,He.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,(null===(u=null===(o=this._metadata)||void 0===o?void 0:o.range)||void 0===u?void 0:u.bottom)?this._metadata.range.bottom:e,{prevResultSize:0,nextResultSize:this._limit,replyType:X.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},y.SYNC_MESSAGE_BACKGROUND)];case 3:return(n=l.sent()).length>0&&(r=n.map((function(e){return e.createdAt})),(null===(c=this._metadata)||void 0===c?void 0:(a=c.range).intersect.apply(a,d([],_(r),!1)))?this.extendRange(n):this._metadata={range:new Dt({top:Math.min.apply(Math,d([],_(r),!1)),bottom:Math.max.apply(Math,d([],_(r),!1))}),previousComplete:!1}),t.hasNext=n.length>=this._limit&&this._nextSyncLoopCount<1,this._metadata&&(t.nextToken=this._metadata.range.bottom),v.debug("message background next sync progress",t),[4,this.saveMetadata()];case 4:return l.sent(),[3,6];case 5:throw s=l.sent(),v.debug("message background next sync error",s),s;case 6:return[2,t]}}))}))})),this._connectionEventContext=l.on((function(e){if(e instanceof K)if(e.stateType===J.CONNECTED)a.resume();else a.pause()}))}return e.of=function(t,n){return ar[t]||(ar[t]={}),ar[t][n.url]||(ar[t][n.url]=new e({_iid:t,channel:n})),ar[t][n.url].ref++,ar[t][n.url]},e.clear=function(e,t){ar[e]&&ar[e][t]&&(ar[e][t].close(),delete ar[e])},Object.defineProperty(e.prototype,"range",{get:function(){var e,t;return null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.range)&&void 0!==t?t:new Dt({})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previousComplete",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.previousComplete)},enumerable:!1,configurable:!0}),e.prototype.isWrappingMessages=function(e){var t;return null===(t=this.range)||void 0===t?void 0:t.includes.apply(t,d([],_(e.map((function(e){return e.createdAt}))),!1))},e.prototype.extendRange=function(e){var t;this._metadata&&(t=this._metadata.range).extends.apply(t,d([],_(e.map((function(e){return e.createdAt}))),!1))},e.prototype.loadMetadata=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return this._metadata?[3,2]:[4,k.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:(t=n.sent())?t.range.bottom<e?this._metadata={range:new Dt({}),previousComplete:!1}:this._metadata={range:new Dt(t.range),previousComplete:t.previousComplete}:this._metadata={range:new Dt({}),previousComplete:!1},n.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,k.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,k.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(e){var t,n,r,s;void 0===e&&(e=Date.now());var a=k.of(this._iid),i=a.logger;a.connectionManager.isConnected&&(i.debug("message background sync resume()"),this._prevSyncLoopCount=this._nextSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start(null!==(n=null===(t=this._metadata)||void 0===t?void 0:t.range.top)&&void 0!==n?n:e),this._nextSync.start(null!==(s=null===(r=this._metadata)||void 0===r?void 0:r.range.bottom)&&void 0!==s?s:e))},e.prototype.pause=function(){k.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ar[this._iid][this._channel.url])},e}(),or={},ur=function(){function e(e){var t=e._iid,n=e.channel,r=this;this.ref=0,this._iid=t,this._channel=n;var s,a,i=k.of(this._iid),o=i.logger,u=i.sdkState,c=i.dispatcher;this._metadataKey=(s=u.userId,a=n.url,"sendbird:".concat(s,"@groupchannel/").concat(a,"/message/changelogs.meta"));var l=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/message/changelogs")}(u.userId,this._channel.url);this._sync=new sr(l,(function(){return p(r,void 0,void 0,(function(){var e,t,n,r,s,a,i,u;return f(this,(function(c){switch(c.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:c.sent(),o.debug("message changelog sync from",null===(u=this._metadata)||void 0===u?void 0:u.token),c.label=2;case 2:return c.trys.push([2,5,,8]),[4,He.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,{replyType:X.ALL,includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0},y.SYNC_MESSAGE_CHANGELOGS)];case 3:return t=c.sent(),n=t.updatedMessages,r=t.deletedMessageIds,s=t.hasMore,a=t.token,e.hasNext=s,e.nextToken=a,(n.length>0||r.length>0)&&this._metadata&&(this._metadata.token=a),o.debug("message changelog sync progress",e),[4,this.saveMetadata()];case 4:return c.sent(),[3,8];case 5:return i=c.sent(),o.debug("message changelog sync error",i),i instanceof h&&i.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:c.sent(),c.label=7;case 7:throw i;case 8:return[2,e]}}))}))})),this._connectionEventContext=c.on((function(e){if(e instanceof K)if(e.stateType===J.CONNECTED)r.resume();else r.pause()}))}return e.of=function(t,n){return or[t]||(or[t]={}),or[t][n.url]||(or[t][n.url]=new e({_iid:t,channel:n})),or[t][n.url].ref++,or[t][n.url]},e.clear=function(e,t){or[e]&&or[e][t]&&(or[e][t].close(),delete or[e])},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return f(this,(function(s){switch(s.label){case 0:return this._metadata?[3,2]:(e=k.of(this._iid),t=e.cacheContext,n=e.firstConnectedAt,[4,t.preference.get(this._metadataKey)]);case 1:r=s.sent(),this._metadata={token:r?r.token:n},s.label=2;case 2:return[2,this._metadata]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,k.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return e.sent(),[2,!0];case 2:return[2,!1]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,k.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){var e=k.of(this._iid),t=e.logger;e.connectionManager.isConnected&&(t.debug("message changelog sync resume()"),this._sync.start(0))},e.prototype.pause=function(){var e=k.of(this._iid),t=e.logger;e.connectionManager,t.debug("message changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete or[this._iid][this._channel.url])},e}(),cr={},lr=function(){function e(e){var t=e._iid,n=e.channel,r=e.hasPollMessage,s=this;this.ref=0,this._iid=t,this._channel=n;var a,i,o=k.of(this._iid),u=o.logger,c=o.sdkState,l=o.dispatcher;this._metadataKey=(a=c.userId,i=n.url,"sendbird:".concat(a,"@groupchannel/").concat(i,"/poll/changelogs.meta"));var d=function(e,t){return"sendbird:".concat(e,"@groupchannel/").concat(t,"/poll/changelogs")}(c.userId,this._channel.url);this._sync=new sr(d,(function(){return p(s,void 0,void 0,(function(){var e,t,n,s,a,i,o,c;return f(this,(function(l){switch(l.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return l.sent(),u.debug("poll changelog sync from",null===(c=this._metadata)||void 0===c?void 0:c.token),(t=!this._metadata||!this._metadata.token)?[4,r()]:[3,3];case 2:t=!l.sent(),l.label=3;case 3:if(t)return[2,{hasNext:!1,nextToken:0}];this._metadata||(n=k.of(this._iid).firstConnectedAt,this._metadata={token:n}),l.label=4;case 4:return l.trys.push([4,7,,10]),[4,Z.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return s=l.sent(),a=s.hasMore,i=s.token,e.hasNext=a,e.nextToken=i,this._metadata.token=i,u.debug("poll changelog sync progress",e),[4,this.saveMetadata()];case 6:return l.sent(),[3,10];case 7:return o=l.sent(),u.debug("poll changelog sync error",o),o instanceof h&&o.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:l.sent(),l.label=9;case 9:throw o;case 10:return[2,e]}}))}))})),this._connectionEventContext=l.on((function(e){if(e instanceof K)if(e.stateType===J.CONNECTED)s.resume();else s.pause()}))}return e.of=function(t,n,r){return cr[t]||(cr[t]={}),cr[t][n.url]||(cr[t][n.url]=new e({_iid:t,channel:n,hasPollMessage:r})),cr[t][n.url].ref++,cr[t][n.url]},e.prototype.loadMetadata=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,k.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=t.sent(),this._metadata=e?{token:e.token}:void 0,t.label=2;case 2:return[2]}}))}))},e.prototype.saveMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return this._metadata?[4,k.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.clearMetadata=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,k.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return e.sent(),this._metadata=void 0,[2]}}))}))},e.prototype.resume=function(){k.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},e.prototype.pause=function(){k.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},e.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete cr[this._iid][this._channel.url])},e}(),hr=function(t){function n(e){var n=e.channels,r=e.source,s=e.isWebSocketEventComing,a=void 0!==s&&s,i=e.data,o=void 0===i?null:i,u=t.call(this)||this;return u.channels=n,u.source=r,u.isWebSocketEventComing=a,u.data=o,u}return e(n,t),n}(M),dr=function(t){function n(e){var n=e.channelUrls,r=e.source,s=e.isWebSocketEventComing,a=void 0!==s&&s,i=t.call(this)||this;return i.channelUrls=n,i.source=r,i.isWebSocketEventComing=a,i}return e(n,t),n}(M),_r=function(n){function r(e){var r,s,a,i,o,u,c,l,h,d,_=this;return(_=n.call(this)||this).method=N.GET,_.path="".concat($(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),_.params=t({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:null!==(r=e.threshold)&&void 0!==r?r:null,reverse:!0,custom_types:null!==(s=e.customTypes)&&void 0!==s?s:["*"],message_type:null!==(a=e.messageType)&&void 0!==a?a:null,include_reply_type:null!==(i=e.replyType)&&void 0!==i?i:X.NONE,include_reactions:null===(o=e.includeReactions)||void 0===o||o,include_meta_array:null===(u=e.includeMetaArray)||void 0===u||u,include_thread_info:null===(c=e.includeThreadInfo)||void 0===c||c,include_parent_message_info:null===(l=e.includeParentMessageInfo)||void 0===l||l,with_sorted_meta_array:null===(h=e.includeMetaArray)||void 0===h||h,show_subchannel_messages_only:null!==(d=e.showSubchannelMessagesOnly)&&void 0!==d&&d,include_poll_details:!0,checking_continuous_messages:e.checkingContinuousMessages}),_}return e(r,n),r}(S),pr=function(t){function n(e,n){var r,s,a,i,o,u,c=this;return(c=t.call(this,e,n)||this).isHugeGap=n.is_huge_gap,c.prevMessages=(null!==(r=n.prev_messages)&&void 0!==r?r:[]).map((function(t){return ge(e,t)})),c.prevHasMore=null!==(s=n.prev_hasmore)&&void 0!==s&&s,c.isContinuousPrevMessages=null!==(a=n.is_continuous_prev_messages)&&void 0!==a&&a,c.nextMessages=(null!==(i=n.next_messages)&&void 0!==i?i:[]).map((function(t){return ge(e,t)})),c.nextHasmore=null!==(o=n.next_hasmore)&&void 0!==o&&o,c.isContinuousNextMessages=null!==(u=n.is_continuous_next_messages)&&void 0!==u&&u,c}return e(n,t),n}(T),fr=function(e,t){return t instanceof Re?e.findIndex((function(e){return e instanceof Re&&t.isIdentical(e)})):e.findIndex((function(e){return e.isIdentical(t)}))},vr=function(e,t){return e.findIndex((function(e){return e.messageId===t}))},mr=function(e,t){if(e.length>0){for(var n=0,r=e.length-1,s=Math.floor((n+r)/2);n<r;){var a=e[s].createdAt-t.createdAt;if(a>0)r=s,s=Math.floor((n+r)/2);else{if(!(a<0))return s;n=s+1,s=Math.floor((n+r)/2)}}return e[s].createdAt>t.createdAt?s:s+1}return e.length},gr=function(e){this.source=e},Er=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(gr),Cr=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(gr),yr=function(e){this.source=e},Mr=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(yr),br=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(yr),Nr=6e5,Ur={includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0,includeParentMessageInfo:!0};!function(e){e.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"}(rr||(rr={}));var Sr,Tr,Ar,Ir=function(){function e(){this._onCacheResult=ae,this._onApiResult=ae}return e.prototype._invokeResponse=function(e,t,n){var r=this;G((function(){return p(r,void 0,void 0,(function(){return f(this,(function(r){switch(e){case"local":this._onCacheResult(t,n);break;case"remote":this._onApiResult(t,n)}return[2]}))}))}))},e.prototype.onCacheResult=function(e){return this._onCacheResult=e,this},e.prototype.onApiResult=function(e){return this._onApiResult=e,this},e}(),wr=function(){function e(e,t){var n=t.filter,r=t.startingPoint,s=t.limit,a=t.channel,i=t.channelManager,o=this;this._messages=[],this._unsentMessages=[],this._iid=e,this._key="mc-".concat(re()),this._isDisposed=!1,this.filter=null!=n?n:new be,this._channel=a,this._syncRange=new Dt({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint="number"==typeof r?r:Date.now()+Nr,this._limit=s||Ge,this._channelManager=i,this._channelManager.subscribeChannelEvent(this._key,{onUpdate:function(e,t,n){var r=e.findIndex((function(e){return e.isIdentical(o.channel)}));r>=0&&(o._replaceChannelOfCollection(e[r]),o.channel._runIfHandleableWithGroupChannel((function(e){switch(t){case y.EVENT_CHANNEL_UPDATED:var r=!1;for(var s in o._messages){if(o._messages[s].createdAt>=e.messageOffsetTimestamp){r=!0;var a=parseInt(s);if(a>0){var i=o._messages.splice(0,a);o._removeMessagesFromView(i.map((function(e){return e.messageId})),y.EVENT_MESSAGE_OFFSET_UPDATED)}break}}!r&&o._messages.length>0&&o._removeMessagesFromView(o._messages.map((function(e){return e.messageId})),y.EVENT_MESSAGE_OFFSET_UPDATED);break;case y.EVENT_CHANNEL_UNMUTED:var u=k.of(o._iid).sdkState,c=n;u.userId===c&&o._clearCheckMyMutedTimer();break;case y.EVENT_CHANNEL_MUTED:u=k.of(o._iid).sdkState;var l=n;u.userId===l&&-1!==e._myMutedRemainingTime&&o._startCheckMyMutedTimer(e._myMutedRemainingTime);break;case y.EVENT_CHANNEL_LEFT:e.isPublic&&o._clearCheckMyMutedTimer()}G((function(){return p(o,void 0,void 0,(function(){var e,n;return f(this,(function(r){return e=this._createChannelEventContext(t),rn(t)&&(null===(n=this._handler)||void 0===n?void 0:n.onChannelUpdated)&&this._handler.onChannelUpdated(e,this.channel),[2]}))}))}))})))},onRemove:function(e,t){e.indexOf(o.channel.url)>=0&&(o._clearCheckMyMutedTimer(),G((function(){return p(o,void 0,void 0,(function(){var e,n;return f(this,(function(r){return e=this._createChannelEventContext(t),(null===(n=this._handler)||void 0===n?void 0:n.onChannelDeleted)&&this._handler.onChannelDeleted(e,this.channel.url),[2]}))}))})))}}),this._channelManager.subscribeMessageEvent(this._key,{onUpdate:function(e,t){var n,r,s=[],a=[];try{for(var i=v(e),u=i.next();!u.done;u=i.next()){var c=u.value;c.channelUrl===o._channel.url&&(o.filter.match(c)?s.push(c):a.push(c.messageId))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}if(ee(t)){if(s.length>0)switch(t){case y.LOCAL_MESSAGE_CANCELED:case y.LOCAL_MESSAGE_RESEND_STARTED:case y.EVENT_MESSAGE_SENT_FAILED:case y.EVENT_MESSAGE_SENT_SUCCESS:case y.EVENT_MESSAGE_UPDATED:case y.EVENT_MESSAGE_THREADINFO_UPDATED:case y.EVENT_MESSAGE_REACTION_UPDATED:case y.SYNC_MESSAGE_CHANGELOGS:o._updateMessagesToView(s,t);break;case y.EVENT_MESSAGE_SENT_PENDING:o._addMessagesToView(s,t);break;case y.EVENT_MESSAGE_RECEIVED:o.hasNext||o._addMessagesToView(s,t);break;case y.SYNC_MESSAGE_FILL:o._addMessagesToView(s,t)}a.length>0&&o._removeMessagesFromView(a,t)}},onRemove:function(e,t){o._removeMessagesFromView(e,t)},onRemoveUnsent:function(e,t){o._removeUnsentMessageFromView(e,t)},onPollChangeLogUpdate:function(e,t){o._updatePollsToView(e,t)},onPollUpdate:function(e,t){o._applyPollUpdateEventToView(e,t)},onPollVote:function(e,t){o._applyPollVoteEventToView(e,t)}});var u=k.of(this._iid),c=u.cacheContext,l=u.dispatcher,h=u.logger;this._channel._updateMessageCollectionLastAccessedAt();var m=this._createChannelUpdateEventCommand(y.CHANNEL_LASTACCESSEDAT_UPDATED);m&&l.dispatch(m),this._shouldStartBackgroundSync()&&(this._backgroundSync=ir.of(this._iid,this._channel),this._backgroundSync.resume(this._startingPoint)),this._changelogSync=ur.of(this._iid,this._channel),this._changelogSync.resume(),this._pollChangelogSync=lr.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new sr(this._key,(function(e){return p(o,void 0,void 0,(function(){var t,n,r,s,a;return f(this,(function(i){switch(i.label){case 0:return[4,this._getRemoteMessages(e,{prevLimit:this._limit,source:y.SYNC_MESSAGE_FILL,checkingContinuousMessages:c.localCacheEnabled})];case 1:return t=i.sent(),n=t.messages,r=t.isContinuousMessages,n.length>0?(s=Math.min.apply(Math,d([],_(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(s),r&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(s)),[2,{hasNext:n.length>=this._limit&&this.viewTop<s,nextToken:this._syncRange.top}]):[2,{hasNext:!1,nextToken:0}]}}))}))})),this._nextFill=new sr(this._key,(function(e){return p(o,void 0,void 0,(function(){var t,n,r,s,a;return f(this,(function(i){switch(i.label){case 0:return[4,this._getRemoteMessages(e,{nextLimit:this._limit,source:y.SYNC_MESSAGE_FILL,checkingContinuousMessages:c.localCacheEnabled})];case 1:return t=i.sent(),n=t.messages,r=t.isContinuousMessages,n.length>0?(s=Math.max.apply(Math,d([],_(n.map((function(e){return e.createdAt}))),!1)),this._syncRange.extends(s),r&&(null===(a=this._backgroundSync)||void 0===a||a.range.extends(s)),[2,{hasNext:!(n.length>=this._limit&&this._hasNext)||this.viewBottom>s,nextToken:this._syncRange.bottom}]):[2,{hasNext:!1,nextToken:0}]}}))}))})),this._connectionEventContext=l.on((function(e){if(e instanceof K)switch(e.stateType){case J.CONNECTED:o._refreshChannel(y.SYNC_CHANNEL_CHANGELOGS),b((function(){return p(o,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(e=t.sent()).isMuted&&-1!==e.remainingDuration&&this._startCheckMyMutedTimer(e.remainingDuration),[2]}}))}))})),h.debug("check huge gap"),o._checkHugeGap();break;case J.LOGOUT:o.dispose();break;default:o._clearCheckMyMutedTimer(),o._prevFill.stop(),o._nextFill.stop()}})),k.of(this._iid).statLogCollector.put(new te({type:ne.FEATURE_LOCALCACHE,data:{use_local_cache:c.localCacheEnabled,collection_interface:{message:!0}}}))}return Object.defineProperty(e.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"succeededMessages",{get:function(){return d([],_(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===se.FAILED}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter((function(e){return e.sendingStatus===se.PENDING}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewTop",{get:function(){return Math.min.apply(Math,d(d([],_(this._messages.map((function(e){return e.createdAt}))),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,d(d([],_(this._messages.map((function(e){return e.createdAt}))),!1),[0],!1))},enumerable:!1,configurable:!0}),e.prototype._replaceChannelOfCollection=function(e){this._channel.isGroupChannel()?this._channel=e:this._channel.isFeedChannel()&&(this._channel._groupChannel=e._groupChannel)},e.prototype._shouldStartBackgroundSync=function(){var e=k.of(this._iid).cacheContext;return this.channel.isGroupChannel()?e.localCacheEnabled&&!this.channel.isSuper:e.localCacheEnabled},e.prototype._createChannelEventContext=function(e){switch(!0){case this.channel.isGroupChannel():return new Er(e);case this.channel.isFeedChannel():return new Cr(e);default:throw new h({code:z.WRONG_CHANNEL_TYPE,message:"Wrong channel type"})}},e.prototype._createMessageEventContext=function(e){switch(!0){case this.channel.isGroupChannel():return new Mr(e);case this.channel.isFeedChannel():return new br(e);default:throw new h({code:z.WRONG_CHANNEL_TYPE,message:"Wrong channel type"})}},e.prototype._createChannelUpdateEventCommand=function(e){switch(!0){case this.channel.isGroupChannel():return new sn({channels:[this._channel],source:e});case this.channel.isFeedChannel():return new hr({channels:[this._channel],source:e});default:return null}},e.prototype._setBaseMessageCollectionHandler=function(e){this._handler=e},e.prototype._filterUnderOffsetMessage=function(e){return e},e.prototype._addMessagesToView=function(e,t){var n,r,s=this,a=this._filterUnderOffsetMessage(e),i=[],o=[];try{for(var u=v(a),c=u.next();!c.done;c=u.next()){var l=c.value;if(t===y.SYNC_MESSAGE_FILL){if(l.messageId>0){if((E=fr(this._messages,l))<0){fr(this._unsentMessages,l)<0&&i.push(l);var h=mr(this._messages,l);this._messages.splice(h,0,l)}}else if(l instanceof Re){(E=fr(this._unsentMessages,l))<0&&fr(this._messages,l)<0&&(this._unsentMessages.push(l),i.push(l))}}else if(l.messageId>0){if((E=fr(this._messages,l))<0){var m=fr(this._unsentMessages,l);m<0?i.push(l):(this._unsentMessages.splice(m,1),o.push(l));h=mr(this._messages,l);this._messages.splice(h,0,l)}else o.push(l),this._messages[E]=l;if(l.updatedAt>0){var g=this._updateChildMessagesInView(l);o.push.apply(o,d([],_(g),!1))}}else if(l instanceof Re){var E;(E=fr(this._unsentMessages,l))<0?fr(this._messages,l)<0&&(this._unsentMessages.push(l),i.push(l)):(o.push(l),this._unsentMessages[E]=l)}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}ee(t)&&G((function(){return p(s,void 0,void 0,(function(){var e,n,r,s,a;return f(this,(function(u){return e=this._createMessageEventContext(t),i.length>0&&(null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesAdded)||void 0===r||r.call(n,e,this.channel,i)),o.length>0&&(null===(a=null===(s=this._handler)||void 0===s?void 0:s.onMessagesUpdated)||void 0===a||a.call(s,e,this.channel,o)),[2]}))}))}))},e.prototype._updateChildMessagesInView=function(e){var t=[];return this._messages.forEach((function(n){n.parentMessageId===e.messageId&&n.applyParentMessage(e)&&t.push(n)})),t},e.prototype._updatePollsToView=function(e,t){var n,r,s=this,a=[];try{for(var i=v(e),o=i.next();!o.done;o=i.next()){var u=o.value,c=vr(this._messages,u.messageId);if(c>=0){var l=this._messages[c];l&&l.applyPoll(u),a.push(l)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return a.length>0&&ee(t)&&G((function(){return p(s,void 0,void 0,(function(){var e,n,r;return f(this,(function(s){return e=this._createMessageEventContext(t),a.length>0&&(null===(r=(n=this._handler).onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,a)),[2]}))}))})),a},e.prototype._applyPollUpdateEventToView=function(e,t){var n=this,r=vr(this._messages,e.messageId);if(r>=0){var s=this._messages[r];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollUpdateEvent(e)&&ee(t)&&G((function(){return p(n,void 0,void 0,(function(){var e,n,r;return f(this,(function(a){return e=this._createMessageEventContext(t),null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,[s]),[2]}))}))}))}},e.prototype._applyPollVoteEventToView=function(e,t){var n=this,r=vr(this._messages,e.messageId);if(r>=0){var s=this._messages[r];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollVoteEvent(e)&&ee(t)&&G((function(){return p(n,void 0,void 0,(function(){var e,n,r;return f(this,(function(a){return e=this._createMessageEventContext(t),null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,[s]),[2]}))}))}))}},e.prototype._updateMessagesToView=function(e,t){var n,r,s=this,a=[],i=[],o=[];try{for(var u=v(e),c=u.next();!c.done;c=u.next()){var l,h=c.value;if(h.messageId>0)if((l=fr(this._messages,h))>=0)i.push(h),this._messages[l]=h;else{var m=fr(this._unsentMessages,h);if(m>=0){var g=this._unsentMessages.splice(m,1);if(this.hasNext&&g.length>0)o.push(g[0]);else{i.push(h);var E=mr(this._messages,h);this._messages.splice(E,0,h)}}else{var C=this._messages.map((function(e){return e.createdAt}));(h.createdAt<Math.min.apply(Math,d([],_(C),!1))&&!this._hasPrevious||h.createdAt>Math.max.apply(Math,d([],_(C),!1))&&!this._hasNext)&&a.push(h)}}else if(h instanceof Re)(l=fr(this._unsentMessages,h))>=0&&(i.push(h),this._unsentMessages[l]=h)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return ee(t)&&G((function(){return p(s,void 0,void 0,(function(){var e,n,r,s,u;return f(this,(function(c){return e=this._createMessageEventContext(t),i.length>0?null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesUpdated)||void 0===r||r.call(n,e,this.channel,i):o.length>0?null===(u=null===(s=this._handler)||void 0===s?void 0:s.onMessagesDeleted)||void 0===u||u.call(s,e,this.channel,[],o):a.length>0&&this._addMessagesToView(a,t),[2]}))}))})),i},e.prototype._removeMessagesFromView=function(e,t){var n,r,s=this,a=[],i=[],o=function(e){var t=u._messages.findIndex((function(t){return t.messageId===e}));if(t>=0){var n=u._messages[t];a.push(n.messageId),i.push(n),u._messages.splice(t,1)}},u=this;try{for(var c=v(e),l=c.next();!l.done;l=c.next()){o(l.value)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return ee(t)&&i.length>0&&G((function(){return p(s,void 0,void 0,(function(){var e,n,r;return f(this,(function(s){return e=this._createMessageEventContext(t),null===(r=null===(n=this._handler)||void 0===n?void 0:n.onMessagesDeleted)||void 0===r||r.call(n,e,this.channel,a,i),[2]}))}))})),a},e.prototype._removeUnsentMessageFromView=function(e,t){var n=this._unsentMessages.findIndex((function(t){return t.reqId===e}));n>=0&&this._unsentMessages.splice(n,1)},e.prototype._getLocalMessages=function(e,t){var n=t.prevLimit,r=void 0===n?0:n,s=t.nextLimit,a=void 0===s?0:s,i=t.inclusive,o=void 0===i||i;return p(this,void 0,void 0,(function(){var t,n,s,i,u;return f(this,(function(c){switch(c.label){case 0:return t=[],o?[4,this._channelManager.getExactlyMatchingMessagesForTokenFromCache(this._channel.url,e,this.filter)]:[3,2];case 1:t=c.sent(),c.label=2;case 2:return r>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"prev",this.filter,r,!1)]:[3,4];case 3:return s=c.sent(),[3,5];case 4:s=[],c.label=5;case 5:return n=s,a>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,e,"next",this.filter,a,!1)]:[3,7];case 6:return u=c.sent(),[3,8];case 7:u=[],c.label=8;case 8:return i=u,[2,d(d(d([],_(t),!1),_(n),!1),_(i),!1).sort((function(e,t){return t.createdAt-e.createdAt}))]}}))}))},e.prototype._getRemoteMessages=function(e,t){var s=t.prevLimit,a=void 0===s?0:s,i=t.nextLimit,o=void 0===i?0:i,u=t.source,c=void 0===u?y.REQUEST_MESSAGE:u,l=t.reverse,h=void 0!==l&&l,d=t.checkingContinuousMessages,_=void 0!==d&&d;return p(this,void 0,void 0,(function(){var t,s;return f(this,(function(i){switch(i.label){case 0:return t=He.of(this._iid),a>0||o>0?[4,t._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,e,n(r(r(r({},this.filter),Ur),{isInclusive:!0,reverse:h,prevResultSize:a,nextResultSize:o})),c,_)]:[3,2];case 1:return s=i.sent(),[3,3];case 2:s={messages:[],isContinuousMessages:!1},i.label=3;case 3:return[2,s]}}))}))},e.prototype._checkHugeGap=function(){var e;return p(this,void 0,void 0,(function(){var t,n,s,a,i,o,u,c,l,v,m,g,E,C,M,b,N,U,S,T=this;return f(this,(function(A){switch(A.label){case 0:return this._messages.length>0?(t=this._syncRange.top,n=this.viewTop,s=this._syncRange.bottom,a=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,n,t)]):[3,4];case 1:return i=A.sent(),[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,s,a)];case 2:return o=A.sent(),[4,ie((function(){return p(T,void 0,void 0,(function(){var e,u,c,l,h,v,m,g,E,C,M,b,N,U,S,T,A,I,w,D,L,P=this;return f(this,(function(R){switch(R.label){case 0:return e=k.of(this._iid),u=e.dispatcher,c=e.requestQueue,l=e.cacheContext,h=new _r(r(r({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:n,prevEnd:t,prevCount:i,nextStart:s,nextEnd:a,nextCount:o,checkingContinuousMessages:l.localCacheEnabled},this.filter),Ur)),[4,c.send(h)];case 1:return v=R.sent(),m=v.as(pr),g=m.isHugeGap,E=m.prevMessages,C=void 0===E?[]:E,M=m.prevHasMore,b=m.isContinuousPrevMessages,N=m.nextMessages,U=void 0===N?[]:N,S=m.nextHasmore,T=m.isContinuousNextMessages,g?G((function(){return p(P,void 0,void 0,(function(){var e;return f(this,(function(t){return(null===(e=this._handler)||void 0===e?void 0:e.onHugeGapDetected)&&this._handler.onHugeGapDetected(),[2]}))}))})):(A=this.viewTop,I=this.viewBottom,w=Math.min.apply(Math,d([Number.MAX_SAFE_INTEGER,A],_(C.map((function(e){return e.createdAt}))),!1)),D=Math.max.apply(Math,d([0,I],_(U.map((function(e){return e.createdAt}))),!1)),u.dispatch(new W({messages:C,source:y.SYNC_MESSAGE_FILL})),u.dispatch(new W({messages:U,source:y.SYNC_MESSAGE_FILL})),this._syncRange.extends(w,D),(b||T)&&(null===(L=this._backgroundSync)||void 0===L||L.range.extends(w,D)),M&&this._prevFill.start(w),S&&this._nextFill.start(D)),[2]}}))}))}),1)];case 3:return A.sent(),[3,8];case 4:u=k.of(this._iid).cacheContext,c=Math.floor(this._limit/2),l=Date.now(),A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this._getRemoteMessages(l,{prevLimit:c,nextLimit:c,source:y.SYNC_MESSAGE_FILL,checkingContinuousMessages:u.localCacheEnabled})];case 6:if(v=A.sent(),m=v.messages,g=v.isContinuousMessages,m.length>0){for(E=m.map((function(e){return e.createdAt})),C=0,M=0,b=0;b<E.length;b++)(N=E[b])<=l?C++:N>=l&&M++;this._hasPrevious=C>=c,this._hasNext=M>=c,(S=this._syncRange).extends.apply(S,d([],_(E),!1)),g&&(null===(e=this._backgroundSync)||void 0===e||e.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(m,y.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;return[3,8];case 7:return(U=A.sent())instanceof h&&U.code===z.NOT_FOUND_IN_DATABASE&&(this._hasPrevious=!1,this._hasNext=!1),[3,8];case 8:return[2]}}))}))},e.prototype._loadUnsentMessages=function(){return p(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return e=this,[4,this._channelManager.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return e._unsentMessages=t.sent(),[2]}}))}))},e.prototype._hasPollMessage=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._channelManager.getPollMessagesFromCache(this._channel.url,Date.now()+Nr,this.filter,1)];case 1:return e.sent().length>0?[2,!0]:[2,!1]}}))}))},e.prototype._refreshChannel=function(e){this._channelManager.refreshChannel(this.channel.url,!0,e)},e.prototype._startCheckMyMutedTimer=function(e){var t=this;this._clearCheckMyMutedTimer(),this._checkMyMutedStateTimer=setTimeout((function(){return p(t,void 0,void 0,(function(){var e,t,n=this;return f(this,(function(r){switch(r.label){case 0:this._checkMyMutedStateTimer=void 0,e=!0,r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this._channel.getMyMutedInfo()];case 2:return t=r.sent(),e=!t.isMuted,[3,5];case 3:return r.sent(),e=!0,[3,5];case 4:return e&&this.channel._runIfHandleableWithGroupChannel((function(e){var t,r;e.myMutedState=V.UNMUTED;var s=n._createChannelEventContext(y.EVENT_CHANNEL_UNMUTED);null===(r=null===(t=n._handler)||void 0===t?void 0:t.onChannelUpdated)||void 0===r||r.call(t,s,n.channel)})),[7];case 5:return[2]}}))}))}),e+1e3)},e.prototype._clearCheckMyMutedTimer=function(){this._checkMyMutedStateTimer&&(clearTimeout(this._checkMyMutedStateTimer),this._checkMyMutedStateTimer=void 0)},e.prototype.initialize=function(e){var t=this,n=new Ir;this._messages=[],this._unsentMessages=[],this._syncRange=new Dt({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(y.REFRESH_CHANNEL),b((function(){return p(t,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(e=t.sent()).isMuted&&-1!==e.remainingDuration&&this._startCheckMyMutedTimer(e.remainingDuration),[2]}}))}))}));var r=Math.floor(this._limit/2);if(e===rr.CACHE_AND_REPLACE_BY_API)this._getLocalMessages(this._startingPoint,{prevLimit:r,nextLimit:r}).then((function(e){return p(t,void 0,void 0,(function(){var t;return f(this,(function(r){switch(r.label){case 0:return t=this._filterUnderOffsetMessage(e),this._addMessagesToView(t,y.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return r.sent(),n._invokeResponse("local",null,t),[2]}}))}))})).catch((function(e){if(H(e))throw e;n._invokeResponse("local",e,null)})).finally((function(){var e=k.of(t._iid).cacheContext;t._getRemoteMessages(t._startingPoint,{prevLimit:r,nextLimit:r,reverse:!0,checkingContinuousMessages:e.localCacheEnabled}).then((function(e){var s,a,i=e.messages,o=e.isContinuousMessages;t._messages=[];var u=t._filterUnderOffsetMessage(i);if(u.length>0){for(var c=u.map((function(e){return e.createdAt})),l=0,h=0,p=0;p<c.length;p++){var f=c[p];f<t._startingPoint?l++:f>t._startingPoint&&h++}t._hasPrevious=l>=r,t._hasNext=h>=r,(s=t._syncRange).extends.apply(s,d([],_(u.map((function(e){return e.createdAt}))),!1)),o&&(null===(a=t._backgroundSync)||void 0===a||a.range.extends(t._syncRange.top,t._syncRange.bottom)),t._addMessagesToView(u,y.REQUEST_MESSAGE)}else t._hasPrevious=!1,t._hasNext=!1;n._invokeResponse("remote",null,u)})).catch((function(e){if(H(e))throw e;n._invokeResponse("remote",e,null)}))}));var s=k.of(this._iid),a=s.cacheContext;return s.statLogCollector.put(new te({type:ne.FEATURE_LOCALCACHE,data:{use_local_cache:a.localCacheEnabled,collection_interface:{message_init_policy:e}}})),n},e.prototype.loadPrevious=function(){return p(this,void 0,void 0,(function(){var e,t,n,r=this;return f(this,(function(s){switch(s.label){case 0:if(this._isDisposed)throw new h({code:z.COLLECTION_DISPOSED,message:"Collection has been disposed."});return this._hasPrevious?(e=Math.floor(this._limit/2),t=this.viewTop,n=[],[4,b((function(){return p(r,void 0,void 0,(function(){var r;return f(this,(function(s){switch(s.label){case 0:return r=this._filterUnderOffsetMessage,[4,this._getLocalMessages(t,{prevLimit:e,inclusive:!1})];case 1:return n=r.apply(this,[s.sent()]),[2]}}))}))}))]):[2,[]];case 1:return s.sent(),n.length<e||!this._backgroundSync||!this._backgroundSync.isWrappingMessages(n)?[4,b((function(){return p(r,void 0,void 0,(function(){var r,s,a,i,o,u=this;return f(this,(function(c){switch(c.label){case 0:return r=k.of(this._iid).cacheContext,[4,this._getRemoteMessages(t,{prevLimit:e,reverse:!0,checkingContinuousMessages:r.localCacheEnabled})];case 1:return s=c.sent(),n=(n=this._filterUnderOffsetMessage(s.messages)).filter((function(e){return fr(u._messages,e)<0})),this._hasPrevious=n.length>=e,n.length>0&&((a=this._syncRange).extends.apply(a,d([],_(n.map((function(e){return e.createdAt}))),!1)),(null===(i=this._backgroundSync)||void 0===i?void 0:i.range.overlap(this._syncRange))&&s.isContinuousMessages&&(null===(o=this._backgroundSync)||void 0===o||o.range.extends(this._syncRange.top))),[2]}}))}))}))]:[3,3];case 2:return s.sent(),this._addMessagesToView(n,y.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=n.length>=e,n.length>0&&this._addMessagesToView(n,y.REQUEST_MESSAGE),s.label=4;case 4:return[2,n]}}))}))},e.prototype.loadNext=function(){var e;return p(this,void 0,void 0,(function(){var t,n,r,s=this;return f(this,(function(a){switch(a.label){case 0:if(this._isDisposed)throw new h({code:z.COLLECTION_DISPOSED,message:"Collection has been disposed."});return this._hasNext?(t=Math.floor(this._limit/2),n=this.viewBottom,r=[],[4,b((function(){return p(s,void 0,void 0,(function(){var e;return f(this,(function(s){switch(s.label){case 0:return e=this._filterUnderOffsetMessage,[4,this._getLocalMessages(n,{nextLimit:t,inclusive:!1})];case 1:return r=e.apply(this,[s.sent()]),[2]}}))}))}))]):[2,[]];case 1:return a.sent(),r.length<t||!(null===(e=this._backgroundSync)||void 0===e?void 0:e.isWrappingMessages(r))?[4,b((function(){return p(s,void 0,void 0,(function(){var e,s,a,i,o,u=this;return f(this,(function(c){switch(c.label){case 0:return e=k.of(this._iid).cacheContext,[4,this._getRemoteMessages(n,{nextLimit:t,reverse:!0,checkingContinuousMessages:e.localCacheEnabled})];case 1:return s=c.sent(),r=(r=this._filterUnderOffsetMessage(s.messages)).filter((function(e){return fr(u._messages,e)<0})),this._hasNext=r.length>=t,r.length>0&&((a=this._syncRange).extends.apply(a,d([],_(r.map((function(e){return e.createdAt}))),!1)),(null===(i=this._backgroundSync)||void 0===i?void 0:i.range.overlap(this._syncRange))&&s.isContinuousMessages&&(null===(o=this._backgroundSync)||void 0===o||o.range.extends(this._syncRange.bottom))),[2]}}))}))}))]:[3,3];case 2:return a.sent(),this._addMessagesToView(r,y.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=r.length>=t,r.length>0&&this._addMessagesToView(r,y.REQUEST_MESSAGE),a.label=4;case 4:return[2,r]}}))}))},e.prototype.removeFailedMessage=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:if(this._isDisposed)throw new h({code:z.COLLECTION_DISPOSED,message:"Collection has been disposed."});return[4,this._channelManager.removeFailedMessageFromCache(e)];case 1:return n.sent(),(t=this._unsentMessages.findIndex((function(t){return t.reqId===e})))>-1&&this._unsentMessages.splice(t,1),[2]}}))}))},e.prototype.dispose=function(){var e,t,n,r=this;if(!this._isDisposed){this._isDisposed=!0;var s=k.of(this._iid),a=s.cacheContext,i=s.dispatcher;this._messages=[],this._clearCheckMyMutedTimer(),this._channel._runIfHandleableWithGroupChannel((function(e){if(e.myMemberState!==Lt.NONE){r._channel._updateMessageCollectionLastAccessedAt();var t=r._createChannelUpdateEventCommand(y.CHANNEL_LASTACCESSEDAT_UPDATED);t&&i.dispatch(t)}})),a.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),null===(e=this._backgroundSync)||void 0===e||e.close(),null===(t=this._changelogSync)||void 0===t||t.close(),null===(n=this._pollChangelogSync)||void 0===n||n.close(),this._channelManager.unsubscribeChannelEvent(this._key),this._channelManager.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}},e}(),Dr=function(t){function n(e,n){return t.call(this,e,r(r({},n),{channelManager:nr.of(e)}))||this}return e(n,t),n.prototype.setMessageCollectionHandler=function(e){this._setBaseMessageCollectionHandler(e)},n}(wr),Lr={coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isPublic:void 0,isDiscoverable:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Pr=function(t){function n(e){var n=this,r=e.channelUrl,s=e.token,a=e.limit,i=e.order,o=e.mutedMemberFilter,u=e.memberStateFilter,c=e.nicknameStartsWithFilter,l=e.operatorFilter;return(n=t.call(this)||this).method=N.GET,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/members"),n.params={token:s,limit:a,order:i,muted_member_filter:o,member_state_filter:u,nickname_startswith:c,operator_filter:l,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},n}return e(n,t),n}(S),Rr=function(t){function n(e,n){var r=t.call(this,e,n)||this;r.members=[];var s=n.next,a=n.members;return r.token=s,a&&a.length>0&&(r.members=a.map((function(t){return new Vt(e,t)}))),r}return e(n,t),n}(T);!function(e){e.ALL="all",e.MUTED="muted",e.UNMUTED="unmuted"}(Sr||(Sr={})),function(e){e.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",e.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(Tr||(Tr={})),function(e){e.ALL="all",e.JOINED="joined_only",e.INVITED="invited_only",e.INVITED_BY_FRIEND="invited_by_friend",e.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(Ar||(Ar={}));var Fr=function(t){function a(e,n,r){var s,a,o,u,c=this;return(c=t.call(this,e,n,i.GROUP,r)||this).mutedMemberFilter=Sr.ALL,c.memberStateFilter=Ar.ALL,c.nicknameStartsWithFilter=null,c.operatorFilter=xt.ALL,c.order=Tr.MEMBER_NICKNAME_ALPHABETICAL,c.mutedMemberFilter=null!==(s=r.mutedMemberFilter)&&void 0!==s?s:Sr.ALL,c.memberStateFilter=null!==(a=r.memberStateFilter)&&void 0!==a?a:Ar.ALL,c.nicknameStartsWithFilter=null!==(o=r.nicknameStartsWithFilter)&&void 0!==o?o:null,c.order=null!==(u=r.order)&&void 0!==u?u:Tr.MEMBER_NICKNAME_ALPHABETICAL,c}return e(a,t),a.prototype._validate=function(){return t.prototype._validate.call(this)&&s(Sr,this.mutedMemberFilter)&&s(Ar,this.memberStateFilter)&&(g("string",this.nicknameStartsWithFilter)||null===this.nicknameStartsWithFilter)&&s(xt,this.operatorFilter)&&s(Tr,this.order)},a.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=k.of(this._iid).requestQueue,t=new Pr(n(r(r({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return s=u.sent(),a=s.as(Rr),i=a.members,o=a.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,i];case 2:return[2,[]];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},a}(oe),kr=function(t){function n(e){var n=this,r=e.channelUrl,s=e.userId,a=e.accessCode;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/accept"),n.params={user_id:s,access_code:a},n}return e(n,t),n}(S),Or=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new hs(e,n),r.channel.myMemberState=Lt.JOINED,r}return e(n,t),n}(T),xr=function(n){function r(e){var r=this,s=e.channelUrl,a=e.isDistinct,i=e.isPublic,o=e.isDiscoverable,u=e.coverUrl,c=e.coverImage,l=e.accessCode,h=e.name,d=e.data,_=e.customType,p=e.operatorUserIds,f=e.messageSurvivalSeconds;return(r=n.call(this)||this).method=N.PUT,r.path="".concat(I,"/").concat(encodeURIComponent(s)),r.params=t({is_distinct:a,is_public:i,is_discoverable:o,name:h,data:d,custom_type:_,cover_url:u,cover_file:c,access_code:l,operator_ids:p,message_survival_seconds:f}),r}return e(r,n),r}(S),Hr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.channel=new hs(e,n),r}return e(n,t),n}(T),Gr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=N.DELETE,n.path="".concat(I,"/").concat(encodeURIComponent(r)),n}return e(n,t),n}(S);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(T);var Vr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=N.DELETE,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/hide"),n}return e(n,t),n}(S);!function(t){function n(){return null!==t&&t.apply(this,arguments)||this}e(n,t)}(T);var Br=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=e.countPreference,a=t.call(this)||this;return a.method=N.PUT,a.path="".concat(U,"/").concat(encodeURIComponent(n),"/count_preference/").concat(encodeURIComponent(r)),a.params={count_preference:s},a}return e(n,t),n}(S),qr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.countPreference=n.count_preference,r}return e(n,t),n}(T),Wr=function(t){function n(e){var n=this,r=e.channelUrl;return(n=t.call(this)||this).method=N.PUT,n.path="".concat(I,"/").concat(encodeURIComponent(r),"/reset_user_history"),n}return e(n,t),n}(S),jr=function(t){function n(e,n){var r=t.call(this,e,n)||this,s=n.ts_message_offset;return r.messageOffsetTimestamp=s,r}return e(n,t),n}(T),zr=r(r({},Ve),{scheduledAt:void 0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),Qr=r(r({},qe),{scheduledAt:void 0}),Yr=function(r){function s(e){var s,a=this;a=r.call(this)||this;var i=[];e.mentionType===ue.USERS&&(e.mentionedUserIds?i=e.mentionedUserIds:e.mentionedUsers&&(i=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl,c=e.scheduledMessageId;return a.method=N.PUT,a.path="".concat($(o),"/").concat(encodeURIComponent(u),"/scheduled_messages/").concat(encodeURIComponent(c)),a.params=t(n({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:ce.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return je.payloadify(e)})):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(s=e.metaArrays)||void 0===s?void 0:s.map((function(e){return ze.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?Qe.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption})),a}return e(s,r),s}(S),Kr=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new Me(e,n),r}return e(n,t),n}(T),Jr=function(r){function s(e){var s,a=this;a=r.call(this)||this;var i=[];e.mentionType===ue.USERS&&(e.mentionedUserIds?i=e.mentionedUserIds:e.mentionedUsers&&(i=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl,c=e.scheduledMessageId;return a.method=N.PUT,a.path="".concat($(o),"/").concat(encodeURIComponent(u),"/scheduled_messages/").concat(encodeURIComponent(c)),a.params=t(n({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:ce.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:i,sorted_metaarray:null===(s=e.metaArrays)||void 0===s?void 0:s.map((function(e){return ze.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?Qe.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),a}return e(s,r),s}(S);!function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.message=new ye(e,n),r}e(n,t)}(T);var Xr=function(t){function n(e){var n=t.call(this)||this,r=e.channelType,s=e.channelUrl,a=e.scheduledMessageId;return n.method=N.DELETE,n.path="".concat($(r),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(a)),n}return e(n,t),n}(S),Zr=function(t){function n(e){var n=t.call(this)||this,r=e.channelType,s=e.channelUrl,a=e.scheduledMessageId;return n.method=N.POST,n.path="".concat($(r),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(a),"/send_now"),n}return e(n,t),n}(S),$r=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=e.pushTriggerOption,a=t.call(this)||this;return a.method=N.PUT,a.path="".concat(U,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),a.params={push_trigger_option:s},a}return e(n,t),n}(S),es=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return e(n,t),n}(T),ts=function(t){function n(e){var n=e.userId,r=e.channelUrl,s=t.call(this)||this;return s.method=N.GET,s.path="".concat(U,"/").concat(encodeURIComponent(n),"/push_preference/").concat(encodeURIComponent(r)),s}return e(n,t),n}(S),ns=function(t){function n(e,n){var r=t.call(this,e,n)||this;return r.pushTriggerOption=n.push_trigger_option,r.enabled=n.enable,r}return e(n,t),n}(T),rs=function(t){function n(e){var n=e.channelType,r=e.channelUrl,s=e.messageId,a=t.call(this)||this;return a.method=N.POST,a.path="".concat($(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/pin"),a}return e(n,t),n}(S);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(T);var ss=function(t){function n(e){var n=e.channelType,r=e.channelUrl,s=e.messageId,a=t.call(this)||this;return a.method=N.DELETE,a.path="".concat($(n),"/").concat(encodeURIComponent(r),"/messages/").concat(s,"/pin"),a}return e(n,t),n}(S);!function(t){function n(e,n){return t.call(this,e,n)||this}e(n,t)}(T);var as,is,os=function(t){function n(e,n){var r=t.call(this,e)||this;return r.message=ge(e,n.message),r}return e(n,t),n}(u),us=function(n){function r(e){var r=this,s=e.channelType,a=e.channelUrl,i=e.limit,o=e.token,u=e.includeReactions,c=e.includeMetaArray,l=e.includeParentMessageInfo,h=e.includeThreadInfo,d=e.includePollDetails;return(r=n.call(this)||this).method=N.GET,r.path="".concat($(s),"/").concat(encodeURIComponent(a),"/pinned_messages"),r.params=t({limit:i,token:o,include_reactions:u,with_sorted_meta_array:c,include_thread_info:h,include_parent_message_info:l,include_poll_details:d}),r}return e(r,n),r}(S),cs=function(t){function n(e,n){var r=t.call(this,e,n)||this,s=n.pinned_messages,a=n.has_more,i=n.next;return r.pinnedMessages=s.map((function(t){return new os(e,t)})),r.hasMore=a,r.token=i,r}return e(n,t),n}(T),ls=function(t){function n(e,n,r,s){var a=t.call(this,e,n,r,s)||this;return a.includeMetaArray=s.includeMetaArray,a.includeReactions=s.includeReactions,a.includeParentMessageInfo=s.includeParentMessageInfo,a.includeThreadInfo=s.includeThreadInfo,a.includePollDetails=s.includePollDetails,a}return e(n,t),n.prototype._validate=function(){return t.prototype._validate.call(this)&&g("boolean",this.includeMetaArray,!0)&&g("boolean",this.includeReactions,!0)&&g("boolean",this.includeParentMessageInfo,!0)&&g("boolean",this.includeThreadInfo,!0)&&g("boolean",this.includePollDetails,!0)},n.prototype.next=function(){return p(this,void 0,void 0,(function(){var e,t,n,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=k.of(this._iid).requestQueue,t=new us(r(r({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n=u.sent(),s=n.as(cs),a=s.pinnedMessages,i=s.hasMore,o=s.token,this._token=o,this._hasNext=!!i,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw h.queryInProgress;case 4:return[3,6];case 5:throw h.invalidParameters;case 6:return[2]}}))}))},n}(oe);!function(e){e.ALL="all",e.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",e.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",e.OFF="off"}(as||(as={})),function(e){e.UNHIDDEN="unhidden",e.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",e.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(is||(is={}));var hs=function(u){function c(e,t){var n,c,l,h,p,f,v,m,E,C,y,M,b,N,U,S,T,A,I,w,D=this;return(D=u.call(this,e,t)||this)._unreadMemberStateMap=new Map,D._undeliveredMemberStateMap=new Map,D._typingStatus=new Map,D._lastMemberCountUpdated=0,D._typingStarted=0,D._typingEnded=0,D.isDistinct=!1,D.isSuper=!1,D.isBroadcast=!1,D.isExclusive=!1,D.isPublic=!1,D.isDiscoverable=!0,D.isChatNotification=!1,D.isAccessCodeRequired=!1,D.isPushEnabled=!1,D.unreadMessageCount=0,D.unreadMentionCount=0,D.members=[],D.memberCount=0,D.joinedMemberCount=0,D.hiddenState=is.UNHIDDEN,D.lastMessage=null,D.messageOffsetTimestamp=0,D.messageSurvivalSeconds=-1,D.myMemberState=Lt.NONE,D.myRole=a.NONE,D.myMutedState=V.UNMUTED,D.myLastRead=0,D.myCountPreference=as.ALL,D.myPushTriggerOption=he.DEFAULT,D.inviter=null,D.invitedAt=0,D.joinedAt=0,D.pinnedMessageIds=[],D.lastPinnedMessage=null,D._pinnedMessagesUpdatedAt=0,D._myMutedRemainingTime=-1,D.channelType=i.GROUP,D.isDistinct=null!==(c=t.is_distinct)&&void 0!==c&&c,D.isSuper=null!==(l=t.is_super)&&void 0!==l&&l,D.isBroadcast=null!==(h=t.is_broadcast)&&void 0!==h&&h,D.isExclusive=null!==(p=t.is_exclusive)&&void 0!==p&&p,D.isPublic=null!==(f=t.is_public)&&void 0!==f&&f,D.isDiscoverable=null!==(v=t.is_discoverable)&&void 0!==v?v:D.isPublic,D.isChatNotification=null!==(m=t.is_chat_notification)&&void 0!==m&&m,D.isAccessCodeRequired=null!==(E=t.is_access_code_required)&&void 0!==E&&E,D.isPushEnabled=null!==(C=t.is_push_enabled)&&void 0!==C&&C,Array.isArray(t.members)&&(n=D.members).push.apply(n,d([],_(t.members.map((function(e){return new Vt(D._iid,e)}))),!1)),D.memberCount=null!==(y=t.member_count)&&void 0!==y?y:0,D.joinedMemberCount=null!==(M=t.joined_member_count)&&void 0!==M?M:0,D.hiddenState=s(is,t.hidden_state)?t.hidden_state:is.UNHIDDEN,D.messageOffsetTimestamp=null!==(b=t.ts_message_offset)&&void 0!==b?b:0,D.messageSurvivalSeconds=null!==(N=t.message_survival_seconds)&&void 0!==N?N:-1,D.lastMessage=t.last_message?ge(D._iid,r({channel_type:D.channelType},t.last_message)):null,t.read_receipt&&Object.keys(t.read_receipt).forEach((function(e){g("number",t.read_receipt[e])&&D._updateUnreadMemberState(e,t.read_receipt[e])})),t.delivery_receipt&&Object.keys(t.delivery_receipt).forEach((function(e){g("number",t.delivery_receipt[e])&&D._updateUndeliveredMemberState(e,t.delivery_receipt[e])})),D.myMemberState=s(Lt,t.member_state)?t.member_state:Lt.NONE,D.myRole=s(a,t.my_role)?t.my_role:a.NONE,s(V,t.is_muted)?D.myMutedState=t.is_muted:g("boolean",t.is_muted)?D.myMutedState=t.is_muted?V.MUTED:V.UNMUTED:D.myMutedState=V.UNMUTED,D.myCountPreference=s(as,t.count_preference)?t.count_preference:as.ALL,D.myPushTriggerOption=s(he,t.push_trigger_option)?t.push_trigger_option:he.ALL,D.myLastRead=null!==(U=t.user_last_read)&&void 0!==U?U:0,D.inviter=t.inviter?new o(D._iid,t.inviter):null,D.invitedAt=null!==(S=t.invited_at)&&void 0!==S?S:0,D.joinedAt=null!==(T=t.joined_ts)&&void 0!==T?T:0,D._updateUnreadCount(null!==(A=t.unread_message_count)&&void 0!==A?A:0,null!==(I=t.unread_mention_count)&&void 0!==I?I:0),D.pinnedMessageIds=null!==(w=t.pinned_message_ids)&&void 0!==w?w:[],D.lastPinnedMessage=t.latest_pinned_message?ge(D._iid,r({channel_type:D.channelType},t.latest_pinned_message)):null,D}return e(c,u),Object.defineProperty(c.prototype,"isHidden",{get:function(){return this.hiddenState!==is.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isTyping",{get:function(){return this._typingStatus.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cachedUnreadMemberState",{get:function(){var e,t,n={};try{for(var r=v(this._unreadMemberStateMap),s=r.next();!s.done;s=r.next()){var a=_(s.value,2),i=a[0],o=a[1];n[i]=o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cachedUndeliveredMemberState",{get:function(){var e,t,n={};try{for(var r=v(this._undeliveredMemberStateMap),s=r.next();!s.done;s=r.next()){var a=_(s.value,2),i=a[0],o=a[1];n[i]=o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),c.payloadify=function(e){return t(n(r(r({},u.payloadify.call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map((function(e){return Vt.payloadify(e)})),last_message:e.lastMessage?Ye(e.lastMessage):null,inviter:e.inviter?o.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,pinned_message_ids:e.pinnedMessageIds,latest_pinned_message:e.lastPinnedMessage?Ye(e.lastPinnedMessage):null})))},c.prototype._shouldUpdateLastMessageWith=function(e){return!(e instanceof Re&&e.parentMessageId>0&&!e.replyToChannel)&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},c.prototype._tryUpdateLastMessageAndCallEvents=function(e,t){var n=k.of(this._iid).dispatcher,r=nr.of(this._iid);e._shouldUpdateLastMessageWith(t)&&(e.lastMessage=t),r.handlers.map((function(t){t.onChannelChanged&&t.onChannelChanged(e)})),n.dispatch(new sn({channels:[e],source:y.EVENT_MESSAGE_SENT}))},c.prototype._updateUnreadCount=function(e,t){if("number"==typeof e&&e>=0)if(this.myCountPreference===as.ALL||this.myCountPreference===as.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var n=k.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=n&&e>=n?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;"number"==typeof t&&t>=0&&(this.myCountPreference===as.ALL||this.myCountPreference===as.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=t:this.unreadMentionCount=0},c.prototype._updateUnreadMemberState=function(e,t){var n=this._unreadMemberStateMap.get(e);return(!n||n<t)&&(this._unreadMemberStateMap.set(e,t),k.of(this._iid).sdkState.userId===e&&(this.myLastRead=t),!0)},c.prototype._updateUndeliveredMemberState=function(e,t){var n=this._undeliveredMemberStateMap.get(e);return(!n||n<t)&&(this._undeliveredMemberStateMap.set(e,t),!0)},c.prototype._updateTypingStatus=function(e,t){void 0===t&&(t=(new Date).getTime()),t>0?this._typingStatus.set(e.userId,{user:e,ts:t}):this._typingStatus.delete(e.userId)},c.prototype._clearTypingStatus=function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0},c.prototype._setLatestMemberCount=function(e,t,n){var r=!1;return n>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=n,r=e!==this.memberCount||t!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=t),r},c.prototype.isReadMessage=function(e){var t=k.of(this._iid).sdkState,n=this._unreadMemberStateMap.get(t.userId);return!!n&&n>=e.createdAt},c.prototype.serialize=function(){var e=this;return R(this,(function(t){t.cachedUnreadMemberState=e.cachedUnreadMemberState,t.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState}))},c.prototype.createMessageCollection=function(e){return void 0===e&&(e={}),new Dr(this._iid,r(r({},e),{channel:this}))},c.prototype.createMemberListQuery=function(e){return void 0===e&&(e={}),new Fr(this._iid,this.url,e)},c.prototype.createPinnedMessageListQuery=function(e){return void 0===e&&(e={}),new ls(this._iid,this.url,this.channelType,e)},c.prototype.addMember=function(e,t){if(void 0===t&&(t=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var n=this.members.findIndex((function(t){return t.userId===e.userId}));if(n>-1){var r=this.members[n];r.state===Lt.JOINED&&(e.state=r.state),this.members.splice(n,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,t),this._updateUndeliveredMemberState(e.userId,t)}},c.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var t=e instanceof Vt?e.userId:e,n=this.members.findIndex((function(e){return e.userId===t}));if(n>-1)return this.members.splice(n,1),this.memberCount--,!0}return!1},c.prototype.getUnreadMemberCount=function(e){var t,n;if(e instanceof Re&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=k.of(this._iid).sdkState,s=e.createdAt,a=0;try{for(var i=v(this.members),o=i.next();!o.done;o=i.next()){var u=o.value;if(r.userId!==u.userId&&u.state===Lt.JOINED&&e.sender.userId!==u.userId)(this.cachedUnreadMemberState[u.userId]||0)<s&&a++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}return 0},c.prototype.getUndeliveredMemberCount=function(e){var t,n;if(e instanceof Re&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=k.of(this._iid).sdkState,s=e.createdAt,a=0;try{for(var i=v(this.members),o=i.next();!o.done;o=i.next()){var u=o.value;if(r.userId!==u.userId&&u.state===Lt.JOINED&&e.sender.userId!==u.userId)(this.cachedUndeliveredMemberState[u.userId]||0)<s&&a++}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}return 0},c.prototype.getReadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=k.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=e instanceof Re?e.sender:null,a=[];return this.members.forEach((function(i){if(t||i.userId!==r.userId&&i.userId!==(null==s?void 0:s.userId)){var o=n._unreadMemberStateMap.get(i.userId);o&&o>=e.createdAt&&a.push(i)}})),a},c.prototype.getUnreadMembers=function(e,t){var n=this;void 0===t&&(t=!1);var r=k.of(this._iid).sdkState;if(!r.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var s=e instanceof Re?e.sender:null,a=[];return this.members.forEach((function(i){if(t||i.userId!==r.userId&&i.userId!==(null==s?void 0:s.userId)){var o=n._unreadMemberStateMap.get(i.userId);o&&o<e.createdAt&&a.push(i)}})),a},c.prototype.getReadStatus=function(e){var t=this;void 0===e&&(e=!1);var n=k.of(this._iid).sdkState;if(!n.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var r={};return this.members.forEach((function(s){if(e||s.userId!==n.userId){var a=t._unreadMemberStateMap.get(s.userId);r[s.userId]=new Bt(t._iid,{channel_url:t.url,channel_type:t.channelType,user:Vt.payloadify(s),ts:null!=a?a:0})}})),r},c.prototype.getTypingUsers=function(){var e=[];return this._typingStatus.forEach((function(t){var n=t.user;e.push(n)})),e},c.prototype.invalidateTypingStatus=function(){var e=this,t=k.of(this._iid).typingIndicatorInvalidateTime,n=Date.now(),r=!1;return this._typingStatus.forEach((function(s,a){var i=s.ts;n-i>=t&&(e._typingStatus.delete(a),r=!0)})),r},c.prototype.refresh=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){return[2,this._refresh()]}))}))},c.prototype._refresh=function(e){return void 0===e&&(e=!1),p(this,void 0,void 0,(function(){var t,n,r,s,a,i;return f(this,(function(o){switch(o.label){case 0:return t=k.of(this._iid),n=t.requestQueue,r=t.dispatcher,s=new ln({channelUrl:this.url}),[4,n.send(s)];case 1:return a=o.sent(),i=a.as(hn).channel,this._update(i),e&&r.dispatch(new sn({channels:[i],source:y.REQUEST_CHANNEL})),[2,this]}}))}))},c.prototype.freeze=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,u.prototype.freeze.call(this)];case 1:return e.sent(),k.of(this._iid).dispatcher.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_FROZEN,isWebSocketEventComing:!0})),[2]}}))}))},c.prototype.unfreeze=function(){return p(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,u.prototype.unfreeze.call(this)];case 1:return e.sent(),k.of(this._iid).dispatcher.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_UNFROZEN,isWebSocketEventComing:!0})),[2]}}))}))},c.prototype.updateChannel=function(e){return p(this,void 0,void 0,(function(){var t,n,s,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return t=r(r({},Lr),e),l(function(e){return g("string",e.coverUrl,!0)&&(E(e.coverImage)||g("string",e.coverImage,!0))&&g("boolean",e.isDistinct,!0)&&g("boolean",e.isPublic,!0)&&g("boolean",e.isDiscoverable,!0)&&g("string",e.accessCode,!0)&&g("string",e.name,!0)&&g("string",e.data,!0)&&g("string",e.customType,!0)&&m("string",e.operatorUserIds,!0)&&g("number",e.messageSurvivalSeconds,!0)}(t)).throw(h.invalidParameters),n=k.of(this._iid),s=n.dispatcher,a=n.requestQueue,i=new xr(r({channelUrl:this.url},t)),[4,a.send(i)];case 1:return o=c.sent(),u=o.as(Hr).channel,this._update(u),s.dispatch(new sn({channels:[u],source:y.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.invite=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){return l(e.every((function(e){return e instanceof o}))).throw(h.invalidParameters),[2,this.inviteWithUserIds(e.map((function(e){return e.userId})))]}))}))},c.prototype.inviteWithUserIds=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,a,i;return f(this,(function(o){switch(o.label){case 0:return l(m("string",e)).throw(h.invalidParameters),t=k.of(this._iid),n=t.dispatcher,r=t.requestQueue,s=new Rn({channelUrl:this.url,userIds:e}),[4,r.send(s)];case 1:return a=o.sent(),i=a.as(Fn).channel,this._update(i),n.dispatch(new sn({channels:[i],source:y.EVENT_CHANNEL_INVITED,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.join=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return l(g("string",e,!0)).throw(h.invalidParameters),t=k.of(this._iid),n=t.dispatcher,r=t.sdkState,s=t.requestQueue,a=new In({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,s.send(a)];case 1:return i=u.sent(),(o=i.as(wn).channel).myMemberState=this.myMemberState=Lt.JOINED,this._update(o),n.dispatch(new sn({channels:[o],source:y.EVENT_CHANNEL_JOINED,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.leave=function(e){return void 0===e&&(e=!1),p(this,void 0,void 0,(function(){var t,n,r,s;return f(this,(function(a){switch(a.label){case 0:return t=k.of(this._iid),n=t.sdkState,r=t.requestQueue,s=new Ln({channelUrl:this.url,userId:n.userId,shouldRemoveOperatorStatus:e}),[4,r.send(s)];case 1:return a.sent(),this.myMemberState=Lt.NONE,[2]}}))}))},c.prototype.acceptInvitation=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,a,i,o;return f(this,(function(u){switch(u.label){case 0:return l(g("string",e,!0)).throw(h.invalidParameters),t=k.of(this._iid),n=t.dispatcher,r=t.sdkState,s=t.requestQueue,a=new kr({channelUrl:this.url,userId:r.userId,accessCode:e}),[4,s.send(a)];case 1:return i=u.sent(),(o=i.as(Or).channel).myMemberState=this.myMemberState=Lt.JOINED,this._update(o),n.dispatch(new sn({channels:[o],source:y.EVENT_CHANNEL_ACCEPTED_INVITE,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.declineInvitation=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return f(this,(function(s){switch(s.label){case 0:return e=k.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new On({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),this.myMemberState=Lt.NONE,[2,this]}}))}))},c.prototype.sendUserMessage=function(e){var t=this,n=new ot,r=k.of(this._iid).dispatcher,s=Ct.of(this._iid);return u.prototype.sendUserMessage.call(this,e).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){t&&s.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){t.hiddenState===is.HIDDEN_ALLOW_AUTO_UNHIDE&&(t.hiddenState=is.UNHIDDEN),s.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),nr.of(t._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),r.dispatch(new sn({channels:[t],source:y.EVENT_MESSAGE_SENT})),n._trigger(e)})),n},c.prototype.updateUserMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s,a,i=this;return f(this,(function(o){switch(o.label){case 0:return n=k.of(this._iid).dispatcher,[4,u.prototype.updateUserMessage.call(this,e,t)];case 1:return r=o.sent(),s=!1,!r.silent&&this._shouldUpdateLastMessageWith(r)&&(this.lastMessage=r,s=!0),a=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===r.messageId&&(this.lastPinnedMessage=r,s=!0,a=!0),s&&(nr.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(i)})),n.dispatch(new sn({channels:[this],source:a?y.EVENT_PINNED_MESSAGE_UPDATED:y.EVENT_MESSAGE_UPDATED}))),a&&nr.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(i)})),n.dispatch(new W({messages:[r],source:y.EVENT_MESSAGE_UPDATED})),[2,r]}}))}))},c.prototype._autoResendUserMessage=function(e){var t=this,n=new ot,r=k.of(this._iid).dispatcher,s=Ct.of(this._iid);return u.prototype._autoResendUserMessage.call(this,e).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){s.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var a=nr.of(t._iid);s.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),a.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),r.dispatch(new sn({channels:[t],source:y.EVENT_MESSAGE_SENT})),n._trigger(e)})),n},c.prototype.sendFileMessage=function(e){var t=this,n=new ot,r=k.of(this._iid).dispatcher,s=Ct.of(this._iid);return u.prototype.sendFileMessage.call(this,e).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){t&&s.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var a=nr.of(t._iid);s.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),a.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),r.dispatch(new sn({channels:[t],source:y.EVENT_MESSAGE_SENT})),n._trigger(e)})),n},c.prototype.sendMultipleFilesMessage=function(e){var t=this,n=new Ke,r=k.of(this._iid).dispatcher;return u.prototype.sendMultipleFilesMessage.call(this,e).onPending((function(e){n._trigger(e)})).onFailed((function(e,t){n._triggerFailed(e,t)})).onSucceeded((function(e){var s=nr.of(t._iid);t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),s.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),r.dispatch(new sn({channels:[t],source:y.EVENT_MESSAGE_SENT})),n._trigger(e)})).onFileUploaded((function(e,t,r,s){n._triggerOnFileUploaded(e,t,r,s)})),n},c.prototype.updateFileMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,r,s,a,i=this;return f(this,(function(o){switch(o.label){case 0:return n=k.of(this._iid).dispatcher,[4,u.prototype.updateFileMessage.call(this,e,t)];case 1:return r=o.sent(),s=!1,!r.silent&&this._shouldUpdateLastMessageWith(r)&&(this.lastMessage=r,s=!0),a=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===r.messageId&&(this.lastPinnedMessage=r,s=!0,a=!0),s&&(nr.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(i)})),n.dispatch(new sn({channels:[this],source:a?y.EVENT_PINNED_MESSAGE_UPDATED:y.EVENT_MESSAGE_UPDATED}))),a&&nr.of(this._iid).handlers.map((function(e){e.onPinnedMessageUpdated&&e.onPinnedMessageUpdated(i)})),n.dispatch(new W({messages:[r],source:y.EVENT_MESSAGE_UPDATED})),[2,r]}}))}))},c.prototype._autoResendFileMessage=function(e){var t=this,n=new ot,r=k.of(this._iid).dispatcher,s=Ct.of(this._iid);return u.prototype._autoResendFileMessage.call(this,e).onPending((function(e){s.completeCurrentAndProcessNextAutoResend(e),n._trigger(e)})).onFailed((function(e,t){s.completeCurrentAndProcessNextAutoResend(t),n._triggerFailed(e,t)})).onSucceeded((function(e){var a=nr.of(t._iid);s.completeCurrentAndProcessNextAutoResend(e),t._shouldUpdateLastMessageWith(e)&&(t.lastMessage=e),a.handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(t)})),r.dispatch(new sn({channels:[t],source:y.EVENT_MESSAGE_SENT})),n._trigger(e)})),n},c.prototype.deleteMessage=function(e){return p(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,u.prototype.deleteMessage.call(this,e)];case 1:return t.sent(),0===e.messageId&&e instanceof Re&&k.of(this._iid).dispatcher.dispatch(new de({reqId:e.reqId,source:y.EVENT_MESSAGE_DELETED})),[2]}}))}))},c.prototype.hide=function(e){return p(this,void 0,void 0,(function(){var t,n,s,a,i,o,u,c;return f(this,(function(d){switch(d.label){case 0:return t=r(r({},Hn),e),l(function(e){return g("boolean",e.hidePreviousMessages,!0)&&g("boolean",e.allowAutoUnhide,!0)}(t)).throw(h.invalidParameters),n=k.of(this._iid),s=n.dispatcher,a=n.sdkState,i=n.requestQueue,o=new Gn(r({channelUrl:this.url,userId:a.userId},t)),[4,i.send(o)];case 1:return u=d.sent(),c=u.as(Vn).messageOffsetTimestamp,this.hiddenState=t.allowAutoUnhide?is.HIDDEN_ALLOW_AUTO_UNHIDE:is.HIDDEN_PREVENT_AUTO_UNHIDE,t.hidePreviousMessages&&this._updateUnreadCount(0,0),c&&(this.messageOffsetTimestamp=c),s.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_HIDDEN,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.unhide=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return f(this,(function(s){switch(s.label){case 0:return e=k.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new Vr({channelUrl:this.url}),[4,n.send(r)];case 1:return s.sent(),this.hiddenState=is.UNHIDDEN,t.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_UNHIDDEN,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.delete=function(){return p(this,void 0,void 0,(function(){var e,t;return f(this,(function(n){switch(n.label){case 0:return e=k.of(this._iid).requestQueue,t=new Gr({channelUrl:this.url}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.markAsRead=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,a,i,o=this;return f(this,(function(u){switch(u.label){case 0:return e=k.of(this._iid),t=e.sdkState,n=e.dispatcher,r=e.requestQueue,s=new Jn({channelUrl:this.url}),[4,r.send(s)];case 1:return a=u.sent(),i=a.as(Xn).readStatus,this._updateUnreadMemberState(t.userId,i.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),nr.of(this._iid).handlers.map((function(e){e.onChannelChanged&&e.onChannelChanged(o)}))),n.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_READ})),[2]}}))}))},c.prototype.markAsDelivered=function(){return p(this,void 0,void 0,(function(){var e,t,n,r;return f(this,(function(s){switch(s.label){case 0:return e=k.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Zn({channelUrl:this.url,userId:t.userId}),[4,n.send(r)];case 1:return s.sent(),[2]}}))}))},c.prototype.startTyping=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){return e=k.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingStarted>=n&&(this._typingStarted=r,this._typingEnded=0,s=new qn({channelUrl:this.url,time:this._typingStarted}),t.send(s)),[2]}))}))},c.prototype.endTyping=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s;return f(this,(function(a){return e=k.of(this._iid),t=e.requestQueue,n=e.typingIndicatorThrottle,(r=(new Date).getTime())-this._typingEnded>=n&&(this._typingStarted=0,this._typingEnded=r,s=new jn({channelUrl:this.url,time:this._typingStarted}),t.send(s)),[2]}))}))},c.prototype.createScheduledUserMessage=function(e){e=r(r({},Je),e),l(Xe(e)).throw(h.invalidParameters);var t=new ot;return this._createScheduledUserMessage(e,t),t},c.prototype.updateScheduledUserMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,s,a,i;return f(this,(function(o){switch(o.label){case 0:return n=r(r({},Qr),t),l(function(e){return We(e)&&g("number",e.scheduledAt,!0)}(n)).throw(h.invalidParameters),s=k.of(this._iid).requestQueue,a=new Jr(r({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,s.send(a)];case 1:return i=o.sent(),[2,i.as(ut).message]}}))}))},c.prototype.createScheduledFileMessage=function(e){var t=this;e=r(r({},Ze),e),l($e(e)).throw(h.invalidParameters);var n=Date.now(),s=this._generateRequestId(),a=new ot;return le(ct).then((function(){var r=t._createPendingScheduledFileMessage(e,s,n);G((function(){return p(t,void 0,void 0,(function(){return f(this,(function(e){return[2,a._trigger(r)]}))}))}))})),E(e.file)?this._uploadFileAndUpdateParams(e).then((function(){return t._createScheduledFileMessage(e,a,s,n)})):this._createScheduledFileMessage(e,a,s,n),a},c.prototype.updateScheduledFileMessage=function(e,t){return p(this,void 0,void 0,(function(){var n,s,a;return f(this,(function(i){switch(i.label){case 0:return n=r(r({},zr),t),l(function(e){return Be(e)&&g("number",e.scheduledAt,!0)&&(E(e.file)||g("string",e.fileUrl))&&g("string",e.fileName,!0)&&g("string",e.mimeType,!0)&&g("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||e.thumbnailSizes.every((function(e){return g("object",e)&&e.maxWidth>0&&e.maxHeight>0})))}(n)).throw(h.invalidParameters),E(n.file)?[4,this._uploadFileAndUpdateParams(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return s=new Yr(r({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},n)),[4,k.of(this._iid).requestQueue.send(s)];case 3:return a=i.sent(),[2,a.as(Kr).message]}}))}))},c.prototype.cancelScheduledMessage=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return t=new Xr({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,k.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.sendScheduledMessageNow=function(e){return p(this,void 0,void 0,(function(){var t;return f(this,(function(n){switch(n.label){case 0:return t=new Zr({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,k.of(this._iid).requestQueue.send(t)];case 1:return n.sent(),[2]}}))}))},c.prototype.getMyPushTriggerOption=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,a;return f(this,(function(i){switch(i.label){case 0:return e=k.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new ts({userId:t.userId,channelUrl:this.url}),[4,n.send(r)];case 1:return s=i.sent(),a=s.as(ns).pushTriggerOption,this.myPushTriggerOption=a,[2,a]}}))}))},c.prototype.setMyPushTriggerOption=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return l(s(he,e)).throw(h.invalidParameters),t=k.of(this._iid),n=t.dispatcher,r=t.sdkState,a=t.requestQueue,i=new $r({userId:r.userId,channelUrl:this.url,pushTriggerOption:e}),[4,a.send(i)];case 1:return o=c.sent(),u=o.as(es).pushTriggerOption,this.myPushTriggerOption=u,n.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),[2,u]}}))}))},c.prototype.setMyCountPreference=function(e){return p(this,void 0,void 0,(function(){var t,n,r,a,i,o,u;return f(this,(function(c){switch(c.label){case 0:return l(s(as,e)).throw(h.invalidParameters),t=k.of(this._iid),n=t.dispatcher,r=t.sdkState,a=t.requestQueue,i=new Br({channelUrl:this.url,userId:r.userId,countPreference:e}),[4,a.send(i)];case 1:return o=c.sent(),u=o.as(qr).countPreference,this.myCountPreference=u,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),n.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),[2,u]}}))}))},c.prototype.resetMyHistory=function(){return p(this,void 0,void 0,(function(){var e,t,n,r,s,a;return f(this,(function(i){switch(i.label){case 0:return e=k.of(this._iid),t=e.dispatcher,n=e.requestQueue,r=new Wr({channelUrl:this.url}),[4,n.send(r)];case 1:return s=i.sent(),a=s.as(jr).messageOffsetTimestamp,this.messageOffsetTimestamp=a,this.lastMessage&&this.lastMessage.createdAt<a&&(this.lastMessage=null),t.dispatch(new sn({channels:[this],source:y.EVENT_CHANNEL_RESET_HISTORY,isWebSocketEventComing:!0})),[2,this]}}))}))},c.prototype.pinMessage=function(e){return p(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return l(g("number",e)&&e>0).throw(h.invalidParameters),t=k.of(this._iid).requestQueue,n=new rs({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype.unpinMessage=function(e){return p(this,void 0,void 0,(function(){var t,n;return f(this,(function(r){switch(r.label){case 0:return l(g("number",e)&&e>0).throw(h.invalidParameters),t=k.of(this._iid).requestQueue,n=new ss({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},c.prototype._uploadFileAndUpdateParams=function(e){return p(this,void 0,void 0,(function(){var t,n,r,s,a,i,o,u,c,l,h;return f(this,(function(d){switch(d.label){case 0:return E(e.file)?(t=k.of(this._iid).requestQueue,n=new ht({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,t.send(n)]):[3,2];case 1:r=d.sent(),s=r.as(lt),a=s.url,i=s.fileSize,o=void 0===i?e.fileSize:i,u=s.thumbnailSizes,c=void 0===u?e.thumbnailSizes:u,l=s.requireAuth,h=void 0!==l&&l,e.fileUrl=a,e.fileSize=o,e.thumbnailSizes=c,e.requireAuth=h,d.label=2;case 2:return[2]}}))}))},c.prototype.resendMessage=function(e,t){var n,r=this;if(l(e instanceof Re&&!e.scheduledInfo&&e.isResendable).throw(h.invalidParameters),e.isUserMessage()){var s=null!==(n=e.messageParams)&&void 0!==n?n:et(e),a=new ot;return this._sendUserMessage(s,tt.RESEND,e.reqId).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(e){r._tryUpdateLastMessageAndCallEvents(r,e),a._trigger(e)})),a}if(e.isFileMessage()){var i=this._validateFailedFileMessageHasFile(e,t);l(i).throw(h.invalidParameters);s=nt(e,t);var o=new ot;return this._sendFileMessage(s,tt.RESEND,e.reqId).onPending((function(e){o._trigger(e)})).onFailed((function(e,t){o._triggerFailed(e,t)})).onSucceeded((function(e){r._tryUpdateLastMessageAndCallEvents(r,e),o._trigger(e)})),o}if(e.isMultipleFilesMessage()){s=e.messageParams;var u=new Ke;return this._sendMultipleFilesMessage(s,tt.RESEND,e.reqId).onPending((function(e){u._trigger(e)})).onFailed((function(e,t){u._triggerFailed(e,t)})).onSucceeded((function(e){r._tryUpdateLastMessageAndCallEvents(r,e),u._trigger(e)})).onFileUploaded((function(e,t,n,r){u._triggerOnFileUploaded(e,t,n,r)})),u}},c.prototype.copyMessage=function(e,t){var n=this;if(l(e instanceof rt&&t instanceof Re&&t.sendingStatus===se.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(h.invalidParameters),t.isUserMessage()){l(!t.poll).throw(h.notSupportedError);var r=st(t),s=new ot;return e._sendUserMessage(r).onPending((function(e){s._trigger(e)})).onFailed((function(e,t){s._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),s._trigger(t)})),s}if(t.isFileMessage()){r=at(t);var a=new ot;return e._sendFileMessage(r).onPending((function(e){a._trigger(e)})).onFailed((function(e,t){a._triggerFailed(e,t)})).onSucceeded((function(t){e.isGroupChannel()&&n._tryUpdateLastMessageAndCallEvents(e,t),a._trigger(t)})),a}if(t.isMultipleFilesMessage()){if(e.isGroupChannel()){r=it(t);var i=new Ke;return e._sendMultipleFilesMessage(r,tt.COPY).onPending((function(e){i._trigger(e)})).onFailed((function(e,t){i._triggerFailed(e,t)})).onSucceeded((function(t){n._tryUpdateLastMessageAndCallEvents(e,t),i._trigger(t)})).onFileUploaded((function(e,t,n,r){i._triggerOnFileUploaded(e,t,n,r)})),i}throw h.channelTypeNotSupportedError}},c}(rt);export{ls as A,qt as B,as as C,hr as D,Mn as E,dr as F,nr as G,Ot as H,en as I,yn as J,xn as K,kn as L,Vt as M,Xn as N,xt as O,Pt as P,Ht as Q,Bt as R,sr as S,$t as T,kt as U,Qn as V,wr as W,Jn as X,Cr as Y,br as Z,Wt as a,Er as b,hs as c,Ft as d,Yn as e,Yt as f,Jt as g,Xt as h,zt as i,Qt as j,nn as k,Gt as l,is as m,Tr as n,Fr as o,Lt as p,Ar as q,Rt as r,rn as s,Dr as t,Ir as u,Kt as v,rr as w,Mr as x,Sr as y,os as z};
