"use strict";var e,s=require("./__bundle-032c97c6.js");class t extends s.APIRequestCommand{constructor(e){if(super(),this.method=s.APIRequestMethod.POST,this.path=`${s.API_PATH_UPLOAD}`,this.params=s.deundefined({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(let s=0;s<e.thumbnailSizes.length;s++){const{maxWidth:t,maxHeight:i}=e.thumbnailSizes[s];this.params[`thumbnail${s+1}`]=`${t},${i}`}this.requestId=e.requestId}}class i extends s.APIResponseCommand{constructor(e,s){var t,i,a;super(e,s),this.url=s.url,this.fileSize=null!==(t=s.file_size)&&void 0!==t?t:0,this.thumbnailSizes=null!==(i=s.thumbnails)&&void 0!==i?i:[],this.requireAuth=null!==(a=s.require_auth)&&void 0!==a&&a}}class a extends s.InstancedObject{constructor(e,t){var i,a,n;super(e),this.replyCount=0,this.lastRepliedAt=0,this.updatedAt=0,this.replyCount=null!==(i=t.reply_count)&&void 0!==i?i:0,this.mostRepliedUsers=t.most_replies&&s.isArrayOf("object",t.most_replies)?t.most_replies.map((e=>new s.User(this._iid,e))):[],this.lastRepliedAt=null!==(a=t.last_replied_at)&&void 0!==a?a:0,this.updatedAt=null!==(n=t.updated_at)&&void 0!==n?n:0}static payloadify(e){return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((e=>s.User.payloadify(e))):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))}}exports.ReactionEventOperation=void 0,(e=exports.ReactionEventOperation||(exports.ReactionEventOperation={})).ADD="add",e.DELETE="delete";class n{constructor(e){var t;const i=e.key,a=null!==(t=[...e.user_ids])&&void 0!==t?t:[],n=e.updated_at;s.isTypeOf("string",i)&&i&&s.isArrayOf("string",a)&&a.length>0&&s.isTypeOf("number",n)&&(this.key=i,this.userIds=a,this.updatedAt=n);const r={};for(const e of this.userIds)r[e]=this.updatedAt;this._version=r}get isEmpty(){return 0===this.userIds.length}static payloadify(e){return s.deundefined(s.undefineNullProps({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}))}applyEvent(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){const s=this.userIds.indexOf(e.userId);switch(e.operation){case exports.ReactionEventOperation.ADD:s<0&&this.userIds.push(e.userId);break;case exports.ReactionEventOperation.DELETE:s>=0&&this.userIds.splice(s,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}}}class r{constructor(e){this.key=e.key,this.value=s.isArrayOf("string",e.value)?[...e.value]:[]}static payloadify(e){var t;return s.deundefined(s.undefineNullProps({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}))}}class l{constructor(e){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.secure_url&&(this.secureUrl=e.secure_url),e.type&&(this.type=e.type),e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.alt&&(this.alt=e.alt)}static payloadify(e){var t,i;return s.deundefined(s.undefineNullProps({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(i=e.height)&&void 0!==i?i:0,alt:e.alt}))}}class d{constructor(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e["og:title"]&&(this.title=e["og:title"]),e["og:url"]&&(this.url=e["og:url"]),e["og:description"]&&(this.description=e["og:description"]),e["og:image"]&&(this.defaultImage=new l(e["og:image"]))}static payloadify(e){return s.deundefined(s.undefineNullProps({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?l.payloadify(e.defaultImage):null}))}}class o{constructor(e){var s,t;this.volume=0,this.name=null!==(s=e.name)&&void 0!==s?s:"default",this.volume=null!==(t=e.volume)&&void 0!==t?t:1}serialize(){return{name:this.name,volume:this.volume}}static payloadify(e){return s.deundefined(s.undefineNullProps({name:e.name,volume:e.volume}))}}class u extends s.User{constructor(e,t){var i;super(e,t),this.isBlockedByMe=!1,this.role=s.isEnumOf(s.Role,t.role)?t.role:s.Role.NONE,this.isBlockedByMe=null!==(i=t.is_blocked_by_me)&&void 0!==i&&i}static payloadify(e){return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))}}var h,p;exports.ScheduledStatus=void 0,(h=exports.ScheduledStatus||(exports.ScheduledStatus={})).PENDING="pending",h.SENT="sent",h.FAILED="failed",h.CANCELED="canceled",exports.InternalScheduledStatus=void 0,(p=exports.InternalScheduledStatus||(exports.InternalScheduledStatus={})).PENDING="pending",p.IN_QUEUE="in_queue",p.SENT="sent",p.FAILED="failed",p.CANCELED="canceled",p.REMOVED="removed";const c=e=>{switch(e){case s.MessageType.BASE:return"";case s.MessageType.USER:return"MESG";case s.MessageType.FILE:return"FILE";case s.MessageType.ADMIN:return"ADMM"}};class m extends s.InstancedObject{constructor(e,t){var i,l,u,h,p,c,m,g,y,_,f,v,I,T,M,S;super(e),this.channelType=s.ChannelType.BASE,this.parentMessage=null,this.silent=!1,this.isOperatorMessage=!1,this.messageType=s.MessageType.BASE,this.mentionType=null,this.threadInfo=null,this.reactions=[],this.metaArrays=[],this.appleCriticalAlertOptions=null,this.createdAt=0,this.updatedAt=0,this.scheduledInfo=null,this.extendedMessage={},this._isContinuousMessages=!1,this._scheduledStatus=null,this.messageId=null!==(l=null!==(i=t.msg_id)&&void 0!==i?i:t.message_id)&&void 0!==l?l:0,this.channelUrl=t.channel_url,this.channelType=s.isEnumOf(s.ChannelType,t.channel_type)?t.channel_type:s.ChannelType.GROUP,t.channel&&(t.channel.channel_url&&(this.channelUrl=t.channel.channel_url),t.channel.channel_type&&(this.channelType=t.channel.channel_type)),this.parentMessageId=null!==(u="string"==typeof t.parent_message_id?parseInt(t.parent_message_id):t.parent_message_id)&&void 0!==u?u:0,this.data=null!==(h=t.data)&&void 0!==h?h:"",this.customType=null!==(p=t.custom_type)&&void 0!==p?p:"",this.mentionType=s.isEnumOf(s.MentionType,t.mention_type)?t.mention_type:null,this.mentionedUsers=t.mentioned_users?t.mentioned_users.map((e=>new s.User(this._iid,e))):null,this.mentionedUserIds=null!==(c=t.mentioned_user_ids)&&void 0!==c?c:null,this.mentionedUsers&&!this.mentionedUserIds&&(this.mentionedUserIds=this.mentionedUsers.map((e=>e.userId))),this.mentionedMessageTemplate=null!==(m=t.mentioned_message_template)&&void 0!==m?m:"",this.threadInfo=t.thread_info?new a(this._iid,t.thread_info):null,this.reactions=t.reactions?t.reactions.map((e=>new n(e))):[];const O=null!==(g=t.metaarray)&&void 0!==g?g:{},A=null!==(y=t.metaarray_key_order)&&void 0!==y?y:Object.keys(O).sort(((e,s)=>e.localeCompare(s)));this.metaArrays=[];for(let e=0;e<A.length;e++){const s=A[e];this.metaArrays.push(new r({key:s,value:O[s]||[]}))}t.sorted_metaarray&&(this.metaArrays=t.sorted_metaarray.map((e=>new r(e)))),this.ogMetaData=t.og_tag?new d(t.og_tag):null,this.silent=null!==(_=t.silent)&&void 0!==_&&_,this.isOperatorMessage=null!==(f=t.is_op_msg)&&void 0!==f&&f,this.appleCriticalAlertOptions=t.apple_critical_alert_options?new o(t.apple_critical_alert_options):null,this.createdAt=null!==(I=null!==(v=t.created_at)&&void 0!==v?v:t.ts)&&void 0!==I?I:0,this.updatedAt=null!==(T=t.updated_at)&&void 0!==T?T:0,"number"==typeof t.scheduled_message_id&&"number"==typeof t.scheduled_at&&t.scheduled_status&&(this.scheduledInfo={scheduledMessageId:t.scheduled_message_id,scheduledAt:t.scheduled_at},this._scheduledStatus=t.scheduled_status),this.extendedMessage=null!==(M=t.extended_message)&&void 0!==M?M:{},this._isContinuousMessages=null!==(S=t.is_continuous_messages)&&void 0!==S&&S}static payloadify(e){var t,i,l,u;return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:c(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(t=e.mentionedUsers)||void 0===t?void 0:t.map((e=>s.User.payloadify(e))),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?a.payloadify(e.threadInfo):null,reactions:e.reactions.map((e=>n.payloadify(e))),sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((e=>r.payloadify(e))),og_tag:e.ogMetaData?d.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?o.payloadify(e.appleCriticalAlertOptions):null,created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(l=e.scheduledInfo)||void 0===l?void 0:l.scheduledMessageId,scheduled_at:null===(u=e.scheduledInfo)||void 0===u?void 0:u.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})))}static _getParentMessageInfoPayload(e){return s.deundefined(s.undefineNullProps({type:e.messageType,ts:e.createdAt,user:e.sender?u.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth}}))}isIdentical(e){return this.messageId===e.messageId}isEqual(e){return s.deepEqual(this,e)}isUserMessage(){return this.messageType===s.MessageType.USER}isFileMessage(){return this.messageType===s.MessageType.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")}isMultipleFilesMessage(){return this.messageType===s.MessageType.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")}isAdminMessage(){return this.messageType===s.MessageType.ADMIN}serialize(){return s.serialize(this)}getMetaArraysByKeys(e){return this.metaArrays.filter((s=>e.includes(s.key)))}applyThreadInfoUpdateEvent(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1}applyReactionEvent(e){if(this.messageId===e.messageId){let s=!1;for(let t=0;t<this.reactions.length;t++)if(this.reactions[t].key===e.key){this.reactions[t].applyEvent(e),this.reactions[t].isEmpty&&this.reactions.splice(t,1),s=!0;break}s||"add"!==e.operation||this.reactions.push(new n(n.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}}applyParentMessage(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){const s=this.parentMessage.updatedAt;if(e.updatedAt>=s)return this.parentMessage=e,!0}return!1}}class g extends m{constructor(e,t){var i,a,n,r;if(super(e,t),this.reqId="",this.replyToChannel=!1,this.errorCode=0,this.sender=t.user?new u(this._iid,t.user):t.sender_id,this.reqId=null!==(a=null!==(i=t.req_id)&&void 0!==i?i:t.request_id)&&void 0!==a?a:"",this.replyToChannel=null!==(n=t.is_reply_to_channel)&&void 0!==n&&n,t.request_state&&s.isEnumOf(s.SendingStatus,t.request_state)&&(this.sendingStatus=t.request_state),!this.sendingStatus)if(this.messageId>0)this.sendingStatus=s.SendingStatus.SUCCEEDED;else if(this.scheduledInfo)switch(t.scheduled_status&&(this._scheduledStatus=t.scheduled_status),t.scheduled_status){case exports.InternalScheduledStatus.SENT:case exports.InternalScheduledStatus.IN_QUEUE:this.sendingStatus=s.SendingStatus.SUCCEEDED;break;case exports.InternalScheduledStatus.PENDING:this.sendingStatus=s.SendingStatus.SCHEDULED;break;case exports.InternalScheduledStatus.FAILED:case exports.InternalScheduledStatus.REMOVED:this.sendingStatus=s.SendingStatus.FAILED;break;case exports.InternalScheduledStatus.CANCELED:this.sendingStatus=s.SendingStatus.CANCELED}else this.sendingStatus=s.SendingStatus.PENDING;this.errorCode=null!==(r=t.error_code)&&void 0!==r?r:0}static payloadify(e){return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{user:u.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))}get isResendable(){return this.sendingStatus===s.SendingStatus.FAILED&&s.isResendableError(this.errorCode)}isIdentical(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId}}class y{constructor(e){var s,t;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(s=e.real_width)&&void 0!==s?s:e.width,this.realHeight=null!==(t=e.real_height)&&void 0!==t?t:e.height}static payloadify(e){return s.deundefined(s.undefineNullProps({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}))}get plainUrl(){return this.url.split("?auth=")[0]}}const _={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:s.MessageTypeFilter.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},f=e=>s.isTypeOf("number",e.prevResultSize)&&s.isTypeOf("number",e.nextResultSize)&&s.isTypeOf("boolean",e.isInclusive)&&s.isTypeOf("boolean",e.reverse)&&s.isTypeOf("string",e.messageTypeFilter)&&s.isEnumOf(s.MessageTypeFilter,e.messageTypeFilter)&&s.isArrayOf("string",e.customTypesFilter,!0)&&s.isArrayOf("string",e.senderUserIdsFilter,!0)&&s.isTypeOf("boolean",e.includeMetaArray)&&s.isTypeOf("boolean",e.includeReactions)&&s.isTypeOf("boolean",e.includeParentMessageInfo);class v extends m{constructor(e,t){var i,a,n,r;if(super(e,t),this.translations={},this.message=null!==(i=t.message)&&void 0!==i?i:"",this.messageType=s.MessageType.ADMIN,this.translations=null!==(a=t.translations)&&void 0!==a?a:{},t.parent_message_info){const i=t.parent_message_info;this.parentMessage=O(e,s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},i),{message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(n=i.file)||void 0===n?void 0:n.url,require_auth:null===(r=i.file)||void 0===r?void 0:r.require_auth}))))}}static payloadify(e){return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}getThreadedMessagesByTimestamp(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},_),t);s.unless(this.messageId>0&&s.isTypeOf("number",e)&&f(i)).throw(s.SendbirdError.invalidParameters);const a=B.of(this._iid);return yield a.getThreadedMessagesByTimestamp(this,e,i)}))}}class I{constructor(e){var t,i;this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(i=e.vendor)&&void 0!==i?i:"",e.detail&&s.isTypeOf("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}static payloadify(e){return s.deundefined(s.undefineNullProps({type:e.type,vendor:e.vendor,detail:e.detail}))}}class T extends g{constructor(e,t){var i,a,n,r,l;if(super(e,t),this.message="",this.messageParams=null,this.translations={},this.translationTargetLanguages=[],this.messageSurvivalSeconds=-1,this.plugins=[],this._poll=null,this.message=t.message,this.messageType=s.MessageType.USER,this.translations=null!==(i=t.translations)&&void 0!==i?i:{},this.translationTargetLanguages=null!==(a=t.target_langs)&&void 0!==a?a:[],0===Object.keys(this.translations).length&&this.translationTargetLanguages.length>0)for(const e of this.translationTargetLanguages)this.translations[e]="";if(this.messageSurvivalSeconds=null!==(n=t.message_survival_seconds)&&void 0!==n?n:-1,this.plugins=t.plugins?t.plugins.map((e=>new I(e))):[],this._poll=t.poll?new s.Poll(this._iid,t.poll):null,t.parent_message_info){const i=t.parent_message_info;this.parentMessage=O(e,s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},i),{created_at:i.ts,message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(r=i.file)||void 0===r?void 0:r.url,require_auth:null===(l=i.file)||void 0===l?void 0:l.require_auth}))))}}static payloadify(e){return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((e=>I.payloadify(e))),poll:e._poll?s.Poll.payloadify(e._poll):null,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}getThreadedMessagesByTimestamp(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},_),t);s.unless(this.messageId>0&&s.isTypeOf("number",e)&&f(i)).throw(s.SendbirdError.invalidParameters);const a=B.of(this._iid);return yield a.getThreadedMessagesByTimestamp(this,e,i)}))}applyPoll(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)}get poll(){return this._poll}}class M extends s.InstancedObject{constructor(e,t){var i,a,n,r,l;super(e),this.plainUrl="",this.fileName=null,this.mimeType=null,this.fileSize=0,this.thumbnails=[],this._requireAuth=!1,this.plainUrl=null!==(i=t.url)&&void 0!==i?i:"",this.fileName=null!==(a=t.file_name)&&void 0!==a?a:null,this.mimeType=null!==(n=t.file_type)&&void 0!==n?n:null,this.fileSize=null!==(r=t.file_size)&&void 0!==r?r:0,this._requireAuth=null!==(l=t.require_auth)&&void 0!==l&&l;const{sessionManager:d}=s.Vault.of(this._iid);this.thumbnails=t.thumbnails?t.thumbnails.map((e=>new y(Object.assign(Object.assign({},e),{url:`${e.url.split("?auth=")[0]}${this._requireAuth?`?auth=${d.ekey}`:""}`})))):[]}static payloadify(e){var t;return s.deundefined(s.undefineNullProps({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((e=>({url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}))),require_auth:e._requireAuth}))}get url(){const{sessionManager:e}=s.Vault.of(this._iid);return this._requireAuth?`${this.plainUrl}?auth=${e.ekey}`:this.plainUrl}}class S extends g{constructor(e,t){var i,a,n,r,l;if(super(e,t),this.messageParams=null,this.fileInfoList=[],this.messageSurvivalSeconds=-1,this.messageType=s.MessageType.FILE,this.fileInfoList=null!==(a=null===(i=t.files)||void 0===i?void 0:i.map((s=>new M(e,s))))&&void 0!==a?a:[],this.messageSurvivalSeconds=null!==(n=t.message_survival_seconds)&&void 0!==n?n:-1,t.parent_message_info){const i=t.parent_message_info;this.parentMessage=O(e,s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},i),{created_at:i.ts,message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(r=i.file)||void 0===r?void 0:r.url,require_auth:null===(l=i.file)||void 0===l?void 0:l.require_auth}))))}}getThreadedMessagesByTimestamp(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},_),t);s.unless(this.messageId>0&&s.isTypeOf("number",e)&&f(i)).throw(s.SendbirdError.invalidParameters);const a=B.of(this._iid);return yield a.getThreadedMessagesByTimestamp(this,e,i)}))}static payloadify(e){return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{files:e.fileInfoList&&e.fileInfoList&&Array.isArray(e.fileInfoList)?e.fileInfoList.map((e=>M.payloadify(e))):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}static _isMultipleFilesMessagePayload(e){const s=e.files;return Array.isArray(s)&&s.length>=2}static _isMultipleFilesMessageSerializedData(e){const s=e.fileInfoList;return Array.isArray(s)}}const O=(e,t)=>{switch(t.type){case"MESG":return new T(e,t);case"FILE":return S._isMultipleFilesMessagePayload(t)?new S(e,t):new A(e,t);case"ADMM":case"BRDM":return new v(e,t)}throw s.SendbirdError.unknown};class A extends g{constructor(e,t){var i,a,n,r,l,d,o,u,h,p,c,m,g,_;super(e,t),this.messageParams=null,this.plainUrl="",this.requireAuth=!1,this.thumbnails=[],this.messageSurvivalSeconds=-1,this.messageType=s.MessageType.FILE;const f=t.file;this.plainUrl=(null!==(a=null!==(i=null==f?void 0:f.url)&&void 0!==i?i:t.url)&&void 0!==a?a:"").split("?auth=")[0],this.name=null!==(r=null!==(n=null==f?void 0:f.name)&&void 0!==n?n:t.name)&&void 0!==r?r:"File",this.size=null!==(d=null!==(l=null==f?void 0:f.size)&&void 0!==l?l:t.size)&&void 0!==d?d:0,this.data=null!==(u=null!==(o=null==f?void 0:f.data)&&void 0!==o?o:t.custom)&&void 0!==u?u:"",this.type=f?null!==(h=f.type)&&void 0!==h?h:"":null!==(p=t.type)&&void 0!==p?p:"";const{sessionManager:v}=s.Vault.of(this._iid);if(this.requireAuth=null!==(c=t.require_auth)&&void 0!==c&&c,this.thumbnails=t.thumbnails?t.thumbnails.map((e=>new y(Object.assign(Object.assign({},e),{url:`${e.url.split("?auth=")[0]}${this.requireAuth?`?auth=${v.ekey}`:""}`})))):[],this.messageSurvivalSeconds=null!==(m=t.message_survival_seconds)&&void 0!==m?m:-1,t.parent_message_info){const i=t.parent_message_info;this.parentMessage=O(e,s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},i),{created_at:i.ts,message_id:this.parentMessageId,channel_url:this.channelUrl,channel_type:this.channelType,file:i.file,url:null===(g=i.file)||void 0===g?void 0:g.url,require_auth:null===(_=i.file)||void 0===_?void 0:_.require_auth}))))}}static payloadify(e){var t;return s.deundefined(s.undefineNullProps(Object.assign(Object.assign({},super.payloadify(e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((e=>({url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}))),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?super._getParentMessageInfoPayload(e.parentMessage):null})))}get url(){const{sessionManager:e}=s.Vault.of(this._iid);return this.requireAuth?`${this.plainUrl}?auth=${e.ekey}`:this.plainUrl}getThreadedMessagesByTimestamp(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const i=Object.assign(Object.assign({},_),t);s.unless(this.messageId>0&&s.isTypeOf("number",e)&&f(i)).throw(s.SendbirdError.invalidParameters);const a=B.of(this._iid);return yield a.getThreadedMessagesByTimestamp(this,e,i)}))}}class E extends s.WebSocketRequestCommand{constructor(e){var t,i,a;let n=[];e.mentionType===s.MentionType.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((e=>e.userId)))),super({code:"FILE",ackRequired:!0,payload:s.deundefined(s.undefineNullProps({channel_url:e.channelUrl,files:e.files?C(e.files):null,url:e.url,name:null!==(t=e.fileName)&&void 0!==t?t:"",type:null!==(i=e.mimeType)&&void 0!==i?i:"",size:null!==(a=e.fileSize)&&void 0!==a?a:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==s.PushNotificationDeliveryOption.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?o.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})}}class b extends s.APIRequestCommand{constructor(e){var t,i;super();let a=[];e.mentionType===s.MentionType.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map((e=>e.userId)))),this.method=s.APIRequestMethod.POST,this.path=`${s.getChannelApiPathByType(e.channelType)}/${encodeURIComponent(e.channelUrl)}/messages`,this.params=s.deundefined(s.undefineNullProps({message_type:s.MessageType.FILE,user_id:e.userId,files:e.files?C(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:a,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:null===(t=e.thumbnailSizes)||void 0===t?void 0:t.map((e=>y.payloadify(e))),require_auth:e.requireAuth,sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((e=>r.payloadify(e))),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?o.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage}))}}class U extends s.WebSocketEventCommand{constructor(e,t,i){var a,n,r,l;super(e,"FILE",i),this.message=i.files&&i.files.length>=2?new S(e,i):new A(e,i);const{sdkState:d}=s.Vault.of(e);this.isMentioned=s.checkIfMentioned(this.message.mentionType,null!==(r=null!==(a=this.message.mentionedUserIds)&&void 0!==a?a:null===(n=this.message.mentionedUsers)||void 0===n?void 0:n.map((e=>e.userId)))&&void 0!==r?r:[],d.userId),this.forceUpdateLastMessage=null!==(l=i.force_update_last_message)&&void 0!==l&&l}}class P extends s.APIResponseCommand{constructor(e,t){var i,a,n,r;super(e,t),this.message=t.files&&t.files.length>=2?new S(e,t):new A(e,t);const{sdkState:l}=s.Vault.of(e);this.isMentioned=s.checkIfMentioned(this.message.mentionType,null!==(n=null!==(i=this.message.mentionedUserIds)&&void 0!==i?i:null===(a=this.message.mentionedUsers)||void 0===a?void 0:a.map((e=>e.userId)))&&void 0!==n?n:[],l.userId),this.forceUpdateLastMessage=null!==(r=t.force_update_last_message)&&void 0!==r&&r}}function C(e){return e.map((e=>{var t,i;return s.deundefined(s.undefineNullProps({url:e.fileUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnailSizes)||void 0===t?void 0:t.map((e=>y.payloadify(e))),require_auth:null===(i=e._uploadedMetaData)||void 0===i?void 0:i.requireAuth}))}))}var x;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(x||(x={}));class F{constructor(e,{sdkState:t,dispatcher:i,requestQueue:a,onlineDetector:n,cacheContext:r}){this._queueMap=new Map,this._iid=e,this._sdkState=t,this._requestQueue=a,this._cacheContext=r,this._dispatcher=i,this._dispatcher.on((e=>{e instanceof s.ConnectionStateChangeCommand&&(this._connectionState=e.stateType)})),this._onlineDetector=n}get _shouldSendThroughWebSocket(){return this._connectionState===s.ConnectionStateType.CONNECTED||this._connectionState===s.ConnectionStateType.CONNECTING||this._connectionState===s.ConnectionStateType.RECONNECTING}_sendFileMessage(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=this._createSendFileMessageRequestParams(e,t);if(this._shouldSendThroughWebSocket){const e=new E(s),t=yield this._requestQueue.send(e),{message:i}=t.as(U);return i}{const e=new b(Object.assign(Object.assign({},s),{userId:this._sdkState.userId})),t=yield this._requestQueue.send(e),{message:i}=t.as(P);return i}}))}_createSendFileMessageRequestParams(e,s){const t=Object.assign(Object.assign({},s.params),{channelUrl:e.url,channelType:e.channelType,reqId:s.requestId,url:""});if(s.multipleFileUploadInfo){const e=s.params;t.files=e.fileInfoList}else{const e=s.params;t.url=e.fileUrl,t.requireAuth=e.requireAuth}return t}_resolveMessageQueue(e){var t;return s.__awaiter(this,void 0,void 0,(function*(){const i=this._queueMap.get(e.url);if(i)if(i.isResolving)i.isResolveRequestPending=!0;else{i.isResolving=!0;const a=[];let n=!0;for(const r of i.messageQueue)switch(r.state){case x.PENDING:case x.UPLOADING:n=!1,a.push(r);break;case x.UPLOADED:if(n)try{r.state=x.SENDING;const t=yield this._sendFileMessage(e,r);r.deferred.resolve(t),yield s.sleep(100)}catch(e){r.deferred.reject(e)}else a.push(r);break;case x.FAILED:{const e=null!==(t=r.error)&&void 0!==t?t:s.SendbirdError.unknown;r.deferred.reject(e.code===s.SendbirdErrorCode.REQUEST_CANCELED?s.SendbirdError.fileUploadCanceled:e);break}}const r=i.isResolveRequestPending;i.messageQueue=a,i.isResolving=!1,i.isResolveRequestPending=!1,r&&(yield this._resolveMessageQueue(e))}}))}_uploadNextPendingItem(e){var t;return s.__awaiter(this,void 0,void 0,(function*(){const i=this._queueMap.get(e.url);if(i){const a=i.messageQueue.find((e=>e.state===x.PENDING));if(a){if(a.multipleFileUploadInfo){const{uploadIndex:n,uploadCount:r,requestHandler:l}=a.multipleFileUploadInfo,d=a.params.fileInfoList[n];s.isFile(d.file)&&!(null===(t=d._uploadedMetaData)||void 0===t?void 0:t.isUploaded)?yield this._tryUploadNextItemAndUpdateItemState(e,i,a):a.state=n<r-1?x.PENDING:x.UPLOADED;const o=n;null==l||l._triggerOnFileUploaded(a.requestId,o,d,a.error),a.multipleFileUploadInfo.uploadIndex++}else{const t=a.params;s.isFile(t.file)?yield this._tryUploadNextItemAndUpdateItemState(e,i,a):(t.thumbnailSizes=[],a.state=x.UPLOADED)}this._uploadNextPendingItem(e),yield this._resolveMessageQueue(e)}}}))}_tryUploadNextItemAndUpdateItemState(e,t,i){return s.__awaiter(this,void 0,void 0,(function*(){const a=yield this._onlineDetector.isOnline(),{sessionManager:n}=s.Vault.of(this._iid);if(!n.currentUser||!a)return i.error=s.SendbirdError.connectionRequired,void(i.state=x.FAILED);if(t.uploadQueue.length<6){i.state=x.UPLOADING,t.uploadQueue.push(i);try{if(i.multipleFileUploadInfo){const{uploadIndex:s,uploadCount:t}=i.multipleFileUploadInfo,a=i.params;yield this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,i,a),i.state=s<t-1?x.PENDING:x.UPLOADED}else{const s=i.params;yield this._uploadNextFileForSingleFileItemAndUpdateParams(e,i,s),i.state=x.UPLOADED}}catch(e){i.error=e.code===s.SendbirdErrorCode.REQUEST_FAILED?new s.SendbirdError({code:s.SendbirdErrorCode.NETWORK_ERROR,message:"Failed to upload a file."}):e,i.state=x.FAILED}this._dequeueUploadItem(t,i)}}))}_dequeueUploadItem(e,s){const t=e.uploadQueue.findIndex((e=>e.requestId===s.requestId));t>=0&&e.uploadQueue.splice(t,1)}_uploadNextFileForSingleFileItemAndUpdateParams(e,a,n){var r,l,d;return s.__awaiter(this,void 0,void 0,(function*(){const s=new t({file:n.file,channelUrl:e.url,thumbnailSizes:n.thumbnailSizes,requestId:a.requestId}),o=yield this._requestQueue.send(s),{url:u,fileSize:h=n.fileSize,thumbnailSizes:p=n.thumbnailSizes,requireAuth:c=!1}=o.as(i);n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(l=n.mimeType)&&void 0!==l?l:n.file.type,n.fileSize=null!==(d=n.fileSize)&&void 0!==d?d:n.file.size,n.fileUrl=u,n.fileSize=h,n.thumbnailSizes=p,n.requireAuth=c}))}_uploadNextFileForMultipleFilesItemAndUpdateParams(e,a,n){var r,l,d;return s.__awaiter(this,void 0,void 0,(function*(){const{uploadIndex:s}=a.multipleFileUploadInfo,o=n.fileInfoList[s],u=new t({file:o.file,channelUrl:e.url,thumbnailSizes:o.thumbnailSizes,requestId:a.requestId}),h=yield this._requestQueue.send(u),{url:p,fileSize:c=o.fileSize,thumbnailSizes:m=o.thumbnailSizes,requireAuth:g=!1}=h.as(i);o.fileName=null!==(r=o.fileName)&&void 0!==r?r:o.file.name,o.mimeType=null!==(l=o.mimeType)&&void 0!==l?l:o.file.type,o.fileSize=null!==(d=o.fileSize)&&void 0!==d?d:o.file.size,o.file=void 0,o.fileUrl=p,o.fileSize=c,o.thumbnailSizes=m,o._uploadedMetaData=Object.assign(Object.assign({},o._uploadedMetaData),{requireAuth:g,isUploaded:!0})}))}request(e,t,i,a){return s.__awaiter(this,void 0,void 0,(function*(){if(!this._queueMap.has(e.url)){const s={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1};this._queueMap.set(e.url,s)}const n=this._queueMap.get(e.url),r=new s.Deferred,l={requestId:t,params:i,state:x.PENDING,deferred:r};if(function(e){return"fileInfoList"in e}(i)){const e={uploadIndex:0,uploadCount:i.fileInfoList.length,requestHandler:a};l.multipleFileUploadInfo=e}return n.messageQueue.push(l),this._uploadNextPendingItem(e),r.promise}))}cancel(e,t){const i=this._queueMap.get(e.url);if(i){const a=t?[i.messageQueue.find((e=>e.requestId===t))]:[...i.messageQueue];for(const t of a)if(t)switch(t.state){case x.PENDING:t.state=x.FAILED,t.error=s.SendbirdError.requestCanceled,this._resolveMessageQueue(e);break;case x.UPLOADING:this._requestQueue.cancel(t.requestId)}}}}const N={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:s.MessageTypeFilter.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:s.ReplyType.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},R={replyType:s.ReplyType.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1};class q extends s.APIRequestCommand{constructor({channelType:e,channelUrl:t,messageId:i,includeMetaArray:a,includeReactions:n,includeThreadInfo:r,includeParentMessageInfo:l}){super(),this.method=s.APIRequestMethod.GET,this.path=`${s.getChannelApiPathByType(e)}/${encodeURIComponent(t)}/messages/${encodeURIComponent(i)}`,this.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions:n,include_thread_info:r,include_parent_message_info:l,include_poll_details:!0}}}class w extends s.APIResponseCommand{constructor(e,s){super(e,s),this.message=s?O(e,Object.assign({},s)):null}}class D extends s.APIRequestCommand{constructor({channelType:e,channelUrl:t,timestamp:i,token:a,prevResultSize:n,nextResultSize:r,isInclusive:l,reverse:d,messageTypeFilter:o,customTypesFilter:u,senderUserIdsFilter:h,replyType:p,includeMetaArray:c,includeReactions:m,parentMessageId:g,includeThreadInfo:y,includeParentMessageInfo:_,showSubchannelMessagesOnly:f,checkingContinuousMessages:v}){super(),this.method=s.APIRequestMethod.GET,this.path=`${s.getChannelApiPathByType(e)}/${encodeURIComponent(t)}/messages`,this.params=s.deundefined(s.undefineNullProps({is_sdk:!0,prev_limit:n,next_limit:r,include:l,reverse:d,message_ts:i,message_id:a,message_type:null!=o?o:null,custom_types:u,sender_ids:h,include_reply_type:p,with_sorted_meta_array:c,include_reactions:m,parent_message_id:g,include_thread_info:y,include_parent_message_info:_,show_subchannel_message_only:f,include_poll_details:!0,checking_continuous_messages:v}))}}class L extends s.APIResponseCommand{constructor(e,s){super(e,s),this.messages=s.messages.map((s=>O(e,s)))}}class k extends s.APIRequestCommand{constructor({channelType:e,channelUrl:t,timestamp:i,token:a,replyType:n,includeMetaArray:r,includeReactions:l,includeThreadInfo:d,includeParentMessageInfo:o}){super(),this.method=s.APIRequestMethod.GET,this.path=`${s.getChannelApiPathByType(e)}/${encodeURIComponent(t)}/messages/changelogs`,this.params={change_ts:i,token:a,with_sorted_meta_array:r,include_reactions:l,include_thread_info:d,include_reply_type:n,include_parent_message_info:o,include_poll_details:!0}}}class z extends s.APIResponseCommand{constructor(e,s){super(e,s),this.updatedMessages=s.updated.map((s=>O(e,s))),this.deletedMessagesInfo=s.deleted.map((e=>({messageId:e.message_id,deletedAt:e.deleted_at}))),this.hasMore=s.has_more,this.nextToken=s.next}}class j extends s.APIRequestCommand{constructor({channelUrl:e,scheduledMessageId:t}){super(),this.method=s.APIRequestMethod.GET,this.path=`${s.API_PATH_GROUP_CHANNELS}/${encodeURIComponent(e)}/scheduled_messages/${encodeURIComponent(t)}`,this.params={}}}class Q extends s.APIResponseCommand{constructor(e,s){super(e,s),this.message=s?O(e,Object.assign({},s)):null}}const G={};class B{constructor(e,{sdkState:s,dispatcher:t,requestQueue:i,onlineDetector:a,cacheContext:n}){this._iid=e,this._sdkState=s,this._requestQueue=i,this._dispatcher=t,this._cacheContext=n,this.fileMessageQueue=new F(e,{sdkState:s,dispatcher:t,requestQueue:i,onlineDetector:a,cacheContext:n}),G[e]=this}static of(e){return G[e]}buildMessageFromSerializedData(e){const t=s.deserialize(e);switch(t.messageType){case s.MessageType.USER:return new T(this._iid,T.payloadify(t));case s.MessageType.FILE:return S._isMultipleFilesMessageSerializedData(t)?new S(this._iid,S.payloadify(t)):new A(this._iid,A.payloadify(t));case s.MessageType.ADMIN:return new v(this._iid,v.payloadify(t))}throw s.SendbirdError.invalidParameters}buildUserMessageCreateParamsFromSerializedData(e,t){return s.deundefined(s.undefineNullProps({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId}))}buildFileMessageCreateParamsFromSerializedData(e,t){var i;return s.deundefined(s.undefineNullProps({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:null===(i=t.thumbnails)||void 0===i?void 0:i.map((e=>({maxWidth:e.width,maxHeight:e.height}))),fileType:e.fileType,requireAuth:t.requireAuth}))}buildMultipleFilesMessageCreateParamsFromSerializedData(e,t){return s.deundefined({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,fileInfoList:e.fileInfoList})}buildScheduledUserMessageCreateParamsFromSerializedData(e,s){return Object.assign(Object.assign({},this.buildUserMessageCreateParamsFromSerializedData(e,s)),{scheduledAt:e.scheduledAt})}buildScheduledFileMessageCreateParamsFromSerializedData(e,s){return Object.assign(Object.assign({},this.buildFileMessageCreateParamsFromSerializedData(e,s)),{scheduledAt:e.scheduledAt})}buildSenderFromSerializedData(e){const t=s.deserialize(e);return new u(this._iid,u.payloadify(t))}getMessage(e){return s.__awaiter(this,void 0,void 0,(function*(){const s=new q(e),t=yield this._requestQueue.send(s),{message:i}=t.as(w);return i}))}getScheduledMessage(e){return s.__awaiter(this,void 0,void 0,(function*(){const s=new j(e),t=yield this._requestQueue.send(s),{message:i}=t.as(Q);return i}))}getMessagesByMessageId(e,t,i,a,n=s.MessageEventSource.REQUEST_MESSAGE){return s.__awaiter(this,void 0,void 0,(function*(){const r=new D(Object.assign(Object.assign({channelType:t,channelUrl:e,token:String(i)},N),a)),l=yield this._requestQueue.send(r),{messages:d}=l.as(L);return this._dispatcher.dispatch(new s.MessageUpdateEventCommand({messages:d,source:n})),d}))}getMessagesByTimestamp(e,t,i,a,n=s.MessageEventSource.REQUEST_MESSAGE){return s.__awaiter(this,void 0,void 0,(function*(){const r=new D(Object.assign(Object.assign({channelType:t,channelUrl:e,timestamp:i},N),a)),l=yield this._requestQueue.send(r),{messages:d}=l.as(L);return this._dispatcher.dispatch(new s.MessageUpdateEventCommand({messages:d,source:n})),d}))}_getMessagesByTimestampForCollection(e,t,i,a,n=s.MessageEventSource.REQUEST_MESSAGE,r){return s.__awaiter(this,void 0,void 0,(function*(){const l=new D(Object.assign(Object.assign(Object.assign({channelType:t,channelUrl:e,timestamp:i},N),a),{checkingContinuousMessages:r})),d=yield this._requestQueue.send(l),o=d.payload,{messages:u}=d.as(L);return this._dispatcher.dispatch(new s.MessageUpdateEventCommand({messages:u,source:n})),{messages:u,isContinuousMessages:o}}))}getThreadedMessagesByTimestamp(e,t,i,a=s.MessageEventSource.REQUEST_THREADED_MESSAGE){return s.__awaiter(this,void 0,void 0,(function*(){const n=new D(Object.assign(Object.assign(Object.assign({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},_),i),{replyType:s.ReplyType.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),r=yield this._requestQueue.send(n),{messages:l}=r.as(L),d=l.slice(1);return d.forEach((s=>{s.parentMessage=e})),this._dispatcher.dispatch(new s.MessageUpdateEventCommand({messages:d,source:a})),{parentMessage:l[0],threadedMessages:d}}))}getMessageChangelogs(e,t,i,a,n=s.MessageEventSource.REQUEST_MESSAGE_CHANGELOGS){return s.__awaiter(this,void 0,void 0,(function*(){const r=new k(s.deundefined(s.undefineNullProps(Object.assign(Object.assign({channelType:t,channelUrl:e,timestamp:"number"==typeof i?i:null,token:"string"==typeof i?i:null},R),a)))),l=yield this._requestQueue.send(r),{updatedMessages:d,deletedMessagesInfo:o,hasMore:u,nextToken:h}=l.as(z),p=o.map((e=>e.messageId));return d.length>0&&this._dispatcher.dispatch(new s.MessageUpdateEventCommand({messages:d,source:n})),p.length>0&&this._dispatcher.dispatch(new s.MessageRemoveEventCommand({messageIds:p,source:n})),{updatedMessages:d,deletedMessageIds:p,hasMore:u,token:h}}))}}class ${constructor(){this._onPending=s.noop,this._onFailed=s.noop,this._onSucceeded=s.noop}_trigger(e){switch(null==e?void 0:e.sendingStatus){case s.SendingStatus.PENDING:0===e.errorCode&&this._onPending(e);break;case s.SendingStatus.SCHEDULED:case s.SendingStatus.SUCCEEDED:this._onSucceeded(e)}}_triggerFailed(e,t){switch(null==t?void 0:t.sendingStatus){case s.SendingStatus.FAILED:case s.SendingStatus.CANCELED:this._onFailed(e,t.scheduledInfo?null:t)}}onPending(e){return this._onPending=e,this}onFailed(e){return this._onFailed=e,this}onSucceeded(e){return this._onSucceeded=e,this}}class H extends s.InstancedObject{constructor(e,t){super(e),this.targetMessageId=0;const i=t.thread_info,n=t.parent_message_id,r=t.channel_url,l=t.channel_type;i&&s.isTypeOf("object",i)&&s.isTypeOf("number",n)&&s.isTypeOf("string",r)&&s.isTypeOf("string",l)&&(this.threadInfo=new a(e,i),this.targetMessageId=n,this.channelUrl=r,this.channelType=l)}}const W={channelUrl:"",channelType:s.ChannelType.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1};class V extends s.APIRequestCommand{constructor({channelCustomType:e,keyword:t,limit:i,reverse:a,exactMatch:n,channelUrl:r,order:l,messageTimestampFrom:d,messageTimestampTo:o,advancedQuery:u,targetFields:h,nextToken:p}){super(),this.method=s.APIRequestMethod.GET,this.path=`${s.API_PATH_SEARCH}/messages`,this.params={custom_type:e,query:t,limit:i,reverse:a,exact_match:n,channel_url:r,message_ts_from:d,message_ts_to:o,sort_field:l,advanced_query:u,target_fields:h,after:p}}}class K extends s.APIResponseCommand{constructor(e,s){super(e,s),this.messages=s.results.map((s=>O(e,s))),this.hasNext=s.has_next,this.nextToken=s.end_cursor,this.totalCount=s.total_count}}var X;exports.MessageSearchOrder=void 0,(X=exports.MessageSearchOrder||(exports.MessageSearchOrder={})).SCORE="score",X.TIMESTAMP="ts";class J extends s.BaseListQuery{constructor(e,s){var t,i,a,n,r,l,d,o,u;super(e,s),this.keyword="",this.reverse=!1,this.exactMatch=!1,this.channelUrl="",this.channelCustomType="",this.messageTimestampFrom=null,this.messageTimestampTo=null,this.order=exports.MessageSearchOrder.SCORE,this.advancedQuery=!1,this.targetFields=null,this._nextToken="",this.totalCount=-1,this.keyword=s.keyword,this.reverse=null!==(t=s.reverse)&&void 0!==t&&t,this.exactMatch=null!==(i=s.exactMatch)&&void 0!==i&&i,this.channelUrl=null!==(a=s.channelUrl)&&void 0!==a?a:"",this.channelCustomType=null!==(n=s.channelCustomType)&&void 0!==n?n:"",this.messageTimestampFrom=null!==(r=s.messageTimestampFrom)&&void 0!==r?r:null,this.messageTimestampTo=null!==(l=s.messageTimestampTo)&&void 0!==l?l:null,this.order=null!==(d=s.order)&&void 0!==d?d:exports.MessageSearchOrder.SCORE,this.advancedQuery=null!==(o=s.advancedQuery)&&void 0!==o&&o,this.targetFields=null!==(u=s.targetFields)&&void 0!==u?u:null}_validate(){return super._validate()&&s.isTypeOf("string",this.keyword)&&this.keyword.length>0&&s.isTypeOf("boolean",this.reverse)&&s.isTypeOf("boolean",this.exactMatch)&&s.isTypeOf("string",this.channelUrl)&&s.isTypeOf("string",this.channelCustomType)&&(s.isTypeOf("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(s.isTypeOf("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&s.isEnumOf(exports.MessageSearchOrder,this.order)&&s.isTypeOf("boolean",this.advancedQuery)&&s.isArrayOf("string",this.targetFields,!0)}next(){return s.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw s.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=s.Vault.of(this._iid),t=new V(s.undefineNullProps(Object.assign(Object.assign({},this),{nextToken:this._nextToken?this._nextToken:null}))),i=yield e.send(t),{messages:a,hasNext:n,nextToken:r,totalCount:l}=i.as(K);return this._nextToken=r,this._hasNext=n,this._isLoading=!1,this.totalCount=l,a}return[]}throw s.SendbirdError.invalidParameters}))}}class Y extends s.ChannelDataListQuery{constructor(e,t,i,a){var n,r,l,d,o,u,h,p,c,m;super(e,t,i,a),this.reverse=!1,this.messageTypeFilter=s.MessageTypeFilter.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=s.ReplyType.NONE,this.includeMetaArray=!1,this.includeReactions=!1,this.includeParentMessageInfo=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1,this._edge=Number.MAX_SAFE_INTEGER,this.reverse=null!==(n=a.reverse)&&void 0!==n&&n,this.messageTypeFilter=null!==(r=a.messageTypeFilter)&&void 0!==r?r:s.MessageTypeFilter.ALL,this.customTypesFilter=null!==(l=a.customTypesFilter)&&void 0!==l?l:null,this.senderUserIdsFilter=null!==(d=a.senderUserIdsFilter)&&void 0!==d?d:null,this.replyType=null!==(o=a.replyType)&&void 0!==o?o:s.ReplyType.NONE,this.includeMetaArray=null!==(u=a.includeMetaArray)&&void 0!==u&&u,this.includeReactions=null!==(h=a.includeReactions)&&void 0!==h&&h,this.includeParentMessageInfo=null!==(p=a.includeParentMessageInfo)&&void 0!==p&&p,this.includeThreadInfo=null!==(c=a.includeThreadInfo)&&void 0!==c&&c,this.showSubchannelMessagesOnly=null!==(m=a.showSubchannelMessagesOnly)&&void 0!==m&&m}_validate(){return super._validate()&&s.isTypeOf("boolean",this.reverse)&&s.isEnumOf(s.MessageTypeFilter,this.messageTypeFilter)&&s.isEnumOf(s.ReplyType,this.replyType)&&s.isArrayOf("string",this.customTypesFilter,!0)&&s.isArrayOf("string",this.senderUserIdsFilter,!0)&&s.isTypeOf("boolean",this.includeMetaArray)&&s.isTypeOf("boolean",this.includeReactions)&&s.isTypeOf("boolean",this.includeParentMessageInfo)&&s.isTypeOf("boolean",this.includeThreadInfo)&&s.isTypeOf("boolean",this.showSubchannelMessagesOnly)}load(){return s.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw s.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const e=B.of(this._iid),t=yield e.getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,s.undefineNullProps({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}));return this._edge=Math.min(Number.MAX_SAFE_INTEGER,...t.map((e=>e.createdAt))),this._hasNext=t.length>=this.limit,this._isLoading=!1,t}return[]}throw s.SendbirdError.invalidParameters}))}}exports.AdminMessage=v,exports.AppleCriticalAlertOptions=o,exports.BaseMessage=m,exports.FileMessage=A,exports.FileMessageEventCommand=U,exports.MessageChangeLogsParamsDefault=R,exports.MessageListParamsDefault=N,exports.MessageManager=B,exports.MessageMetaArray=r,exports.MessageRequestHandler=$,exports.MessageRetrievalParamsDefault=W,exports.MessageSearchQuery=J,exports.MultipleFilesMessage=S,exports.MultipleFilesMessageRequestHandler=class extends ${constructor(){super(...arguments),this._onFileUploaded=s.noop}_triggerOnFileUploaded(e,s,t,i){this._onFileUploaded(e,s,t,i)}onFileUploaded(e){return this._onFileUploaded=e,this}onPending(e){return super.onPending(e),this}onFailed(e){return super.onFailed(e),this}onSucceeded(e){return super.onSucceeded(e),this}},exports.OGImage=l,exports.OGMetaData=d,exports.Plugin=I,exports.PreviousMessageListQuery=Y,exports.Reaction=n,exports.ReactionEvent=class{constructor(e){this.messageId=0,this.operation=null,this.updatedAt=0;const t=s.isTypeOf("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,i=e.user_id,a=e.operation?e.operation.toLowerCase():null,n=e.reaction,r=e.updated_at;t&&s.isTypeOf("string",i)&&s.isTypeOf("string",a)&&s.isEnumOf(exports.ReactionEventOperation,a)&&s.isTypeOf("string",n)&&n&&s.isTypeOf("number",r)&&(this.messageId=t,this.userId=i,this.key=n,this.operation=a,this.updatedAt=r)}},exports.SendableMessage=g,exports.Sender=u,exports.ThreadInfo=a,exports.ThreadInfoUpdateEvent=H,exports.Thumbnail=y,exports.UploadFileRequestCommand=t,exports.UploadFileResponseCommand=i,exports.UploadedFileInfo=M,exports.UserMessage=T,exports.parseMessagePayload=O,exports.payloadifyMessage=e=>{switch(e.messageType){case s.MessageType.USER:return T.payloadify(e);case s.MessageType.FILE:return e.fileInfoList?S.payloadify(e):A.payloadify(e);case s.MessageType.ADMIN:return v.payloadify(e);default:throw s.SendbirdError.unknown}},exports.validateMessageChangeLogsParams=e=>s.isEnumOf(s.ReplyType,e.replyType)&&s.isTypeOf("boolean",e.includeReactions)&&s.isTypeOf("boolean",e.includeMetaArray)&&s.isTypeOf("boolean",e.includeParentMessageInfo)&&s.isTypeOf("boolean",e.includeThreadInfo),exports.validateMessageListParams=e=>s.isTypeOf("number",e.prevResultSize)&&s.isTypeOf("number",e.nextResultSize)&&s.isTypeOf("boolean",e.isInclusive)&&s.isTypeOf("boolean",e.reverse)&&s.isTypeOf("string",e.messageTypeFilter)&&s.isEnumOf(s.MessageTypeFilter,e.messageTypeFilter)&&s.isArrayOf("string",e.customTypesFilter,!0)&&s.isArrayOf("string",e.senderUserIdsFilter,!0)&&s.isEnumOf(s.ReplyType,e.replyType)&&s.isTypeOf("boolean",e.includeMetaArray)&&s.isTypeOf("boolean",e.includeReactions)&&s.isTypeOf("boolean",e.includeParentMessageInfo)&&s.isTypeOf("boolean",e.includeThreadInfo)&&s.isTypeOf("boolean",e.showSubchannelMessagesOnly),exports.validateMessageRetrievalParams=e=>s.isTypeOf("string",e.channelUrl)&&s.isEnumOf(s.ChannelType,e.channelType)&&s.isTypeOf("number",e.messageId)&&s.isTypeOf("boolean",e.includeReactions,!0)&&s.isTypeOf("boolean",e.includeMetaArray,!0)&&s.isTypeOf("boolean",e.includeParentMessageInfo,!0)&&s.isTypeOf("boolean",e.includeThreadInfo,!0);
