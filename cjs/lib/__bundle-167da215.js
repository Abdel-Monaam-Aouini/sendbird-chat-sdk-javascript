"use strict";var e,t=require("./__bundle-dd9a5445.js"),n=require("./__bundle-f5adaac3.js"),s=require("./__bundle-f6d4722d.js");exports.ChannelEventCategory=void 0,(e=exports.ChannelEventCategory||(exports.ChannelEventCategory={}))[e.NONE=0]="NONE",e[e.CHANNEL_ENTER=10102]="CHANNEL_ENTER",e[e.CHANNEL_EXIT=10103]="CHANNEL_EXIT",e[e.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",e[e.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",e[e.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",e[e.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",e[e.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",e[e.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",e[e.TYPING_START=10900]="TYPING_START",e[e.TYPING_END=10901]="TYPING_END",e[e.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",e[e.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",e[e.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",e[e.CHANNEL_INVITE=10020]="CHANNEL_INVITE",e[e.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",e[e.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",e[e.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",e[e.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",e[e.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",e[e.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",e[e.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",e[e.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",e[e.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED";class o{constructor(e){var t;this.channelUrl=e.channel_url,this.channelType=e.channel_type,this.category=e.cat,this.data=null!==(t=e.data)&&void 0!==t?t:{},this.ts=e.ts}get isGroupChannelEvent(){return this.channelType===t.ChannelType.GROUP}get isOpenChannelEvent(){return this.channelType===t.ChannelType.OPEN}}class a extends t.WebSocketEventCommand{constructor(e,t,n){super(e,"SYEV",n),this.event=new o(n)}}class i{constructor({top:e=Number.MAX_SAFE_INTEGER,bottom:t=0}){this.top=e,this.bottom=t}includes(...e){return e.every((e=>this.top<=e&&e<=this.bottom))}overlap(e){return this.includes(e.top)||this.includes(e.bottom)}intersect(...e){return e.some((e=>this.top<=e&&e<=this.bottom))}extends(...e){this.top=Math.min(this.top,...e),this.bottom=Math.max(this.bottom,...e)}}class r extends t.InstancedObject{get _messageCache(){return n.MessageCache.of(this._iid)}get _unsentMessageCache(){return n.UnsentMessageCache.of(this._iid)}get _messageBroadcast(){return n.MessageBroadcast.of(this._iid)}constructor(e,t){super(e),this._logger=t.logger,this._sdkState=t.sdkState,this._sessionManager=t.sessionManager,this._requestQueue=t.requestQueue,this._dispatcher=t.dispatcher,this._cacheContext=t.cacheContext,this._channelType=t.channelType}subscribeMessageEvent(e,t){this._messageBroadcast.subscribe(e,t)}unsubscribeMessageEvent(e){this._messageBroadcast.unsubscribe(e)}getMessageFromCache(e){var n;return t.__awaiter(this,void 0,void 0,(function*(){return null!==(n=yield this._messageCache.get(e))&&void 0!==n?n:null}))}getExactlyMatchingMessagesForTokenFromCache(e,n,s){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.fetch({channelUrl:e,token:n,filter:s,exactMatch:!0})}))}getMessagesFromCache(e,s,o,a,i=n.DEFAULT_MESSAGE_LIMIT,r=!0){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.fetch({channelUrl:e,token:s,limit:i,filter:a,backward:"next"===o,inclusive:r})}))}getPollMessagesFromCache(e,n,s,o){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.fetch({channelUrl:e,token:n,limit:o,filter:s,backward:!1,isPollOnly:!0})}))}getCachedMessageCountBetween(e,n,s,o){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._messageCache.countBetween(e,n,new i({top:s,bottom:o}))}))}getUnsentMessagesFromCache(e,n){return t.__awaiter(this,void 0,void 0,(function*(){return yield this._unsentMessageCache.fetch({channelUrl:e,filter:n})}))}removeFailedMessageFromCache(e){return t.__awaiter(this,void 0,void 0,(function*(){yield this._unsentMessageCache.remove([e])}))}}class h extends t.WebSocketEventCommand{constructor(e,s,o){var a,i,r,h;super(e,"ADMM",o),this.message=new n.AdminMessage(e,o);const{sdkState:d}=t.Vault.of(e);this.isMentioned=t.checkIfMentioned(this.message.mentionType,null!==(r=null!==(a=this.message.mentionedUserIds)&&void 0!==a?a:null===(i=this.message.mentionedUsers)||void 0===i?void 0:i.map((e=>e.userId)))&&void 0!==r?r:[],d.userId),this.forceUpdateLastMessage=null!==(h=o.force_update_last_message)&&void 0!==h&&h}}class d extends t.WebSocketEventCommand{constructor(e,s,o){var a,i,r,h,d;super(e,"AEDI",o),this.message=new n.AdminMessage(e,o);const{sdkState:E}=t.Vault.of(e);this.mentionCountChange=t.calculateMentionCountChange({mentionType:null===(a=o.old_values)||void 0===a?void 0:a.mention_type,mentionedUserIds:null!==(r=null===(i=o.old_values)||void 0===i?void 0:i.mentioned_user_ids)&&void 0!==r?r:[]},t.undefineNullProps({mentionType:this.message.mentionType,mentionedUserIds:null!==(h=this.message.mentionedUserIds)&&void 0!==h?h:null===(d=this.message.mentionedUsers)||void 0===d?void 0:d.map((e=>e.userId))}),E.userId)}}class E extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"MRCT",s),this.channelUrl=s.channel_url,this.channelType=s.channel_type,this.event=new n.ReactionEvent(s)}}class l extends t.WebSocketEventCommand{constructor(e,t,s){super(e,"MTHD",s),this.event=new n.ThreadInfoUpdateEvent(e,s)}}class c extends t.WebSocketEventCommand{constructor(e,t,n){super(e,"MCNT",n),this.groupChannelMemberCounts=n.group_channels.map((e=>({channelUrl:e.channel_url,memberCount:e.member_count,joinedMemberCount:e.joined_member_count,updatedAt:e.ts}))),this.openChannelMemberCounts=n.open_channels.map((e=>({channelUrl:e.channel_url,participantCount:e.participant_count,updatedAt:e.ts})))}}class _ extends t.WebSocketEventCommand{constructor(e,n,o){super(e,"PEDI",o),this.event=new s.PollUpdateEvent(e,o),this.status=t.parsePollStatusPayload(o.poll.status)||o.poll.status,this.channelUrl=o.channel_url,this.channelType=o.channel_type}}exports.AdminMessageEventCommand=h,exports.BaseChannelHandlerParams=class{constructor(){this.onUserMuted=t.noop,this.onUserUnmuted=t.noop,this.onUserBanned=t.noop,this.onUserUnbanned=t.noop,this.onChannelChanged=t.noop,this.onChannelDeleted=t.noop,this.onChannelFrozen=t.noop,this.onChannelUnfrozen=t.noop,this.onOperatorUpdated=t.noop,this.onChannelMemberCountChanged=t.noop,this.onMetaDataCreated=t.noop,this.onMetaDataUpdated=t.noop,this.onMetaDataDeleted=t.noop,this.onMetaCounterCreated=t.noop,this.onMetaCounterUpdated=t.noop,this.onMetaCounterDeleted=t.noop,this.onMessageReceived=t.noop,this.onMessageUpdated=t.noop,this.onMessageDeleted=t.noop,this.onMentionReceived=t.noop,this.onReactionUpdated=t.noop,this.onThreadInfoUpdated=t.noop}},exports.BaseChannelManager=r,exports.ChannelEventCommand=a,exports.MemberCountUpdateEventCommand=c,exports.OperatorUpdateEventCommand=class extends a{constructor(e,n,s){super(e,n,s);const{operators:o=[]}=s.data;this.operators=o.map((e=>new t.User(this._iid,e)))}},exports.PollUpdateEventCommand=_,exports.ReactionEventCommand=E,exports.ThreadInfoUpdateEventCommand=l,exports.TimeRange=i,exports.UpdateAdminMessageEventCommand=d;
