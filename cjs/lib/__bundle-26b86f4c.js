"use strict";function e(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var t,s="4.9.8";class n{static get OS_VERSION(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}static get SDK_VERSION(){return s}static get SDK_MAJOR_VERSION(){return n.SDK_VERSION.split(".")[0]}static get DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL(){return 100}static get INTERNAL_CALL(){return"ic"}}exports.SendbirdErrorCode=void 0,(t=exports.SendbirdErrorCode||(exports.SendbirdErrorCode={}))[t.STAT_LOG_NOT_ALLOWED=400108]="STAT_LOG_NOT_ALLOWED",t[t.NON_AUTHORIZED=400108]="NON_AUTHORIZED",t[t.INVALID_TOKEN=400111]="INVALID_TOKEN",t[t.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",t[t.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",t[t.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",t[t.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",t[t.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",t[t.SESSION_REVOKED=400310]="SESSION_REVOKED",t[t.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",t[t.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",t[t.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",t[t.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",t[t.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",t[t.LOST_INSTANCE=700100]="LOST_INSTANCE",t[t.CONNECTION_RENEW=700102]="CONNECTION_RENEW",t[t.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",t[t.INVALID_COMMAND=700700]="INVALID_COMMAND",t[t.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",t[t.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",t[t.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",t[t.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",t[t.INVALID_PARAMETER=800110]="INVALID_PARAMETER",t[t.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",t[t.NETWORK_ERROR=800120]="NETWORK_ERROR",t[t.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",t[t.MALFORMED_DATA=800130]="MALFORMED_DATA",t[t.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",t[t.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",t[t.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",t[t.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",t[t.ACK_TIMEOUT=800180]="ACK_TIMEOUT",t[t.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",t[t.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",t[t.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",t[t.REQUEST_FAILED=800220]="REQUEST_FAILED",t[t.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",t[t.REQUEST_CANCELED=800240]="REQUEST_CANCELED",t[t.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",t[t.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",t[t.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",t[t.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",t[t.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",t[t.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",t[t.DATABASE_ERROR=800700]="DATABASE_ERROR";const i=e=>!(e instanceof o&&!e.shouldThrowOutside);class o extends Error{constructor({code:e=0,message:t=""}){super(t),this.shouldThrowOutside=!1,this.name="SendbirdError",this.code=e,Object.setPrototypeOf(this,o.prototype)}get isInvalidTokenError(){return this.code===exports.SendbirdErrorCode.INVALID_TOKEN}get isSessionTokenExpiredError(){return this.code===exports.SendbirdErrorCode.SESSION_TOKEN_EXPIRED}get isSessionKeyExpiredError(){return this.code===exports.SendbirdErrorCode.SESSION_KEY_EXPIRED}get isSessionRevokedError(){return this.code===exports.SendbirdErrorCode.SESSION_REVOKED}get isUserAuthDeactivedError(){return this.code===exports.SendbirdErrorCode.USER_AUTH_DEACTIVATED}get isUserAuthDeletedOrNotFoundError(){return this.code===exports.SendbirdErrorCode.USER_AUTH_DELETED_OR_NOT_FOUND}static get debugModeRequired(){return new o({code:exports.SendbirdErrorCode.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})}static get lostInstance(){return new o({code:exports.SendbirdErrorCode.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})}static get invalidCommand(){return new o({code:exports.SendbirdErrorCode.INVALID_COMMAND,message:"Cannot send invalid command."})}static get unknown(){return new o({code:exports.SendbirdErrorCode.UNKNOWN_ERROR,message:"Unknown error occurred."})}static get connectionRenew(){return new o({code:exports.SendbirdErrorCode.CONNECTION_RENEW,message:"Connection restarts."})}static get invalidConnectionStateTransition(){return new o({code:exports.SendbirdErrorCode.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})}static get connectionRequired(){return new o({code:exports.SendbirdErrorCode.CONNECTION_REQUIRED,message:"Connection is required."})}static get connectionCanceled(){return new o({code:exports.SendbirdErrorCode.CONNECTION_CANCELED,message:"Connection is canceled."})}static get invalidParameters(){return new o({code:exports.SendbirdErrorCode.INVALID_PARAMETER,message:"Invalid parameters."})}static get notSupportedError(){return new o({code:exports.SendbirdErrorCode.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})}static get channelTypeNotSupportedError(){return new o({code:exports.SendbirdErrorCode.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})}static get networkError(){return new o({code:exports.SendbirdErrorCode.NETWORK_ERROR,message:"There was a network error."})}static get markAsReadAllRateLimitExceeded(){return new o({code:exports.SendbirdErrorCode.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})}static get queryInProgress(){return new o({code:exports.SendbirdErrorCode.QUERY_IN_PROGRESS,message:"Query in progress."})}static get noAckTimeout(){return new o({code:exports.SendbirdErrorCode.ACK_TIMEOUT,message:"Command received no ack."})}static get loginTimeout(){return new o({code:exports.SendbirdErrorCode.LOGIN_TIMEOUT,message:"Connection timeout."})}static get connectionClosed(){return new o({code:exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})}static get requestFailed(){return new o({code:exports.SendbirdErrorCode.REQUEST_FAILED,message:"Request failed."})}static get fileUploadCanceled(){return new o({code:exports.SendbirdErrorCode.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})}static get requestCanceled(){return new o({code:exports.SendbirdErrorCode.REQUEST_CANCELED,message:"Request has been canceled."})}static get sessionTokenRefreshFailed(){return new o({code:exports.SendbirdErrorCode.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})}static get sessionTokenRequestFailed(){return new o({code:exports.SendbirdErrorCode.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})}static get databaseError(){return new o({code:exports.SendbirdErrorCode.DATABASE_ERROR,message:"Database error."})}static get fileSizeLimitExceededError(){return new o({code:exports.SendbirdErrorCode.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})}throwOutside(){throw this.shouldThrowOutside=!0,this}}const r=[exports.SendbirdErrorCode.CONNECTION_REQUIRED,exports.SendbirdErrorCode.NETWORK_ERROR,exports.SendbirdErrorCode.ACK_TIMEOUT,exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_CLOSED,exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_FAILED,exports.SendbirdErrorCode.FILE_UPLOAD_CANCEL_FAILED,exports.SendbirdErrorCode.REQUEST_CANCELED,exports.SendbirdErrorCode.INTERNAL_SERVER_ERROR,exports.SendbirdErrorCode.RATE_LIMIT_EXCEEDED,exports.SendbirdErrorCode.UNKNOWN_SERVER_ERROR],a=[exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_CLOSED,exports.SendbirdErrorCode.WEBSOCKET_CONNECTION_FAILED,exports.SendbirdErrorCode.CONNECTION_REQUIRED],l=(e,t,s=!1)=>!(!s||null!=t)||("string"!=typeof e?"object"==typeof e?d(e,t):c(e,t):typeof t===e),d=(e,t,s=!1)=>!(!s||null!=t)||Object.values(e).includes(t),c=(e,t)=>t instanceof e,h=(e,t,s=!1)=>!(!s||null!=t)||Array.isArray(t)&&t.every((t=>l(e,t))),u=(e,t=!1)=>{if(t&&null==e)return!0;const s="object"==typeof e&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!s){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return s};class _{constructor({useMemberInfoInMessage:e=!0,typingIndicatorInvalidateTime:t=1e4,typingIndicatorThrottle:s=1e3,websocketResponseTimeout:n=1e4,websocketPayloadDecompression:i=!0,sessionTokenRefreshTimeout:o=60}={}){this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=e,this._typingIndicatorInvalidateTime=t,this._typingIndicatorThrottle=s,this._websocketResponseTimeout=n,this._sessionTokenRefreshTimeout=o,this.websocketPayloadDecompression=i}get useMemberInfoInMessage(){return this._useMemberInfoInMessage}set useMemberInfoInMessage(e){l("boolean",e)&&(this._useMemberInfoInMessage=e)}get typingIndicatorInvalidateTime(){return this._typingIndicatorInvalidateTime}set typingIndicatorInvalidateTime(e){l("number",e)&&(this._typingIndicatorInvalidateTime=e)}get typingIndicatorThrottle(){return this._typingIndicatorThrottle}set typingIndicatorThrottle(e){l("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)}get websocketResponseTimeout(){return this._websocketResponseTimeout}set websocketResponseTimeout(e){l("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)}get sessionTokenRefreshTimeout(){return this._sessionTokenRefreshTimeout}set sessionTokenRefreshTimeout(e){l("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e)}}const p={encrypt:e=>e,decrypt:e=>e};class E{constructor({store:e}){this._preference=new Map,this._store=e}_savePreferenceKeys(){return e(this,void 0,void 0,(function*(){yield this._store.set({key:this._keysAddress,value:[...this._preference.keys()]})}))}init(t,s=1){var n;return e(this,void 0,void 0,(function*(){this._version=s,this._keysAddress=t;const e=`${t}.metadata.version`,i=yield this._store.get(e),o=null!==(n=yield this._store.get(t))&&void 0!==n?n:[];if(!i||i.version<this._version)yield this._resetPreferenceData(o,e);else for(const e of o){const t=yield this._store.get(e);t&&this._preference.set(e,t)}}))}_resetPreferenceData(t,s){return e(this,void 0,void 0,(function*(){this._preference=new Map,yield this._store.removeMany(t),yield this._store.set({key:s,value:{version:this._version}})}))}get(t){return e(this,void 0,void 0,(function*(){return this._preference.get(t)}))}set(t,s){return e(this,void 0,void 0,(function*(){const e=!this._preference.has(t);yield this._store.set({key:t,value:s}),this._preference.set(t,s),e&&(yield this._savePreferenceKeys())}))}remove(t){return e(this,void 0,void 0,(function*(){yield this._store.remove(t),this._preference.delete(t),yield this._savePreferenceKeys()}))}clear(){return e(this,void 0,void 0,(function*(){yield this._store.removeMany([...this._preference.keys()]),this._preference.clear(),yield this._savePreferenceKeys()}))}}class g{constructor({encryption:e,store:t,localCacheEnabled:s,localCacheConfig:n}){this.store=t,this.preference=new E({store:t}),this.encryption=null!=e?e:p,this.localCacheEnabled=s,this.localCacheConfig=n}replaceStore(e){this.store=e,this.preference=new E({store:e})}}var f,v,m,S,T;exports.PushTokenRegistrationState=void 0,(f=exports.PushTokenRegistrationState||(exports.PushTokenRegistrationState={})).SUCCESS="success",f.PENDING="pending",f.ERROR="error",exports.PushTriggerOption=void 0,(v=exports.PushTriggerOption||(exports.PushTriggerOption={})).DEFAULT="default",v.ALL="all",v.MENTION_ONLY="mention_only",v.OFF="off",exports.PushTokenType=void 0,(m=exports.PushTokenType||(exports.PushTokenType={})).FCM="gcm",m.APNS="apns",m.UNKNOWN="unknown",exports.PushTemplate=void 0,(S=exports.PushTemplate||(exports.PushTemplate={})).ALTERNATIVE="alternative",S.DEFAULT="default",function(e){e.CUSTOM="custom",e.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(T||(T={}));class C{constructor({maxSize:e=256,clearOrder:t=T.MESSAGE_COLLECTION_ACCESSED_AT,customClearOrderComparator:s}={}){this._clearOrderComparatorUseMessageCollectionAccessedAt=(e,t)=>e.channel.messageCollectionLastAccessedAt===t.channel.messageCollectionLastAccessedAt?e.channel.lastMessage&&!t.channel.lastMessage?1:!e.channel.lastMessage&&t.channel.lastMessage?-1:e.channel.lastMessage||t.channel.lastMessage?e.channel.lastMessage.createdAt-t.channel.lastMessage.createdAt:0:e.channel.messageCollectionLastAccessedAt>t.channel.messageCollectionLastAccessedAt?1:-1,this._maxSize=Math.max(e,64),s?(this._clearOrder=t,this._customClearOrderComparator=s):this._clearOrder=T.MESSAGE_COLLECTION_ACCESSED_AT}get maxSize(){return this._maxSize}get clearOrder(){return this._clearOrder}get clearOrderComparator(){var e;return this._clearOrder===T.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:null!==(e=this._customClearOrderComparator)&&void 0!==e?e:this._clearOrderComparatorUseMessageCollectionAccessedAt}}class N{get hasSession(){return!!this.sessionKey}clear(){this.authToken=void 0,this.sessionKey=void 0}}const y=()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)}))};class w{constructor({container:e}){this._container={},this._container=e,this.key=y()}_register(e,t,s){var n;return e in this._container||(this._container[e]=new Map),null===(n=this._container[e])||void 0===n||n.set(this.key,{occurence:t,handler:s}),this}on(e,t){return this._register(e,-1,t)}once(e,t){return this._register(e,1,t)}close(){var e;for(const t in this._container)null===(e=this._container[t])||void 0===e||e.delete(this.key)}}class A{constructor(){this._container={}}on(e,t){return new w({container:this._container}).on(e,t)}once(e,t){return new w({container:this._container}).once(e,t)}dispatch(e,t){const s=this._container[e];if(s){const e=[];for(const n of s.keys()){const i=s.get(n);i.handler(t),i.occurence>0&&(i.occurence--,0===i.occurence&&e.push(n))}e.forEach((e=>s.delete(e)))}}}class b{constructor(){this._dispatcher=new A}on(e){return this._dispatcher.on("event",e)}once(e){return this._dispatcher.once("event",e)}dispatch(e){this._dispatcher.dispatch("event",e)}}class x{}const k=e=>{const t={};return e&&Object.keys(e).forEach((s=>{void 0===e[s]||Number.isNaN(e[s])||null===e[s]||(t[s]=e[s])})),t},I=e=>{if(null!=e){if("object"==typeof e){if(Array.isArray(e)){const t=[...e];for(const e in t)t[e]=I(t[e]);return t}for(const t in e)null===e[t]&&delete e[t];return e}return e}};var O,R,D,L,U,M,P,F,H,z;exports.ChannelType=void 0,(O=exports.ChannelType||(exports.ChannelType={})).BASE="base",O.GROUP="group",O.OPEN="open",O.FEED="feed",exports.Role=void 0,(R=exports.Role||(exports.Role={})).OPERATOR="operator",R.NONE="none",exports.MutedState=void 0,(D=exports.MutedState||(exports.MutedState={})).MUTED="muted",D.UNMUTED="unmuted",exports.MessageType=void 0,(L=exports.MessageType||(exports.MessageType={})).BASE="base",L.USER="user",L.FILE="file",L.ADMIN="admin",exports.MessageTypeFilter=void 0,(U=exports.MessageTypeFilter||(exports.MessageTypeFilter={})).ALL="",U.USER="MESG",U.FILE="FILE",U.ADMIN="ADMM",exports.ServerSideMessageType=void 0,(M=exports.ServerSideMessageType||(exports.ServerSideMessageType={})).USER="MESG",M.FILE="FILE",M.ADMIN="ADMM",exports.MentionType=void 0,(P=exports.MentionType||(exports.MentionType={})).USERS="users",P.CHANNEL="channel",exports.ReplyType=void 0,(F=exports.ReplyType||(exports.ReplyType={})).ALL="all",F.NONE="none",F.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel",exports.PushNotificationDeliveryOption=void 0,(H=exports.PushNotificationDeliveryOption||(exports.PushNotificationDeliveryOption={})).DEFAULT="default",H.SUPPRESS="suppress",exports.SendingStatus=void 0,(z=exports.SendingStatus||(exports.SendingStatus={})).PENDING="pending",z.SCHEDULED="scheduled",z.SUCCEEDED="succeeded",z.FAILED="failed",z.CANCELED="canceled";const q="v3",G=`/${q}/users`,V=`/${q}/storage/file`,K=`/${q}/group_channels`,B=`/${q}/sdk/group_channels`,j=`/${q}/open_channels`,$=`/${q}/sdk/open_channels`,Z=`/${q}/search`,W=`/${q}/report`,Q=`/${q}/emojis`,Y=`/${q}/emoji_categories`,X=`/${q}/polls`,J=`/${q}/scheduled_messages`,ee=`/${q}/sdk/ui_kit/configuration`,te=`/${q}/sdk/statistics`,se=`/${q}/notifications`,ne=e=>{switch(e){case exports.ChannelType.FEED:case exports.ChannelType.GROUP:return K;case exports.ChannelType.OPEN:return j;default:return null}},ie=(e,t,s)=>{switch(e){case exports.MentionType.CHANNEL:return!0;case exports.MentionType.USERS:if(t)for(const e of t)if(e===s)return!0}return!1},oe=(e,t,s)=>{var n;let i=t||new FormData;for(const t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const o=e[t],r=s?`${s}[${t}]`:t;u(o)?i.append(r,o,null!==(n=o.name)&&void 0!==n?n:"filename"):"object"!=typeof o||null===o||Array.isArray(o)||o instanceof Blob?i.append(r,String(o)):i=oe(o,i,r)}return i};var re,ae;exports.APIRequestMethod=void 0,(re=exports.APIRequestMethod||(exports.APIRequestMethod={})).GET="GET",re.POST="POST",re.PUT="PUT",re.DELETE="DELETE";class le extends x{constructor(){super(...arguments),this.params={},this.requireAuth=!0,this.headers={},this.requestId=y()}encodeParams(e){return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((e=>this.encodeParams(e))).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))}get query(){const e=k(this.params);return`?${Object.keys(e).map((t=>`${encodeURIComponent(t)}=${this.encodeParams(e[t])}`)).join("&")}`}get payload(){const e=k(this.params);return Object.keys(e).some((t=>u(e[t])))?oe(e):JSON.stringify(e)}}class de extends x{constructor(e,t){super(),this._iid=e,this._payload=t}get payload(){return Object.assign({},this._payload)}as(e){return new e(this._iid,this.payload)}}class ce extends x{constructor(e){super(),this.requestId=e}}class he extends x{constructor({expires_in:e,reason:t=exports.SendbirdErrorCode.SESSION_KEY_EXPIRED}){switch(super(),this.expiresIn=null!=e?e:0,t){case exports.SendbirdErrorCode.SESSION_KEY_EXPIRED:case exports.SendbirdErrorCode.SESSION_TOKEN_EXPIRED:case exports.SendbirdErrorCode.SESSION_REVOKED:case exports.SendbirdErrorCode.USER_AUTH_DEACTIVATED:case exports.SendbirdErrorCode.USER_AUTH_DELETED_OR_NOT_FOUND:this.error=new o({code:t})}}get invalidateSessionToken(){var e;return!!(null===(e=this.error)||void 0===e?void 0:e.isSessionTokenExpiredError)}}class ue extends x{constructor(e){super(),this.statLog=e}}exports.StatType=void 0,(ae=exports.StatType||(exports.StatType={})).FEATURE_LOCALCACHE="feature:local_cache",ae.WEBSOCKET_CONNECT="ws:connect",ae.API_RESULT="api:result";class _e{constructor({type:e,data:t,ts:s=Date.now()}){this.type=e,this.createdAt=s,this.data=t}static payloadify(e){return k({stat_type:e.type,ts:e.createdAt,data:k(e.data)})}}const pe=()=>"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product,Ee=()=>!("undefined"==typeof navigator||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent));var ge,fe,ve;exports.SendbirdProduct=void 0,(ge=exports.SendbirdProduct||(exports.SendbirdProduct={})).CHAT="chat",ge.CALLS="calls",ge.DESK="desk",ge.LIVE="live",ge.UIKIT_CHAT="uikit-chat",ge.UIKIT_LIVE="uikit-live",exports.SendbirdPlatform=void 0,(fe=exports.SendbirdPlatform||(exports.SendbirdPlatform={})).ANDROID="android",fe.IOS="ios",fe.JS="js",fe.UNREAL="unreal",fe.UNITY="unity",fe.REACT_NATIVE="react-native",fe.FLUTTER="flutter",exports.DeviceOsPlatform=void 0,(ve=exports.DeviceOsPlatform||(exports.DeviceOsPlatform={})).ANDROID="android",ve.IOS="ios",ve.WEB="web",ve.MOBILE_WEB="mobile_web",ve.WINDOWS="windows";class me{}me.sendbirdSdkUserAgentWithExtension=e=>{let t={main_sdk_info:`chat/${pe()?exports.SendbirdPlatform.REACT_NATIVE:exports.SendbirdPlatform.JS}/${n.SDK_VERSION}`,device_os_platform:Ee()?"mobile-web":"web",os_version:n.OS_VERSION};if(e){const{sendbirdExtensions:s,deviceOS:n,customData:i={}}=e;n.version&&(t.os_version=n.version),n.platform&&(t.device_os_platform=n.platform),s.length>0&&(t.extension_sdk_info=s.map((({product:e,platform:t,version:s})=>`${e}/${t}/${s}`)).join(",")),Object.keys(t).forEach((e=>delete i[e])),Object.keys(i).length>0&&(t=Object.assign(Object.assign({},t),i))}return Object.entries(t).map((([e,t])=>`${e}=${t}`)).join("&")},me.userAgentWithExtension=e=>{const t=pe()?"reactnative":"JS",s=e.sb_syncmanager?`s${e.sb_syncmanager}`:"",i=e.sb_uikit?`u${e.sb_uikit}`:"",o=e["device-os-platform"]?`o${e["device-os-platform"]}`:Ee()?"omobile-web":"oweb";return`${t}/c${n.SDK_VERSION}/${s}/${i}/${o}`};class Se{constructor(e,{auth:t,sdkState:s,dispatcher:n,logger:i,useFetchCompat:o=!1}){this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=e,this._auth=t,this._sdkState=s,this._dispatcher=n,this._dispatcher.on((e=>{e instanceof ce&&this.cancel(e.requestId)})),this._logger=i,this._shouldImportFetchCompat=o}_createHeader(e,t){const{appId:s,appVersion:i,sendbirdRuntimeEnvironment:o}=this._sdkState,r=Object.assign(Object.assign({},e.headers),{SendBird:`JS,${n.OS_VERSION},${n.SDK_VERSION},${s}${i?`,${i}`:""}`,"SB-User-Agent":me.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":me.sendbirdSdkUserAgentWithExtension(o)});return t||(r["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(r["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(r["App-Id"]=s,r["Access-Token"]=this._auth.authToken),r}_statLogApiResult(e,t,s){this._dispatcher.dispatch(new ue(new _e({type:exports.StatType.API_RESULT,data:{endpoint:e.path,method:e.method,success:!s,latency:Date.now()-t,error_code:null==s?void 0:s.code,error_description:null==s?void 0:s.message}})))}send(t){return e(this,void 0,void 0,(function*(){const{path:e,method:s}=t,n=![exports.APIRequestMethod.GET,exports.APIRequestMethod.DELETE].includes(s),{api:i}=this._sdkState,r=`${i.host}${e}${n?"":t.query}`,a=n?t.payload:null,l=this._createHeader(t,a instanceof FormData?a:void 0),d=new AbortController,{signal:c}=d;this._abortControl.set(t.requestId,d);const h=Date.now();try{if(this._shouldImportFetchCompat){this._shouldImportFetchCompat=!1;("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{fetch:null}).fetch=null}"undefined"==typeof AbortController&&(yield Promise.resolve().then((function(){return require("./__bundle-72519a03.js")}))),"function"!=typeof fetch&&(yield Promise.resolve().then((function(){return require("./__bundle-ac62f2cb.js")})));const e=yield fetch(r,{method:s,body:a,headers:l,signal:c}),n=yield e.json();if(e.ok||e.redirected)return this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,h),new de(this._iid,n);if(n){const e=new o(n);throw(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new he({reason:e.code})),this._statLogApiResult(t,h,e),e}{const e=o.requestFailed;throw this._statLogApiResult(t,h,e),e}}catch(e){if(this._statLogApiResult(t,h,e),e instanceof o)throw this._logger.debug("fail api request",e),e;if("AbortError"===e.name)throw o.requestCanceled;{const e=o.networkError;throw this._logger.debug("fail api request",e),e}}}))}cancel(e){if(this._abortControl.has(e)){this._abortControl.get(e).abort(),this._abortControl.delete(e)}}cancelAll(){for(const e of this._abortControl.values())e.abort();this._abortControl.clear()}}class Te extends x{constructor(e,t,s,n=""){var i;super(),this._iid=e,this.code=t,this.payload=s,this.requestId=null!==(i=s.req_id)&&void 0!==i?i:n}static createFromRawMessage(e,t){let s=t.substring(0,4),n={};try{n=JSON.parse(t.substring(4))}catch(e){s="NOOP"}finally{return new Te(e,s,n)}}convertToMessage(){return`${this.code}${JSON.stringify(this.payload)}\n`}as(e){return new e(this._iid,this.code,this.payload)}}const Ce=()=>{};
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Ne(e){let t=e.length;for(;--t>=0;)e[t]=0}const ye=256,we=286,Ae=30,be=15,xe=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),ke=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ie=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Oe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Re=new Array(576);Ne(Re);const De=new Array(60);Ne(De);const Le=new Array(512);Ne(Le);const Ue=new Array(256);Ne(Ue);const Me=new Array(29);Ne(Me);const Pe=new Array(Ae);function Fe(e,t,s,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let He,ze,qe;function Ge(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ne(Pe);const Ve=e=>e<256?Le[e]:Le[256+(e>>>7)],Ke=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Be=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,Ke(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},je=(e,t,s)=>{Be(e,s[2*t],s[2*t+1])},$e=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},Ze=(e,t,s)=>{const n=new Array(16);let i,o,r=0;for(i=1;i<=be;i++)r=r+s[i-1]<<1,n[i]=r;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=$e(n[t]++,t))}},We=e=>{let t;for(t=0;t<we;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Ae;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},Qe=e=>{e.bi_valid>8?Ke(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ye=(e,t,s,n)=>{const i=2*t,o=2*s;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[s]},Xe=(e,t,s)=>{const n=e.heap[s];let i=s<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Ye(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Ye(t,n,e.heap[i],e.depth));)e.heap[s]=e.heap[i],s=i,i<<=1;e.heap[s]=n},Je=(e,t,s)=>{let n,i,o,r,a=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+a++],n+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===n?je(e,i,t):(o=Ue[i],je(e,o+ye+1,t),r=xe[o],0!==r&&(i-=Me[o],Be(e,i,r)),n--,o=Ve(n),je(e,o,s),r=ke[o],0!==r&&(n-=Pe[o],Be(e,n,r)))}while(a<e.sym_next);je(e,256,t)},et=(e,t)=>{const s=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let r,a,l,d=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<o;r++)0!==s[2*r]?(e.heap[++e.heap_len]=d=r,e.depth[r]=0):s[2*r+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=d<2?++d:0,s[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=n[2*l+1]);for(t.max_code=d,r=e.heap_len>>1;r>=1;r--)Xe(e,s,r);l=o;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Xe(e,s,1),a=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=a,s[2*l]=s[2*r]+s[2*a],e.depth[l]=(e.depth[r]>=e.depth[a]?e.depth[r]:e.depth[a])+1,s[2*r+1]=s[2*a+1]=l,e.heap[1]=l++,Xe(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,n=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let d,c,h,u,_,p,E=0;for(u=0;u<=be;u++)e.bl_count[u]=0;for(s[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)c=e.heap[d],u=s[2*s[2*c+1]+1]+1,u>l&&(u=l,E++),s[2*c+1]=u,c>n||(e.bl_count[u]++,_=0,c>=a&&(_=r[c-a]),p=s[2*c],e.opt_len+=p*(u+_),o&&(e.static_len+=p*(i[2*c+1]+_)));if(0!==E){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,E-=2}while(E>0);for(u=l;0!==u;u--)for(c=e.bl_count[u];0!==c;)h=e.heap[--d],h>n||(s[2*h+1]!==u&&(e.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),c--)}})(e,t),Ze(s,d,e.bl_count)},tt=(e,t,s)=>{let n,i,o=-1,r=t[1],a=0,l=7,d=4;for(0===r&&(l=138,d=3),t[2*(s+1)+1]=65535,n=0;n<=s;n++)i=r,r=t[2*(n+1)+1],++a<l&&i===r||(a<d?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===r?(l=138,d=3):i===r?(l=6,d=3):(l=7,d=4))},st=(e,t,s)=>{let n,i,o=-1,r=t[1],a=0,l=7,d=4;for(0===r&&(l=138,d=3),n=0;n<=s;n++)if(i=r,r=t[2*(n+1)+1],!(++a<l&&i===r)){if(a<d)do{je(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(je(e,i,e.bl_tree),a--),je(e,16,e.bl_tree),Be(e,a-3,2)):a<=10?(je(e,17,e.bl_tree),Be(e,a-3,3)):(je(e,18,e.bl_tree),Be(e,a-11,7));a=0,o=i,0===r?(l=138,d=3):i===r?(l=6,d=3):(l=7,d=4)}};let nt=!1;const it=(e,t,s,n)=>{Be(e,0+(n?1:0),3),Qe(e),Ke(e,s),Ke(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var ot=(e,t,s,n)=>{let i,o,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<ye;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),et(e,e.l_desc),et(e,e.d_desc),r=(e=>{let t;for(tt(e,e.dyn_ltree,e.l_desc.max_code),tt(e,e.dyn_dtree,e.d_desc.max_code),et(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Oe[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=s+5,s+4<=i&&-1!==t?it(e,t,s,n):4===e.strategy||o===i?(Be(e,2+(n?1:0),3),Je(e,Re,De)):(Be(e,4+(n?1:0),3),((e,t,s,n)=>{let i;for(Be(e,t-257,5),Be(e,s-1,5),Be(e,n-4,4),i=0;i<n;i++)Be(e,e.bl_tree[2*Oe[i]+1],3);st(e,e.dyn_ltree,t-1),st(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),Je(e,e.dyn_ltree,e.dyn_dtree)),We(e),n&&Qe(e)},rt={_tr_init:e=>{nt||((()=>{let e,t,s,n,i;const o=new Array(16);for(s=0,n=0;n<28;n++)for(Me[n]=s,e=0;e<1<<xe[n];e++)Ue[s++]=n;for(Ue[s-1]=n,i=0,n=0;n<16;n++)for(Pe[n]=i,e=0;e<1<<ke[n];e++)Le[i++]=n;for(i>>=7;n<Ae;n++)for(Pe[n]=i<<7,e=0;e<1<<ke[n]-7;e++)Le[256+i++]=n;for(t=0;t<=be;t++)o[t]=0;for(e=0;e<=143;)Re[2*e+1]=8,e++,o[8]++;for(;e<=255;)Re[2*e+1]=9,e++,o[9]++;for(;e<=279;)Re[2*e+1]=7,e++,o[7]++;for(;e<=287;)Re[2*e+1]=8,e++,o[8]++;for(Ze(Re,287,o),e=0;e<Ae;e++)De[2*e+1]=5,De[2*e]=$e(e,5);He=new Fe(Re,xe,257,we,be),ze=new Fe(De,ke,0,Ae,be),qe=new Fe(new Array(0),Ie,0,19,7)})(),nt=!0),e.l_desc=new Ge(e.dyn_ltree,He),e.d_desc=new Ge(e.dyn_dtree,ze),e.bl_desc=new Ge(e.bl_tree,qe),e.bi_buf=0,e.bi_valid=0,We(e)},_tr_stored_block:it,_tr_flush_block:ot,_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(Ue[s]+ye+1)]++,e.dyn_dtree[2*Ve(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Be(e,2,3),je(e,256,Re),(e=>{16===e.bi_valid?(Ke(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var at=(e,t,s,n)=>{let i=65535&e|0,o=e>>>16&65535|0,r=0;for(;0!==s;){r=s>2e3?2e3:s,s-=r;do{i=i+t[n++]|0,o=o+i|0}while(--r);i%=65521,o%=65521}return i|o<<16|0};const lt=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var dt=(e,t,s,n)=>{const i=lt,o=n+s;e^=-1;for(let s=n;s<o;s++)e=e>>>8^i[255&(e^t[s])];return-1^e},ct={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ht={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ut,_tr_stored_block:_t,_tr_flush_block:pt,_tr_tally:Et,_tr_align:gt}=rt,{Z_NO_FLUSH:ft,Z_PARTIAL_FLUSH:vt,Z_FULL_FLUSH:mt,Z_FINISH:St,Z_BLOCK:Tt,Z_OK:Ct,Z_STREAM_END:Nt,Z_STREAM_ERROR:yt,Z_DATA_ERROR:wt,Z_BUF_ERROR:At,Z_DEFAULT_COMPRESSION:bt,Z_FILTERED:xt,Z_HUFFMAN_ONLY:kt,Z_RLE:It,Z_FIXED:Ot,Z_DEFAULT_STRATEGY:Rt,Z_UNKNOWN:Dt,Z_DEFLATED:Lt}=ht,Ut=258,Mt=262,Pt=42,Ft=113,Ht=666,zt=(e,t)=>(e.msg=ct[t],t),qt=e=>2*e-(e>4?9:0),Gt=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Vt=e=>{let t,s,n,i=e.w_size;t=e.hash_size,n=t;do{s=e.head[--n],e.head[n]=s>=i?s-i:0}while(--t);t=i,n=t;do{s=e.prev[--n],e.prev[n]=s>=i?s-i:0}while(--t)};let Kt=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const Bt=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},jt=(e,t)=>{pt(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Bt(e.strm)},$t=(e,t)=>{e.pending_buf[e.pending++]=t},Zt=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Wt=(e,t,s,n)=>{let i=e.avail_in;return i>n&&(i=n),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),s),1===e.state.wrap?e.adler=at(e.adler,t,i,s):2===e.state.wrap&&(e.adler=dt(e.adler,t,i,s)),e.next_in+=i,e.total_in+=i,i)},Qt=(e,t)=>{let s,n,i=e.max_chain_length,o=e.strstart,r=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-Mt?e.strstart-(e.w_size-Mt):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+Ut;let _=d[o+r-1],p=d[o+r];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(s=t,d[s+r]===p&&d[s+r-1]===_&&d[s]===d[o]&&d[++s]===d[o+1]){o+=2,s++;do{}while(d[++o]===d[++s]&&d[++o]===d[++s]&&d[++o]===d[++s]&&d[++o]===d[++s]&&d[++o]===d[++s]&&d[++o]===d[++s]&&d[++o]===d[++s]&&d[++o]===d[++s]&&o<u);if(n=Ut-(u-o),o=u-Ut,n>r){if(e.match_start=t,r=n,n>=a)break;_=d[o+r-1],p=d[o+r]}}}while((t=h[t&c])>l&&0!=--i);return r<=e.lookahead?r:e.lookahead},Yt=e=>{const t=e.w_size;let s,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Mt)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Vt(e),n+=t),0===e.strm.avail_in)break;if(s=Wt(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=s,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Kt(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Kt(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Mt&&0!==e.strm.avail_in)},Xt=(e,t)=>{let s,n,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r=0,a=e.strm.avail_in;do{if(s=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n=e.strstart-e.block_start,s>n+e.strm.avail_in&&(s=n+e.strm.avail_in),s>i&&(s=i),s<o&&(0===s&&t!==St||t===ft||s!==n+e.strm.avail_in))break;r=t===St&&s===n+e.strm.avail_in?1:0,_t(e,0,0,r),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Bt(e.strm),n&&(n>s&&(n=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,s-=n),s&&(Wt(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===r);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?4:t!==ft&&t!==St&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Wt(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=o||(n||t===St)&&t!==ft&&0===e.strm.avail_in&&n<=i)&&(s=n>i?i:n,r=t===St&&0===e.strm.avail_in&&s===n?1:0,_t(e,e.block_start,s,r),e.block_start+=s,Bt(e.strm)),r?3:1)},Jt=(e,t)=>{let s,n;for(;;){if(e.lookahead<Mt){if(Yt(e),e.lookahead<Mt&&t===ft)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=Kt(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-Mt&&(e.match_length=Qt(e,s)),e.match_length>=3)if(n=Et(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Kt(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Kt(e,e.ins_h,e.window[e.strstart+1]);else n=Et(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(jt(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===St?(jt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jt(e,!1),0===e.strm.avail_out)?1:2},es=(e,t)=>{let s,n,i;for(;;){if(e.lookahead<Mt){if(Yt(e),e.lookahead<Mt&&t===ft)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=Kt(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Mt&&(e.match_length=Qt(e,s),e.match_length<=5&&(e.strategy===xt||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=Et(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=Kt(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(jt(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=Et(e,0,e.window[e.strstart-1]),n&&jt(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=Et(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===St?(jt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jt(e,!1),0===e.strm.avail_out)?1:2};function ts(e,t,s,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=n,this.func=i}const ss=[new ts(0,0,0,0,Xt),new ts(4,4,8,4,Jt),new ts(4,5,16,8,Jt),new ts(4,6,32,32,Jt),new ts(4,4,16,16,es),new ts(8,16,32,32,es),new ts(8,16,128,128,es),new ts(8,32,128,256,es),new ts(32,128,258,1024,es),new ts(32,258,258,4096,es)];function ns(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Lt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Gt(this.dyn_ltree),Gt(this.dyn_dtree),Gt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Gt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Gt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const is=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Pt&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Ft&&t.status!==Ht?1:0},os=e=>{if(is(e))return zt(e,yt);e.total_in=e.total_out=0,e.data_type=Dt;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Pt:Ft,e.adler=2===t.wrap?0:1,t.last_flush=-2,ut(t),Ct},rs=e=>{const t=os(e);var s;return t===Ct&&((s=e.state).window_size=2*s.w_size,Gt(s.head),s.max_lazy_match=ss[s.level].max_lazy,s.good_match=ss[s.level].good_length,s.nice_match=ss[s.level].nice_length,s.max_chain_length=ss[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},as=(e,t,s,n,i,o)=>{if(!e)return yt;let r=1;if(t===bt&&(t=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),i<1||i>9||s!==Lt||n<8||n>15||t<0||t>9||o<0||o>Ot||8===n&&1!==r)return zt(e,yt);8===n&&(n=9);const a=new ns;return e.state=a,a.strm=e,a.status=Pt,a.wrap=r,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=s,rs(e)};var ls={deflateInit:(e,t)=>as(e,t,Lt,15,8,Rt),deflateInit2:as,deflateReset:rs,deflateResetKeep:os,deflateSetHeader:(e,t)=>is(e)||2!==e.state.wrap?yt:(e.state.gzhead=t,Ct),deflate:(e,t)=>{if(is(e)||t>Tt||t<0)return e?zt(e,yt):yt;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===Ht&&t!==St)return zt(e,0===e.avail_out?At:yt);const n=s.last_flush;if(s.last_flush=t,0!==s.pending){if(Bt(e),0===e.avail_out)return s.last_flush=-1,Ct}else if(0===e.avail_in&&qt(t)<=qt(n)&&t!==St)return zt(e,At);if(s.status===Ht&&0!==e.avail_in)return zt(e,At);if(s.status===Pt&&0===s.wrap&&(s.status=Ft),s.status===Pt){let t=Lt+(s.w_bits-8<<4)<<8,n=-1;if(n=s.strategy>=kt||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=n<<6,0!==s.strstart&&(t|=32),t+=31-t%31,Zt(s,t),0!==s.strstart&&(Zt(s,e.adler>>>16),Zt(s,65535&e.adler)),e.adler=1,s.status=Ft,Bt(e),0!==s.pending)return s.last_flush=-1,Ct}if(57===s.status)if(e.adler=0,$t(s,31),$t(s,139),$t(s,8),s.gzhead)$t(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),$t(s,255&s.gzhead.time),$t(s,s.gzhead.time>>8&255),$t(s,s.gzhead.time>>16&255),$t(s,s.gzhead.time>>24&255),$t(s,9===s.level?2:s.strategy>=kt||s.level<2?4:0),$t(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&($t(s,255&s.gzhead.extra.length),$t(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=dt(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if($t(s,0),$t(s,0),$t(s,0),$t(s,0),$t(s,0),$t(s,9===s.level?2:s.strategy>=kt||s.level<2?4:0),$t(s,3),s.status=Ft,Bt(e),0!==s.pending)return s.last_flush=-1,Ct;if(69===s.status){if(s.gzhead.extra){let t=s.pending,n=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+n>s.pending_buf_size;){let i=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=dt(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=i,Bt(e),0!==s.pending)return s.last_flush=-1,Ct;t=0,n-=i}let i=new Uint8Array(s.gzhead.extra);s.pending_buf.set(i.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending+=n,s.gzhead.hcrc&&s.pending>t&&(e.adler=dt(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(e.adler=dt(e.adler,s.pending_buf,s.pending-n,n)),Bt(e),0!==s.pending)return s.last_flush=-1,Ct;n=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,$t(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>n&&(e.adler=dt(e.adler,s.pending_buf,s.pending-n,n)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(e.adler=dt(e.adler,s.pending_buf,s.pending-n,n)),Bt(e),0!==s.pending)return s.last_flush=-1,Ct;n=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,$t(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>n&&(e.adler=dt(e.adler,s.pending_buf,s.pending-n,n))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Bt(e),0!==s.pending))return s.last_flush=-1,Ct;$t(s,255&e.adler),$t(s,e.adler>>8&255),e.adler=0}if(s.status=Ft,Bt(e),0!==s.pending)return s.last_flush=-1,Ct}if(0!==e.avail_in||0!==s.lookahead||t!==ft&&s.status!==Ht){let n=0===s.level?Xt(s,t):s.strategy===kt?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(Yt(e),0===e.lookahead)){if(t===ft)return 1;break}if(e.match_length=0,s=Et(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(jt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===St?(jt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jt(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===It?((e,t)=>{let s,n,i,o;const r=e.window;for(;;){if(e.lookahead<=Ut){if(Yt(e),e.lookahead<=Ut&&t===ft)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,n=r[i],n===r[++i]&&n===r[++i]&&n===r[++i])){o=e.strstart+Ut;do{}while(n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&i<o);e.match_length=Ut-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=Et(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=Et(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(jt(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===St?(jt(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(jt(e,!1),0===e.strm.avail_out)?1:2})(s,t):ss[s.level].func(s,t);if(3!==n&&4!==n||(s.status=Ht),1===n||3===n)return 0===e.avail_out&&(s.last_flush=-1),Ct;if(2===n&&(t===vt?gt(s):t!==Tt&&(_t(s,0,0,!1),t===mt&&(Gt(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),Bt(e),0===e.avail_out))return s.last_flush=-1,Ct}return t!==St?Ct:s.wrap<=0?Nt:(2===s.wrap?($t(s,255&e.adler),$t(s,e.adler>>8&255),$t(s,e.adler>>16&255),$t(s,e.adler>>24&255),$t(s,255&e.total_in),$t(s,e.total_in>>8&255),$t(s,e.total_in>>16&255),$t(s,e.total_in>>24&255)):(Zt(s,e.adler>>>16),Zt(s,65535&e.adler)),Bt(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Ct:Nt)},deflateEnd:e=>{if(is(e))return yt;const t=e.state.status;return e.state=null,t===Ft?zt(e,wt):Ct},deflateSetDictionary:(e,t)=>{let s=t.length;if(is(e))return yt;const n=e.state,i=n.wrap;if(2===i||1===i&&n.status!==Pt||n.lookahead)return yt;if(1===i&&(e.adler=at(e.adler,t,s,0)),n.wrap=0,s>=n.w_size){0===i&&(Gt(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(s-n.w_size,s),0),t=e,s=n.w_size}const o=e.avail_in,r=e.next_in,a=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Yt(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=Kt(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Yt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=r,e.input=a,e.avail_in=o,n.wrap=i,Ct},deflateInfo:"pako deflate (from Nodeca project)"};const ds=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var cs={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)ds(s,t)&&(e[t]=s[t])}}return e},flattenChunks:e=>{let t=0;for(let s=0,n=e.length;s<n;s++)t+=e[s].length;const s=new Uint8Array(t);for(let t=0,n=0,i=e.length;t<i;t++){let i=e[t];s.set(i,n),n+=i.length}return s}};let hs=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){hs=!1}const us=new Uint8Array(256);for(let e=0;e<256;e++)us[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;us[254]=us[254]=1;var _s={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,n,i,o,r=e.length,a=0;for(i=0;i<r;i++)s=e.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)s=e.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=e.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),s<128?t[o++]=s:s<2048?(t[o++]=192|s>>>6,t[o++]=128|63&s):s<65536?(t[o++]=224|s>>>12,t[o++]=128|s>>>6&63,t[o++]=128|63&s):(t[o++]=240|s>>>18,t[o++]=128|s>>>12&63,t[o++]=128|s>>>6&63,t[o++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,i;const o=new Array(2*s);for(i=0,n=0;n<s;){let t=e[n++];if(t<128){o[i++]=t;continue}let r=us[t];if(r>4)o[i++]=65533,n+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&n<s;)t=t<<6|63&e[n++],r--;r>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&hs)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let n=0;n<t;n++)s+=String.fromCharCode(e[n]);return s})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+us[e[s]]>t?s:t}};var ps=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Es=Object.prototype.toString,{Z_NO_FLUSH:gs,Z_SYNC_FLUSH:fs,Z_FULL_FLUSH:vs,Z_FINISH:ms,Z_OK:Ss,Z_STREAM_END:Ts,Z_DEFAULT_COMPRESSION:Cs,Z_DEFAULT_STRATEGY:Ns,Z_DEFLATED:ys}=ht;function ws(e){this.options=cs.assign({level:Cs,method:ys,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ns},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ps,this.strm.avail_out=0;let s=ls.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==Ss)throw new Error(ct[s]);if(t.header&&ls.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?_s.string2buf(t.dictionary):"[object ArrayBuffer]"===Es.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=ls.deflateSetDictionary(this.strm,e),s!==Ss)throw new Error(ct[s]);this._dict_set=!0}}function As(e,t){const s=new ws(t);if(s.push(e,!0),s.err)throw s.msg||ct[s.err];return s.result}ws.prototype.push=function(e,t){const s=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?ms:gs,"string"==typeof e?s.input=_s.string2buf(e):"[object ArrayBuffer]"===Es.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),(o===fs||o===vs)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=ls.deflate(s,o),i===Ts)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=ls.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ss;if(0!==s.avail_out){if(o>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},ws.prototype.onData=function(e){this.chunks.push(e)},ws.prototype.onEnd=function(e){e===Ss&&(this.result=cs.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var bs={Deflate:ws,deflate:As,deflateRaw:function(e,t){return(t=t||{}).raw=!0,As(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,As(e,t)},constants:ht};const xs=16209;var ks=function(e,t){let s,n,i,o,r,a,l,d,c,h,u,_,p,E,g,f,v,m,S,T,C,N,y,w;const A=e.state;s=e.next_in,y=e.input,n=s+(e.avail_in-5),i=e.next_out,w=e.output,o=i-(t-e.avail_out),r=i+(e.avail_out-257),a=A.dmax,l=A.wsize,d=A.whave,c=A.wnext,h=A.window,u=A.hold,_=A.bits,p=A.lencode,E=A.distcode,g=(1<<A.lenbits)-1,f=(1<<A.distbits)-1;e:do{_<15&&(u+=y[s++]<<_,_+=8,u+=y[s++]<<_,_+=8),v=p[u&g];t:for(;;){if(m=v>>>24,u>>>=m,_-=m,m=v>>>16&255,0===m)w[i++]=65535&v;else{if(!(16&m)){if(0==(64&m)){v=p[(65535&v)+(u&(1<<m)-1)];continue t}if(32&m){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=xs;break e}S=65535&v,m&=15,m&&(_<m&&(u+=y[s++]<<_,_+=8),S+=u&(1<<m)-1,u>>>=m,_-=m),_<15&&(u+=y[s++]<<_,_+=8,u+=y[s++]<<_,_+=8),v=E[u&f];s:for(;;){if(m=v>>>24,u>>>=m,_-=m,m=v>>>16&255,!(16&m)){if(0==(64&m)){v=E[(65535&v)+(u&(1<<m)-1)];continue s}e.msg="invalid distance code",A.mode=xs;break e}if(T=65535&v,m&=15,_<m&&(u+=y[s++]<<_,_+=8,_<m&&(u+=y[s++]<<_,_+=8)),T+=u&(1<<m)-1,T>a){e.msg="invalid distance too far back",A.mode=xs;break e}if(u>>>=m,_-=m,m=i-o,T>m){if(m=T-m,m>d&&A.sane){e.msg="invalid distance too far back",A.mode=xs;break e}if(C=0,N=h,0===c){if(C+=l-m,m<S){S-=m;do{w[i++]=h[C++]}while(--m);C=i-T,N=w}}else if(c<m){if(C+=l+c-m,m-=c,m<S){S-=m;do{w[i++]=h[C++]}while(--m);if(C=0,c<S){m=c,S-=m;do{w[i++]=h[C++]}while(--m);C=i-T,N=w}}}else if(C+=c-m,m<S){S-=m;do{w[i++]=h[C++]}while(--m);C=i-T,N=w}for(;S>2;)w[i++]=N[C++],w[i++]=N[C++],w[i++]=N[C++],S-=3;S&&(w[i++]=N[C++],S>1&&(w[i++]=N[C++]))}else{C=i-T;do{w[i++]=w[C++],w[i++]=w[C++],w[i++]=w[C++],S-=3}while(S>2);S&&(w[i++]=w[C++],S>1&&(w[i++]=w[C++]))}break}}break}}while(s<n&&i<r);S=_>>3,s-=S,_-=S<<3,u&=(1<<_)-1,e.next_in=s,e.next_out=i,e.avail_in=s<n?n-s+5:5-(s-n),e.avail_out=i<r?r-i+257:257-(i-r),A.hold=u,A.bits=_};const Is=15,Os=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Rs=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ds=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ls=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Us=(e,t,s,n,i,o,r,a)=>{const l=a.bits;let d,c,h,u,_,p,E=0,g=0,f=0,v=0,m=0,S=0,T=0,C=0,N=0,y=0,w=null;const A=new Uint16Array(16),b=new Uint16Array(16);let x,k,I,O=null;for(E=0;E<=Is;E++)A[E]=0;for(g=0;g<n;g++)A[t[s+g]]++;for(m=l,v=Is;v>=1&&0===A[v];v--);if(m>v&&(m=v),0===v)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(f=1;f<v&&0===A[f];f++);for(m<f&&(m=f),C=1,E=1;E<=Is;E++)if(C<<=1,C-=A[E],C<0)return-1;if(C>0&&(0===e||1!==v))return-1;for(b[1]=0,E=1;E<Is;E++)b[E+1]=b[E]+A[E];for(g=0;g<n;g++)0!==t[s+g]&&(r[b[t[s+g]]++]=g);if(0===e?(w=O=r,p=20):1===e?(w=Os,O=Rs,p=257):(w=Ds,O=Ls,p=0),y=0,g=0,E=f,_=o,S=m,T=0,h=-1,N=1<<m,u=N-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){x=E-T,r[g]+1<p?(k=0,I=r[g]):r[g]>=p?(k=O[r[g]-p],I=w[r[g]-p]):(k=96,I=0),d=1<<E-T,c=1<<S,f=c;do{c-=d,i[_+(y>>T)+c]=x<<24|k<<16|I|0}while(0!==c);for(d=1<<E-1;y&d;)d>>=1;if(0!==d?(y&=d-1,y+=d):y=0,g++,0==--A[E]){if(E===v)break;E=t[s+r[g]]}if(E>m&&(y&u)!==h){for(0===T&&(T=m),_+=f,S=E-T,C=1<<S;S+T<v&&(C-=A[S+T],!(C<=0));)S++,C<<=1;if(N+=1<<S,1===e&&N>852||2===e&&N>592)return 1;h=y&u,i[h]=m<<24|S<<16|_-o|0}}return 0!==y&&(i[_+y]=E-T<<24|64<<16|0),a.bits=m,0};const{Z_FINISH:Ms,Z_BLOCK:Ps,Z_TREES:Fs,Z_OK:Hs,Z_STREAM_END:zs,Z_NEED_DICT:qs,Z_STREAM_ERROR:Gs,Z_DATA_ERROR:Vs,Z_MEM_ERROR:Ks,Z_BUF_ERROR:Bs,Z_DEFLATED:js}=ht,$s=16180,Zs=16190,Ws=16191,Qs=16192,Ys=16194,Xs=16199,Js=16200,en=16206,tn=16209,sn=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function nn(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const on=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<$s||t.mode>16211?1:0},rn=e=>{if(on(e))return Gs;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=$s,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Hs},an=e=>{if(on(e))return Gs;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,rn(e)},ln=(e,t)=>{let s;if(on(e))return Gs;const n=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Gs:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=s,n.wbits=t,an(e))},dn=(e,t)=>{if(!e)return Gs;const s=new nn;e.state=s,s.strm=e,s.window=null,s.mode=$s;const n=ln(e,t);return n!==Hs&&(e.state=null),n};let cn,hn,un=!0;const _n=e=>{if(un){cn=new Int32Array(512),hn=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Us(1,e.lens,0,288,cn,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Us(2,e.lens,0,32,hn,0,e.work,{bits:5}),un=!1}e.lencode=cn,e.lenbits=9,e.distcode=hn,e.distbits=5},pn=(e,t,s,n)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(t.subarray(s-n,s-n+i),o.wnext),(n-=i)?(o.window.set(t.subarray(s-n,s),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var En={inflateReset:an,inflateReset2:ln,inflateResetKeep:rn,inflateInit:e=>dn(e,15),inflateInit2:dn,inflate:(e,t)=>{let s,n,i,o,r,a,l,d,c,h,u,_,p,E,g,f,v,m,S,T,C,N,y=0;const w=new Uint8Array(4);let A,b;const x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(on(e)||!e.output||!e.input&&0!==e.avail_in)return Gs;s=e.state,s.mode===Ws&&(s.mode=Qs),r=e.next_out,i=e.output,l=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,d=s.hold,c=s.bits,h=a,u=l,N=Hs;e:for(;;)switch(s.mode){case $s:if(0===s.wrap){s.mode=Qs;break}for(;c<16;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(2&s.wrap&&35615===d){0===s.wbits&&(s.wbits=15),s.check=0,w[0]=255&d,w[1]=d>>>8&255,s.check=dt(s.check,w,2,0),d=0,c=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",s.mode=tn;break}if((15&d)!==js){e.msg="unknown compression method",s.mode=tn;break}if(d>>>=4,c-=4,C=8+(15&d),0===s.wbits&&(s.wbits=C),C>15||C>s.wbits){e.msg="invalid window size",s.mode=tn;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&d?16189:Ws,d=0,c=0;break;case 16181:for(;c<16;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(s.flags=d,(255&s.flags)!==js){e.msg="unknown compression method",s.mode=tn;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=tn;break}s.head&&(s.head.text=d>>8&1),512&s.flags&&4&s.wrap&&(w[0]=255&d,w[1]=d>>>8&255,s.check=dt(s.check,w,2,0)),d=0,c=0,s.mode=16182;case 16182:for(;c<32;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}s.head&&(s.head.time=d),512&s.flags&&4&s.wrap&&(w[0]=255&d,w[1]=d>>>8&255,w[2]=d>>>16&255,w[3]=d>>>24&255,s.check=dt(s.check,w,4,0)),d=0,c=0,s.mode=16183;case 16183:for(;c<16;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}s.head&&(s.head.xflags=255&d,s.head.os=d>>8),512&s.flags&&4&s.wrap&&(w[0]=255&d,w[1]=d>>>8&255,s.check=dt(s.check,w,2,0)),d=0,c=0,s.mode=16184;case 16184:if(1024&s.flags){for(;c<16;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}s.length=d,s.head&&(s.head.extra_len=d),512&s.flags&&4&s.wrap&&(w[0]=255&d,w[1]=d>>>8&255,s.check=dt(s.check,w,2,0)),d=0,c=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(_=s.length,_>a&&(_=a),_&&(s.head&&(C=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(n.subarray(o,o+_),C)),512&s.flags&&4&s.wrap&&(s.check=dt(s.check,n,_,o)),a-=_,o+=_,s.length-=_),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break e;_=0;do{C=n[o+_++],s.head&&C&&s.length<65536&&(s.head.name+=String.fromCharCode(C))}while(C&&_<a);if(512&s.flags&&4&s.wrap&&(s.check=dt(s.check,n,_,o)),a-=_,o+=_,C)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break e;_=0;do{C=n[o+_++],s.head&&C&&s.length<65536&&(s.head.comment+=String.fromCharCode(C))}while(C&&_<a);if(512&s.flags&&4&s.wrap&&(s.check=dt(s.check,n,_,o)),a-=_,o+=_,C)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;c<16;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(4&s.wrap&&d!==(65535&s.check)){e.msg="header crc mismatch",s.mode=tn;break}d=0,c=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=Ws;break;case 16189:for(;c<32;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}e.adler=s.check=sn(d),d=0,c=0,s.mode=Zs;case Zs:if(0===s.havedict)return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,s.hold=d,s.bits=c,qs;e.adler=s.check=1,s.mode=Ws;case Ws:if(t===Ps||t===Fs)break e;case Qs:if(s.last){d>>>=7&c,c-=7&c,s.mode=en;break}for(;c<3;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}switch(s.last=1&d,d>>>=1,c-=1,3&d){case 0:s.mode=16193;break;case 1:if(_n(s),s.mode=Xs,t===Fs){d>>>=2,c-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=tn}d>>>=2,c-=2;break;case 16193:for(d>>>=7&c,c-=7&c;c<32;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",s.mode=tn;break}if(s.length=65535&d,d=0,c=0,s.mode=Ys,t===Fs)break e;case Ys:s.mode=16195;case 16195:if(_=s.length,_){if(_>a&&(_=a),_>l&&(_=l),0===_)break e;i.set(n.subarray(o,o+_),r),a-=_,o+=_,l-=_,r+=_,s.length-=_;break}s.mode=Ws;break;case 16196:for(;c<14;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(s.nlen=257+(31&d),d>>>=5,c-=5,s.ndist=1+(31&d),d>>>=5,c-=5,s.ncode=4+(15&d),d>>>=4,c-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=tn;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;c<3;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}s.lens[x[s.have++]]=7&d,d>>>=3,c-=3}for(;s.have<19;)s.lens[x[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,A={bits:s.lenbits},N=Us(0,s.lens,0,19,s.lencode,0,s.work,A),s.lenbits=A.bits,N){e.msg="invalid code lengths set",s.mode=tn;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;y=s.lencode[d&(1<<s.lenbits)-1],g=y>>>24,f=y>>>16&255,v=65535&y,!(g<=c);){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(v<16)d>>>=g,c-=g,s.lens[s.have++]=v;else{if(16===v){for(b=g+2;c<b;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(d>>>=g,c-=g,0===s.have){e.msg="invalid bit length repeat",s.mode=tn;break}C=s.lens[s.have-1],_=3+(3&d),d>>>=2,c-=2}else if(17===v){for(b=g+3;c<b;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}d>>>=g,c-=g,C=0,_=3+(7&d),d>>>=3,c-=3}else{for(b=g+7;c<b;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}d>>>=g,c-=g,C=0,_=11+(127&d),d>>>=7,c-=7}if(s.have+_>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=tn;break}for(;_--;)s.lens[s.have++]=C}}if(s.mode===tn)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=tn;break}if(s.lenbits=9,A={bits:s.lenbits},N=Us(1,s.lens,0,s.nlen,s.lencode,0,s.work,A),s.lenbits=A.bits,N){e.msg="invalid literal/lengths set",s.mode=tn;break}if(s.distbits=6,s.distcode=s.distdyn,A={bits:s.distbits},N=Us(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,A),s.distbits=A.bits,N){e.msg="invalid distances set",s.mode=tn;break}if(s.mode=Xs,t===Fs)break e;case Xs:s.mode=Js;case Js:if(a>=6&&l>=258){e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,s.hold=d,s.bits=c,ks(e,u),r=e.next_out,i=e.output,l=e.avail_out,o=e.next_in,n=e.input,a=e.avail_in,d=s.hold,c=s.bits,s.mode===Ws&&(s.back=-1);break}for(s.back=0;y=s.lencode[d&(1<<s.lenbits)-1],g=y>>>24,f=y>>>16&255,v=65535&y,!(g<=c);){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(f&&0==(240&f)){for(m=g,S=f,T=v;y=s.lencode[T+((d&(1<<m+S)-1)>>m)],g=y>>>24,f=y>>>16&255,v=65535&y,!(m+g<=c);){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}d>>>=m,c-=m,s.back+=m}if(d>>>=g,c-=g,s.back+=g,s.length=v,0===f){s.mode=16205;break}if(32&f){s.back=-1,s.mode=Ws;break}if(64&f){e.msg="invalid literal/length code",s.mode=tn;break}s.extra=15&f,s.mode=16201;case 16201:if(s.extra){for(b=s.extra;c<b;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}s.length+=d&(1<<s.extra)-1,d>>>=s.extra,c-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;y=s.distcode[d&(1<<s.distbits)-1],g=y>>>24,f=y>>>16&255,v=65535&y,!(g<=c);){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(0==(240&f)){for(m=g,S=f,T=v;y=s.distcode[T+((d&(1<<m+S)-1)>>m)],g=y>>>24,f=y>>>16&255,v=65535&y,!(m+g<=c);){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}d>>>=m,c-=m,s.back+=m}if(d>>>=g,c-=g,s.back+=g,64&f){e.msg="invalid distance code",s.mode=tn;break}s.offset=v,s.extra=15&f,s.mode=16203;case 16203:if(s.extra){for(b=s.extra;c<b;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}s.offset+=d&(1<<s.extra)-1,d>>>=s.extra,c-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=tn;break}s.mode=16204;case 16204:if(0===l)break e;if(_=u-l,s.offset>_){if(_=s.offset-_,_>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=tn;break}_>s.wnext?(_-=s.wnext,p=s.wsize-_):p=s.wnext-_,_>s.length&&(_=s.length),E=s.window}else E=i,p=r-s.offset,_=s.length;_>l&&(_=l),l-=_,s.length-=_;do{i[r++]=E[p++]}while(--_);0===s.length&&(s.mode=Js);break;case 16205:if(0===l)break e;i[r++]=s.length,l--,s.mode=Js;break;case en:if(s.wrap){for(;c<32;){if(0===a)break e;a--,d|=n[o++]<<c,c+=8}if(u-=l,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?dt(s.check,i,u,r-u):at(s.check,i,u,r-u)),u=l,4&s.wrap&&(s.flags?d:sn(d))!==s.check){e.msg="incorrect data check",s.mode=tn;break}d=0,c=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;c<32;){if(0===a)break e;a--,d+=n[o++]<<c,c+=8}if(4&s.wrap&&d!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=tn;break}d=0,c=0}s.mode=16208;case 16208:N=zs;break e;case tn:N=Vs;break e;case 16210:return Ks;default:return Gs}return e.next_out=r,e.avail_out=l,e.next_in=o,e.avail_in=a,s.hold=d,s.bits=c,(s.wsize||u!==e.avail_out&&s.mode<tn&&(s.mode<en||t!==Ms))&&pn(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?dt(s.check,i,u,e.next_out-u):at(s.check,i,u,e.next_out-u)),e.data_type=s.bits+(s.last?64:0)+(s.mode===Ws?128:0)+(s.mode===Xs||s.mode===Ys?256:0),(0===h&&0===u||t===Ms)&&N===Hs&&(N=Bs),N},inflateEnd:e=>{if(on(e))return Gs;let t=e.state;return t.window&&(t.window=null),e.state=null,Hs},inflateGetHeader:(e,t)=>{if(on(e))return Gs;const s=e.state;return 0==(2&s.wrap)?Gs:(s.head=t,t.done=!1,Hs)},inflateSetDictionary:(e,t)=>{const s=t.length;let n,i,o;return on(e)?Gs:(n=e.state,0!==n.wrap&&n.mode!==Zs?Gs:n.mode===Zs&&(i=1,i=at(i,t,s,0),i!==n.check)?Vs:(o=pn(e,t,s,s),o?(n.mode=16210,Ks):(n.havedict=1,Hs)))},inflateInfo:"pako inflate (from Nodeca project)"};var gn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const fn=Object.prototype.toString,{Z_NO_FLUSH:vn,Z_FINISH:mn,Z_OK:Sn,Z_STREAM_END:Tn,Z_NEED_DICT:Cn,Z_STREAM_ERROR:Nn,Z_DATA_ERROR:yn,Z_MEM_ERROR:wn}=ht;function An(e){this.options=cs.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ps,this.strm.avail_out=0;let s=En.inflateInit2(this.strm,t.windowBits);if(s!==Sn)throw new Error(ct[s]);if(this.header=new gn,En.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=_s.string2buf(t.dictionary):"[object ArrayBuffer]"===fn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=En.inflateSetDictionary(this.strm,t.dictionary),s!==Sn)))throw new Error(ct[s])}function bn(e,t){const s=new An(t);if(s.push(e),s.err)throw s.msg||ct[s.err];return s.result}An.prototype.push=function(e,t){const s=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(r=t===~~t?t:!0===t?mn:vn,"[object ArrayBuffer]"===fn.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),o=En.inflate(s,r),o===Cn&&i&&(o=En.inflateSetDictionary(s,i),o===Sn?o=En.inflate(s,r):o===yn&&(o=Cn));s.avail_in>0&&o===Tn&&s.state.wrap>0&&0!==e[s.next_in];)En.inflateReset(s),o=En.inflate(s,r);switch(o){case Nn:case yn:case Cn:case wn:return this.onEnd(o),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||o===Tn))if("string"===this.options.to){let e=_s.utf8border(s.output,s.next_out),t=s.next_out-e,i=_s.buf2string(s.output,e);s.next_out=t,s.avail_out=n-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(i)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(o!==Sn||0!==a){if(o===Tn)return o=En.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},An.prototype.onData=function(e){this.chunks.push(e)},An.prototype.onEnd=function(e){e===Sn&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=cs.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var xn={Inflate:An,inflate:bn,inflateRaw:function(e,t){return(t=t||{}).raw=!0,bn(e,t)},ungzip:bn,constants:ht};const{Deflate:kn,deflate:In,deflateRaw:On,gzip:Rn}=bs,{Inflate:Dn,inflate:Ln,inflateRaw:Un,ungzip:Mn}=xn;var Pn={Deflate:kn,deflate:In,deflateRaw:On,gzip:Rn,Inflate:Dn,inflate:Ln,inflateRaw:Un,ungzip:Mn,constants:ht};var Fn,Hn;exports.ConnectionState=void 0,(Fn=exports.ConnectionState||(exports.ConnectionState={})).CONNECTING="CONNECTING",Fn.OPEN="OPEN",Fn.CLOSED="CLOSED";class zn extends A{constructor(e,{sdkState:t,dispatcher:s,logger:n}){super(),this.lastActive=0,this._iid=e,this._sdkState=t,this._dispatcher=s,this._logger=n}get isOpen(){return this.connectionState===exports.ConnectionState.OPEN}get connectionState(){if(this._ws)switch(this._ws.readyState){case 0:return exports.ConnectionState.CONNECTING;case 1:return exports.ConnectionState.OPEN}return exports.ConnectionState.CLOSED}get ws(){var e;return null!==(e=this._ws)&&void 0!==e?e:null}_handleMessage(e){e.split("\n").forEach((e=>{if(e){const t=Te.createFromRawMessage(this._iid,e);if(this._logger.debug("receive websocket event",t),"LOGI"===t.code)this.dispatch("message",t);else if("PONG"===t.code)this.dispatch("pong");else if("EXPR"===t.code){if(t.payload){const e=new he(t.payload);e.expiresIn>=0&&this._dispatcher.dispatch(e)}}else"NOOP"===t.code||this.dispatch("message",t)}}))}connect(t){this._ws=new WebSocket(t),this._ws.onopen=()=>{this._logger.debug("websocket open"),this.dispatch("open")},this._ws.onmessage=t=>e(this,void 0,void 0,(function*(){var s;if(null===(s=this._sdkState.websocket)||void 0===s?void 0:s.compression)if(t.data instanceof Blob){const s=new FileReader;s.readAsArrayBuffer(t.data),s.onloadend=()=>e(this,void 0,void 0,(function*(){const t=yield(n=s.result,e(void 0,void 0,void 0,(function*(){const e=Pn.ungzip(n);return String.fromCharCode.apply(null,e)})));var n;this._handleMessage(t)}))}else"string"==typeof t.data&&this._handleMessage(t.data);else this._handleMessage(t.data)})),this._ws.onerror=()=>{this._logger.debug("websocket error"),this.dispatch("error",o.networkError)},this._ws.onclose=()=>{this._logger.debug("websocket close"),this.dispatch("close")},this.lastActive=Date.now()}disconnect(){return new Promise((e=>{this._logger.debug("websocket disconnect"),this._ws&&this.connectionState!==exports.ConnectionState.CLOSED?(this._ws.onopen=Ce,this._ws.onmessage=Ce,this._ws.onerror=Ce,this._ws.onclose=()=>{this.dispatch("close"),e()},this._ws.close(),this._ws=void 0):e()}))}send(e){if(!this._ws)throw o.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())}error(e){this._logger.debug("websocket error",e),this.dispatch("error",e)}}class qn extends x{constructor({code:e,ackRequired:t,payload:s={}}){var n;super(),this.code=e,this.payload=s,this.requestId=null!==(n=this.payload.req_id)&&void 0!==n?n:y(),this.ackRequired=t,this.payload.req_id=this.requestId}convertToMessage(){return`${this.code}${JSON.stringify(this.payload)}\n`}}class Gn extends x{constructor({all:e,feed:t,custom_types:s,ts:n}){super(),this.all=e,this.feed=t,this.customTypes=s,this.ts=n}}class Vn{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Kn{constructor(e,{auth:t,sdkState:s,dispatcher:n,logger:i,useFetchCompat:r=!1}){this._ackStateMap=new Map,this._sdkState=s,this._dispatcher=n,this._logger=i,this.apiClient=new Se(e,{auth:t,sdkState:s,dispatcher:n,logger:i,useFetchCompat:r}),this.websocketClient=new zn(e,{sdkState:s,dispatcher:n,logger:i}),this.websocketClient.on("message",(e=>{if(e.payload.unread_cnt&&this._dispatcher.dispatch(new Gn(e.payload.unread_cnt)),e.requestId){if(this._ackStateMap.has(e.requestId)){const t=this._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new o({code:e.payload.code,message:e.payload.message}))}}else this._dispatcher.dispatch(e)})).on("close",(()=>{this._ackStateMap.forEach((e=>{e.reject(o.connectionClosed)})),this._ackStateMap.clear()}))}_sendApiRequest(t){return e(this,void 0,void 0,(function*(){return yield this.apiClient.send(t)}))}_sendWebsocketRequest(t){return e(this,void 0,void 0,(function*(){if(!this._sdkState.websocket)throw o.connectionRequired;const e=new Vn;if(t.ackRequired){let s;const n=(n,i)=>{this._ackStateMap.has(t.requestId)&&(this._ackStateMap.delete(t.requestId),s&&(clearTimeout(s),s=null),n?(this._logger.debug("fail websocket request",n),e.reject(n)):(this._logger.debug("receive websocket ack",t.requestId),e.resolve(i)))};try{s=setTimeout((()=>n(o.noAckTimeout)),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(t.requestId,{resolve:e=>n(void 0,e),reject:e=>n(e)}),this.websocketClient.send(t)}catch(e){n(e)}}else try{this.websocketClient.send(t),e.resolve()}catch(t){e.reject(t)}return e.promise}))}send(t){return e(this,void 0,void 0,(function*(){if(t instanceof le)return yield this._sendApiRequest(t);if(t instanceof qn)return yield this._sendWebsocketRequest(t);throw o.invalidParameters}))}cancel(e){this.apiClient.cancel(e)}cancelAll(){this.apiClient.cancelAll()}}exports.ConnectionStateType=void 0,(Hn=exports.ConnectionStateType||(exports.ConnectionStateType={}))[Hn.NONE=0]="NONE",Hn[Hn.INITIALIZED=1]="INITIALIZED",Hn[Hn.CONNECTING=2]="CONNECTING",Hn[Hn.CONNECTED=3]="CONNECTED",Hn[Hn.RECONNECTING=4]="RECONNECTING",Hn[Hn.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",Hn[Hn.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",Hn[Hn.LOGOUT=7]="LOGOUT";class Bn extends x{constructor({stateType:e}){super(),this.stateType=e}}class jn{constructor(t,{auth:s,sdkState:n,dispatcher:i,logger:r,useFetchCompat:a=!1}){this._currentConnectionStateType=exports.ConnectionStateType.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new Kn(t,{auth:s,sdkState:n,dispatcher:i,logger:r,useFetchCompat:a}),this._auth=s,this._logger=r,this._dispatcher=i,this._dispatcher.on((t=>{if(t instanceof Bn){const{stateType:s}=t;switch(this._currentConnectionStateType=s,s){case exports.ConnectionStateType.CONNECTED:{const t=this._lazyCallQueue;this._lazyCallQueue=[],t.forEach((t=>e(this,void 0,void 0,(function*(){const{command:e,deferred:s,timeout:n}=t;clearTimeout(n);try{const t=yield this.send(e);s.resolve(t)}catch(e){s.reject(e)}}))));break}case exports.ConnectionStateType.INITIALIZED:case exports.ConnectionStateType.INTERNAL_DISCONNECTED:case exports.ConnectionStateType.EXTERNAL_DISCONNECTED:case exports.ConnectionStateType.LOGOUT:{const t=this._lazyCallQueue;this._lazyCallQueue=[],t.forEach((t=>e(this,void 0,void 0,(function*(){const{deferred:e,timeout:s}=t;clearTimeout(s),this._auth&&this._auth.hasSession?e.reject(o.connectionClosed):e.reject(o.connectionRequired)}))));break}}}}))}get isReady(){return this._currentConnectionStateType===exports.ConnectionStateType.CONNECTED}get isLazyCallActivated(){return this._currentConnectionStateType===exports.ConnectionStateType.CONNECTING||this._currentConnectionStateType===exports.ConnectionStateType.RECONNECTING}send(t){return e(this,void 0,void 0,(function*(){if(t instanceof qn){if(this.isReady)return this._logger.debug("send websocket request",t),yield this.commandRouter.send(t);if(this.isLazyCallActivated){this._logger.debug("wait websocket request",t);const e=new Vn;return this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout((()=>this.timeout(t.requestId)),1e4)}),e.promise}throw this._logger.debug("fail websocket request"),o.connectionRequired}if(t instanceof le){if(this._auth.hasSession)return this._logger.debug("send api request",t),yield this.commandRouter.send(t);if(this.isLazyCallActivated){this._logger.debug("wait api request",t);const e=new Vn;return this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout((()=>this.timeout(t.requestId)),1e4)}),e.promise}{const e=o.connectionRequired;throw this._logger.debug("fail api request",e),e}}throw o.invalidCommand}))}forceSend(t){return e(this,void 0,void 0,(function*(){if(this._logger.debug("send forced request",t),t instanceof qn||t instanceof le)return yield this.commandRouter.send(t);throw o.invalidCommand}))}timeout(e){this._logger.debug("timeout request",e);const t=this._lazyCallQueue.findIndex((t=>t.command.requestId===e));t>-1&&(this._lazyCallQueue[t].deferred.reject(o.connectionRequired),this._lazyCallQueue.splice(t,1))}cancel(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)}cancelAll(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()}}const $n="sendbird@devicetokens";class Zn{constructor({type:e,token:t}){this.type=e,this.token=t}static payloadify(e){return k(I({type:e.type,token:e.token}))}}class Wn extends le{constructor({userId:e,authToken:t,expiringSession:s=!0}){super(),this.path=`${G}/${e}/session_key`,this.method=exports.APIRequestMethod.POST,this.params={token:t,expiring_session:!!s},this.requireAuth=!1}}class Qn extends qn{constructor({authToken:e,expiringSession:t=!0,requestId:s=""}){super({code:"LOGI",payload:{token:e,expiring_session:t?1:0,req_id:s},ackRequired:!0})}}class Yn extends de{constructor(e,t){super(e,t);const{key:s}=t;this.key=s}}class Xn extends Te{constructor(e,t,s){var n;super(e,"LOGI",s),this.error=null,this.newKey=null,this.newKey=null!==(n=s.new_key)&&void 0!==n?n:null,this.error=s.error?new o(s.error):null}}class Jn extends x{}const ei=t=>e(void 0,void 0,void 0,(function*(){return new Promise((e=>setTimeout(e,t)))}));class ti{calcTimeout(){return 0}}const si=(t,s,n=new ti)=>e(void 0,void 0,void 0,(function*(){let e=0,i=null;const o=e=>i=null!=e?e:new Error("Halted"),r=()=>{e=0};for(;-1===s||e<s;)try{const e=yield t(o,r);if(i)throw i;return e}catch(t){if(i)throw i;if(e++,e===s)throw t;yield ei(n.calcTimeout(e))}throw"It should not happen."})),ni=t=>e(void 0,void 0,void 0,(function*(){try{yield t()}catch(e){if(!(e instanceof o))throw e;e.throwOutside()}})),ii=new WeakMap;class oi extends A{constructor({auth:e,cacheContext:t,sdkState:s,dispatcher:n,requestQueue:i,logger:o}){super(),this._currentConnectionStateType=exports.ConnectionStateType.INITIALIZED,this._isRefreshingAuthToken=!1,this._isRefreshingSessionKey=!1,this.currentUser=null,this.auth=e,this._cacheContext=t,this._sdkState=s,this._dispatcher=n,this._requestQueue=i,this._logger=o,this._deviceTokens=[],this._dispatcher.on((e=>{var t;if(e instanceof Bn){const{stateType:t}=e;this._currentConnectionStateType=t}else e instanceof he&&this.handler&&(e.invalidateSessionToken&&(this.auth.authToken=void 0),e.error&&(e.error.isSessionKeyExpiredError||e.error.isSessionTokenExpiredError)&&(this._logger.debug("session expired"),(null===(t=this.handler)||void 0===t?void 0:t.onSessionExpired)&&this.handler.onSessionExpired(),this.refresh()))}))}get ekey(){return ii.get(this)}get deviceTokens(){return this._deviceTokens}get deviceTokenLastDeletedAt(){return this._deviceTokenLastDeletedAt}indexOfDeviceToken(e,t){return this._deviceTokens.findIndex((s=>s.type===e&&s.token===t))}hasDeviceToken(e,t){return this.indexOfDeviceToken(e,t)>=0}createRefreshWebsocketCommand(e,t){return new Qn({authToken:e,expiringSession:!0,requestId:t})}_refreshSessionKeyByWebSocket(t){return e(this,void 0,void 0,(function*(){const e=this.createRefreshWebsocketCommand(t),s=yield this._requestQueue.forceSend(e),{newKey:n,error:i}=s.as(Xn);if(i)throw i;this.auth.sessionKey=null!=n?n:this.auth.sessionKey}))}_refreshSessionKeyByApi(t){return e(this,void 0,void 0,(function*(){const s=new Wn({userId:this._sdkState.userId,authToken:t,expiringSession:!0});yield si((t=>e(this,void 0,void 0,(function*(){try{const e=yield this._requestQueue.forceSend(s),{key:t}=e.as(Yn);this.auth.sessionKey=t}catch(e){if(!this._isSessionRelatedError(e))throw e;t(e)}}))),3)}))}_refreshSessionKey(t,s=!0){return e(this,void 0,void 0,(function*(){if(this._currentConnectionStateType===exports.ConnectionStateType.CONNECTED)try{return yield this._refreshSessionKeyByWebSocket(t),void this.complete()}catch(e){if(this._isSessionRelatedError(e)&&s){const e=yield this._receiveNewAuthToken();return void(e?(this.auth.authToken=e,yield this._refreshSessionKey(this.auth.authToken,!1),this.complete()):(yield this.clear(),this.close()))}}try{yield this._refreshSessionKeyByApi(t),this.complete()}catch(e){if(!this._isSessionRelatedError(e))throw e;if(!s)throw e;{const e=yield this._receiveNewAuthToken();e?(this.auth.authToken=e,yield this._refreshSessionKeyByApi(this.auth.authToken),this.complete()):(yield this.clear(),this.close())}}}))}_receiveNewAuthToken(){const t=new Vn;return ni((()=>e(this,void 0,void 0,(function*(){if(this._isRefreshingAuthToken=!0,this.auth.clear(),this.handler.onSessionTokenRequired){let e=null;const s=()=>{e&&(clearTimeout(e),e=null)},n=e=>{s(),this._isRefreshingAuthToken&&(this._isRefreshingAuthToken=!1,this.dispatch("refresh-authtoken"),t.resolve(e))},i=e=>{s(),this._isRefreshingAuthToken&&(this._isRefreshingAuthToken=!1,t.reject(e))};e=setTimeout((()=>i()),1e3*this._sdkState.sessionTokenRefreshTimeout),this.handler.onSessionTokenRequired(n,i)}else t.resolve(null)})))),t.promise}_isSessionRelatedError(e){return e instanceof o&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError||e.isSessionRevokedError)}get isSessionKeyRefreshing(){return this._isRefreshingSessionKey}get isRefreshingAuthToken(){return this._isRefreshingAuthToken}login(t){var s;return e(this,void 0,void 0,(function*(){const{key:e,ekey:n,userProfile:i,deviceTokenLastDeletedAt:o=0}=t;this.auth.sessionKey=e,ii.set(this,n),this._deviceTokenCacheEnabled=null===(s=null==i?void 0:i.appInfo)||void 0===s?void 0:s.deviceTokenCache;const{preference:r}=this._cacheContext;if(this._deviceTokenCacheEnabled){const e=yield r.get($n);!e||e.lastDeletedAt<o?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=o,yield this.saveDeviceToken()):(this._deviceTokens=e.tokens.map((e=>new Zn(Zn.payloadify(e)))),this._deviceTokenLastDeletedAt=e.lastDeletedAt)}else yield r.remove($n)}))}complete(){this.dispatch("refresh"),ni((()=>e(this,void 0,void 0,(function*(){var e;this._logger.debug("session refreshed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionRefreshed)&&this.handler.onSessionRefreshed()}))))}error(t){ni((()=>e(this,void 0,void 0,(function*(){var e;(null===(e=this.handler)||void 0===e?void 0:e.onSessionError)&&this.handler.onSessionError(t)}))))}close(){this.dispatch("close"),ni((()=>e(this,void 0,void 0,(function*(){var e;this._logger.debug("session closed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionClosed)&&this.handler.onSessionClosed()}))))}refresh(){return e(this,void 0,void 0,(function*(){if(this.handler&&!this._isRefreshingSessionKey){if(this._isRefreshingSessionKey=!0,!this.auth.authToken)try{const e=yield this._receiveNewAuthToken();if(!e)return yield this.clear(),void(this._isRefreshingSessionKey=!1);this._logger.debug("session refreshing.."),this.auth.authToken=e}catch(e){const t=o.sessionTokenRequestFailed;throw this._dispatcher.dispatch(new Jn),this.error(t),this._isRefreshingSessionKey=!1,t}try{yield this._refreshSessionKey(this.auth.authToken),this._isRefreshingSessionKey=!1}catch(e){const t=o.sessionTokenRefreshFailed;throw this._dispatcher.dispatch(new Jn),this.error(t),this._isRefreshingSessionKey=!1,t}}}))}setDeviceToken(e,t){if(this._deviceTokenCacheEnabled){if(this.indexOfDeviceToken(e,t)<0)return this._deviceTokens.push(new Zn({type:e,token:t})),!0}return!1}unsetDeviceToken(e,t){if(this._deviceTokenCacheEnabled){const s=this.indexOfDeviceToken(e,t);s>=0&&this._deviceTokens.splice(s,1)}}unsetDeviceTokens(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter((t=>t.type!==e)):[])}setDeviceTokenDeletedAt(e){e>0&&(this._deviceTokenLastDeletedAt=e)}saveDeviceToken(){return e(this,void 0,void 0,(function*(){if(this._deviceTokenCacheEnabled){const{preference:e}=this._cacheContext;yield e.set($n,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})}}))}clear(){return e(this,void 0,void 0,(function*(){this.currentUser=null,this.auth.clear(),this.close(),ii.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,yield this.saveDeviceToken()}))}}class ri{constructor(){this.type=exports.ConnectionStateType.NONE,this.name="none"}run(t){return e(this,void 0,void 0,(function*(){}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){}))}onReconnect(t,{resetReconnectCount:s=!1}){return e(this,void 0,void 0,(function*(){}))}onDisconnect(t,{error:s=null,autoReconnect:n=!1}){return e(this,void 0,void 0,(function*(){}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){}))}onLogout(t){return e(this,void 0,void 0,(function*(){}))}}class ai extends ri{constructor(){super(...arguments),this.type=exports.ConnectionStateType.LOGOUT,this.name="logout"}run(t){return e(this,void 0,void 0,(function*(){const s=Date.now(),n=t.sdkState.userId;yield t.logout(),yield t.changeState(new _i,s),ni((()=>e(this,void 0,void 0,(function*(){t.connectionHandlers.forEach((e=>{e.onDisconnected&&e.onDisconnected(n)}))}))))}))}}class li extends ri{constructor(){super(),this.type=exports.ConnectionStateType.EXTERNAL_DISCONNECTED,this.name="externaldisconnected"}run(t){return e(this,void 0,void 0,(function*(){yield t.disconnect()}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),yield t.changeState(new ui({authToken:s}),e)}))}onReconnect(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new ci,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new ai,e)}))}}class di extends ri{constructor({autoReconnect:e}){super(),this.type=exports.ConnectionStateType.INTERNAL_DISCONNECTED,this.name="internaldisconnected",this._autoReconnect=!1,this._autoReconnect=e}run(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),this._autoReconnect&&(yield t.changeState(new ci,e))}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),yield t.changeState(new ui({authToken:s}),e)}))}onReconnect(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new ci,e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new li,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new ai,e)}))}}class ci extends ri{constructor(){super(...arguments),this.type=exports.ConnectionStateType.RECONNECTING,this.name="reconnecting",this._callbacks=[]}_halt(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)}_flushCallbacks(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach((t=>t(e)))}run(t){return e(this,void 0,void 0,(function*(){const s=Date.now(),n=new Vn;this._callbacks.push((e=>e?n.reject(e):n.resolve())),ni((()=>e(this,void 0,void 0,(function*(){t.connectionHandlers.forEach((e=>{e.onReconnectStarted&&e.onReconnectStarted()}))}))));try{const{reconnectMaxRetry:n,reconnectRetryStrategy:i}=t.sdkState.websocket;yield si(((s,n)=>e(this,void 0,void 0,(function*(){this._haltConnect=s,this._resetConnect=n;try{yield t.connect()}catch(e){if(t.clearLoginTimer(),e instanceof o&&e.code===exports.SendbirdErrorCode.CONNECTION_CANCELED)return void s(e);throw e}}))),n,i),yield t.changeState(new hi,s),ni((()=>e(this,void 0,void 0,(function*(){this._flushCallbacks(),t.connectionHandlers.forEach((e=>{e.onReconnectSucceeded&&e.onReconnectSucceeded()}))}))))}catch(n){if(i(n))throw n;n instanceof o&&n.code!==exports.SendbirdErrorCode.CONNECTION_CANCELED&&(yield t.changeState(new di({autoReconnect:!1}),s)),ni((()=>e(this,void 0,void 0,(function*(){this._flushCallbacks(n),t.connectionHandlers.forEach((e=>{e.onReconnectFailed&&e.onReconnectFailed()}))}))))}return n.promise}))}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=new Vn;return this._halt(o.connectionCanceled),t.cancelConnectForRetry(),this._callbacks.push((()=>{const n=Date.now();t.changeState(new ui({authToken:s}),n).then((()=>{e.resolve()})).catch((t=>{e.reject(t)}))})),e.promise}))}onReconnect(t,{resetReconnectCount:s=!1}){return e(this,void 0,void 0,(function*(){const e=new Vn;return this._resetConnect&&s&&this._resetConnect(),this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onDisconnect(t,{error:s=null,autoReconnect:n=!0}){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new di({autoReconnect:n}),e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new li,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new ai,e)}))}}class hi extends ri{constructor(){super(...arguments),this.type=exports.ConnectionStateType.CONNECTED,this.name="connected"}onReconnect(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.disconnect(),yield t.changeState(new ci,e)}))}onDisconnect(t,{autoReconnect:s}){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new di({autoReconnect:s}),e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new li,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new ai,e)}))}}class ui extends ri{constructor({authToken:e}){super(),this.type=exports.ConnectionStateType.CONNECTING,this.name="connecting",this._authToken="",this._callbacks=[],this._authToken=e}_halt(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)}_flushCallbacks(e){this._haltConnect=void 0,this._callbacks.forEach((t=>t(e)))}run(t){return e(this,void 0,void 0,(function*(){const s=Date.now(),n=new Vn;this._callbacks.push((e=>e?n.reject(e):n.resolve()));try{yield si((s=>e(this,void 0,void 0,(function*(){this._haltConnect=s;try{yield t.connect(this._authToken)}catch(e){if(t.clearLoginTimer(),e instanceof o&&e.code===exports.SendbirdErrorCode.CONNECTION_CANCELED)return void s(e);throw e}}))),t.sdkState.websocket.connectMaxRetry),yield t.changeState(new hi,s),ni((()=>e(this,void 0,void 0,(function*(){this._flushCallbacks(),t.connectionHandlers.forEach((e=>{e.onConnected&&e.onConnected(t.sdkState.userId)}))}))))}catch(n){if(i(n))throw n;yield t.disconnect(),n instanceof o&&n.code!==exports.SendbirdErrorCode.CONNECTION_CANCELED&&(yield t.changeState(new _i,s)),ni((()=>e(this,void 0,void 0,(function*(){this._flushCallbacks(n)}))))}return n.promise}))}onConnect(t){return e(this,void 0,void 0,(function*(){const e=new Vn;return this._callbacks.push((t=>t?e.reject(t):e.resolve())),e.promise}))}onDisconnect(t,{error:s=null,autoReconnect:n=!1}){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(null!=s?s:o.connectionCanceled),t.hasSession?yield t.changeState(new di({autoReconnect:n}),e):yield t.changeState(new ai,e)}))}onDisconnectWebSocket(t){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),t.hasSession?yield t.changeState(new li,e):yield t.changeState(new ai,e)}))}onLogout(t){return e(this,void 0,void 0,(function*(){const e=Date.now();this._halt(o.connectionCanceled),yield t.changeState(new ai,e)}))}}class _i extends ri{constructor(){super(...arguments),this.type=exports.ConnectionStateType.INITIALIZED,this.name="initialized"}onConnect(t,s){return e(this,void 0,void 0,(function*(){const e=Date.now();yield t.changeState(new ui({authToken:s}),e)}))}}class pi extends qn{constructor(){super({code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})}}class Ei{constructor({pingDelegate:e,sdkState:t,logger:s}){this.pingDelegate=e,this.sdkState=t,this._logger=s}get isWaiting(){return!!this._pingTimeoutTimer}ping(){var e;if(!this.sdkState.websocket)throw o.connectionRequired;const t=new pi;try{const s=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((()=>{this._logger.debug("pinger.ping() timeout"),this.pingDelegate.error()}),s),this.pingDelegate.send(t),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return t}pong(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)}refreshTimer(){var e;if(!this.sdkState.websocket)throw o.connectionRequired;this._logger.debug("pinger.refreshTimer()");const t=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((()=>{this.ping()}),t)}start(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()}stop(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)}}class gi{constructor(e){var t,s,n,i;this.isEnabled=null!==(t=e.enabled)&&void 0!==t&&t,this.feedChannels=null!==(s=e.feed_channels)&&void 0!==s?s:{},this.templateListToken=null!==(n=e.template_list_token)&&void 0!==n?n:null,this.settingsUpdatedAt=null!==(i=e.settings_updated_at)&&void 0!==i?i:0}static payloadify(e){return k(I({enabled:e.isEnabled,feed_channels:e.feedChannels,template_list_token:e.templateListToken,settings_updated_at:e.settingsUpdatedAt}))}}class fi{constructor(e){var t;this.lastUpdatedAt=null!==(t=e.last_updated_at)&&void 0!==t?t:0}static payloadify(e){return k(I({last_updated_at:e.lastUpdatedAt}))}}const vi=1048576;class mi{constructor(e={}){var t,s,n,i,o;this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?e.file_upload_size_limit*vi:Number.MAX_SAFE_INTEGER,this.useReaction=!!e.use_reaction,this.applicationAttributes=null!==(t=e.application_attributes)&&void 0!==t?t:[],this.premiumFeatureList=null!==(s=e.premium_feature_list)&&void 0!==s?s:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=null!==(n=e.multiple_file_send_max_size)&&void 0!==n?n:5,this.allowSdkStatsUpload=null===(i=e.allow_sdk_log_ingestion)||void 0===i||i,this.uikitConfigInfo=new fi(null!==(o=e.uikit_config)&&void 0!==o?o:{}),this.notificationInfo=e.notifications?new gi(e.notifications):null}static payloadify(e){return k(I({emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/vi,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction,allow_sdk_log_ingestion:e.allowSdkStatsUpload,uikit_config:e.uikitConfigInfo?fi.payloadify(e.uikitConfigInfo):null,notifications:e.notificationInfo?gi.payloadify(e.notificationInfo):null}))}}class Si{constructor(e){this._iid="",this._iid=e}static payloadify(e){return{}}}class Ti extends le{constructor({userId:e,metadata:t}){super(),this.method=exports.APIRequestMethod.POST,this.path=`${G}/${e}/metadata`,this.params={metadata:t}}}class Ci extends de{constructor(e,t){super(e,t),this.metaData=t}}class Ni extends le{constructor({userId:e,metadata:t,upsert:s}){super(),this.method=exports.APIRequestMethod.PUT,this.path=`${G}/${e}/metadata`,this.params={metadata:t,upsert:s}}}class yi extends de{constructor(e,t){super(e,t),this.metadata=t}}class wi extends le{constructor({userId:e,metadataKey:t}){super(),this.method=exports.APIRequestMethod.DELETE,this.path=`${G}/${e}/metadata/${t}`}}class Ai extends le{constructor({userId:e}){super(),this.method=exports.APIRequestMethod.DELETE,this.path=`${G}/${e}/metadata`}}const bi=(e,t)=>{const s=JSON.parse(JSON.stringify(e));return s._iid&&delete s._iid,t&&t(s),s},xi=(e,t)=>{const s=JSON.parse(JSON.stringify(e));return t&&t(s),s},ki=e=>({do:t=>{e||t()},throw:t=>{if(!e)throw t}});var Ii;exports.UserOnlineState=void 0,(Ii=exports.UserOnlineState||(exports.UserOnlineState={})).ONLINE="online",Ii.OFFLINE="offline",Ii.NON_AVAILABLE="nonavailable";class Oi extends Si{constructor(e,t){var s,n,i,o,r,a,c,h,u,_,p,E;super(e),this.userId=null!==(n=null!==(s=t.guest_id)&&void 0!==s?s:t.user_id)&&void 0!==n?n:"",this.nickname=null!==(o=null!==(i=t.nickname)&&void 0!==i?i:t.name)&&void 0!==o?o:"",this.plainProfileUrl=null!==(a=null!==(r=t.profile_url)&&void 0!==r?r:t.image)&&void 0!==a?a:"",this.requireAuth=null!==(c=t.require_auth_for_profile_image)&&void 0!==c&&c,this.metaData=null!==(h=t.metadata)&&void 0!==h?h:{},this.connectionStatus=exports.UserOnlineState.NON_AVAILABLE,d(exports.UserOnlineState,t.is_online)?this.connectionStatus=t.is_online:l("boolean",t.is_online)&&(this.connectionStatus=t.is_online?exports.UserOnlineState.ONLINE:exports.UserOnlineState.OFFLINE),this.isActive=null===(u=t.is_active)||void 0===u||u,this.lastSeenAt=null!==(_=t.last_seen_at)&&void 0!==_?_:null,this.preferredLanguages=t.preferred_languages?[...t.preferred_languages]:null,this.friendDiscoveryKey=null!==(p=t.friend_discovery_key)&&void 0!==p?p:null,this.friendName=null!==(E=t.friend_name)&&void 0!==E?E:null}static payloadify(e){return k(I(Object.assign(Object.assign({},super.payloadify(e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))}get profileUrl(){const{sessionManager:e}=ji.of(this._iid);return this.requireAuth?`${this.plainProfileUrl}?auth=${e.ekey}`:this.plainProfileUrl}serialize(){return bi(this)}_isValidMetaData(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((t=>e[t])).every((e=>l("string",e)))}_applyMetaData(e,t=!1){Object.keys(e).forEach((s=>{t?delete this.metaData[s]:this.metaData[s]=e[s]}))}createMetaData(t){return e(this,void 0,void 0,(function*(){ki(this._isValidMetaData(t)).throw(o.invalidParameters);const{sdkState:e,requestQueue:s}=ji.of(this._iid),n=new Ti({userId:e.userId,metadata:t}),i=yield s.send(n),{metaData:r}=i.as(Ci);return this._applyMetaData(r),this.metaData}))}updateMetaData(t,s=!1){return e(this,void 0,void 0,(function*(){ki(this._isValidMetaData(t)).throw(o.invalidParameters);const{sdkState:e,requestQueue:n}=ji.of(this._iid),i=new Ni({userId:e.userId,metadata:t,upsert:s}),r=yield n.send(i),{metadata:a}=r.as(yi);return this._applyMetaData(a),this.metaData}))}deleteMetaData(t){return e(this,void 0,void 0,(function*(){ki(l("string",t)).throw(o.invalidParameters);const{sdkState:e,requestQueue:s}=ji.of(this._iid),n=new wi({userId:e.userId,metadataKey:t});return yield s.send(n),this._applyMetaData({[t]:!0},!0),this.metaData}))}deleteAllMetaData(){return e(this,void 0,void 0,(function*(){const{sdkState:e,requestQueue:t}=ji.of(this._iid),s=new Ai({userId:e.userId});yield t.send(s),this.metaData={}}))}}class Ri extends x{constructor({userProfile:e}){super(),this.userProfile=e}}class Di{constructor(e,t){var s,n,i,o,r,a,l,d,c,h,u,_,p,E;this._iid=e,this.appInfo=new mi(t),this.user=new Oi(e,t),this.connectedAt=null!==(s=t.login_ts)&&void 0!==s?s:0,this.firstConnectedAt=0,this.pingInterval=null!==(n=t.ping_interval)&&void 0!==n?n:15e3,this.pongTimeout=null!==(i=t.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(r=null===(o=t.reconnect)||void 0===o?void 0:o.interval)&&void 0!==r?r:3e3,this.reconnectMaxInterval=null!==(l=null===(a=t.reconnect)||void 0===a?void 0:a.max_interval)&&void 0!==l?l:6e4,this.reconnectRetryCount=null!==(c=null===(d=t.reconnect)||void 0===d?void 0:d.retry_cnt)&&void 0!==c?c:5,this.reconnectIntervalMultiple=null!==(u=null===(h=t.reconnect)||void 0===h?void 0:h.mul)&&void 0!==u?u:2,this.maxUnreadCountOnSuperGroup=null!==(_=t.max_unread_cnt_on_super_group)&&void 0!==_?_:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(p=t.concurrent_call_limit)&&void 0!==p?p:5,this.backOffDelay=null!==(E=t.back_off_delay)&&void 0!==E?E:100}static payloadify(e){return k(I(Object.assign(Object.assign(Object.assign({},Oi.payloadify(e.user)),mi.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})))}apply(){const e=this.reconnectInterval,t=this.reconnectMaxInterval,s=this.reconnectIntervalMultiple,n=ji.of(this._iid);n.sdkState.websocket&&(n.sdkState.websocket.pingInterval=1e3*this.pingInterval,n.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,n.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,n.sdkState.websocket.reconnectRetryStrategy={calcTimeout:n=>n>0?1e3*Math.min(e*Math.pow(s,n-1),t):10}),n.appInfo=this.appInfo,n.sessionManager.currentUser=this.user,n.connectedAt=this.connectedAt,this.firstConnectedAt||(n.firstConnectedAt=this.connectedAt),n.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,n.concurrentCallLimit=this.concurrentCallLimit,n.backOffDelay=this.backOffDelay,n.dispatcher.dispatch(new Ri({userProfile:this}))}}class Li extends Te{constructor(e,t,s){var n,i,r;super(e,t,s),this.error=null,this.userProfile=new Di(e,s),this.deviceTokenLastDeletedAt=null!==(n=s.device_token_last_deleted_at)&&void 0!==n?n:0,this.key=null!==(i=s.key)&&void 0!==i?i:"",this.ekey=null!==(r=s.ekey)&&void 0!==r?r:"",this.error=s.error?new o(s):null}static asError(e){return new Li("","LOGI",Object.assign({user_id:"",error:!0},e))}applyTo(t){return e(this,void 0,void 0,(function*(){if(this.error)throw this.error;{const e=ji.of(t);if(!e)throw o.lostInstance;{const{sessionManager:t}=e;yield t.login(this),this.userProfile.apply()}}}))}}class Ui extends x{constructor({request:e=!0,features:t={},options:s={}}){super(),this.request=e,this.features=Object.assign({localCache:!0},t),this.options=Object.assign({ingestion:!0},s)}}class Mi extends A{constructor(e,{sdkState:t,cacheContext:s,connectionHandlers:n,sessionManager:i,websocketClient:r,dispatcher:a,logger:l,entryState:d=new _i}){var c;super(),this._stateUpdatedAt=0,this._connectingAt=0,this._connectionRequestQueue=[],this._iid=e,this.sdkState=t,this.cacheContext=s,this.connectionHandlers=n,this._sessionManager=i,this._websocketClient=r,this._dispatcher=a,this._logger=l,this._currentState=d,(null===(c=this.sdkState.websocket)||void 0===c?void 0:c.pingerDisabled)||(this._pinger=new Ei({pingDelegate:{send:e=>this._websocketClient.send(e),error:e=>this._websocketClient.error(e)},sdkState:this.sdkState,logger:l})),this._websocketClient.on("open",(()=>{this._tryResolveConnectionRequest()})).on("message",(e=>{if("LOGI"===e.code)this.clearLoginTimer(),this._dispatcher.dispatch(e.as(Li))})).on("ping-refresh",(()=>{var e;return null===(e=this._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(()=>{var e;return null===(e=this._pinger)||void 0===e?void 0:e.pong()})).on("error",(()=>{var e;return null===(e=this._pinger)||void 0===e?void 0:e.stop()})).on("close",(()=>{this._logiProcessingTimer=setTimeout((()=>{this._logiProcessingTimer=void 0,this._unresolvedLogi||this._rejectConnectionRequest(o.networkError)}),500)})),this._dispatcher.on((e=>{e instanceof Li&&(this._unresolvedLogi=e,this._tryResolveConnectionRequest())}))}get currentState(){return this._currentState}get hasSession(){return this._sessionManager.auth.hasSession}changeState(t,s){return e(this,void 0,void 0,(function*(){return s>=this._stateUpdatedAt&&(this._currentState=t,this._stateUpdatedAt=s,this._dispatcher.dispatch(new Bn({stateType:t.type})),this._logger.debug(`connection state changes to ${t.name}`),yield this._currentState.run(this),!0)}))}_tryResolveConnectionRequest(){var t;return e(this,void 0,void 0,(function*(){const e=this._unresolvedLogi;if(this._websocketClient.isOpen&&e)if(this._unresolvedLogi=void 0,e.error)this._sessionManager.auth.authToken=void 0,(e.error.isSessionKeyExpiredError||e.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new he({reason:e.error.code})),this._rejectConnectionRequest(e.error);else{yield e.applyTo(this._iid);const{userProfile:s}=e;this._enableStatLog({request:s.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:s.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish")},options:{ingestion:s.appInfo.allowSdkStatsUpload}}),this._statLogConnection(),null===(t=this._pinger)||void 0===t||t.start(),this._connectionRequestQueue.forEach((e=>e.resolve())),this._connectionRequestQueue=[],this.sdkState.appState="foreground"}}))}_rejectConnectionRequest(e){var t;if(null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){const t=this._connectionRequestQueue;this._connectionRequestQueue=[],t.forEach((t=>t.reject(e))),this._statLogConnection(e)}}_url(e=""){var t,s;const{appId:i,appVersion:o,userId:r,extensions:a,sendbirdRuntimeEnvironment:l}=this.sdkState,{localCacheEnabled:d}=this.cacheContext,{auth:c}=this._sessionManager,h=null===(t=this.sdkState.websocket)||void 0===t?void 0:t.compression,u=!!(null!==(s=this.sdkState.extensions)&&void 0!==s?s:{}).sb_uikit,_=me.userAgentWithExtension(a);return`${this.sdkState.websocket.host}/?p=JS&pv=${encodeURIComponent(n.OS_VERSION)}&sv=${encodeURIComponent(n.SDK_VERSION)}&ai=${i}${o?`&av=${o}`:""}${c.hasSession?`&key=${encodeURIComponent(c.sessionKey)}`:`&user_id=${encodeURIComponent(r)}&access_token=${encodeURIComponent(e)}`}&pmce=${h?1:0}&active=1&device_token_types=${encodeURIComponent(["gcm","huawei","apns"].join(","))}&SB-User-Agent=${_}&SB-SDK-User-Agent=${encodeURIComponent(me.sendbirdSdkUserAgentWithExtension(l))}&Request-Sent-Timestamp=${Date.now().toString()}&include_extra_data=${encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications"]))}${this._sessionManager.handler?"&expiring_session=1":""}&use_local_cache=${d?1:0}&include_poll_details=1${u?"&uikit_config=1":""}`}_enableStatLog({request:e,features:t,options:s={}}){this._dispatcher.dispatch(new Ui({request:e,features:t,options:s}))}_statLogConnection(e){var t;this._dispatcher.dispatch(new ue(new _e({type:exports.StatType.WEBSOCKET_CONNECT,data:{host_url:null===(t=this.sdkState.websocket)||void 0===t?void 0:t.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})))}connect(t=""){var s;return e(this,void 0,void 0,(function*(){this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(o.connectionCanceled));const e=this._url(t),n=new Vn;return this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((()=>{this._loginTimer=void 0,this._rejectConnectionRequest(o.loginTimeout)}),null===(s=this.sdkState.websocket)||void 0===s?void 0:s.responseTimeout),t&&(this._sessionManager.auth.authToken=t),this._websocketClient.connect(e)),n.promise}))}cancelConnectForRetry(){this._dispatcher.dispatch(Li.asError(o.connectionRenew))}disconnect(){return e(this,void 0,void 0,(function*(){yield this._websocketClient.disconnect()}))}logout(){return e(this,void 0,void 0,(function*(){this.sdkState.userId=void 0,this._unresolvedLogi=void 0,yield this._sessionManager.clear(),yield this.disconnect()}))}clearLoginTimer(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)}}class Pi{constructor(e,{sdkState:t,cacheContext:s,connectionHandlers:n,sessionManager:i,websocketClient:o,dispatcher:r,logger:a,disableWebSocketCloseEventHandling:l=!1}){this._disableWebSocketCloseEventHandling=!1,this._externalCalledWebSocketClose=!1,this._logger=a,this._disableWebSocketCloseEventHandling=l,this._context=new Mi(e,{sdkState:t,cacheContext:s,connectionHandlers:n,sessionManager:i,websocketClient:o,dispatcher:r,logger:a}),this._sdkState=t,this._sessionManager=i,this._websocketClient=o}_registerEventDispatcher(){this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",(()=>{this.isConnected||(this._logger.debug("try reconnect by session token refresh"),this.reconnect())})).on("refresh",(()=>{this.isConnecting||this.isConnected||(this._logger.debug("try reconnect by session key refresh"),this.reconnect())})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(()=>{"foreground"!==this._sdkState.appState||this._externalCalledWebSocketClose||this._sessionManager.isRefreshingAuthToken||(this._logger.debug("try reconnect by websocket connection closed"),this.reconnect())})))}_clearEventDispatcher(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)}get isConnected(){const{currentState:e}=this._context;return e.type===exports.ConnectionStateType.CONNECTED}get isConnecting(){const{currentState:e}=this._context;return e.type===exports.ConnectionStateType.CONNECTING||e.type===exports.ConnectionStateType.RECONNECTING}get websocketClient(){return this._websocketClient}connect(t){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._externalCalledWebSocketClose=!1,yield e.onConnect(this._context,t),this._registerEventDispatcher()}))}reconnect(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._externalCalledWebSocketClose=!1,yield e.onReconnect(this._context,{})}))}resetAndReconnect(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._externalCalledWebSocketClose=!1,yield e.onReconnect(this._context,{resetReconnectCount:!0})}))}background(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._externalCalledWebSocketClose=!0,yield e.onDisconnect(this._context,{autoReconnect:!1})}))}disconnect(t){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;yield e.onDisconnect(this._context,{error:t,autoReconnect:!0})}))}disconnectWebSocket(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._externalCalledWebSocketClose=!0,yield e.onDisconnectWebSocket(this._context)}))}logout(){return e(this,void 0,void 0,(function*(){const{currentState:e}=this._context;this._clearEventDispatcher(),yield e.onLogout(this._context)}))}}class Fi extends _e{constructor({type:e,data:t,ts:s=Date.now()}){var n;super({type:e,data:t,ts:s}),this.date=new Date(s),this.key=`${n=this.date,`${n.getFullYear()}${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}`}_${e}`}}class Hi extends le{constructor({deviceId:e,statLogs:t}){super(),this.method=exports.APIRequestMethod.POST,this.path=`${te}`,this.params={device_id:e,log_entries:t.map((e=>_e.payloadify(e)))}}}const zi=(e,t)=>{if(null!==e&&null!==t){const s=Object.keys(e),n=Object.keys(t),i=[...new Set([...s,...n])],o={};for(const s of i){const n=typeof e[s],i=typeof t[s];"undefined"===n?o[s]=t[s]:"undefined"===i?o[s]=e[s]:n!==i?o[s]=t[s]:"object"===n&&e[s]&&t[s]?o[s]=zi(e[s],t[s]):o[s]=t[s]}return o}return t};var qi,Gi;!function(e){e[e.PENDING=0]="PENDING",e[e.COLLECT_ONLY=1]="COLLECT_ONLY",e[e.ENABLED=2]="ENABLED",e[e.DISABLED=3]="DISABLED"}(qi||(qi={}));class Vi extends A{constructor({cacheContext:e,requestQueue:t,dispatcher:s,baseLimit:n=100,maxLimit:i=1e3,minLimit:o=10}){super(),this.queue=[],this.enabledState=qi.PENDING,this.isFlushing=!1,this.generation=1,this.lastFlushedAt=0,this._collectRequestStat=!0,this._collectFeatureLocalCacheStat=!0,this.deviceId=y(),this.cacheContext=e,this.requestQueue=t,this.dispatcher=s,this.baseLimit=n,this.limit=n,this.maxLimit=i,this.minLimit=o}get isEnabled(){return this.enabledState===qi.ENABLED}_arrangeStat(){const e=[];this._collectRequestStat&&e.push(...this.queue.filter((e=>e.type===exports.StatType.API_RESULT||e.type===exports.StatType.WEBSOCKET_CONNECT))),this._collectFeatureLocalCacheStat&&e.push(...this.queue.filter((e=>e.type===exports.StatType.FEATURE_LOCALCACHE))),this.queue=e}_save(){return e(this,void 0,void 0,(function*(){this.enabledState===qi.ENABLED&&(yield this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((e=>_e.payloadify(e))),generation:this.generation++,lastFlushedAt:this.lastFlushedAt}),this.dispatch("save",[...this.queue]))}))}_flush(){return e(this,void 0,void 0,(function*(){if(this.isEnabled&&!this.isFlushing){this.isFlushing=!0;try{this._arrangeStat();const e=this.queue.filter((e=>{if(e instanceof Fi){const t=new Date,[s,n]=[e.date.getFullYear(),t.getFullYear()];if(s<n)return!0;if(s===n){const[s,n]=[e.date.getMonth(),t.getMonth()];if(s<n)return!0;if(s===n){const[s,n]=[e.date.getDate(),t.getDate()];return s<n}}}return!1})),t=this.queue.filter((e=>!(e instanceof Fi))),s=[...e,...t].slice(0,Math.min(this.limit,this.maxLimit));if(s.length>0){const n=new Hi({deviceId:this.deviceId,statLogs:s});yield this.requestQueue.send(n),this.dispatch("flush",s),this.queue=[...e,...t].slice(s.length),yield this._save()}this.limit=this.baseLimit,this.lastFlushedAt=Date.now()}catch(e){e instanceof o&&(e.code===exports.SendbirdErrorCode.STAT_LOG_NOT_ALLOWED?(yield this.clear(),this.enabledState=qi.DISABLED):e.code===exports.SendbirdErrorCode.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=qi.COLLECT_ONLY)),this.limit=this.limit+20}finally{this.isFlushing=!1}}}))}init(t){return e(this,void 0,void 0,(function*(){this.key=t;const e=yield this.cacheContext.preference.get(this.key);if(e&&(this.deviceId=e.deviceId,this.queue=e.statLogs.map((e=>new _e({type:e.stat_type,ts:e.ts,data:e.data}))),this.generation=e.generation,this.lastFlushedAt=e.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit)){const e=Math.min(Math.floor(18e4*Math.random()),100);yield ei(e),yield this._flush()}this.commandEventContext||(this.commandEventContext=this.dispatcher.on((e=>{if(e instanceof ue){const{statLog:t}=e;this.put(t)}else if(e instanceof Ui){const{request:t,features:s,options:n}=e;this._collectRequestStat=t,this._collectFeatureLocalCacheStat=null==s?void 0:s.localCache,this._arrangeStat(),this._collectRequestStat||this._collectFeatureLocalCacheStat?this.enabledState=n.ingestion?qi.ENABLED:qi.COLLECT_ONLY:this.enabledState=qi.DISABLED,this.isEnabled?this.queue.length>=this.limit&&this._flush():this.clear()}})))}))}put(t){return e(this,void 0,void 0,(function*(){if(this.enabledState!==qi.DISABLED){if(t instanceof Fi){if(this._collectFeatureLocalCacheStat){const[e]=this.queue.filter((e=>e instanceof Fi&&e.key===t.key));e?e.data=zi(e.data,t.data):this.queue.push(t)}}else this._collectRequestStat&&this.queue.push(t);yield this._save(),this.queue.length>=this.limit&&(yield this._flush())}}))}clear(){return e(this,void 0,void 0,(function*(){this.queue=[],this.generation=1,yield this._save()}))}close(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)}}exports.LogLevel=void 0,(Gi=exports.LogLevel||(exports.LogLevel={}))[Gi.NONE=0]="NONE",Gi[Gi.VERBOSE=1]="VERBOSE",Gi[Gi.DEBUG=2]="DEBUG",Gi[Gi.INFO=3]="INFO",Gi[Gi.WARN=4]="WARN",Gi[Gi.ERROR=5]="ERROR";class Ki{constructor(){this.level=exports.LogLevel.WARN}verbose(...e){this.level<=exports.LogLevel.VERBOSE&&console.log("[verbose]",...e)}debug(...e){this.level<=exports.LogLevel.DEBUG&&console.log("[debug]",...e)}info(...e){this.level<=exports.LogLevel.INFO&&console.log("[info]",...e)}warn(...e){this.level<=exports.LogLevel.WARN&&console.warn("[warn]",...e)}error(...e){this.level<=exports.LogLevel.ERROR&&console.error("[error]",...e)}}const Bi={};class ji{constructor(e,t){var s,i,o,r,a,l,d,c,h,u;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Bi[e]){Bi[e]=this;const p=null!==(s=t.options)&&void 0!==s?s:new _,E=this.sdkState={appId:t.appId,appVersion:null!==(i=t.appVersion)&&void 0!==i?i:"",appState:"foreground",userId:void 0,extensions:{},api:{host:null!==(o=t.apiHost)&&void 0!==o?o:`https://api-${t.appId}.sendbird.com`},websocket:{host:null!==(r=t.websocketHost)&&void 0!==r?r:`wss://ws-${t.appId}.sendbird.com`,pingerDisabled:!!t.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new ti,responseTimeout:p.websocketResponseTimeout},sessionTokenRefreshTimeout:p.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};const f=this.logger=new Ki;this.logger.level=null!==(a=t.logLevel)&&void 0!==a?a:exports.LogLevel.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;const v=this.cacheContext=new g({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(l=t.localCacheEnabled)&&void 0!==l&&l,localCacheConfig:null!==(d=t.localCacheConfig)&&void 0!==d?d:new C});this.debugMode=null!==(c=t.debugMode)&&void 0!==c&&c,this.maxSuperGroupChannelUnreadCount=n.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=p.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=p.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=p.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;const m=this.dispatcher=new b,S=new N;this.requestQueue=new jn(e,{auth:S,sdkState:E,dispatcher:m,logger:f,useFetchCompat:t.useFetchCompat}),this.sessionManager=new oi({auth:S,cacheContext:v,sdkState:E,dispatcher:m,requestQueue:this.requestQueue,logger:f}),this.connectionManager=new Pi(e,{sdkState:E,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:m,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(h=t.disableWebSocketCloseEventHandling)&&void 0!==h&&h,logger:f}),this.statLogCollector=new Vi({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:m}),this.appStateToggleEnabled=null===(u=t.appStateToggleEnabled)||void 0===u||u}return Bi[e]}static of(e){if(Bi[e])return Bi[e];throw o.lostInstance}static clear(e){Bi[e]&&delete Bi[e]}hasExtension(e){return this.sdkState.extensions&&this.sdkState.extensions[e]}}var $i;exports.PollStatus=void 0,($i=exports.PollStatus||(exports.PollStatus={})).OPEN="open",$i.CLOSED="closed";const Zi=e=>{switch(e){case"open":return exports.PollStatus.OPEN;case"closed":return exports.PollStatus.CLOSED;default:return null}},Wi=e=>!e||!!e.text&&l("string",e.text);class Qi extends Si{constructor(e,t){var s,n,i,o,r,a,l;super(e),this.pollId=0,this.id=0,this.text=null,this.voteCount=0,this.createdBy=null,this.createdAt=0,this.updatedAt=0,this._lastVotedAt=0,this.pollId=null!==(s=t.poll_id)&&void 0!==s?s:0,this.id=null!==(n=t.id)&&void 0!==n?n:0,this.text=null!==(i=t.text)&&void 0!==i?i:null,this.voteCount=null!==(o=t.vote_count)&&void 0!==o?o:0,this.createdBy=null!==(r=t.created_by)&&void 0!==r?r:null,this.createdAt=null!==(a=t.created_at)&&void 0!==a?a:0,this.updatedAt=null!==(l=t.updated_at)&&void 0!==l?l:0}static payloadify(e){return k(I(Object.assign(Object.assign({},super.payloadify(e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))}}class Yi extends Si{constructor(e,t){var s,n,i,o,r,a,l,d,c,h,u,_,p;super(e),this.id=0,this.title=null,this.createdAt=0,this.updatedAt=0,this.closeAt=-1,this.status=exports.PollStatus.CLOSED,this.messageId=0,this.data=null,this.voterCount=-1,this.options=[],this.createdBy=null,this.allowUserSuggestion=!1,this.allowMultipleVotes=!1,this.votedPollOptionIds=[],this.id=null!==(s=t.id)&&void 0!==s?s:0,this.title=null!==(n=t.title)&&void 0!==n?n:null,this.createdAt=null!==(i=t.created_at)&&void 0!==i?i:0,this.updatedAt=null!==(o=t.updated_at)&&void 0!==o?o:0,this.closeAt=null!==(r=t.close_at)&&void 0!==r?r:-1,this.status=null!==(a=Zi(t.status))&&void 0!==a?a:exports.PollStatus.CLOSED,this.messageId=null!==(l=t.message_id)&&void 0!==l?l:0,this.data=null!==(d=t.data)&&void 0!==d?d:null,this.voterCount=null!==(c=t.voter_count)&&void 0!==c?c:-1,this.options=t.options?t.options.map((e=>new Qi(this._iid,e))):[],this.createdBy=null!==(h=t.created_by)&&void 0!==h?h:null,this.allowUserSuggestion=null!==(u=t.allow_user_suggestion)&&void 0!==u&&u,this.allowMultipleVotes=null!==(_=t.allow_multiple_votes)&&void 0!==_&&_,this.votedPollOptionIds=null!==(p=t.voted_option_ids)&&void 0!==p?p:[]}_applyPollUpdatePayload(e){var t,s,n,i,o,r,a,l;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(s=e.updated_at)&&void 0!==s?s:this.updatedAt,this.closeAt=null!==(n=e.close_at)&&void 0!==n?n:this.closeAt,this.status=null!==(i=Zi(e.status))&&void 0!==i?i:this.status,this.data=null!==(o=e.data)&&void 0!==o?o:this.data,this.voterCount=null!==(r=e.voter_count)&&void 0!==r?r:this.voterCount,e.options&&(this.options=e.options.map((e=>new Qi(this._iid,e))),this.votedPollOptionIds=e.options.filter((e=>e.vote_count>0)).map((e=>e.id))),this.allowUserSuggestion=null!==(a=e.allow_user_suggestion)&&void 0!==a?a:this.allowUserSuggestion,this.allowMultipleVotes=null!==(l=e.allow_multiple_votes)&&void 0!==l?l:this.allowMultipleVotes}static payloadify(e){return k(I(Object.assign(Object.assign({},super.payloadify(e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map((e=>Qi.payloadify(e))),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))}applyPollUpdateEvent(e){const t=e._payload.poll;return!(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)}applyPollVoteEvent(e){if(this.id!==e.pollId)return!1;const t=this.options,s=t.map((e=>e.id)),n=e._payload,i=Math.floor(n.ts/1e3);return n.updated_vote_counts.forEach((e=>{const n=s.indexOf(e.option_id);if(n>-1){const s=t[n];i>=s._lastVotedAt&&(s.voteCount=e.vote_count,s._lastVotedAt=i)}})),n.req_id&&n.voted_option_ids&&(this.votedPollOptionIds=n.voted_option_ids),"number"==typeof n.voter_count&&(this.voterCount=n.voter_count),!0}serialize(){return bi(this)}}var Xi;exports.CollectionEventSource=void 0,(Xi=exports.CollectionEventSource||(exports.CollectionEventSource={})).UNKNOWN="UNKNOWN",Xi.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",Xi.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",Xi.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",Xi.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",Xi.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",Xi.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",Xi.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",Xi.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",Xi.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",Xi.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",Xi.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",Xi.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",Xi.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",Xi.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",Xi.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",Xi.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",Xi.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",Xi.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",Xi.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",Xi.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",Xi.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",Xi.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",Xi.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",Xi.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",Xi.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",Xi.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",Xi.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",Xi.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",Xi.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",Xi.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",Xi.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",Xi.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",Xi.REQUEST_CHANNEL="REQUEST_CHANNEL",Xi.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",Xi.REFRESH_CHANNEL="REFRESH_CHANNEL",Xi.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",Xi.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",Xi.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",Xi.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",Xi.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",Xi.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",Xi.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",Xi.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",Xi.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",Xi.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",Xi.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",Xi.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",Xi.REQUEST_MESSAGE="REQUEST_MESSAGE",Xi.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",Xi.EVENT_POLL_VOTED="EVENT_POLL_VOTED",Xi.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",Xi.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",Xi.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",Xi.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",Xi.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",Xi.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",Xi.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",Xi.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",Xi.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",Xi.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",Xi.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";const Ji=Object.assign({},exports.CollectionEventSource);class eo extends x{constructor({polls:e,source:t}){super(),this.polls=e,this.source=t}}class to{constructor(e,t){var s;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(s=t.limit)&&void 0!==s?s:20}get hasNext(){return this._hasNext}get isLoading(){return this._isLoading}_validate(){return l("number",this.limit)&&this.limit>0}}class so extends to{constructor(e,t,s,n){super(e,n),this.channelUrl=t,this.channelType=s}_validate(){return super._validate()&&l("string",this.channelUrl)&&d(exports.ChannelType,this.channelType)}}class no extends le{constructor({title:e,optionTexts:t,data:s,allowUserSuggestion:n,allowMultipleVotes:i,closeAt:o}){super(),this.method=exports.APIRequestMethod.POST,this.path=X,this.params={title:e,options:t,data:s,allow_user_suggestion:n,allow_multiple_votes:i,close_at:o}}}class io extends de{constructor(e,t){super(e,t),this.poll=new Yi(e,t)}}class oo extends le{constructor({channelUrl:e,channelType:t,pollId:s}){super(),this.method=exports.APIRequestMethod.GET,this.path=`${X}/${encodeURIComponent(s)}`,this.params={channel_url:e,channel_type:t}}}class ro extends de{constructor(e,t){super(e,t),this.poll=new Yi(e,t)}}class ao extends le{constructor({channelUrl:e,channelType:t,pollId:s,pollOptionId:n}){super(),this.method=exports.APIRequestMethod.GET,this.path=`${X}/${encodeURIComponent(s)}/options/${encodeURIComponent(n)}`,this.params={channel_url:e,channel_type:t}}}class lo extends de{constructor(e,t){super(e,t),this.pollOption=new Qi(e,t)}}class co extends le{constructor({channelType:e,channelUrl:t,timestamp:s,token:n}){super(),this.method=exports.APIRequestMethod.GET,this.path=`${ne(e)}/${encodeURIComponent(t)}/polls/changelogs`,this.params=k({change_ts:s,token:n})}}class ho extends de{constructor(e,t){super(e,t),this.updatedPolls=t.updated.map((t=>((e,t)=>new Yi(e,t))(e,t))),this.deletedPollIds=t.deleted.map((e=>e)),this.hasMore=t.has_more,this.nextToken=t.next}}const uo={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},_o=e=>{return l("string",e.title)&&(t=e.optionTexts,h("string",t)&&t.every((e=>""!==e.trim())))&&Wi(e.data)&&l("boolean",e.allowUserSuggestion,!0)&&l("boolean",e.allowMultipleVotes,!0)&&l("number",e.closeAt,!0);var t},po={channelUrl:"",channelType:exports.ChannelType.BASE,pollId:0,pollOptionId:0},Eo=e=>l("string",e.channelUrl)&&""!==e.channelUrl&&d(exports.ChannelType,e.channelType)&&l("number",e.pollId)&&e.pollId>0&&l("number",e.pollOptionId)&&e.pollOptionId>0,go={channelUrl:"",channelType:exports.ChannelType.BASE,pollId:0},fo=e=>l("string",e.channelUrl)&&""!==e.channelUrl&&d(exports.ChannelType,e.channelType)&&l("number",e.pollId),vo={};class mo extends le{constructor({channelUrl:e,channelType:t,token:s,limit:n}){super(),this.method=exports.APIRequestMethod.GET,this.path=X,this.params={channel_url:e,channel_type:t,token:s,limit:n}}}class So extends de{constructor(e,t){var s;super(e,t),this.polls=(null!==(s=t.polls)&&void 0!==s?s:[]).map((t=>new Yi(e,t))),this.token=t.next}}class To extends le{constructor({channelUrl:e,channelType:t,pollId:s,pollOptionId:n,token:i,limit:o}){super(),this.method=exports.APIRequestMethod.GET,this.path=`${X}/${encodeURIComponent(s)}/options/${encodeURIComponent(n)}/voters`,this.params={channel_url:e,channel_type:t,token:i,limit:o}}}class Co extends de{constructor(e,t){var s;super(e,t),this.voters=(null!==(s=t.voters)&&void 0!==s?s:[]).map((t=>new Oi(e,t))),this.token=t.next}}exports.APIRequestCommand=le,exports.APIResponseCommand=de,exports.API_PATH_EMOJIS=Q,exports.API_PATH_EMOJI_CATEGORIES=Y,exports.API_PATH_GROUP_CHANNELS=K,exports.API_PATH_GROUP_CHANNELS_INTERNAL=B,exports.API_PATH_NOTIFICATIONS=se,exports.API_PATH_OPEN_CHANNELS=j,exports.API_PATH_OPEN_CHANNELS_INTERNAL=$,exports.API_PATH_POLLS=X,exports.API_PATH_REPORT=W,exports.API_PATH_SCHEDULED_MESSAGES=J,exports.API_PATH_SEARCH=Z,exports.API_PATH_UIKIT_CONFIGURATION=ee,exports.API_PATH_UPLOAD=V,exports.API_PATH_USERS=G,exports.BaseCommand=x,exports.BaseListQuery=to,exports.CachedChannelInfo=class{constructor({channel:e,cachedMessageCount:t}){this._cachedMessageCount=0,this._channel=e,this._cachedMessageCount=t}get channel(){return this._channel}get cachedMessageCount(){return this._cachedMessageCount}},exports.ChannelDataListQuery=so,exports.ConnectionStateChangeCommand=Bn,exports.DEFAULT_ENCRYPTION=p,exports.DEFAULT_MULTIPLE_FILES_MESSAGE_FILE_COUNT_LIMIT=5,exports.DailyRecordStatLog=Fi,exports.Deferred=Vn,exports.EventDispatcher=A,exports.InstancedObject=Si,exports.LocalCacheConfig=C,exports.MessageEventSource=Ji,exports.MessageRemoveEventCommand=class extends x{constructor({messageIds:e,source:t,isWebSocketEventComing:s=!1}){super(),this.messageIds=e,this.source=t,this.isWebSocketEventComing=s}},exports.MessageUpdateEventCommand=class extends x{constructor({messages:e,source:t,isWebSocketEventComing:s=!1}){super(),this.messages=e,this.source=t,this.isWebSocketEventComing=s}},exports.Module=class{init(e,{sdkState:t,dispatcher:s,sessionManager:n,requestQueue:i,logger:o,onlineDetector:r,cacheContext:a}){this._iid=e,this._cacheContext=a,this._sdkState=t,this._dispatcher=s,this._sessionManager=n,this._requestQueue=i,this._logger=o}},exports.NotificationInfo=gi,exports.POLL_REMOVED_STATUS="removed",exports.Poll=Yi,exports.PollChangeLogEventCommand=eo,exports.PollCreateParamsDefault=uo,exports.PollListQuery=class extends so{constructor(e,t){super(e,t.channelUrl,t.channelType,t)}next(){return e(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw o.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=ji.of(this._iid),t=new mo(Object.assign(Object.assign({},this),{token:this._token})),s=yield e.send(t),{polls:n,token:i}=s.as(So);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw o.invalidParameters}))}},exports.PollManager=class{constructor(e,{sdkState:t,dispatcher:s,sessionManager:n,requestQueue:i,logger:o}){this._iid=e,this._sdkState=t,this._sessionManager=n,this._requestQueue=i,this._dispatcher=s,this._logger=o,vo[e]=this}static of(e){return vo[e]}buildPollFromSerializedData(e){const t=xi(e);return new Yi(this._iid,Yi.payloadify(t))}get(t){return e(this,void 0,void 0,(function*(){ki(fo(t)).throw(o.invalidParameters);const e=new oo(Object.assign({},t)),s=yield this._requestQueue.send(e),{poll:n}=s.as(ro);return n}))}create(t){return e(this,void 0,void 0,(function*(){ki(_o(t)).throw(o.invalidParameters);const e=new no(Object.assign({},t)),s=yield this._requestQueue.send(e),{poll:n}=s.as(io);return n}))}getOption(t){return e(this,void 0,void 0,(function*(){ki(Eo(t)).throw(o.invalidParameters);const e=new ao(Object.assign({},t)),s=yield this._requestQueue.send(e),{pollOption:n}=s.as(lo);return n}))}getPollChangeLogs(t,s,n,i=exports.CollectionEventSource.SYNC_POLL_CHANGELOGS){return e(this,void 0,void 0,(function*(){const e=new co(I({channelType:s,channelUrl:t,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null})),o=yield this._requestQueue.send(e),{updatedPolls:r,deletedPollIds:a,hasMore:l,nextToken:d}=o.as(ho);return r.length>0&&this._dispatcher.dispatch(new eo({polls:r,source:i})),{updatedPolls:r,deletedPollIds:a,hasMore:l,token:d}}))}},exports.PollOption=Qi,exports.PollOptionRetrievalParamsDefault=po,exports.PollRetrievalParamsDefault=go,exports.PollUpdateInternalEventCommand=class extends x{constructor({event:e,source:t}){super(),this.event=e,this.source=t}},exports.PollVoteEvent=class{constructor(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e}},exports.PollVoteInternalEventCommand=class extends x{constructor({event:e,source:t}){super(),this.event=e,this.source=t}},exports.PollVoterListQuery=class extends so{constructor(e,t){super(e,t.channelUrl,t.channelType,t),this.pollId=t.pollId,this.pollOptionId=t.pollOptionId}_validate(){return super._validate()&&l("number",this.pollId)&&l("number",this.pollOptionId)}next(){return e(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw o.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:e}=ji.of(this._iid),t=new To(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),s=yield e.send(t),{voters:n,token:i}=s.as(Co);return this._token=i,this._hasNext=!!i,this._isLoading=!1,n}return[]}throw o.invalidParameters}))}},exports.SEMVER_REGEX_STRING="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",exports.SendbirdChatOptions=_,exports.SendbirdError=o,exports.SessionExpiredCommand=he,exports.SubscribedUnreadMessageCountUpdateCommand=Gn,exports.UIKitConfigInfo=fi,exports.UnsentMessageRemoveEventCommand=class extends x{constructor({reqId:e,source:t}){super(),this.reqId=e,this.source=t}},exports.User=Oi,exports.UserProfile=Di,exports.UserProfileUpdateCommand=Ri,exports.Vault=ji,exports.WebSocketEventCommand=Te,exports.WebSocketRequestCommand=qn,exports.__awaiter=e,exports.__rest=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]])}return s},exports.asyncRetry=si,exports.calculateMentionCountChange=(e,t,s)=>{var n,i,o,r;const a=ie(null!==(n=e.mentionType)&&void 0!==n?n:null,null!==(i=e.mentionedUserIds)&&void 0!==i?i:[],s),l=ie(null!==(o=t.mentionType)&&void 0!==o?o:null,null!==(r=t.mentionedUserIds)&&void 0!==r?r:[],s);return!a&&l?1:a&&!l?-1:0},exports.checkIfMentioned=ie,exports.createChangelogIncludeChatNotificationsCacheKey=e=>`sendbird@${e}/changelog_include_chat_notifications`,exports.deepEqual=(e,t)=>{if(e!==t){const s=Object.assign({},e),n=Object.assign({},t);return(!s.hasOwnProperty("messageId")||!n.hasOwnProperty("messageId")||s.messageId===n.messageId)&&((!s.hasOwnProperty("reqId")||!n.hasOwnProperty("reqId")||s.reqId===n.reqId)&&(s.hasOwnProperty("messageId")&&delete s.messageId,s.hasOwnProperty("reqId")&&delete s.reqId,n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,JSON.stringify(s)===JSON.stringify(n)))}return!0},exports.deserialize=xi,exports.deundefined=k,exports.getChannelApiPathByType=ne,exports.getReportApiPathByType=e=>{switch(e){case exports.ChannelType.GROUP:return`${W}/group_channels`;case exports.ChannelType.OPEN:return`${W}/open_channels`;default:return null}},exports.hasSameMembers=(e,t)=>{if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;const s=[...e].sort(),n=[...t].sort();for(let e=0;e<s.length;++e)if(s[e]!==n[e])return!1;return!0},exports.isArrayOf=h,exports.isAutoResendableError=e=>e>0&&a.indexOf(e)>=0,exports.isEnumOf=d,exports.isFile=u,exports.isMilliSecondOf=(e,t=!1)=>!(!t||void 0!==e)||"number"==typeof e&&13===e.toString().length,exports.isReactNative=pe,exports.isResendableError=e=>e>0&&r.indexOf(e)>=0,exports.isThrowingOutside=i,exports.isTypeOf=l,exports.noop=Ce,exports.parsePollStatusPayload=Zi,exports.runAsCallback=ni,exports.runOrNothing=t=>e(void 0,void 0,void 0,(function*(){try{yield t()}catch(e){}})),exports.serialize=bi,exports.shouldGiveEvent=e=>e.startsWith("EVENT_")||e.startsWith("LOCAL_MESSAGE_")||e===exports.CollectionEventSource.SYNC_MESSAGE_FILL||e===exports.CollectionEventSource.SYNC_MESSAGE_CHANGELOGS||e===exports.CollectionEventSource.SYNC_POLL_CHANGELOGS,exports.sleep=ei,exports.undefineNullProps=I,exports.unless=ki,exports.uuid=y,exports.validatePollCreateParams=_o,exports.validatePollData=Wi,exports.validatePollOptionRetrievalParams=Eo,exports.validatePollRetrievalParams=fo,exports.version=s;
