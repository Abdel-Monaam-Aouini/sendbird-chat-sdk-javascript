"use strict";var e=require("./__bundle-2c62c22a.js");class t extends e.APIRequestCommand{constructor({title:t,optionTexts:s,data:n,allowUserSuggestion:o,allowMultipleVotes:l,closeAt:i}){super(),this.method=e.APIRequestMethod.POST,this.path=e.API_PATH_POLLS,this.params={title:t,options:s,data:n,allow_user_suggestion:o,allow_multiple_votes:l,close_at:i}}}class s extends e.APIResponseCommand{constructor(t,s){super(t,s),this.poll=new e.Poll(t,s)}}class n extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,pollId:n}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_POLLS}/${encodeURIComponent(n)}`,this.params={channel_url:t,channel_type:s}}}class o extends e.APIResponseCommand{constructor(t,s){super(t,s),this.poll=new e.Poll(t,s)}}class l extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,pollId:n,pollOptionId:o}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_POLLS}/${encodeURIComponent(n)}/options/${encodeURIComponent(o)}`,this.params={channel_url:t,channel_type:s}}}class i extends e.APIResponseCommand{constructor(t,s){super(t,s),this.pollOption=new e.PollOption(t,s)}}class a extends e.APIRequestCommand{constructor({channelType:t,channelUrl:s,timestamp:n,token:o}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.getChannelApiPathByType(t)}/${encodeURIComponent(s)}/polls/changelogs`,this.params=e.deundefined({change_ts:n,token:o})}}class r extends e.APIResponseCommand{constructor(t,s){super(t,s),this.updatedPolls=s.updated.map((s=>((t,s)=>new e.Poll(t,s))(t,s))),this.deletedPollIds=s.deleted.map((e=>e)),this.hasMore=s.has_more,this.nextToken=s.next}}const d={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},p=t=>e.isTypeOf("string",t.title)&&e.validateOptionTexts(t.optionTexts)&&e.validatePollData(t.data)&&e.isTypeOf("boolean",t.allowUserSuggestion,!0)&&e.isTypeOf("boolean",t.allowMultipleVotes,!0)&&e.isTypeOf("number",t.closeAt,!0),h={channelUrl:"",channelType:e.ChannelType.BASE,pollId:0,pollOptionId:0},u=t=>e.isTypeOf("string",t.channelUrl)&&""!==t.channelUrl&&e.isEnumOf(e.ChannelType,t.channelType)&&e.isTypeOf("number",t.pollId)&&t.pollId>0&&e.isTypeOf("number",t.pollOptionId)&&t.pollOptionId>0,c={channelUrl:"",channelType:e.ChannelType.BASE,pollId:0},m=t=>e.isTypeOf("string",t.channelUrl)&&""!==t.channelUrl&&e.isEnumOf(e.ChannelType,t.channelType)&&e.isTypeOf("number",t.pollId),_={};class P extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,token:n,limit:o}){super(),this.method=e.APIRequestMethod.GET,this.path=e.API_PATH_POLLS,this.params={channel_url:t,channel_type:s,token:n,limit:o}}}class I extends e.APIResponseCommand{constructor(t,s){var n;super(t,s),this.polls=(null!==(n=s.polls)&&void 0!==n?n:[]).map((s=>new e.Poll(t,s))),this.token=s.next}}class g extends e.ChannelDataListQuery{constructor(e,t){super(e,t.channelUrl,t.channelType,t)}next(){return e.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw e.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:t}=e.Vault.of(this._iid),s=new P(Object.assign(Object.assign({},this),{token:this._token})),n=yield t.send(s),{polls:o,token:l}=n.as(I);return this._token=l,this._hasNext=!!l,this._isLoading=!1,o}return[]}throw e.SendbirdError.invalidParameters}))}}class y extends e.APIRequestCommand{constructor({channelUrl:t,channelType:s,pollId:n,pollOptionId:o,token:l,limit:i}){super(),this.method=e.APIRequestMethod.GET,this.path=`${e.API_PATH_POLLS}/${encodeURIComponent(n)}/options/${encodeURIComponent(o)}/voters`,this.params={channel_url:t,channel_type:s,token:l,limit:i}}}class v extends e.APIResponseCommand{constructor(t,s){var n;super(t,s),this.voters=(null!==(n=s.voters)&&void 0!==n?n:[]).map((s=>new e.User(t,s))),this.token=s.next}}class O extends e.ChannelDataListQuery{constructor(e,t){super(e,t.channelUrl,t.channelType,t),this.pollId=t.pollId,this.pollOptionId=t.pollOptionId}_validate(){return super._validate()&&e.isTypeOf("number",this.pollId)&&e.isTypeOf("number",this.pollOptionId)}next(){return e.__awaiter(this,void 0,void 0,(function*(){if(this._validate()){if(this._isLoading)throw e.SendbirdError.queryInProgress;if(this._hasNext){this._isLoading=!0;const{requestQueue:t}=e.Vault.of(this._iid),s=new y(Object.assign(Object.assign({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),n=yield t.send(s),{voters:o,token:l}=n.as(v);return this._token=l,this._hasNext=!!l,this._isLoading=!1,o}return[]}throw e.SendbirdError.invalidParameters}))}}exports.PollCreateParamsDefault=d,exports.PollListQuery=g,exports.PollManager=class{constructor(e,{sdkState:t,dispatcher:s,sessionManager:n,requestQueue:o,logger:l}){this._iid=e,this._sdkState=t,this._sessionManager=n,this._requestQueue=o,this._dispatcher=s,this._logger=l,_[e]=this}static of(e){return _[e]}buildPollFromSerializedData(t){const s=e.deserialize(t);return new e.Poll(this._iid,e.Poll.payloadify(s))}get(t){return e.__awaiter(this,void 0,void 0,(function*(){e.unless(m(t)).throw(e.SendbirdError.invalidParameters);const s=new n(Object.assign({},t)),l=yield this._requestQueue.send(s),{poll:i}=l.as(o);return i}))}create(n){return e.__awaiter(this,void 0,void 0,(function*(){e.unless(p(n)).throw(e.SendbirdError.invalidParameters);const o=new t(Object.assign({},n)),l=yield this._requestQueue.send(o),{poll:i}=l.as(s);return i}))}getOption(t){return e.__awaiter(this,void 0,void 0,(function*(){e.unless(u(t)).throw(e.SendbirdError.invalidParameters);const s=new l(Object.assign({},t)),n=yield this._requestQueue.send(s),{pollOption:o}=n.as(i);return o}))}getPollChangeLogs(t,s,n,o=e.MessageEventSource.SYNC_POLL_CHANGELOGS){return e.__awaiter(this,void 0,void 0,(function*(){const l=new a(e.undefineNullProps({channelType:s,channelUrl:t,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null})),i=yield this._requestQueue.send(l),{updatedPolls:d,deletedPollIds:p,hasMore:h,nextToken:u}=i.as(r);return d.length>0&&this._dispatcher.dispatch(new e.PollChangeLogEventCommand({polls:d,source:o})),{updatedPolls:d,deletedPollIds:p,hasMore:h,token:u}}))}},exports.PollOptionRetrievalParamsDefault=h,exports.PollRetrievalParamsDefault=c,exports.PollUpdateEvent=class{constructor(e,t){this.pollId=0,this.messageId=0,this.pollId=t.poll.id,this.messageId=t.poll.message_id,this._iid=e,this._payload=t}},exports.PollVoteEvent=class{constructor(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e}},exports.PollVoterListQuery=O,exports.validatePollCreateParams=p,exports.validatePollOptionRetrievalParams=u,exports.validatePollRetrievalParams=m;
